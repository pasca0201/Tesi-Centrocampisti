<html>
<head>
<title>test_arrayprint.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
.s6 { color: #a5c261;}
.s7 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_arrayprint.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">gc</span>
<span class="s0">from </span><span class="s1">hypothesis </span><span class="s0">import </span><span class="s1">given</span>
<span class="s0">from </span><span class="s1">hypothesis</span><span class="s2">.</span><span class="s1">extra </span><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">hynp</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">assert_</span><span class="s2">, </span><span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_raises</span><span class="s2">, </span><span class="s1">assert_warns</span><span class="s2">, </span><span class="s1">HAS_REFCOUNT</span><span class="s2">,</span>
    <span class="s1">assert_raises_regex</span><span class="s2">, </span><span class="s1">IS_WASM</span>
    <span class="s2">)</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">_private</span><span class="s2">.</span><span class="s1">utils </span><span class="s0">import </span><span class="s1">run_threaded</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">arrayprint </span><span class="s0">import </span><span class="s1">_typelessdata</span>
<span class="s0">import </span><span class="s1">textwrap</span>

<span class="s0">class </span><span class="s1">TestArrayRepr</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_nan_inf</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'array([nan, inf])'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_subclass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">class </span><span class="s1">sub</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">): </span><span class="s0">pass</span>

        <span class="s4"># one dimensional</span>
        <span class="s1">x1d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">sub</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x1d</span><span class="s2">), </span><span class="s3">'sub([1, 2])'</span><span class="s2">)</span>

        <span class="s4"># two dimensional</span>
        <span class="s1">x2d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]]).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">sub</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x2d</span><span class="s2">),</span>
            <span class="s3">'sub([[1, 2],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'     [3, 4]])'</span><span class="s2">)</span>

        <span class="s4"># two dimensional with flexible dtype</span>
        <span class="s1">xstruct </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">2</span><span class="s2">,</span><span class="s5">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=[(</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'&lt;i4'</span><span class="s2">)]).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">sub</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">xstruct</span><span class="s2">),</span>
            <span class="s3">&quot;sub([[(1,), (1,)],</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;     [(1,), (1,)]], dtype=[('a', '&lt;i4')])&quot;</span>
        <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;See gh-10544&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_object_subclass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">class </span><span class="s1">sub</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">inp</span><span class="s2">):</span>
                <span class="s1">obj </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">inp</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">)</span>
                <span class="s0">return </span><span class="s1">obj</span>

            <span class="s0">def </span><span class="s1">__getitem__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ind</span><span class="s2">):</span>
                <span class="s1">ret </span><span class="s2">= </span><span class="s1">super</span><span class="s2">().</span><span class="s1">__getitem__</span><span class="s2">(</span><span class="s1">ind</span><span class="s2">)</span>
                <span class="s0">return </span><span class="s1">sub</span><span class="s2">(</span><span class="s1">ret</span><span class="s2">)</span>

        <span class="s4"># test that object + subclass is OK:</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">sub</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'sub([None, None], dtype=object)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'[None None]'</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">sub</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s1">sub</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">])])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
            <span class="s3">'sub([None, sub([None, None], dtype=object)], dtype=object)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'[None sub([None, None], dtype=object)]'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_0d_object_subclass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># make sure that subclasses which return 0ds instead</span>
        <span class="s4"># of scalars don't cause infinite recursion in str</span>
        <span class="s0">class </span><span class="s1">sub</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">inp</span><span class="s2">):</span>
                <span class="s1">obj </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">inp</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">)</span>
                <span class="s0">return </span><span class="s1">obj</span>

            <span class="s0">def </span><span class="s1">__getitem__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ind</span><span class="s2">):</span>
                <span class="s1">ret </span><span class="s2">= </span><span class="s1">super</span><span class="s2">().</span><span class="s1">__getitem__</span><span class="s2">(</span><span class="s1">ind</span><span class="s2">)</span>
                <span class="s0">return </span><span class="s1">sub</span><span class="s2">(</span><span class="s1">ret</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">sub</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'sub(1)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'1'</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">sub</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'sub([1, 1])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'[1 1]'</span><span class="s2">)</span>

        <span class="s4"># check it works properly with object arrays too</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">sub</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'sub(None, dtype=object)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'None'</span><span class="s2">)</span>

        <span class="s4"># plus recursive object arrays (even depth &gt; 1)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">sub</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[()] = </span><span class="s1">y</span>
        <span class="s1">y</span><span class="s2">[()] = </span><span class="s1">x</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
            <span class="s3">'sub(sub(sub(..., dtype=object), dtype=object), dtype=object)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'...'</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[()] = </span><span class="s5">0  </span><span class="s4"># resolve circular references for garbage collector</span>

        <span class="s4"># nested 0d-subclass-object</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">sub</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[()] = </span><span class="s1">sub</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'sub(sub(None, dtype=object), dtype=object)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'None'</span><span class="s2">)</span>

        <span class="s4"># gh-10663</span>
        <span class="s0">class </span><span class="s1">DuckCounter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">__getitem__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">item</span><span class="s2">):</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">super</span><span class="s2">().</span><span class="s1">__getitem__</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)</span>
                <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">DuckCounter</span><span class="s2">):</span>
                    <span class="s1">result </span><span class="s2">= </span><span class="s1">result</span><span class="s2">[...].</span><span class="s1">view</span><span class="s2">(</span><span class="s1">DuckCounter</span><span class="s2">)</span>
                <span class="s0">return </span><span class="s1">result</span>

            <span class="s0">def </span><span class="s1">to_string</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s2">{</span><span class="s5">0</span><span class="s2">: </span><span class="s3">'zero'</span><span class="s2">, </span><span class="s5">1</span><span class="s2">: </span><span class="s3">'one'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">: </span><span class="s3">'two'</span><span class="s2">}.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(), </span><span class="s3">'many'</span><span class="s2">)</span>

            <span class="s0">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== ():</span>
                    <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">to_string</span><span class="s2">()</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">fmt </span><span class="s2">= {</span><span class="s3">'all'</span><span class="s2">: </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span><span class="s2">.</span><span class="s1">to_string</span><span class="s2">()}</span>
                    <span class="s0">return </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">=</span><span class="s1">fmt</span><span class="s2">)</span>

        <span class="s1">dc </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">DuckCounter</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">dc</span><span class="s2">), </span><span class="s3">&quot;[zero one two many many]&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">dc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]), </span><span class="s3">&quot;zero&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_self_containing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">arr0d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">arr0d</span><span class="s2">[()] = </span><span class="s1">arr0d</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">arr0d</span><span class="s2">),</span>
            <span class="s3">'array(array(..., dtype=object), dtype=object)'</span><span class="s2">)</span>
        <span class="s1">arr0d</span><span class="s2">[()] = </span><span class="s5">0  </span><span class="s4"># resolve recursion for garbage collector</span>

        <span class="s1">arr1d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">])</span>
        <span class="s1">arr1d</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s1">arr1d</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">arr1d</span><span class="s2">),</span>
            <span class="s3">'array([None, array(..., dtype=object)], dtype=object)'</span><span class="s2">)</span>
        <span class="s1">arr1d</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s5">0  </span><span class="s4"># resolve recursion for garbage collector</span>

        <span class="s1">first </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">second </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">first</span><span class="s2">[()] = </span><span class="s1">second</span>
        <span class="s1">second</span><span class="s2">[()] = </span><span class="s1">first</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">first</span><span class="s2">),</span>
            <span class="s3">'array(array(array(..., dtype=object), dtype=object), dtype=object)'</span><span class="s2">)</span>
        <span class="s1">first</span><span class="s2">[()] = </span><span class="s5">0  </span><span class="s4"># resolve circular references for garbage collector</span>

    <span class="s0">def </span><span class="s1">test_containing_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># printing square brackets directly would be ambiguuous</span>
        <span class="s1">arr1d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">])</span>
        <span class="s1">arr1d</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
        <span class="s1">arr1d</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = [</span><span class="s5">3</span><span class="s2">]</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">arr1d</span><span class="s2">),</span>
            <span class="s3">'array([list([1, 2]), list([3])], dtype=object)'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_void_scalar_recursion</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># gh-9345</span>
        <span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">(</span><span class="s6">b'test'</span><span class="s2">))  </span><span class="s4"># RecursionError ?</span>

    <span class="s0">def </span><span class="s1">test_fieldless_structured</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># gh-10366</span>
        <span class="s1">no_fields </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">([])</span>
        <span class="s1">arr_no_fields </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">no_fields</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">arr_no_fields</span><span class="s2">), </span><span class="s3">'array([(), (), (), ()], dtype=[])'</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestComplexArray</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rvals </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]</span>
        <span class="s1">cvals </span><span class="s2">= [</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">rp</span><span class="s2">, </span><span class="s1">ip</span><span class="s2">) </span><span class="s0">for </span><span class="s1">rp </span><span class="s0">in </span><span class="s1">rvals </span><span class="s0">for </span><span class="s1">ip </span><span class="s0">in </span><span class="s1">rvals</span><span class="s2">]</span>
        <span class="s1">dtypes </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cdouble</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">clongdouble</span><span class="s2">]</span>
        <span class="s1">actual </span><span class="s2">= [</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">c</span><span class="s2">], </span><span class="s1">dt</span><span class="s2">)) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">cvals </span><span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">dtypes</span><span class="s2">]</span>
        <span class="s1">wanted </span><span class="s2">= [</span>
            <span class="s3">'[0.+0.j]'</span><span class="s2">,    </span><span class="s3">'[0.+0.j]'</span><span class="s2">,    </span><span class="s3">'[0.+0.j]'</span><span class="s2">,</span>
            <span class="s3">'[0.+1.j]'</span><span class="s2">,    </span><span class="s3">'[0.+1.j]'</span><span class="s2">,    </span><span class="s3">'[0.+1.j]'</span><span class="s2">,</span>
            <span class="s3">'[0.-1.j]'</span><span class="s2">,    </span><span class="s3">'[0.-1.j]'</span><span class="s2">,    </span><span class="s3">'[0.-1.j]'</span><span class="s2">,</span>
            <span class="s3">'[0.+infj]'</span><span class="s2">,   </span><span class="s3">'[0.+infj]'</span><span class="s2">,   </span><span class="s3">'[0.+infj]'</span><span class="s2">,</span>
            <span class="s3">'[0.-infj]'</span><span class="s2">,   </span><span class="s3">'[0.-infj]'</span><span class="s2">,   </span><span class="s3">'[0.-infj]'</span><span class="s2">,</span>
            <span class="s3">'[0.+nanj]'</span><span class="s2">,   </span><span class="s3">'[0.+nanj]'</span><span class="s2">,   </span><span class="s3">'[0.+nanj]'</span><span class="s2">,</span>
            <span class="s3">'[1.+0.j]'</span><span class="s2">,    </span><span class="s3">'[1.+0.j]'</span><span class="s2">,    </span><span class="s3">'[1.+0.j]'</span><span class="s2">,</span>
            <span class="s3">'[1.+1.j]'</span><span class="s2">,    </span><span class="s3">'[1.+1.j]'</span><span class="s2">,    </span><span class="s3">'[1.+1.j]'</span><span class="s2">,</span>
            <span class="s3">'[1.-1.j]'</span><span class="s2">,    </span><span class="s3">'[1.-1.j]'</span><span class="s2">,    </span><span class="s3">'[1.-1.j]'</span><span class="s2">,</span>
            <span class="s3">'[1.+infj]'</span><span class="s2">,   </span><span class="s3">'[1.+infj]'</span><span class="s2">,   </span><span class="s3">'[1.+infj]'</span><span class="s2">,</span>
            <span class="s3">'[1.-infj]'</span><span class="s2">,   </span><span class="s3">'[1.-infj]'</span><span class="s2">,   </span><span class="s3">'[1.-infj]'</span><span class="s2">,</span>
            <span class="s3">'[1.+nanj]'</span><span class="s2">,   </span><span class="s3">'[1.+nanj]'</span><span class="s2">,   </span><span class="s3">'[1.+nanj]'</span><span class="s2">,</span>
            <span class="s3">'[-1.+0.j]'</span><span class="s2">,   </span><span class="s3">'[-1.+0.j]'</span><span class="s2">,   </span><span class="s3">'[-1.+0.j]'</span><span class="s2">,</span>
            <span class="s3">'[-1.+1.j]'</span><span class="s2">,   </span><span class="s3">'[-1.+1.j]'</span><span class="s2">,   </span><span class="s3">'[-1.+1.j]'</span><span class="s2">,</span>
            <span class="s3">'[-1.-1.j]'</span><span class="s2">,   </span><span class="s3">'[-1.-1.j]'</span><span class="s2">,   </span><span class="s3">'[-1.-1.j]'</span><span class="s2">,</span>
            <span class="s3">'[-1.+infj]'</span><span class="s2">,  </span><span class="s3">'[-1.+infj]'</span><span class="s2">,  </span><span class="s3">'[-1.+infj]'</span><span class="s2">,</span>
            <span class="s3">'[-1.-infj]'</span><span class="s2">,  </span><span class="s3">'[-1.-infj]'</span><span class="s2">,  </span><span class="s3">'[-1.-infj]'</span><span class="s2">,</span>
            <span class="s3">'[-1.+nanj]'</span><span class="s2">,  </span><span class="s3">'[-1.+nanj]'</span><span class="s2">,  </span><span class="s3">'[-1.+nanj]'</span><span class="s2">,</span>
            <span class="s3">'[inf+0.j]'</span><span class="s2">,   </span><span class="s3">'[inf+0.j]'</span><span class="s2">,   </span><span class="s3">'[inf+0.j]'</span><span class="s2">,</span>
            <span class="s3">'[inf+1.j]'</span><span class="s2">,   </span><span class="s3">'[inf+1.j]'</span><span class="s2">,   </span><span class="s3">'[inf+1.j]'</span><span class="s2">,</span>
            <span class="s3">'[inf-1.j]'</span><span class="s2">,   </span><span class="s3">'[inf-1.j]'</span><span class="s2">,   </span><span class="s3">'[inf-1.j]'</span><span class="s2">,</span>
            <span class="s3">'[inf+infj]'</span><span class="s2">,  </span><span class="s3">'[inf+infj]'</span><span class="s2">,  </span><span class="s3">'[inf+infj]'</span><span class="s2">,</span>
            <span class="s3">'[inf-infj]'</span><span class="s2">,  </span><span class="s3">'[inf-infj]'</span><span class="s2">,  </span><span class="s3">'[inf-infj]'</span><span class="s2">,</span>
            <span class="s3">'[inf+nanj]'</span><span class="s2">,  </span><span class="s3">'[inf+nanj]'</span><span class="s2">,  </span><span class="s3">'[inf+nanj]'</span><span class="s2">,</span>
            <span class="s3">'[-inf+0.j]'</span><span class="s2">,  </span><span class="s3">'[-inf+0.j]'</span><span class="s2">,  </span><span class="s3">'[-inf+0.j]'</span><span class="s2">,</span>
            <span class="s3">'[-inf+1.j]'</span><span class="s2">,  </span><span class="s3">'[-inf+1.j]'</span><span class="s2">,  </span><span class="s3">'[-inf+1.j]'</span><span class="s2">,</span>
            <span class="s3">'[-inf-1.j]'</span><span class="s2">,  </span><span class="s3">'[-inf-1.j]'</span><span class="s2">,  </span><span class="s3">'[-inf-1.j]'</span><span class="s2">,</span>
            <span class="s3">'[-inf+infj]'</span><span class="s2">, </span><span class="s3">'[-inf+infj]'</span><span class="s2">, </span><span class="s3">'[-inf+infj]'</span><span class="s2">,</span>
            <span class="s3">'[-inf-infj]'</span><span class="s2">, </span><span class="s3">'[-inf-infj]'</span><span class="s2">, </span><span class="s3">'[-inf-infj]'</span><span class="s2">,</span>
            <span class="s3">'[-inf+nanj]'</span><span class="s2">, </span><span class="s3">'[-inf+nanj]'</span><span class="s2">, </span><span class="s3">'[-inf+nanj]'</span><span class="s2">,</span>
            <span class="s3">'[nan+0.j]'</span><span class="s2">,   </span><span class="s3">'[nan+0.j]'</span><span class="s2">,   </span><span class="s3">'[nan+0.j]'</span><span class="s2">,</span>
            <span class="s3">'[nan+1.j]'</span><span class="s2">,   </span><span class="s3">'[nan+1.j]'</span><span class="s2">,   </span><span class="s3">'[nan+1.j]'</span><span class="s2">,</span>
            <span class="s3">'[nan-1.j]'</span><span class="s2">,   </span><span class="s3">'[nan-1.j]'</span><span class="s2">,   </span><span class="s3">'[nan-1.j]'</span><span class="s2">,</span>
            <span class="s3">'[nan+infj]'</span><span class="s2">,  </span><span class="s3">'[nan+infj]'</span><span class="s2">,  </span><span class="s3">'[nan+infj]'</span><span class="s2">,</span>
            <span class="s3">'[nan-infj]'</span><span class="s2">,  </span><span class="s3">'[nan-infj]'</span><span class="s2">,  </span><span class="s3">'[nan-infj]'</span><span class="s2">,</span>
            <span class="s3">'[nan+nanj]'</span><span class="s2">,  </span><span class="s3">'[nan+nanj]'</span><span class="s2">,  </span><span class="s3">'[nan+nanj]'</span><span class="s2">]</span>

        <span class="s0">for </span><span class="s1">res</span><span class="s2">, </span><span class="s1">val </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">wanted</span><span class="s2">):</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">val</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">TestArray2String</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Basic test of array2string.&quot;&quot;&quot;</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) == </span><span class="s3">'[0 1 2]'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">max_line_width</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">) == </span><span class="s3">'[0 1</span><span class="s0">\n </span><span class="s3">2]'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">max_line_width</span><span class="s2">=</span><span class="s5">4</span><span class="s2">) == </span><span class="s3">'[0</span><span class="s0">\n </span><span class="s3">1</span><span class="s0">\n </span><span class="s3">2]'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_unexpected_kwarg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># ensure than an appropriate TypeError</span>
        <span class="s4"># is raised when array2string receives</span>
        <span class="s4"># an unexpected kwarg</span>

        <span class="s0">with </span><span class="s1">assert_raises_regex</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s3">'nonsense'</span><span class="s2">):</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]),</span>
                            <span class="s1">nonsense</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_format_function</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Test custom format function for each element in array.&quot;&quot;&quot;</span>
        <span class="s0">def </span><span class="s1">_format_function</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) &lt; </span><span class="s5">1</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s3">'.'</span>
            <span class="s0">elif </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) &lt; </span><span class="s5">2</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s3">'o'</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s3">'O'</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">x_hex </span><span class="s2">= </span><span class="s3">&quot;[0x0 0x1 0x2]&quot;</span>
        <span class="s1">x_oct </span><span class="s2">= </span><span class="s3">&quot;[0o0 0o1 0o2]&quot;</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'all'</span><span class="s2">:</span><span class="s1">_format_function</span><span class="s2">}) ==</span>
                <span class="s3">&quot;[. o O]&quot;</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'int_kind'</span><span class="s2">:</span><span class="s1">_format_function</span><span class="s2">}) ==</span>
                <span class="s3">&quot;[. o O]&quot;</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'all'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;%.4f&quot; </span><span class="s2">% </span><span class="s1">x</span><span class="s2">}) ==</span>
                <span class="s3">&quot;[0.0000 1.0000 2.0000]&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'int'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">hex</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)}),</span>
                <span class="s1">x_hex</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'int'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">oct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)}),</span>
                <span class="s1">x_oct</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3.</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'float_kind'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;%.2f&quot; </span><span class="s2">% </span><span class="s1">x</span><span class="s2">}) ==</span>
                <span class="s3">&quot;[0.00 1.00 2.00]&quot;</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'float'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;%.2f&quot; </span><span class="s2">% </span><span class="s1">x</span><span class="s2">}) ==</span>
                <span class="s3">&quot;[0.00 1.00 2.00]&quot;</span><span class="s2">)</span>

        <span class="s1">s </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">'abc'</span><span class="s2">, </span><span class="s3">'def'</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'numpystr'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">s</span><span class="s2">: </span><span class="s1">s</span><span class="s2">*</span><span class="s5">2</span><span class="s2">}) ==</span>
                <span class="s3">'[abcabc defdef]'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_structure_format_mixed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">([(</span><span class="s3">'name'</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">str_</span><span class="s2">, </span><span class="s5">16</span><span class="s2">), (</span><span class="s3">'grades'</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">,))])</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([(</span><span class="s3">'Sarah'</span><span class="s2">, (</span><span class="s5">8.0</span><span class="s2">, </span><span class="s5">7.0</span><span class="s2">)), (</span><span class="s3">'John'</span><span class="s2">, (</span><span class="s5">6.0</span><span class="s2">, </span><span class="s5">7.0</span><span class="s2">))], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dt</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
                <span class="s3">&quot;[('Sarah', [8., 7.]) ('John', [6., 7.])]&quot;</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s4"># for issue #5692</span>
            <span class="s1">A </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=[(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;M8[s]&quot;</span><span class="s2">)])</span>
            <span class="s1">A</span><span class="s2">[</span><span class="s5">5</span><span class="s2">:].</span><span class="s1">fill</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s3">'NaT'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span>
                <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">A</span><span class="s2">),</span>
                <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
                </span><span class="s3">[('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) 
                 ('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) ('NaT',) ('NaT',) 
                 ('NaT',) ('NaT',) ('NaT',)]&quot;&quot;&quot;</span><span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s0">finally</span><span class="s2">:</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s4"># same again, but with non-legacy behavior</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">A</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">[('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) 
             ('1970-01-01T00:00:00',) ('1970-01-01T00:00:00',) 
             ('1970-01-01T00:00:00',) (                'NaT',) 
             (                'NaT',) (                'NaT',) 
             (                'NaT',) (                'NaT',)]&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s4"># and again, with timedeltas</span>
        <span class="s1">A </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">123456</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=[(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;m8[s]&quot;</span><span class="s2">)])</span>
        <span class="s1">A</span><span class="s2">[</span><span class="s5">5</span><span class="s2">:].</span><span class="s1">fill</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s3">'NaT'</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">A</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">[(123456,) (123456,) (123456,) (123456,) (123456,) ( 'NaT',) ( 'NaT',) 
             ( 'NaT',) ( 'NaT',) ( 'NaT',)]&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_structure_format_int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># See #8160</span>
        <span class="s1">struct_int </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([([</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],), ([</span><span class="s5">123</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],)],</span>
                <span class="s1">dtype</span><span class="s2">=[(</span><span class="s3">'B'</span><span class="s2">, </span><span class="s3">'i4'</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">struct_int</span><span class="s2">),</span>
                <span class="s3">&quot;[([  1,  -1],) ([123,   1],)]&quot;</span><span class="s2">)</span>
        <span class="s1">struct_2dint </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]],), ([[</span><span class="s5">12</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]],)],</span>
                <span class="s1">dtype</span><span class="s2">=[(</span><span class="s3">'B'</span><span class="s2">, </span><span class="s3">'i4'</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">struct_2dint</span><span class="s2">),</span>
                <span class="s3">&quot;[([[ 0,  1], [ 2,  3]],) ([[12,  0], [ 0,  0]],)]&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_structure_format_float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># See #8172</span>
        <span class="s1">array_scalar </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
                <span class="s2">(</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.1234567890123456789</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=(</span><span class="s3">'f8,f8,f8'</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">array_scalar</span><span class="s2">), </span><span class="s3">&quot;(1., 2.12345679, 3.)&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_unstructured_void_repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">27</span><span class="s2">, </span><span class="s5">91</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">75</span><span class="s2">,  </span><span class="s5">7</span><span class="s2">, </span><span class="s5">65</span><span class="s2">, </span><span class="s5">10</span><span class="s2">,  </span><span class="s5">8</span><span class="s2">,</span>
                      <span class="s5">27</span><span class="s2">, </span><span class="s5">91</span><span class="s2">, </span><span class="s5">51</span><span class="s2">, </span><span class="s5">49</span><span class="s2">,</span><span class="s5">109</span><span class="s2">, </span><span class="s5">82</span><span class="s2">,</span><span class="s5">101</span><span class="s2">,</span><span class="s5">100</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">'u1'</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s3">'V8'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]),</span>
            <span class="s3">r&quot;np.void(b'\x1B\x5B\x32\x4B\x07\x41\x0A\x08')&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]), </span><span class="s3">r&quot;b'\x1B\x5B\x32\x4B\x07\x41\x0A\x08'&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s3">r&quot;array([b'\x1B\x5B\x32\x4B\x07\x41\x0A\x08',&quot; &quot;</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">r&quot;       b'\x1B\x5B\x33\x31\x6D\x52\x65\x64'], dtype='|V8')&quot;</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">eval</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">vars</span><span class="s2">(</span><span class="s1">np</span><span class="s2">)), </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">eval</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]), </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">np</span><span class="s2">=</span><span class="s1">np</span><span class="s2">)), </span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_edgeitems_kwarg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># previously the global print options would be taken over the kwarg</span>
        <span class="s1">arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s1">int</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">edgeitems</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">threshold</span><span class="s2">=</span><span class="s5">0</span><span class="s2">),</span>
            <span class="s3">&quot;[0 ... 0]&quot;</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_summarize_1d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">A </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">1001</span><span class="s2">)</span>
        <span class="s1">strA </span><span class="s2">= </span><span class="s3">'[   0    1    2 ...  998  999 1000]'</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">A</span><span class="s2">), </span><span class="s1">strA</span><span class="s2">)</span>

        <span class="s1">reprA </span><span class="s2">= </span><span class="s3">'array([   0,    1,    2, ...,  998,  999, 1000])'</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">A</span><span class="s2">), </span><span class="s1">reprA</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_summarize_2d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">A </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">1002</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">501</span><span class="s2">)</span>
        <span class="s1">strA </span><span class="s2">= </span><span class="s3">'[[   0    1    2 ...  498  499  500]</span><span class="s0">\n</span><span class="s3">' </span><span class="s1">\</span>
               <span class="s3">' [ 501  502  503 ...  999 1000 1001]]'</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">A</span><span class="s2">), </span><span class="s1">strA</span><span class="s2">)</span>

        <span class="s1">reprA </span><span class="s2">= </span><span class="s3">'array([[   0,    1,    2, ...,  498,  499,  500],</span><span class="s0">\n</span><span class="s3">' </span><span class="s1">\</span>
                <span class="s3">'       [ 501,  502,  503, ...,  999, 1000, 1001]])'</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">A</span><span class="s2">), </span><span class="s1">reprA</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_summarize_structure</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">A </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2002</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;&lt;i8&quot;</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1001</span><span class="s2">)</span>
             <span class="s2">.</span><span class="s1">view</span><span class="s2">([(</span><span class="s3">'i'</span><span class="s2">, </span><span class="s3">&quot;&lt;i8&quot;</span><span class="s2">, (</span><span class="s5">1001</span><span class="s2">,))]))</span>
        <span class="s1">strA </span><span class="s2">= (</span><span class="s3">&quot;[[([   0,    1,    2, ...,  998,  999, 1000],)]</span><span class="s0">\n</span><span class="s3">&quot;</span>
                <span class="s3">&quot; [([1001, 1002, 1003, ..., 1999, 2000, 2001],)]]&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">A</span><span class="s2">), </span><span class="s1">strA</span><span class="s2">)</span>

        <span class="s1">reprA </span><span class="s2">= (</span><span class="s3">&quot;array([[([   0,    1,    2, ...,  998,  999, 1000],)],</span><span class="s0">\n</span><span class="s3">&quot;</span>
                 <span class="s3">&quot;       [([1001, 1002, 1003, ..., 1999, 2000, 2001],)]],</span><span class="s0">\n</span><span class="s3">&quot;</span>
                 <span class="s3">&quot;      dtype=[('i', '&lt;i8', (1001,))])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">A</span><span class="s2">), </span><span class="s1">reprA</span><span class="s2">)</span>

        <span class="s1">B </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">2002</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;&gt;i8&quot;</span><span class="s2">).</span><span class="s1">view</span><span class="s2">([(</span><span class="s3">'i'</span><span class="s2">, </span><span class="s3">&quot;&gt;i8&quot;</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1001</span><span class="s2">))])</span>
        <span class="s1">strB </span><span class="s2">= </span><span class="s3">&quot;[([[1, 1, 1, ..., 1, 1, 1], [1, 1, 1, ..., 1, 1, 1]],)]&quot;</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">B</span><span class="s2">), </span><span class="s1">strB</span><span class="s2">)</span>

        <span class="s1">reprB </span><span class="s2">= (</span>
            <span class="s3">&quot;array([([[1, 1, 1, ..., 1, 1, 1], [1, 1, 1, ..., 1, 1, 1]],)],</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;      dtype=[('i', '&gt;i8', (2, 1001))])&quot;</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">B</span><span class="s2">), </span><span class="s1">reprB</span><span class="s2">)</span>

        <span class="s1">C </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">22</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;&lt;i8&quot;</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">)</span>
             <span class="s2">.</span><span class="s1">view</span><span class="s2">([(</span><span class="s3">'i1'</span><span class="s2">, </span><span class="s3">&quot;&lt;i8&quot;</span><span class="s2">), (</span><span class="s3">'i10'</span><span class="s2">, </span><span class="s3">&quot;&lt;i8&quot;</span><span class="s2">, (</span><span class="s5">10</span><span class="s2">,))]))</span>
        <span class="s1">strC </span><span class="s2">= </span><span class="s3">&quot;[[( 0, [ 1, ..., 10])]</span><span class="s0">\n </span><span class="s3">[(11, [12, ..., 21])]]&quot;</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">C</span><span class="s2">, </span><span class="s1">threshold</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">edgeitems</span><span class="s2">=</span><span class="s5">1</span><span class="s2">), </span><span class="s1">strC</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_linewidth</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">width</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">separator</span><span class="s2">=</span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">max_line_width</span><span class="s2">=</span><span class="s1">width</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">), </span><span class="s3">'[111111]'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">), </span><span class="s3">'[111111]'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">), </span><span class="s3">'[1111</span><span class="s0">\n</span><span class="s3">'</span>
                                                    <span class="s3">' 11]'</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s5">8</span><span class="s2">), </span><span class="s3">'[111111]'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s5">7</span><span class="s2">), </span><span class="s3">'[11111</span><span class="s0">\n</span><span class="s3">'</span>
                                     <span class="s3">' 1]'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s3">'[111</span><span class="s0">\n</span><span class="s3">'</span>
                                     <span class="s3">' 111]'</span><span class="s2">)</span>

        <span class="s1">b </span><span class="s2">= </span><span class="s1">a</span><span class="s2">[</span><span class="s0">None</span><span class="s2">,</span><span class="s0">None</span><span class="s2">,:]</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">), </span><span class="s3">'[[[111111]]]'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">b</span><span class="s2">,  </span><span class="s5">9</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">), </span><span class="s3">'[[[111111]]]'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">b</span><span class="s2">,  </span><span class="s5">8</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">), </span><span class="s3">'[[[11111</span><span class="s0">\n</span><span class="s3">'</span>
                                                     <span class="s3">'   1]]]'</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s5">12</span><span class="s2">), </span><span class="s3">'[[[111111]]]'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">b</span><span class="s2">,  </span><span class="s5">9</span><span class="s2">), </span><span class="s3">'[[[111</span><span class="s0">\n</span><span class="s3">'</span>
                                      <span class="s3">'   111]]]'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">make_str</span><span class="s2">(</span><span class="s1">b</span><span class="s2">,  </span><span class="s5">8</span><span class="s2">), </span><span class="s3">'[[[11</span><span class="s0">\n</span><span class="s3">'</span>
                                      <span class="s3">'   11</span><span class="s0">\n</span><span class="s3">'</span>
                                      <span class="s3">'   11]]]'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_wide_element</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">'xxxxx'</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">max_line_width</span><span class="s2">=</span><span class="s5">5</span><span class="s2">),</span>
            <span class="s3">&quot;['xxxxx']&quot;</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">max_line_width</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">),</span>
            <span class="s3">&quot;[ 'xxxxx']&quot;</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_multiline_repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">class </span><span class="s1">MultiLine</span><span class="s2">:</span>
            <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s3">&quot;Line 1</span><span class="s0">\n</span><span class="s3">Line 2&quot;</span>

        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s0">None</span><span class="s2">, </span><span class="s1">MultiLine</span><span class="s2">()], [</span><span class="s1">MultiLine</span><span class="s2">(), </span><span class="s0">None</span><span class="s2">]])</span>

        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s3">'[[None Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'       Line 2]</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">' [Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'  Line 2 None]]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">max_line_width</span><span class="s2">=</span><span class="s5">5</span><span class="s2">),</span>
            <span class="s3">'[[None</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'  Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'  Line 2]</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">' [Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'  Line 2</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'  None]]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s3">'array([[None, Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'              Line 2],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'       [Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        Line 2, None]], dtype=object)'</span>
        <span class="s2">)</span>

        <span class="s0">class </span><span class="s1">MultiLineLong</span><span class="s2">:</span>
            <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s3">&quot;Line 1</span><span class="s0">\n</span><span class="s3">LooooooooooongestLine2</span><span class="s0">\n</span><span class="s3">LongerLine 3&quot;</span>

        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s0">None</span><span class="s2">, </span><span class="s1">MultiLineLong</span><span class="s2">()], [</span><span class="s1">MultiLineLong</span><span class="s2">(), </span><span class="s0">None</span><span class="s2">]])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s3">'array([[None, Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'              LooooooooooongestLine2</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'              LongerLine 3          ],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'       [Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        LooooooooooongestLine2</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        LongerLine 3          , None]], dtype=object)'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array_repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s5">20</span><span class="s2">),</span>
            <span class="s3">'array([[None,</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        LooooooooooongestLine2</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        LongerLine 3          ],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'       [Line 1</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        LooooooooooongestLine2</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        LongerLine 3          ,</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'        None]],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'      dtype=object)'</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_nested_array_repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
        <span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">a</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">] = </span><span class="s0">None</span>
        <span class="s1">a</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s3">'array([[array([[1., 0.],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'               [0., 1.]]), array([[1., 0., 0.],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'                                  [0., 1., 0.],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'                                  [0., 0., 1.]])],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'       [None, array([[1.],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'                     [1.],</span><span class="s0">\n</span><span class="s3">'</span>
            <span class="s3">'                     [1.]])]], dtype=object)'</span>
        <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">given</span><span class="s2">(</span><span class="s1">hynp</span><span class="s2">.</span><span class="s1">from_dtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s3">&quot;U&quot;</span><span class="s2">)))</span>
    <span class="s0">def </span><span class="s1">test_any_text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">text</span><span class="s2">):</span>
        <span class="s4"># This test checks that, given any value that can be represented in an</span>
        <span class="s4"># array of dtype(&quot;U&quot;) (i.e. unicode string), ...</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">text</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">text</span><span class="s2">])</span>
        <span class="s4"># casting a list of them to an array does not e.g. truncate the value</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">text</span><span class="s2">)</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">text</span><span class="s2">.</span><span class="s1">item</span><span class="s2">()  </span><span class="s4"># use raw python strings for repr below</span>
        <span class="s4"># and that np.array2string puts a newline in the expected location</span>
        <span class="s1">expected_repr </span><span class="s2">= </span><span class="s3">&quot;[{0!r} {0!r}</span><span class="s0">\n </span><span class="s3">{0!r}]&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">text</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">max_line_width</span><span class="s2">=</span><span class="s1">len</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">text</span><span class="s2">)) * </span><span class="s5">2 </span><span class="s2">+ </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected_repr</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s0">not </span><span class="s1">HAS_REFCOUNT</span><span class="s2">, </span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Python lacks refcounts&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_refcount</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># make sure we do not hold references to the array due to a recursive</span>
        <span class="s4"># closure (gh-10620)</span>
        <span class="s1">gc</span><span class="s2">.</span><span class="s1">disable</span><span class="s2">()</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">r1 </span><span class="s2">= </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">getrefcount</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">r2 </span><span class="s2">= </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">getrefcount</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">gc</span><span class="s2">.</span><span class="s1">collect</span><span class="s2">()</span>
        <span class="s1">gc</span><span class="s2">.</span><span class="s1">enable</span><span class="s2">()</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">r1 </span><span class="s2">== </span><span class="s1">r2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_with_sign</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># mixed negative and positive value array</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'+'</span><span class="s2">),</span>
            <span class="s3">'[-2 +0 +3]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'-'</span><span class="s2">),</span>
            <span class="s3">'[-2  0  3]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">' '</span><span class="s2">),</span>
            <span class="s3">'[-2  0  3]'</span>
        <span class="s2">)</span>
        <span class="s4"># all non-negative array</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'+'</span><span class="s2">),</span>
            <span class="s3">'[+2 +0 +3]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'-'</span><span class="s2">),</span>
            <span class="s3">'[2 0 3]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">' '</span><span class="s2">),</span>
            <span class="s3">'[ 2  0  3]'</span>
        <span class="s2">)</span>
        <span class="s4"># all negative array</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'+'</span><span class="s2">),</span>
            <span class="s3">'[-2 -1 -3]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'-'</span><span class="s2">),</span>
            <span class="s3">'[-2 -1 -3]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">' '</span><span class="s2">),</span>
            <span class="s3">'[-2 -1 -3]'</span>
        <span class="s2">)</span>
        <span class="s4"># 2d array mixed negative and positive</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">10</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'+'</span><span class="s2">),</span>
            <span class="s3">'[[+10  -1  +1  +1]</span><span class="s0">\n </span><span class="s3">[+10 +10 +10 +10]]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'-'</span><span class="s2">),</span>
            <span class="s3">'[[10 -1  1  1]</span><span class="s0">\n </span><span class="s3">[10 10 10 10]]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">' '</span><span class="s2">),</span>
            <span class="s3">'[[10 -1  1  1]</span><span class="s0">\n </span><span class="s3">[10 10 10 10]]'</span>
        <span class="s2">)</span>
        <span class="s4"># 2d array all positive</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">10</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'+'</span><span class="s2">),</span>
            <span class="s3">'[[+10  +0  +1  +1]</span><span class="s0">\n </span><span class="s3">[+10 +10 +10 +10]]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'-'</span><span class="s2">),</span>
            <span class="s3">'[[10  0  1  1]</span><span class="s0">\n </span><span class="s3">[10 10 10 10]]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">' '</span><span class="s2">),</span>
            <span class="s3">'[[ 10   0   1   1]</span><span class="s0">\n </span><span class="s3">[ 10  10  10  10]]'</span>
        <span class="s2">)</span>
        <span class="s4"># 2d array all negative</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">10</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">10</span><span class="s2">, -</span><span class="s5">10</span><span class="s2">, -</span><span class="s5">10</span><span class="s2">, -</span><span class="s5">10</span><span class="s2">]])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'+'</span><span class="s2">),</span>
            <span class="s3">'[[-10  -1  -1  -1]</span><span class="s0">\n </span><span class="s3">[-10 -10 -10 -10]]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'-'</span><span class="s2">),</span>
            <span class="s3">'[[-10  -1  -1  -1]</span><span class="s0">\n </span><span class="s3">[-10 -10 -10 -10]]'</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">sign</span><span class="s2">=</span><span class="s3">' '</span><span class="s2">),</span>
            <span class="s3">'[[-10  -1  -1  -1]</span><span class="s0">\n </span><span class="s3">[-10 -10 -10 -10]]'</span>
        <span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestPrintOptions</span><span class="s2">:</span>
    <span class="s7">&quot;&quot;&quot;Test getting and setting global print options.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">oldopts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">teardown_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(**</span><span class="s1">self</span><span class="s2">.</span><span class="s1">oldopts</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.234567890</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([1.5       , 0.        , 1.23456789])&quot;</span><span class="s2">)</span>
        <span class="s1">ret </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([1.5   , 0.    , 1.2346])&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">ret </span><span class="s0">is None</span>

    <span class="s0">def </span><span class="s1">test_precision_zero</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">values</span><span class="s2">, </span><span class="s1">string </span><span class="s0">in </span><span class="s2">(</span>
                <span class="s2">([</span><span class="s5">0.</span><span class="s2">], </span><span class="s3">&quot;0.&quot;</span><span class="s2">), ([</span><span class="s5">.3</span><span class="s2">], </span><span class="s3">&quot;0.&quot;</span><span class="s2">), ([-</span><span class="s5">.3</span><span class="s2">], </span><span class="s3">&quot;-0.&quot;</span><span class="s2">), ([</span><span class="s5">.7</span><span class="s2">], </span><span class="s3">&quot;1.&quot;</span><span class="s2">),</span>
                <span class="s2">([</span><span class="s5">1.5</span><span class="s2">], </span><span class="s3">&quot;2.&quot;</span><span class="s2">), ([-</span><span class="s5">1.5</span><span class="s2">], </span><span class="s3">&quot;-2.&quot;</span><span class="s2">), ([-</span><span class="s5">15.34</span><span class="s2">], </span><span class="s3">&quot;-15.&quot;</span><span class="s2">),</span>
                <span class="s2">([</span><span class="s5">100.</span><span class="s2">], </span><span class="s3">&quot;100.&quot;</span><span class="s2">), ([</span><span class="s5">.2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">122.51</span><span class="s2">], </span><span class="s3">&quot;  0.,  -1., 123.&quot;</span><span class="s2">),</span>
                <span class="s2">([</span><span class="s5">0</span><span class="s2">], </span><span class="s3">&quot;0&quot;</span><span class="s2">), ([-</span><span class="s5">12</span><span class="s2">], </span><span class="s3">&quot;-12&quot;</span><span class="s2">), ([</span><span class="s1">complex</span><span class="s2">(</span><span class="s5">.3</span><span class="s2">, -</span><span class="s5">.7</span><span class="s2">)], </span><span class="s3">&quot;0.-1.j&quot;</span><span class="s2">)):</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">values</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([%s])&quot; </span><span class="s2">% </span><span class="s1">string</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_formatter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'all'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">-</span><span class="s5">1</span><span class="s2">)})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([-1, 0, 1])&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_formatter_reset</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'all'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">-</span><span class="s5">1</span><span class="s2">)})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([-1, 0, 1])&quot;</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'int'</span><span class="s2">:</span><span class="s0">None</span><span class="s2">})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([0, 1, 2])&quot;</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'all'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">-</span><span class="s5">1</span><span class="s2">)})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([-1, 0, 1])&quot;</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'all'</span><span class="s2">:</span><span class="s0">None</span><span class="s2">})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([0, 1, 2])&quot;</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'int'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">-</span><span class="s5">1</span><span class="s2">)})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([-1, 0, 1])&quot;</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'int_kind'</span><span class="s2">:</span><span class="s0">None</span><span class="s2">})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([0, 1, 2])&quot;</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3.</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'float'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">-</span><span class="s5">1</span><span class="s2">)})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([-1.0, 0.0, 1.0])&quot;</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'float_kind'</span><span class="s2">:</span><span class="s0">None</span><span class="s2">})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([0., 1., 2.])&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_override_repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">override_repr</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;FOO&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;FOO&quot;</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">override_repr</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([0, 1, 2])&quot;</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(</span><span class="s1">override_repr</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;BAR&quot;</span><span class="s2">):</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;BAR&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array([0, 1, 2])&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_0d_arrays</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s3">'caf'</span><span class="s2">, </span><span class="s3">'&lt;U4'</span><span class="s2">)), </span><span class="s3">'caf'</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s3">'caf'</span><span class="s2">, </span><span class="s3">'&lt;U4'</span><span class="s2">)),</span>
                     <span class="s3">&quot;array('caf', dtype='&lt;U4')&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s3">'test'</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">str_</span><span class="s2">)), </span><span class="s3">'test'</span><span class="s2">)</span>

        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=[(</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'&lt;i4'</span><span class="s2">, (</span><span class="s5">3</span><span class="s2">,))])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]), </span><span class="s3">'([0, 0, 0],)'</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s3">'2005-02-25'</span><span class="s2">)[...]),</span>
                     <span class="s3">&quot;array('2005-02-25', dtype='datetime64[D]')&quot;</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">timedelta64</span><span class="s2">(</span><span class="s3">'10'</span><span class="s2">, </span><span class="s3">'Y'</span><span class="s2">)[...]),</span>
                     <span class="s3">&quot;array(10, dtype='timedelta64[Y]')&quot;</span><span class="s2">)</span>

        <span class="s4"># repr of 0d arrays is affected by printoptions</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">={</span><span class="s3">'all'</span><span class="s2">:</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;test&quot;</span><span class="s2">})</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;array(test)&quot;</span><span class="s2">)</span>
        <span class="s4"># str is unaffected</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">&quot;1&quot;</span><span class="s2">)</span>

        <span class="s4"># check `style` arg raises</span>
        <span class="s1">assert_warns</span><span class="s2">(</span><span class="s1">DeprecationWarning</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">,</span>
                                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">), </span><span class="s1">style</span><span class="s2">=</span><span class="s1">repr</span><span class="s2">)</span>
        <span class="s4"># but not in legacy mode</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">), </span><span class="s1">style</span><span class="s2">=</span><span class="s1">repr</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>
        <span class="s4"># gh-10934 style was broken in legacy mode, check it works</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">), </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_float_spacing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, -</span><span class="s5">10.</span><span class="s2">])</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">100.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, -</span><span class="s5">1.</span><span class="s2">])</span>
        <span class="s1">w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">100.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">])</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'array([1., 2., 3.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s3">'array([  1.,   2., -10.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])), </span><span class="s3">'array(1.)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">])), </span><span class="s3">'array(-10.)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s3">'array([100.,   2.,  -1.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">w</span><span class="s2">), </span><span class="s3">'array([-100.,    2.,    1.])'</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">])), </span><span class="s3">'array([nan, inf])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">])), </span><span class="s3">'array([ nan, -inf])'</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">100000</span><span class="s2">, </span><span class="s5">1.1234</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">100000</span><span class="s2">, -</span><span class="s5">1.1234</span><span class="s2">])</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">1.1234</span><span class="s2">, -</span><span class="s5">1e120</span><span class="s2">])</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s3">'array([     inf, 1.00e+05, 1.12e+00])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s3">'array([      inf,  1.00e+05, -1.12e+00])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s3">'array([       inf,  1.12e+000, -1.00e+120])'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bool_spacing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">True</span><span class="s2">,  </span><span class="s0">True</span><span class="s2">])),</span>
                     <span class="s3">'array([ True,  True])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])),</span>
                     <span class="s3">'array([ True, False])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">True</span><span class="s2">])),</span>
                     <span class="s3">'array([ True])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)),</span>
                     <span class="s3">'array(True)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)),</span>
                     <span class="s3">'array(False)'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_sign_spacing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4.</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.234e9</span><span class="s2">])</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.0 </span><span class="s2">+ </span><span class="s5">1.0j</span><span class="s2">, </span><span class="s5">1.123456789 </span><span class="s2">+ </span><span class="s5">1.123456789j</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">'c16'</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s3">'array([0., 1., 2., 3.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)), </span><span class="s3">'array(1.)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s3">'array([1.234e+09])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.</span><span class="s2">])), </span><span class="s3">'array([0.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">c</span><span class="s2">),</span>
            <span class="s3">&quot;array([1.        +1.j        , 1.12345679+1.12345679j])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.</span><span class="s2">, -</span><span class="s5">0.</span><span class="s2">])), </span><span class="s3">'array([ 0., -0.])'</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">sign</span><span class="s2">=</span><span class="s3">' '</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s3">'array([ 0.,  1.,  2.,  3.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)), </span><span class="s3">'array( 1.)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s3">'array([ 1.234e+09])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">c</span><span class="s2">),</span>
            <span class="s3">&quot;array([ 1.        +1.j        ,  1.12345679+1.12345679j])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.</span><span class="s2">, -</span><span class="s5">0.</span><span class="s2">])), </span><span class="s3">'array([ 0., -0.])'</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">sign</span><span class="s2">=</span><span class="s3">'+'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s3">'array([+0., +1., +2., +3.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)), </span><span class="s3">'array(+1.)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s3">'array([+1.234e+09])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">c</span><span class="s2">),</span>
            <span class="s3">&quot;array([+1.        +1.j        , +1.12345679+1.12345679j])&quot;</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s3">'array([ 0.,  1.,  2.,  3.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">b</span><span class="s2">),  </span><span class="s3">'array([  1.23400000e+09])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(-</span><span class="s1">b</span><span class="s2">), </span><span class="s3">'array([ -1.23400000e+09])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)), </span><span class="s3">'array(1.0)'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.</span><span class="s2">])), </span><span class="s3">'array([ 0.])'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">c</span><span class="s2">),</span>
            <span class="s3">&quot;array([ 1.00000000+1.j        ,  1.12345679+1.12345679j])&quot;</span><span class="s2">)</span>
        <span class="s4"># gh-10383</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">10</span><span class="s2">])), </span><span class="s3">&quot;[ -1.  10.]&quot;</span><span class="s2">)</span>

        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">, </span><span class="s1">wrongarg</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_float_overflow_nowarn</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># make sure internal computations in FloatingFormat don't</span>
        <span class="s4"># warn about overflow</span>
        <span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1e4</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">'f2'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_sign_spacing_structured</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">'&lt;f,&lt;f'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s3">&quot;array([(1., 1.), (1., 1.)], dtype=[('f0', '&lt;f4'), ('f1', '&lt;f4')])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]),</span>
            <span class="s3">&quot;np.void((1.0, 1.0), dtype=[('f0', '&lt;f4'), ('f1', '&lt;f4')])&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_floatmode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.6104</span><span class="s2">, </span><span class="s5">0.922</span><span class="s2">, </span><span class="s5">0.457</span><span class="s2">, </span><span class="s5">0.0906</span><span class="s2">, </span><span class="s5">0.3733</span><span class="s2">, </span><span class="s5">0.007244</span><span class="s2">,</span>
                      <span class="s5">0.5933</span><span class="s2">, </span><span class="s5">0.947</span><span class="s2">, </span><span class="s5">0.2383</span><span class="s2">, </span><span class="s5">0.4226</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float16</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.2918820979355541</span><span class="s2">, </span><span class="s5">0.5064172631089138</span><span class="s2">,</span>
                      <span class="s5">0.2848750619642916</span><span class="s2">, </span><span class="s5">0.4342965294660567</span><span class="s2">,</span>
                      <span class="s5">0.7326538397312751</span><span class="s2">, </span><span class="s5">0.3459503329096204</span><span class="s2">,</span>
                      <span class="s5">0.0862072768214508</span><span class="s2">, </span><span class="s5">0.39112753029631175</span><span class="s2">],</span>
                      <span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float16</span><span class="s2">)/</span><span class="s5">10</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.0 </span><span class="s2">+ </span><span class="s5">1.0j</span><span class="s2">, </span><span class="s5">1.123456789 </span><span class="s2">+ </span><span class="s5">1.123456789j</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">'c16'</span><span class="s2">)</span>

        <span class="s4"># also make sure 1e23 is right (is between two fp numbers)</span>
        <span class="s1">w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">'1e{}'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">25</span><span class="s2">)], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s4"># note: we construct w from the strings `1eXX` instead of doing</span>
        <span class="s4"># `10.**arange(24)` because it turns out the two are not equivalent in</span>
        <span class="s4"># python. On some architectures `1e23 != 10.**23`.</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.234e1</span><span class="s2">, </span><span class="s5">1e2</span><span class="s2">, </span><span class="s5">1e123</span><span class="s2">])</span>

        <span class="s4"># unique mode</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">floatmode</span><span class="s2">=</span><span class="s3">'unique'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.6104  , 0.922   , 0.457   , 0.0906  , 0.3733  , 0.007244,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.5933  , 0.947   , 0.2383  , 0.4226  ], dtype=float16)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">y</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.2918820979355541 , 0.5064172631089138 , 0.2848750619642916 ,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.4342965294660567 , 0.7326538397312751 , 0.3459503329096204 ,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.0862072768214508 , 0.39112753029631175])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">z</span><span class="s2">),</span>
            <span class="s3">&quot;array([0. , 0.1, 0.2, 0.3, 0.4, 0.5], dtype=float16)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">w</span><span class="s2">),</span>
            <span class="s3">&quot;array([1.e+00, 1.e+01, 1.e+02, 1.e+03, 1.e+04, 1.e+05, 1.e+06, 1.e+07,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       1.e+08, 1.e+09, 1.e+10, 1.e+11, 1.e+12, 1.e+13, 1.e+14, 1.e+15,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       1.e+16, 1.e+17, 1.e+18, 1.e+19, 1.e+20, 1.e+21, 1.e+22, 1.e+23,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       1.e+24])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">), </span><span class="s3">&quot;array([1.234e+001, 1.000e+002, 1.000e+123])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">c</span><span class="s2">),</span>
            <span class="s3">&quot;array([1.         +1.j         , 1.123456789+1.123456789j])&quot;</span><span class="s2">)</span>

        <span class="s4"># maxprec mode, precision=8</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">floatmode</span><span class="s2">=</span><span class="s3">'maxprec'</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s5">8</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.6104  , 0.922   , 0.457   , 0.0906  , 0.3733  , 0.007244,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.5933  , 0.947   , 0.2383  , 0.4226  ], dtype=float16)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">y</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.2918821 , 0.50641726, 0.28487506, 0.43429653, 0.73265384,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.34595033, 0.08620728, 0.39112753])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">z</span><span class="s2">),</span>
            <span class="s3">&quot;array([0. , 0.1, 0.2, 0.3, 0.4, 0.5], dtype=float16)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">w</span><span class="s2">[::</span><span class="s5">5</span><span class="s2">]),</span>
            <span class="s3">&quot;array([1.e+00, 1.e+05, 1.e+10, 1.e+15, 1.e+20])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">), </span><span class="s3">&quot;array([1.234e+001, 1.000e+002, 1.000e+123])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">c</span><span class="s2">),</span>
            <span class="s3">&quot;array([1.        +1.j        , 1.12345679+1.12345679j])&quot;</span><span class="s2">)</span>

        <span class="s4"># fixed mode, precision=4</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">floatmode</span><span class="s2">=</span><span class="s3">'fixed'</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.6104, 0.9219, 0.4570, 0.0906, 0.3733, 0.0072, 0.5933, 0.9468,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.2383, 0.4226], dtype=float16)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">y</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.2919, 0.5064, 0.2849, 0.4343, 0.7327, 0.3460, 0.0862, 0.3911])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">z</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.0000, 0.1000, 0.2000, 0.3000, 0.3999, 0.5000], dtype=float16)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">w</span><span class="s2">[::</span><span class="s5">5</span><span class="s2">]),</span>
            <span class="s3">&quot;array([1.0000e+00, 1.0000e+05, 1.0000e+10, 1.0000e+15, 1.0000e+20])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">), </span><span class="s3">&quot;array([1.2340e+001, 1.0000e+002, 1.0000e+123])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)), </span><span class="s3">&quot;array([0.0000, 0.0000, 0.0000])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">c</span><span class="s2">),</span>
            <span class="s3">&quot;array([1.0000+1.0000j, 1.1235+1.1235j])&quot;</span><span class="s2">)</span>
        <span class="s4"># for larger precision, representation error becomes more apparent:</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">floatmode</span><span class="s2">=</span><span class="s3">'fixed'</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s5">8</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">z</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.00000000, 0.09997559, 0.19995117, 0.30004883, 0.39990234,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.50000000], dtype=float16)&quot;</span><span class="s2">)</span>

        <span class="s4"># maxprec_equal  mode, precision=8</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">floatmode</span><span class="s2">=</span><span class="s3">'maxprec_equal'</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s5">8</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.610352, 0.921875, 0.457031, 0.090576, 0.373291, 0.007244,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.593262, 0.946777, 0.238281, 0.422607], dtype=float16)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">y</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.29188210, 0.50641726, 0.28487506, 0.43429653, 0.73265384,</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;       0.34595033, 0.08620728, 0.39112753])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">z</span><span class="s2">),</span>
            <span class="s3">&quot;array([0.0, 0.1, 0.2, 0.3, 0.4, 0.5], dtype=float16)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">w</span><span class="s2">[::</span><span class="s5">5</span><span class="s2">]),</span>
            <span class="s3">&quot;array([1.e+00, 1.e+05, 1.e+10, 1.e+15, 1.e+20])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">), </span><span class="s3">&quot;array([1.234e+001, 1.000e+002, 1.000e+123])&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">c</span><span class="s2">),</span>
            <span class="s3">&quot;array([1.00000000+1.00000000j, 1.12345679+1.12345679j])&quot;</span><span class="s2">)</span>

        <span class="s4"># test unique special case (gh-18609)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">.</span><span class="s1">fromhex</span><span class="s2">(</span><span class="s3">'-1p-97'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array2string</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">floatmode</span><span class="s2">=</span><span class="s3">'unique'</span><span class="s2">)), </span><span class="s1">a</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_legacy_mode_scalars</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># in legacy mode, str of floats get truncated, and complex scalars</span>
        <span class="s4"># use * for non-finite imaginary part</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s5">1.123456789123456789</span><span class="s2">)), </span><span class="s3">'1.12345678912'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">))), </span><span class="s3">'(1+nan*j)'</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s5">1.123456789123456789</span><span class="s2">)),</span>
                     <span class="s3">'1.1234567891234568'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">(</span><span class="s1">complex</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">))), </span><span class="s3">'(1+nanj)'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_legacy_stray_comma</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10000</span><span class="s2">)), </span><span class="s3">'[   0    1    2 ..., 9997 9998 9999]'</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10000</span><span class="s2">)), </span><span class="s3">'[   0    1    2 ... 9997 9998 9999]'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dtype_linewidth_wrapping</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">75</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">20.</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">'f4'</span><span class="s2">)),</span>
            <span class="s3">&quot;array([10., 11., 12., 13., 14., 15., 16., 17., 18., 19.], dtype=float32)&quot;</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">,</span><span class="s5">23.</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">'f4'</span><span class="s2">)), </span><span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([10., 11., 12., 13., 14., 15., 16., 17., 18., 19., 20., 21., 22.], 
                  dtype=float32)&quot;&quot;&quot;</span><span class="s2">))</span>

        <span class="s1">styp </span><span class="s2">= </span><span class="s3">'&lt;U4'</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">styp</span><span class="s2">)),</span>
            <span class="s3">&quot;array(['1', '1', '1'], dtype='{}')&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">styp</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">12</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">styp</span><span class="s2">)), </span><span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array(['1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1'], 
                  dtype='{}')&quot;&quot;&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">styp</span><span class="s2">)))</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s3">'native'</span><span class="s2">],</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">'bool'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'uint8'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'uint16'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'uint32'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'uint64'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'int8'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'int16'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'int32'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'int64'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'float16'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'float32'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'float64'</span><span class="s2">,),</span>
            <span class="s2">(</span><span class="s3">'U1'</span><span class="s2">,),     </span><span class="s4"># 4-byte width string</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_dtype_endianness_repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">native</span><span class="s2">):</span>
        <span class="s7">''' 
        there was an issue where 
        repr(array([0], dtype='&lt;u2')) and repr(array([0], dtype='&gt;u2')) 
        both returned the same thing: 
        array([0], dtype=uint16) 
        even though their dtypes have different endianness. 
        '''</span>
        <span class="s1">native_dtype </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">native</span><span class="s2">)</span>
        <span class="s1">non_native_dtype </span><span class="s2">= </span><span class="s1">native_dtype</span><span class="s2">.</span><span class="s1">newbyteorder</span><span class="s2">()</span>
        <span class="s1">non_native_repr </span><span class="s2">= </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], </span><span class="s1">non_native_dtype</span><span class="s2">))</span>
        <span class="s1">native_repr </span><span class="s2">= </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], </span><span class="s1">native_dtype</span><span class="s2">))</span>
        <span class="s4"># preserve the sensible default of only showing dtype if nonstandard</span>
        <span class="s0">assert </span><span class="s2">(</span><span class="s3">'dtype' </span><span class="s0">in </span><span class="s1">native_repr</span><span class="s2">) ^ (</span><span class="s1">native_dtype </span><span class="s0">in </span><span class="s1">_typelessdata</span><span class="s2">),</span><span class="s1">\</span>
                <span class="s2">(</span><span class="s3">&quot;an array's repr should show dtype if and only if the type &quot;</span>
                 <span class="s3">'of the array is NOT one of the standard types '</span>
                 <span class="s3">'(e.g., int32, bool, float64).'</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">non_native_dtype</span><span class="s2">.</span><span class="s1">itemsize </span><span class="s2">&gt; </span><span class="s5">1</span><span class="s2">:</span>
            <span class="s4"># if the type is &gt;1 byte, the non-native endian version</span>
            <span class="s4"># must show endianness.</span>
            <span class="s0">assert </span><span class="s1">non_native_repr </span><span class="s2">!= </span><span class="s1">native_repr</span>
            <span class="s0">assert </span><span class="s3">f&quot;dtype='</span><span class="s0">{</span><span class="s1">non_native_dtype</span><span class="s2">.</span><span class="s1">byteorder</span><span class="s0">}</span><span class="s3">&quot; </span><span class="s0">in </span><span class="s1">non_native_repr</span>

    <span class="s0">def </span><span class="s1">test_linewidth_repr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s1">fill_value</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">17</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([2, 2, 2, 
                   2, 2, 2, 
                   2])&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">17</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([2, 2, 2, 
                   2, 2, 2, 2])&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">(</span><span class="s5">8</span><span class="s2">, </span><span class="s1">fill_value</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">18</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([2, 2, 2, 
                   2, 2, 2, 
                   2, 2])&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">18</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([2, 2, 2, 2, 
                   2, 2, 2, 2])&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_linewidth_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">(</span><span class="s5">18</span><span class="s2">, </span><span class="s1">fill_value</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">18</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">[2 2 2 2 2 2 2 2 
             2 2 2 2 2 2 2 2 
             2 2]&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">18</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">str</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">[2 2 2 2 2 2 2 2 2 
             2 2 2 2 2 2 2 2 2]&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_edgeitems</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">edgeitems</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">threshold</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">27</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([[[ 0, ...,  2], 
                    ..., 
                    [ 6, ...,  8]], 
 
                   ..., 
 
                   [[18, ..., 20], 
                    ..., 
                    [24, ..., 26]]])&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">b</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([[[[0.]], 
 
                    ..., 
 
                    [[0.]]], 
 
 
                   ..., 
 
 
                   [[[0.]], 
 
                    ..., 
 
                    [[0.]]]])&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s4"># 1.13 had extra trailing spaces, and was missing newlines</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([[[ 0, ...,  2], 
                    ...,  
                    [ 6, ...,  8]], 
 
                   ...,  
                   [[18, ..., 20], 
                    ...,  
                    [24, ..., 26]]])&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">b</span><span class="s2">),</span>
            <span class="s1">textwrap</span><span class="s2">.</span><span class="s1">dedent</span><span class="s2">(</span><span class="s3">&quot;&quot;&quot;</span><span class="s0">\ 
            </span><span class="s3">array([[[[ 0.]], 
 
                    ...,  
                    [[ 0.]]], 
 
 
                   ...,  
                   [[[ 0.]], 
 
                    ...,  
                    [[ 0.]]]])&quot;&quot;&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_edgeitems_structured</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">edgeitems</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">threshold</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">A </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">*</span><span class="s5">2</span><span class="s2">*</span><span class="s5">3</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;&lt;i8&quot;</span><span class="s2">).</span><span class="s1">view</span><span class="s2">([(</span><span class="s3">'i'</span><span class="s2">, </span><span class="s3">&quot;&lt;i8&quot;</span><span class="s2">, (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))])</span>
        <span class="s1">reprA </span><span class="s2">= (</span>
            <span class="s3">&quot;array([([[[ 0, ...,  2], [ 3, ...,  5]], ..., &quot;</span>
            <span class="s3">&quot;[[24, ..., 26], [27, ..., 29]]],)],</span><span class="s0">\n</span><span class="s3">&quot;</span>
            <span class="s3">&quot;      dtype=[('i', '&lt;i8', (5, 2, 3))])&quot;</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">A</span><span class="s2">), </span><span class="s1">reprA</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bad_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">, </span><span class="s1">threshold</span><span class="s2">=</span><span class="s1">float</span><span class="s2">(</span><span class="s3">'nan'</span><span class="s2">))</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">, </span><span class="s1">threshold</span><span class="s2">=</span><span class="s3">'1'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">, </span><span class="s1">threshold</span><span class="s2">=</span><span class="s6">b'1'</span><span class="s2">)</span>

        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s3">'1'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s5">1.5</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">test_unicode_object_array</span><span class="s2">():</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s3">&quot;array([''], dtype=object)&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">'</span><span class="s0">\xe9</span><span class="s3">'</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestContextManager</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_ctx_mgr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># test that context manager actually works</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s5">2</span><span class="s2">):</span>
            <span class="s1">s </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">2.0</span><span class="s2">]) / </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s3">'[0.67]'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ctx_mgr_restores</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># test that print options are actually restrored</span>
        <span class="s1">opts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s1">opts</span><span class="s2">[</span><span class="s3">'precision'</span><span class="s2">] - </span><span class="s5">1</span><span class="s2">,</span>
                             <span class="s1">linewidth</span><span class="s2">=</span><span class="s1">opts</span><span class="s2">[</span><span class="s3">'linewidth'</span><span class="s2">] - </span><span class="s5">4</span><span class="s2">):</span>
            <span class="s0">pass</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">(), </span><span class="s1">opts</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ctx_mgr_exceptions</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># test that print options are restored even if an exception is raised</span>
        <span class="s1">opts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(</span><span class="s1">precision</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">11</span><span class="s2">):</span>
                <span class="s0">raise </span><span class="s1">ValueError</span>
        <span class="s0">except </span><span class="s1">ValueError</span><span class="s2">:</span>
            <span class="s0">pass</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">(), </span><span class="s1">opts</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ctx_mgr_as_smth</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">opts </span><span class="s2">= {</span><span class="s3">&quot;precision&quot;</span><span class="s2">: </span><span class="s5">2</span><span class="s2">}</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(**</span><span class="s1">opts</span><span class="s2">) </span><span class="s0">as </span><span class="s1">ctx</span><span class="s2">:</span>
            <span class="s1">saved_opts </span><span class="s2">= </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">assert_equal</span><span class="s2">({</span><span class="s1">k</span><span class="s2">: </span><span class="s1">saved_opts</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">opts</span><span class="s2">}, </span><span class="s1">opts</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;dtype&quot;</span><span class="s2">, </span><span class="s3">&quot;bhilqpBHILQPefdgFDG&quot;</span><span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;value&quot;</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_scalar_repr_numbers</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
    <span class="s4"># Test NEP 51 scalar repr (and legacy option) for numeric types</span>
    <span class="s1">dtype </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">scalar </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)[()]</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">generic</span><span class="s2">)</span>

    <span class="s1">string </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">)</span>
    <span class="s1">repr_string </span><span class="s2">= </span><span class="s1">string</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">(</span><span class="s3">&quot;()&quot;</span><span class="s2">)  </span><span class="s4"># complex may have extra brackets</span>
    <span class="s1">representation </span><span class="s2">= </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">char </span><span class="s2">== </span><span class="s3">&quot;g&quot;</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">representation </span><span class="s2">== </span><span class="s3">f&quot;np.longdouble('</span><span class="s0">{</span><span class="s1">repr_string</span><span class="s0">}</span><span class="s3">')&quot;</span>
    <span class="s0">elif </span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">char </span><span class="s2">== </span><span class="s3">'G'</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">representation </span><span class="s2">== </span><span class="s3">f&quot;np.clongdouble('</span><span class="s0">{</span><span class="s1">repr_string</span><span class="s0">}</span><span class="s3">')&quot;</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">normalized_name </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">kind</span><span class="s0">}{</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">itemsize</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">).</span><span class="s1">type</span><span class="s2">.</span><span class="s1">__name__</span>
        <span class="s0">assert </span><span class="s1">representation </span><span class="s2">== </span><span class="s3">f&quot;np.</span><span class="s0">{</span><span class="s1">normalized_name</span><span class="s0">}</span><span class="s3">(</span><span class="s0">{</span><span class="s1">repr_string</span><span class="s0">}</span><span class="s3">)&quot;</span>

    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">&quot;1.25&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">) == </span><span class="s1">string</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;scalar, legacy_repr, representation&quot;</span><span class="s2">, [</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">True_</span><span class="s2">, </span><span class="s3">&quot;True&quot;</span><span class="s2">, </span><span class="s3">&quot;np.True_&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">bytes_</span><span class="s2">(</span><span class="s6">b'a'</span><span class="s2">), </span><span class="s3">&quot;b'a'&quot;</span><span class="s2">, </span><span class="s3">&quot;np.bytes_(b'a')&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">str_</span><span class="s2">(</span><span class="s3">'a'</span><span class="s2">), </span><span class="s3">&quot;'a'&quot;</span><span class="s2">, </span><span class="s3">&quot;np.str_('a')&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s3">&quot;2012&quot;</span><span class="s2">),</span>
            <span class="s3">&quot;numpy.datetime64('2012')&quot;</span><span class="s2">, </span><span class="s3">&quot;np.datetime64('2012')&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">timedelta64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">), </span><span class="s3">&quot;numpy.timedelta64(1)&quot;</span><span class="s2">, </span><span class="s3">&quot;np.timedelta64(1)&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">((</span><span class="s0">True</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;?,&lt;i8&quot;</span><span class="s2">),</span>
            <span class="s3">&quot;(True, 2)&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;np.void((True, 2), dtype=[('f0', '?'), ('f1', '&lt;i8')])&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;&lt;f8,&gt;f4&quot;</span><span class="s2">),</span>
            <span class="s3">&quot;(1., 2.)&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;np.void((1.0, 2.0), dtype=[('f0', '&lt;f8'), ('f1', '&gt;f4')])&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">(</span><span class="s6">b'a'</span><span class="s2">), </span><span class="s3">r&quot;void(b'\x61')&quot;</span><span class="s2">, </span><span class="s3">r&quot;np.void(b'\x61')&quot;</span><span class="s2">),</span>
    <span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_scalar_repr_special</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">, </span><span class="s1">legacy_repr</span><span class="s2">, </span><span class="s1">representation</span><span class="s2">):</span>
    <span class="s4"># Test NEP 51 scalar repr (and legacy option) for numeric types</span>
    <span class="s0">assert </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">) == </span><span class="s1">representation</span>

    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">&quot;1.25&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">) == </span><span class="s1">legacy_repr</span>

<span class="s0">def </span><span class="s1">test_scalar_void_float_str</span><span class="s2">():</span>
    <span class="s4"># Note that based on this currently we do not print the same as a tuple</span>
    <span class="s4"># would, since the tuple would include the repr() inside for floats, but</span>
    <span class="s4"># we do not do that.</span>
    <span class="s1">scalar </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">((</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=[(</span><span class="s3">'f0'</span><span class="s2">, </span><span class="s3">'&lt;f8'</span><span class="s2">), (</span><span class="s3">'f1'</span><span class="s2">, </span><span class="s3">'&gt;f4'</span><span class="s2">)])</span>
    <span class="s0">assert </span><span class="s1">str</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">) == </span><span class="s3">&quot;(1.0, 2.0)&quot;</span>

<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">IS_WASM</span><span class="s2">, </span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;wasm doesn't support asyncio&quot;</span><span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&lt; (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">11</span><span class="s2">),</span>
                    <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;asyncio.barrier was added in Python 3.11&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_printoptions_asyncio_safe</span><span class="s2">():</span>
    <span class="s1">asyncio </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;asyncio&quot;</span><span class="s2">)</span>

    <span class="s1">b </span><span class="s2">= </span><span class="s1">asyncio</span><span class="s2">.</span><span class="s1">Barrier</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s0">async def </span><span class="s1">legacy_113</span><span class="s2">():</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s5">12</span><span class="s2">)</span>
        <span class="s0">await </span><span class="s1">b</span><span class="s2">.</span><span class="s1">wait</span><span class="s2">()</span>
        <span class="s1">po </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'legacy'</span><span class="s2">] == </span><span class="s3">'1.13'</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'precision'</span><span class="s2">] == </span><span class="s5">12</span>
        <span class="s1">orig_linewidth </span><span class="s2">= </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'linewidth'</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">34</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.21'</span><span class="s2">):</span>
            <span class="s1">po </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'legacy'</span><span class="s2">] == </span><span class="s3">'1.21'</span>
            <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'precision'</span><span class="s2">] == </span><span class="s5">12</span>
            <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'linewidth'</span><span class="s2">] == </span><span class="s5">34</span>
        <span class="s1">po </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'linewidth'</span><span class="s2">] == </span><span class="s1">orig_linewidth</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'legacy'</span><span class="s2">] == </span><span class="s3">'1.13'</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'precision'</span><span class="s2">] == </span><span class="s5">12</span>

    <span class="s0">async def </span><span class="s1">legacy_125</span><span class="s2">():</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">set_printoptions</span><span class="s2">(</span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.25'</span><span class="s2">, </span><span class="s1">precision</span><span class="s2">=</span><span class="s5">7</span><span class="s2">)</span>
        <span class="s0">await </span><span class="s1">b</span><span class="s2">.</span><span class="s1">wait</span><span class="s2">()</span>
        <span class="s1">po </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'legacy'</span><span class="s2">] == </span><span class="s3">'1.25'</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'precision'</span><span class="s2">] == </span><span class="s5">7</span>
        <span class="s1">orig_linewidth </span><span class="s2">= </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'linewidth'</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">printoptions</span><span class="s2">(</span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">6</span><span class="s2">, </span><span class="s1">legacy</span><span class="s2">=</span><span class="s3">'1.13'</span><span class="s2">):</span>
            <span class="s1">po </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'legacy'</span><span class="s2">] == </span><span class="s3">'1.13'</span>
            <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'precision'</span><span class="s2">] == </span><span class="s5">7</span>
            <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'linewidth'</span><span class="s2">] == </span><span class="s5">6</span>
        <span class="s1">po </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">get_printoptions</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'linewidth'</span><span class="s2">] == </span><span class="s1">orig_linewidth</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'legacy'</span><span class="s2">] == </span><span class="s3">'1.25'</span>
        <span class="s0">assert </span><span class="s1">po</span><span class="s2">[</span><span class="s3">'precision'</span><span class="s2">] == </span><span class="s5">7</span>

    <span class="s0">async def </span><span class="s1">main</span><span class="s2">():</span>
        <span class="s0">await </span><span class="s1">asyncio</span><span class="s2">.</span><span class="s1">gather</span><span class="s2">(</span><span class="s1">legacy_125</span><span class="s2">(), </span><span class="s1">legacy_125</span><span class="s2">())</span>

    <span class="s1">loop </span><span class="s2">= </span><span class="s1">asyncio</span><span class="s2">.</span><span class="s1">new_event_loop</span><span class="s2">()</span>
    <span class="s1">asyncio</span><span class="s2">.</span><span class="s1">run</span><span class="s2">(</span><span class="s1">main</span><span class="s2">())</span>
    <span class="s1">loop</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">IS_WASM</span><span class="s2">, </span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;wasm doesn't support threads&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_multithreaded_array_printing</span><span class="s2">():</span>
    <span class="s4"># the dragon4 implementation uses a static scratch space for performance</span>
    <span class="s4"># reasons this test makes sure it is set up in a thread-safe manner</span>

    <span class="s1">run_threaded</span><span class="s2">(</span><span class="s1">TestPrintOptions</span><span class="s2">().</span><span class="s1">test_floatmode</span><span class="s2">, </span><span class="s5">500</span><span class="s2">)</span>
</pre>
</body>
</html>