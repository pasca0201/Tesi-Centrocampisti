<html>
<head>
<title>test_function_base.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_function_base.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>

<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">logspace</span><span class="s2">, </span><span class="s1">linspace</span><span class="s2">, </span><span class="s1">geomspace</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">array</span><span class="s2">, </span><span class="s1">arange</span><span class="s2">, </span><span class="s1">isnan</span><span class="s2">,</span>
    <span class="s1">ndarray</span><span class="s2">, </span><span class="s1">sqrt</span><span class="s2">, </span><span class="s1">nextafter</span><span class="s2">, </span><span class="s1">stack</span><span class="s2">, </span><span class="s1">errstate</span>
    <span class="s2">)</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">_core </span><span class="s0">import </span><span class="s1">sctypes</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">function_base </span><span class="s0">import </span><span class="s1">add_newdoc</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">assert_</span><span class="s2">, </span><span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_raises</span><span class="s2">, </span><span class="s1">assert_array_equal</span><span class="s2">, </span><span class="s1">assert_allclose</span><span class="s2">,</span>
    <span class="s1">IS_PYPY</span>
    <span class="s2">)</span>


<span class="s0">class </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s1">float</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">float</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__add__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">):</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">PhysicalQuantity</span><span class="s2">))</span>
        <span class="s0">return </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) + </span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">))</span>
    <span class="s1">__radd__ </span><span class="s2">= </span><span class="s1">__add__</span>

    <span class="s0">def </span><span class="s1">__sub__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">):</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">PhysicalQuantity</span><span class="s2">))</span>
        <span class="s0">return </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) - </span><span class="s1">float</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">__rsub__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">):</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">PhysicalQuantity</span><span class="s2">))</span>
        <span class="s0">return </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) - </span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">__mul__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) * </span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">))</span>
    <span class="s1">__rmul__ </span><span class="s2">= </span><span class="s1">__mul__</span>

    <span class="s0">def </span><span class="s1">__div__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) / </span><span class="s1">float</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">__rdiv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s1">float</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) / </span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">PhysicalQuantity2</span><span class="s2">(</span><span class="s1">ndarray</span><span class="s2">):</span>
    <span class="s1">__array_priority__ </span><span class="s2">= </span><span class="s3">10</span>


<span class="s0">class </span><span class="s1">TestLogspace</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) == </span><span class="s3">50</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">100</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s3">10 </span><span class="s2">** </span><span class="s3">6</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] &lt; </span><span class="s3">10 </span><span class="s2">** </span><span class="s3">6</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">7</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s3">1e3</span><span class="s2">, </span><span class="s3">1e4</span><span class="s2">, </span><span class="s3">1e5</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_start_stop_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.</span><span class="s2">])</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">6.</span><span class="s2">, </span><span class="s3">7.</span><span class="s2">])</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">6</span><span class="s2">)</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">([</span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">_start</span><span class="s2">, </span><span class="s1">_stop</span><span class="s2">, </span><span class="s3">6</span><span class="s2">)</span>
                    <span class="s0">for </span><span class="s1">_start</span><span class="s2">, </span><span class="s1">_stop </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">)], </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">)</span>
        <span class="s1">t3 </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">6</span><span class="s2">)</span>
        <span class="s1">t4 </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">([</span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">_start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">6</span><span class="s2">)</span>
                    <span class="s0">for </span><span class="s1">_start </span><span class="s0">in </span><span class="s1">start</span><span class="s2">], </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t3</span><span class="s2">, </span><span class="s1">t4</span><span class="s2">)</span>
        <span class="s1">t5 </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t5</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">.</span><span class="s1">T</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;axis&quot;</span><span class="s2">, [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_base_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">: </span><span class="s1">int</span><span class="s2">):</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s3">1</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s3">2</span>
        <span class="s1">num </span><span class="s2">= </span><span class="s3">6</span>
        <span class="s1">base </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">])</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s1">num</span><span class="s2">, </span><span class="s1">base</span><span class="s2">=</span><span class="s1">base</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s1">num</span><span class="s2">, </span><span class="s1">base</span><span class="s2">=</span><span class="s1">_base</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_base </span><span class="s0">in </span><span class="s1">base</span><span class="s2">],</span>
            <span class="s1">axis</span><span class="s2">=(</span><span class="s1">axis </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">) % </span><span class="s1">t1</span><span class="s2">.</span><span class="s1">ndim</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;axis&quot;</span><span class="s2">, [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_stop_base_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">: </span><span class="s1">int</span><span class="s2">):</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s3">1</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">])</span>
        <span class="s1">num </span><span class="s2">= </span><span class="s3">6</span>
        <span class="s1">base </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">])</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s1">num</span><span class="s2">, </span><span class="s1">base</span><span class="s2">=</span><span class="s1">base</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">_stop</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s1">num</span><span class="s2">, </span><span class="s1">base</span><span class="s2">=</span><span class="s1">_base</span><span class="s2">)</span>
             <span class="s0">for </span><span class="s1">_stop</span><span class="s2">, </span><span class="s1">_base </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">stop</span><span class="s2">, </span><span class="s1">base</span><span class="s2">)],</span>
            <span class="s1">axis</span><span class="s2">=(</span><span class="s1">axis </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">) % </span><span class="s1">t1</span><span class="s2">.</span><span class="s1">ndim</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'float32'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'float32'</span><span class="s2">))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'float64'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'float64'</span><span class="s2">))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'int32'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'int32'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_physical_quantities</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s3">5.0</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">), </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">5.0</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_subclass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s3">1</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">PhysicalQuantity2</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s3">7</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">PhysicalQuantity2</span><span class="s2">)</span>
        <span class="s1">ls </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">) </span><span class="s0">is </span><span class="s1">PhysicalQuantity2</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">7.0</span><span class="s2">))</span>
        <span class="s1">ls </span><span class="s2">= </span><span class="s1">logspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">) </span><span class="s0">is </span><span class="s1">PhysicalQuantity2</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">logspace</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">7.0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestGeomspace</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) == </span><span class="s3">50</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">100</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s3">10 </span><span class="s2">** </span><span class="s3">6</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] &lt; </span><span class="s3">10 </span><span class="s2">** </span><span class="s3">6</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">7</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">100</span><span class="s2">, </span><span class="s3">1e3</span><span class="s2">, </span><span class="s3">1e4</span><span class="s2">, </span><span class="s3">1e5</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">])</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">8</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">8</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">2</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">100</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">10</span><span class="s2">, -</span><span class="s3">100</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">100</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [-</span><span class="s3">100</span><span class="s2">, -</span><span class="s3">10</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_boundaries_match_start_and_stop_exactly</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># make sure that the boundaries of the returned array exactly</span>
        <span class="s5"># equal 'start' and 'stop' - this isn't obvious because</span>
        <span class="s5"># np.exp(np.log(x)) isn't necessarily exactly equal to x</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s3">0.3</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s3">20.3</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">start</span><span class="s2">)</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">start</span><span class="s2">)</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">start</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">], </span><span class="s1">stop</span><span class="s2">)</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">start</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_nan_interior</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">invalid</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">4</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], -</span><span class="s3">3.0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:-</span><span class="s3">1</span><span class="s2">]).</span><span class="s1">all</span><span class="s2">())</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">3</span><span class="s2">], </span><span class="s3">3.0</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">invalid</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], -</span><span class="s3">3.0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:]).</span><span class="s1">all</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Purely imaginary</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1j</span><span class="s2">, </span><span class="s3">16j</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">1j</span><span class="s2">, </span><span class="s3">2j</span><span class="s2">, </span><span class="s3">4j</span><span class="s2">, </span><span class="s3">8j</span><span class="s2">, </span><span class="s3">16j</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">real</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">4j</span><span class="s2">, -</span><span class="s3">324j</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [-</span><span class="s3">4j</span><span class="s2">, -</span><span class="s3">12j</span><span class="s2">, -</span><span class="s3">36j</span><span class="s2">, -</span><span class="s3">108j</span><span class="s2">, -</span><span class="s3">324j</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">real</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">+</span><span class="s3">1j</span><span class="s2">, </span><span class="s3">1000</span><span class="s2">+</span><span class="s3">1000j</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">1</span><span class="s2">+</span><span class="s3">1j</span><span class="s2">, </span><span class="s3">10</span><span class="s2">+</span><span class="s3">10j</span><span class="s2">, </span><span class="s3">100</span><span class="s2">+</span><span class="s3">100j</span><span class="s2">, </span><span class="s3">1000</span><span class="s2">+</span><span class="s3">1000j</span><span class="s2">])</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">+</span><span class="s3">1j</span><span class="s2">, -</span><span class="s3">1000</span><span class="s2">+</span><span class="s3">1000j</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [-</span><span class="s3">1</span><span class="s2">+</span><span class="s3">1j</span><span class="s2">, -</span><span class="s3">10</span><span class="s2">+</span><span class="s3">10j</span><span class="s2">, -</span><span class="s3">100</span><span class="s2">+</span><span class="s3">100j</span><span class="s2">, -</span><span class="s3">1000</span><span class="s2">+</span><span class="s3">1000j</span><span class="s2">])</span>

        <span class="s5"># Logarithmic spirals</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">complex</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1j</span><span class="s2">, +</span><span class="s3">1</span><span class="s2">])</span>

        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">+</span><span class="s3">3j</span><span class="s2">, -</span><span class="s3">3</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">, </span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">0</span><span class="s2">+</span><span class="s3">3j</span><span class="s2">, -</span><span class="s3">3</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2</span><span class="s2">)+</span><span class="s3">3j</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), -</span><span class="s3">3</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">+</span><span class="s3">3j</span><span class="s2">, </span><span class="s3">3</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">, </span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">0</span><span class="s2">+</span><span class="s3">3j</span><span class="s2">, </span><span class="s3">3</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2</span><span class="s2">)+</span><span class="s3">3j</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), </span><span class="s3">3</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">3</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">, </span><span class="s3">0</span><span class="s2">-</span><span class="s3">3j</span><span class="s2">, </span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [-</span><span class="s3">3</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">, -</span><span class="s3">3</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2</span><span class="s2">)-</span><span class="s3">3j</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), </span><span class="s3">0</span><span class="s2">-</span><span class="s3">3j</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">+</span><span class="s3">3j</span><span class="s2">, -</span><span class="s3">3</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">, </span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">0</span><span class="s2">+</span><span class="s3">3j</span><span class="s2">, -</span><span class="s3">3</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2</span><span class="s2">)+</span><span class="s3">3j</span><span class="s2">/</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), -</span><span class="s3">3</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">2</span><span class="s2">-</span><span class="s3">3j</span><span class="s2">, </span><span class="s3">5</span><span class="s2">+</span><span class="s3">7j</span><span class="s2">, </span><span class="s3">7</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [-</span><span class="s3">2</span><span class="s2">-</span><span class="s3">3j</span><span class="s2">, -</span><span class="s3">0.29058977</span><span class="s2">-</span><span class="s3">4.15771027j</span><span class="s2">,</span>
                            <span class="s3">2.08885354</span><span class="s2">-</span><span class="s3">4.34146838j</span><span class="s2">, </span><span class="s3">4.58345529</span><span class="s2">-</span><span class="s3">3.16355218j</span><span class="s2">,</span>
                            <span class="s3">6.41401745</span><span class="s2">-</span><span class="s3">0.55233457j</span><span class="s2">, </span><span class="s3">6.75707386</span><span class="s2">+</span><span class="s3">3.11795092j</span><span class="s2">,</span>
                            <span class="s3">5</span><span class="s2">+</span><span class="s3">7j</span><span class="s2">])</span>

        <span class="s5"># Type promotion should prevent the -5 from becoming a NaN</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">3j</span><span class="s2">, -</span><span class="s3">5</span><span class="s2">, </span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s3">3j</span><span class="s2">, -</span><span class="s3">5</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">3j</span><span class="s2">, </span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">3j</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_complex_shortest_path</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># test the shortest logarithmic spiral is used, see gh-25644</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s3">1.2 </span><span class="s2">+ </span><span class="s3">3.4j</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s3">1j</span><span class="s2">*(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">-</span><span class="s3">.1</span><span class="s2">)) * </span><span class="s1">x</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">1.2 </span><span class="s2">+ </span><span class="s3">3.4j</span><span class="s2">, -</span><span class="s3">1.47384 </span><span class="s2">+ </span><span class="s3">3.2905616j</span><span class="s2">,</span>
                        <span class="s2">-</span><span class="s3">3.33577588 </span><span class="s2">+ </span><span class="s3">1.36842949j</span><span class="s2">, -</span><span class="s3">3.36011056 </span><span class="s2">- </span><span class="s3">1.30753855j</span><span class="s2">,</span>
                        <span class="s2">-</span><span class="s3">1.53343861 </span><span class="s2">- </span><span class="s3">3.26321406j</span><span class="s2">])</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


    <span class="s0">def </span><span class="s1">test_dtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'float32'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'float32'</span><span class="s2">))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'float64'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'float64'</span><span class="s2">))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'int32'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'int32'</span><span class="s2">))</span>

        <span class="s5"># Native types</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">float</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'float64'</span><span class="s2">))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1e6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">complex</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'complex128'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_start_stop_array_scalar</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lim1 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">120</span><span class="s2">, </span><span class="s3">100</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int8&quot;</span><span class="s2">)</span>
        <span class="s1">lim2 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([-</span><span class="s3">120</span><span class="s2">, -</span><span class="s3">100</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int8&quot;</span><span class="s2">)</span>
        <span class="s1">lim3 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1200</span><span class="s2">, </span><span class="s3">1000</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;uint16&quot;</span><span class="s2">)</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">lim1</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">lim1</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">lim2</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">lim2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t3 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">lim3</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">lim3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t4 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">120.0</span><span class="s2">, </span><span class="s3">100.0</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t5 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(-</span><span class="s3">120.0</span><span class="s2">, -</span><span class="s3">100.0</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t6 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1200.0</span><span class="s2">, </span><span class="s3">1000.0</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>

        <span class="s5"># t3 uses float32, t6 uses float64</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">, </span><span class="s1">t4</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s3">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">t2</span><span class="s2">, </span><span class="s1">t5</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s3">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">t3</span><span class="s2">, </span><span class="s1">t6</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s3">1e-5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_start_stop_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Try to use all special cases.</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1.e0</span><span class="s2">, </span><span class="s3">32.</span><span class="s2">, </span><span class="s3">1j</span><span class="s2">, -</span><span class="s3">4j</span><span class="s2">, </span><span class="s3">1</span><span class="s2">+</span><span class="s3">1j</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1.e4</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">, </span><span class="s3">16j</span><span class="s2">, -</span><span class="s3">324j</span><span class="s2">, </span><span class="s3">10000</span><span class="s2">+</span><span class="s3">10000j</span><span class="s2">, </span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">([</span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">_start</span><span class="s2">, </span><span class="s1">_stop</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
                    <span class="s0">for </span><span class="s1">_start</span><span class="s2">, </span><span class="s1">_stop </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">)], </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">)</span>
        <span class="s1">t3 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t4 </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">([</span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">_start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
                    <span class="s0">for </span><span class="s1">_start </span><span class="s0">in </span><span class="s1">start</span><span class="s2">], </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t3</span><span class="s2">, </span><span class="s1">t4</span><span class="s2">)</span>
        <span class="s1">t5 </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t5</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">.</span><span class="s1">T</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_physical_quantities</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s3">5.0</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">), </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">5.0</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_subclass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s3">1</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">PhysicalQuantity2</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s3">7</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">PhysicalQuantity2</span><span class="s2">)</span>
        <span class="s1">gs </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">) </span><span class="s0">is </span><span class="s1">PhysicalQuantity2</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">, </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">7.0</span><span class="s2">))</span>
        <span class="s1">gs </span><span class="s2">= </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">) </span><span class="s0">is </span><span class="s1">PhysicalQuantity2</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">, </span><span class="s1">geomspace</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">7.0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_bounds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">geomspace</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">geomspace</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">geomspace</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLinspace</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) == </span><span class="s3">50</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">100</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s3">10</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] &lt; </span><span class="s3">10</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">linspace</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_corner</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y </span><span class="s2">== [</span><span class="s3">0.0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">linspace</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">2.5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">).</span><span class="s1">dtype</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">).</span><span class="s1">dtype</span>
        <span class="s1">t3 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">).</span><span class="s1">dtype</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t2</span><span class="s2">, </span><span class="s1">t3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'float32'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'float32'</span><span class="s2">))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'float64'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'float64'</span><span class="s2">))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">6</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'int32'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">'int32'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_start_stop_array_scalar</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lim1 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([-</span><span class="s3">120</span><span class="s2">, </span><span class="s3">100</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int8&quot;</span><span class="s2">)</span>
        <span class="s1">lim2 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">120</span><span class="s2">, -</span><span class="s3">100</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int8&quot;</span><span class="s2">)</span>
        <span class="s1">lim3 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1200</span><span class="s2">, </span><span class="s3">1000</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;uint16&quot;</span><span class="s2">)</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">lim1</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">lim1</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">lim2</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">lim2</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t3 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">lim3</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">lim3</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t4 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">120.0</span><span class="s2">, </span><span class="s3">100.0</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t5 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">120.0</span><span class="s2">, -</span><span class="s3">100.0</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t6 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">1200.0</span><span class="s2">, </span><span class="s3">1000.0</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">, </span><span class="s1">t4</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t2</span><span class="s2">, </span><span class="s1">t5</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t3</span><span class="s2">, </span><span class="s1">t6</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_start_stop_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([-</span><span class="s3">120</span><span class="s2">, </span><span class="s3">120</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int8&quot;</span><span class="s2">)</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">100</span><span class="s2">, -</span><span class="s3">100</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int8&quot;</span><span class="s2">)</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">([</span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">_start</span><span class="s2">, </span><span class="s1">_stop</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
                    <span class="s0">for </span><span class="s1">_start</span><span class="s2">, </span><span class="s1">_stop </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">)], </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">)</span>
        <span class="s1">t3 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t4 </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">([</span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">_start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">5</span><span class="s2">)</span>
                    <span class="s0">for </span><span class="s1">_start </span><span class="s0">in </span><span class="s1">start</span><span class="s2">], </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t3</span><span class="s2">, </span><span class="s1">t4</span><span class="s2">)</span>
        <span class="s1">t5 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=-</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">t5</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">.</span><span class="s1">T</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lim1 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">1 </span><span class="s2">+ </span><span class="s3">2j</span><span class="s2">, </span><span class="s3">3 </span><span class="s2">+ </span><span class="s3">4j</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t1 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1.0</span><span class="s2">+</span><span class="s3">2.j</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">+</span><span class="s3">2.5j</span><span class="s2">,  </span><span class="s3">2.0</span><span class="s2">+</span><span class="s3">3j</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">+</span><span class="s3">3.5j</span><span class="s2">, </span><span class="s3">3.0</span><span class="s2">+</span><span class="s3">4j</span><span class="s2">])</span>
        <span class="s1">lim2 </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">1j</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
        <span class="s1">t2 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">0.0</span><span class="s2">+</span><span class="s3">1.j</span><span class="s2">, </span><span class="s3">2.5</span><span class="s2">+</span><span class="s3">0.75j</span><span class="s2">, </span><span class="s3">5.0</span><span class="s2">+</span><span class="s3">0.5j</span><span class="s2">, </span><span class="s3">7.5</span><span class="s2">+</span><span class="s3">0.25j</span><span class="s2">, </span><span class="s3">10.0</span><span class="s2">+</span><span class="s3">0j</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">lim1</span><span class="s2">, </span><span class="s1">t1</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">lim2</span><span class="s2">, </span><span class="s1">t2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_physical_quantities</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">PhysicalQuantity</span><span class="s2">(</span><span class="s3">1.0</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">), </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_subclass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s3">0</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">PhysicalQuantity2</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s3">1</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s1">PhysicalQuantity2</span><span class="s2">)</span>
        <span class="s1">ls </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">) </span><span class="s0">is </span><span class="s1">PhysicalQuantity2</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">))</span>
        <span class="s1">ls </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">) </span><span class="s0">is </span><span class="s1">PhysicalQuantity2</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_array_interface</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Regression test for https://github.com/numpy/numpy/pull/6659</span>
        <span class="s5"># Ensure that start/stop can be objects that implement</span>
        <span class="s5"># __array_interface__ and are convertible to numeric scalars</span>

        <span class="s0">class </span><span class="s1">Arrayish</span><span class="s2">:</span>
            <span class="s6">&quot;&quot;&quot; 
            A generic object that supports the __array_interface__ and hence 
            can in principle be converted to a numeric scalar, but is not 
            otherwise recognized as numeric, but also happens to support 
            multiplication by floats. 
 
            Data should be an object that implements the buffer interface, 
            and contains at least 4 bytes. 
            &quot;&quot;&quot;</span>

            <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">data</span><span class="s2">):</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_data </span><span class="s2">= </span><span class="s1">data</span>

            <span class="s2">@</span><span class="s1">property</span>
            <span class="s0">def </span><span class="s1">__array_interface__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s2">{</span><span class="s4">'shape'</span><span class="s2">: (), </span><span class="s4">'typestr'</span><span class="s2">: </span><span class="s4">'&lt;i4'</span><span class="s2">, </span><span class="s4">'data'</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">,</span>
                        <span class="s4">'version'</span><span class="s2">: </span><span class="s3">3</span><span class="s2">}</span>

            <span class="s0">def </span><span class="s1">__mul__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
                <span class="s5"># For the purposes of this test any multiplication is an</span>
                <span class="s5"># identity operation :)</span>
                <span class="s0">return </span><span class="s1">self</span>

        <span class="s1">one </span><span class="s2">= </span><span class="s1">Arrayish</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'&lt;i4'</span><span class="s2">))</span>
        <span class="s1">five </span><span class="s2">= </span><span class="s1">Arrayish</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'&lt;i4'</span><span class="s2">))</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">one</span><span class="s2">, </span><span class="s1">five</span><span class="s2">), </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_denormal_numbers</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Regression test for gh-5437. Will probably fail when compiled</span>
        <span class="s5"># with ICC, which flushes denormals to zero</span>
        <span class="s0">for </span><span class="s1">ftype </span><span class="s0">in </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'float'</span><span class="s2">]:</span>
            <span class="s1">stop </span><span class="s2">= </span><span class="s1">nextafter</span><span class="s2">(</span><span class="s1">ftype</span><span class="s2">(</span><span class="s3">0</span><span class="s2">), </span><span class="s1">ftype</span><span class="s2">(</span><span class="s3">1</span><span class="s2">)) * </span><span class="s3">5  </span><span class="s5"># A denormal number</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">any</span><span class="s2">(</span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">ftype</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_equivalent_to_arange</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s3">1000</span><span class="s2">):</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">j</span><span class="s2">+</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">int</span><span class="s2">),</span>
                         <span class="s1">arange</span><span class="s2">(</span><span class="s1">j</span><span class="s2">+</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">int</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_retstep</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">num </span><span class="s0">in </span><span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">ept </span><span class="s0">in </span><span class="s2">[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]:</span>
                <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">num</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s1">ept</span><span class="s2">, </span><span class="s1">retstep</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
                <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">) </span><span class="s0">and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) == </span><span class="s3">2</span>
                <span class="s0">if </span><span class="s1">num </span><span class="s2">== </span><span class="s3">2</span><span class="s2">:</span>
                    <span class="s1">y0_expect </span><span class="s2">= [</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">] </span><span class="s0">if </span><span class="s1">ept </span><span class="s0">else </span><span class="s2">[</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">]</span>
                    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">y0_expect</span><span class="s2">)</span>
                    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s1">y0_expect</span><span class="s2">[</span><span class="s3">1</span><span class="s2">])</span>
                <span class="s0">elif </span><span class="s1">num </span><span class="s2">== </span><span class="s3">1 </span><span class="s0">and not </span><span class="s1">ept</span><span class="s2">:</span>
                    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], [</span><span class="s3">0.0</span><span class="s2">])</span>
                    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">1.0</span><span class="s2">)</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], [</span><span class="s3">0.0</span><span class="s2">][:</span><span class="s1">num</span><span class="s2">])</span>
                    <span class="s0">assert </span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s3">1</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'O'</span><span class="s2">)</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'O'</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([</span><span class="s3">1.</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">2.</span><span class="s2">]))</span>
                    
    <span class="s0">def </span><span class="s1">test_round_negative</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s3">8</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">int</span><span class="s2">)</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">int</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">t</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_any_step_zero_and_not_mult_inplace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># any_step_zero is True, _mult_inplace is False</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">])</span>
        <span class="s1">stop </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">2.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">, </span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([[</span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">], [</span><span class="s3">1.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">], [</span><span class="s3">2.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s2">]]))</span>
    

<span class="s0">class </span><span class="s1">TestAdd_newdoc</span><span class="s2">:</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">flags</span><span class="s2">.</span><span class="s1">optimize </span><span class="s2">== </span><span class="s3">2</span><span class="s2">, </span><span class="s1">reason</span><span class="s2">=</span><span class="s4">&quot;Python running -OO&quot;</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">IS_PYPY</span><span class="s2">, </span><span class="s1">reason</span><span class="s2">=</span><span class="s4">&quot;PyPy does not modify tp_doc&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_add_doc</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># test that np.add_newdoc did attach a docstring successfully:</span>
        <span class="s1">tgt </span><span class="s2">= </span><span class="s4">&quot;Current flat index into the array.&quot;</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">flatiter</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">[:</span><span class="s1">len</span><span class="s2">(</span><span class="s1">tgt</span><span class="s2">)], </span><span class="s1">tgt</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">ufunc</span><span class="s2">.</span><span class="s1">identity</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">) &gt; </span><span class="s3">300</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">lib</span><span class="s2">.</span><span class="s1">_index_tricks_impl</span><span class="s2">.</span><span class="s1">mgrid</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">) &gt; </span><span class="s3">300</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">flags</span><span class="s2">.</span><span class="s1">optimize </span><span class="s2">== </span><span class="s3">2</span><span class="s2">, </span><span class="s1">reason</span><span class="s2">=</span><span class="s4">&quot;Python running -OO&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_errors_are_ignored</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">prev_doc </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">flatiter</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">__doc__</span>
        <span class="s5"># nothing changed, but error ignored, this should probably</span>
        <span class="s5"># give a warning (or even error) in the future.</span>
        <span class="s1">add_newdoc</span><span class="s2">(</span><span class="s4">&quot;numpy._core&quot;</span><span class="s2">, </span><span class="s4">&quot;flatiter&quot;</span><span class="s2">, (</span><span class="s4">&quot;index&quot;</span><span class="s2">, </span><span class="s4">&quot;bad docstring&quot;</span><span class="s2">))</span>
        <span class="s0">assert </span><span class="s1">prev_doc </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">flatiter</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">__doc__</span>
</pre>
</body>
</html>