<html>
<head>
<title>test_inference.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_inference.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">datetime</span><span class="s2">,</span>
    <span class="s1">timedelta</span><span class="s2">,</span>
<span class="s2">)</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs</span><span class="s2">.</span><span class="s1">ccalendar </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DAYS</span><span class="s2">,</span>
    <span class="s1">MONTHS</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs</span><span class="s2">.</span><span class="s1">offsets </span><span class="s0">import </span><span class="s1">_get_offset</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs</span><span class="s2">.</span><span class="s1">period </span><span class="s0">import </span><span class="s1">INVALID_FREQ_ERR_MSG</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">compat </span><span class="s0">import </span><span class="s1">is_platform_windows</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DatetimeIndex</span><span class="s2">,</span>
    <span class="s1">Index</span><span class="s2">,</span>
    <span class="s1">RangeIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
    <span class="s1">date_range</span><span class="s2">,</span>
    <span class="s1">period_range</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">arrays </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DatetimeArray</span><span class="s2">,</span>
    <span class="s1">TimedeltaArray</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">tools</span><span class="s2">.</span><span class="s1">datetimes </span><span class="s0">import </span><span class="s1">to_datetime</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">tseries </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">frequencies</span><span class="s2">,</span>
    <span class="s1">offsets</span><span class="s2">,</span>
<span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span>
    <span class="s1">params</span><span class="s2">=[</span>
        <span class="s2">(</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s3">1</span><span class="s2">), </span><span class="s4">&quot;D&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s3">1</span><span class="s2">), </span><span class="s4">&quot;h&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s3">1</span><span class="s2">), </span><span class="s4">&quot;min&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s3">1</span><span class="s2">), </span><span class="s4">&quot;s&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">timedelta64</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s4">&quot;ns&quot;</span><span class="s2">), </span><span class="s4">&quot;ns&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">microseconds</span><span class="s2">=</span><span class="s3">1</span><span class="s2">), </span><span class="s4">&quot;us&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">microseconds</span><span class="s2">=</span><span class="s3">1000</span><span class="s2">), </span><span class="s4">&quot;ms&quot;</span><span class="s2">),</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">base_delta_code_pair</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>


<span class="s1">freqs </span><span class="s2">= (</span>
    <span class="s2">[</span><span class="s4">f&quot;QE-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">for </span><span class="s1">month </span><span class="s0">in </span><span class="s1">MONTHS</span><span class="s2">]</span>
    <span class="s2">+ [</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">annual</span><span class="s0">}</span><span class="s4">-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">for </span><span class="s1">annual </span><span class="s0">in </span><span class="s2">[</span><span class="s4">&quot;YE&quot;</span><span class="s2">, </span><span class="s4">&quot;BYE&quot;</span><span class="s2">] </span><span class="s0">for </span><span class="s1">month </span><span class="s0">in </span><span class="s1">MONTHS</span><span class="s2">]</span>
    <span class="s2">+ [</span><span class="s4">&quot;ME&quot;</span><span class="s2">, </span><span class="s4">&quot;BME&quot;</span><span class="s2">, </span><span class="s4">&quot;BMS&quot;</span><span class="s2">]</span>
    <span class="s2">+ [</span><span class="s4">f&quot;WOM-</span><span class="s0">{</span><span class="s1">count</span><span class="s0">}{</span><span class="s1">day</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">for </span><span class="s1">count </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">) </span><span class="s0">for </span><span class="s1">day </span><span class="s0">in </span><span class="s1">DAYS</span><span class="s2">]</span>
    <span class="s2">+ [</span><span class="s4">f&quot;W-</span><span class="s0">{</span><span class="s1">day</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">for </span><span class="s1">day </span><span class="s0">in </span><span class="s1">DAYS</span><span class="s2">]</span>
<span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, </span><span class="s1">freqs</span><span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;periods&quot;</span><span class="s2">, [</span><span class="s3">5</span><span class="s2">, </span><span class="s3">7</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_infer_freq_range</span><span class="s2">(</span><span class="s1">periods</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">):</span>
    <span class="s1">freq </span><span class="s2">= </span><span class="s1">freq</span><span class="s2">.</span><span class="s1">upper</span><span class="s2">()</span>

    <span class="s1">gen </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s1">periods</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">)</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">(</span><span class="s1">gen</span><span class="s2">.</span><span class="s1">values</span><span class="s2">)</span>

    <span class="s0">if not </span><span class="s1">freq</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s4">&quot;QE-&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) == </span><span class="s1">gen</span><span class="s2">.</span><span class="s1">freqstr</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">inf_freq </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">is_dec_range </span><span class="s2">= </span><span class="s1">inf_freq </span><span class="s2">== </span><span class="s4">&quot;QE-DEC&quot; </span><span class="s0">and </span><span class="s1">gen</span><span class="s2">.</span><span class="s1">freqstr </span><span class="s0">in </span><span class="s2">(</span>
            <span class="s4">&quot;QE&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-DEC&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-SEP&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-JUN&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-MAR&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">is_nov_range </span><span class="s2">= </span><span class="s1">inf_freq </span><span class="s2">== </span><span class="s4">&quot;QE-NOV&quot; </span><span class="s0">and </span><span class="s1">gen</span><span class="s2">.</span><span class="s1">freqstr </span><span class="s0">in </span><span class="s2">(</span>
            <span class="s4">&quot;QE-NOV&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-AUG&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-MAY&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-FEB&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">is_oct_range </span><span class="s2">= </span><span class="s1">inf_freq </span><span class="s2">== </span><span class="s4">&quot;QE-OCT&quot; </span><span class="s0">and </span><span class="s1">gen</span><span class="s2">.</span><span class="s1">freqstr </span><span class="s0">in </span><span class="s2">(</span>
            <span class="s4">&quot;QE-OCT&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-JUL&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-APR&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;QE-JAN&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">is_dec_range </span><span class="s0">or </span><span class="s1">is_nov_range </span><span class="s0">or </span><span class="s1">is_oct_range</span>


<span class="s0">def </span><span class="s1">test_raise_if_period_index</span><span class="s2">():</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s4">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s3">20</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;M&quot;</span><span class="s2">)</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Check the `freq` attribute instead of using infer_freq&quot;</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_raise_if_too_few</span><span class="s2">():</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;12/31/1998&quot;</span><span class="s2">, </span><span class="s4">&quot;1/3/1999&quot;</span><span class="s2">])</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Need at least 3 dates to infer frequency&quot;</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_business_daily</span><span class="s2">():</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;01/01/1999&quot;</span><span class="s2">, </span><span class="s4">&quot;1/4/1999&quot;</span><span class="s2">, </span><span class="s4">&quot;1/5/1999&quot;</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) == </span><span class="s4">&quot;B&quot;</span>


<span class="s0">def </span><span class="s1">test_business_daily_look_alike</span><span class="s2">():</span>
    <span class="s5"># see gh-16624</span>
    <span class="s5">#</span>
    <span class="s5"># Do not infer &quot;B when &quot;weekend&quot; (2-day gap) in wrong place.</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;12/31/1998&quot;</span><span class="s2">, </span><span class="s4">&quot;1/3/1999&quot;</span><span class="s2">, </span><span class="s4">&quot;1/4/1999&quot;</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_day_corner</span><span class="s2">():</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;1/2/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;1/3/2000&quot;</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) == </span><span class="s4">&quot;D&quot;</span>


<span class="s0">def </span><span class="s1">test_non_datetime_index</span><span class="s2">():</span>
    <span class="s1">dates </span><span class="s2">= </span><span class="s1">to_datetime</span><span class="s2">([</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;1/2/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;1/3/2000&quot;</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">) == </span><span class="s4">&quot;D&quot;</span>


<span class="s0">def </span><span class="s1">test_fifth_week_of_month_infer</span><span class="s2">():</span>
    <span class="s5"># see gh-9425</span>
    <span class="s5">#</span>
    <span class="s5"># Only attempt to infer up to WOM-4.</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;2014-03-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-06-30&quot;</span><span class="s2">, </span><span class="s4">&quot;2015-03-30&quot;</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_week_of_month_fake</span><span class="s2">():</span>
    <span class="s5"># All of these dates are on same day</span>
    <span class="s5"># of week and are 4 or 5 weeks apart.</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;2013-08-27&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-10-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-10-29&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-11-26&quot;</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) != </span><span class="s4">&quot;WOM-4TUE&quot;</span>


<span class="s0">def </span><span class="s1">test_fifth_week_of_month</span><span class="s2">():</span>
    <span class="s5"># see gh-9425</span>
    <span class="s5">#</span>
    <span class="s5"># Only supports freq up to WOM-4.</span>
    <span class="s1">msg </span><span class="s2">= (</span>
        <span class="s4">&quot;Of the four parameters: start, end, periods, &quot;</span>
        <span class="s4">&quot;and freq, exactly three must be specified&quot;</span>
    <span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2014-01-01&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;WOM-5MON&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_monthly_ambiguous</span><span class="s2">():</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;1/31/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;2/29/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;3/31/2000&quot;</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">inferred_freq </span><span class="s2">== </span><span class="s4">&quot;ME&quot;</span>


<span class="s0">def </span><span class="s1">test_annual_ambiguous</span><span class="s2">():</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;1/31/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;1/31/2001&quot;</span><span class="s2">, </span><span class="s4">&quot;1/31/2002&quot;</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">inferred_freq </span><span class="s2">== </span><span class="s4">&quot;YE-JAN&quot;</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;count&quot;</span><span class="s2">, </span><span class="s1">range</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_infer_freq_delta</span><span class="s2">(</span><span class="s1">base_delta_code_pair</span><span class="s2">, </span><span class="s1">count</span><span class="s2">):</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">())</span>
    <span class="s1">base_delta</span><span class="s2">, </span><span class="s1">code </span><span class="s2">= </span><span class="s1">base_delta_code_pair</span>

    <span class="s1">inc </span><span class="s2">= </span><span class="s1">base_delta </span><span class="s2">* </span><span class="s1">count</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s1">b </span><span class="s2">+ </span><span class="s1">inc </span><span class="s2">* </span><span class="s1">j </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s3">3</span><span class="s2">)])</span>

    <span class="s1">exp_freq </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">count</span><span class="s0">:</span><span class="s4">d</span><span class="s0">}{</span><span class="s1">code</span><span class="s0">}</span><span class="s4">&quot; </span><span class="s0">if </span><span class="s1">count </span><span class="s2">&gt; </span><span class="s3">1 </span><span class="s0">else </span><span class="s1">code</span>
    <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) == </span><span class="s1">exp_freq</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;constructor&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s0">lambda </span><span class="s1">now</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">: </span><span class="s1">DatetimeIndex</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">now </span><span class="s2">+ </span><span class="s1">delta </span><span class="s2">* </span><span class="s3">7</span><span class="s2">] + [</span><span class="s1">now </span><span class="s2">+ </span><span class="s1">delta </span><span class="s2">* </span><span class="s1">j </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s3">3</span><span class="s2">)]</span>
        <span class="s2">),</span>
        <span class="s0">lambda </span><span class="s1">now</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">: </span><span class="s1">DatetimeIndex</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">now </span><span class="s2">+ </span><span class="s1">delta </span><span class="s2">* </span><span class="s1">j </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s3">3</span><span class="s2">)] + [</span><span class="s1">now </span><span class="s2">+ </span><span class="s1">delta </span><span class="s2">* </span><span class="s3">7</span><span class="s2">]</span>
        <span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_custom</span><span class="s2">(</span><span class="s1">base_delta_code_pair</span><span class="s2">, </span><span class="s1">constructor</span><span class="s2">):</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">())</span>
    <span class="s1">base_delta</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">base_delta_code_pair</span>

    <span class="s1">index </span><span class="s2">= </span><span class="s1">constructor</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">base_delta</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) </span><span class="s0">is None</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;freq,expected&quot;</span><span class="s2">, [(</span><span class="s4">&quot;Q&quot;</span><span class="s2">, </span><span class="s4">&quot;QE-DEC&quot;</span><span class="s2">), (</span><span class="s4">&quot;Q-NOV&quot;</span><span class="s2">, </span><span class="s4">&quot;QE-NOV&quot;</span><span class="s2">), (</span><span class="s4">&quot;Q-OCT&quot;</span><span class="s2">, </span><span class="s4">&quot;QE-OCT&quot;</span><span class="s2">)]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_index</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s4">&quot;1959Q2&quot;</span><span class="s2">, </span><span class="s4">&quot;2009Q3&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Dtype inference&quot;</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s4">&quot;e&quot;</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">object</span><span class="s2">))</span>

    <span class="s0">assert </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">inferred_freq </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;expected,dates&quot;</span><span class="s2">,</span>
    <span class="s1">list</span><span class="s2">(</span>
        <span class="s2">{</span>
            <span class="s4">&quot;YS-JAN&quot;</span><span class="s2">: [</span><span class="s4">&quot;2009-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2010-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-01-01&quot;</span><span class="s2">],</span>
            <span class="s4">&quot;QE-OCT&quot;</span><span class="s2">: [</span><span class="s4">&quot;2009-01-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2009-04-30&quot;</span><span class="s2">, </span><span class="s4">&quot;2009-07-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2009-10-31&quot;</span><span class="s2">],</span>
            <span class="s4">&quot;ME&quot;</span><span class="s2">: [</span><span class="s4">&quot;2010-11-30&quot;</span><span class="s2">, </span><span class="s4">&quot;2010-12-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-31&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-02-28&quot;</span><span class="s2">],</span>
            <span class="s4">&quot;W-SAT&quot;</span><span class="s2">: [</span><span class="s4">&quot;2010-12-25&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-08&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-15&quot;</span><span class="s2">],</span>
            <span class="s4">&quot;D&quot;</span><span class="s2">: [</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-03&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-04&quot;</span><span class="s2">],</span>
            <span class="s4">&quot;h&quot;</span><span class="s2">: [</span>
                <span class="s4">&quot;2011-12-31 22:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2011-12-31 23:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2012-01-01 00:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2012-01-01 01:00&quot;</span><span class="s2">,</span>
            <span class="s2">],</span>
        <span class="s2">}.</span><span class="s1">items</span><span class="s2">()</span>
    <span class="s2">),</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;unit&quot;</span><span class="s2">, [</span><span class="s4">&quot;s&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;us&quot;</span><span class="s2">, </span><span class="s4">&quot;ns&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_infer_freq_tz</span><span class="s2">(</span><span class="s1">tz_naive_fixture</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">dates</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
    <span class="s5"># see gh-7310, GH#55609</span>
    <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_naive_fixture</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">inferred_freq </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_infer_freq_tz_series</span><span class="s2">(</span><span class="s1">tz_naive_fixture</span><span class="s2">):</span>
    <span class="s5"># infer_freq should work with both tz-naive and tz-aware series. See gh-52456</span>
    <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_naive_fixture</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2021-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2021-01-04&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
    <span class="s1">series </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">to_series</span><span class="s2">().</span><span class="s1">reset_index</span><span class="s2">(</span><span class="s1">drop</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">inferred_freq </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">series</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">inferred_freq </span><span class="s2">== </span><span class="s4">&quot;D&quot;</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;date_pair&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">[</span><span class="s4">&quot;2013-11-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-11-5&quot;</span><span class="s2">],  </span><span class="s5"># Fall DST</span>
        <span class="s2">[</span><span class="s4">&quot;2014-03-08&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-03-11&quot;</span><span class="s2">],  </span><span class="s5"># Spring DST</span>
        <span class="s2">[</span><span class="s4">&quot;2014-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2014-01-03&quot;</span><span class="s2">],  </span><span class="s5"># Regular Time</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;freq&quot;</span><span class="s2">,</span>
    <span class="s2">[</span><span class="s4">&quot;h&quot;</span><span class="s2">, </span><span class="s4">&quot;3h&quot;</span><span class="s2">, </span><span class="s4">&quot;10min&quot;</span><span class="s2">, </span><span class="s4">&quot;3601s&quot;</span><span class="s2">, </span><span class="s4">&quot;3600001ms&quot;</span><span class="s2">, </span><span class="s4">&quot;3600000001us&quot;</span><span class="s2">, </span><span class="s4">&quot;3600000000001ns&quot;</span><span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_tz_transition</span><span class="s2">(</span><span class="s1">tz_naive_fixture</span><span class="s2">, </span><span class="s1">date_pair</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">):</span>
    <span class="s5"># see gh-8772</span>
    <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_naive_fixture</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">date_pair</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">date_pair</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">inferred_freq </span><span class="s2">== </span><span class="s1">freq</span>


<span class="s0">def </span><span class="s1">test_infer_freq_tz_transition_custom</span><span class="s2">():</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2013-11-03&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s3">5</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;3h&quot;</span><span class="s2">).</span><span class="s1">tz_localize</span><span class="s2">(</span>
        <span class="s4">&quot;America/Chicago&quot;</span>
    <span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">index</span><span class="s2">.</span><span class="s1">inferred_freq </span><span class="s0">is None</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;data,expected&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s5"># Hourly freq in a day must result in &quot;h&quot;</span>
        <span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4">&quot;2014-07-01 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 14:00&quot;</span><span class="s2">,</span>
            <span class="s2">],</span>
            <span class="s4">&quot;h&quot;</span><span class="s2">,</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4">&quot;2014-07-01 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-01 16:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-02 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-02 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-02 11:00&quot;</span><span class="s2">,</span>
            <span class="s2">],</span>
            <span class="s4">&quot;bh&quot;</span><span class="s2">,</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4">&quot;2014-07-04 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 16:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 11:00&quot;</span><span class="s2">,</span>
            <span class="s2">],</span>
            <span class="s4">&quot;bh&quot;</span><span class="s2">,</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4">&quot;2014-07-04 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-04 16:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-07 16:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 09:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 10:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 11:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 12:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 13:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 14:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 15:00&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;2014-07-08 16:00&quot;</span><span class="s2">,</span>
            <span class="s2">],</span>
            <span class="s4">&quot;bh&quot;</span><span class="s2">,</span>
        <span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_infer_freq_business_hour</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s5"># see gh-7905</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">inferred_freq </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_not_monotonic</span><span class="s2">():</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;1/31/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;1/31/2001&quot;</span><span class="s2">, </span><span class="s4">&quot;1/31/2002&quot;</span><span class="s2">])</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">[::-</span><span class="s3">1</span><span class="s2">]</span>

    <span class="s0">assert </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">inferred_freq </span><span class="s2">== </span><span class="s4">&quot;-1YE-JAN&quot;</span>


<span class="s0">def </span><span class="s1">test_non_datetime_index2</span><span class="s2">():</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s4">&quot;1/31/2000&quot;</span><span class="s2">, </span><span class="s4">&quot;1/31/2001&quot;</span><span class="s2">, </span><span class="s4">&quot;1/31/2002&quot;</span><span class="s2">])</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">to_pydatetime</span><span class="s2">()</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">inferred_freq</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;idx&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s1">Index</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">),</span>
        <span class="s1">Index</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">),</span>
        <span class="s1">period_range</span><span class="s2">(</span><span class="s4">&quot;2020-01-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s3">5</span><span class="s2">),</span>
        <span class="s1">RangeIndex</span><span class="s2">(</span><span class="s3">5</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_invalid_index_types</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">):</span>
    <span class="s5"># see gh-48439</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;|&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s4">&quot;cannot infer freq from a non-convertible&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;Check the `freq` attribute instead of using infer_freq&quot;</span><span class="s2">,</span>
        <span class="s2">]</span>
    <span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">is_platform_windows</span><span class="s2">(), </span><span class="s1">reason</span><span class="s2">=</span><span class="s4">&quot;see gh-10822: Windows issue&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_invalid_index_types_unicode</span><span class="s2">():</span>
    <span class="s5"># see gh-10822</span>
    <span class="s5">#</span>
    <span class="s5"># Odd error message on conversions to datetime for unicode.</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Unknown datetime string format&quot;</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">Index</span><span class="s2">([</span><span class="s4">&quot;ZqgszYBfuL&quot;</span><span class="s2">]))</span>


<span class="s0">def </span><span class="s1">test_string_datetime_like_compat</span><span class="s2">():</span>
    <span class="s5"># see gh-6463</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s4">&quot;2004-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2004-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2004-03&quot;</span><span class="s2">, </span><span class="s4">&quot;2004-04&quot;</span><span class="s2">]</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">Index</span><span class="s2">(</span><span class="s1">data</span><span class="s2">))</span>

    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_series</span><span class="s2">():</span>
    <span class="s5"># see gh-6407</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;20130101&quot;</span><span class="s2">, </span><span class="s4">&quot;20130110&quot;</span><span class="s2">))</span>
    <span class="s1">inferred </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">inferred </span><span class="s2">== </span><span class="s4">&quot;D&quot;</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;end&quot;</span><span class="s2">, [</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10.0</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_series_invalid_type</span><span class="s2">(</span><span class="s1">end</span><span class="s2">):</span>
    <span class="s5"># see gh-6407</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;cannot infer freq from a non-convertible dtype on a Series&quot;</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">end</span><span class="s2">))</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_series_inconvertible_string</span><span class="s2">(</span><span class="s1">using_infer_string</span><span class="s2">):</span>
    <span class="s5"># see gh-6407</span>
    <span class="s0">if </span><span class="s1">using_infer_string</span><span class="s2">:</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;cannot infer freq from&quot;</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">Series</span><span class="s2">([</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s2">]))</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Unknown datetime string format&quot;</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">Series</span><span class="s2">([</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_series_period_index</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">):</span>
    <span class="s5"># see gh-6407</span>
    <span class="s5">#</span>
    <span class="s5"># Cannot infer on PeriodIndex</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;cannot infer freq from a non-convertible dtype on a Series&quot;</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">period_range</span><span class="s2">(</span><span class="s4">&quot;2013&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">))</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, [</span><span class="s4">&quot;ME&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_series_datetime_index</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">):</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;20130101&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">))</span>
    <span class="s1">inferred </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">inferred </span><span class="s2">== </span><span class="s1">freq</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;offset_func&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s1">_get_offset</span><span class="s2">,</span>
        <span class="s0">lambda </span><span class="s1">freq</span><span class="s2">: </span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s3">5</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;freq&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s4">&quot;WEEKDAY&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;EOM&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;W@MON&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;W@TUE&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;W@WED&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;W@THU&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;W@FRI&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;W@SAT&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;W@SUN&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;QE@JAN&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;QE@FEB&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;QE@MAR&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@JAN&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@FEB&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@MAR&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@APR&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@MAY&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@JUN&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@JUL&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@AUG&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@SEP&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@OCT&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@NOV&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@DEC&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;YE@JAN&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@1MON&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@2MON&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@3MON&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@4MON&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@1TUE&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@2TUE&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@3TUE&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@4TUE&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@1WED&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@2WED&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@3WED&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@4WED&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@1THU&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@2THU&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@3THU&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@4THU&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@1FRI&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@2FRI&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@3FRI&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;WOM@4FRI&quot;</span><span class="s2">,</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_legacy_offset_warnings</span><span class="s2">(</span><span class="s1">offset_func</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">INVALID_FREQ_ERR_MSG</span><span class="s2">):</span>
        <span class="s1">offset_func</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_ms_vs_capital_ms</span><span class="s2">():</span>
    <span class="s1">left </span><span class="s2">= </span><span class="s1">_get_offset</span><span class="s2">(</span><span class="s4">&quot;ms&quot;</span><span class="s2">)</span>
    <span class="s1">right </span><span class="s2">= </span><span class="s1">_get_offset</span><span class="s2">(</span><span class="s4">&quot;MS&quot;</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">left </span><span class="s2">== </span><span class="s1">offsets</span><span class="s2">.</span><span class="s1">Milli</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">right </span><span class="s2">== </span><span class="s1">offsets</span><span class="s2">.</span><span class="s1">MonthBegin</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_infer_freq_non_nano</span><span class="s2">():</span>
    <span class="s1">arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">10</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">).</span><span class="s1">view</span><span class="s2">(</span><span class="s4">&quot;M8[s]&quot;</span><span class="s2">)</span>
    <span class="s1">dta </span><span class="s2">= </span><span class="s1">DatetimeArray</span><span class="s2">.</span><span class="s1">_simple_new</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">arr</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">dta</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">res </span><span class="s2">== </span><span class="s4">&quot;s&quot;</span>

    <span class="s1">arr2 </span><span class="s2">= </span><span class="s1">arr</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s4">&quot;m8[ms]&quot;</span><span class="s2">)</span>
    <span class="s1">tda </span><span class="s2">= </span><span class="s1">TimedeltaArray</span><span class="s2">.</span><span class="s1">_simple_new</span><span class="s2">(</span><span class="s1">arr2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">arr2</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">res2 </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">tda</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">res2 </span><span class="s2">== </span><span class="s4">&quot;ms&quot;</span>


<span class="s0">def </span><span class="s1">test_infer_freq_non_nano_tzaware</span><span class="s2">(</span><span class="s1">tz_aware_fixture</span><span class="s2">):</span>
    <span class="s1">tz </span><span class="s2">= </span><span class="s1">tz_aware_fixture</span>

    <span class="s1">dti </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s3">365</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
    <span class="s1">dta </span><span class="s2">= </span><span class="s1">dti</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">)</span>

    <span class="s1">res </span><span class="s2">= </span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">infer_freq</span><span class="s2">(</span><span class="s1">dta</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">res </span><span class="s2">== </span><span class="s4">&quot;B&quot;</span>
</pre>
</body>
</html>