<html>
<head>
<title>test_rcparams.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_rcparams.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">copy</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">subprocess</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">from </span><span class="s1">unittest </span><span class="s0">import </span><span class="s1">mock</span>

<span class="s0">from </span><span class="s1">cycler </span><span class="s0">import </span><span class="s1">cycler</span><span class="s2">, </span><span class="s1">Cycler</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">_api</span><span class="s2">, </span><span class="s1">_c_internal_utils</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcsetup </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">validate_bool</span><span class="s2">,</span>
    <span class="s1">validate_color</span><span class="s2">,</span>
    <span class="s1">validate_colorlist</span><span class="s2">,</span>
    <span class="s1">_validate_color_or_linecolor</span><span class="s2">,</span>
    <span class="s1">validate_cycler</span><span class="s2">,</span>
    <span class="s1">validate_float</span><span class="s2">,</span>
    <span class="s1">validate_fontstretch</span><span class="s2">,</span>
    <span class="s1">validate_fontweight</span><span class="s2">,</span>
    <span class="s1">validate_hatch</span><span class="s2">,</span>
    <span class="s1">validate_hist_bins</span><span class="s2">,</span>
    <span class="s1">validate_int</span><span class="s2">,</span>
    <span class="s1">validate_markevery</span><span class="s2">,</span>
    <span class="s1">validate_stringlist</span><span class="s2">,</span>
    <span class="s1">validate_sketch</span><span class="s2">,</span>
    <span class="s1">_validate_linestyle</span><span class="s2">,</span>
    <span class="s1">_listify_validator</span><span class="s2">)</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">subprocess_run_for_testing</span>


<span class="s0">def </span><span class="s1">test_rcparams</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">):</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc</span><span class="s2">(</span><span class="s3">'text'</span><span class="s2">, </span><span class="s1">usetex</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc</span><span class="s2">(</span><span class="s3">'lines'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s4">22</span><span class="s2">)</span>

    <span class="s1">usetex </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.usetex'</span><span class="s2">]</span>
    <span class="s1">linewidth </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.linewidth'</span><span class="s2">]</span>

    <span class="s1">rcpath </span><span class="s2">= </span><span class="s1">tmp_path </span><span class="s2">/ </span><span class="s3">'test_rcparams.rc'</span>
    <span class="s1">rcpath</span><span class="s2">.</span><span class="s1">write_text</span><span class="s2">(</span><span class="s3">'lines.linewidth: 33'</span><span class="s2">, </span><span class="s1">encoding</span><span class="s2">=</span><span class="s3">'utf-8'</span><span class="s2">)</span>

    <span class="s5"># test context given dictionary</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">={</span><span class="s3">'text.usetex'</span><span class="s2">: </span><span class="s0">not </span><span class="s1">usetex</span><span class="s2">}):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.usetex'</span><span class="s2">] == (</span><span class="s0">not </span><span class="s1">usetex</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.usetex'</span><span class="s2">] == </span><span class="s1">usetex</span>

    <span class="s5"># test context given filename (mpl.rc sets linewidth to 33)</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">fname</span><span class="s2">=</span><span class="s1">rcpath</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.linewidth'</span><span class="s2">] == </span><span class="s4">33</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.linewidth'</span><span class="s2">] == </span><span class="s1">linewidth</span>

    <span class="s5"># test context given filename and dictionary</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">fname</span><span class="s2">=</span><span class="s1">rcpath</span><span class="s2">, </span><span class="s1">rc</span><span class="s2">={</span><span class="s3">'lines.linewidth'</span><span class="s2">: </span><span class="s4">44</span><span class="s2">}):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.linewidth'</span><span class="s2">] == </span><span class="s4">44</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.linewidth'</span><span class="s2">] == </span><span class="s1">linewidth</span>

    <span class="s5"># test context as decorator (and test reusability, by calling func twice)</span>
    <span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">({</span><span class="s3">'lines.linewidth'</span><span class="s2">: </span><span class="s4">44</span><span class="s2">})</span>
    <span class="s0">def </span><span class="s1">func</span><span class="s2">():</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.linewidth'</span><span class="s2">] == </span><span class="s4">44</span>

    <span class="s1">func</span><span class="s2">()</span>
    <span class="s1">func</span><span class="s2">()</span>

    <span class="s5"># test rc_file</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_file</span><span class="s2">(</span><span class="s1">rcpath</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.linewidth'</span><span class="s2">] == </span><span class="s4">33</span>


<span class="s0">def </span><span class="s1">test_RcParams_class</span><span class="s2">():</span>
    <span class="s1">rc </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">RcParams</span><span class="s2">({</span><span class="s3">'font.cursive'</span><span class="s2">: [</span><span class="s3">'Apple Chancery'</span><span class="s2">,</span>
                                        <span class="s3">'Textile'</span><span class="s2">,</span>
                                        <span class="s3">'Zapf Chancery'</span><span class="s2">,</span>
                                        <span class="s3">'cursive'</span><span class="s2">],</span>
                       <span class="s3">'font.family'</span><span class="s2">: </span><span class="s3">'sans-serif'</span><span class="s2">,</span>
                       <span class="s3">'font.weight'</span><span class="s2">: </span><span class="s3">'normal'</span><span class="s2">,</span>
                       <span class="s3">'font.size'</span><span class="s2">: </span><span class="s4">12</span><span class="s2">})</span>

    <span class="s1">expected_repr </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot; 
RcParams({'font.cursive': ['Apple Chancery', 
                           'Textile', 
                           'Zapf Chancery', 
                           'cursive'], 
          'font.family': ['sans-serif'], 
          'font.size': 12.0, 
          'font.weight': 'normal'})&quot;&quot;&quot;</span><span class="s2">.</span><span class="s1">lstrip</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">expected_repr </span><span class="s2">== </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">)</span>

    <span class="s1">expected_str </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot; 
font.cursive: ['Apple Chancery', 'Textile', 'Zapf Chancery', 'cursive'] 
font.family: ['sans-serif'] 
font.size: 12.0 
font.weight: normal&quot;&quot;&quot;</span><span class="s2">.</span><span class="s1">lstrip</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">expected_str </span><span class="s2">== </span><span class="s1">str</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">)</span>

    <span class="s5"># test the find_all functionality</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s3">'font.cursive'</span><span class="s2">, </span><span class="s3">'font.size'</span><span class="s2">] == </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">.</span><span class="s1">find_all</span><span class="s2">(</span><span class="s3">'i[vz]'</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s3">'font.family'</span><span class="s2">] == </span><span class="s1">list</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">.</span><span class="s1">find_all</span><span class="s2">(</span><span class="s3">'family'</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_rcparams_update</span><span class="s2">():</span>
    <span class="s1">rc </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">RcParams</span><span class="s2">({</span><span class="s3">'figure.figsize'</span><span class="s2">: (</span><span class="s4">3.5</span><span class="s2">, </span><span class="s4">42</span><span class="s2">)})</span>
    <span class="s1">bad_dict </span><span class="s2">= {</span><span class="s3">'figure.figsize'</span><span class="s2">: (</span><span class="s4">3.5</span><span class="s2">, </span><span class="s4">42</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)}</span>
    <span class="s5"># make sure validation happens on input</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">rc</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">bad_dict</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_rcparams_init</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">RcParams</span><span class="s2">({</span><span class="s3">'figure.figsize'</span><span class="s2">: (</span><span class="s4">3.5</span><span class="s2">, </span><span class="s4">42</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)})</span>


<span class="s0">def </span><span class="s1">test_nargs_cycler</span><span class="s2">():</span>
    <span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcsetup </span><span class="s0">import </span><span class="s1">cycler </span><span class="s0">as </span><span class="s1">ccl</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'3 were given'</span><span class="s2">):</span>
        <span class="s5"># cycler() takes 0-2 arguments.</span>
        <span class="s1">ccl</span><span class="s2">(</span><span class="s1">ccl</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s1">list</span><span class="s2">(</span><span class="s3">'rgb'</span><span class="s2">)), </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_Bug_2543</span><span class="s2">():</span>
    <span class="s5"># Test that it possible to add all values to itself / deepcopy</span>
    <span class="s5"># https://github.com/matplotlib/matplotlib/issues/2543</span>
    <span class="s5"># We filter warnings at this stage since a number of them are raised</span>
    <span class="s5"># for deprecated rcparams as they should. We don't want these in the</span>
    <span class="s5"># printed in the test suite.</span>
    <span class="s0">with </span><span class="s1">_api</span><span class="s2">.</span><span class="s1">suppress_matplotlib_deprecation_warning</span><span class="s2">():</span>
        <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">():</span>
            <span class="s1">_copy </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
            <span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">_copy</span><span class="s2">:</span>
                <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">_copy</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">():</span>
            <span class="s1">copy</span><span class="s2">.</span><span class="s1">deepcopy</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">validate_bool</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">():</span>
            <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'svg.fonttype'</span><span class="s2">] = </span><span class="s0">True</span>


<span class="s1">legend_color_tests </span><span class="s2">= [</span>
    <span class="s2">(</span><span class="s3">'face'</span><span class="s2">, {</span><span class="s3">'color'</span><span class="s2">: </span><span class="s3">'r'</span><span class="s2">}, </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'r'</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s3">'face'</span><span class="s2">, {</span><span class="s3">'color'</span><span class="s2">: </span><span class="s3">'inherit'</span><span class="s2">, </span><span class="s3">'axes.facecolor'</span><span class="s2">: </span><span class="s3">'r'</span><span class="s2">},</span>
     <span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'r'</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s3">'face'</span><span class="s2">, {</span><span class="s3">'color'</span><span class="s2">: </span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'axes.facecolor'</span><span class="s2">: </span><span class="s3">'r'</span><span class="s2">}, </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'g'</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s3">'edge'</span><span class="s2">, {</span><span class="s3">'color'</span><span class="s2">: </span><span class="s3">'r'</span><span class="s2">}, </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'r'</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s3">'edge'</span><span class="s2">, {</span><span class="s3">'color'</span><span class="s2">: </span><span class="s3">'inherit'</span><span class="s2">, </span><span class="s3">'axes.edgecolor'</span><span class="s2">: </span><span class="s3">'r'</span><span class="s2">},</span>
     <span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'r'</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s3">'edge'</span><span class="s2">, {</span><span class="s3">'color'</span><span class="s2">: </span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'axes.facecolor'</span><span class="s2">: </span><span class="s3">'r'</span><span class="s2">}, </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s3">'g'</span><span class="s2">))</span>
<span class="s2">]</span>
<span class="s1">legend_color_test_ids </span><span class="s2">= [</span>
    <span class="s3">'same facecolor'</span><span class="s2">,</span>
    <span class="s3">'inherited facecolor'</span><span class="s2">,</span>
    <span class="s3">'different facecolor'</span><span class="s2">,</span>
    <span class="s3">'same edgecolor'</span><span class="s2">,</span>
    <span class="s3">'inherited edgecolor'</span><span class="s2">,</span>
    <span class="s3">'different facecolor'</span><span class="s2">,</span>
<span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'color_type, param_dict, target'</span><span class="s2">, </span><span class="s1">legend_color_tests</span><span class="s2">,</span>
                         <span class="s1">ids</span><span class="s2">=</span><span class="s1">legend_color_test_ids</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_legend_colors</span><span class="s2">(</span><span class="s1">color_type</span><span class="s2">, </span><span class="s1">param_dict</span><span class="s2">, </span><span class="s1">target</span><span class="s2">):</span>
    <span class="s1">param_dict</span><span class="s2">[</span><span class="s3">f'legend.</span><span class="s0">{</span><span class="s1">color_type</span><span class="s0">}</span><span class="s3">color'</span><span class="s2">] = </span><span class="s1">param_dict</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s3">'color'</span><span class="s2">)</span>
    <span class="s1">get_func </span><span class="s2">= </span><span class="s3">f'get_</span><span class="s0">{</span><span class="s1">color_type</span><span class="s0">}</span><span class="s3">color'</span>

    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">param_dict</span><span class="s2">):</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">3</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s3">'test'</span><span class="s2">)</span>
        <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">legendPatch</span><span class="s2">, </span><span class="s1">get_func</span><span class="s2">)() == </span><span class="s1">target</span>


<span class="s0">def </span><span class="s1">test_mfc_rcparams</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.markerfacecolor'</span><span class="s2">] = </span><span class="s3">'r'</span>
    <span class="s1">ln </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">get_markerfacecolor</span><span class="s2">() == </span><span class="s3">'r'</span>


<span class="s0">def </span><span class="s1">test_mec_rcparams</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'lines.markeredgecolor'</span><span class="s2">] = </span><span class="s3">'r'</span>
    <span class="s1">ln </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">get_markeredgecolor</span><span class="s2">() == </span><span class="s3">'r'</span>


<span class="s0">def </span><span class="s1">test_axes_titlecolor_rcparams</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'axes.titlecolor'</span><span class="s2">] = </span><span class="s3">'r'</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">title </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">&quot;Title&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s3">'r'</span>


<span class="s0">def </span><span class="s1">test_Issue_1713</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">):</span>
    <span class="s1">rcpath </span><span class="s2">= </span><span class="s1">tmp_path </span><span class="s2">/ </span><span class="s3">'test_rcparams.rc'</span>
    <span class="s1">rcpath</span><span class="s2">.</span><span class="s1">write_text</span><span class="s2">(</span><span class="s3">'timezone: UTC'</span><span class="s2">, </span><span class="s1">encoding</span><span class="s2">=</span><span class="s3">'utf-8'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s3">'locale.getpreferredencoding'</span><span class="s2">, </span><span class="s1">return_value</span><span class="s2">=</span><span class="s3">'UTF-32-BE'</span><span class="s2">):</span>
        <span class="s1">rc </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_params_from_file</span><span class="s2">(</span><span class="s1">rcpath</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">rc</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s3">'timezone'</span><span class="s2">) == </span><span class="s3">'UTC'</span>


<span class="s0">def </span><span class="s1">test_animation_frame_formats</span><span class="s2">():</span>
    <span class="s5"># Animation frame_format should allow any of the following</span>
    <span class="s5"># if any of these are not allowed, an exception will be raised</span>
    <span class="s5"># test for gh issue #17908</span>
    <span class="s0">for </span><span class="s1">fmt </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'png'</span><span class="s2">, </span><span class="s3">'jpeg'</span><span class="s2">, </span><span class="s3">'tiff'</span><span class="s2">, </span><span class="s3">'raw'</span><span class="s2">, </span><span class="s3">'rgba'</span><span class="s2">, </span><span class="s3">'ppm'</span><span class="s2">,</span>
                <span class="s3">'sgi'</span><span class="s2">, </span><span class="s3">'bmp'</span><span class="s2">, </span><span class="s3">'pbm'</span><span class="s2">, </span><span class="s3">'svg'</span><span class="s2">]:</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'animation.frame_format'</span><span class="s2">] = </span><span class="s1">fmt</span>


<span class="s0">def </span><span class="s1">generate_validator_testcases</span><span class="s2">(</span><span class="s1">valid</span><span class="s2">):</span>
    <span class="s1">validation_tests </span><span class="s2">= (</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">validate_bool</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: (*((</span><span class="s1">_</span><span class="s2">, </span><span class="s0">True</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in</span>
                       <span class="s2">(</span><span class="s3">'t'</span><span class="s2">, </span><span class="s3">'y'</span><span class="s2">, </span><span class="s3">'yes'</span><span class="s2">, </span><span class="s3">'on'</span><span class="s2">, </span><span class="s3">'true'</span><span class="s2">, </span><span class="s3">'1'</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)),</span>
                     <span class="s2">*((</span><span class="s1">_</span><span class="s2">, </span><span class="s0">False</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in</span>
                       <span class="s2">(</span><span class="s3">'f'</span><span class="s2">, </span><span class="s3">'n'</span><span class="s2">, </span><span class="s3">'no'</span><span class="s2">, </span><span class="s3">'off'</span><span class="s2">, </span><span class="s3">'false'</span><span class="s2">, </span><span class="s3">'0'</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s0">False</span><span class="s2">))),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s1">_</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">)</span>
                  <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'aardvark'</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, [], ))</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">validate_stringlist</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s3">''</span><span class="s2">, []),</span>
                     <span class="s2">(</span><span class="s3">'a,b'</span><span class="s2">, [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]),</span>
                     <span class="s2">(</span><span class="s3">'aardvark'</span><span class="s2">, [</span><span class="s3">'aardvark'</span><span class="s2">]),</span>
                     <span class="s2">(</span><span class="s3">'aardvark, '</span><span class="s2">, [</span><span class="s3">'aardvark'</span><span class="s2">]),</span>
                     <span class="s2">(</span><span class="s3">'aardvark, ,'</span><span class="s2">, [</span><span class="s3">'aardvark'</span><span class="s2">]),</span>
                     <span class="s2">([</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">], [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]),</span>
                     <span class="s2">((</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">), [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]),</span>
                     <span class="s2">(</span><span class="s1">iter</span><span class="s2">([</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]), [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]),</span>
                     <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]), [</span><span class="s3">'a'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]),</span>
                     <span class="s2">),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s1">set</span><span class="s2">(), </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">)</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">_listify_validator</span><span class="s2">(</span><span class="s1">validate_int</span><span class="s2">, </span><span class="s1">n</span><span class="s2">=</span><span class="s4">2</span><span class="s2">),</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s1">_</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
                     <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'1, 2'</span><span class="s2">, [</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">],</span>
                               <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)))),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s1">_</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">)</span>
                  <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'aardvark'</span><span class="s2">, (</span><span class="s3">'a'</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>
                            <span class="s2">))</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">_listify_validator</span><span class="s2">(</span><span class="s1">validate_float</span><span class="s2">, </span><span class="s1">n</span><span class="s2">=</span><span class="s4">2</span><span class="s2">),</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s1">_</span><span class="s2">, [</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">])</span>
                     <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'1.5, 2.5'</span><span class="s2">, [</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">], [</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">],</span>
                               <span class="s2">(</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">((</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">)))),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s1">_</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">)</span>
                  <span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'aardvark'</span><span class="s2">, (</span><span class="s3">'a'</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), (</span><span class="s0">None</span><span class="s2">, ), </span><span class="s0">None</span><span class="s2">))</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">validate_cycler</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s3">'cycler(&quot;color&quot;, &quot;rgb&quot;)'</span><span class="s2">,</span>
                      <span class="s1">cycler</span><span class="s2">(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">'rgb'</span><span class="s2">)),</span>
                     <span class="s2">(</span><span class="s1">cycler</span><span class="s2">(</span><span class="s3">'linestyle'</span><span class="s2">, [</span><span class="s3">'-'</span><span class="s2">, </span><span class="s3">'--'</span><span class="s2">]),</span>
                      <span class="s1">cycler</span><span class="s2">(</span><span class="s3">'linestyle'</span><span class="s2">, [</span><span class="s3">'-'</span><span class="s2">, </span><span class="s3">'--'</span><span class="s2">])),</span>
                     <span class="s2">(</span><span class="s3">&quot;&quot;&quot;(cycler(&quot;color&quot;, [&quot;r&quot;, &quot;g&quot;, &quot;b&quot;]) + 
                          cycler(&quot;mew&quot;, [2, 3, 5]))&quot;&quot;&quot;</span><span class="s2">,</span>
                      <span class="s2">(</span><span class="s1">cycler</span><span class="s2">(</span><span class="s3">&quot;color&quot;</span><span class="s2">, </span><span class="s3">'rgb'</span><span class="s2">) +</span>
                       <span class="s1">cycler</span><span class="s2">(</span><span class="s3">&quot;markeredgewidth&quot;</span><span class="s2">, [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">]))),</span>
                     <span class="s2">(</span><span class="s3">&quot;cycler(c='rgb', lw=[1, 2, 3])&quot;</span><span class="s2">,</span>
                      <span class="s1">cycler</span><span class="s2">(</span><span class="s3">'color'</span><span class="s2">, </span><span class="s3">'rgb'</span><span class="s2">) + </span><span class="s1">cycler</span><span class="s2">(</span><span class="s3">'linewidth'</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])),</span>
                     <span class="s2">(</span><span class="s3">&quot;cycler('c', 'rgb') * cycler('linestyle', ['-', '--'])&quot;</span><span class="s2">,</span>
                      <span class="s2">(</span><span class="s1">cycler</span><span class="s2">(</span><span class="s3">'color'</span><span class="s2">, </span><span class="s3">'rgb'</span><span class="s2">) *</span>
                       <span class="s1">cycler</span><span class="s2">(</span><span class="s3">'linestyle'</span><span class="s2">, [</span><span class="s3">'-'</span><span class="s2">, </span><span class="s3">'--'</span><span class="s2">]))),</span>
                     <span class="s2">(</span><span class="s1">cycler</span><span class="s2">(</span><span class="s3">'ls'</span><span class="s2">, [</span><span class="s3">'-'</span><span class="s2">, </span><span class="s3">'--'</span><span class="s2">]),</span>
                      <span class="s1">cycler</span><span class="s2">(</span><span class="s3">'linestyle'</span><span class="s2">, [</span><span class="s3">'-'</span><span class="s2">, </span><span class="s3">'--'</span><span class="s2">])),</span>
                     <span class="s2">(</span><span class="s1">cycler</span><span class="s2">(</span><span class="s1">mew</span><span class="s2">=[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">]),</span>
                      <span class="s1">cycler</span><span class="s2">(</span><span class="s3">'markeredgewidth'</span><span class="s2">, [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">])),</span>
                     <span class="s2">),</span>
         <span class="s5"># This is *so* incredibly important: validate_cycler() eval's</span>
         <span class="s5"># an arbitrary string! I think I have it locked down enough,</span>
         <span class="s5"># and that is what this is testing.</span>
         <span class="s5"># TODO: Note that these tests are actually insufficient, as it may</span>
         <span class="s5"># be that they raised errors, but still did an action prior to</span>
         <span class="s5"># raising the exception. We should devise some additional tests</span>
         <span class="s5"># for that...</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s4">4</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># Gotta be a string or Cycler object</span>
                  <span class="s2">(</span><span class="s3">'cycler(&quot;bleh, [])'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># syntax error</span>
                  <span class="s2">(</span><span class="s3">'Cycler(&quot;linewidth&quot;, [1, 2, 3])'</span><span class="s2">,</span>
                   <span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># only 'cycler()' function is allowed</span>
                  <span class="s5"># do not allow dunder in string literals</span>
                  <span class="s2">(</span><span class="s3">&quot;cycler('c', [j.__class__(j) for j in ['r', 'b']])&quot;</span><span class="s2">,</span>
                   <span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">&quot;cycler('c', [j. __class__(j) for j in ['r', 'b']])&quot;</span><span class="s2">,</span>
                   <span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">&quot;cycler('c', [j.</span><span class="s0">\t</span><span class="s3">__class__(j) for j in ['r', 'b']])&quot;</span><span class="s2">,</span>
                   <span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">&quot;cycler('c', [j.</span><span class="s0">\u000c</span><span class="s3">__class__(j) for j in ['r', 'b']])&quot;</span><span class="s2">,</span>
                   <span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">&quot;cycler('c', [j.__class__(j).lower() for j in ['r', 'b']])&quot;</span><span class="s2">,</span>
                   <span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">'1 + 2'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># doesn't produce a Cycler object</span>
                  <span class="s2">(</span><span class="s3">'os.system(&quot;echo Gotcha&quot;)'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># os not available</span>
                  <span class="s2">(</span><span class="s3">'import os'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># should not be able to import</span>
                  <span class="s2">(</span><span class="s3">'def badjuju(a): return a; badjuju(cycler(&quot;color&quot;, &quot;rgb&quot;))'</span><span class="s2">,</span>
                   <span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># Should not be able to define anything</span>
                  <span class="s5"># even if it does return a cycler</span>
                  <span class="s2">(</span><span class="s3">'cycler(&quot;waka&quot;, [1, 2, 3])'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># not a property</span>
                  <span class="s2">(</span><span class="s3">'cycler(c=[1, 2, 3])'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># invalid values</span>
                  <span class="s2">(</span><span class="s3">&quot;cycler(lw=['a', 'b', 'c'])&quot;</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># invalid values</span>
                  <span class="s2">(</span><span class="s1">cycler</span><span class="s2">(</span><span class="s3">'waka'</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">]), </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># not a property</span>
                  <span class="s2">(</span><span class="s1">cycler</span><span class="s2">(</span><span class="s3">'color'</span><span class="s2">, [</span><span class="s3">'C1'</span><span class="s2">, </span><span class="s3">'r'</span><span class="s2">, </span><span class="s3">'g'</span><span class="s2">]), </span><span class="s1">ValueError</span><span class="s2">)  </span><span class="s5"># no CN</span>
                  <span class="s2">)</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">validate_hatch</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s3">'--|'</span><span class="s2">, </span><span class="s3">'--|'</span><span class="s2">), (</span><span class="s3">'</span><span class="s0">\\</span><span class="s3">oO'</span><span class="s2">, </span><span class="s3">'</span><span class="s0">\\</span><span class="s3">oO'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'/+*/.x'</span><span class="s2">, </span><span class="s3">'/+*/.x'</span><span class="s2">), (</span><span class="s3">''</span><span class="s2">, </span><span class="s3">''</span><span class="s2">)),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s3">'--_'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">'X'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">)),</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">validate_colorlist</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s3">'r,g,b'</span><span class="s2">, [</span><span class="s3">'r'</span><span class="s2">, </span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]),</span>
                     <span class="s2">([</span><span class="s3">'r'</span><span class="s2">, </span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">], [</span><span class="s3">'r'</span><span class="s2">, </span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">]),</span>
                     <span class="s2">(</span><span class="s3">'r, ,'</span><span class="s2">, [</span><span class="s3">'r'</span><span class="s2">]),</span>
                     <span class="s2">([</span><span class="s3">''</span><span class="s2">, </span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'blue'</span><span class="s2">], [</span><span class="s3">'g'</span><span class="s2">, </span><span class="s3">'blue'</span><span class="s2">]),</span>
                     <span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])],</span>
                     <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]])),</span>
                     <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]]),</span>
                     <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]])),</span>
                     <span class="s2">),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s3">'fish'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">),</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">validate_color</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s3">'None'</span><span class="s2">, </span><span class="s3">'none'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'none'</span><span class="s2">, </span><span class="s3">'none'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'AABBCC'</span><span class="s2">, </span><span class="s3">'#AABBCC'</span><span class="s2">),  </span><span class="s5"># RGB hex code</span>
                     <span class="s2">(</span><span class="s3">'AABBCC00'</span><span class="s2">, </span><span class="s3">'#AABBCC00'</span><span class="s2">),  </span><span class="s5"># RGBA hex code</span>
                     <span class="s2">(</span><span class="s3">'tab:blue'</span><span class="s2">, </span><span class="s3">'tab:blue'</span><span class="s2">),  </span><span class="s5"># named color</span>
                     <span class="s2">(</span><span class="s3">'C12'</span><span class="s2">, </span><span class="s3">'C12'</span><span class="s2">),  </span><span class="s5"># color from cycle</span>
                     <span class="s2">(</span><span class="s3">'(0, 1, 0)'</span><span class="s2">, (</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">)),  </span><span class="s5"># RGB tuple</span>
                     <span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)),  </span><span class="s5"># non-string version</span>
                     <span class="s2">(</span><span class="s3">'(0, 1, 0, 1)'</span><span class="s2">, (</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">)),  </span><span class="s5"># RGBA tuple</span>
                     <span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)),  </span><span class="s5"># non-string version</span>
                     <span class="s2">),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s3">'tab:veryblue'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># invalid name</span>
                  <span class="s2">(</span><span class="s3">'(0, 1)'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># tuple with length &lt; 3</span>
                  <span class="s2">(</span><span class="s3">'(0, 1, 0, 1, 0)'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># tuple with length &gt; 4</span>
                  <span class="s2">(</span><span class="s3">'(0, 1, none)'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># cannot cast none to float</span>
                  <span class="s2">(</span><span class="s3">'(0, 1, &quot;0.5&quot;)'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># last one not a float</span>
                  <span class="s2">),</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">_validate_color_or_linecolor</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s3">'linecolor'</span><span class="s2">, </span><span class="s3">'linecolor'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'markerfacecolor'</span><span class="s2">, </span><span class="s3">'markerfacecolor'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'mfc'</span><span class="s2">, </span><span class="s3">'markerfacecolor'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'markeredgecolor'</span><span class="s2">, </span><span class="s3">'markeredgecolor'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'mec'</span><span class="s2">, </span><span class="s3">'markeredgecolor'</span><span class="s2">)</span>
                     <span class="s2">),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s3">'line'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">'marker'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">)</span>
                  <span class="s2">)</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">validate_hist_bins</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s3">'auto'</span><span class="s2">, </span><span class="s3">'auto'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'fd'</span><span class="s2">, </span><span class="s3">'fd'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'10'</span><span class="s2">, </span><span class="s4">10</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'1, 2, 3'</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]),</span>
                     <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]),</span>
                     <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">15</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">15</span><span class="s2">))</span>
                     <span class="s2">),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s3">'aardvark'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">)</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">validate_markevery</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">),</span>
                     <span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)),</span>
                     <span class="s2">((</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">), (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">)),</span>
                     <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]),</span>
                     <span class="s2">(</span><span class="s1">slice</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">slice</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)),</span>
                     <span class="s2">(</span><span class="s1">slice</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s1">slice</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))</span>
                     <span class="s2">),</span>
         <span class="s3">'fail'</span><span class="s2">: (((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">([</span><span class="s3">'a'</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">], </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s3">'abc'</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s4">0.1</span><span class="s2">, </span><span class="s3">'b'</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s3">'a'</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">((</span><span class="s3">'a'</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">), </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">'abc'</span><span class="s2">, </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">'a'</span><span class="s2">, </span><span class="s1">TypeError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s1">object</span><span class="s2">(), </span><span class="s1">TypeError</span><span class="s2">)</span>
                  <span class="s2">)</span>
         <span class="s2">},</span>
        <span class="s2">{</span><span class="s3">'validator'</span><span class="s2">: </span><span class="s1">_validate_linestyle</span><span class="s2">,</span>
         <span class="s3">'success'</span><span class="s2">: ((</span><span class="s3">'-'</span><span class="s2">, </span><span class="s3">'-'</span><span class="s2">), (</span><span class="s3">'solid'</span><span class="s2">, </span><span class="s3">'solid'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'--'</span><span class="s2">, </span><span class="s3">'--'</span><span class="s2">), (</span><span class="s3">'dashed'</span><span class="s2">, </span><span class="s3">'dashed'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'-.'</span><span class="s2">, </span><span class="s3">'-.'</span><span class="s2">), (</span><span class="s3">'dashdot'</span><span class="s2">, </span><span class="s3">'dashdot'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">':'</span><span class="s2">, </span><span class="s3">':'</span><span class="s2">), (</span><span class="s3">'dotted'</span><span class="s2">, </span><span class="s3">'dotted'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">''</span><span class="s2">, </span><span class="s3">''</span><span class="s2">), (</span><span class="s3">' '</span><span class="s2">, </span><span class="s3">' '</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'None'</span><span class="s2">, </span><span class="s3">'none'</span><span class="s2">), (</span><span class="s3">'none'</span><span class="s2">, </span><span class="s3">'none'</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">'DoTtEd'</span><span class="s2">, </span><span class="s3">'dotted'</span><span class="s2">),  </span><span class="s5"># case-insensitive</span>
                     <span class="s2">(</span><span class="s3">'1, 3'</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">, (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))),</span>
                     <span class="s2">([</span><span class="s4">1.23</span><span class="s2">, </span><span class="s4">456</span><span class="s2">], (</span><span class="s4">0</span><span class="s2">, [</span><span class="s4">1.23</span><span class="s2">, </span><span class="s4">456.0</span><span class="s2">])),</span>
                     <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], (</span><span class="s4">0</span><span class="s2">, [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">])),</span>
                     <span class="s2">((</span><span class="s4">0</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]), (</span><span class="s4">0</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])),</span>
                     <span class="s2">((-</span><span class="s4">1</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]), (-</span><span class="s4">1</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])),</span>
                     <span class="s2">),</span>
         <span class="s3">'fail'</span><span class="s2">: ((</span><span class="s3">'aardvark'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># not a valid string</span>
                  <span class="s2">(</span><span class="s6">b'dotted'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">(</span><span class="s3">'dotted'</span><span class="s2">.</span><span class="s1">encode</span><span class="s2">(</span><span class="s3">'utf-16'</span><span class="s2">), </span><span class="s1">ValueError</span><span class="s2">),</span>
                  <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># sequence with odd length</span>
                  <span class="s2">(</span><span class="s4">1.23</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># not a sequence</span>
                  <span class="s2">((</span><span class="s3">&quot;a&quot;</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]), </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># wrong explicit offset</span>
                  <span class="s2">((</span><span class="s0">None</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]), </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># wrong explicit offset</span>
                  <span class="s2">((</span><span class="s4">1</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]), </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># odd length sequence</span>
                  <span class="s2">(([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s4">1</span><span class="s2">), </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># inverted offset/onoff</span>
                  <span class="s2">)</span>
         <span class="s2">},</span>
    <span class="s2">)</span>

    <span class="s0">for </span><span class="s1">validator_dict </span><span class="s0">in </span><span class="s1">validation_tests</span><span class="s2">:</span>
        <span class="s1">validator </span><span class="s2">= </span><span class="s1">validator_dict</span><span class="s2">[</span><span class="s3">'validator'</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">valid</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">target </span><span class="s0">in </span><span class="s1">validator_dict</span><span class="s2">[</span><span class="s3">'success'</span><span class="s2">]:</span>
                <span class="s0">yield </span><span class="s1">validator</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">target</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">error_type </span><span class="s0">in </span><span class="s1">validator_dict</span><span class="s2">[</span><span class="s3">'fail'</span><span class="s2">]:</span>
                <span class="s0">yield </span><span class="s1">validator</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">error_type</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'validator, arg, target'</span><span class="s2">,</span>
                         <span class="s1">generate_validator_testcases</span><span class="s2">(</span><span class="s0">True</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_validator_valid</span><span class="s2">(</span><span class="s1">validator</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">target</span><span class="s2">):</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">validator</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">target</span><span class="s2">)</span>
    <span class="s0">elif not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">Cycler</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">res </span><span class="s2">== </span><span class="s1">target</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s5"># Cyclers can't simply be asserted equal. They don't implement __eq__</span>
        <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">res</span><span class="s2">) == </span><span class="s1">list</span><span class="s2">(</span><span class="s1">target</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'validator, arg, exception_type'</span><span class="s2">,</span>
                         <span class="s1">generate_validator_testcases</span><span class="s2">(</span><span class="s0">False</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_validator_invalid</span><span class="s2">(</span><span class="s1">validator</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">exception_type</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">exception_type</span><span class="s2">):</span>
        <span class="s1">validator</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'weight, parsed_weight'</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s3">'bold'</span><span class="s2">, </span><span class="s3">'bold'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s3">'BOLD'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># weight is case-sensitive</span>
    <span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s3">'100'</span><span class="s2">, </span><span class="s4">100</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">100</span><span class="s2">), </span><span class="s4">100</span><span class="s2">),</span>
    <span class="s5"># fractional fontweights are not defined. This should actually raise a</span>
    <span class="s5"># ValueError, but historically did not.</span>
    <span class="s2">(</span><span class="s4">20.6</span><span class="s2">, </span><span class="s4">20</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s3">'20.6'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
    <span class="s2">([</span><span class="s4">100</span><span class="s2">], </span><span class="s1">ValueError</span><span class="s2">),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_validate_fontweight</span><span class="s2">(</span><span class="s1">weight</span><span class="s2">, </span><span class="s1">parsed_weight</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">parsed_weight </span><span class="s0">is </span><span class="s1">ValueError</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">validate_fontweight</span><span class="s2">(</span><span class="s1">weight</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">validate_fontweight</span><span class="s2">(</span><span class="s1">weight</span><span class="s2">) == </span><span class="s1">parsed_weight</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'stretch, parsed_stretch'</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s3">'expanded'</span><span class="s2">, </span><span class="s3">'expanded'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s3">'EXPANDED'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),  </span><span class="s5"># stretch is case-sensitive</span>
    <span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s3">'100'</span><span class="s2">, </span><span class="s4">100</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">100</span><span class="s2">), </span><span class="s4">100</span><span class="s2">),</span>
    <span class="s5"># fractional fontweights are not defined. This should actually raise a</span>
    <span class="s5"># ValueError, but historically did not.</span>
    <span class="s2">(</span><span class="s4">20.6</span><span class="s2">, </span><span class="s4">20</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s3">'20.6'</span><span class="s2">, </span><span class="s1">ValueError</span><span class="s2">),</span>
    <span class="s2">([</span><span class="s4">100</span><span class="s2">], </span><span class="s1">ValueError</span><span class="s2">),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_validate_fontstretch</span><span class="s2">(</span><span class="s1">stretch</span><span class="s2">, </span><span class="s1">parsed_stretch</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">parsed_stretch </span><span class="s0">is </span><span class="s1">ValueError</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">validate_fontstretch</span><span class="s2">(</span><span class="s1">stretch</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">validate_fontstretch</span><span class="s2">(</span><span class="s1">stretch</span><span class="s2">) == </span><span class="s1">parsed_stretch</span>


<span class="s0">def </span><span class="s1">test_keymaps</span><span class="s2">():</span>
    <span class="s1">key_list </span><span class="s2">= [</span><span class="s1">k </span><span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams </span><span class="s0">if </span><span class="s3">'keymap' </span><span class="s0">in </span><span class="s1">k</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">key_list</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s1">k</span><span class="s2">], </span><span class="s1">list</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_no_backend_reset_rccontext</span><span class="s2">():</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'backend'</span><span class="s2">] != </span><span class="s3">'module://aardvark'</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">():</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'backend'</span><span class="s2">] = </span><span class="s3">'module://aardvark'</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'backend'</span><span class="s2">] == </span><span class="s3">'module://aardvark'</span>


<span class="s0">def </span><span class="s1">test_rcparams_reset_after_fail</span><span class="s2">():</span>
    <span class="s5"># There was previously a bug that meant that if rc_context failed and</span>
    <span class="s5"># raised an exception due to issues in the supplied rc parameters, the</span>
    <span class="s5"># global rc parameters were left in a modified state.</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">={</span><span class="s3">'text.usetex'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.usetex'</span><span class="s2">] </span><span class="s0">is False</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">):</span>
            <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">={</span><span class="s3">'text.usetex'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">, </span><span class="s3">'test.blah'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}):</span>
                <span class="s0">pass</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.usetex'</span><span class="s2">] </span><span class="s0">is False</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">platform </span><span class="s2">!= </span><span class="s3">&quot;linux&quot;</span><span class="s2">, </span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Linux only&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_backend_fallback_headless</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">):</span>
    <span class="s1">env </span><span class="s2">= {**</span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">,</span>
           <span class="s3">&quot;DISPLAY&quot;</span><span class="s2">: </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;WAYLAND_DISPLAY&quot;</span><span class="s2">: </span><span class="s3">&quot;&quot;</span><span class="s2">,</span>
           <span class="s3">&quot;MPLBACKEND&quot;</span><span class="s2">: </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;MPLCONFIGDIR&quot;</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">)}</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">CalledProcessError</span><span class="s2">):</span>
        <span class="s1">subprocess_run_for_testing</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">executable</span><span class="s2">, </span><span class="s3">&quot;-c&quot;</span><span class="s2">,</span>
             <span class="s3">&quot;import matplotlib;&quot;</span>
             <span class="s3">&quot;matplotlib.use('tkagg');&quot;</span>
             <span class="s3">&quot;import matplotlib.pyplot;&quot;</span>
             <span class="s3">&quot;matplotlib.pyplot.plot(42);&quot;</span>
             <span class="s2">],</span>
            <span class="s1">env</span><span class="s2">=</span><span class="s1">env</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">stderr</span><span class="s2">=</span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">DEVNULL</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span>
    <span class="s1">sys</span><span class="s2">.</span><span class="s1">platform </span><span class="s2">== </span><span class="s3">&quot;linux&quot; </span><span class="s0">and not </span><span class="s1">_c_internal_utils</span><span class="s2">.</span><span class="s1">display_is_valid</span><span class="s2">(),</span>
    <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;headless&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_backend_fallback_headful</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">):</span>
    <span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;tkinter&quot;</span><span class="s2">)</span>
    <span class="s1">env </span><span class="s2">= {**</span><span class="s1">os</span><span class="s2">.</span><span class="s1">environ</span><span class="s2">, </span><span class="s3">&quot;MPLBACKEND&quot;</span><span class="s2">: </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;MPLCONFIGDIR&quot;</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">)}</span>
    <span class="s1">backend </span><span class="s2">= </span><span class="s1">subprocess_run_for_testing</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">executable</span><span class="s2">, </span><span class="s3">&quot;-c&quot;</span><span class="s2">,</span>
         <span class="s3">&quot;import matplotlib as mpl; &quot;</span>
         <span class="s3">&quot;sentinel = mpl.rcsetup._auto_backend_sentinel; &quot;</span>
         <span class="s5"># Check that access on another instance does not resolve the sentinel.</span>
         <span class="s3">&quot;assert mpl.RcParams({'backend': sentinel})['backend'] == sentinel; &quot;</span>
         <span class="s3">&quot;assert mpl.rcParams._get('backend') == sentinel; &quot;</span>
         <span class="s3">&quot;import matplotlib.pyplot; &quot;</span>
         <span class="s3">&quot;print(matplotlib.get_backend())&quot;</span><span class="s2">],</span>
        <span class="s1">env</span><span class="s2">=</span><span class="s1">env</span><span class="s2">, </span><span class="s1">text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">check</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">capture_output</span><span class="s2">=</span><span class="s0">True</span><span class="s2">).</span><span class="s1">stdout</span>
    <span class="s5"># The actual backend will depend on what's installed, but at least tkagg is</span>
    <span class="s5"># present.</span>
    <span class="s0">assert </span><span class="s1">backend</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">().</span><span class="s1">lower</span><span class="s2">() != </span><span class="s3">&quot;agg&quot;</span>


<span class="s0">def </span><span class="s1">test_deprecation</span><span class="s2">(</span><span class="s1">monkeypatch</span><span class="s2">):</span>
    <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setitem</span><span class="s2">(</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">_deprecated_map</span><span class="s2">, </span><span class="s3">&quot;patch.linewidth&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s3">&quot;0.0&quot;</span><span class="s2">, </span><span class="s3">&quot;axes.linewidth&quot;</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">old</span><span class="s2">: </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">old</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">new</span><span class="s2">: </span><span class="s1">new </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;patch.linewidth&quot;</span><span class="s2">] </span><span class="s1">\</span>
            <span class="s2">== </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;axes.linewidth&quot;</span><span class="s2">] / </span><span class="s4">2</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;patch.linewidth&quot;</span><span class="s2">] = </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;axes.linewidth&quot;</span><span class="s2">] == </span><span class="s4">2</span>

    <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setitem</span><span class="s2">(</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">_deprecated_ignore_map</span><span class="s2">, </span><span class="s3">&quot;patch.edgecolor&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s3">&quot;0.0&quot;</span><span class="s2">, </span><span class="s3">&quot;axes.edgecolor&quot;</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;patch.edgecolor&quot;</span><span class="s2">] </span><span class="s1">\</span>
            <span class="s2">== </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;axes.edgecolor&quot;</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;patch.edgecolor&quot;</span><span class="s2">] = </span><span class="s3">&quot;#abcd&quot;</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;axes.edgecolor&quot;</span><span class="s2">] != </span><span class="s3">&quot;#abcd&quot;</span>

    <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setitem</span><span class="s2">(</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">_deprecated_ignore_map</span><span class="s2">, </span><span class="s3">&quot;patch.force_edgecolor&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s3">&quot;0.0&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;patch.force_edgecolor&quot;</span><span class="s2">] </span><span class="s0">is None</span>

    <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setitem</span><span class="s2">(</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">_deprecated_remain_as_none</span><span class="s2">, </span><span class="s3">&quot;svg.hashsalt&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s3">&quot;0.0&quot;</span><span class="s2">,))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;svg.hashsalt&quot;</span><span class="s2">] = </span><span class="s3">&quot;foobar&quot;</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;svg.hashsalt&quot;</span><span class="s2">] == </span><span class="s3">&quot;foobar&quot;  </span><span class="s5"># Doesn't warn.</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;svg.hashsalt&quot;</span><span class="s2">] = </span><span class="s0">None  </span><span class="s5"># Doesn't warn.</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">())  </span><span class="s5"># Doesn't warn.</span>
    <span class="s5"># Note that the warning suppression actually arises from the</span>
    <span class="s5"># iteration over the updater rcParams being protected by</span>
    <span class="s5"># suppress_matplotlib_deprecation_warning, rather than any explicit check.</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;value&quot;</span><span class="s2">, [</span>
    <span class="s3">&quot;best&quot;</span><span class="s2">,</span>
    <span class="s4">1</span><span class="s2">,</span>
    <span class="s3">&quot;1&quot;</span><span class="s2">,</span>
    <span class="s2">(</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">.7</span><span class="s2">),</span>
    <span class="s2">(-</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">.7</span><span class="s2">),</span>
    <span class="s3">&quot;(0.9, .7)&quot;</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rcparams_legend_loc</span><span class="s2">(</span><span class="s1">value</span><span class="s2">):</span>
    <span class="s5"># rcParams['legend.loc'] should allow any of the following formats.</span>
    <span class="s5"># if any of these are not allowed, an exception will be raised</span>
    <span class="s5"># test for gh issue #22338</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;legend.loc&quot;</span><span class="s2">] = </span><span class="s1">value</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;value&quot;</span><span class="s2">, [</span>
    <span class="s3">&quot;best&quot;</span><span class="s2">,</span>
    <span class="s4">1</span><span class="s2">,</span>
    <span class="s2">(</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">.7</span><span class="s2">),</span>
    <span class="s2">(-</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">.7</span><span class="s2">),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rcparams_legend_loc_from_file</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
    <span class="s5"># rcParams['legend.loc'] should be settable from matplotlibrc.</span>
    <span class="s5"># if any of these are not allowed, an exception will be raised.</span>
    <span class="s5"># test for gh issue #22338</span>
    <span class="s1">rc_path </span><span class="s2">= </span><span class="s1">tmp_path </span><span class="s2">/ </span><span class="s3">&quot;matplotlibrc&quot;</span>
    <span class="s1">rc_path</span><span class="s2">.</span><span class="s1">write_text</span><span class="s2">(</span><span class="s3">f&quot;legend.loc: </span><span class="s0">{</span><span class="s1">value</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">fname</span><span class="s2">=</span><span class="s1">rc_path</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;legend.loc&quot;</span><span class="s2">] == </span><span class="s1">value</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;value&quot;</span><span class="s2">, [(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s3">'1, 2, 3'</span><span class="s2">, </span><span class="s3">'(1, 2, 3)'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_validate_sketch</span><span class="s2">(</span><span class="s1">value</span><span class="s2">):</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;path.sketch&quot;</span><span class="s2">] = </span><span class="s1">value</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;path.sketch&quot;</span><span class="s2">] == (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">validate_sketch</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) == (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;value&quot;</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s3">'1'</span><span class="s2">, </span><span class="s3">'1 2 3'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_validate_sketch_error</span><span class="s2">(</span><span class="s1">value</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;scale, length, randomness&quot;</span><span class="s2">):</span>
        <span class="s1">validate_sketch</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;scale, length, randomness&quot;</span><span class="s2">):</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;path.sketch&quot;</span><span class="s2">] = </span><span class="s1">value</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;value&quot;</span><span class="s2">, [</span><span class="s3">'1, 2, 3'</span><span class="s2">, </span><span class="s3">'(1,2,3)'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rcparams_path_sketch_from_file</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
    <span class="s1">rc_path </span><span class="s2">= </span><span class="s1">tmp_path </span><span class="s2">/ </span><span class="s3">&quot;matplotlibrc&quot;</span>
    <span class="s1">rc_path</span><span class="s2">.</span><span class="s1">write_text</span><span class="s2">(</span><span class="s3">f&quot;path.sketch: </span><span class="s0">{</span><span class="s1">value</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">fname</span><span class="s2">=</span><span class="s1">rc_path</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;path.sketch&quot;</span><span class="s2">] == (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>
</pre>
</body>
</html>