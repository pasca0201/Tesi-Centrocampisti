<html>
<head>
<title>test_solvers.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #5f826b; font-style: italic;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_solvers.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_array_almost_equal</span><span class="s2">, </span><span class="s1">assert_allclose</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>

<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">linalg </span><span class="s0">import </span><span class="s1">solve_sylvester</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">linalg </span><span class="s0">import </span><span class="s1">solve_continuous_lyapunov</span><span class="s2">, </span><span class="s1">solve_discrete_lyapunov</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">linalg </span><span class="s0">import </span><span class="s1">solve_continuous_are</span><span class="s2">, </span><span class="s1">solve_discrete_are</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">linalg </span><span class="s0">import </span><span class="s1">block_diag</span><span class="s2">, </span><span class="s1">solve</span><span class="s2">, </span><span class="s1">LinAlgError</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">sparse</span><span class="s2">.</span><span class="s1">_sputils </span><span class="s0">import </span><span class="s1">matrix</span>


<span class="s0">def </span><span class="s1">_load_data</span><span class="s2">(</span><span class="s1">name</span><span class="s2">):</span>
    <span class="s3">&quot;&quot;&quot; 
    Load npz data file under data/ 
    Returns a copy of the data, rather than keeping the npz file open. 
    &quot;&quot;&quot;</span>
    <span class="s1">filename </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">abspath</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">__file__</span><span class="s2">)),</span>
                            <span class="s4">'data'</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">f</span><span class="s2">.</span><span class="s1">items</span><span class="s2">())</span>


<span class="s0">class </span><span class="s1">TestSolveLyapunov</span><span class="s2">:</span>

    <span class="s1">cases </span><span class="s2">= [</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">9</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], [</span><span class="s5">11</span><span class="s2">, </span><span class="s5">12</span><span class="s2">]])),</span>
        <span class="s6"># a, q all complex.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">+</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">-</span><span class="s5">4.0j</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.0</span><span class="s2">-</span><span class="s5">2j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">+</span><span class="s5">2j</span><span class="s2">], [-</span><span class="s5">1.0</span><span class="s2">-</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">]])),</span>
        <span class="s6"># a real; q complex.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.0</span><span class="s2">-</span><span class="s5">2j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">+</span><span class="s5">2j</span><span class="s2">], [-</span><span class="s5">1.0</span><span class="s2">-</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">]])),</span>
        <span class="s6"># a complex; q real.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">+</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">-</span><span class="s5">4.0j</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [-</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">]])),</span>
        <span class="s6"># An example from Kitagawa, 1977</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">7</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]])),</span>
        <span class="s6"># Companion matrix example. a complex; q real; a.shape[0] = 11</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.100</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.091</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.082</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.073</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.064</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.055</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.046</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.037</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.028</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.019</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.010</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">, </span><span class="s5">1.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">,</span>
                    <span class="s5">0.000</span><span class="s2">+</span><span class="s5">0.j</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">11</span><span class="s2">)),</span>
        <span class="s6"># https://github.com/scipy/scipy/issues/4176</span>
        <span class="s2">(</span><span class="s1">matrix</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">/</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s2">(</span><span class="s1">matrix</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]).</span><span class="s1">T </span><span class="s2">@ </span><span class="s1">matrix</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]).</span><span class="s1">T</span><span class="s2">.</span><span class="s1">T</span><span class="s2">)),</span>
        <span class="s6"># https://github.com/scipy/scipy/issues/4176</span>
        <span class="s2">(</span><span class="s1">matrix</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">/</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">matrix</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]).</span><span class="s1">T </span><span class="s2">@ </span><span class="s1">matrix</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]).</span><span class="s1">T</span><span class="s2">.</span><span class="s1">T</span><span class="s2">))),</span>
        <span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_continuous_squareness_and_shape</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">nsq </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s1">sq </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">solve_continuous_lyapunov</span><span class="s2">, </span><span class="s1">nsq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">solve_continuous_lyapunov</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nsq</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">solve_continuous_lyapunov</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">check_continuous_case</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">q</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">solve_continuous_lyapunov</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">q</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span>
                          <span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">transpose</span><span class="s2">()), </span><span class="s1">q</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">check_discrete_case</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">solve_discrete_lyapunov</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span>
                      <span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">x</span><span class="s2">), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">transpose</span><span class="s2">()) - </span><span class="s1">x</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">*</span><span class="s1">q</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_cases</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">case </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cases</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_continuous_case</span><span class="s2">(</span><span class="s1">case</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">case</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_discrete_case</span><span class="s2">(</span><span class="s1">case</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">case</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_discrete_case</span><span class="s2">(</span><span class="s1">case</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">case</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">method</span><span class="s2">=</span><span class="s4">'direct'</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_discrete_case</span><span class="s2">(</span><span class="s1">case</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">case</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">method</span><span class="s2">=</span><span class="s4">'bilinear'</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestSolveContinuousAre</span><span class="s2">:</span>
    <span class="s1">mat6 </span><span class="s2">= </span><span class="s1">_load_data</span><span class="s2">(</span><span class="s4">'carex_6_data.npz'</span><span class="s2">)</span>
    <span class="s1">mat15 </span><span class="s2">= </span><span class="s1">_load_data</span><span class="s2">(</span><span class="s4">'carex_15_data.npz'</span><span class="s2">)</span>
    <span class="s1">mat18 </span><span class="s2">= </span><span class="s1">_load_data</span><span class="s2">(</span><span class="s4">'carex_18_data.npz'</span><span class="s2">)</span>
    <span class="s1">mat19 </span><span class="s2">= </span><span class="s1">_load_data</span><span class="s2">(</span><span class="s4">'carex_19_data.npz'</span><span class="s2">)</span>
    <span class="s1">mat20 </span><span class="s2">= </span><span class="s1">_load_data</span><span class="s2">(</span><span class="s4">'carex_20_data.npz'</span><span class="s2">)</span>
    <span class="s1">cases </span><span class="s2">= [</span>
        <span class="s6"># Carex examples taken from (with default parameters):</span>
        <span class="s6"># [1] P.BENNER, A.J. LAUB, V. MEHRMANN: 'A Collection of Benchmark</span>
        <span class="s6">#     Examples for the Numerical Solution of Algebraic Riccati</span>
        <span class="s6">#     Equations II: Continuous-Time Case', Tech. Report SPC 95_23,</span>
        <span class="s6">#     Fak. f. Mathematik, TU Chemnitz-Zwickau (Germany), 1995.</span>
        <span class="s6">#</span>
        <span class="s6"># The format of the data is (a, b, q, r, knownfailure), where</span>
        <span class="s6"># knownfailure is None if the test passes or a string</span>
        <span class="s6"># indicating the reason for failure.</span>
        <span class="s6">#</span>
        <span class="s6"># Test Case 0: carex #1</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">([</span><span class="s5">1.</span><span class="s2">], </span><span class="s5">1</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">block_diag</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">),</span>
         <span class="s5">1</span><span class="s2">,</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 1: carex #2</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [-</span><span class="s5">4.5</span><span class="s2">, -</span><span class="s5">3.5</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">9</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">6</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">]]),</span>
         <span class="s5">1</span><span class="s2">,</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 2: carex #3</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1.89</span><span class="s2">, </span><span class="s5">0.39</span><span class="s2">, -</span><span class="s5">5.53</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">0.034</span><span class="s2">, -</span><span class="s5">2.98</span><span class="s2">, </span><span class="s5">2.43</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.034</span><span class="s2">, -</span><span class="s5">0.0011</span><span class="s2">, -</span><span class="s5">0.99</span><span class="s2">, -</span><span class="s5">0.21</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0.36</span><span class="s2">, -</span><span class="s5">1.6</span><span class="s2">], [-</span><span class="s5">0.95</span><span class="s2">, -</span><span class="s5">0.032</span><span class="s2">], [</span><span class="s5">0.03</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.313</span><span class="s2">, </span><span class="s5">2.727</span><span class="s2">, </span><span class="s5">0.688</span><span class="s2">, </span><span class="s5">0.023</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">2.727</span><span class="s2">, </span><span class="s5">4.271</span><span class="s2">, </span><span class="s5">1.148</span><span class="s2">, </span><span class="s5">0.323</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.688</span><span class="s2">, </span><span class="s5">1.148</span><span class="s2">, </span><span class="s5">0.313</span><span class="s2">, </span><span class="s5">0.102</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.023</span><span class="s2">, </span><span class="s5">0.323</span><span class="s2">, </span><span class="s5">0.102</span><span class="s2">, </span><span class="s5">0.083</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 3: carex #4</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">0.991</span><span class="s2">, </span><span class="s5">0.529</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.522</span><span class="s2">, -</span><span class="s5">1.051</span><span class="s2">, </span><span class="s5">0.596</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.522</span><span class="s2">, -</span><span class="s5">1.118</span><span class="s2">, </span><span class="s5">0.596</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.522</span><span class="s2">, -</span><span class="s5">1.548</span><span class="s2">, </span><span class="s5">0.718</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.922</span><span class="s2">, -</span><span class="s5">1.64</span><span class="s2">, </span><span class="s5">0.799</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.922</span><span class="s2">, -</span><span class="s5">1.721</span><span class="s2">, </span><span class="s5">0.901</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.922</span><span class="s2">, -</span><span class="s5">1.823</span><span class="s2">, </span><span class="s5">1.021</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.922</span><span class="s2">, -</span><span class="s5">1.943</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3.84</span><span class="s2">, </span><span class="s5">4.00</span><span class="s2">, </span><span class="s5">37.60</span><span class="s2">, </span><span class="s5">3.08</span><span class="s2">, </span><span class="s5">2.36</span><span class="s2">, </span><span class="s5">2.88</span><span class="s2">, </span><span class="s5">3.08</span><span class="s2">, </span><span class="s5">3.00</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">2.88</span><span class="s2">, -</span><span class="s5">3.04</span><span class="s2">, -</span><span class="s5">2.80</span><span class="s2">, -</span><span class="s5">2.32</span><span class="s2">, -</span><span class="s5">3.32</span><span class="s2">, -</span><span class="s5">3.82</span><span class="s2">, -</span><span class="s5">4.12</span><span class="s2">, -</span><span class="s5">3.96</span><span class="s2">]]</span>
                  <span class="s2">).</span><span class="s1">T </span><span class="s2">* </span><span class="s5">0.001</span><span class="s2">,</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 4: carex #5</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
          <span class="s2">[[-</span><span class="s5">4.019</span><span class="s2">, </span><span class="s5">5.120</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, -</span><span class="s5">2.082</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.870</span><span class="s2">],</span>
           <span class="s2">[-</span><span class="s5">0.346</span><span class="s2">, </span><span class="s5">0.986</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, -</span><span class="s5">2.340</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.970</span><span class="s2">],</span>
           <span class="s2">[-</span><span class="s5">7.909</span><span class="s2">, </span><span class="s5">15.407</span><span class="s2">, -</span><span class="s5">4.069</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, -</span><span class="s5">6.450</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">2.680</span><span class="s2">],</span>
           <span class="s2">[-</span><span class="s5">21.816</span><span class="s2">, </span><span class="s5">35.606</span><span class="s2">, -</span><span class="s5">0.339</span><span class="s2">, -</span><span class="s5">3.870</span><span class="s2">, -</span><span class="s5">17.800</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">7.390</span><span class="s2">],</span>
           <span class="s2">[-</span><span class="s5">60.196</span><span class="s2">, </span><span class="s5">98.188</span><span class="s2">, -</span><span class="s5">7.907</span><span class="s2">, </span><span class="s5">0.340</span><span class="s2">, -</span><span class="s5">53.008</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">20.400</span><span class="s2">],</span>
           <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">94.000</span><span class="s2">, -</span><span class="s5">147.200</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">53.200</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">],</span>
           <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">94.000</span><span class="s2">, -</span><span class="s5">147.200</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
           <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">12.800</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">, -</span><span class="s5">31.600</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
           <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">12.800</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">18.800</span><span class="s2">, -</span><span class="s5">31.600</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.010</span><span class="s2">, -</span><span class="s5">0.011</span><span class="s2">, -</span><span class="s5">0.151</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.003</span><span class="s2">, -</span><span class="s5">0.021</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.009</span><span class="s2">, -</span><span class="s5">0.059</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.024</span><span class="s2">, -</span><span class="s5">0.162</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.068</span><span class="s2">, -</span><span class="s5">0.445</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">9</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 5: carex #6</span>
        <span class="s2">(</span><span class="s1">mat6</span><span class="s2">[</span><span class="s4">'A'</span><span class="s2">], </span><span class="s1">mat6</span><span class="s2">[</span><span class="s4">'B'</span><span class="s2">], </span><span class="s1">mat6</span><span class="s2">[</span><span class="s4">'Q'</span><span class="s2">], </span><span class="s1">mat6</span><span class="s2">[</span><span class="s4">'R'</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 6: carex #7</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1e-6</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)),</span>
         <span class="s5">1.</span><span class="s2">,</span>
         <span class="s4">'Bad residual accuracy'</span><span class="s2">),</span>
        <span class="s6"># Test Case 7: carex #8</span>
        <span class="s2">(</span><span class="s1">block_diag</span><span class="s2">(-</span><span class="s5">0.1</span><span class="s2">, -</span><span class="s5">0.02</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.100</span><span class="s2">, </span><span class="s5">0.000</span><span class="s2">], [</span><span class="s5">0.001</span><span class="s2">, </span><span class="s5">0.010</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">100</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">], [</span><span class="s5">1000</span><span class="s2">, </span><span class="s5">10000</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)) + </span><span class="s1">block_diag</span><span class="s2">(</span><span class="s5">1e-6</span><span class="s2">, </span><span class="s5">0</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 8: carex #9</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1e6</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1.</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s5">1.</span><span class="s2">,</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 9: carex #10</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0000001</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">1.0000001</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 10: carex #11</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">11</span><span class="s2">, -</span><span class="s5">5</span><span class="s2">], [-</span><span class="s5">5</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">]]),</span>
         <span class="s5">1.</span><span class="s2">,</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 11: carex #12</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">7000000.</span><span class="s2">, </span><span class="s5">2000000.</span><span class="s2">, -</span><span class="s5">0.</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">2000000.</span><span class="s2">, </span><span class="s5">6000000.</span><span class="s2">, -</span><span class="s5">2000000.</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.</span><span class="s2">, -</span><span class="s5">2000000.</span><span class="s2">, </span><span class="s5">5000000.</span><span class="s2">]]) / </span><span class="s5">3</span><span class="s2">,</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">], [-</span><span class="s5">2.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">], [-</span><span class="s5">2.</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">]]).</span><span class="s1">dot</span><span class="s2">(</span>
                <span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">([</span><span class="s5">1e-6</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1e6</span><span class="s2">])).</span><span class="s1">dot</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">], [-</span><span class="s5">2.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">], [-</span><span class="s5">2.</span><span class="s2">, -</span><span class="s5">2.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">]])) / </span><span class="s5">9</span><span class="s2">,</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">) * </span><span class="s5">1e6</span><span class="s2">,</span>
         <span class="s4">'Bad Residual Accuracy'</span><span class="s2">),</span>
        <span class="s6"># Test Case 12: carex #13</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.345</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">0.524e6</span><span class="s2">, -</span><span class="s5">0.465e6</span><span class="s2">, </span><span class="s5">0.262e6</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1e6</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1e6</span><span class="s2">]]).</span><span class="s1">T</span><span class="s2">,</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]),</span>
         <span class="s5">1.</span><span class="s2">,</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 13: carex #14</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">1e-6</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1e-6</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1e-6</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1e-6</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)),</span>
         <span class="s5">1.</span><span class="s2">,</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 14: carex #15</span>
        <span class="s2">(</span><span class="s1">mat15</span><span class="s2">[</span><span class="s4">'A'</span><span class="s2">], </span><span class="s1">mat15</span><span class="s2">[</span><span class="s4">'B'</span><span class="s2">], </span><span class="s1">mat15</span><span class="s2">[</span><span class="s4">'Q'</span><span class="s2">], </span><span class="s1">mat15</span><span class="s2">[</span><span class="s4">'R'</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 15: carex #16</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">64</span><span class="s2">, </span><span class="s5">64</span><span class="s2">, </span><span class="s1">k</span><span class="s2">=-</span><span class="s5">1</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">64</span><span class="s2">, </span><span class="s5">64</span><span class="s2">)*(-</span><span class="s5">2.</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">rot90</span><span class="s2">(</span>
                 <span class="s1">block_diag</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">62</span><span class="s2">, </span><span class="s5">62</span><span class="s2">)), </span><span class="s5">1</span><span class="s2">)) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">64</span><span class="s2">, </span><span class="s5">64</span><span class="s2">, </span><span class="s1">k</span><span class="s2">=</span><span class="s5">1</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">64</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">64</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">64</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 16: carex #17</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">20</span><span class="s2">, )), </span><span class="s5">1</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">flipud</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">21</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">21</span><span class="s2">, </span><span class="s5">1</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">21</span><span class="s2">, </span><span class="s5">1</span><span class="s2">).</span><span class="s1">T</span><span class="s2">,</span>
         <span class="s5">1</span><span class="s2">,</span>
         <span class="s4">'Bad Residual Accuracy'</span><span class="s2">),</span>
        <span class="s6"># Test Case 17: carex #18</span>
        <span class="s2">(</span><span class="s1">mat18</span><span class="s2">[</span><span class="s4">'A'</span><span class="s2">], </span><span class="s1">mat18</span><span class="s2">[</span><span class="s4">'B'</span><span class="s2">], </span><span class="s1">mat18</span><span class="s2">[</span><span class="s4">'Q'</span><span class="s2">], </span><span class="s1">mat18</span><span class="s2">[</span><span class="s4">'R'</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># Test Case 18: carex #19</span>
        <span class="s2">(</span><span class="s1">mat19</span><span class="s2">[</span><span class="s4">'A'</span><span class="s2">], </span><span class="s1">mat19</span><span class="s2">[</span><span class="s4">'B'</span><span class="s2">], </span><span class="s1">mat19</span><span class="s2">[</span><span class="s4">'Q'</span><span class="s2">], </span><span class="s1">mat19</span><span class="s2">[</span><span class="s4">'R'</span><span class="s2">],</span>
         <span class="s4">'Bad Residual Accuracy'</span><span class="s2">),</span>
        <span class="s6"># Test Case 19: carex #20</span>
        <span class="s2">(</span><span class="s1">mat20</span><span class="s2">[</span><span class="s4">'A'</span><span class="s2">], </span><span class="s1">mat20</span><span class="s2">[</span><span class="s4">'B'</span><span class="s2">], </span><span class="s1">mat20</span><span class="s2">[</span><span class="s4">'Q'</span><span class="s2">], </span><span class="s1">mat20</span><span class="s2">[</span><span class="s4">'R'</span><span class="s2">],</span>
         <span class="s4">'Bad Residual Accuracy'</span><span class="s2">)</span>
        <span class="s2">]</span>
    <span class="s6"># Makes the minimum precision requirements customized to the test.</span>
    <span class="s6"># Here numbers represent the number of decimals that agrees with zero</span>
    <span class="s6"># matrix when the solution x is plugged in to the equation.</span>
    <span class="s6">#</span>
    <span class="s6"># res = array([[8e-3,1e-16],[1e-16,1e-20]]) --&gt; min_decimal[k] = 2</span>
    <span class="s6">#</span>
    <span class="s6"># If the test is failing use &quot;None&quot; for that entry.</span>
    <span class="s6">#</span>
    <span class="s1">min_decimal </span><span class="s2">= (</span><span class="s5">14</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">11</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">14</span><span class="s2">,</span>
                   <span class="s0">None</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;j, case&quot;</span><span class="s2">, </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">))</span>
    <span class="s0">def </span><span class="s1">test_solve_continuous_are</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">case</span><span class="s2">):</span>
        <span class="s3">&quot;&quot;&quot;Checks if 0 = XA + A'X - XB(R)^{-1} B'X + Q is true&quot;&quot;&quot;</span>
        <span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">knownfailure </span><span class="s2">= </span><span class="s1">case</span>
        <span class="s0">if </span><span class="s1">knownfailure</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">knownfailure</span><span class="s2">)</span>

        <span class="s1">dec </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">min_decimal</span><span class="s2">[</span><span class="s1">j</span><span class="s2">]</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">solve_continuous_are</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">x </span><span class="s2">@ </span><span class="s1">a </span><span class="s2">+ </span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T </span><span class="s2">@ </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">q</span>
        <span class="s1">out_fact </span><span class="s2">= </span><span class="s1">x </span><span class="s2">@ </span><span class="s1">b</span>
        <span class="s1">res </span><span class="s2">-= </span><span class="s1">out_fact </span><span class="s2">@ </span><span class="s1">solve</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">atleast_2d</span><span class="s2">(</span><span class="s1">r</span><span class="s2">), </span><span class="s1">out_fact</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">res</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">dec</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestSolveDiscreteAre</span><span class="s2">:</span>
    <span class="s1">cases </span><span class="s2">= [</span>
        <span class="s6"># Darex examples taken from (with default parameters):</span>
        <span class="s6"># [1] P.BENNER, A.J. LAUB, V. MEHRMANN: 'A Collection of Benchmark</span>
        <span class="s6">#     Examples for the Numerical Solution of Algebraic Riccati</span>
        <span class="s6">#     Equations II: Discrete-Time Case', Tech. Report SPC 95_23,</span>
        <span class="s6">#     Fak. f. Mathematik, TU Chemnitz-Zwickau (Germany), 1995.</span>
        <span class="s6"># [2] T. GUDMUNDSSON, C. KENNEY, A.J. LAUB: 'Scaling of the</span>
        <span class="s6">#     Discrete-Time Algebraic Riccati Equation to Enhance Stability</span>
        <span class="s6">#     of the Schur Solution Method', IEEE Trans.Aut.Cont., vol.37(4)</span>
        <span class="s6">#</span>
        <span class="s6"># The format of the data is (a, b, q, r, knownfailure), where</span>
        <span class="s6"># knownfailure is None if the test passes or a string</span>
        <span class="s6"># indicating the reason for failure.</span>
        <span class="s6">#</span>
        <span class="s6"># TEST CASE 0 : Complex a; real b, q, r</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">-</span><span class="s5">2j</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">3j</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 1 :Real a, q, r; complex b</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">2j</span><span class="s2">], [</span><span class="s5">1j</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 2 : Real a, b; complex q, r</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">+</span><span class="s5">1j</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">-</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">2j</span><span class="s2">], [</span><span class="s5">2j</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 3 : User-reported gh-2251 (Trac #1732)</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.63399379</span><span class="s2">, </span><span class="s5">0.54906824</span><span class="s2">, </span><span class="s5">0.76253406</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.5404729</span><span class="s2">, </span><span class="s5">0.53745766</span><span class="s2">, </span><span class="s5">0.08731853</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.27524045</span><span class="s2">, </span><span class="s5">0.84922129</span><span class="s2">, </span><span class="s5">0.4681622</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.96861695</span><span class="s2">], [</span><span class="s5">0.05532739</span><span class="s2">], [</span><span class="s5">0.78934047</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">1</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 4 : darex #1</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [-</span><span class="s5">4.5</span><span class="s2">, -</span><span class="s5">3.5</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">9</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">6</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 5 : darex #2</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.9512</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.9048</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">4.877</span><span class="s2">, </span><span class="s5">4.877</span><span class="s2">], [-</span><span class="s5">1.1895</span><span class="s2">, </span><span class="s5">3.569</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.005</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">/</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 6 : darex #3</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 7 : darex #4 (skipped the gen. Ric. term S)</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">4</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">], [-</span><span class="s5">4</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]]) * (</span><span class="s5">1</span><span class="s2">/</span><span class="s5">11</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">9</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 8 : darex #5</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 9 : darex #6</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.998</span><span class="s2">, </span><span class="s5">0.067</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">.067</span><span class="s2">, </span><span class="s5">0.998</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.998</span><span class="s2">, </span><span class="s5">0.153</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">.153</span><span class="s2">, </span><span class="s5">0.998</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.0033</span><span class="s2">, </span><span class="s5">0.0200</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.1000</span><span class="s2">, -</span><span class="s5">.0007</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0400</span><span class="s2">, </span><span class="s5">0.0073</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">.0028</span><span class="s2">, </span><span class="s5">0.1000</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.87</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">0.244</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.744</span><span class="s2">, </span><span class="s5">0.205</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.205</span><span class="s2">, </span><span class="s5">0.589</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">0.244</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.048</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 10 : darex #7</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.984750</span><span class="s2">, -</span><span class="s5">.079903</span><span class="s2">, </span><span class="s5">0.0009054</span><span class="s2">, -</span><span class="s5">.0010765</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.041588</span><span class="s2">, </span><span class="s5">0.998990</span><span class="s2">, -</span><span class="s5">.0358550</span><span class="s2">, </span><span class="s5">0.0126840</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">.546620</span><span class="s2">, </span><span class="s5">0.044916</span><span class="s2">, -</span><span class="s5">.3299100</span><span class="s2">, </span><span class="s5">0.1931800</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">2.662400</span><span class="s2">, -</span><span class="s5">.100450</span><span class="s2">, -</span><span class="s5">.9245500</span><span class="s2">, -</span><span class="s5">.2632500</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.0037112</span><span class="s2">, </span><span class="s5">0.0007361</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">.0870510</span><span class="s2">, </span><span class="s5">9.3411e-6</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">1.198440</span><span class="s2">, -</span><span class="s5">4.1378e-4</span><span class="s2">],</span>
                   <span class="s2">[-</span><span class="s5">3.192700</span><span class="s2">, </span><span class="s5">9.2535e-4</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)*</span><span class="s5">1e-2</span><span class="s2">,</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 11 : darex #8</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">0.6000000</span><span class="s2">, -</span><span class="s5">2.2000000</span><span class="s2">, -</span><span class="s5">3.6000000</span><span class="s2">, -</span><span class="s5">5.4000180</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">1.0000000</span><span class="s2">, </span><span class="s5">0.6000000</span><span class="s2">, </span><span class="s5">0.8000000</span><span class="s2">, </span><span class="s5">3.3999820</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0000000</span><span class="s2">, </span><span class="s5">1.0000000</span><span class="s2">, </span><span class="s5">1.8000000</span><span class="s2">, </span><span class="s5">3.7999820</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0000000</span><span class="s2">, </span><span class="s5">0.0000000</span><span class="s2">, </span><span class="s5">0.0000000</span><span class="s2">, -</span><span class="s5">0.9999820</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">6</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">11</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">6</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">11</span><span class="s2">, </span><span class="s5">22</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">4</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 12 : darex #9</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">95.4070</span><span class="s2">, </span><span class="s5">1.9643</span><span class="s2">, </span><span class="s5">0.3597</span><span class="s2">, </span><span class="s5">0.0673</span><span class="s2">, </span><span class="s5">0.0190</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">40.8490</span><span class="s2">, </span><span class="s5">41.3170</span><span class="s2">, </span><span class="s5">16.0840</span><span class="s2">, </span><span class="s5">4.4679</span><span class="s2">, </span><span class="s5">1.1971</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">12.2170</span><span class="s2">, </span><span class="s5">26.3260</span><span class="s2">, </span><span class="s5">36.1490</span><span class="s2">, </span><span class="s5">15.9300</span><span class="s2">, </span><span class="s5">12.3830</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">4.1118</span><span class="s2">, </span><span class="s5">12.8580</span><span class="s2">, </span><span class="s5">27.2090</span><span class="s2">, </span><span class="s5">21.4420</span><span class="s2">, </span><span class="s5">40.9760</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.1305</span><span class="s2">, </span><span class="s5">0.5808</span><span class="s2">, </span><span class="s5">1.8750</span><span class="s2">, </span><span class="s5">3.6162</span><span class="s2">, </span><span class="s5">94.2800</span><span class="s2">]]) * </span><span class="s5">0.01</span><span class="s2">,</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.0434</span><span class="s2">, -</span><span class="s5">0.0122</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">2.6606</span><span class="s2">, -</span><span class="s5">1.0453</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">3.7530</span><span class="s2">, -</span><span class="s5">5.5100</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">3.6076</span><span class="s2">, -</span><span class="s5">6.6000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.4617</span><span class="s2">, -</span><span class="s5">0.9148</span><span class="s2">]]) * </span><span class="s5">0.01</span><span class="s2">,</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">5</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 13 : darex #10</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">kron</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">k</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">kron</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]])),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 14 : darex #11</span>
        <span class="s2">(</span><span class="s5">0.001 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
         <span class="s2">[[</span><span class="s5">870.1</span><span class="s2">, </span><span class="s5">135.0</span><span class="s2">, </span><span class="s5">11.59</span><span class="s2">, </span><span class="s5">.5014</span><span class="s2">, -</span><span class="s5">37.22</span><span class="s2">, </span><span class="s5">.3484</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4.242</span><span class="s2">, </span><span class="s5">7.249</span><span class="s2">],</span>
          <span class="s2">[</span><span class="s5">76.55</span><span class="s2">, </span><span class="s5">897.4</span><span class="s2">, </span><span class="s5">12.72</span><span class="s2">, </span><span class="s5">0.5504</span><span class="s2">, -</span><span class="s5">40.16</span><span class="s2">, </span><span class="s5">.3743</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">4.53</span><span class="s2">, </span><span class="s5">7.499</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">127.2</span><span class="s2">, </span><span class="s5">357.5</span><span class="s2">, </span><span class="s5">817</span><span class="s2">, </span><span class="s5">1.455</span><span class="s2">, -</span><span class="s5">102.8</span><span class="s2">, </span><span class="s5">.987</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">11.85</span><span class="s2">, </span><span class="s5">18.72</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">363.5</span><span class="s2">, </span><span class="s5">633.9</span><span class="s2">, </span><span class="s5">74.91</span><span class="s2">, </span><span class="s5">796.6</span><span class="s2">, -</span><span class="s5">273.5</span><span class="s2">, </span><span class="s5">2.653</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">31.72</span><span class="s2">, </span><span class="s5">48.82</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">960</span><span class="s2">, </span><span class="s5">1645.9</span><span class="s2">, -</span><span class="s5">128.9</span><span class="s2">, -</span><span class="s5">5.597</span><span class="s2">, </span><span class="s5">71.42</span><span class="s2">, </span><span class="s5">7.108</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">84.52</span><span class="s2">, </span><span class="s5">125.9</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">664.4</span><span class="s2">, </span><span class="s5">112.96</span><span class="s2">, -</span><span class="s5">88.89</span><span class="s2">, -</span><span class="s5">3.854</span><span class="s2">, </span><span class="s5">84.47</span><span class="s2">, </span><span class="s5">13.6</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">144.3</span><span class="s2">, </span><span class="s5">101.6</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">410.2</span><span class="s2">, </span><span class="s5">693</span><span class="s2">, -</span><span class="s5">54.71</span><span class="s2">, -</span><span class="s5">2.371</span><span class="s2">, </span><span class="s5">66.49</span><span class="s2">, </span><span class="s5">12.49</span><span class="s2">, </span><span class="s5">.1063</span><span class="s2">, </span><span class="s5">99.97</span><span class="s2">, </span><span class="s5">69.67</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">179.9</span><span class="s2">, </span><span class="s5">301.7</span><span class="s2">, -</span><span class="s5">23.93</span><span class="s2">, -</span><span class="s5">1.035</span><span class="s2">, </span><span class="s5">60.59</span><span class="s2">, </span><span class="s5">22.16</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">213.9</span><span class="s2">, </span><span class="s5">35.54</span><span class="s2">],</span>
          <span class="s2">[-</span><span class="s5">345.1</span><span class="s2">, </span><span class="s5">580.4</span><span class="s2">, -</span><span class="s5">45.96</span><span class="s2">, -</span><span class="s5">1.989</span><span class="s2">, </span><span class="s5">105.6</span><span class="s2">, </span><span class="s5">19.86</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">219.1</span><span class="s2">, </span><span class="s5">215.2</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">4.7600</span><span class="s2">, -</span><span class="s5">0.5701</span><span class="s2">, -</span><span class="s5">83.6800</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.8790</span><span class="s2">, -</span><span class="s5">4.7730</span><span class="s2">, -</span><span class="s5">2.7300</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">1.4820</span><span class="s2">, -</span><span class="s5">13.1200</span><span class="s2">, </span><span class="s5">8.8760</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">3.8920</span><span class="s2">, -</span><span class="s5">35.1300</span><span class="s2">, </span><span class="s5">24.8000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">10.3400</span><span class="s2">, -</span><span class="s5">92.7500</span><span class="s2">, </span><span class="s5">66.8000</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.2030</span><span class="s2">, -</span><span class="s5">61.5900</span><span class="s2">, </span><span class="s5">38.3400</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">4.4540</span><span class="s2">, -</span><span class="s5">36.8300</span><span class="s2">, </span><span class="s5">20.2900</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">1.9710</span><span class="s2">, -</span><span class="s5">15.5400</span><span class="s2">, </span><span class="s5">6.9370</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">3.7730</span><span class="s2">, -</span><span class="s5">30.2800</span><span class="s2">, </span><span class="s5">14.6900</span><span class="s2">]]) * </span><span class="s5">0.001</span><span class="s2">,</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">([</span><span class="s5">50</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 15 : darex #12 - numerically least accurate example</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1e6</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">]]),</span>
        <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 16 : darex #13</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">16</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">],</span>
                  <span class="s2">[</span><span class="s5">10</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, -</span><span class="s5">8</span><span class="s2">],</span>
                  <span class="s2">[-</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">8</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]]) * (</span><span class="s5">1</span><span class="s2">/</span><span class="s5">9</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s5">1e6 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s5">1e6 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
        <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 17 : darex #14</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1 </span><span class="s2">- </span><span class="s5">1</span><span class="s2">/</span><span class="s5">1e8</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                  <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                  <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                  <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1e-08</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.25</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># TEST CASE 18 : darex #15</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s1">k</span><span class="s2">=</span><span class="s5">1</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">flipud</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">100</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s0">None</span><span class="s2">)</span>
        <span class="s2">]</span>

    <span class="s6"># Makes the minimum precision requirements customized to the test.</span>
    <span class="s6"># Here numbers represent the number of decimals that agrees with zero</span>
    <span class="s6"># matrix when the solution x is plugged in to the equation.</span>
    <span class="s6">#</span>
    <span class="s6"># res = array([[8e-3,1e-16],[1e-16,1e-20]]) --&gt; min_decimal[k] = 2</span>
    <span class="s6">#</span>
    <span class="s6"># If the test is failing use &quot;None&quot; for that entry.</span>
    <span class="s6">#</span>
    <span class="s1">min_decimal </span><span class="s2">= (</span><span class="s5">12</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">13</span><span class="s2">,</span>
                   <span class="s5">14</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">max_tol </span><span class="s2">= [</span><span class="s5">1.5 </span><span class="s2">* </span><span class="s5">10</span><span class="s2">**-</span><span class="s1">ind </span><span class="s0">for </span><span class="s1">ind </span><span class="s0">in </span><span class="s1">min_decimal</span><span class="s2">]</span>
    <span class="s6"># relaxed tolerance in gh-18012 after bump to OpenBLAS</span>
    <span class="s1">max_tol</span><span class="s2">[</span><span class="s5">11</span><span class="s2">] = </span><span class="s5">2.5e-13</span>

    <span class="s6"># relaxed tolerance in gh-20335 for linux-aarch64 build on Cirrus</span>
    <span class="s6"># with OpenBLAS from ubuntu jammy</span>
    <span class="s1">max_tol</span><span class="s2">[</span><span class="s5">15</span><span class="s2">] = </span><span class="s5">2.0e-2</span>

    <span class="s6"># relaxed tolerance in gh-20335 for OpenBLAS 3.20 on ubuntu jammy</span>
    <span class="s6"># bump not needed for OpenBLAS 3.26</span>
    <span class="s1">max_tol</span><span class="s2">[</span><span class="s5">16</span><span class="s2">] = </span><span class="s5">2.0e-4</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;j, case&quot;</span><span class="s2">, </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">))</span>
    <span class="s0">def </span><span class="s1">test_solve_discrete_are</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">case</span><span class="s2">):</span>
        <span class="s3">&quot;&quot;&quot;Checks if X = A'XA-(A'XB)(R+B'XB)^-1(B'XA)+Q) is true&quot;&quot;&quot;</span>
        <span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">knownfailure </span><span class="s2">= </span><span class="s1">case</span>
        <span class="s0">if </span><span class="s1">knownfailure</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">knownfailure</span><span class="s2">)</span>

        <span class="s1">atol </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">max_tol</span><span class="s2">[</span><span class="s1">j</span><span class="s2">]</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">solve_discrete_are</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">bH </span><span class="s2">= </span><span class="s1">b</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span>
        <span class="s1">xa</span><span class="s2">, </span><span class="s1">xb </span><span class="s2">= </span><span class="s1">x </span><span class="s2">@ </span><span class="s1">a</span><span class="s2">, </span><span class="s1">x </span><span class="s2">@ </span><span class="s1">b</span>

        <span class="s1">res </span><span class="s2">= </span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T </span><span class="s2">@ </span><span class="s1">xa </span><span class="s2">- </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">q</span>
        <span class="s1">res </span><span class="s2">-= </span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T </span><span class="s2">@ </span><span class="s1">xb </span><span class="s2">@ (</span><span class="s1">solve</span><span class="s2">(</span><span class="s1">r </span><span class="s2">+ </span><span class="s1">bH </span><span class="s2">@ </span><span class="s1">xb</span><span class="s2">, </span><span class="s1">bH</span><span class="s2">) @ </span><span class="s1">xa</span><span class="s2">)</span>

        <span class="s6"># changed from</span>
        <span class="s6"># assert_array_almost_equal(res, np.zeros_like(res), decimal=dec)</span>
        <span class="s6"># in gh-18012 as it's easier to relax a tolerance and allclose is</span>
        <span class="s6"># preferred</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">res</span><span class="s2">), </span><span class="s1">atol</span><span class="s2">=</span><span class="s1">atol</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_infeasible</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># An infeasible example taken from https://arxiv.org/abs/1505.04861v1</span>
        <span class="s1">A </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">triu</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)))</span>
        <span class="s1">A</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">] = -</span><span class="s5">1</span>
        <span class="s1">B </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]).</span><span class="s1">T</span>
        <span class="s1">Q </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full_like</span><span class="s2">(</span><span class="s1">A</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">([</span><span class="s5">8</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1.9</span><span class="s2">])</span>
        <span class="s1">R </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">([-</span><span class="s5">10</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">LinAlgError</span><span class="s2">, </span><span class="s1">solve_continuous_are</span><span class="s2">, </span><span class="s1">A</span><span class="s2">, </span><span class="s1">B</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">, </span><span class="s1">R</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_solve_generalized_continuous_are</span><span class="s2">():</span>
    <span class="s1">cases </span><span class="s2">= [</span>
        <span class="s6"># Two random examples differ by s term</span>
        <span class="s6"># in the absence of any literature for demanding examples.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.769230e-01</span><span class="s2">, </span><span class="s5">8.234578e-01</span><span class="s2">, </span><span class="s5">9.502220e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">4.617139e-02</span><span class="s2">, </span><span class="s5">6.948286e-01</span><span class="s2">, </span><span class="s5">3.444608e-02</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">9.713178e-02</span><span class="s2">, </span><span class="s5">3.170995e-01</span><span class="s2">, </span><span class="s5">4.387444e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3.815585e-01</span><span class="s2">, </span><span class="s5">1.868726e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.655168e-01</span><span class="s2">, </span><span class="s5">4.897644e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.951999e-01</span><span class="s2">, </span><span class="s5">4.455862e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">6.463130e-01</span><span class="s2">, </span><span class="s5">2.760251e-01</span><span class="s2">, </span><span class="s5">1.626117e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.093648e-01</span><span class="s2">, </span><span class="s5">6.797027e-01</span><span class="s2">, </span><span class="s5">1.189977e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.546867e-01</span><span class="s2">, </span><span class="s5">6.550980e-01</span><span class="s2">, </span><span class="s5">4.983641e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.769230e-01</span><span class="s2">, </span><span class="s5">8.234578e-01</span><span class="s2">, </span><span class="s5">9.502220e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">4.617139e-02</span><span class="s2">, </span><span class="s5">6.948286e-01</span><span class="s2">, </span><span class="s5">3.444608e-02</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">9.713178e-02</span><span class="s2">, </span><span class="s5">3.170995e-01</span><span class="s2">, </span><span class="s5">4.387444e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3.815585e-01</span><span class="s2">, </span><span class="s5">1.868726e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.655168e-01</span><span class="s2">, </span><span class="s5">4.897644e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.951999e-01</span><span class="s2">, </span><span class="s5">4.455862e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">6.463130e-01</span><span class="s2">, </span><span class="s5">2.760251e-01</span><span class="s2">, </span><span class="s5">1.626117e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.093648e-01</span><span class="s2">, </span><span class="s5">6.797027e-01</span><span class="s2">, </span><span class="s5">1.189977e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.546867e-01</span><span class="s2">, </span><span class="s5">6.550980e-01</span><span class="s2">, </span><span class="s5">4.983641e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)),</span>
         <span class="s0">None</span><span class="s2">)</span>
        <span class="s2">]</span>

    <span class="s1">min_decimal </span><span class="s2">= (</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">_test_factory</span><span class="s2">(</span><span class="s1">case</span><span class="s2">, </span><span class="s1">dec</span><span class="s2">):</span>
        <span class="s3">&quot;&quot;&quot;Checks if X = A'XA-(A'XB)(R+B'XB)^-1(B'XA)+Q) is true&quot;&quot;&quot;</span>
        <span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">e</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s1">knownfailure </span><span class="s2">= </span><span class="s1">case</span>
        <span class="s0">if </span><span class="s1">knownfailure</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">knownfailure</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">solve_continuous_are</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">e</span><span class="s2">, </span><span class="s1">s</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)) + </span><span class="s1">e</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)) + </span><span class="s1">q</span>
        <span class="s1">out_fact </span><span class="s2">= </span><span class="s1">e</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">).</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">b</span><span class="s2">) + </span><span class="s1">s</span>
        <span class="s1">res </span><span class="s2">-= </span><span class="s1">out_fact</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">solve</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">atleast_2d</span><span class="s2">(</span><span class="s1">r</span><span class="s2">), </span><span class="s1">out_fact</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">res</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">dec</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">ind</span><span class="s2">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">):</span>
        <span class="s1">_test_factory</span><span class="s2">(</span><span class="s1">case</span><span class="s2">, </span><span class="s1">min_decimal</span><span class="s2">[</span><span class="s1">ind</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_solve_generalized_discrete_are</span><span class="s2">():</span>
    <span class="s1">mat20170120 </span><span class="s2">= </span><span class="s1">_load_data</span><span class="s2">(</span><span class="s4">'gendare_20170120_data.npz'</span><span class="s2">)</span>

    <span class="s1">cases </span><span class="s2">= [</span>
        <span class="s6"># Two random examples differ by s term</span>
        <span class="s6"># in the absence of any literature for demanding examples.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.769230e-01</span><span class="s2">, </span><span class="s5">8.234578e-01</span><span class="s2">, </span><span class="s5">9.502220e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">4.617139e-02</span><span class="s2">, </span><span class="s5">6.948286e-01</span><span class="s2">, </span><span class="s5">3.444608e-02</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">9.713178e-02</span><span class="s2">, </span><span class="s5">3.170995e-01</span><span class="s2">, </span><span class="s5">4.387444e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3.815585e-01</span><span class="s2">, </span><span class="s5">1.868726e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.655168e-01</span><span class="s2">, </span><span class="s5">4.897644e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.951999e-01</span><span class="s2">, </span><span class="s5">4.455862e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">6.463130e-01</span><span class="s2">, </span><span class="s5">2.760251e-01</span><span class="s2">, </span><span class="s5">1.626117e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.093648e-01</span><span class="s2">, </span><span class="s5">6.797027e-01</span><span class="s2">, </span><span class="s5">1.189977e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.546867e-01</span><span class="s2">, </span><span class="s5">6.550980e-01</span><span class="s2">, </span><span class="s5">4.983641e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.769230e-01</span><span class="s2">, </span><span class="s5">8.234578e-01</span><span class="s2">, </span><span class="s5">9.502220e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">4.617139e-02</span><span class="s2">, </span><span class="s5">6.948286e-01</span><span class="s2">, </span><span class="s5">3.444608e-02</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">9.713178e-02</span><span class="s2">, </span><span class="s5">3.170995e-01</span><span class="s2">, </span><span class="s5">4.387444e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">3.815585e-01</span><span class="s2">, </span><span class="s5">1.868726e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.655168e-01</span><span class="s2">, </span><span class="s5">4.897644e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.951999e-01</span><span class="s2">, </span><span class="s5">4.455862e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">6.463130e-01</span><span class="s2">, </span><span class="s5">2.760251e-01</span><span class="s2">, </span><span class="s5">1.626117e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.093648e-01</span><span class="s2">, </span><span class="s5">6.797027e-01</span><span class="s2">, </span><span class="s5">1.189977e-01</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">7.546867e-01</span><span class="s2">, </span><span class="s5">6.550980e-01</span><span class="s2">, </span><span class="s5">4.983641e-01</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)),</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s6"># user-reported (under PR-6616) 20-Jan-2017</span>
        <span class="s6"># tests against the case where E is None but S is provided</span>
        <span class="s2">(</span><span class="s1">mat20170120</span><span class="s2">[</span><span class="s4">'A'</span><span class="s2">],</span>
         <span class="s1">mat20170120</span><span class="s2">[</span><span class="s4">'B'</span><span class="s2">],</span>
         <span class="s1">mat20170120</span><span class="s2">[</span><span class="s4">'Q'</span><span class="s2">],</span>
         <span class="s1">mat20170120</span><span class="s2">[</span><span class="s4">'R'</span><span class="s2">],</span>
         <span class="s0">None</span><span class="s2">,</span>
         <span class="s1">mat20170120</span><span class="s2">[</span><span class="s4">'S'</span><span class="s2">],</span>
         <span class="s0">None</span><span class="s2">),</span>
        <span class="s2">]</span>

    <span class="s1">max_atol </span><span class="s2">= (</span><span class="s5">1.5e-11</span><span class="s2">, </span><span class="s5">1.5e-11</span><span class="s2">, </span><span class="s5">3.5e-16</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">_test_factory</span><span class="s2">(</span><span class="s1">case</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">):</span>
        <span class="s3">&quot;&quot;&quot;Checks if X = A'XA-(A'XB)(R+B'XB)^-1(B'XA)+Q) is true&quot;&quot;&quot;</span>
        <span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">e</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s1">knownfailure </span><span class="s2">= </span><span class="s1">case</span>
        <span class="s0">if </span><span class="s1">knownfailure</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">knownfailure</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">solve_discrete_are</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">q</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">e</span><span class="s2">, </span><span class="s1">s</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">e </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">e </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
        <span class="s0">if </span><span class="s1">s </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">s </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)) - </span><span class="s1">e</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)) + </span><span class="s1">q</span>
        <span class="s1">res </span><span class="s2">-= (</span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)) + </span><span class="s1">s</span><span class="s2">).</span><span class="s1">dot</span><span class="s2">(</span>
                    <span class="s1">solve</span><span class="s2">(</span><span class="s1">r</span><span class="s2">+</span><span class="s1">b</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)),</span>
                          <span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)) + </span><span class="s1">s</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">().</span><span class="s1">T</span><span class="s2">)</span>
                          <span class="s2">)</span>
                <span class="s2">)</span>
        <span class="s6"># changed from:</span>
        <span class="s6"># assert_array_almost_equal(res, np.zeros_like(res), decimal=dec)</span>
        <span class="s6"># in gh-17950 because of a Linux 32 bit fail.</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">res</span><span class="s2">), </span><span class="s1">atol</span><span class="s2">=</span><span class="s1">atol</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">ind</span><span class="s2">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">):</span>
        <span class="s1">_test_factory</span><span class="s2">(</span><span class="s1">case</span><span class="s2">, </span><span class="s1">max_atol</span><span class="s2">[</span><span class="s1">ind</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_are_validate_args</span><span class="s2">():</span>

    <span class="s0">def </span><span class="s1">test_square_shape</span><span class="s2">():</span>
        <span class="s1">nsq </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s1">sq </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s1">solve_continuous_are</span><span class="s2">, </span><span class="s1">solve_discrete_are</span><span class="s2">):</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">nsq</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nsq</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nsq</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nsq</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_compatible_sizes</span><span class="s2">():</span>
        <span class="s1">nsq </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s1">sq </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s1">solve_continuous_are</span><span class="s2">, </span><span class="s1">solve_discrete_are</span><span class="s2">):</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nsq</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nsq</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">sq</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_symmetry</span><span class="s2">():</span>
        <span class="s1">nsym </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">9</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">sym </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s1">solve_continuous_are</span><span class="s2">, </span><span class="s1">solve_discrete_are</span><span class="s2">):</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">, </span><span class="s1">nsym</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">, </span><span class="s1">nsym</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_singularity</span><span class="s2">():</span>
        <span class="s1">sing </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s5">1e12</span><span class="s2">)</span>
        <span class="s1">sing</span><span class="s2">[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">] -= </span><span class="s5">1</span>
        <span class="s1">sq </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s1">solve_continuous_are</span><span class="s2">, </span><span class="s1">solve_discrete_are</span><span class="s2">):</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sing</span><span class="s2">)</span>

        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">solve_continuous_are</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sing</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_finiteness</span><span class="s2">():</span>
        <span class="s1">nm </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>
        <span class="s1">sq </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s1">solve_continuous_are</span><span class="s2">, </span><span class="s1">solve_discrete_are</span><span class="s2">):</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">nm</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nm</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nm</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nm</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nm</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">sq</span><span class="s2">, </span><span class="s1">nm</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestSolveSylvester</span><span class="s2">:</span>

    <span class="s1">cases </span><span class="s2">= [</span>
        <span class="s6"># a, b, c all real.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">8</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">9</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], [</span><span class="s5">11</span><span class="s2">, </span><span class="s5">12</span><span class="s2">]])),</span>
        <span class="s6"># a, b, c all real, 4x4. a and b have non-trival 2x2 blocks in their</span>
        <span class="s6"># quasi-triangular form.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">]])),</span>
        <span class="s6"># a, b, c all complex.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">+</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">-</span><span class="s5">4.0j</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.0</span><span class="s2">-</span><span class="s5">2j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">+</span><span class="s5">2j</span><span class="s2">], [-</span><span class="s5">1.0</span><span class="s2">-</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">]])),</span>
        <span class="s6"># a and b real; c complex.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.0</span><span class="s2">-</span><span class="s5">2j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">+</span><span class="s5">2j</span><span class="s2">], [-</span><span class="s5">1.0</span><span class="s2">-</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">]])),</span>
        <span class="s6"># a and c complex; b real.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">+</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">-</span><span class="s5">4.0j</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.0</span><span class="s2">-</span><span class="s5">2j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">+</span><span class="s5">2j</span><span class="s2">], [-</span><span class="s5">1.0</span><span class="s2">-</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">]])),</span>
        <span class="s6"># a complex; b and c real.</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">+</span><span class="s5">1j</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">-</span><span class="s5">4.0j</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">], [-</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">]])),</span>
        <span class="s6"># not square matrices, real</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">8</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]])),</span>
        <span class="s6"># not square matrices, complex</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">8</span><span class="s2">, </span><span class="s5">1j</span><span class="s2">, </span><span class="s5">6</span><span class="s2">+</span><span class="s5">2j</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">-</span><span class="s5">1j</span><span class="s2">]]),</span>
         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2j</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4j</span><span class="s2">], [</span><span class="s5">5j</span><span class="s2">, </span><span class="s5">6</span><span class="s2">+</span><span class="s5">7j</span><span class="s2">]])),</span>
    <span class="s2">]</span>

    <span class="s0">def </span><span class="s1">check_case</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">solve_sylvester</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">b</span><span class="s2">), </span><span class="s1">c</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_cases</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">case </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">cases</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">check_case</span><span class="s2">(</span><span class="s1">case</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">case</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">case</span><span class="s2">[</span><span class="s5">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_trivial</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">], [</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">]])</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.0</span><span class="s2">]])</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">]).</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">solve_sylvester</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">c</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">]).</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
</pre>
</body>
</html>