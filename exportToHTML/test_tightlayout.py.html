<html>
<head>
<title>test_tightlayout.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_tightlayout.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_array_equal</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">offsetbox </span><span class="s0">import </span><span class="s1">AnchoredOffsetbox</span><span class="s2">, </span><span class="s1">DrawingArea</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches </span><span class="s0">import </span><span class="s1">Rectangle</span>


<span class="s0">def </span><span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s3">12</span><span class="s2">):</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">locator_params</span><span class="s2">(</span><span class="s1">nbins</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'x-label'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s1">fontsize</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'y-label'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s1">fontsize</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Title'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s1">fontsize</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout1'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s3">1.9</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_tight_layout1</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test tight_layout for a single subplot.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s3">24</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout2'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_tight_layout2</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test tight_layout for multiple subplots.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, ((</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">), (</span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">)) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax2</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax3</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax4</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout3'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_tight_layout3</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test tight_layout for multiple subplots.&quot;&quot;&quot;</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s3">221</span><span class="s2">)</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s3">223</span><span class="s2">)</span>
    <span class="s1">ax3 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s3">122</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax2</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax3</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout4'</span><span class="s2">], </span><span class="s1">freetype_version</span><span class="s2">=(</span><span class="s4">'2.5.5'</span><span class="s2">, </span><span class="s4">'2.6.1'</span><span class="s2">),</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s3">0.015</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_tight_layout4</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test tight_layout for subplot2grid.&quot;&quot;&quot;</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot2grid</span><span class="s2">((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">), (</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">))</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot2grid</span><span class="s2">((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">), (</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">), </span><span class="s1">colspan</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
    <span class="s1">ax3 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot2grid</span><span class="s2">((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">), (</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">), </span><span class="s1">colspan</span><span class="s2">=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">rowspan</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
    <span class="s1">ax4 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot2grid</span><span class="s2">((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">), (</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">rowspan</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax2</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax3</span><span class="s2">)</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax4</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout5'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_tight_layout5</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test tight_layout for image.&quot;&quot;&quot;</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
    <span class="s1">arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">100</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">interpolation</span><span class="s2">=</span><span class="s4">&quot;none&quot;</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout6'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_tight_layout6</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test tight_layout for gridspec.&quot;&quot;&quot;</span>

    <span class="s6"># This raises warnings since tight layout cannot</span>
    <span class="s6"># do this fully automatically. But the test is</span>
    <span class="s6"># correct since the layout is manually edited</span>
    <span class="s0">with </span><span class="s1">warnings</span><span class="s2">.</span><span class="s1">catch_warnings</span><span class="s2">():</span>
        <span class="s1">warnings</span><span class="s2">.</span><span class="s1">simplefilter</span><span class="s2">(</span><span class="s4">&quot;ignore&quot;</span><span class="s2">, </span><span class="s1">UserWarning</span><span class="s2">)</span>
        <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>

        <span class="s1">gs1 </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">gridspec</span><span class="s2">.</span><span class="s1">GridSpec</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>
        <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">gs1</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])</span>
        <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">gs1</span><span class="s2">[</span><span class="s3">1</span><span class="s2">])</span>

        <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">)</span>
        <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax2</span><span class="s2">)</span>

        <span class="s1">gs1</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">rect</span><span class="s2">=[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1</span><span class="s2">])</span>

        <span class="s1">gs2 </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">gridspec</span><span class="s2">.</span><span class="s1">GridSpec</span><span class="s2">(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">ss </span><span class="s0">in </span><span class="s1">gs2</span><span class="s2">:</span>
            <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">ss</span><span class="s2">)</span>
            <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">)</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>

        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;x-label&quot;</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s3">12</span><span class="s2">)</span>

        <span class="s1">gs2</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">rect</span><span class="s2">=[</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">], </span><span class="s1">h_pad</span><span class="s2">=</span><span class="s3">0.45</span><span class="s2">)</span>

        <span class="s1">top </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s1">gs1</span><span class="s2">.</span><span class="s1">top</span><span class="s2">, </span><span class="s1">gs2</span><span class="s2">.</span><span class="s1">top</span><span class="s2">)</span>
        <span class="s1">bottom </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span><span class="s1">gs1</span><span class="s2">.</span><span class="s1">bottom</span><span class="s2">, </span><span class="s1">gs2</span><span class="s2">.</span><span class="s1">bottom</span><span class="s2">)</span>

        <span class="s1">gs1</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">rect</span><span class="s2">=[</span><span class="s0">None</span><span class="s2">, </span><span class="s3">0 </span><span class="s2">+ (</span><span class="s1">bottom</span><span class="s2">-</span><span class="s1">gs1</span><span class="s2">.</span><span class="s1">bottom</span><span class="s2">),</span>
                                    <span class="s3">0.5</span><span class="s2">, </span><span class="s3">1 </span><span class="s2">- (</span><span class="s1">gs1</span><span class="s2">.</span><span class="s1">top</span><span class="s2">-</span><span class="s1">top</span><span class="s2">)])</span>
        <span class="s1">gs2</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">rect</span><span class="s2">=[</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0 </span><span class="s2">+ (</span><span class="s1">bottom</span><span class="s2">-</span><span class="s1">gs2</span><span class="s2">.</span><span class="s1">bottom</span><span class="s2">),</span>
                                    <span class="s0">None</span><span class="s2">, </span><span class="s3">1 </span><span class="s2">- (</span><span class="s1">gs2</span><span class="s2">.</span><span class="s1">top</span><span class="s2">-</span><span class="s1">top</span><span class="s2">)],</span>
                         <span class="s1">h_pad</span><span class="s2">=</span><span class="s3">0.45</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout7'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s3">1.9</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_tight_layout7</span><span class="s2">():</span>
    <span class="s6"># tight layout with left and right titles</span>
    <span class="s1">fontsize </span><span class="s2">= </span><span class="s3">24</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">locator_params</span><span class="s2">(</span><span class="s1">nbins</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'x-label'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s1">fontsize</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'y-label'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s1">fontsize</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Left Title'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s1">fontsize</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Right Title'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s1">fontsize</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout8'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s3">0.005</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_tight_layout8</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test automatic use of tight_layout.&quot;&quot;&quot;</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">set_layout_engine</span><span class="s2">(</span><span class="s1">layout</span><span class="s2">=</span><span class="s4">'tight'</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=</span><span class="s3">0.1</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">example_plot</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s3">24</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout9'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_tight_layout9</span><span class="s2">():</span>
    <span class="s6"># Test tight_layout for non-visible subplots</span>
    <span class="s6"># GH 8244</span>
    <span class="s1">f</span><span class="s2">, </span><span class="s1">axarr </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">)</span>
    <span class="s1">axarr</span><span class="s2">[</span><span class="s3">1</span><span class="s2">][</span><span class="s3">1</span><span class="s2">].</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_outward_ticks</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test automatic use of tight_layout.&quot;&quot;&quot;</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s3">221</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">16</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">16</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span>
        <span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">tick1On</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span>
        <span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">tick1On</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">([</span><span class="s3">0</span><span class="s2">], </span><span class="s1">minor</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">([</span><span class="s3">0</span><span class="s2">], </span><span class="s1">minor</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s3">222</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'in'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'in'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s3">223</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'inout'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'inout'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s3">224</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">tickdir</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s3">32</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
    <span class="s6"># These values were obtained after visual checking that they correspond</span>
    <span class="s6"># to a tight layouting that did take the ticks into account.</span>
    <span class="s1">expected </span><span class="s2">= [</span>
        <span class="s2">[[</span><span class="s3">0.091</span><span class="s2">, </span><span class="s3">0.607</span><span class="s2">], [</span><span class="s3">0.433</span><span class="s2">, </span><span class="s3">0.933</span><span class="s2">]],</span>
        <span class="s2">[[</span><span class="s3">0.579</span><span class="s2">, </span><span class="s3">0.607</span><span class="s2">], [</span><span class="s3">0.922</span><span class="s2">, </span><span class="s3">0.933</span><span class="s2">]],</span>
        <span class="s2">[[</span><span class="s3">0.091</span><span class="s2">, </span><span class="s3">0.140</span><span class="s2">], [</span><span class="s3">0.433</span><span class="s2">, </span><span class="s3">0.466</span><span class="s2">]],</span>
        <span class="s2">[[</span><span class="s3">0.579</span><span class="s2">, </span><span class="s3">0.140</span><span class="s2">], [</span><span class="s3">0.922</span><span class="s2">, </span><span class="s3">0.466</span><span class="s2">]],</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">):</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">round</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">get_points</span><span class="s2">(), </span><span class="s3">3</span><span class="s2">),</span>
                           <span class="s1">expected</span><span class="s2">[</span><span class="s1">nn</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">add_offsetboxes</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s3">10</span><span class="s2">, </span><span class="s1">margin</span><span class="s2">=</span><span class="s3">.1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; 
    Surround ax with OffsetBoxes 
    &quot;&quot;&quot;</span>
    <span class="s1">m</span><span class="s2">, </span><span class="s1">mp </span><span class="s2">= </span><span class="s1">margin</span><span class="s2">, </span><span class="s3">1</span><span class="s2">+</span><span class="s1">margin</span>
    <span class="s1">anchor_points </span><span class="s2">= [(-</span><span class="s1">m</span><span class="s2">, -</span><span class="s1">m</span><span class="s2">), (-</span><span class="s1">m</span><span class="s2">, </span><span class="s3">.5</span><span class="s2">), (-</span><span class="s1">m</span><span class="s2">, </span><span class="s1">mp</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s1">mp</span><span class="s2">, </span><span class="s3">.5</span><span class="s2">), (</span><span class="s3">.5</span><span class="s2">, </span><span class="s1">mp</span><span class="s2">), (</span><span class="s1">mp</span><span class="s2">, </span><span class="s1">mp</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s3">.5</span><span class="s2">, -</span><span class="s1">m</span><span class="s2">), (</span><span class="s1">mp</span><span class="s2">, -</span><span class="s1">m</span><span class="s2">), (</span><span class="s3">.5</span><span class="s2">, -</span><span class="s1">m</span><span class="s2">)]</span>
    <span class="s0">for </span><span class="s1">point </span><span class="s0">in </span><span class="s1">anchor_points</span><span class="s2">:</span>
        <span class="s1">da </span><span class="s2">= </span><span class="s1">DrawingArea</span><span class="s2">(</span><span class="s1">size</span><span class="s2">, </span><span class="s1">size</span><span class="s2">)</span>
        <span class="s1">background </span><span class="s2">= </span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">), </span><span class="s1">width</span><span class="s2">=</span><span class="s1">size</span><span class="s2">,</span>
                               <span class="s1">height</span><span class="s2">=</span><span class="s1">size</span><span class="s2">,</span>
                               <span class="s1">facecolor</span><span class="s2">=</span><span class="s1">color</span><span class="s2">,</span>
                               <span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'None'</span><span class="s2">,</span>
                               <span class="s1">linewidth</span><span class="s2">=</span><span class="s3">0</span><span class="s2">,</span>
                               <span class="s1">antialiased</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">da</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">background</span><span class="s2">)</span>

        <span class="s1">anchored_box </span><span class="s2">= </span><span class="s1">AnchoredOffsetbox</span><span class="s2">(</span>
            <span class="s1">loc</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">,</span>
            <span class="s1">child</span><span class="s2">=</span><span class="s1">da</span><span class="s2">,</span>
            <span class="s1">pad</span><span class="s2">=</span><span class="s3">0.</span><span class="s2">,</span>
            <span class="s1">frameon</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
            <span class="s1">bbox_to_anchor</span><span class="s2">=</span><span class="s1">point</span><span class="s2">,</span>
            <span class="s1">bbox_transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">,</span>
            <span class="s1">borderpad</span><span class="s2">=</span><span class="s3">0.</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">anchored_box</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">anchored_box</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'tight_layout_offsetboxes1'</span><span class="s2">, </span><span class="s4">'tight_layout_offsetboxes2'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_tight_layout_offsetboxes</span><span class="s2">():</span>
    <span class="s6"># 1.</span>
    <span class="s6"># - Create 4 subplots</span>
    <span class="s6"># - Plot a diagonal line on them</span>
    <span class="s6"># - Surround each plot with 7 boxes</span>
    <span class="s6"># - Use tight_layout</span>
    <span class="s6"># - See that the squares are included in the tight_layout</span>
    <span class="s6">#   and that the squares in the middle do not overlap</span>
    <span class="s6">#</span>
    <span class="s6"># 2.</span>
    <span class="s6"># - Make the squares around the right side axes invisible</span>
    <span class="s6"># - See that the invisible squares do not affect the</span>
    <span class="s6">#   tight_layout</span>
    <span class="s1">rows </span><span class="s2">= </span><span class="s1">cols </span><span class="s2">= </span><span class="s3">2</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'red'</span><span class="s2">, </span><span class="s4">'blue'</span><span class="s2">, </span><span class="s4">'green'</span><span class="s2">, </span><span class="s4">'yellow'</span><span class="s2">]</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">y </span><span class="s2">= [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">_subplots</span><span class="s2">():</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">rows</span><span class="s2">, </span><span class="s1">cols</span><span class="s2">)</span>
        <span class="s1">axs </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">)</span>
            <span class="s1">add_offsetboxes</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">axs</span>

    <span class="s6"># 1.</span>
    <span class="s1">axs </span><span class="s2">= </span><span class="s1">_subplots</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>

    <span class="s6"># 2.</span>
    <span class="s1">axs </span><span class="s2">= </span><span class="s1">_subplots</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s2">(</span><span class="s1">axs</span><span class="s2">[</span><span class="s1">cols</span><span class="s2">-</span><span class="s3">1</span><span class="s2">::</span><span class="s1">rows</span><span class="s2">]):</span>
        <span class="s0">for </span><span class="s1">child </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_children</span><span class="s2">():</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">child</span><span class="s2">, </span><span class="s1">AnchoredOffsetbox</span><span class="s2">):</span>
                <span class="s1">child</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_empty_layout</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test that tight layout doesn't cause an error when there are no Axes.&quot;&quot;&quot;</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gcf</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;label&quot;</span><span class="s2">, [</span><span class="s4">&quot;xlabel&quot;</span><span class="s2">, </span><span class="s4">&quot;ylabel&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_verybig_decorators</span><span class="s2">(</span><span class="s1">label</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Test that no warning emitted when xlabel/ylabel too big.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(**{</span><span class="s1">label</span><span class="s2">: </span><span class="s4">'a' </span><span class="s2">* </span><span class="s3">100</span><span class="s2">})</span>


<span class="s0">def </span><span class="s1">test_big_decorators_horizontal</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test that doesn't warn when xlabel too big.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s3">0</span><span class="s2">].</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'a' </span><span class="s2">* </span><span class="s3">30</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s3">1</span><span class="s2">].</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'b' </span><span class="s2">* </span><span class="s3">30</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_big_decorators_vertical</span><span class="s2">():</span>
    <span class="s5">&quot;&quot;&quot;Test that doesn't warn when ylabel too big.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">2</span><span class="s2">))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s3">0</span><span class="s2">].</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'a' </span><span class="s2">* </span><span class="s3">20</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s3">1</span><span class="s2">].</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'b' </span><span class="s2">* </span><span class="s3">20</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_badsubplotgrid</span><span class="s2">():</span>
    <span class="s6"># test that we get warning for mismatched subplot grids, not than an error</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot2grid</span><span class="s2">((</span><span class="s3">4</span><span class="s2">, </span><span class="s3">5</span><span class="s2">), (</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">))</span>
    <span class="s6"># this is the bad entry:</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot2grid</span><span class="s2">((</span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s2">), (</span><span class="s3">0</span><span class="s2">, </span><span class="s3">3</span><span class="s2">), </span><span class="s1">colspan</span><span class="s2">=</span><span class="s3">3</span><span class="s2">, </span><span class="s1">rowspan</span><span class="s2">=</span><span class="s3">5</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_collapsed</span><span class="s2">():</span>
    <span class="s6"># test that if the amount of space required to make all the axes</span>
    <span class="s6"># decorations fit would mean that the actual Axes would end up with size</span>
    <span class="s6"># zero (i.e. margins add up to more than the available width) that a call</span>
    <span class="s6"># to tight_layout will not get applied:</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">tight_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">])</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s4">'BIG LONG STRING'</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s3">1.25</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s3">10.5</span><span class="s2">, </span><span class="s3">1.75</span><span class="s2">),</span>
                <span class="s1">annotation_clip</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">p1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
        <span class="s1">p2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">p1</span><span class="s2">.</span><span class="s1">width </span><span class="s2">== </span><span class="s1">p2</span><span class="s2">.</span><span class="s1">width</span>
    <span class="s6"># test that passing a rect doesn't crash...</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">(</span><span class="s1">rect</span><span class="s2">=[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_suptitle</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">tight_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">st </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s4">&quot;foo&quot;</span><span class="s2">)</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">&quot;bar&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">st</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">y0 </span><span class="s2">&gt; </span><span class="s1">t</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">y1</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">backend</span><span class="s2">(</span><span class="s4">&quot;pdf&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_non_agg_renderer</span><span class="s2">(</span><span class="s1">monkeypatch</span><span class="s2">, </span><span class="s1">recwarn</span><span class="s2">):</span>
    <span class="s1">unpatched_init </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">backend_bases</span><span class="s2">.</span><span class="s1">RendererBase</span><span class="s2">.</span><span class="s1">__init__</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s6"># Check that we don't instantiate any other renderer than a pdf</span>
        <span class="s6"># renderer to perform pdf tight layout.</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">backends</span><span class="s2">.</span><span class="s1">backend_pdf</span><span class="s2">.</span><span class="s1">RendererPdf</span><span class="s2">)</span>
        <span class="s1">unpatched_init</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">backend_bases</span><span class="s2">.</span><span class="s1">RendererBase</span><span class="s2">, </span><span class="s4">&quot;__init__&quot;</span><span class="s2">, </span><span class="s1">__init__</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_manual_colorbar</span><span class="s2">():</span>
    <span class="s6"># This should warn, but not raise</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">)</span>
    <span class="s1">pts </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">[</span><span class="s3">1</span><span class="s2">].</span><span class="s1">scatter</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">], [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">5</span><span class="s2">])</span>
    <span class="s1">ax_rect </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">[</span><span class="s3">1</span><span class="s2">].</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">cax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s1">ax_rect</span><span class="s2">.</span><span class="s1">x1 </span><span class="s2">+ </span><span class="s3">0.005</span><span class="s2">, </span><span class="s1">ax_rect</span><span class="s2">.</span><span class="s1">y0</span><span class="s2">, </span><span class="s3">0.015</span><span class="s2">, </span><span class="s1">ax_rect</span><span class="s2">.</span><span class="s1">height</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pts</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">cax</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;This figure includes Axes&quot;</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_clipped_to_axes</span><span class="s2">():</span>
    <span class="s6"># Ensure that _fully_clipped_to_axes() returns True under default</span>
    <span class="s6"># conditions for all projection types. Axes.get_tightbbox()</span>
    <span class="s6"># uses this to skip artists in layout calculations.</span>
    <span class="s1">arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">100</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s2">))</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s3">6</span><span class="s2">, </span><span class="s3">2</span><span class="s2">))</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s3">131</span><span class="s2">, </span><span class="s1">projection</span><span class="s2">=</span><span class="s4">'rectilinear'</span><span class="s2">)</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s3">132</span><span class="s2">, </span><span class="s1">projection</span><span class="s2">=</span><span class="s4">'mollweide'</span><span class="s2">)</span>
    <span class="s1">ax3 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s3">133</span><span class="s2">, </span><span class="s1">projection</span><span class="s2">=</span><span class="s4">'polar'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">):</span>
        <span class="s6"># Default conditions (clipped by ax.bbox or ax.patch)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">h</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">[:, </span><span class="s3">0</span><span class="s2">])</span>
        <span class="s1">m </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">h</span><span class="s2">.</span><span class="s1">_fully_clipped_to_axes</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">m</span><span class="s2">.</span><span class="s1">_fully_clipped_to_axes</span><span class="s2">()</span>
        <span class="s6"># Non-default conditions (not clipped by ax.patch)</span>
        <span class="s1">rect </span><span class="s2">= </span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">), </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
        <span class="s1">h</span><span class="s2">.</span><span class="s1">set_clip_path</span><span class="s2">(</span><span class="s1">rect</span><span class="s2">)</span>
        <span class="s1">m</span><span class="s2">.</span><span class="s1">set_clip_path</span><span class="s2">(</span><span class="s1">rect</span><span class="s2">.</span><span class="s1">get_path</span><span class="s2">(), </span><span class="s1">rect</span><span class="s2">.</span><span class="s1">get_transform</span><span class="s2">())</span>
        <span class="s0">assert not </span><span class="s1">h</span><span class="s2">.</span><span class="s1">_fully_clipped_to_axes</span><span class="s2">()</span>
        <span class="s0">assert not </span><span class="s1">m</span><span class="s2">.</span><span class="s1">_fully_clipped_to_axes</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_tight_pads</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">PendingDeprecationWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s4">'will be deprecated'</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">set_tight_layout</span><span class="s2">({</span><span class="s4">'pad'</span><span class="s2">: </span><span class="s3">0.15</span><span class="s2">})</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_tight_kwargs</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">tight_layout</span><span class="s2">={</span><span class="s4">'pad'</span><span class="s2">: </span><span class="s3">0.15</span><span class="s2">})</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_tight_toggle</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">PendingDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">set_tight_layout</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">get_tight_layout</span><span class="s2">()</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">set_tight_layout</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">get_tight_layout</span><span class="s2">()</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">set_tight_layout</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">get_tight_layout</span><span class="s2">()</span>
</pre>
</body>
</html>