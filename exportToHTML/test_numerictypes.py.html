<html>
<head>
<title>test_numerictypes.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #a5c261;}
.s7 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_numerictypes.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">itertools</span>

<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">numerictypes </span><span class="s0">as </span><span class="s1">nt</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">numerictypes </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">issctype</span><span class="s2">, </span><span class="s1">sctype2char</span><span class="s2">, </span><span class="s1">maximum_sctype</span><span class="s2">, </span><span class="s1">sctypes</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">assert_</span><span class="s2">, </span><span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_raises</span><span class="s2">, </span><span class="s1">assert_raises_regex</span><span class="s2">, </span><span class="s1">IS_PYPY</span>
<span class="s2">)</span>

<span class="s3"># This is the structure of the table used for plain objects:</span>
<span class="s3">#</span>
<span class="s3"># +-+-+-+</span>
<span class="s3"># |x|y|z|</span>
<span class="s3"># +-+-+-+</span>

<span class="s3"># Structure of a plain array description:</span>
<span class="s1">Pdescr </span><span class="s2">= [</span>
    <span class="s2">(</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'i4'</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">,)),</span>
    <span class="s2">(</span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'f8'</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s4">'z'</span><span class="s2">, </span><span class="s4">'u1'</span><span class="s2">)]</span>

<span class="s3"># A plain list of tuples with values for testing:</span>
<span class="s1">PbufferT </span><span class="s2">= [</span>
    <span class="s3"># x     y                  z</span>
    <span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [[</span><span class="s5">6.</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">], [</span><span class="s5">6.</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">]], </span><span class="s5">8</span><span class="s2">),</span>
    <span class="s2">([</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [[</span><span class="s5">7.</span><span class="s2">, </span><span class="s5">5.</span><span class="s2">], [</span><span class="s5">7.</span><span class="s2">, </span><span class="s5">5.</span><span class="s2">]], </span><span class="s5">9</span><span class="s2">),</span>
    <span class="s2">]</span>


<span class="s3"># This is the structure of the table used for nested objects (DON'T PANIC!):</span>
<span class="s3">#</span>
<span class="s3"># +-+---------------------------------+-----+----------+-+-+</span>
<span class="s3"># |x|Info                             |color|info      |y|z|</span>
<span class="s3"># | +-----+--+----------------+----+--+     +----+-----+ | |</span>
<span class="s3"># | |value|y2|Info2           |name|z2|     |Name|Value| | |</span>
<span class="s3"># | |     |  +----+-----+--+--+    |  |     |    |     | | |</span>
<span class="s3"># | |     |  |name|value|y3|z3|    |  |     |    |     | | |</span>
<span class="s3"># +-+-----+--+----+-----+--+--+----+--+-----+----+-----+-+-+</span>
<span class="s3">#</span>

<span class="s3"># The corresponding nested array description:</span>
<span class="s1">Ndescr </span><span class="s2">= [</span>
    <span class="s2">(</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'i4'</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">,)),</span>
    <span class="s2">(</span><span class="s4">'Info'</span><span class="s2">, [</span>
        <span class="s2">(</span><span class="s4">'value'</span><span class="s2">, </span><span class="s4">'c16'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">'y2'</span><span class="s2">, </span><span class="s4">'f8'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">'Info2'</span><span class="s2">, [</span>
            <span class="s2">(</span><span class="s4">'name'</span><span class="s2">, </span><span class="s4">'S2'</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">'value'</span><span class="s2">, </span><span class="s4">'c16'</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">,)),</span>
            <span class="s2">(</span><span class="s4">'y3'</span><span class="s2">, </span><span class="s4">'f8'</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">,)),</span>
            <span class="s2">(</span><span class="s4">'z3'</span><span class="s2">, </span><span class="s4">'u4'</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">,))]),</span>
        <span class="s2">(</span><span class="s4">'name'</span><span class="s2">, </span><span class="s4">'S2'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">'z2'</span><span class="s2">, </span><span class="s4">'b1'</span><span class="s2">)]),</span>
    <span class="s2">(</span><span class="s4">'color'</span><span class="s2">, </span><span class="s4">'S2'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">'info'</span><span class="s2">, [</span>
        <span class="s2">(</span><span class="s4">'Name'</span><span class="s2">, </span><span class="s4">'U8'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">'Value'</span><span class="s2">, </span><span class="s4">'c16'</span><span class="s2">)]),</span>
    <span class="s2">(</span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'f8'</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)),</span>
    <span class="s2">(</span><span class="s4">'z'</span><span class="s2">, </span><span class="s4">'u1'</span><span class="s2">)]</span>

<span class="s1">NbufferT </span><span class="s2">= [</span>
    <span class="s3"># x     Info                                                color info        y                  z</span>
    <span class="s3">#       value y2 Info2                            name z2         Name Value</span>
    <span class="s3">#                name   value    y3       z3</span>
    <span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], (</span><span class="s5">6j</span><span class="s2">, </span><span class="s5">6.</span><span class="s2">, (</span><span class="s6">b'nn'</span><span class="s2">, [</span><span class="s5">6j</span><span class="s2">, </span><span class="s5">4j</span><span class="s2">], [</span><span class="s5">6.</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]), </span><span class="s6">b'NN'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
     <span class="s6">b'cc'</span><span class="s2">, (</span><span class="s4">'NN'</span><span class="s2">, </span><span class="s5">6j</span><span class="s2">), [[</span><span class="s5">6.</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">], [</span><span class="s5">6.</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">]], </span><span class="s5">8</span><span class="s2">),</span>
    <span class="s2">([</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], (</span><span class="s5">7j</span><span class="s2">, </span><span class="s5">7.</span><span class="s2">, (</span><span class="s6">b'oo'</span><span class="s2">, [</span><span class="s5">7j</span><span class="s2">, </span><span class="s5">5j</span><span class="s2">], [</span><span class="s5">7.</span><span class="s2">, </span><span class="s5">5.</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]), </span><span class="s6">b'OO'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
     <span class="s6">b'dd'</span><span class="s2">, (</span><span class="s4">'OO'</span><span class="s2">, </span><span class="s5">7j</span><span class="s2">), [[</span><span class="s5">7.</span><span class="s2">, </span><span class="s5">5.</span><span class="s2">], [</span><span class="s5">7.</span><span class="s2">, </span><span class="s5">5.</span><span class="s2">]], </span><span class="s5">9</span><span class="s2">),</span>
    <span class="s2">]</span>


<span class="s1">byteorder </span><span class="s2">= {</span><span class="s4">'little'</span><span class="s2">:</span><span class="s4">'&lt;'</span><span class="s2">, </span><span class="s4">'big'</span><span class="s2">:</span><span class="s4">'&gt;'</span><span class="s2">}[</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">byteorder</span><span class="s2">]</span>

<span class="s0">def </span><span class="s1">normalize_descr</span><span class="s2">(</span><span class="s1">descr</span><span class="s2">):</span>
    <span class="s7">&quot;Normalize a description adding the platform byteorder.&quot;</span>

    <span class="s1">out </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">descr</span><span class="s2">:</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s1">item</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">dtype</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">not in </span><span class="s2">[</span><span class="s4">'|'</span><span class="s2">, </span><span class="s4">'&lt;'</span><span class="s2">, </span><span class="s4">'&gt;'</span><span class="s2">]:</span>
                <span class="s1">onebyte </span><span class="s2">= </span><span class="s1">dtype</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:] == </span><span class="s4">&quot;1&quot;</span>
                <span class="s0">if </span><span class="s1">onebyte </span><span class="s0">or </span><span class="s1">dtype</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'S'</span><span class="s2">, </span><span class="s4">'V'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">]:</span>
                    <span class="s1">dtype </span><span class="s2">= </span><span class="s4">&quot;|&quot; </span><span class="s2">+ </span><span class="s1">dtype</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">dtype </span><span class="s2">= </span><span class="s1">byteorder </span><span class="s2">+ </span><span class="s1">dtype</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">item</span><span class="s2">) &gt; </span><span class="s5">2 </span><span class="s0">and </span><span class="s1">np</span><span class="s2">.</span><span class="s1">prod</span><span class="s2">(</span><span class="s1">item</span><span class="s2">[</span><span class="s5">2</span><span class="s2">]) &gt; </span><span class="s5">1</span><span class="s2">:</span>
                <span class="s1">nitem </span><span class="s2">= (</span><span class="s1">item</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">item</span><span class="s2">[</span><span class="s5">2</span><span class="s2">])</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">nitem </span><span class="s2">= (</span><span class="s1">item</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">)</span>
            <span class="s1">out</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">nitem</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">list</span><span class="s2">):</span>
            <span class="s1">l </span><span class="s2">= </span><span class="s1">normalize_descr</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>
            <span class="s1">out</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s1">item</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">l</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">&quot;Expected a str or list and got %s&quot; </span><span class="s2">%</span>
                             <span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)))</span>
    <span class="s0">return </span><span class="s1">out</span>


<span class="s3">############################################################</span>
<span class="s3">#    Creation tests</span>
<span class="s3">############################################################</span>

<span class="s0">class </span><span class="s1">CreateZeros</span><span class="s2">:</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays zero-valued&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">test_zeros0D</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check creation of 0-dimensional objects&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">normalize_descr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">) == </span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">fields</span><span class="s2">[</span><span class="s4">'x'</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">name</span><span class="s2">[:</span><span class="s5">4</span><span class="s2">] == </span><span class="s4">'void'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">fields</span><span class="s2">[</span><span class="s4">'x'</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">char </span><span class="s2">== </span><span class="s4">'V'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">fields</span><span class="s2">[</span><span class="s4">'x'</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">type </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">)</span>
        <span class="s3"># A small check that data is ok</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u1'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_zerosSD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check creation of single-dimensional objects&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">,), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">normalize_descr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">) == </span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'y'</span><span class="s2">].</span><span class="s1">name</span><span class="s2">[:</span><span class="s5">4</span><span class="s2">] == </span><span class="s4">'void'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'y'</span><span class="s2">].</span><span class="s1">char </span><span class="s2">== </span><span class="s4">'V'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'y'</span><span class="s2">].</span><span class="s1">type </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">)</span>
        <span class="s3"># A small check that data is ok</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">,), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u1'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_zerosMD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check creation of multi-dimensional objects&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">normalize_descr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">) == </span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">].</span><span class="s1">name </span><span class="s2">== </span><span class="s4">'uint8'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">].</span><span class="s1">char </span><span class="s2">== </span><span class="s4">'B'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">].</span><span class="s1">type </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">)</span>
        <span class="s3"># A small check that data is ok</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u1'</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestCreateZerosPlain</span><span class="s2">(</span><span class="s1">CreateZeros</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays zero-valued (plain)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Pdescr</span>

<span class="s0">class </span><span class="s1">TestCreateZerosNested</span><span class="s2">(</span><span class="s1">CreateZeros</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays zero-valued (nested)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Ndescr</span>


<span class="s0">class </span><span class="s1">CreateValues</span><span class="s2">:</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays with values&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">test_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check creation from tuples&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">normalize_descr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">) == </span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">descr</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">multiple_rows</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">2</span><span class="s2">,))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== ())</span>

    <span class="s0">def </span><span class="s1">test_list_of_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check creation from list of tuples&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">normalize_descr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">) == </span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">descr</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">multiple_rows</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">1</span><span class="s2">,))</span>

    <span class="s0">def </span><span class="s1">test_list_of_list_of_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check creation from list of list of tuples&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">]], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">normalize_descr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">) == </span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">descr</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">multiple_rows</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestCreateValuesPlainSingle</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays (plain, single row)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Pdescr</span>
    <span class="s1">multiple_rows </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">_buffer </span><span class="s2">= </span><span class="s1">PbufferT</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>

<span class="s0">class </span><span class="s1">TestCreateValuesPlainMultiple</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays (plain, multiple rows)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Pdescr</span>
    <span class="s1">multiple_rows </span><span class="s2">= </span><span class="s5">1</span>
    <span class="s1">_buffer </span><span class="s2">= </span><span class="s1">PbufferT</span>

<span class="s0">class </span><span class="s1">TestCreateValuesNestedSingle</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays (nested, single row)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Ndescr</span>
    <span class="s1">multiple_rows </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">_buffer </span><span class="s2">= </span><span class="s1">NbufferT</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>

<span class="s0">class </span><span class="s1">TestCreateValuesNestedMultiple</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays (nested, multiple rows)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Ndescr</span>
    <span class="s1">multiple_rows </span><span class="s2">= </span><span class="s5">1</span>
    <span class="s1">_buffer </span><span class="s2">= </span><span class="s1">NbufferT</span>


<span class="s3">############################################################</span>
<span class="s3">#    Reading tests</span>
<span class="s3">############################################################</span>

<span class="s0">class </span><span class="s1">ReadValuesPlain</span><span class="s2">:</span>
    <span class="s7">&quot;&quot;&quot;Check the reading of values in heterogeneous arrays (plain)&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">test_access_fields</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">multiple_rows</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== ())</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'x'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'i4'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'y'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'f8'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">2</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u1'</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">h</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'x'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">],</span>
                                             <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'i4'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'y'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">],</span>
                                             <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">]], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'f8'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">2</span><span class="s2">],</span>
                                             <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">2</span><span class="s2">]], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u1'</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestReadValuesPlainSingle</span><span class="s2">(</span><span class="s1">ReadValuesPlain</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the creation of heterogeneous arrays (plain, single row)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Pdescr</span>
    <span class="s1">multiple_rows </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">_buffer </span><span class="s2">= </span><span class="s1">PbufferT</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>

<span class="s0">class </span><span class="s1">TestReadValuesPlainMultiple</span><span class="s2">(</span><span class="s1">ReadValuesPlain</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the values of heterogeneous arrays (plain, multiple rows)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Pdescr</span>
    <span class="s1">multiple_rows </span><span class="s2">= </span><span class="s5">1</span>
    <span class="s1">_buffer </span><span class="s2">= </span><span class="s1">PbufferT</span>

<span class="s0">class </span><span class="s1">ReadValuesNested</span><span class="s2">:</span>
    <span class="s7">&quot;&quot;&quot;Check the reading of values in heterogeneous arrays (nested)&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">test_access_top_fields</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check reading the top fields of a nested array&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">multiple_rows</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== ())</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'x'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'i4'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'y'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">4</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'f8'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">5</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u1'</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">h</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'x'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">],</span>
                                           <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'i4'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'y'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">4</span><span class="s2">],</span>
                                           <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">4</span><span class="s2">]], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'f8'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'z'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">5</span><span class="s2">],</span>
                                           <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">5</span><span class="s2">]], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u1'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_nested1_acessors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check reading the nested fields of a nested array (1st level)&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">multiple_rows</span><span class="s2">:</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'value'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'c16'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'y2'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'f8'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'info'</span><span class="s2">][</span><span class="s4">'Name'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">3</span><span class="s2">][</span><span class="s5">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'U2'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'info'</span><span class="s2">][</span><span class="s4">'Value'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">3</span><span class="s2">][</span><span class="s5">1</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'c16'</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'value'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s5">0</span><span class="s2">],</span>
                                <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]],</span>
                                <span class="s1">dtype</span><span class="s2">=</span><span class="s4">'c16'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'y2'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">],</span>
                                <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">]],</span>
                                <span class="s1">dtype</span><span class="s2">=</span><span class="s4">'f8'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'info'</span><span class="s2">][</span><span class="s4">'Name'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">3</span><span class="s2">][</span><span class="s5">0</span><span class="s2">],</span>
                                <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">3</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]],</span>
                               <span class="s1">dtype</span><span class="s2">=</span><span class="s4">'U2'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'info'</span><span class="s2">][</span><span class="s4">'Value'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">3</span><span class="s2">][</span><span class="s5">1</span><span class="s2">],</span>
                                <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">3</span><span class="s2">][</span><span class="s5">1</span><span class="s2">]],</span>
                               <span class="s1">dtype</span><span class="s2">=</span><span class="s4">'c16'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_nested2_acessors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check reading the nested fields of a nested array (2nd level)&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">multiple_rows</span><span class="s2">:</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'Info2'</span><span class="s2">][</span><span class="s4">'value'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">2</span><span class="s2">][</span><span class="s5">1</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'c16'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'Info2'</span><span class="s2">][</span><span class="s4">'z3'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">2</span><span class="s2">][</span><span class="s5">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u4'</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'Info2'</span><span class="s2">][</span><span class="s4">'value'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s5">2</span><span class="s2">][</span><span class="s5">1</span><span class="s2">],</span>
                                <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s5">2</span><span class="s2">][</span><span class="s5">1</span><span class="s2">]],</span>
                               <span class="s1">dtype</span><span class="s2">=</span><span class="s4">'c16'</span><span class="s2">))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'Info2'</span><span class="s2">][</span><span class="s4">'z3'</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s5">2</span><span class="s2">][</span><span class="s5">3</span><span class="s2">],</span>
                                <span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s5">2</span><span class="s2">][</span><span class="s5">3</span><span class="s2">]],</span>
                               <span class="s1">dtype</span><span class="s2">=</span><span class="s4">'u4'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_nested1_descriptor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check access nested descriptors of a nested array (1st level)&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'value'</span><span class="s2">].</span><span class="s1">name </span><span class="s2">== </span><span class="s4">'complex128'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'y2'</span><span class="s2">].</span><span class="s1">name </span><span class="s2">== </span><span class="s4">'float64'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'info'</span><span class="s2">][</span><span class="s4">'Name'</span><span class="s2">].</span><span class="s1">name </span><span class="s2">== </span><span class="s4">'str256'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'info'</span><span class="s2">][</span><span class="s4">'Value'</span><span class="s2">].</span><span class="s1">name </span><span class="s2">== </span><span class="s4">'complex128'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_nested2_descriptor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot;Check access nested descriptors of a nested array (2nd level)&quot;&quot;&quot;</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_buffer</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_descr</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'Info2'</span><span class="s2">][</span><span class="s4">'value'</span><span class="s2">].</span><span class="s1">name </span><span class="s2">== </span><span class="s4">'void256'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">[</span><span class="s4">'Info'</span><span class="s2">][</span><span class="s4">'Info2'</span><span class="s2">][</span><span class="s4">'z3'</span><span class="s2">].</span><span class="s1">name </span><span class="s2">== </span><span class="s4">'void64'</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestReadValuesNestedSingle</span><span class="s2">(</span><span class="s1">ReadValuesNested</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the values of heterogeneous arrays (nested, single row)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Ndescr</span>
    <span class="s1">multiple_rows </span><span class="s2">= </span><span class="s0">False</span>
    <span class="s1">_buffer </span><span class="s2">= </span><span class="s1">NbufferT</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>

<span class="s0">class </span><span class="s1">TestReadValuesNestedMultiple</span><span class="s2">(</span><span class="s1">ReadValuesNested</span><span class="s2">):</span>
    <span class="s7">&quot;&quot;&quot;Check the values of heterogeneous arrays (nested, multiple rows)&quot;&quot;&quot;</span>
    <span class="s1">_descr </span><span class="s2">= </span><span class="s1">Ndescr</span>
    <span class="s1">multiple_rows </span><span class="s2">= </span><span class="s0">True</span>
    <span class="s1">_buffer </span><span class="s2">= </span><span class="s1">NbufferT</span>

<span class="s0">class </span><span class="s1">TestEmptyField</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_assign</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)</span>
        <span class="s1">a</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">= [(</span><span class="s4">&quot;int&quot;</span><span class="s2">,   </span><span class="s4">&quot;&lt;0i4&quot;</span><span class="s2">), (</span><span class="s4">&quot;float&quot;</span><span class="s2">, </span><span class="s4">&quot;&lt;2f4&quot;</span><span class="s2">)]</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s4">'int'</span><span class="s2">].</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s4">'float'</span><span class="s2">].</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestMultipleFields</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">ary </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">), (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">)], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'i4,f4,i2,c8'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">_bad_call</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ary</span><span class="s2">[</span><span class="s4">'f0'</span><span class="s2">, </span><span class="s4">'f1'</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_no_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_bad_call</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_return</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ary</span><span class="s2">[[</span><span class="s4">'f0'</span><span class="s2">, </span><span class="s4">'f2'</span><span class="s2">]].</span><span class="s1">tolist</span><span class="s2">()</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">res </span><span class="s2">== [(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">)])</span>


<span class="s0">class </span><span class="s1">TestIsSubDType</span><span class="s2">:</span>
    <span class="s3"># scalar types can be promoted into dtypes</span>
    <span class="s1">wrappers </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_both_abstract</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inexact</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inexact</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_same</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">cls </span><span class="s0">in </span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2 </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">wrappers</span><span class="s2">, </span><span class="s1">repeat</span><span class="s2">=</span><span class="s5">2</span><span class="s2">):</span>
                <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">), </span><span class="s1">w2</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_subclass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># note we cannot promote floating to a dtype, as it would turn into a</span>
        <span class="s3"># concrete type</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">wrappers</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">w</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">w</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_subclass_backwards</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">wrappers</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">, </span><span class="s1">w</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">, </span><span class="s1">w</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_sibling_class</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2 </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">wrappers</span><span class="s2">, </span><span class="s1">repeat</span><span class="s2">=</span><span class="s5">2</span><span class="s2">):</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">), </span><span class="s1">w2</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">), </span><span class="s1">w2</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_nondtype_nonscalartype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># See gh-14619 and gh-9505 which introduced the deprecation to fix</span>
        <span class="s3"># this. These tests are directly taken from gh-9505</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s4">'float64'</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s4">'f8'</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">str</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s4">'int64'</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">str_</span><span class="s2">, </span><span class="s4">'void'</span><span class="s2">)</span>
        <span class="s3"># for the following the correct spellings are</span>
        <span class="s3"># np.integer, np.floating, or np.complexfloating respectively:</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">, </span><span class="s1">int</span><span class="s2">)  </span><span class="s3"># np.int8 is never np.int_</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">float</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">, </span><span class="s1">complex</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s4">&quot;float&quot;</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s4">&quot;f&quot;</span><span class="s2">)</span>

        <span class="s3"># Test the same for the correct first datatype and abstract one</span>
        <span class="s3"># in the case of int, float, complex:</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s4">'float64'</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s4">'f8'</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">str_</span><span class="s2">, </span><span class="s1">str</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s4">'int64'</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">, </span><span class="s4">'void'</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">integer</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complexfloating</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s4">&quot;float&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s4">&quot;f&quot;</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIsDType</span><span class="s2">:</span>
    <span class="s7">&quot;&quot;&quot; 
    Check correctness of `np.isdtype`. The test considers different argument 
    configurations: `np.isdtype(dtype, k1)` and `np.isdtype(dtype, (k1, k2))` 
    with concrete dtypes and dtype groups. 
    &quot;&quot;&quot;</span>
    <span class="s1">dtype_group_dict </span><span class="s2">= {</span>
        <span class="s4">&quot;signed integer&quot;</span><span class="s2">: </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;int&quot;</span><span class="s2">],</span>
        <span class="s4">&quot;unsigned integer&quot;</span><span class="s2">: </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;uint&quot;</span><span class="s2">],</span>
        <span class="s4">&quot;integral&quot;</span><span class="s2">: </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;int&quot;</span><span class="s2">] + </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;uint&quot;</span><span class="s2">],</span>
        <span class="s4">&quot;real floating&quot;</span><span class="s2">: </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;float&quot;</span><span class="s2">],</span>
        <span class="s4">&quot;complex floating&quot;</span><span class="s2">: </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;complex&quot;</span><span class="s2">],</span>
        <span class="s4">&quot;numeric&quot;</span><span class="s2">: (</span>
            <span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;int&quot;</span><span class="s2">] + </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;uint&quot;</span><span class="s2">] + </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;float&quot;</span><span class="s2">] +</span>
            <span class="s1">sctypes</span><span class="s2">[</span><span class="s4">&quot;complex&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
    <span class="s2">}</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;dtype,close_dtype&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">), (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">), (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">)</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;dtype_group&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;signed integer&quot;</span><span class="s2">, </span><span class="s4">&quot;unsigned integer&quot;</span><span class="s2">, </span><span class="s4">&quot;integral&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;real floating&quot;</span><span class="s2">, </span><span class="s4">&quot;complex floating&quot;</span><span class="s2">, </span><span class="s4">&quot;numeric&quot;</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_isdtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">close_dtype</span><span class="s2">, </span><span class="s1">dtype_group</span><span class="s2">):</span>
        <span class="s3"># First check if same dtypes return `true` and different ones</span>
        <span class="s3"># give `false` (even if they're close in the dtype hierarchy!)</span>
        <span class="s0">if </span><span class="s1">dtype_group </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">)</span>
            <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">close_dtype</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, (</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">close_dtype</span><span class="s2">))</span>

        <span class="s3"># Check that dtype and a dtype group that it belongs to</span>
        <span class="s3"># return `true`, and `false` otherwise.</span>
        <span class="s0">elif </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dtype_group_dict</span><span class="s2">[</span><span class="s1">dtype_group</span><span class="s2">]:</span>
            <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype_group</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, (</span><span class="s1">close_dtype</span><span class="s2">, </span><span class="s1">dtype_group</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dtype_group</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_isdtype_invalid_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s4">r&quot;.*must be a NumPy dtype.*&quot;</span><span class="s2">):</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s4">&quot;int64&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s4">r&quot;.*kind argument must.*&quot;</span><span class="s2">):</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">assert_raises_regex</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s4">r&quot;.*not a known kind name.*&quot;</span><span class="s2">):</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">isdtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">, </span><span class="s4">&quot;int64&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_sctypes_complete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># issue 26439: int32/intc were masking each other on 32-bit builds</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32 </span><span class="s0">in </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'int'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">intc </span><span class="s0">in </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'int'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64 </span><span class="s0">in </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'int'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32 </span><span class="s0">in </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'uint'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uintc </span><span class="s0">in </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'uint'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64 </span><span class="s0">in </span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'uint'</span><span class="s2">]</span>

<span class="s0">class </span><span class="s1">TestSctypeDict</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_longdouble</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">sctypeDict</span><span class="s2">[</span><span class="s4">'float64'</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">longdouble</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">sctypeDict</span><span class="s2">[</span><span class="s4">'complex128'</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">clongdouble</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ulong</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">sctypeDict</span><span class="s2">[</span><span class="s4">'ulong'</span><span class="s2">] </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ulong</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ulong</span><span class="s2">) </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s4">&quot;ulong&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ulong</span><span class="s2">).</span><span class="s1">itemsize </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">long</span><span class="s2">).</span><span class="s1">itemsize</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s4">&quot;ignore:.*maximum_sctype.*:DeprecationWarning&quot;</span><span class="s2">)</span>
<span class="s0">class </span><span class="s1">TestMaximumSctype</span><span class="s2">:</span>

    <span class="s3"># note that parametrizing with sctype['int'] and similar would skip types</span>
    <span class="s3"># with the same size (gh-11923)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">'t'</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">byte</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">short</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">intc</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">long</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">longlong</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">maximum_sctype</span><span class="s2">(</span><span class="s1">t</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'int'</span><span class="s2">][-</span><span class="s5">1</span><span class="s2">])</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">'t'</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ubyte</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ushort</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uintc</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ulong</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ulonglong</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_uint</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">maximum_sctype</span><span class="s2">(</span><span class="s1">t</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'uint'</span><span class="s2">][-</span><span class="s5">1</span><span class="s2">])</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'t'</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">half</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">single</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">double</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">longdouble</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">maximum_sctype</span><span class="s2">(</span><span class="s1">t</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'float'</span><span class="s2">][-</span><span class="s5">1</span><span class="s2">])</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'t'</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">csingle</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cdouble</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">clongdouble</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">maximum_sctype</span><span class="s2">(</span><span class="s1">t</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">sctypes</span><span class="s2">[</span><span class="s4">'complex'</span><span class="s2">][-</span><span class="s5">1</span><span class="s2">])</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'t'</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">bool</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">str_</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">bytes_</span><span class="s2">,</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">void</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_other</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">maximum_sctype</span><span class="s2">(</span><span class="s1">t</span><span class="s2">), </span><span class="s1">t</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">Test_sctype2char</span><span class="s2">:</span>
    <span class="s3"># This function is old enough that we're really just documenting the quirks</span>
    <span class="s3"># at this point.</span>

    <span class="s0">def </span><span class="s1">test_scalar_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">double</span><span class="s2">), </span><span class="s4">'d'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">long</span><span class="s2">), </span><span class="s4">'l'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int_</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s5">0</span><span class="s2">).</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">char</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">str_</span><span class="s2">), </span><span class="s4">'U'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">bytes_</span><span class="s2">), </span><span class="s4">'S'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_other_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">float</span><span class="s2">), </span><span class="s4">'d'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">list</span><span class="s2">), </span><span class="s4">'O'</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">), </span><span class="s4">'O'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_third_party_scalar_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">_rational_tests </span><span class="s0">import </span><span class="s1">rational</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">sctype2char</span><span class="s2">, </span><span class="s1">rational</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">sctype2char</span><span class="s2">, </span><span class="s1">rational</span><span class="s2">(</span><span class="s5">1</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_array_instance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sctype2char</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">])), </span><span class="s4">'d'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_abstract_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">sctype2char</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_non_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">sctype2char</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>

<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;rep, expected&quot;</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s5">1.1</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">), </span><span class="s0">True</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">, (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">))), </span><span class="s0">True</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">([(</span><span class="s4">'a'</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">)]), </span><span class="s0">True</span><span class="s2">),</span>
    <span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_issctype</span><span class="s2">(</span><span class="s1">rep</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s3"># ensure proper identification of scalar</span>
    <span class="s3"># data-types by issctype()</span>
    <span class="s1">actual </span><span class="s2">= </span><span class="s1">issctype</span><span class="s2">(</span><span class="s1">rep</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">) </span><span class="s0">is </span><span class="s1">bool</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">flags</span><span class="s2">.</span><span class="s1">optimize </span><span class="s2">&gt; </span><span class="s5">1</span><span class="s2">,</span>
                    <span class="s1">reason</span><span class="s2">=</span><span class="s4">&quot;no docstrings present to inspect when PYTHONOPTIMIZE/Py_OptimizeFlag &gt; 1&quot;</span><span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">IS_PYPY</span><span class="s2">,</span>
                   <span class="s1">reason</span><span class="s2">=</span><span class="s4">&quot;PyPy cannot modify tp_doc after PyType_Ready&quot;</span><span class="s2">)</span>
<span class="s0">class </span><span class="s1">TestDocStrings</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_platform_dependent_aliases</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64 </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int_</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s4">'int64' </span><span class="s0">in </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int_</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64 </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">longlong</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s4">'int64' </span><span class="s0">in </span><span class="s1">np</span><span class="s2">.</span><span class="s1">longlong</span><span class="s2">.</span><span class="s1">__doc__</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestScalarTypeNames</span><span class="s2">:</span>
    <span class="s3"># gh-9799</span>

    <span class="s1">numeric_types </span><span class="s2">= [</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">byte</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">short</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">intc</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">long</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">longlong</span><span class="s2">,</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">ubyte</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ushort</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uintc</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ulong</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ulonglong</span><span class="s2">,</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">half</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">single</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">double</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">longdouble</span><span class="s2">,</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">csingle</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cdouble</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">clongdouble</span><span class="s2">,</span>
    <span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_names_are_unique</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># none of the above may be aliases for each other</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">numeric_types</span><span class="s2">)) == </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">numeric_types</span><span class="s2">)</span>

        <span class="s3"># names must be unique</span>
        <span class="s1">names </span><span class="s2">= [</span><span class="s1">t</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">numeric_types</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">set</span><span class="s2">(</span><span class="s1">names</span><span class="s2">)) == </span><span class="s1">len</span><span class="s2">(</span><span class="s1">names</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'t'</span><span class="s2">, </span><span class="s1">numeric_types</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_names_reflect_attributes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; Test that names correspond to where the type is under ``np.`` &quot;&quot;&quot;</span>
        <span class="s0">assert </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">, </span><span class="s1">t</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">) </span><span class="s0">is </span><span class="s1">t</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'t'</span><span class="s2">, </span><span class="s1">numeric_types</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_names_are_undersood_by_dtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">t</span><span class="s2">):</span>
        <span class="s7">&quot;&quot;&quot; Test the dtype constructor maps names back to the type &quot;&quot;&quot;</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">t</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">).</span><span class="s1">type </span><span class="s0">is </span><span class="s1">t</span>


<span class="s0">class </span><span class="s1">TestBoolDefinition</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_bool_definition</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">nt</span><span class="s2">.</span><span class="s1">bool </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">bool</span>
</pre>
</body>
</html>