<html>
<head>
<title>test_idl.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
.s7 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_idl.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">os </span><span class="s0">import </span><span class="s1">path</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span><span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_array_equal</span><span class="s2">,</span>
                           <span class="s1">assert_</span><span class="s2">, </span><span class="s1">suppress_warnings</span><span class="s2">)</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">io </span><span class="s0">import </span><span class="s1">readsav</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">io </span><span class="s0">import </span><span class="s1">_idl</span>

<span class="s1">DATA_PATH </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">__file__</span><span class="s2">), </span><span class="s3">'data'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Assert whether value AND type are the same&quot;&quot;&quot;</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">type</span><span class="s2">(</span><span class="s1">b</span><span class="s2">))</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">a</span><span class="s2">).</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">b</span><span class="s2">).</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Assert whether values AND type are the same&quot;&quot;&quot;</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">b</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>


<span class="s5"># Define vectorized ID function for pointer arrays</span>
<span class="s1">vect_id </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">vectorize</span><span class="s2">(</span><span class="s1">id</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIdict</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_idict</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">custom_dict </span><span class="s2">= {</span><span class="s3">'a'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s6">999</span><span class="s2">)}</span>
        <span class="s1">original_id </span><span class="s2">= </span><span class="s1">id</span><span class="s2">(</span><span class="s1">custom_dict</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_byte.sav'</span><span class="s2">),</span>
                    <span class="s1">idict</span><span class="s2">=</span><span class="s1">custom_dict</span><span class="s2">, </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">original_id</span><span class="s2">, </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s3">'a' </span><span class="s0">in </span><span class="s1">s</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">[</span><span class="s3">'a'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s6">999</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">[</span><span class="s3">'i8u'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">(</span><span class="s6">234</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestScalars</span><span class="s2">:</span>
    <span class="s5"># Test that scalar values are read in with the correct value and type</span>

    <span class="s0">def </span><span class="s1">test_byte</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_byte.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i8u</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">(</span><span class="s6">234</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_int16</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_int16.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i16s</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(-</span><span class="s6">23456</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_int32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_int32.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i32s</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(-</span><span class="s6">1234567890</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_float32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_float32.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">f32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(-</span><span class="s6">3.1234567e+37</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_float64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_float64.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">f64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(-</span><span class="s6">1.1976931348623157e+307</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_complex32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_complex32.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">c32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">3.124442e13</span><span class="s2">-</span><span class="s6">2.312442e31j</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_bytes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_string.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The quick brown fox jumps over the lazy python&quot;</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">s</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">bytes_</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_structure</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">test_complex64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_complex64.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">c64</span><span class="s2">,</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">(</span><span class="s6">1.1987253647623157e+112</span><span class="s2">-</span><span class="s6">5.1987258887729157e+307j</span><span class="s2">)</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_heap_pointer</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">test_object_reference</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">test_uint16</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_uint16.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i16u</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint16</span><span class="s2">(</span><span class="s6">65511</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_uint32</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_uint32.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i32u</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">(</span><span class="s6">4294967233</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_int64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_int64.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i64s</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(-</span><span class="s6">9223372036854774567</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_uint64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_uint64.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i64u</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">(</span><span class="s6">18446744073709529285</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestCompressed</span><span class="s2">(</span><span class="s1">TestScalars</span><span class="s2">):</span>
    <span class="s5"># Test that compressed .sav files can be read in</span>

    <span class="s0">def </span><span class="s1">test_compressed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'various_compressed.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i8u</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">(</span><span class="s6">234</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">f32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(-</span><span class="s6">3.1234567e+37</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">c64</span><span class="s2">,</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">(</span><span class="s6">1.1987253647623157e+112</span><span class="s2">-</span><span class="s6">5.1987258887729157e+307j</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array5d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">6</span><span class="s2">, </span><span class="s6">5</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">a</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">b</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">4.</span><span class="s2">, </span><span class="s6">5.</span><span class="s2">, </span><span class="s6">6.</span><span class="s2">, </span><span class="s6">7.</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">c</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">1</span><span class="s2">+</span><span class="s6">2j</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">7</span><span class="s2">+</span><span class="s6">8j</span><span class="s2">)]))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s7">b&quot;cheese&quot;</span><span class="s2">, </span><span class="s7">b&quot;bacon&quot;</span><span class="s2">, </span><span class="s7">b&quot;spam&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestArrayDimensions</span><span class="s2">:</span>
    <span class="s5"># Test that multi-dimensional arrays are read in with the correct dimensions</span>

    <span class="s0">def </span><span class="s1">test_1d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_1d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array1d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">123</span><span class="s2">, ))</span>

    <span class="s0">def </span><span class="s1">test_2d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_2d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array2d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">22</span><span class="s2">, </span><span class="s6">12</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_3d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_3d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array3d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">11</span><span class="s2">, </span><span class="s6">22</span><span class="s2">, </span><span class="s6">12</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_4d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_4d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array4d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">8</span><span class="s2">, </span><span class="s6">7</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_5d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_5d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array5d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">6</span><span class="s2">, </span><span class="s6">5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_6d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_6d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array6d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">3</span><span class="s2">, </span><span class="s6">6</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_7d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_7d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array7d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_8d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_8d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array8d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">4</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestStructures</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_scalars</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_scalars.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars</span><span class="s2">.</span><span class="s1">a</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars</span><span class="s2">.</span><span class="s1">b</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s6">2</span><span class="s2">)))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars</span><span class="s2">.</span><span class="s1">c</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">3.</span><span class="s2">)))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars</span><span class="s2">.</span><span class="s1">d</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars</span><span class="s2">.</span><span class="s1">e</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s7">b&quot;spam&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars</span><span class="s2">.</span><span class="s1">f</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(-</span><span class="s6">1.</span><span class="s2">+</span><span class="s6">3j</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_scalars_replicated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_scalars_replicated.sav'</span><span class="s2">),</span>
                    <span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">a</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s6">1</span><span class="s2">), </span><span class="s6">5</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">b</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s6">2</span><span class="s2">), </span><span class="s6">5</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">c</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">3.</span><span class="s2">), </span><span class="s6">5</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">d</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">5</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">e</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s7">b&quot;spam&quot;</span><span class="s2">, </span><span class="s6">5</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">object</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">f</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(-</span><span class="s6">1.</span><span class="s2">+</span><span class="s6">3j</span><span class="s2">), </span><span class="s6">5</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_scalars_replicated_3d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_scalars_replicated_3d.sav'</span><span class="s2">),</span>
                    <span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">a</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s6">1</span><span class="s2">), </span><span class="s6">24</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">b</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s6">2</span><span class="s2">), </span><span class="s6">24</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">c</span><span class="s2">,</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">3.</span><span class="s2">), </span><span class="s6">24</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">d</span><span class="s2">,</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">24</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">e</span><span class="s2">,</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s7">b&quot;spam&quot;</span><span class="s2">, </span><span class="s6">24</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">object</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">scalars_rep</span><span class="s2">.</span><span class="s1">f</span><span class="s2">,</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(-</span><span class="s6">1.</span><span class="s2">+</span><span class="s6">3j</span><span class="s2">), </span><span class="s6">24</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_arrays</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_arrays.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">a</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">))</span>
        <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">b</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">4.</span><span class="s2">, </span><span class="s6">5.</span><span class="s2">, </span><span class="s6">6.</span><span class="s2">, </span><span class="s6">7.</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">))</span>
        <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">c</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">1</span><span class="s2">+</span><span class="s6">2j</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">7</span><span class="s2">+</span><span class="s6">8j</span><span class="s2">)]))</span>
        <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s7">b&quot;cheese&quot;</span><span class="s2">, </span><span class="s7">b&quot;bacon&quot;</span><span class="s2">, </span><span class="s7">b&quot;spam&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_arrays_replicated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_arrays_replicated.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s5"># Check column types</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">a</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">b</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">c</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">d</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>

        <span class="s5"># Check column shapes</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">a</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">5</span><span class="s2">, ))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">b</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">5</span><span class="s2">, ))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">c</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">5</span><span class="s2">, ))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">5</span><span class="s2">, ))</span>

        <span class="s5"># Check values</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">5</span><span class="s2">):</span>
            <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">a</span><span class="s2">[</span><span class="s1">i</span><span class="s2">],</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">))</span>
            <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">b</span><span class="s2">[</span><span class="s1">i</span><span class="s2">],</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">4.</span><span class="s2">, </span><span class="s6">5.</span><span class="s2">, </span><span class="s6">6.</span><span class="s2">, </span><span class="s6">7.</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">))</span>
            <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">c</span><span class="s2">[</span><span class="s1">i</span><span class="s2">],</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">1</span><span class="s2">+</span><span class="s6">2j</span><span class="s2">),</span>
                                             <span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">7</span><span class="s2">+</span><span class="s6">8j</span><span class="s2">)]))</span>
            <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">d</span><span class="s2">[</span><span class="s1">i</span><span class="s2">],</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s7">b&quot;cheese&quot;</span><span class="s2">, </span><span class="s7">b&quot;bacon&quot;</span><span class="s2">, </span><span class="s7">b&quot;spam&quot;</span><span class="s2">],</span>
                                            <span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_arrays_replicated_3d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_arrays_replicated_3d.sav'</span><span class="s2">),</span>
                    <span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s5"># Check column types</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">a</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">b</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">c</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">d</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>

        <span class="s5"># Check column shapes</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">a</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">b</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">c</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>

        <span class="s5"># Check values</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">4</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">3</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">2</span><span class="s2">):</span>
                    <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">a</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k</span><span class="s2">],</span>
                                           <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">))</span>
                    <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">b</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k</span><span class="s2">],</span>
                                           <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">4.</span><span class="s2">, </span><span class="s6">5.</span><span class="s2">, </span><span class="s6">6.</span><span class="s2">, </span><span class="s6">7.</span><span class="s2">],</span>
                                                    <span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">))</span>
                    <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">c</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k</span><span class="s2">],</span>
                                           <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">1</span><span class="s2">+</span><span class="s6">2j</span><span class="s2">),</span>
                                                     <span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">(</span><span class="s6">7</span><span class="s2">+</span><span class="s6">8j</span><span class="s2">)]))</span>
                    <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">d</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k</span><span class="s2">],</span>
                                           <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s7">b&quot;cheese&quot;</span><span class="s2">, </span><span class="s7">b&quot;bacon&quot;</span><span class="s2">, </span><span class="s7">b&quot;spam&quot;</span><span class="s2">],</span>
                                                    <span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_inheritance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_inherit.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">fc</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">fc</span><span class="s2">.</span><span class="s1">y</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">fc</span><span class="s2">.</span><span class="s1">r</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">fc</span><span class="s2">.</span><span class="s1">c</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">4</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_arrays_corrupt_idl80</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># test byte arrays with missing nbyte information from IDL 8.0 .sav file</span>
        <span class="s0">with </span><span class="s1">suppress_warnings</span><span class="s2">() </span><span class="s0">as </span><span class="s1">sup</span><span class="s2">:</span>
            <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s3">&quot;Not able to verify number of bytes from header&quot;</span><span class="s2">)</span>
            <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">,</span><span class="s3">'struct_arrays_byte_idl80.sav'</span><span class="s2">),</span>
                        <span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">y</span><span class="s2">.</span><span class="s1">x</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">55</span><span class="s2">,</span><span class="s6">66</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestPointers</span><span class="s2">:</span>
    <span class="s5"># Check that pointers in .sav files produce references to the same object in Python</span>

    <span class="s0">def </span><span class="s1">test_pointers</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_heap_pointer.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">c64_pointer1</span><span class="s2">,</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">(</span><span class="s6">1.1987253647623157e+112</span><span class="s2">-</span><span class="s6">5.1987258887729157e+307j</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">c64_pointer2</span><span class="s2">,</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">(</span><span class="s6">1.1987253647623157e+112</span><span class="s2">-</span><span class="s6">5.1987258887729157e+307j</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">c64_pointer1 </span><span class="s0">is </span><span class="s1">s</span><span class="s2">.</span><span class="s1">c64_pointer2</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestPointerArray</span><span class="s2">:</span>
    <span class="s5"># Test that pointers in arrays are correctly read in</span>

    <span class="s0">def </span><span class="s1">test_1d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_pointer_1d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array1d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">123</span><span class="s2">, ))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array1d </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array1d</span><span class="s2">) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array1d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])))</span>

    <span class="s0">def </span><span class="s1">test_2d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_pointer_2d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array2d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">22</span><span class="s2">, </span><span class="s6">12</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array2d </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array2d</span><span class="s2">) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array2d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">])))</span>

    <span class="s0">def </span><span class="s1">test_3d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_pointer_3d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array3d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">11</span><span class="s2">, </span><span class="s6">22</span><span class="s2">, </span><span class="s6">12</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array3d </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array3d</span><span class="s2">) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array3d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">])))</span>

    <span class="s0">def </span><span class="s1">test_4d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_pointer_4d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array4d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">8</span><span class="s2">, </span><span class="s6">7</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array4d </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array4d</span><span class="s2">) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array4d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">])))</span>

    <span class="s0">def </span><span class="s1">test_5d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_pointer_5d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array5d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">6</span><span class="s2">, </span><span class="s6">5</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array5d </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array5d</span><span class="s2">) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array5d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">])))</span>

    <span class="s0">def </span><span class="s1">test_6d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_pointer_6d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array6d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">3</span><span class="s2">, </span><span class="s6">6</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array6d </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array6d</span><span class="s2">) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array6d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">])))</span>

    <span class="s0">def </span><span class="s1">test_7d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_pointer_7d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array7d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array7d </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array7d</span><span class="s2">) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array7d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">])))</span>

    <span class="s0">def </span><span class="s1">test_8d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'array_float32_pointer_8d.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array8d</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">4</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array8d </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array8d</span><span class="s2">) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">array8d</span><span class="s2">[</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">,</span><span class="s6">0</span><span class="s2">])))</span>


<span class="s0">class </span><span class="s1">TestPointerStructures</span><span class="s2">:</span>
    <span class="s5"># Test that structures are correctly read in</span>

    <span class="s0">def </span><span class="s1">test_scalars</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_pointers.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers</span><span class="s2">.</span><span class="s1">g</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers</span><span class="s2">.</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_pointers_replicated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_pointers_replicated.sav'</span><span class="s2">),</span>
                    <span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">,</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">5</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">,</span>
                         <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">5</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">) == </span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_pointers_replicated_3d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_pointers_replicated_3d.sav'</span><span class="s2">),</span>
                    <span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">s_expect </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">24</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">, </span><span class="s1">s_expect</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">, </span><span class="s1">s_expect</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">) == </span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">pointers_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_arrays</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_pointer_arrays.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">2</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
        <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s6">0</span><span class="s2">],</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">3</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">])))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">])))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">]) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_arrays_replicated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_pointer_arrays_replicated.sav'</span><span class="s2">),</span>
                    <span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s5"># Check column types</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>

        <span class="s5"># Check column shapes</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">5</span><span class="s2">, ))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">5</span><span class="s2">, ))</span>

        <span class="s5"># Check values</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">5</span><span class="s2">):</span>
            <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s1">i</span><span class="s2">],</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">2</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
            <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s1">i</span><span class="s2">],</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">3</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">])))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]) == </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">])))</span>

    <span class="s0">def </span><span class="s1">test_arrays_replicated_3d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pth </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'struct_pointer_arrays_replicated_3d.sav'</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">pth</span><span class="s2">, </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

        <span class="s5"># Check column types</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)</span>

        <span class="s5"># Check column shapes</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s6">4</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>

        <span class="s5"># Check values</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">4</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">3</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">2</span><span class="s2">):</span>
                    <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k</span><span class="s2">],</span>
                            <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">2</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
                    <span class="s1">assert_array_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k</span><span class="s2">],</span>
                            <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">(</span><span class="s6">4.</span><span class="s2">), </span><span class="s6">3</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">))</span>
                    <span class="s1">g0 </span><span class="s2">= </span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k</span><span class="s2">])</span>
                    <span class="s1">g1 </span><span class="s2">= </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">g</span><span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">])</span>
                    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">g0 </span><span class="s2">== </span><span class="s1">g1</span><span class="s2">)</span>
                    <span class="s1">h0 </span><span class="s2">= </span><span class="s1">vect_id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">k</span><span class="s2">])</span>
                    <span class="s1">h1 </span><span class="s2">= </span><span class="s1">id</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">arrays_rep</span><span class="s2">.</span><span class="s1">h</span><span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">])</span>
                    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">h0 </span><span class="s2">== </span><span class="s1">h1</span><span class="s2">)</span>
<span class="s0">class </span><span class="s1">TestTags</span><span class="s2">:</span>
    <span class="s4">'''Test that sav files with description tag read at all'''</span>

    <span class="s0">def </span><span class="s1">test_description</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'scalar_byte_descr.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">i8u</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">(</span><span class="s6">234</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_null_pointer</span><span class="s2">():</span>
    <span class="s5"># Regression test for null pointers.</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'null_pointer.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">point</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">check</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s6">5</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_invalid_pointer</span><span class="s2">():</span>
    <span class="s5"># Regression test for invalid pointers (gh-4613).</span>

    <span class="s5"># In some files in the wild, pointers can sometimes refer to a heap</span>
    <span class="s5"># variable that does not exist. In that case, we now gracefully fail for</span>
    <span class="s5"># that variable and replace the variable with None and emit a warning.</span>
    <span class="s5"># Since it's difficult to artificially produce such files, the file used</span>
    <span class="s5"># here has been edited to force the pointer reference to be invalid.</span>
    <span class="s0">with </span><span class="s1">warnings</span><span class="s2">.</span><span class="s1">catch_warnings</span><span class="s2">(</span><span class="s1">record</span><span class="s2">=</span><span class="s0">True</span><span class="s2">) </span><span class="s0">as </span><span class="s1">w</span><span class="s2">:</span>
        <span class="s1">warnings</span><span class="s2">.</span><span class="s1">simplefilter</span><span class="s2">(</span><span class="s3">&quot;always&quot;</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">readsav</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">DATA_PATH</span><span class="s2">, </span><span class="s3">'invalid_pointer.sav'</span><span class="s2">), </span><span class="s1">verbose</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">w</span><span class="s2">) == </span><span class="s6">1</span><span class="s2">)</span>
    <span class="s1">assert_</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">w</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">message</span><span class="s2">) == (</span><span class="s3">&quot;Variable referenced by pointer not found in &quot;</span>
                                  <span class="s3">&quot;heap: variable will be set to None&quot;</span><span class="s2">))</span>
    <span class="s1">assert_identical</span><span class="s2">(</span><span class="s1">s</span><span class="s2">[</span><span class="s3">'a'</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]))</span>


<span class="s0">def </span><span class="s1">test_attrdict</span><span class="s2">():</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">_idl</span><span class="s2">.</span><span class="s1">AttrDict</span><span class="s2">({</span><span class="s3">'one'</span><span class="s2">: </span><span class="s6">1</span><span class="s2">})</span>
    <span class="s0">assert </span><span class="s1">d</span><span class="s2">[</span><span class="s3">'one'</span><span class="s2">] == </span><span class="s6">1</span>
    <span class="s0">assert </span><span class="s1">d</span><span class="s2">.</span><span class="s1">one </span><span class="s2">== </span><span class="s6">1</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">):</span>
        <span class="s1">d</span><span class="s2">[</span><span class="s3">'two'</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">AttributeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'has no attribute'</span><span class="s2">):</span>
        <span class="s1">d</span><span class="s2">.</span><span class="s1">two</span>
</pre>
</body>
</html>