<html>
<head>
<title>test_converter.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_converter.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">date</span><span class="s2">,</span>
    <span class="s1">datetime</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">subprocess</span>
<span class="s0">import </span><span class="s1">sys</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_config</span><span class="s2">.</span><span class="s1">config </span><span class="s0">as </span><span class="s1">cf</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs </span><span class="s0">import </span><span class="s1">to_offset</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">Index</span><span class="s2">,</span>
    <span class="s1">Period</span><span class="s2">,</span>
    <span class="s1">PeriodIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
    <span class="s1">arrays</span><span class="s2">,</span>
    <span class="s1">date_range</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">plotting </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">deregister_matplotlib_converters</span><span class="s2">,</span>
    <span class="s1">register_matplotlib_converters</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">tseries</span><span class="s2">.</span><span class="s1">offsets </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">Day</span><span class="s2">,</span>
    <span class="s1">Micro</span><span class="s2">,</span>
    <span class="s1">Milli</span><span class="s2">,</span>
    <span class="s1">Second</span><span class="s2">,</span>
<span class="s2">)</span>

<span class="s0">try</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">plotting</span><span class="s2">.</span><span class="s1">_matplotlib </span><span class="s0">import </span><span class="s1">converter</span>
<span class="s0">except </span><span class="s1">ImportError</span><span class="s2">:</span>
    <span class="s3"># try / except, rather than skip, to avoid internal refactoring</span>
    <span class="s3"># causing an improper skip</span>
    <span class="s0">pass</span>

<span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.pyplot&quot;</span><span class="s2">)</span>
<span class="s1">dates </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.dates&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">single_cpu</span>
<span class="s0">def </span><span class="s1">test_registry_mpl_resets</span><span class="s2">():</span>
    <span class="s3"># Check that Matplotlib converters are properly reset (see issue #27481)</span>
    <span class="s1">code </span><span class="s2">= (</span>
        <span class="s4">&quot;import matplotlib.units as units; &quot;</span>
        <span class="s4">&quot;import matplotlib.dates as mdates; &quot;</span>
        <span class="s4">&quot;n_conv = len(units.registry); &quot;</span>
        <span class="s4">&quot;import pandas as pd; &quot;</span>
        <span class="s4">&quot;pd.plotting.register_matplotlib_converters(); &quot;</span>
        <span class="s4">&quot;pd.plotting.deregister_matplotlib_converters(); &quot;</span>
        <span class="s4">&quot;assert len(units.registry) == n_conv&quot;</span>
    <span class="s2">)</span>
    <span class="s1">call </span><span class="s2">= [</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">executable</span><span class="s2">, </span><span class="s4">&quot;-c&quot;</span><span class="s2">, </span><span class="s1">code</span><span class="s2">]</span>
    <span class="s1">subprocess</span><span class="s2">.</span><span class="s1">check_output</span><span class="s2">(</span><span class="s1">call</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_timtetonum_accepts_unicode</span><span class="s2">():</span>
    <span class="s0">assert </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">time2num</span><span class="s2">(</span><span class="s4">&quot;00:01&quot;</span><span class="s2">) == </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">time2num</span><span class="s2">(</span><span class="s4">&quot;00:01&quot;</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestRegistration</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">single_cpu</span>
    <span class="s0">def </span><span class="s1">test_dont_register_by_default</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Run in subprocess to ensure a clean state</span>
        <span class="s1">code </span><span class="s2">= (</span>
            <span class="s4">&quot;import matplotlib.units; &quot;</span>
            <span class="s4">&quot;import pandas as pd; &quot;</span>
            <span class="s4">&quot;units = dict(matplotlib.units.registry); &quot;</span>
            <span class="s4">&quot;assert pd.Timestamp not in units&quot;</span>
        <span class="s2">)</span>
        <span class="s1">call </span><span class="s2">= [</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">executable</span><span class="s2">, </span><span class="s4">&quot;-c&quot;</span><span class="s2">, </span><span class="s1">code</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">subprocess</span><span class="s2">.</span><span class="s1">check_call</span><span class="s2">(</span><span class="s1">call</span><span class="s2">) == </span><span class="s5">0</span>

    <span class="s0">def </span><span class="s1">test_registering_no_warning</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">plt </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.pyplot&quot;</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">12</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2017&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s5">12</span><span class="s2">))</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

        <span class="s3"># Set to the &quot;warn&quot; state, in case this isn't the first test run</span>
        <span class="s1">register_matplotlib_converters</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">s</span><span class="s2">.</span><span class="s1">values</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_pandas_plots_register</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">plt </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.pyplot&quot;</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">12</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2017&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s5">12</span><span class="s2">))</span>
        <span class="s3"># Set to the &quot;warn&quot; state, in case this isn't the first test run</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s0">None</span><span class="s2">) </span><span class="s0">as </span><span class="s1">w</span><span class="s2">:</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">()</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">w</span><span class="s2">) == </span><span class="s5">0</span>
        <span class="s0">finally</span><span class="s2">:</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_matplotlib_formatters</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">units </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.units&quot;</span><span class="s2">)</span>

        <span class="s3"># Can't make any assertion about the start state.</span>
        <span class="s3"># We we check that toggling converters off removes it, and toggling it</span>
        <span class="s3"># on restores it.</span>

        <span class="s0">with </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s4">&quot;plotting.matplotlib.register_converters&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">):</span>
            <span class="s0">with </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s4">&quot;plotting.matplotlib.register_converters&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
                <span class="s0">assert </span><span class="s1">Timestamp </span><span class="s0">not in </span><span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span>
            <span class="s0">assert </span><span class="s1">Timestamp </span><span class="s0">in </span><span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span>

    <span class="s0">def </span><span class="s1">test_option_no_warning</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.pyplot&quot;</span><span class="s2">)</span>
        <span class="s1">ctx </span><span class="s2">= </span><span class="s1">cf</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s4">&quot;plotting.matplotlib.register_converters&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">plt </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.pyplot&quot;</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">12</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2017&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s5">12</span><span class="s2">))</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

        <span class="s3"># Test without registering first, no warning</span>
        <span class="s0">with </span><span class="s1">ctx</span><span class="s2">:</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">s</span><span class="s2">.</span><span class="s1">values</span><span class="s2">)</span>

        <span class="s3"># Now test with registering</span>
        <span class="s1">register_matplotlib_converters</span><span class="s2">()</span>
        <span class="s0">with </span><span class="s1">ctx</span><span class="s2">:</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">s</span><span class="s2">.</span><span class="s1">values</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_registry_resets</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">units </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.units&quot;</span><span class="s2">)</span>
        <span class="s1">dates </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s4">&quot;matplotlib.dates&quot;</span><span class="s2">)</span>

        <span class="s3"># make a copy, to reset to</span>
        <span class="s1">original </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">)</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s3"># get to a known state</span>
            <span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
            <span class="s1">date_converter </span><span class="s2">= </span><span class="s1">dates</span><span class="s2">.</span><span class="s1">DateConverter</span><span class="s2">()</span>
            <span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">[</span><span class="s1">datetime</span><span class="s2">] = </span><span class="s1">date_converter</span>
            <span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">[</span><span class="s1">date</span><span class="s2">] = </span><span class="s1">date_converter</span>

            <span class="s1">register_matplotlib_converters</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">[</span><span class="s1">date</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">date_converter</span>
            <span class="s1">deregister_matplotlib_converters</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">[</span><span class="s1">date</span><span class="s2">] </span><span class="s0">is </span><span class="s1">date_converter</span>

        <span class="s0">finally</span><span class="s2">:</span>
            <span class="s3"># restore original stater</span>
            <span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
            <span class="s0">for </span><span class="s1">k</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">original</span><span class="s2">.</span><span class="s1">items</span><span class="s2">():</span>
                <span class="s1">units</span><span class="s2">.</span><span class="s1">registry</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">v</span>


<span class="s0">class </span><span class="s1">TestDateTimeConverter</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
    <span class="s0">def </span><span class="s1">dtc</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">DatetimeConverter</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_convert_accepts_unicode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtc</span><span class="s2">):</span>
        <span class="s1">r1 </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2000-01-01 12:22&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">r2 </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2000-01-01 12:22&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">r1 </span><span class="s2">== </span><span class="s1">r2</span><span class="s2">, </span><span class="s4">&quot;DatetimeConverter.convert should accept unicode&quot;</span>

    <span class="s0">def </span><span class="s1">test_conversion</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtc</span><span class="s2">):</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">([</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">], </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">xp </span><span class="s2">= </span><span class="s1">dates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2012</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">date</span><span class="s2">(</span><span class="s5">2012</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">), </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s3"># also testing datetime64 dtype (GH8614)</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-01-01&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-01-01 00:00:00+0000&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">&quot;2012-01-01 00:00:00+0000&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-01-02 00:00:00+0000&quot;</span><span class="s2">]),</span>
            <span class="s0">None</span><span class="s2">,</span>
            <span class="s0">None</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s1">xp</span>

        <span class="s3"># we have a tz-aware date (constructed to that when we turn to utc it</span>
        <span class="s3"># is the same as our sample)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2012-01-01&quot;</span><span class="s2">).</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s4">&quot;UTC&quot;</span><span class="s2">).</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s2">)</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">.</span><span class="s1">to_pydatetime</span><span class="s2">(), </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">Index</span><span class="s2">([</span><span class="s1">ts </span><span class="s2">- </span><span class="s1">Day</span><span class="s2">(</span><span class="s5">1</span><span class="s2">), </span><span class="s1">ts</span><span class="s2">]), </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] == </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">Index</span><span class="s2">([</span><span class="s1">ts </span><span class="s2">- </span><span class="s1">Day</span><span class="s2">(</span><span class="s5">1</span><span class="s2">), </span><span class="s1">ts</span><span class="s2">]).</span><span class="s1">to_pydatetime</span><span class="s2">(), </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] == </span><span class="s1">xp</span>

    <span class="s0">def </span><span class="s1">test_conversion_float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtc</span><span class="s2">):</span>
        <span class="s1">rtol </span><span class="s2">= </span><span class="s5">0.5 </span><span class="s2">* </span><span class="s5">10</span><span class="s2">**-</span><span class="s5">9</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2012-1-1 01:02:03&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;UTC&quot;</span><span class="s2">), </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">xp </span><span class="s2">= </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2012-1-1 01:02:03&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;UTC&quot;</span><span class="s2">))</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">rs</span><span class="s2">, </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s1">rtol</span><span class="s2">)</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span>
            <span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2012-1-1 09:02:03&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;Asia/Hong_Kong&quot;</span><span class="s2">), </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">rs</span><span class="s2">, </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s1">rtol</span><span class="s2">)</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2012</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">rs</span><span class="s2">, </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s1">rtol</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;values&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">[</span><span class="s1">date</span><span class="s2">(</span><span class="s5">1677</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">date</span><span class="s2">(</span><span class="s5">1677</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)],</span>
            <span class="s2">[</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">1677</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">12</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">1677</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">12</span><span class="s2">)],</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_conversion_outofbounds_datetime</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtc</span><span class="s2">, </span><span class="s1">values</span><span class="s2">):</span>
        <span class="s3"># 2579</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">xp </span><span class="s2">= </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">values</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">rs</span><span class="s2">, </span><span class="s1">xp</span><span class="s2">)</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">values</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">xp </span><span class="s2">= </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">values</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;time,format_expected&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">&quot;00:00&quot;</span><span class="s2">),  </span><span class="s3"># time2num(datetime.time.min)</span>
            <span class="s2">(</span><span class="s5">86399.999999</span><span class="s2">, </span><span class="s4">&quot;23:59:59.999999&quot;</span><span class="s2">),  </span><span class="s3"># time2num(datetime.time.max)</span>
            <span class="s2">(</span><span class="s5">90000</span><span class="s2">, </span><span class="s4">&quot;01:00&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s5">3723</span><span class="s2">, </span><span class="s4">&quot;01:02:03&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s5">39723.2</span><span class="s2">, </span><span class="s4">&quot;11:02:03.200&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_time_formatter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">time</span><span class="s2">, </span><span class="s1">format_expected</span><span class="s2">):</span>
        <span class="s3"># issue 18478</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">TimeFormatter</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)(</span><span class="s1">time</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">format_expected</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;freq&quot;</span><span class="s2">, (</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;ms&quot;</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">))</span>
    <span class="s0">def </span><span class="s1">test_dateindex_conversion</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">dtc</span><span class="s2">):</span>
        <span class="s1">rtol </span><span class="s2">= </span><span class="s5">10</span><span class="s2">**-</span><span class="s5">9</span>
        <span class="s1">dateindex </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2020-01-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">dateindex</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">xp </span><span class="s2">= </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">dateindex</span><span class="s2">.</span><span class="s1">_mpl_repr</span><span class="s2">())</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">rs</span><span class="s2">, </span><span class="s1">xp</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s1">rtol</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;offset&quot;</span><span class="s2">, [</span><span class="s1">Second</span><span class="s2">(), </span><span class="s1">Milli</span><span class="s2">(), </span><span class="s1">Micro</span><span class="s2">(</span><span class="s5">50</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_resolution</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">dtc</span><span class="s2">):</span>
        <span class="s3"># Matplotlib's time representation using floats cannot distinguish</span>
        <span class="s3"># intervals smaller than ~10 microsecond in the common range of years.</span>
        <span class="s1">ts1 </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">)</span>
        <span class="s1">ts2 </span><span class="s2">= </span><span class="s1">ts1 </span><span class="s2">+ </span><span class="s1">offset</span>
        <span class="s1">val1 </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">ts1</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">val2 </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">ts2</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">if not </span><span class="s1">val1 </span><span class="s2">&lt; </span><span class="s1">val2</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">AssertionError</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">val1</span><span class="s0">} </span><span class="s4">is not less than </span><span class="s0">{</span><span class="s1">val2</span><span class="s0">}</span><span class="s4">.&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_convert_nested</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dtc</span><span class="s2">):</span>
        <span class="s1">inner </span><span class="s2">= [</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s2">), </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2017-01-02&quot;</span><span class="s2">)]</span>
        <span class="s1">data </span><span class="s2">= [</span><span class="s1">inner</span><span class="s2">, </span><span class="s1">inner</span><span class="s2">]</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= [</span><span class="s1">dtc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">data</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">result</span><span class="s2">) == </span><span class="s1">expected</span><span class="s2">).</span><span class="s1">all</span><span class="s2">()</span>


<span class="s0">class </span><span class="s1">TestPeriodConverter</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
    <span class="s0">def </span><span class="s1">pc</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">PeriodConverter</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
    <span class="s0">def </span><span class="s1">axis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">class </span><span class="s1">Axis</span><span class="s2">:</span>
            <span class="s0">pass</span>

        <span class="s1">axis </span><span class="s2">= </span><span class="s1">Axis</span><span class="s2">()</span>
        <span class="s1">axis</span><span class="s2">.</span><span class="s1">freq </span><span class="s2">= </span><span class="s4">&quot;D&quot;</span>
        <span class="s0">return </span><span class="s1">axis</span>

    <span class="s0">def </span><span class="s1">test_convert_accepts_unicode</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pc</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">):</span>
        <span class="s1">r1 </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s1">r2 </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">r1 </span><span class="s2">== </span><span class="s1">r2</span>

    <span class="s0">def </span><span class="s1">test_conversion</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pc</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">):</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">([</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">], </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">xp </span><span class="s2">= </span><span class="s1">Period</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">).</span><span class="s1">ordinal</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">([</span><span class="s1">date</span><span class="s2">(</span><span class="s5">2012</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)], </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">date</span><span class="s2">(</span><span class="s5">2012</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">([</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">)], </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">), </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-01-01&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;2012-01-01 00:00:00+0000&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
                <span class="s2">[</span><span class="s4">&quot;2012-01-01 00:00:00&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-01-02 00:00:00&quot;</span><span class="s2">],</span>
                <span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s2">,</span>
            <span class="s2">),</span>
            <span class="s0">None</span><span class="s2">,</span>
            <span class="s1">axis</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s1">xp</span>

    <span class="s0">def </span><span class="s1">test_integer_passthrough</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pc</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">):</span>
        <span class="s3"># GH9012</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s1">xp </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">rs </span><span class="s2">== </span><span class="s1">xp</span>

    <span class="s0">def </span><span class="s1">test_convert_nested</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pc</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">):</span>
        <span class="s1">data </span><span class="s2">= [</span><span class="s4">&quot;2012-1-1&quot;</span><span class="s2">, </span><span class="s4">&quot;2012-1-2&quot;</span><span class="s2">]</span>
        <span class="s1">r1 </span><span class="s2">= </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">([</span><span class="s1">data</span><span class="s2">, </span><span class="s1">data</span><span class="s2">], </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">)</span>
        <span class="s1">r2 </span><span class="s2">= [</span><span class="s1">pc</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)]</span>
        <span class="s0">assert </span><span class="s1">r1 </span><span class="s2">== </span><span class="s1">r2</span>


<span class="s0">class </span><span class="s1">TestTimeDeltaConverter</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Test timedelta converter&quot;&quot;&quot;</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;x, decimal, format_expected&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s4">&quot;00:00:00&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s5">3972320000000</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s4">&quot;01:06:12.3&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s5">713233432000000</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s4">&quot;8 days 06:07:13.43&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s5">32423432000000</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s4">&quot;09:00:23.4320&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_format_timedelta_ticks</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">, </span><span class="s1">format_expected</span><span class="s2">):</span>
        <span class="s1">tdc </span><span class="s2">= </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">TimeSeries_TimedeltaFormatter</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">tdc</span><span class="s2">.</span><span class="s1">format_timedelta_ticks</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">n_decimals</span><span class="s2">=</span><span class="s1">decimal</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">format_expected</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;view_interval&quot;</span><span class="s2">, [(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_call_w_different_view_intervals</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">view_interval</span><span class="s2">, </span><span class="s1">monkeypatch</span><span class="s2">):</span>
        <span class="s3"># previously broke on reversed xlmits; see GH37454</span>
        <span class="s0">class </span><span class="s1">mock_axis</span><span class="s2">:</span>
            <span class="s0">def </span><span class="s1">get_view_interval</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s0">return </span><span class="s1">view_interval</span>

        <span class="s1">tdc </span><span class="s2">= </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">TimeSeries_TimedeltaFormatter</span><span class="s2">()</span>
        <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">tdc</span><span class="s2">, </span><span class="s4">&quot;axis&quot;</span><span class="s2">, </span><span class="s1">mock_axis</span><span class="s2">())</span>
        <span class="s1">tdc</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;year_span&quot;</span><span class="s2">, [</span><span class="s5">11.25</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">80</span><span class="s2">, </span><span class="s5">150</span><span class="s2">, </span><span class="s5">400</span><span class="s2">, </span><span class="s5">800</span><span class="s2">, </span><span class="s5">1500</span><span class="s2">, </span><span class="s5">2500</span><span class="s2">, </span><span class="s5">3500</span><span class="s2">])</span>
<span class="s3"># The range is limited to 11.25 at the bottom by if statements in</span>
<span class="s3"># the _quarterly_finder() function</span>
<span class="s0">def </span><span class="s1">test_quarterly_finder</span><span class="s2">(</span><span class="s1">year_span</span><span class="s2">):</span>
    <span class="s1">vmin </span><span class="s2">= -</span><span class="s5">1000</span>
    <span class="s1">vmax </span><span class="s2">= </span><span class="s1">vmin </span><span class="s2">+ </span><span class="s1">year_span </span><span class="s2">* </span><span class="s5">4</span>
    <span class="s1">span </span><span class="s2">= </span><span class="s1">vmax </span><span class="s2">- </span><span class="s1">vmin </span><span class="s2">+ </span><span class="s5">1</span>
    <span class="s0">if </span><span class="s1">span </span><span class="s2">&lt; </span><span class="s5">45</span><span class="s2">:</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;the quarterly finder is only invoked if the span is &gt;= 45&quot;</span><span class="s2">)</span>
    <span class="s1">nyears </span><span class="s2">= </span><span class="s1">span </span><span class="s2">/ </span><span class="s5">4</span>
    <span class="s2">(</span><span class="s1">min_anndef</span><span class="s2">, </span><span class="s1">maj_anndef</span><span class="s2">) = </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">_get_default_annual_spacing</span><span class="s2">(</span><span class="s1">nyears</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">converter</span><span class="s2">.</span><span class="s1">_quarterly_finder</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">, </span><span class="s1">to_offset</span><span class="s2">(</span><span class="s4">&quot;QE&quot;</span><span class="s2">))</span>
    <span class="s1">quarters </span><span class="s2">= </span><span class="s1">PeriodIndex</span><span class="s2">(</span>
        <span class="s1">arrays</span><span class="s2">.</span><span class="s1">PeriodArray</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">result</span><span class="s2">]), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;period[Q]&quot;</span><span class="s2">)</span>
    <span class="s2">)</span>
    <span class="s1">majors </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">result</span><span class="s2">])</span>
    <span class="s1">minors </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">x</span><span class="s2">[</span><span class="s5">2</span><span class="s2">] </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">result</span><span class="s2">])</span>
    <span class="s1">major_quarters </span><span class="s2">= </span><span class="s1">quarters</span><span class="s2">[</span><span class="s1">majors</span><span class="s2">]</span>
    <span class="s1">minor_quarters </span><span class="s2">= </span><span class="s1">quarters</span><span class="s2">[</span><span class="s1">minors</span><span class="s2">]</span>
    <span class="s1">check_major_years </span><span class="s2">= </span><span class="s1">major_quarters</span><span class="s2">.</span><span class="s1">year </span><span class="s2">% </span><span class="s1">maj_anndef </span><span class="s2">== </span><span class="s5">0</span>
    <span class="s1">check_minor_years </span><span class="s2">= </span><span class="s1">minor_quarters</span><span class="s2">.</span><span class="s1">year </span><span class="s2">% </span><span class="s1">min_anndef </span><span class="s2">== </span><span class="s5">0</span>
    <span class="s1">check_major_quarters </span><span class="s2">= </span><span class="s1">major_quarters</span><span class="s2">.</span><span class="s1">quarter </span><span class="s2">== </span><span class="s5">1</span>
    <span class="s1">check_minor_quarters </span><span class="s2">= </span><span class="s1">minor_quarters</span><span class="s2">.</span><span class="s1">quarter </span><span class="s2">== </span><span class="s5">1</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">check_major_years</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">check_minor_years</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">check_major_quarters</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">check_minor_quarters</span><span class="s2">)</span>
</pre>
</body>
</html>