<html>
<head>
<title>test_readers.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
.s7 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_readers.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">datetime</span><span class="s2">,</span>
    <span class="s1">time</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">partial</span>
<span class="s0">from </span><span class="s1">io </span><span class="s0">import </span><span class="s1">BytesIO</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">from </span><span class="s1">pathlib </span><span class="s0">import </span><span class="s1">Path</span>
<span class="s0">import </span><span class="s1">platform</span>
<span class="s0">import </span><span class="s1">re</span>
<span class="s0">from </span><span class="s1">urllib</span><span class="s2">.</span><span class="s1">error </span><span class="s0">import </span><span class="s1">URLError</span>
<span class="s0">from </span><span class="s1">zipfile </span><span class="s0">import </span><span class="s1">BadZipFile</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_config </span><span class="s0">import </span><span class="s1">using_pyarrow_string_dtype</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">compat </span><span class="s0">import </span><span class="s1">is_platform_windows</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">_test_decorators </span><span class="s0">as </span><span class="s1">td</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DataFrame</span><span class="s2">,</span>
    <span class="s1">Index</span><span class="s2">,</span>
    <span class="s1">MultiIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">read_csv</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">arrays </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">ArrowStringArray</span><span class="s2">,</span>
    <span class="s1">StringArray</span><span class="s2">,</span>
<span class="s2">)</span>

<span class="s0">if </span><span class="s1">is_platform_windows</span><span class="s2">():</span>
    <span class="s1">pytestmark </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">single_cpu</span>

<span class="s1">read_ext_params </span><span class="s2">= [</span><span class="s3">&quot;.xls&quot;</span><span class="s2">, </span><span class="s3">&quot;.xlsx&quot;</span><span class="s2">, </span><span class="s3">&quot;.xlsm&quot;</span><span class="s2">, </span><span class="s3">&quot;.xlsb&quot;</span><span class="s2">, </span><span class="s3">&quot;.ods&quot;</span><span class="s2">]</span>
<span class="s1">engine_params </span><span class="s2">= [</span>
    <span class="s4"># Add any engines to test here</span>
    <span class="s4"># When defusedxml is installed it triggers deprecation warnings for</span>
    <span class="s4"># xlrd and openpyxl, so catch those here</span>
    <span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span>
        <span class="s3">&quot;xlrd&quot;</span><span class="s2">,</span>
        <span class="s1">marks</span><span class="s2">=[</span>
            <span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_no</span><span class="s2">(</span><span class="s3">&quot;xlrd&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">),</span>
    <span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span>
        <span class="s3">&quot;openpyxl&quot;</span><span class="s2">,</span>
        <span class="s1">marks</span><span class="s2">=[</span>
            <span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_no</span><span class="s2">(</span><span class="s3">&quot;openpyxl&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">),</span>
    <span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span>
        <span class="s0">None</span><span class="s2">,</span>
        <span class="s1">marks</span><span class="s2">=[</span>
            <span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_no</span><span class="s2">(</span><span class="s3">&quot;xlrd&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">),</span>
    <span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_no</span><span class="s2">(</span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">)),</span>
    <span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s3">&quot;odf&quot;</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_no</span><span class="s2">(</span><span class="s3">&quot;odf&quot;</span><span class="s2">)),</span>
    <span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s3">&quot;calamine&quot;</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_no</span><span class="s2">(</span><span class="s3">&quot;python_calamine&quot;</span><span class="s2">)),</span>
<span class="s2">]</span>


<span class="s0">def </span><span class="s1">_is_valid_engine_ext_pair</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
    <span class="s5">&quot;&quot;&quot; 
    Filter out invalid (engine, ext) pairs instead of skipping, as that 
    produces 500+ pytest.skips. 
    &quot;&quot;&quot;</span>
    <span class="s1">engine </span><span class="s2">= </span><span class="s1">engine</span><span class="s2">.</span><span class="s1">values</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>
    <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;openpyxl&quot; </span><span class="s0">and </span><span class="s1">read_ext </span><span class="s2">== </span><span class="s3">&quot;.xls&quot;</span><span class="s2">:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;odf&quot; </span><span class="s0">and </span><span class="s1">read_ext </span><span class="s2">!= </span><span class="s3">&quot;.ods&quot;</span><span class="s2">:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">read_ext </span><span class="s2">== </span><span class="s3">&quot;.ods&quot; </span><span class="s0">and </span><span class="s1">engine </span><span class="s0">not in </span><span class="s2">{</span><span class="s3">&quot;odf&quot;</span><span class="s2">, </span><span class="s3">&quot;calamine&quot;</span><span class="s2">}:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;pyxlsb&quot; </span><span class="s0">and </span><span class="s1">read_ext </span><span class="s2">!= </span><span class="s3">&quot;.xlsb&quot;</span><span class="s2">:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">read_ext </span><span class="s2">== </span><span class="s3">&quot;.xlsb&quot; </span><span class="s0">and </span><span class="s1">engine </span><span class="s0">not in </span><span class="s2">{</span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">, </span><span class="s3">&quot;calamine&quot;</span><span class="s2">}:</span>
        <span class="s0">return False</span>
    <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;xlrd&quot; </span><span class="s0">and </span><span class="s1">read_ext </span><span class="s2">!= </span><span class="s3">&quot;.xls&quot;</span><span class="s2">:</span>
        <span class="s0">return False</span>
    <span class="s0">return True</span>


<span class="s0">def </span><span class="s1">_transfer_marks</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; 
    engine gives us a pytest.param object with some marks, read_ext is just 
    a string.  We need to generate a new pytest.param inheriting the marks. 
    &quot;&quot;&quot;</span>
    <span class="s1">values </span><span class="s2">= </span><span class="s1">engine</span><span class="s2">.</span><span class="s1">values </span><span class="s2">+ (</span><span class="s1">read_ext</span><span class="s2">,)</span>
    <span class="s1">new_param </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">.</span><span class="s1">marks</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">new_param</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span>
    <span class="s1">params</span><span class="s2">=[</span>
        <span class="s1">_transfer_marks</span><span class="s2">(</span><span class="s1">eng</span><span class="s2">, </span><span class="s1">ext</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">eng </span><span class="s0">in </span><span class="s1">engine_params</span>
        <span class="s0">for </span><span class="s1">ext </span><span class="s0">in </span><span class="s1">read_ext_params</span>
        <span class="s0">if </span><span class="s1">_is_valid_engine_ext_pair</span><span class="s2">(</span><span class="s1">eng</span><span class="s2">, </span><span class="s1">ext</span><span class="s2">)</span>
    <span class="s2">],</span>
    <span class="s1">ids</span><span class="s2">=</span><span class="s1">str</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">engine_and_read_ext</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; 
    Fixture for Excel reader engine and read_ext, only including valid pairs. 
    &quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">engine</span><span class="s2">(</span><span class="s1">engine_and_read_ext</span><span class="s2">):</span>
    <span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext </span><span class="s2">= </span><span class="s1">engine_and_read_ext</span>
    <span class="s0">return </span><span class="s1">engine</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">read_ext</span><span class="s2">(</span><span class="s1">engine_and_read_ext</span><span class="s2">):</span>
    <span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext </span><span class="s2">= </span><span class="s1">engine_and_read_ext</span>
    <span class="s0">return </span><span class="s1">read_ext</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">df_ref</span><span class="s2">(</span><span class="s1">datapath</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot; 
    Obtain the reference data from read_csv with the Python engine. 
    &quot;&quot;&quot;</span>
    <span class="s1">filepath </span><span class="s2">= </span><span class="s1">datapath</span><span class="s2">(</span><span class="s3">&quot;io&quot;</span><span class="s2">, </span><span class="s3">&quot;data&quot;</span><span class="s2">, </span><span class="s3">&quot;csv&quot;</span><span class="s2">, </span><span class="s3">&quot;test1.csv&quot;</span><span class="s2">)</span>
    <span class="s1">df_ref </span><span class="s2">= </span><span class="s1">read_csv</span><span class="s2">(</span><span class="s1">filepath</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">parse_dates</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s3">&quot;python&quot;</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">df_ref</span>


<span class="s0">def </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">: </span><span class="s1">str </span><span class="s2">| </span><span class="s0">None</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
    <span class="s0">return </span><span class="s3">&quot;ns&quot;</span>


<span class="s0">def </span><span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">: </span><span class="s1">DataFrame</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s1">expected</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s0">None</span>
    <span class="s1">unit </span><span class="s2">= </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>
    <span class="s4"># error: &quot;Index&quot; has no attribute &quot;as_unit&quot;</span>
    <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)  </span><span class="s4"># type: ignore[attr-defined]</span>


<span class="s0">def </span><span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">:</span>
        <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span>
                <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Sheets containing datetimes not supported by pyxlsb&quot;</span>
            <span class="s2">)</span>
        <span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestReaders</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">autouse</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">cd_and_set_engine</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">datapath</span><span class="s2">, </span><span class="s1">monkeypatch</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Change directory and set engine for read_excel calls. 
        &quot;&quot;&quot;</span>
        <span class="s1">func </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>
        <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">chdir</span><span class="s2">(</span><span class="s1">datapath</span><span class="s2">(</span><span class="s3">&quot;io&quot;</span><span class="s2">, </span><span class="s3">&quot;data&quot;</span><span class="s2">, </span><span class="s3">&quot;excel&quot;</span><span class="s2">))</span>
        <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">, </span><span class="s3">&quot;read_excel&quot;</span><span class="s2">, </span><span class="s1">func</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_engine_used</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">monkeypatch</span><span class="s2">):</span>
        <span class="s4"># GH 38884</span>
        <span class="s0">def </span><span class="s1">parser</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">engine</span>

        <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">, </span><span class="s3">&quot;parse&quot;</span><span class="s2">, </span><span class="s1">parser</span><span class="s2">)</span>

        <span class="s1">expected_defaults </span><span class="s2">= {</span>
            <span class="s3">&quot;xlsx&quot;</span><span class="s2">: </span><span class="s3">&quot;openpyxl&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;xlsm&quot;</span><span class="s2">: </span><span class="s3">&quot;openpyxl&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;xlsb&quot;</span><span class="s2">: </span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;xls&quot;</span><span class="s2">: </span><span class="s3">&quot;xlrd&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;ods&quot;</span><span class="s2">: </span><span class="s3">&quot;odf&quot;</span><span class="s2">,</span>
        <span class="s2">}</span>

        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">f</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">engine </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">engine</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected_defaults</span><span class="s2">[</span><span class="s1">read_ext</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]]</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_engine_kwargs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">):</span>
        <span class="s4"># GH#52214</span>
        <span class="s1">expected_defaults </span><span class="s2">= {</span>
            <span class="s3">&quot;xlsx&quot;</span><span class="s2">: {</span><span class="s3">&quot;foo&quot;</span><span class="s2">: </span><span class="s3">&quot;abcd&quot;</span><span class="s2">},</span>
            <span class="s3">&quot;xlsm&quot;</span><span class="s2">: {</span><span class="s3">&quot;foo&quot;</span><span class="s2">: </span><span class="s6">123</span><span class="s2">},</span>
            <span class="s3">&quot;xlsb&quot;</span><span class="s2">: {</span><span class="s3">&quot;foo&quot;</span><span class="s2">: </span><span class="s3">&quot;True&quot;</span><span class="s2">},</span>
            <span class="s3">&quot;xls&quot;</span><span class="s2">: {</span><span class="s3">&quot;foo&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">},</span>
            <span class="s3">&quot;ods&quot;</span><span class="s2">: {</span><span class="s3">&quot;foo&quot;</span><span class="s2">: </span><span class="s3">&quot;abcd&quot;</span><span class="s2">},</span>
        <span class="s2">}</span>

        <span class="s0">if </span><span class="s1">engine </span><span class="s0">in </span><span class="s2">{</span><span class="s3">&quot;xlrd&quot;</span><span class="s2">, </span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">}:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s1">re</span><span class="s2">.</span><span class="s1">escape</span><span class="s2">(</span><span class="s3">r&quot;open_workbook() got an unexpected keyword argument 'foo'&quot;</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;odf&quot;</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s1">re</span><span class="s2">.</span><span class="s1">escape</span><span class="s2">(</span><span class="s3">r&quot;load() got an unexpected keyword argument 'foo'&quot;</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s1">re</span><span class="s2">.</span><span class="s1">escape</span><span class="s2">(</span><span class="s3">r&quot;load_workbook() got an unexpected keyword argument 'foo'&quot;</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">engine </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                    <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
                    <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">,</span>
                    <span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">,</span>
                    <span class="s1">engine_kwargs</span><span class="s2">=</span><span class="s1">expected_defaults</span><span class="s2">[</span><span class="s1">read_ext</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]],</span>
                <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_usecols_int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># usecols as int</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Passing an integer for `usecols`&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s6">3</span>
            <span class="s2">)</span>

        <span class="s4"># usecols as int</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
                <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet2&quot;</span><span class="s2">,</span>
                <span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">],</span>
                <span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">,</span>
                <span class="s1">usecols</span><span class="s2">=</span><span class="s6">3</span><span class="s2">,</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_usecols_list</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span><span class="s2">[[</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">]]</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">df1 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">df2 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet2&quot;</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">],</span>
            <span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">usecols</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">],</span>
        <span class="s2">)</span>

        <span class="s4"># TODO add index to xls file)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df1</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_usecols_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span><span class="s2">[[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">]]</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">df2 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s3">&quot;A:D&quot;</span>
        <span class="s2">)</span>
        <span class="s1">df3 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet2&quot;</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">],</span>
            <span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">usecols</span><span class="s2">=</span><span class="s3">&quot;A:D&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>

        <span class="s4"># TODO add index to xls, read xls ignores index name ?</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df3</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span><span class="s2">[[</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">]]</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">df2 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s3">&quot;A,C,D&quot;</span>
        <span class="s2">)</span>
        <span class="s1">df3 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet2&quot;</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">],</span>
            <span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">usecols</span><span class="s2">=</span><span class="s3">&quot;A,C,D&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s4"># TODO add index to xls file</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df3</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">df2 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s3">&quot;A,C:D&quot;</span>
        <span class="s2">)</span>
        <span class="s1">df3 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet2&quot;</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">],</span>
            <span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">,</span>
            <span class="s1">usecols</span><span class="s2">=</span><span class="s3">&quot;A,C:D&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df3</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;usecols&quot;</span><span class="s2">, [[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">]]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_usecols_diff_positional_int_columns_order</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">, </span><span class="s1">df_ref</span>
    <span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span><span class="s2">[[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">]]</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s1">usecols</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;usecols&quot;</span><span class="s2">, [[</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">], [</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">]])</span>
    <span class="s0">def </span><span class="s1">test_usecols_diff_positional_str_columns_order</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span><span class="s2">[[</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">]]</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">))</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s1">usecols</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_without_slicing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_usecols_excel_range_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span><span class="s2">[[</span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">]]</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s3">&quot;A,D:E&quot;</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_usecols_excel_range_str_invalid</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Invalid column name: E1&quot;</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s3">&quot;D:E1&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_index_col_label_error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;list indices must be integers.*, not str&quot;</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
                <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">,</span>
                <span class="s1">index_col</span><span class="s2">=[</span><span class="s3">&quot;A&quot;</span><span class="s2">],</span>
                <span class="s1">usecols</span><span class="s2">=[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">],</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_index_col_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># see gh-52716</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet3&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s3">&quot;A&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;E&quot;</span><span class="s2">, </span><span class="s3">&quot;F&quot;</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">Index</span><span class="s2">([], </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;A&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_index_col_empty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># see gh-9208</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet3&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;E&quot;</span><span class="s2">, </span><span class="s3">&quot;F&quot;</span><span class="s2">],</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">=[[]] * </span><span class="s6">3</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">=[[]] * </span><span class="s6">3</span><span class="s2">, </span><span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;C&quot;</span><span class="s2">]),</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;index_col&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s6">2</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_index_col_with_unnamed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">):</span>
        <span class="s4"># see gh-18792</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet4&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s1">index_col</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s3">&quot;i1&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;x&quot;</span><span class="s2">], [</span><span class="s3">&quot;i2&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;y&quot;</span><span class="s2">]], </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Unnamed: 0&quot;</span><span class="s2">, </span><span class="s3">&quot;col1&quot;</span><span class="s2">, </span><span class="s3">&quot;col2&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s0">if </span><span class="s1">index_col</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">set_index</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">.</span><span class="s1">columns</span><span class="s2">[</span><span class="s1">index_col</span><span class="s2">])</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_usecols_pass_non_existent_column</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= (</span>
            <span class="s3">&quot;Usecols do not match columns, &quot;</span>
            <span class="s3">&quot;columns expected but not found: &quot;</span>
            <span class="s3">r&quot;\['E'\]&quot;</span>
        <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=[</span><span class="s3">&quot;E&quot;</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_usecols_wrong_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= (</span>
            <span class="s3">&quot;'usecols' must either be list-like of &quot;</span>
            <span class="s3">&quot;all strings, all unicode, all integers or a callable.&quot;</span>
        <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=[</span><span class="s3">&quot;E1&quot;</span><span class="s2">, </span><span class="s6">0</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_excel_stop_iterator</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">parsed </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test2&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s3">&quot;aaaa&quot;</span><span class="s2">, </span><span class="s3">&quot;bbbbb&quot;</span><span class="s2">]], </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Test&quot;</span><span class="s2">, </span><span class="s3">&quot;Test1&quot;</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">parsed</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_excel_cell_error_na</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s4"># https://github.com/tafia/calamine/issues/355</span>
        <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;calamine&quot; </span><span class="s0">and </span><span class="s1">read_ext </span><span class="s2">== </span><span class="s3">&quot;.ods&quot;</span><span class="s2">:</span>
            <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
                <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Calamine can't extract error from ods files&quot;</span><span class="s2">)</span>
            <span class="s2">)</span>

        <span class="s1">parsed </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test3&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]], </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Test&quot;</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">parsed</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_excel_table</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">df1 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">df2 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet2&quot;</span><span class="s2">, </span><span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span>
        <span class="s2">)</span>
        <span class="s4"># TODO add index to file</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df1</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">df3 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">skipfooter</span><span class="s2">=</span><span class="s6">1</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df3</span><span class="s2">, </span><span class="s1">df1</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_reader_special_dtypes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">unit </span><span class="s2">= </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">.</span><span class="s1">from_dict</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s3">&quot;IntCol&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, -</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
                <span class="s3">&quot;FloatCol&quot;</span><span class="s2">: [</span><span class="s6">1.25</span><span class="s2">, </span><span class="s6">2.25</span><span class="s2">, </span><span class="s6">1.83</span><span class="s2">, </span><span class="s6">1.92</span><span class="s2">, </span><span class="s6">0.0000000005</span><span class="s2">],</span>
                <span class="s3">&quot;BoolCol&quot;</span><span class="s2">: [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s3">&quot;StrCol&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">],</span>
                <span class="s3">&quot;Str2Col&quot;</span><span class="s2">: [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">, </span><span class="s3">&quot;e&quot;</span><span class="s2">],</span>
                <span class="s3">&quot;DateCol&quot;</span><span class="s2">: </span><span class="s1">Index</span><span class="s2">(</span>
                    <span class="s2">[</span>
                        <span class="s1">datetime</span><span class="s2">(</span><span class="s6">2013</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, </span><span class="s6">30</span><span class="s2">),</span>
                        <span class="s1">datetime</span><span class="s2">(</span><span class="s6">2013</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, </span><span class="s6">31</span><span class="s2">),</span>
                        <span class="s1">datetime</span><span class="s2">(</span><span class="s6">1905</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">),</span>
                        <span class="s1">datetime</span><span class="s2">(</span><span class="s6">2013</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s6">14</span><span class="s2">),</span>
                        <span class="s1">datetime</span><span class="s2">(</span><span class="s6">2015</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">14</span><span class="s2">),</span>
                    <span class="s2">],</span>
                    <span class="s1">dtype</span><span class="s2">=</span><span class="s3">f&quot;M8[</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s2">,</span>
                <span class="s2">),</span>
            <span class="s2">},</span>
        <span class="s2">)</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;test_types&quot;</span>

        <span class="s4"># should read in correctly and infer types</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># if not coercing number, then int comes in as float</span>
        <span class="s1">float_expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">float_expected</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">float_expected</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s3">&quot;Str2Col&quot;</span><span class="s2">] = </span><span class="s6">3.0</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">float_expected</span><span class="s2">)</span>

        <span class="s4"># check setting Index (assuming xls and xlsx are the same here)</span>
        <span class="s0">for </span><span class="s1">icol</span><span class="s2">, </span><span class="s1">name </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">.</span><span class="s1">columns</span><span class="s2">):</span>
            <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s1">icol</span>
            <span class="s2">)</span>
            <span class="s1">exp </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">set_index</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">)</span>

        <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;StrCol&quot;</span><span class="s2">] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;StrCol&quot;</span><span class="s2">].</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">str</span><span class="s2">)</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">converters</span><span class="s2">={</span><span class="s3">&quot;StrCol&quot;</span><span class="s2">: </span><span class="s1">str</span><span class="s2">}</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s4"># GH8212 - support for converters and missing values</span>
    <span class="s0">def </span><span class="s1">test_reader_converters</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;test_converters&quot;</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">.</span><span class="s1">from_dict</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s3">&quot;IntCol&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, -</span><span class="s6">3</span><span class="s2">, -</span><span class="s6">1000</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
                <span class="s3">&quot;FloatCol&quot;</span><span class="s2">: [</span><span class="s6">12.5</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s6">18.3</span><span class="s2">, </span><span class="s6">19.2</span><span class="s2">, </span><span class="s6">0.000000005</span><span class="s2">],</span>
                <span class="s3">&quot;BoolCol&quot;</span><span class="s2">: [</span><span class="s3">&quot;Found&quot;</span><span class="s2">, </span><span class="s3">&quot;Found&quot;</span><span class="s2">, </span><span class="s3">&quot;Found&quot;</span><span class="s2">, </span><span class="s3">&quot;Not found&quot;</span><span class="s2">, </span><span class="s3">&quot;Found&quot;</span><span class="s2">],</span>
                <span class="s3">&quot;StrCol&quot;</span><span class="s2">: [</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s3">&quot;3&quot;</span><span class="s2">, </span><span class="s3">&quot;4&quot;</span><span class="s2">, </span><span class="s3">&quot;5&quot;</span><span class="s2">],</span>
            <span class="s2">}</span>
        <span class="s2">)</span>

        <span class="s1">converters </span><span class="s2">= {</span>
            <span class="s3">&quot;IntCol&quot;</span><span class="s2">: </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">int</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">if </span><span class="s1">x </span><span class="s2">!= </span><span class="s3">&quot;&quot; </span><span class="s0">else </span><span class="s2">-</span><span class="s6">1000</span><span class="s2">,</span>
            <span class="s3">&quot;FloatCol&quot;</span><span class="s2">: </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s6">10 </span><span class="s2">* </span><span class="s1">x </span><span class="s0">if </span><span class="s1">x </span><span class="s0">else </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
            <span class="s6">2</span><span class="s2">: </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s3">&quot;Found&quot; </span><span class="s0">if </span><span class="s1">x </span><span class="s2">!= </span><span class="s3">&quot;&quot; </span><span class="s0">else </span><span class="s3">&quot;Not found&quot;</span><span class="s2">,</span>
            <span class="s6">3</span><span class="s2">: </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">if </span><span class="s1">x </span><span class="s0">else </span><span class="s3">&quot;&quot;</span><span class="s2">,</span>
        <span class="s2">}</span>

        <span class="s4"># should read in correctly and set types of single cells (not array</span>
        <span class="s4"># dtypes)</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">converters</span><span class="s2">=</span><span class="s1">converters</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reader_dtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 8212</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;testdtype&quot;</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s3">&quot;a&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">],</span>
                <span class="s3">&quot;b&quot;</span><span class="s2">: [</span><span class="s6">2.5</span><span class="s2">, </span><span class="s6">3.5</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">, </span><span class="s6">5.5</span><span class="s2">],</span>
                <span class="s3">&quot;c&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">],</span>
                <span class="s3">&quot;d&quot;</span><span class="s2">: [</span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">2.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s6">4.0</span><span class="s2">],</span>
            <span class="s2">}</span>
        <span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">={</span><span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s3">&quot;float64&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">: </span><span class="s3">&quot;float32&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">: </span><span class="s1">str</span><span class="s2">}</span>
        <span class="s2">)</span>

        <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;a&quot;</span><span class="s2">] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;a&quot;</span><span class="s2">].</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">&quot;float64&quot;</span><span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;b&quot;</span><span class="s2">] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;b&quot;</span><span class="s2">].</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">&quot;float32&quot;</span><span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;c&quot;</span><span class="s2">] = </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;001&quot;</span><span class="s2">, </span><span class="s3">&quot;002&quot;</span><span class="s2">, </span><span class="s3">&quot;003&quot;</span><span class="s2">, </span><span class="s3">&quot;004&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Unable to convert column d to type int64&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">={</span><span class="s3">&quot;d&quot;</span><span class="s2">: </span><span class="s3">&quot;int64&quot;</span><span class="s2">})</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;dtype,expected&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span>
                <span class="s0">None</span><span class="s2">,</span>
                <span class="s1">DataFrame</span><span class="s2">(</span>
                    <span class="s2">{</span>
                        <span class="s3">&quot;a&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">],</span>
                        <span class="s3">&quot;b&quot;</span><span class="s2">: [</span><span class="s6">2.5</span><span class="s2">, </span><span class="s6">3.5</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">, </span><span class="s6">5.5</span><span class="s2">],</span>
                        <span class="s3">&quot;c&quot;</span><span class="s2">: [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">],</span>
                        <span class="s3">&quot;d&quot;</span><span class="s2">: [</span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">2.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s6">4.0</span><span class="s2">],</span>
                    <span class="s2">}</span>
                <span class="s2">),</span>
            <span class="s2">),</span>
            <span class="s2">(</span>
                <span class="s2">{</span><span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s3">&quot;float64&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">: </span><span class="s3">&quot;float32&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">: </span><span class="s1">str</span><span class="s2">},</span>
                <span class="s1">DataFrame</span><span class="s2">(</span>
                    <span class="s2">{</span>
                        <span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;float64&quot;</span><span class="s2">),</span>
                        <span class="s3">&quot;b&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">2.5</span><span class="s2">, </span><span class="s6">3.5</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">, </span><span class="s6">5.5</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;float32&quot;</span><span class="s2">),</span>
                        <span class="s3">&quot;c&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;001&quot;</span><span class="s2">, </span><span class="s3">&quot;002&quot;</span><span class="s2">, </span><span class="s3">&quot;003&quot;</span><span class="s2">, </span><span class="s3">&quot;004&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">),</span>
                        <span class="s3">&quot;d&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s3">&quot;4&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">),</span>
                    <span class="s2">}</span>
                <span class="s2">),</span>
            <span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_reader_dtype_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
        <span class="s4"># see gh-20377</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;testdtype&quot;</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dtype_backend</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">):</span>
        <span class="s4"># GH#36712</span>
        <span class="s0">if </span><span class="s1">read_ext </span><span class="s0">in </span><span class="s2">(</span><span class="s3">&quot;.xlsb&quot;</span><span class="s2">, </span><span class="s3">&quot;.xls&quot;</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">f&quot;No engine for filetype: '</span><span class="s0">{</span><span class="s1">read_ext</span><span class="s0">}</span><span class="s3">'&quot;</span><span class="s2">)</span>

        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int64&quot;</span><span class="s2">),</span>
                <span class="s3">&quot;b&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">2.5</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Float64&quot;</span><span class="s2">),</span>
                <span class="s3">&quot;c&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;boolean&quot;</span><span class="s2">),</span>
                <span class="s3">&quot;d&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;string&quot;</span><span class="s2">),</span>
                <span class="s3">&quot;e&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">, </span><span class="s6">6</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int64&quot;</span><span class="s2">),</span>
                <span class="s3">&quot;f&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">, </span><span class="s6">7.5</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Float64&quot;</span><span class="s2">),</span>
                <span class="s3">&quot;g&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">, </span><span class="s0">True</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;boolean&quot;</span><span class="s2">),</span>
                <span class="s3">&quot;h&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;string&quot;</span><span class="s2">),</span>
                <span class="s3">&quot;i&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2019-12-31&quot;</span><span class="s2">)] * </span><span class="s6">2</span><span class="s2">),</span>
                <span class="s3">&quot;j&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int64&quot;</span><span class="s2">),</span>
            <span class="s2">}</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">ensure_clean</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">file_path</span><span class="s2">:</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">to_excel</span><span class="s2">(</span><span class="s1">file_path</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;test&quot;</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s1">file_path</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;test&quot;</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s1">dtype_backend</span>
            <span class="s2">)</span>
        <span class="s0">if </span><span class="s1">dtype_backend </span><span class="s2">== </span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">:</span>
            <span class="s0">import </span><span class="s1">pyarrow </span><span class="s0">as </span><span class="s1">pa</span>

            <span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">arrays </span><span class="s0">import </span><span class="s1">ArrowExtensionArray</span>

            <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
                <span class="s2">{</span>
                    <span class="s1">col</span><span class="s2">: </span><span class="s1">ArrowExtensionArray</span><span class="s2">(</span><span class="s1">pa</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s1">col</span><span class="s2">], </span><span class="s1">from_pandas</span><span class="s2">=</span><span class="s0">True</span><span class="s2">))</span>
                    <span class="s0">for </span><span class="s1">col </span><span class="s0">in </span><span class="s1">df</span><span class="s2">.</span><span class="s1">columns</span>
                <span class="s2">}</span>
            <span class="s2">)</span>
            <span class="s4"># pyarrow by default infers timestamp resolution as us, not ns</span>
            <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;i&quot;</span><span class="s2">] = </span><span class="s1">ArrowExtensionArray</span><span class="s2">(</span>
                <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;i&quot;</span><span class="s2">].</span><span class="s1">array</span><span class="s2">.</span><span class="s1">_pa_array</span><span class="s2">.</span><span class="s1">cast</span><span class="s2">(</span><span class="s1">pa</span><span class="s2">.</span><span class="s1">timestamp</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">=</span><span class="s3">&quot;us&quot;</span><span class="s2">))</span>
            <span class="s2">)</span>
            <span class="s4"># pyarrow supports a null type, so don't have to default to Int64</span>
            <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;j&quot;</span><span class="s2">] = </span><span class="s1">ArrowExtensionArray</span><span class="s2">(</span><span class="s1">pa</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span>
            <span class="s1">unit </span><span class="s2">= </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>
            <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;i&quot;</span><span class="s2">] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;i&quot;</span><span class="s2">].</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">f&quot;M8[</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dtype_backend_and_dtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH#36712</span>
        <span class="s0">if </span><span class="s1">read_ext </span><span class="s0">in </span><span class="s2">(</span><span class="s3">&quot;.xlsb&quot;</span><span class="s2">, </span><span class="s3">&quot;.xls&quot;</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">f&quot;No engine for filetype: '</span><span class="s0">{</span><span class="s1">read_ext</span><span class="s0">}</span><span class="s3">'&quot;</span><span class="s2">)</span>

        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s3">&quot;a&quot;</span><span class="s2">: [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">], </span><span class="s3">&quot;b&quot;</span><span class="s2">: [</span><span class="s6">2.5</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]})</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">ensure_clean</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">file_path</span><span class="s2">:</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">to_excel</span><span class="s2">(</span><span class="s1">file_path</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;test&quot;</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s1">file_path</span><span class="s2">,</span>
                <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;test&quot;</span><span class="s2">,</span>
                <span class="s1">dtype_backend</span><span class="s2">=</span><span class="s3">&quot;numpy_nullable&quot;</span><span class="s2">,</span>
                <span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;float64&quot;</span><span class="s2">,</span>
            <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">df</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span>
        <span class="s1">using_pyarrow_string_dtype</span><span class="s2">(), </span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;infer_string takes precedence&quot;</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_dtype_backend_string</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">string_storage</span><span class="s2">):</span>
        <span class="s4"># GH#36712</span>
        <span class="s0">if </span><span class="s1">read_ext </span><span class="s0">in </span><span class="s2">(</span><span class="s3">&quot;.xlsb&quot;</span><span class="s2">, </span><span class="s3">&quot;.xls&quot;</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">f&quot;No engine for filetype: '</span><span class="s0">{</span><span class="s1">read_ext</span><span class="s0">}</span><span class="s3">'&quot;</span><span class="s2">)</span>

        <span class="s1">pa </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;mode.string_storage&quot;</span><span class="s2">, </span><span class="s1">string_storage</span><span class="s2">):</span>
            <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
                <span class="s2">{</span>
                    <span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">),</span>
                    <span class="s3">&quot;b&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">&quot;x&quot;</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">),</span>
                <span class="s2">}</span>
            <span class="s2">)</span>
            <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">ensure_clean</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">file_path</span><span class="s2">:</span>
                <span class="s1">df</span><span class="s2">.</span><span class="s1">to_excel</span><span class="s2">(</span><span class="s1">file_path</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;test&quot;</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                    <span class="s1">file_path</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;test&quot;</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s3">&quot;numpy_nullable&quot;</span>
                <span class="s2">)</span>

            <span class="s0">if </span><span class="s1">string_storage </span><span class="s2">== </span><span class="s3">&quot;python&quot;</span><span class="s2">:</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
                    <span class="s2">{</span>
                        <span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">StringArray</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)),</span>
                        <span class="s3">&quot;b&quot;</span><span class="s2">: </span><span class="s1">StringArray</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">&quot;x&quot;</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">object_</span><span class="s2">)),</span>
                    <span class="s2">}</span>
                <span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
                    <span class="s2">{</span>
                        <span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">ArrowStringArray</span><span class="s2">(</span><span class="s1">pa</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">])),</span>
                        <span class="s3">&quot;b&quot;</span><span class="s2">: </span><span class="s1">ArrowStringArray</span><span class="s2">(</span><span class="s1">pa</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">&quot;x&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">])),</span>
                    <span class="s2">}</span>
                <span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;dtypes, exp_value&quot;</span><span class="s2">, [({}, </span><span class="s6">1</span><span class="s2">), ({</span><span class="s3">&quot;a.1&quot;</span><span class="s2">: </span><span class="s3">&quot;int64&quot;</span><span class="s2">}, </span><span class="s6">1</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_dtype_mangle_dup_cols</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">dtypes</span><span class="s2">, </span><span class="s1">exp_value</span><span class="s2">):</span>
        <span class="s4"># GH#35211</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;df_mangle_dup_col_dtypes&quot;</span>
        <span class="s1">dtype_dict </span><span class="s2">= {</span><span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">object</span><span class="s2">, **</span><span class="s1">dtypes</span><span class="s2">}</span>
        <span class="s1">dtype_dict_copy </span><span class="s2">= </span><span class="s1">dtype_dict</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s4"># GH#42462</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype_dict</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">1</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">),</span>
                <span class="s3">&quot;a.1&quot;</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">exp_value</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object </span><span class="s0">if not </span><span class="s1">dtypes </span><span class="s0">else None</span><span class="s2">),</span>
            <span class="s2">}</span>
        <span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">dtype_dict </span><span class="s2">== </span><span class="s1">dtype_dict_copy</span><span class="s2">, </span><span class="s3">&quot;dtype dict changed&quot;</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reader_spaces</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># see gh-32207</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;test_spaces&quot;</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s3">&quot;testcol&quot;</span><span class="s2">: [</span>
                    <span class="s3">&quot;this is great&quot;</span><span class="s2">,</span>
                    <span class="s3">&quot;4    spaces&quot;</span><span class="s2">,</span>
                    <span class="s3">&quot;1 trailing &quot;</span><span class="s2">,</span>
                    <span class="s3">&quot; 1 leading&quot;</span><span class="s2">,</span>
                    <span class="s3">&quot;2  spaces  multiple  times&quot;</span><span class="s2">,</span>
                <span class="s2">]</span>
            <span class="s2">}</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s4"># gh-36122, gh-35802</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;basename,expected&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">&quot;gh-35802&quot;</span><span class="s2">, </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s3">&quot;COLUMN&quot;</span><span class="s2">: [</span><span class="s3">&quot;Test (1)&quot;</span><span class="s2">]})),</span>
            <span class="s2">(</span><span class="s3">&quot;gh-36122&quot;</span><span class="s2">, </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;got 2nd sa&quot;</span><span class="s2">])),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_read_excel_ods_nested_xml</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">basename</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
        <span class="s4"># see gh-35802</span>
        <span class="s0">if </span><span class="s1">engine </span><span class="s2">!= </span><span class="s3">&quot;odf&quot;</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">f&quot;Skipped for engine: </span><span class="s0">{</span><span class="s1">engine</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reading_all_sheets</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># Test reading all sheet names by setting sheet_name to None,</span>
        <span class="s4"># Ensure a dict is returned.</span>
        <span class="s4"># See PR #9450</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;test_multisheet&quot;</span>
        <span class="s1">dfs </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s4"># ensure this is not alphabetical to test order preservation</span>
        <span class="s1">expected_keys </span><span class="s2">= [</span><span class="s3">&quot;Charlie&quot;</span><span class="s2">, </span><span class="s3">&quot;Alpha&quot;</span><span class="s2">, </span><span class="s3">&quot;Beta&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_contains_all</span><span class="s2">(</span><span class="s1">expected_keys</span><span class="s2">, </span><span class="s1">dfs</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
        <span class="s4"># Issue 9930</span>
        <span class="s4"># Ensure sheet order is preserved</span>
        <span class="s0">assert </span><span class="s1">expected_keys </span><span class="s2">== </span><span class="s1">list</span><span class="s2">(</span><span class="s1">dfs</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_reading_multiple_specific_sheets</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># Test reading specific sheet names by specifying a mixed list</span>
        <span class="s4"># of integers and strings, and confirm that duplicated sheet</span>
        <span class="s4"># references (positions/names) are removed properly.</span>
        <span class="s4"># Ensure a dict is returned</span>
        <span class="s4"># See PR #9450</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;test_multisheet&quot;</span>
        <span class="s4"># Explicitly request duplicates. Only the set should be returned.</span>
        <span class="s1">expected_keys </span><span class="s2">= [</span><span class="s6">2</span><span class="s2">, </span><span class="s3">&quot;Charlie&quot;</span><span class="s2">, </span><span class="s3">&quot;Charlie&quot;</span><span class="s2">]</span>
        <span class="s1">dfs </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">expected_keys</span><span class="s2">)</span>
        <span class="s1">expected_keys </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">set</span><span class="s2">(</span><span class="s1">expected_keys</span><span class="s2">))</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_contains_all</span><span class="s2">(</span><span class="s1">expected_keys</span><span class="s2">, </span><span class="s1">dfs</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">expected_keys</span><span class="s2">) == </span><span class="s1">len</span><span class="s2">(</span><span class="s1">dfs</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_reading_all_sheets_with_blank</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># Test reading all sheet names by setting sheet_name to None,</span>
        <span class="s4"># In the case where some sheets are blank.</span>
        <span class="s4"># Issue #11711</span>
        <span class="s1">basename </span><span class="s2">= </span><span class="s3">&quot;blank_with_header&quot;</span>
        <span class="s1">dfs </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">basename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">expected_keys </span><span class="s2">= [</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s3">&quot;Sheet2&quot;</span><span class="s2">, </span><span class="s3">&quot;Sheet3&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_contains_all</span><span class="s2">(</span><span class="s1">expected_keys</span><span class="s2">, </span><span class="s1">dfs</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>

    <span class="s4"># GH6403</span>
    <span class="s0">def </span><span class="s1">test_read_excel_blank</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;blank&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">DataFrame</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_read_excel_blank_with_header</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;col_1&quot;</span><span class="s2">, </span><span class="s3">&quot;col_2&quot;</span><span class="s2">])</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;blank_with_header&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_exception_message_includes_sheet_name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 48706</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">r&quot; \(sheet: Sheet1\)$&quot;</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;blank_with_header&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ZeroDivisionError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">r&quot; \(sheet: Sheet1\)$&quot;</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">usecols</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s6">1 </span><span class="s2">/ </span><span class="s6">0</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:Cell A4 is marked:UserWarning:openpyxl&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_date_conversion_overflow</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 10001 : pandas.ExcelFile ignore parse_dates=False</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">[</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2016-03-12&quot;</span><span class="s2">), </span><span class="s3">&quot;Marc Johnson&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2016-03-16&quot;</span><span class="s2">), </span><span class="s3">&quot;Jack Black&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">1e20</span><span class="s2">, </span><span class="s3">&quot;Timothy Brown&quot;</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;DateColWithBigInt&quot;</span><span class="s2">, </span><span class="s3">&quot;StringCol&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>

        <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;openpyxl&quot;</span><span class="s2">:</span>
            <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
                <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Maybe not supported by openpyxl&quot;</span><span class="s2">)</span>
            <span class="s2">)</span>

        <span class="s0">if </span><span class="s1">engine </span><span class="s0">is None and </span><span class="s1">read_ext </span><span class="s0">in </span><span class="s2">(</span><span class="s3">&quot;.xlsx&quot;</span><span class="s2">, </span><span class="s3">&quot;.xlsm&quot;</span><span class="s2">):</span>
            <span class="s4"># GH 35029</span>
            <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
                <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Defaults to openpyxl, maybe not supported&quot;</span><span class="s2">)</span>
            <span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;testdateoverflow&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_sheet_name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">filename </span><span class="s2">= </span><span class="s3">&quot;test1&quot;</span>
        <span class="s1">sheet_name </span><span class="s2">= </span><span class="s3">&quot;Sheet1&quot;</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">df1 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">filename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span>
        <span class="s2">)  </span><span class="s4"># doc</span>
        <span class="s1">df2 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">filename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df1</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_excel_read_buffer</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">pth </span><span class="s2">= </span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">pth</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">pth</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">actual</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bad_engine_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">bad_engine </span><span class="s2">= </span><span class="s3">&quot;foo&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Unknown engine: foo&quot;</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">bad_engine</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;sheet_name&quot;</span><span class="s2">,</span>
        <span class="s2">[</span><span class="s6">3</span><span class="s2">, [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], </span><span class="s3">&quot;Sheet4&quot;</span><span class="s2">, [</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s3">&quot;Sheet4&quot;</span><span class="s2">], [</span><span class="s3">&quot;Sheet4&quot;</span><span class="s2">, </span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">]],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_bad_sheetname_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">):</span>
        <span class="s4"># GH 39250</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Worksheet index 3 is invalid|Worksheet named 'Sheet4' not found&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;blank&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_missing_file_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">bad_file </span><span class="s2">= </span><span class="s3">f&quot;foo</span><span class="s0">{</span><span class="s1">read_ext</span><span class="s0">}</span><span class="s3">&quot;</span>
        <span class="s4"># CI tests with other languages, translates to &quot;No such file or directory&quot;</span>
        <span class="s1">match </span><span class="s2">= </span><span class="s3">&quot;|&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s3">&quot;(No such file or directory&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;File o directory non esistente)&quot;</span><span class="s2">,</span>
            <span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">FileNotFoundError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">match</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">bad_file</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_corrupt_bytes_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">):</span>
        <span class="s1">bad_stream </span><span class="s2">= </span><span class="s7">b&quot;foo&quot;</span>
        <span class="s0">if </span><span class="s1">engine </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">error </span><span class="s2">= </span><span class="s1">ValueError</span>
            <span class="s1">msg </span><span class="s2">= (</span>
                <span class="s3">&quot;Excel file format cannot be determined, you must &quot;</span>
                <span class="s3">&quot;specify an engine manually.&quot;</span>
            <span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;xlrd&quot;</span><span class="s2">:</span>
            <span class="s0">from </span><span class="s1">xlrd </span><span class="s0">import </span><span class="s1">XLRDError</span>

            <span class="s1">error </span><span class="s2">= </span><span class="s1">XLRDError</span>
            <span class="s1">msg </span><span class="s2">= (</span>
                <span class="s3">&quot;Unsupported format, or corrupt file: Expected BOF &quot;</span>
                <span class="s3">&quot;record; found b'foo'&quot;</span>
            <span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;calamine&quot;</span><span class="s2">:</span>
            <span class="s0">from </span><span class="s1">python_calamine </span><span class="s0">import </span><span class="s1">CalamineError</span>

            <span class="s1">error </span><span class="s2">= </span><span class="s1">CalamineError</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Cannot detect file format&quot;</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">error </span><span class="s2">= </span><span class="s1">BadZipFile</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;File is not a zip file&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">error</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">bad_stream</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">network</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">single_cpu</span>
    <span class="s0">def </span><span class="s1">test_read_from_http_url</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">httpserver</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">httpserver</span><span class="s2">.</span><span class="s1">serve_content</span><span class="s2">(</span><span class="s1">content</span><span class="s2">=</span><span class="s1">f</span><span class="s2">.</span><span class="s1">read</span><span class="s2">())</span>
        <span class="s1">url_table </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">httpserver</span><span class="s2">.</span><span class="s1">url</span><span class="s2">)</span>
        <span class="s1">local_table </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">url_table</span><span class="s2">, </span><span class="s1">local_table</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_not_us_locale</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">single_cpu</span>
    <span class="s0">def </span><span class="s1">test_read_from_s3_url</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">s3_public_bucket</span><span class="s2">, </span><span class="s1">s3so</span><span class="s2">):</span>
        <span class="s4"># Bucket created in tests/io/conftest.py</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">s3_public_bucket</span><span class="s2">.</span><span class="s1">put_object</span><span class="s2">(</span><span class="s1">Key</span><span class="s2">=</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">Body</span><span class="s2">=</span><span class="s1">f</span><span class="s2">)</span>

        <span class="s1">url </span><span class="s2">= </span><span class="s3">f&quot;s3://</span><span class="s0">{</span><span class="s1">s3_public_bucket</span><span class="s2">.</span><span class="s1">name</span><span class="s0">}</span><span class="s3">/test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>

        <span class="s1">url_table </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">storage_options</span><span class="s2">=</span><span class="s1">s3so</span><span class="s2">)</span>
        <span class="s1">local_table </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">url_table</span><span class="s2">, </span><span class="s1">local_table</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">single_cpu</span>
    <span class="s0">def </span><span class="s1">test_read_from_s3_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">s3_public_bucket</span><span class="s2">, </span><span class="s1">s3so</span><span class="s2">):</span>
        <span class="s4"># GH 38788</span>
        <span class="s4"># Bucket created in tests/io/conftest.py</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">s3_public_bucket</span><span class="s2">.</span><span class="s1">put_object</span><span class="s2">(</span><span class="s1">Key</span><span class="s2">=</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">Body</span><span class="s2">=</span><span class="s1">f</span><span class="s2">)</span>

        <span class="s0">import </span><span class="s1">s3fs</span>

        <span class="s1">s3 </span><span class="s2">= </span><span class="s1">s3fs</span><span class="s2">.</span><span class="s1">S3FileSystem</span><span class="s2">(**</span><span class="s1">s3so</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">s3</span><span class="s2">.</span><span class="s1">open</span><span class="s2">(</span><span class="s3">f&quot;s3://</span><span class="s0">{</span><span class="s1">s3_public_bucket</span><span class="s2">.</span><span class="s1">name</span><span class="s0">}</span><span class="s3">/test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">url_table </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">f</span><span class="s2">)</span>

        <span class="s1">local_table </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">url_table</span><span class="s2">, </span><span class="s1">local_table</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span>
    <span class="s0">def </span><span class="s1">test_read_from_file_url</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">datapath</span><span class="s2">):</span>
        <span class="s4"># FILE</span>
        <span class="s1">localtable </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">datapath</span><span class="s2">(</span><span class="s3">&quot;io&quot;</span><span class="s2">, </span><span class="s3">&quot;data&quot;</span><span class="s2">, </span><span class="s3">&quot;excel&quot;</span><span class="s2">), </span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">local_table </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">localtable</span><span class="s2">)</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">url_table </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;file://localhost/&quot; </span><span class="s2">+ </span><span class="s1">localtable</span><span class="s2">)</span>
        <span class="s0">except </span><span class="s1">URLError</span><span class="s2">:</span>
            <span class="s4"># fails on some systems</span>
            <span class="s1">platform_info </span><span class="s2">= </span><span class="s3">&quot; &quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">platform</span><span class="s2">.</span><span class="s1">uname</span><span class="s2">()).</span><span class="s1">strip</span><span class="s2">()</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">f&quot;failing on </span><span class="s0">{</span><span class="s1">platform_info</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">url_table</span><span class="s2">, </span><span class="s1">local_table</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_from_pathlib_path</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH12655</span>
        <span class="s1">str_path </span><span class="s2">= </span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">str_path</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>

        <span class="s1">path_obj </span><span class="s2">= </span><span class="s1">Path</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">path_obj</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">actual</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_no</span><span class="s2">(</span><span class="s3">&quot;py.path&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_read_from_py_localpath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH12655</span>
        <span class="s0">from </span><span class="s1">py</span><span class="s2">.</span><span class="s1">path </span><span class="s0">import </span><span class="s1">local </span><span class="s0">as </span><span class="s1">LocalPath</span>

        <span class="s1">str_path </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">str_path</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>

        <span class="s1">path_obj </span><span class="s2">= </span><span class="s1">LocalPath</span><span class="s2">().</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">path_obj</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">actual</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_close_from_py_localpath</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH31467</span>
        <span class="s1">str_path </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">str_path</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
            <span class="s0">del </span><span class="s1">x</span>
            <span class="s4"># should not throw an exception because the passed file was closed</span>
            <span class="s1">f</span><span class="s2">.</span><span class="s1">read</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_reader_seconds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s4"># GH 55045</span>
        <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;calamine&quot; </span><span class="s0">and </span><span class="s1">read_ext </span><span class="s2">== </span><span class="s3">&quot;.ods&quot;</span><span class="s2">:</span>
            <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
                <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span>
                    <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;ODS file contains bad datetime (seconds as text)&quot;</span>
                <span class="s2">)</span>
            <span class="s2">)</span>

        <span class="s4"># Test reading times with and without milliseconds. GH5945.</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">.</span><span class="s1">from_dict</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s3">&quot;Time&quot;</span><span class="s2">: [</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">45</span><span class="s2">, </span><span class="s6">56</span><span class="s2">, </span><span class="s6">100000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">29</span><span class="s2">, </span><span class="s6">49</span><span class="s2">, </span><span class="s6">200000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">6</span><span class="s2">, </span><span class="s6">13</span><span class="s2">, </span><span class="s6">42</span><span class="s2">, </span><span class="s6">300000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">7</span><span class="s2">, </span><span class="s6">57</span><span class="s2">, </span><span class="s6">35</span><span class="s2">, </span><span class="s6">400000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">9</span><span class="s2">, </span><span class="s6">41</span><span class="s2">, </span><span class="s6">28</span><span class="s2">, </span><span class="s6">500000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">11</span><span class="s2">, </span><span class="s6">25</span><span class="s2">, </span><span class="s6">21</span><span class="s2">, </span><span class="s6">600000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">13</span><span class="s2">, </span><span class="s6">9</span><span class="s2">, </span><span class="s6">14</span><span class="s2">, </span><span class="s6">700000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">14</span><span class="s2">, </span><span class="s6">53</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, </span><span class="s6">800000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">16</span><span class="s2">, </span><span class="s6">37</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">900000</span><span class="s2">),</span>
                    <span class="s1">time</span><span class="s2">(</span><span class="s6">18</span><span class="s2">, </span><span class="s6">20</span><span class="s2">, </span><span class="s6">54</span><span class="s2">),</span>
                <span class="s2">]</span>
            <span class="s2">}</span>
        <span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;times_1900&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;times_1904&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_multiindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># see gh-4679</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">unit </span><span class="s2">= </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s2">], [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">]])</span>
        <span class="s1">mi_file </span><span class="s2">= </span><span class="s3">&quot;testmultiindex&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>

        <span class="s4"># &quot;mi_column&quot; sheet</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-01&quot;</span><span class="s2">), </span><span class="s0">True</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-02&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-03&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">4</span><span class="s2">, </span><span class="s6">5.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-04&quot;</span><span class="s2">), </span><span class="s0">True</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">columns</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">[</span><span class="s1">mi</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s1">mi</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]].</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">f&quot;M8[</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">mi_file</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;mi_column&quot;</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># &quot;mi_index&quot; sheet</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">mi</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">]</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">mi_file</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;mi_index&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># &quot;both&quot; sheet</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">mi</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">mi_file</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;both&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># &quot;mi_index_name&quot; sheet</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">]</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">mi</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">([</span><span class="s3">&quot;ilvl1&quot;</span><span class="s2">, </span><span class="s3">&quot;ilvl2&quot;</span><span class="s2">])</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">mi_file</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;mi_index_name&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># &quot;mi_column_name&quot; sheet</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s6">4</span><span class="s2">))</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">mi</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">([</span><span class="s3">&quot;c1&quot;</span><span class="s2">, </span><span class="s3">&quot;c2&quot;</span><span class="s2">])</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">mi_file</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;mi_column_name&quot;</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># see gh-11317</span>
        <span class="s4"># &quot;name_with_int&quot; sheet</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">mi</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s6">1</span><span class="s2">).</span><span class="s1">set_names</span><span class="s2">([</span><span class="s3">&quot;c1&quot;</span><span class="s2">, </span><span class="s3">&quot;c2&quot;</span><span class="s2">])</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">mi_file</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;name_with_int&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># &quot;both_name&quot; sheet</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">mi</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">([</span><span class="s3">&quot;c1&quot;</span><span class="s2">, </span><span class="s3">&quot;c2&quot;</span><span class="s2">])</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">mi</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">([</span><span class="s3">&quot;ilvl1&quot;</span><span class="s2">, </span><span class="s3">&quot;ilvl2&quot;</span><span class="s2">])</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">mi_file</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;both_name&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># &quot;both_skiprows&quot; sheet</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">mi_file</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;both_name_skiprows&quot;</span><span class="s2">,</span>
            <span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">],</span>
            <span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">],</span>
            <span class="s1">skiprows</span><span class="s2">=</span><span class="s6">2</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;sheet_name,idx_lvl2&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">&quot;both_name_blank_after_mi_name&quot;</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">]),</span>
            <span class="s2">(</span><span class="s3">&quot;both_name_multiple_blanks&quot;</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">] * </span><span class="s6">4</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_read_excel_multiindex_blank_after_name</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">, </span><span class="s1">idx_lvl2</span>
    <span class="s2">):</span>
        <span class="s4"># GH34673</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">mi_file </span><span class="s2">= </span><span class="s3">&quot;testmultiindex&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s2">], [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;c1&quot;</span><span class="s2">, </span><span class="s3">&quot;c2&quot;</span><span class="s2">])</span>

        <span class="s1">unit </span><span class="s2">= </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-01&quot;</span><span class="s2">), </span><span class="s0">True</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-02&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-03&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">4</span><span class="s2">, </span><span class="s6">5.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-04&quot;</span><span class="s2">), </span><span class="s0">True</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">columns</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">,</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">(</span>
                <span class="s2">([</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s2">], </span><span class="s1">idx_lvl2</span><span class="s2">),</span>
                <span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;ilvl1&quot;</span><span class="s2">, </span><span class="s3">&quot;ilvl2&quot;</span><span class="s2">],</span>
            <span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">[</span><span class="s1">mi</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s1">mi</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]].</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">f&quot;M8[</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">mi_file</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">,</span>
            <span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">],</span>
            <span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_multiindex_header_only</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># see gh-11733.</span>
        <span class="s4">#</span>
        <span class="s4"># Don't try to parse a header name if there isn't one.</span>
        <span class="s1">mi_file </span><span class="s2">= </span><span class="s3">&quot;testmultiindex&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">mi_file</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;index_col_none&quot;</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>

        <span class="s1">exp_columns </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">), (</span><span class="s3">&quot;key&quot;</span><span class="s2">, </span><span class="s3">&quot;val&quot;</span><span class="s2">)])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">]] * </span><span class="s6">2</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">exp_columns</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_excel_old_index_format</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># see gh-4679</span>
        <span class="s1">filename </span><span class="s2">= </span><span class="s3">&quot;test_index_name_pre17&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>

        <span class="s4"># We detect headers to determine if index names exist, so</span>
        <span class="s4"># that &quot;index&quot; name in the &quot;names&quot; version of the data will</span>
        <span class="s4"># now be interpreted as rows that include null data.</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R0C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R0C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R0C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R0C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R0C4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R1C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R1C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R1C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R1C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R1C4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R2C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R2C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R2C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R2C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R2C4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R3C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R3C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R3C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R3C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R3C4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R4C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R4C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R4C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R4C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R4C4&quot;</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">columns </span><span class="s2">= [</span><span class="s3">&quot;C_l0_g0&quot;</span><span class="s2">, </span><span class="s3">&quot;C_l0_g1&quot;</span><span class="s2">, </span><span class="s3">&quot;C_l0_g2&quot;</span><span class="s2">, </span><span class="s3">&quot;C_l0_g3&quot;</span><span class="s2">, </span><span class="s3">&quot;C_l0_g4&quot;</span><span class="s2">]</span>
        <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">(</span>
            <span class="s1">levels</span><span class="s2">=[</span>
                <span class="s2">[</span><span class="s3">&quot;R0&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g0&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g1&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g2&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g3&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R1&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g0&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g1&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g2&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g3&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g4&quot;</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">codes</span><span class="s2">=[[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">], [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">]],</span>
            <span class="s1">names</span><span class="s2">=[</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">si </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s3">&quot;R0&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g0&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g1&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g2&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g3&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g4&quot;</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s0">None</span>
        <span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">si</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">columns</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;single_names&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">mi</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;multi_names&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># The analogous versions of the &quot;names&quot; version data</span>
        <span class="s4"># where there are explicitly no names for the indices.</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">[</span><span class="s3">&quot;R0C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R0C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R0C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R0C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R0C4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R1C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R1C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R1C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R1C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R1C4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R2C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R2C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R2C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R2C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R2C4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R3C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R3C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R3C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R3C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R3C4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R4C0&quot;</span><span class="s2">, </span><span class="s3">&quot;R4C1&quot;</span><span class="s2">, </span><span class="s3">&quot;R4C2&quot;</span><span class="s2">, </span><span class="s3">&quot;R4C3&quot;</span><span class="s2">, </span><span class="s3">&quot;R4C4&quot;</span><span class="s2">],</span>
            <span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">columns </span><span class="s2">= [</span><span class="s3">&quot;C_l0_g0&quot;</span><span class="s2">, </span><span class="s3">&quot;C_l0_g1&quot;</span><span class="s2">, </span><span class="s3">&quot;C_l0_g2&quot;</span><span class="s2">, </span><span class="s3">&quot;C_l0_g3&quot;</span><span class="s2">, </span><span class="s3">&quot;C_l0_g4&quot;</span><span class="s2">]</span>
        <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">(</span>
            <span class="s1">levels</span><span class="s2">=[</span>
                <span class="s2">[</span><span class="s3">&quot;R_l0_g0&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g1&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g2&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g3&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g4&quot;</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s3">&quot;R_l1_g0&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g1&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g2&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g3&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l1_g4&quot;</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">codes</span><span class="s2">=[[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">], [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">]],</span>
            <span class="s1">names</span><span class="s2">=[</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">si </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s3">&quot;R_l0_g0&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g1&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g2&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g3&quot;</span><span class="s2">, </span><span class="s3">&quot;R_l0_g4&quot;</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">si</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">columns</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;single_no_names&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">mi</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;multi_no_names&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_bool_header_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 6114</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Passing a bool to header is invalid&quot;</span>
        <span class="s0">for </span><span class="s1">arg </span><span class="s0">in </span><span class="s2">[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=</span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_skiprows</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 4903</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">unit </span><span class="s2">= </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;testskiprows&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;skiprows_list&quot;</span><span class="s2">, </span><span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-01&quot;</span><span class="s2">), </span><span class="s0">True</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-02&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-03&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">4</span><span class="s2">, </span><span class="s6">5.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-04&quot;</span><span class="s2">), </span><span class="s0">True</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;c&quot;</span><span class="s2">] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;c&quot;</span><span class="s2">].</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">f&quot;M8[</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;testskiprows&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;skiprows_list&quot;</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">]),</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># GH36435</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;testskiprows&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;skiprows_list&quot;</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;testskiprows&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;skiprows_list&quot;</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=</span><span class="s6">3</span><span class="s2">,</span>
            <span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4"># [1, 2.5, pd.Timestamp(&quot;2015-01-01&quot;), True],</span>
                <span class="s2">[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-02&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-03&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">4</span><span class="s2">, </span><span class="s6">5.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-04&quot;</span><span class="s2">), </span><span class="s0">True</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;c&quot;</span><span class="s2">] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;c&quot;</span><span class="s2">].</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">f&quot;M8[</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_skiprows_callable_not_in</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 4903</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>
        <span class="s1">unit </span><span class="s2">= </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s3">&quot;testskiprows&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;skiprows_list&quot;</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x </span><span class="s0">not in </span><span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">5</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-01&quot;</span><span class="s2">), </span><span class="s0">True</span><span class="s2">],</span>
                <span class="s4"># [2, 3.5, pd.Timestamp(&quot;2015-01-02&quot;), False],</span>
                <span class="s2">[</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4.5</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2015-01-03&quot;</span><span class="s2">), </span><span class="s0">False</span><span class="s2">],</span>
                <span class="s4"># [4, 5.5, pd.Timestamp(&quot;2015-01-04&quot;), True],</span>
            <span class="s2">],</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;c&quot;</span><span class="s2">] = </span><span class="s1">expected</span><span class="s2">[</span><span class="s3">&quot;c&quot;</span><span class="s2">].</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">f&quot;M8[</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_nrows</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 16645</span>
        <span class="s1">num_rows_to_pull </span><span class="s2">= </span><span class="s6">5</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">nrows</span><span class="s2">=</span><span class="s1">num_rows_to_pull</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">[:</span><span class="s1">num_rows_to_pull</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_nrows_greater_than_nrows_in_file</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 16645</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">)</span>
        <span class="s1">num_records_in_file </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">num_rows_to_pull </span><span class="s2">= </span><span class="s1">num_records_in_file </span><span class="s2">+ </span><span class="s6">10</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">nrows</span><span class="s2">=</span><span class="s1">num_rows_to_pull</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_nrows_non_integer_parameter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 16645</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;'nrows' must be an integer &gt;=0&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">nrows</span><span class="s2">=</span><span class="s3">&quot;5&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;filename,sheet_name,header,index_col,skiprows&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">&quot;testmultiindex&quot;</span><span class="s2">, </span><span class="s3">&quot;mi_column&quot;</span><span class="s2">, [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s6">0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;testmultiindex&quot;</span><span class="s2">, </span><span class="s3">&quot;mi_index&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;testmultiindex&quot;</span><span class="s2">, </span><span class="s3">&quot;both&quot;</span><span class="s2">, [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;testmultiindex&quot;</span><span class="s2">, </span><span class="s3">&quot;mi_column_name&quot;</span><span class="s2">, [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s6">0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;testskiprows&quot;</span><span class="s2">, </span><span class="s3">&quot;skiprows_list&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">]),</span>
            <span class="s2">(</span><span class="s3">&quot;testskiprows&quot;</span><span class="s2">, </span><span class="s3">&quot;skiprows_list&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x </span><span class="s0">in </span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_read_excel_nrows_params</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">, </span><span class="s1">header</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">, </span><span class="s1">skiprows</span>
    <span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        For various parameters, we should get the same result whether we 
        limit the rows during load (nrows=3) or after (df.iloc[:3]). 
        &quot;&quot;&quot;</span>
        <span class="s4"># GH 46894</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">filename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">,</span>
            <span class="s1">header</span><span class="s2">=</span><span class="s1">header</span><span class="s2">,</span>
            <span class="s1">index_col</span><span class="s2">=</span><span class="s1">index_col</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=</span><span class="s1">skiprows</span><span class="s2">,</span>
        <span class="s2">).</span><span class="s1">iloc</span><span class="s2">[:</span><span class="s6">3</span><span class="s2">]</span>
        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">filename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">,</span>
            <span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">,</span>
            <span class="s1">header</span><span class="s2">=</span><span class="s1">header</span><span class="s2">,</span>
            <span class="s1">index_col</span><span class="s2">=</span><span class="s1">index_col</span><span class="s2">,</span>
            <span class="s1">skiprows</span><span class="s2">=</span><span class="s1">skiprows</span><span class="s2">,</span>
            <span class="s1">nrows</span><span class="s2">=</span><span class="s6">3</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_deprecated_kwargs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;but 3 positional arguments&quot;</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_no_header_with_list_index_col</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 31783</span>
        <span class="s1">file_name </span><span class="s2">= </span><span class="s3">&quot;testmultiindex&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">data </span><span class="s2">= [(</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">), (</span><span class="s3">&quot;key&quot;</span><span class="s2">, </span><span class="s3">&quot;val&quot;</span><span class="s2">), (</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">), (</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">)]</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">(</span>
            <span class="s2">[(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;A&quot;</span><span class="s2">), (</span><span class="s3">&quot;key&quot;</span><span class="s2">, </span><span class="s3">&quot;val&quot;</span><span class="s2">), (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">), (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">))</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">file_name</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;index_col_none&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s1">header</span><span class="s2">=</span><span class="s0">None</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">result</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_one_col_noskip_blank_line</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 39808</span>
        <span class="s1">file_name </span><span class="s2">= </span><span class="s3">&quot;one_col_blank_line&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">data </span><span class="s2">= [</span><span class="s6">0.5</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;numbers&quot;</span><span class="s2">])</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">file_name</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_multiheader_two_blank_lines</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 40442</span>
        <span class="s1">file_name </span><span class="s2">= </span><span class="s3">&quot;testmultiindex&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">columns </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;A&quot;</span><span class="s2">), (</span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">)])</span>
        <span class="s1">data </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">4</span><span class="s2">]]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">columns</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">file_name</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;mi_column_empty_rows&quot;</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_trailing_blanks</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Sheets can contain blank cells with no data. Some of our readers 
        were including those cells, creating many empty rows and columns 
        &quot;&quot;&quot;</span>
        <span class="s1">file_name </span><span class="s2">= </span><span class="s3">&quot;trailing_blanks&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">file_name</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s6">3</span><span class="s2">, </span><span class="s6">3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ignore_chartsheets_by_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 41448</span>
        <span class="s0">if </span><span class="s1">read_ext </span><span class="s2">== </span><span class="s3">&quot;.ods&quot;</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">&quot;chartsheets do not exist in the ODF format&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">:</span>
            <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
                <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span>
                    <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;pyxlsb can't distinguish chartsheets from worksheets&quot;</span>
                <span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Worksheet named 'Chart1' not found&quot;</span><span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;chartsheet&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Chart1&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ignore_chartsheets_by_int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 41448</span>
        <span class="s0">if </span><span class="s1">read_ext </span><span class="s2">== </span><span class="s3">&quot;.ods&quot;</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">&quot;chartsheets do not exist in the ODF format&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">:</span>
            <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
                <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span>
                    <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;pyxlsb can't distinguish chartsheets from worksheets&quot;</span>
                <span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Worksheet index 1 is invalid, 1 worksheets found&quot;</span>
        <span class="s2">):</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;chartsheet&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_euro_decimal_format</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># copied from read_csv</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test_decimal&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s3">&quot;,&quot;</span><span class="s2">, </span><span class="s1">skiprows</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1521.1541</span><span class="s2">, </span><span class="s6">187101.9543</span><span class="s2">, </span><span class="s3">&quot;ABC&quot;</span><span class="s2">, </span><span class="s3">&quot;poi&quot;</span><span class="s2">, </span><span class="s6">4.738797819</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">121.12</span><span class="s2">, </span><span class="s6">14897.76</span><span class="s2">, </span><span class="s3">&quot;DEF&quot;</span><span class="s2">, </span><span class="s3">&quot;uyt&quot;</span><span class="s2">, </span><span class="s6">0.377320872</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s6">3</span><span class="s2">, </span><span class="s6">878.158</span><span class="s2">, </span><span class="s6">108013.434</span><span class="s2">, </span><span class="s3">&quot;GHI&quot;</span><span class="s2">, </span><span class="s3">&quot;rez&quot;</span><span class="s2">, </span><span class="s6">2.735694704</span><span class="s2">],</span>
            <span class="s2">],</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Id&quot;</span><span class="s2">, </span><span class="s3">&quot;Number1&quot;</span><span class="s2">, </span><span class="s3">&quot;Number2&quot;</span><span class="s2">, </span><span class="s3">&quot;Text1&quot;</span><span class="s2">, </span><span class="s3">&quot;Text2&quot;</span><span class="s2">, </span><span class="s3">&quot;Number3&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestExcelFileRead</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_deprecate_bytes_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 53830</span>
        <span class="s1">msg </span><span class="s2">= (</span>
            <span class="s3">&quot;Passing bytes to 'read_excel' is deprecated and &quot;</span>
            <span class="s3">&quot;will be removed in a future version. To read from a &quot;</span>
            <span class="s3">&quot;byte string, wrap it in a `BytesIO` object.&quot;</span>
        <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span>
            <span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">, </span><span class="s1">raise_on_extra_warnings</span><span class="s2">=</span><span class="s0">False</span>
        <span class="s2">):</span>
            <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
                <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">f</span><span class="s2">.</span><span class="s1">read</span><span class="s2">(), </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">autouse</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">cd_and_set_engine</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">datapath</span><span class="s2">, </span><span class="s1">monkeypatch</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot; 
        Change directory and set engine for ExcelFile objects. 
        &quot;&quot;&quot;</span>
        <span class="s1">func </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>
        <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">chdir</span><span class="s2">(</span><span class="s1">datapath</span><span class="s2">(</span><span class="s3">&quot;io&quot;</span><span class="s2">, </span><span class="s3">&quot;data&quot;</span><span class="s2">, </span><span class="s3">&quot;excel&quot;</span><span class="s2">))</span>
        <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">, </span><span class="s3">&quot;ExcelFile&quot;</span><span class="s2">, </span><span class="s1">func</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_engine_used</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">):</span>
        <span class="s1">expected_defaults </span><span class="s2">= {</span>
            <span class="s3">&quot;xlsx&quot;</span><span class="s2">: </span><span class="s3">&quot;openpyxl&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;xlsm&quot;</span><span class="s2">: </span><span class="s3">&quot;openpyxl&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;xlsb&quot;</span><span class="s2">: </span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;xls&quot;</span><span class="s2">: </span><span class="s3">&quot;xlrd&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;ods&quot;</span><span class="s2">: </span><span class="s3">&quot;odf&quot;</span><span class="s2">,</span>
        <span class="s2">}</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">excel</span><span class="s2">.</span><span class="s1">engine</span>

        <span class="s0">if </span><span class="s1">engine </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">engine</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected_defaults</span><span class="s2">[</span><span class="s1">read_ext</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]]</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_excel_passes_na</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test4&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">parsed </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s1">excel</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">keep_default_na</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">na_values</span><span class="s2">=[</span><span class="s3">&quot;apple&quot;</span><span class="s2">]</span>
            <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s3">&quot;NA&quot;</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">], [</span><span class="s3">&quot;NA&quot;</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s3">&quot;rabbit&quot;</span><span class="s2">]], </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Test&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">parsed</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test4&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">parsed </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s1">excel</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">keep_default_na</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">na_values</span><span class="s2">=[</span><span class="s3">&quot;apple&quot;</span><span class="s2">]</span>
            <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s3">&quot;rabbit&quot;</span><span class="s2">]], </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Test&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">parsed</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s4"># 13967</span>
        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test5&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">parsed </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s1">excel</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">keep_default_na</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">na_values</span><span class="s2">=[</span><span class="s3">&quot;apple&quot;</span><span class="s2">]</span>
            <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s3">&quot;1.#QNAN&quot;</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">], [</span><span class="s3">&quot;nan&quot;</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s3">&quot;rabbit&quot;</span><span class="s2">]], </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Test&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">parsed</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test5&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">parsed </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s1">excel</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">keep_default_na</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">na_values</span><span class="s2">=[</span><span class="s3">&quot;apple&quot;</span><span class="s2">]</span>
            <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s3">&quot;rabbit&quot;</span><span class="s2">]], </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Test&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">parsed</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;na_filter&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_excel_passes_na_filter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">na_filter</span><span class="s2">):</span>
        <span class="s4"># gh-25453</span>
        <span class="s1">kwargs </span><span class="s2">= {}</span>

        <span class="s0">if </span><span class="s1">na_filter </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">kwargs</span><span class="s2">[</span><span class="s3">&quot;na_filter&quot;</span><span class="s2">] = </span><span class="s1">na_filter</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test5&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">parsed </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
                <span class="s1">excel</span><span class="s2">,</span>
                <span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">,</span>
                <span class="s1">keep_default_na</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                <span class="s1">na_values</span><span class="s2">=[</span><span class="s3">&quot;apple&quot;</span><span class="s2">],</span>
                <span class="s2">**</span><span class="s1">kwargs</span><span class="s2">,</span>
            <span class="s2">)</span>

        <span class="s0">if </span><span class="s1">na_filter </span><span class="s0">is False</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= [[</span><span class="s3">&quot;1.#QNAN&quot;</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">], [</span><span class="s3">&quot;nan&quot;</span><span class="s2">], [</span><span class="s3">&quot;apple&quot;</span><span class="s2">], [</span><span class="s3">&quot;rabbit&quot;</span><span class="s2">]]</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= [[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s3">&quot;rabbit&quot;</span><span class="s2">]]</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;Test&quot;</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">parsed</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_excel_table_sheet_by_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">df1 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">excel</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">df2 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">excel</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s6">1</span><span class="s2">, </span><span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df1</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">df1 </span><span class="s2">= </span><span class="s1">excel</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
            <span class="s1">df2 </span><span class="s2">= </span><span class="s1">excel</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s1">skiprows</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df1</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">df3 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">excel</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">skipfooter</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df3</span><span class="s2">, </span><span class="s1">df1</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">])</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">df3 </span><span class="s2">= </span><span class="s1">excel</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">skipfooter</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df3</span><span class="s2">, </span><span class="s1">df1</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_sheet_name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">df_ref</span><span class="s2">):</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df_ref</span>
        <span class="s1">adjust_expected</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">filename </span><span class="s2">= </span><span class="s3">&quot;test1&quot;</span>
        <span class="s1">sheet_name </span><span class="s2">= </span><span class="s3">&quot;Sheet1&quot;</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s1">filename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">df1_parse </span><span class="s2">= </span><span class="s1">excel</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)  </span><span class="s4"># doc</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s1">filename </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">df2_parse </span><span class="s2">= </span><span class="s1">excel</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df1_parse</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df2_parse</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;sheet_name&quot;</span><span class="s2">,</span>
        <span class="s2">[</span><span class="s6">3</span><span class="s2">, [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], </span><span class="s3">&quot;Sheet4&quot;</span><span class="s2">, [</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s3">&quot;Sheet4&quot;</span><span class="s2">], [</span><span class="s3">&quot;Sheet4&quot;</span><span class="s2">, </span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">]],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_bad_sheetname_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">):</span>
        <span class="s4"># GH 39250</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Worksheet index 3 is invalid|Worksheet named 'Sheet4' not found&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;blank&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
                <span class="s1">excel</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s1">sheet_name</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_excel_read_buffer</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s1">pth </span><span class="s2">= </span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">pth</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">pth</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s1">f</span><span class="s2">) </span><span class="s0">as </span><span class="s1">xls</span><span class="s2">:</span>
                <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">xls</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">actual</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_reader_closes_file</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s1">f</span><span class="s2">) </span><span class="s0">as </span><span class="s1">xlsx</span><span class="s2">:</span>
                <span class="s4"># parses okay</span>
                <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">xlsx</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">closed</span>

    <span class="s0">def </span><span class="s1">test_conflicting_excel_engines</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 26566</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Engine should not be specified when passing an ExcelFile&quot;</span>

        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">xl</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">xl</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s3">&quot;foo&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_excel_read_binary</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 15914</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">data </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">read</span><span class="s2">()</span>

        <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">actual</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_excel_read_binary_via_read_excel</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">):</span>
        <span class="s4"># GH 38424</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s3">&quot;test1&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_excel_header_index_out_of_range</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">):</span>
        <span class="s4"># GH#43143</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;df_header_oob.xlsx&quot;</span><span class="s2">, </span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;exceeds maximum&quot;</span><span class="s2">):</span>
                <span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;filename&quot;</span><span class="s2">, [</span><span class="s3">&quot;df_empty.xlsx&quot;</span><span class="s2">, </span><span class="s3">&quot;df_equals.xlsx&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_header_with_index_col</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">filename</span><span class="s2">):</span>
        <span class="s4"># GH 33476</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s3">&quot;Z&quot;</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;I2&quot;</span><span class="s2">)</span>
        <span class="s1">cols </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">), (</span><span class="s3">&quot;A&quot;</span><span class="s2">, </span><span class="s3">&quot;B.1&quot;</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;I11&quot;</span><span class="s2">, </span><span class="s3">&quot;I12&quot;</span><span class="s2">])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">cols</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;int64&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span>
            <span class="s1">filename</span><span class="s2">, </span><span class="s1">sheet_name</span><span class="s2">=</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">, </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">result</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_read_datetime_multiindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 34748</span>
        <span class="s1">xfail_datetimes_with_pyxlsb</span><span class="s2">(</span><span class="s1">engine</span><span class="s2">, </span><span class="s1">request</span><span class="s2">)</span>

        <span class="s1">f </span><span class="s2">= </span><span class="s3">&quot;test_datetime_mi&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span>
        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s1">f</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s1">actual </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">read_excel</span><span class="s2">(</span><span class="s1">excel</span><span class="s2">, </span><span class="s1">header</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], </span><span class="s1">index_col</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>

        <span class="s1">unit </span><span class="s2">= </span><span class="s1">get_exp_unit</span><span class="s2">(</span><span class="s1">read_ext</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">)</span>
        <span class="s1">dti </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s3">&quot;2020-02-29&quot;</span><span class="s2">, </span><span class="s3">&quot;2020-03-01&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">f&quot;M8[</span><span class="s0">{</span><span class="s1">unit</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s2">)</span>
        <span class="s1">expected_column_index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">dti</span><span class="s2">[:</span><span class="s6">1</span><span class="s2">], </span><span class="s1">dti</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]],</span>
            <span class="s1">names</span><span class="s2">=[</span>
                <span class="s1">dti</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">to_pydatetime</span><span class="s2">(),</span>
                <span class="s1">dti</span><span class="s2">[</span><span class="s6">1</span><span class="s2">].</span><span class="s1">to_pydatetime</span><span class="s2">(),</span>
            <span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([], </span><span class="s1">index</span><span class="s2">=[], </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">expected_column_index</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">actual</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_engine_invalid_option</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># read_ext includes the '.' hence the weird formatting</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Value must be one of *&quot;</span><span class="s2">):</span>
            <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">f&quot;io.excel</span><span class="s0">{</span><span class="s1">read_ext</span><span class="s0">}</span><span class="s3">.reader&quot;</span><span class="s2">, </span><span class="s3">&quot;abc&quot;</span><span class="s2">):</span>
                <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">test_ignore_chartsheets</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH 41448</span>
        <span class="s0">if </span><span class="s1">read_ext </span><span class="s2">== </span><span class="s3">&quot;.ods&quot;</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">&quot;chartsheets do not exist in the ODF format&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;pyxlsb&quot;</span><span class="s2">:</span>
            <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
                <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span>
                    <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;pyxlsb can't distinguish chartsheets from worksheets&quot;</span>
                <span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s3">&quot;chartsheet&quot; </span><span class="s2">+ </span><span class="s1">read_ext</span><span class="s2">) </span><span class="s0">as </span><span class="s1">excel</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">excel</span><span class="s2">.</span><span class="s1">sheet_names </span><span class="s2">== [</span><span class="s3">&quot;Sheet1&quot;</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_corrupt_files_closed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">, </span><span class="s1">read_ext</span><span class="s2">):</span>
        <span class="s4"># GH41778</span>
        <span class="s1">errors </span><span class="s2">= (</span><span class="s1">BadZipFile</span><span class="s2">,)</span>
        <span class="s0">if </span><span class="s1">engine </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">f&quot;Invalid test for engine=</span><span class="s0">{</span><span class="s1">engine</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;xlrd&quot;</span><span class="s2">:</span>
            <span class="s0">import </span><span class="s1">xlrd</span>

            <span class="s1">errors </span><span class="s2">= (</span><span class="s1">BadZipFile</span><span class="s2">, </span><span class="s1">xlrd</span><span class="s2">.</span><span class="s1">biffh</span><span class="s2">.</span><span class="s1">XLRDError</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">engine </span><span class="s2">== </span><span class="s3">&quot;calamine&quot;</span><span class="s2">:</span>
            <span class="s0">from </span><span class="s1">python_calamine </span><span class="s0">import </span><span class="s1">CalamineError</span>

            <span class="s1">errors </span><span class="s2">= (</span><span class="s1">CalamineError</span><span class="s2">,)</span>

        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">ensure_clean</span><span class="s2">(</span><span class="s3">f&quot;corrupt</span><span class="s0">{</span><span class="s1">read_ext</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">file</span><span class="s2">:</span>
            <span class="s1">Path</span><span class="s2">(</span><span class="s1">file</span><span class="s2">).</span><span class="s1">write_text</span><span class="s2">(</span><span class="s3">&quot;corrupt&quot;</span><span class="s2">, </span><span class="s1">encoding</span><span class="s2">=</span><span class="s3">&quot;utf-8&quot;</span><span class="s2">)</span>
            <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s0">False</span><span class="s2">):</span>
                <span class="s0">try</span><span class="s2">:</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">ExcelFile</span><span class="s2">(</span><span class="s1">file</span><span class="s2">, </span><span class="s1">engine</span><span class="s2">=</span><span class="s1">engine</span><span class="s2">)</span>
                <span class="s0">except </span><span class="s1">errors</span><span class="s2">:</span>
                    <span class="s0">pass</span>
</pre>
</body>
</html>