<html>
<head>
<title>test_loc.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #5f826b; font-style: italic;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_loc.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">errors </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">IndexingError</span><span class="s2">,</span>
    <span class="s1">PerformanceWarning</span><span class="s2">,</span>
<span class="s2">)</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DataFrame</span><span class="s2">,</span>
    <span class="s1">Index</span><span class="s2">,</span>
    <span class="s1">MultiIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">single_level_multiindex</span><span class="s2">():</span>
    <span class="s3">&quot;&quot;&quot;single level MultiIndex&quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">MultiIndex</span><span class="s2">(</span>
        <span class="s1">levels</span><span class="s2">=[[</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;baz&quot;</span><span class="s2">, </span><span class="s4">&quot;qux&quot;</span><span class="s2">]], </span><span class="s1">codes</span><span class="s2">=[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;first&quot;</span><span class="s2">]</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">frame_random_data_integer_multi_index</span><span class="s2">():</span>
    <span class="s1">levels </span><span class="s2">= [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]</span>
    <span class="s1">codes </span><span class="s2">= [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">=</span><span class="s1">codes</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">6</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestMultiIndexLoc</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_loc_setitem_frame_with_multiindex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">multiindex_dataframe_random_data</span><span class="s2">):</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">multiindex_dataframe_random_data</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">), </span><span class="s4">&quot;B&quot;</span><span class="s2">] = </span><span class="s5">5</span>
        <span class="s0">assert </span><span class="s1">frame</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">), </span><span class="s4">&quot;B&quot;</span><span class="s2">] == </span><span class="s5">5</span>

        <span class="s6"># with integer labels</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">frame</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">df</span><span class="s2">.</span><span class="s1">columns </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>
        <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">), </span><span class="s5">1</span><span class="s2">] = </span><span class="s5">7</span>
        <span class="s0">assert </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">), </span><span class="s5">1</span><span class="s2">] == </span><span class="s5">7</span>

    <span class="s0">def </span><span class="s1">test_loc_getitem_general</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">any_real_numpy_dtype</span><span class="s2">):</span>
        <span class="s6"># GH#2817</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s1">any_real_numpy_dtype</span>
        <span class="s1">data </span><span class="s2">= {</span>
            <span class="s4">&quot;amount&quot;</span><span class="s2">: {</span><span class="s5">0</span><span class="s2">: </span><span class="s5">700</span><span class="s2">, </span><span class="s5">1</span><span class="s2">: </span><span class="s5">600</span><span class="s2">, </span><span class="s5">2</span><span class="s2">: </span><span class="s5">222</span><span class="s2">, </span><span class="s5">3</span><span class="s2">: </span><span class="s5">333</span><span class="s2">, </span><span class="s5">4</span><span class="s2">: </span><span class="s5">444</span><span class="s2">},</span>
            <span class="s4">&quot;col&quot;</span><span class="s2">: {</span><span class="s5">0</span><span class="s2">: </span><span class="s5">3.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">: </span><span class="s5">3.5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">: </span><span class="s5">4.0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">: </span><span class="s5">4.0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">: </span><span class="s5">4.0</span><span class="s2">},</span>
            <span class="s4">&quot;num&quot;</span><span class="s2">: {</span><span class="s5">0</span><span class="s2">: </span><span class="s5">12</span><span class="s2">, </span><span class="s5">1</span><span class="s2">: </span><span class="s5">11</span><span class="s2">, </span><span class="s5">2</span><span class="s2">: </span><span class="s5">12</span><span class="s2">, </span><span class="s5">3</span><span class="s2">: </span><span class="s5">12</span><span class="s2">, </span><span class="s5">4</span><span class="s2">: </span><span class="s5">12</span><span class="s2">},</span>
        <span class="s2">}</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">({</span><span class="s4">&quot;col&quot;</span><span class="s2">: </span><span class="s1">dtype</span><span class="s2">, </span><span class="s4">&quot;num&quot;</span><span class="s2">: </span><span class="s1">dtype</span><span class="s2">})</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">set_index</span><span class="s2">(</span><span class="s1">keys</span><span class="s2">=[</span><span class="s4">&quot;col&quot;</span><span class="s2">, </span><span class="s4">&quot;num&quot;</span><span class="s2">])</span>
        <span class="s1">key </span><span class="s2">= </span><span class="s5">4.0</span><span class="s2">, </span><span class="s5">12</span>

        <span class="s6"># emits a PerformanceWarning, ok</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">PerformanceWarning</span><span class="s2">):</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s5">2</span><span class="s2">:])</span>

        <span class="s6"># this is ok</span>
        <span class="s1">return_value </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">sort_index</span><span class="s2">(</span><span class="s1">inplace</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">return_value </span><span class="s0">is None</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>

        <span class="s6"># col has float dtype, result should be float64 Index</span>
        <span class="s1">col_arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">4.0</span><span class="s2">] * </span><span class="s5">3</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">year_arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">12</span><span class="s2">] * </span><span class="s5">3</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">col_arr</span><span class="s2">, </span><span class="s1">year_arr</span><span class="s2">], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;col&quot;</span><span class="s2">, </span><span class="s4">&quot;num&quot;</span><span class="s2">])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">&quot;amount&quot;</span><span class="s2">: [</span><span class="s5">222</span><span class="s2">, </span><span class="s5">333</span><span class="s2">, </span><span class="s5">444</span><span class="s2">]}, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_getitem_multiindex_missing_label_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH#21593</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)),</span>
            <span class="s1">columns</span><span class="s2">=[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">6</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]],</span>
            <span class="s1">index</span><span class="s2">=[[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">], [</span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">12</span><span class="s2">]],</span>
        <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;^2$&quot;</span><span class="s2">):</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">2</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_loc_getitem_list_of_tuples_with_multiindex</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">multiindex_year_month_day_dataframe_random_data</span>
    <span class="s2">):</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">multiindex_year_month_day_dataframe_random_data</span><span class="s2">[</span><span class="s4">&quot;A&quot;</span><span class="s2">]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s5">49</span><span class="s2">:</span><span class="s5">51</span><span class="s2">])</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[[(</span><span class="s5">2000</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">10</span><span class="s2">), (</span><span class="s5">2000</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">13</span><span class="s2">)]]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_getitem_series</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH14730</span>
        <span class="s6"># passing a series as a key with a MultiIndex</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">]])</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">9</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">data</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">],</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">]]),</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">y</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s6"># GH15424</span>
        <span class="s1">y1 </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">y1</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">empty </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=[], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s2">[],</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">=</span><span class="s1">index</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">=[[], []], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">),</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">empty</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_getitem_array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH15434</span>
        <span class="s6"># passing an array as a key with a MultiIndex</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">]])</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">9</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">data</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">],</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">]]),</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">y</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s6"># empty array:</span>
        <span class="s1">empty </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s2">[],</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">=</span><span class="s1">index</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">=[[], []], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">),</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;float64&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">empty</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s6"># 0-dim array (scalar):</span>
        <span class="s1">scalar </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">scalar</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_multiindex_labels</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)),</span>
            <span class="s1">columns</span><span class="s2">=[[</span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;j&quot;</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">]],</span>
            <span class="s1">index</span><span class="s2">=[[</span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;j&quot;</span><span class="s2">], [</span><span class="s4">&quot;X&quot;</span><span class="s2">, </span><span class="s4">&quot;X&quot;</span><span class="s2">, </span><span class="s4">&quot;Y&quot;</span><span class="s2">]],</span>
        <span class="s2">)</span>

        <span class="s6"># the first 2 rows</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]].</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;i&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s6"># 2nd (last) column</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[:, [</span><span class="s5">2</span><span class="s2">]].</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:, </span><span class="s4">&quot;j&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s6"># bottom right corner</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[[</span><span class="s5">2</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">]].</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s5">0</span><span class="s2">).</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;j&quot;</span><span class="s2">].</span><span class="s1">loc</span><span class="s2">[:, </span><span class="s4">&quot;j&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s6"># with a tuple</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;X&quot;</span><span class="s2">)]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_multiindex_ints</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)),</span>
            <span class="s1">columns</span><span class="s2">=[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">6</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]],</span>
            <span class="s1">index</span><span class="s2">=[[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">], [</span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">12</span><span class="s2">]],</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]].</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">4</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_multiindex_missing_label_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)),</span>
            <span class="s1">columns</span><span class="s2">=[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">6</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]],</span>
            <span class="s1">index</span><span class="s2">=[[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">], [</span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">12</span><span class="s2">]],</span>
        <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;^2$&quot;</span><span class="s2">):</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">2</span><span class="s2">]</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;key, pos&quot;</span><span class="s2">, [([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]), ([</span><span class="s5">2</span><span class="s2">], []), ([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [])])</span>
    <span class="s0">def </span><span class="s1">test_loc_multiindex_list_missing_label</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">):</span>
        <span class="s6"># GH 27148 - lists with missing labels _do_ raise</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)),</span>
            <span class="s1">columns</span><span class="s2">=[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">6</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]],</span>
            <span class="s1">index</span><span class="s2">=[[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">], [</span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">12</span><span class="s2">]],</span>
        <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;not in index&quot;</span><span class="s2">):</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_loc_multiindex_too_many_dims_raises</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH 14885</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">range</span><span class="s2">(</span><span class="s5">8</span><span class="s2">),</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">], [</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">], [</span><span class="s4">&quot;e&quot;</span><span class="s2">, </span><span class="s4">&quot;f&quot;</span><span class="s2">]]),</span>
        <span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;^\('a', 'b'\)$&quot;</span><span class="s2">):</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;^\('a', 'd', 'g'\)$&quot;</span><span class="s2">):</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s4">&quot;g&quot;</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexingError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Too many indexers&quot;</span><span class="s2">):</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s4">&quot;g&quot;</span><span class="s2">, </span><span class="s4">&quot;j&quot;</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_loc_multiindex_indexer_none</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH6788</span>
        <span class="s6"># multi-index indexer is None (meaning take all)</span>
        <span class="s1">attributes </span><span class="s2">= [</span><span class="s4">&quot;Attribute&quot; </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)]</span>
        <span class="s1">attribute_values </span><span class="s2">= [</span><span class="s4">&quot;Value&quot; </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)]</span>

        <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([</span><span class="s1">attributes</span><span class="s2">, </span><span class="s1">attribute_values</span><span class="s2">])</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s5">0.1 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">10</span><span class="s2">, </span><span class="s5">1 </span><span class="s2">* </span><span class="s5">5</span><span class="s2">)) + </span><span class="s5">0.5</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s1">attributes</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">df</span><span class="s2">)</span>

        <span class="s6"># GH 7349</span>
        <span class="s6"># loc with a multi-index seems to be doing fallback</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">12</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">),</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]),</span>
        <span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">],), :]</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_multiindex_incomplete</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH 7399</span>
        <span class="s6"># incomplete indexers</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">15</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int64&quot;</span><span class="s2">),</span>
            <span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([</span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">]]),</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:, </span><span class="s4">&quot;a&quot;</span><span class="s2">:</span><span class="s4">&quot;c&quot;</span><span class="s2">]</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">:</span><span class="s5">4</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">:</span><span class="s4">&quot;c&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:</span><span class="s5">4</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">:</span><span class="s4">&quot;c&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">:, </span><span class="s4">&quot;a&quot;</span><span class="s2">:</span><span class="s4">&quot;c&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s6"># GH 7400</span>
        <span class="s6"># multiindexer getitem with list of indexers skips wrong element</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">15</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int64&quot;</span><span class="s2">),</span>
            <span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([</span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">]]),</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[[</span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">]]</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">2</span><span class="s2">:</span><span class="s5">4</span><span class="s2">:</span><span class="s5">2</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">:</span><span class="s4">&quot;c&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_get_loc_single_level</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">single_level_multiindex</span><span class="s2">):</span>
        <span class="s1">single_level </span><span class="s2">= </span><span class="s1">single_level_multiindex</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">single_level</span><span class="s2">)),</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">single_level</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">single_level</span><span class="s2">.</span><span class="s1">values</span><span class="s2">:</span>
            <span class="s1">s</span><span class="s2">[</span><span class="s1">k</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_loc_getitem_int_slice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH 3053</span>
        <span class="s6"># loc should treat integer slices like label slices</span>

        <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">], [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">]])</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">, </span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">6</span><span class="s2">:</span><span class="s5">8</span><span class="s2">, :]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">30</span><span class="s2">], [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">]])</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">, </span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">20</span><span class="s2">:</span><span class="s5">30</span><span class="s2">, :]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s5">2</span><span class="s2">:]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s6"># doc examples</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">10</span><span class="s2">, :]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">:</span><span class="s5">2</span><span class="s2">]</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:, </span><span class="s5">10</span><span class="s2">]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s5">10</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;indexer_type_1&quot;</span><span class="s2">, (</span><span class="s1">list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">set</span><span class="s2">, </span><span class="s1">slice</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">, </span><span class="s1">Series</span><span class="s2">, </span><span class="s1">Index</span><span class="s2">)</span>
    <span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;indexer_type_2&quot;</span><span class="s2">, (</span><span class="s1">list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">set</span><span class="s2">, </span><span class="s1">slice</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">, </span><span class="s1">Series</span><span class="s2">, </span><span class="s1">Index</span><span class="s2">)</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_loc_getitem_nested_indexer</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">indexer_type_1</span><span class="s2">, </span><span class="s1">indexer_type_2</span><span class="s2">):</span>
        <span class="s6"># GH #19686</span>
        <span class="s6"># .loc should work with nested indexers which can be</span>
        <span class="s6"># any list-like objects (see `is_list_like` (`pandas.api.types`)) or slices</span>

        <span class="s0">def </span><span class="s1">convert_nested_indexer</span><span class="s2">(</span><span class="s1">indexer_type</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">indexer_type </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">keys</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">indexer_type </span><span class="s2">== </span><span class="s1">slice</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">slice</span><span class="s2">(*</span><span class="s1">keys</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">indexer_type</span><span class="s2">(</span><span class="s1">keys</span><span class="s2">)</span>

        <span class="s1">a </span><span class="s2">= [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">30</span><span class="s2">]</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">])</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int64&quot;</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;Data&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>

        <span class="s1">keys </span><span class="s2">= ([</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
        <span class="s1">types </span><span class="s2">= (</span><span class="s1">indexer_type_1</span><span class="s2">, </span><span class="s1">indexer_type_2</span><span class="s2">)</span>

        <span class="s6"># check indexers with all the combinations of nested objects</span>
        <span class="s6"># of all the valid types</span>
        <span class="s1">indexer </span><span class="s2">= </span><span class="s1">tuple</span><span class="s2">(</span>
            <span class="s1">convert_nested_indexer</span><span class="s2">(</span><span class="s1">indexer_type</span><span class="s2">, </span><span class="s1">k</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">indexer_type</span><span class="s2">, </span><span class="s1">k </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">types</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s0">if </span><span class="s1">indexer_type_1 </span><span class="s0">is </span><span class="s1">set </span><span class="s0">or </span><span class="s1">indexer_type_2 </span><span class="s0">is </span><span class="s1">set</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;as an indexer is not supported&quot;</span><span class="s2">):</span>
                <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">indexer</span><span class="s2">, </span><span class="s4">&quot;Data&quot;</span><span class="s2">]</span>

            <span class="s0">return</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">indexer</span><span class="s2">, </span><span class="s4">&quot;Data&quot;</span><span class="s2">]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;Data&quot;</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(</span><span class="s1">keys</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_multiindex_loc_one_dimensional_tuple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">frame_or_series</span><span class="s2">):</span>
        <span class="s6"># GH#37711</span>
        <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">), (</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">)])</span>
        <span class="s1">obj </span><span class="s2">= </span><span class="s1">frame_or_series</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
        <span class="s1">obj</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;a&quot;</span><span class="s2">,)] = </span><span class="s5">0</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">frame_or_series</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;indexer&quot;</span><span class="s2">, [(</span><span class="s4">&quot;a&quot;</span><span class="s2">,), (</span><span class="s4">&quot;a&quot;</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_multiindex_one_dimensional_tuple_columns</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">indexer</span><span class="s2">):</span>
        <span class="s6"># GH#37711</span>
        <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">), (</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">)])</span>
        <span class="s1">obj </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
        <span class="s1">obj</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">indexer</span><span class="s2">, :] = </span><span class="s5">0</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;indexer, exp_value&quot;</span><span class="s2">, [(</span><span class="s1">slice</span><span class="s2">(</span><span class="s0">None</span><span class="s2">), </span><span class="s5">1.0</span><span class="s2">), ((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_multiindex_setitem_columns_enlarging</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">indexer</span><span class="s2">, </span><span class="s1">exp_value</span><span class="s2">):</span>
        <span class="s6"># GH#39147</span>
        <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)])</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">])</span>
        <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">indexer</span><span class="s2">, [</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">]] = </span><span class="s5">1.0</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s1">exp_value</span><span class="s2">, </span><span class="s1">exp_value</span><span class="s2">]],</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">,</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_sorted_multiindex_after_union</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH#44752</span>
        <span class="s1">midx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;20110101&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s5">2</span><span class="s2">), </span><span class="s1">Index</span><span class="s2">([</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">])]</span>
        <span class="s2">)</span>
        <span class="s1">ser1 </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">midx</span><span class="s2">)</span>
        <span class="s1">ser2 </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">midx</span><span class="s2">[:</span><span class="s5">2</span><span class="s2">])</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">([</span><span class="s1">ser1</span><span class="s2">, </span><span class="s1">ser2</span><span class="s2">], </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">:</span><span class="s4">&quot;2011-01-02&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s5">0</span><span class="s2">: </span><span class="s1">ser1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">: </span><span class="s1">ser2</span><span class="s2">})</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">:</span><span class="s4">&quot;2011-01-02&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">([</span><span class="s1">ser1</span><span class="s2">, </span><span class="s1">ser2</span><span class="s2">.</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">ser1</span><span class="s2">.</span><span class="s1">index</span><span class="s2">)], </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">:</span><span class="s4">&quot;2011-01-02&quot;</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_no_second_level_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH#43599</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([</span><span class="s1">list</span><span class="s2">(</span><span class="s4">&quot;ab&quot;</span><span class="s2">), </span><span class="s1">list</span><span class="s2">(</span><span class="s4">&quot;cd&quot;</span><span class="s2">), </span><span class="s1">list</span><span class="s2">(</span><span class="s4">&quot;e&quot;</span><span class="s2">)]),</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;Val&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">s_</span><span class="s2">[:, </span><span class="s4">&quot;c&quot;</span><span class="s2">, :]]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([</span><span class="s1">list</span><span class="s2">(</span><span class="s4">&quot;ab&quot;</span><span class="s2">), </span><span class="s1">list</span><span class="s2">(</span><span class="s4">&quot;e&quot;</span><span class="s2">)]), </span><span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;Val&quot;</span><span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_loc_multi_index_key_error</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH 51892</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">): [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">],</span>
                <span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">): [</span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s4">&quot;e&quot;</span><span class="s2">, </span><span class="s4">&quot;f&quot;</span><span class="s2">],</span>
                <span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">): [</span><span class="s4">&quot;g&quot;</span><span class="s2">, </span><span class="s4">&quot;h&quot;</span><span class="s2">, </span><span class="s4">&quot;i&quot;</span><span class="s2">],</span>
                <span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">): [</span><span class="s4">&quot;j&quot;</span><span class="s2">, </span><span class="s4">&quot;k&quot;</span><span class="s2">, </span><span class="s4">&quot;l&quot;</span><span class="s2">],</span>
            <span class="s2">}</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;(1, 4)&quot;</span><span class="s2">):</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;indexer, pos&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">([], []),  </span><span class="s6"># empty ok</span>
        <span class="s2">([</span><span class="s4">&quot;A&quot;</span><span class="s2">], </span><span class="s1">slice</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)),</span>
        <span class="s2">([</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">], []),  </span><span class="s6"># &quot;D&quot; isn't present -&gt; raise</span>
        <span class="s2">([</span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s4">&quot;E&quot;</span><span class="s2">], []),  </span><span class="s6"># no values found -&gt; raise</span>
        <span class="s2">([</span><span class="s4">&quot;D&quot;</span><span class="s2">], []),  </span><span class="s6"># same, with single item list: GH 27148</span>
        <span class="s2">(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">IndexSlice</span><span class="s2">[:, [</span><span class="s4">&quot;foo&quot;</span><span class="s2">]], </span><span class="s1">slice</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)),</span>
        <span class="s2">(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">IndexSlice</span><span class="s2">[:, [</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bah&quot;</span><span class="s2">]], </span><span class="s1">slice</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_loc_getitem_duplicates_multiindex_missing_indexers</span><span class="s2">(</span><span class="s1">indexer</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">):</span>
    <span class="s6"># GH 7866</span>
    <span class="s6"># multi-index slicing with missing indexers</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">], [</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;baz&quot;</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;one&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">9</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int64&quot;</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">).</span><span class="s1">sort_index</span><span class="s2">()</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s1">pos</span><span class="s2">]</span>

    <span class="s0">if </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">size </span><span class="s2">== </span><span class="s5">0 </span><span class="s0">and </span><span class="s1">indexer </span><span class="s2">!= []:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">str</span><span class="s2">(</span><span class="s1">indexer</span><span class="s2">)):</span>
            <span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">indexer</span><span class="s2">]</span>
    <span class="s0">elif </span><span class="s1">indexer </span><span class="s2">== (</span><span class="s1">slice</span><span class="s2">(</span><span class="s0">None</span><span class="s2">), [</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bah&quot;</span><span class="s2">]):</span>
        <span class="s6"># &quot;bah&quot; is not in idx.levels[1], raising KeyError enforced in 2.0</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'bah'&quot;</span><span class="s2">):</span>
            <span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">indexer</span><span class="s2">]</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">indexer</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;columns_indexer&quot;</span><span class="s2">, [([], </span><span class="s1">slice</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)), ([</span><span class="s4">&quot;foo&quot;</span><span class="s2">], [])])</span>
<span class="s0">def </span><span class="s1">test_loc_getitem_duplicates_multiindex_empty_indexer</span><span class="s2">(</span><span class="s1">columns_indexer</span><span class="s2">):</span>
    <span class="s6"># GH 8737</span>
    <span class="s6"># empty indexer</span>
    <span class="s1">multi_index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(([</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;baz&quot;</span><span class="s2">], [</span><span class="s4">&quot;alpha&quot;</span><span class="s2">, </span><span class="s4">&quot;beta&quot;</span><span class="s2">]))</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)),</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">),</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">multi_index</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">sort_index</span><span class="s2">(</span><span class="s1">level</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">index</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">multi_index</span><span class="s2">.</span><span class="s1">reindex</span><span class="s2">([])[</span><span class="s5">0</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:, </span><span class="s1">columns_indexer</span><span class="s2">]</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_getitem_duplicates_multiindex_non_scalar_type_object</span><span class="s2">():</span>
    <span class="s6"># regression from &lt; 0.14.0</span>
    <span class="s6"># GH 7914</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">median</span><span class="s2">], [</span><span class="s4">&quot;mean&quot;</span><span class="s2">, </span><span class="s4">&quot;median&quot;</span><span class="s2">]],</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">&quot;functs&quot;</span><span class="s2">, </span><span class="s4">&quot;mean&quot;</span><span class="s2">), (</span><span class="s4">&quot;functs&quot;</span><span class="s2">, </span><span class="s4">&quot;median&quot;</span><span class="s2">)]),</span>
        <span class="s1">index</span><span class="s2">=[</span><span class="s4">&quot;function&quot;</span><span class="s2">, </span><span class="s4">&quot;name&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;function&quot;</span><span class="s2">, (</span><span class="s4">&quot;functs&quot;</span><span class="s2">, </span><span class="s4">&quot;mean&quot;</span><span class="s2">)]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mean</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_loc_getitem_tuple_plus_slice</span><span class="s2">():</span>
    <span class="s6"># GH 671</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span>
            <span class="s4">&quot;a&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">),</span>
            <span class="s4">&quot;b&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">),</span>
            <span class="s4">&quot;c&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s5">10</span><span class="s2">),</span>
            <span class="s4">&quot;d&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s5">10</span><span class="s2">),</span>
        <span class="s2">}</span>
    <span class="s2">).</span><span class="s1">set_index</span><span class="s2">([</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">])</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), :]</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_getitem_int</span><span class="s2">(</span><span class="s1">frame_random_data_integer_multi_index</span><span class="s2">):</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">frame_random_data_integer_multi_index</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[-</span><span class="s5">3</span><span class="s2">:]</span>
    <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_getitem_int_raises_exception</span><span class="s2">(</span><span class="s1">frame_random_data_integer_multi_index</span><span class="s2">):</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">frame_random_data_integer_multi_index</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;^3$&quot;</span><span class="s2">):</span>
        <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">3</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_loc_getitem_lowerdim_corner</span><span class="s2">(</span><span class="s1">multiindex_dataframe_random_data</span><span class="s2">):</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">multiindex_dataframe_random_data</span>

    <span class="s6"># test setup - check key not in dataframe</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;^\('bar', 'three'\)$&quot;</span><span class="s2">):</span>
        <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;three&quot;</span><span class="s2">), </span><span class="s4">&quot;B&quot;</span><span class="s2">]</span>

    <span class="s6"># in theory should be inserting in a sorted space????</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;three&quot;</span><span class="s2">), </span><span class="s4">&quot;B&quot;</span><span class="s2">] = </span><span class="s5">0</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">sort_index</span><span class="s2">().</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;three&quot;</span><span class="s2">), </span><span class="s4">&quot;B&quot;</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_loc_setitem_single_column_slice</span><span class="s2">():</span>
    <span class="s6"># case from https://github.com/pandas-dev/pandas/issues/27841</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s4">&quot;string&quot;</span><span class="s2">,</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">list</span><span class="s2">(</span><span class="s4">&quot;abcd&quot;</span><span class="s2">),</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s4">&quot;Main&quot;</span><span class="s2">], (</span><span class="s4">&quot;another&quot;</span><span class="s2">, </span><span class="s4">&quot;one&quot;</span><span class="s2">)]),</span>
    <span class="s2">)</span>
    <span class="s1">df</span><span class="s2">[</span><span class="s4">&quot;labels&quot;</span><span class="s2">] = </span><span class="s4">&quot;a&quot;</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:, </span><span class="s4">&quot;labels&quot;</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">.</span><span class="s1">index</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[</span><span class="s4">&quot;labels&quot;</span><span class="s2">]), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">df</span><span class="s2">.</span><span class="s1">index</span><span class="s2">))</span>

    <span class="s6"># test with non-object block</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">,</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">),</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s2">), (</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;2&quot;</span><span class="s2">), (</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s2">)]),</span>
    <span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:, </span><span class="s4">&quot;B&quot;</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">expected</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[:, </span><span class="s5">2</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_nan_multiindex</span><span class="s2">(</span><span class="s1">using_infer_string</span><span class="s2">):</span>
    <span class="s6"># GH 5286</span>
    <span class="s1">tups </span><span class="s2">= [</span>
        <span class="s2">(</span><span class="s4">&quot;Good Things&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">&quot;Good Things&quot;</span><span class="s2">, </span><span class="s4">&quot;R&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">&quot;Bad Things&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">&quot;Bad Things&quot;</span><span class="s2">, </span><span class="s4">&quot;T&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">&quot;Okay Things&quot;</span><span class="s2">, </span><span class="s4">&quot;N&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">&quot;Okay Things&quot;</span><span class="s2">, </span><span class="s4">&quot;N&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">&quot;Okay Things&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">&quot;Okay Things&quot;</span><span class="s2">, </span><span class="s4">&quot;D&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">),</span>
    <span class="s2">]</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">8</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)),</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">Index</span><span class="s2">([</span><span class="s4">&quot;d1&quot;</span><span class="s2">, </span><span class="s4">&quot;d2&quot;</span><span class="s2">, </span><span class="s4">&quot;d3&quot;</span><span class="s2">, </span><span class="s4">&quot;d4&quot;</span><span class="s2">]),</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">(</span><span class="s1">tups</span><span class="s2">, </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;u1&quot;</span><span class="s2">, </span><span class="s4">&quot;u2&quot;</span><span class="s2">, </span><span class="s4">&quot;u3&quot;</span><span class="s2">]),</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;Good Things&quot;</span><span class="s2">].</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;C&quot;</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)),</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">Index</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">],</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;object&quot; </span><span class="s0">if not </span><span class="s1">using_infer_string </span><span class="s0">else </span><span class="s4">&quot;string[pyarrow_numpy]&quot;</span><span class="s2">,</span>
            <span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;u3&quot;</span><span class="s2">,</span>
        <span class="s2">),</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">Index</span><span class="s2">([</span><span class="s4">&quot;d1&quot;</span><span class="s2">, </span><span class="s4">&quot;d2&quot;</span><span class="s2">, </span><span class="s4">&quot;d3&quot;</span><span class="s2">, </span><span class="s4">&quot;d4&quot;</span><span class="s2">]),</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_period_string_indexing</span><span class="s2">():</span>
    <span class="s6"># GH 9892</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">period_range</span><span class="s2">(</span><span class="s4">&quot;2013Q1&quot;</span><span class="s2">, </span><span class="s4">&quot;2013Q4&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;Q&quot;</span><span class="s2">)</span>
    <span class="s1">i </span><span class="s2">= (</span><span class="s5">1111</span><span class="s2">, </span><span class="s5">2222</span><span class="s2">, </span><span class="s5">3333</span><span class="s2">)</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">((</span><span class="s1">a</span><span class="s2">, </span><span class="s1">i</span><span class="s2">), </span><span class="s1">names</span><span class="s2">=(</span><span class="s4">&quot;Period&quot;</span><span class="s2">, </span><span class="s4">&quot;CVR&quot;</span><span class="s2">))</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">,</span>
        <span class="s1">columns</span><span class="s2">=(</span>
            <span class="s4">&quot;OMS&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;OMK&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;RES&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;DRIFT_IND&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;OEVRIG_IND&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;FIN_IND&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;VARE_UD&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;LOEN_UD&quot;</span><span class="s2">,</span>
            <span class="s4">&quot;FIN_UD&quot;</span><span class="s2">,</span>
        <span class="s2">),</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;2013Q1&quot;</span><span class="s2">, </span><span class="s5">1111</span><span class="s2">), </span><span class="s4">&quot;OMS&quot;</span><span class="s2">]</span>

    <span class="s1">alt </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s1">a</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s5">1111</span><span class="s2">), </span><span class="s4">&quot;OMS&quot;</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">alt</span><span class="s2">)</span>

    <span class="s6"># Because the resolution of the string matches, it is an exact lookup,</span>
    <span class="s6">#  not a slice</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">result</span><span class="s2">)</span>

    <span class="s1">alt </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;2013Q1&quot;</span><span class="s2">, </span><span class="s5">1111</span><span class="s2">), </span><span class="s4">&quot;OMS&quot;</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">alt</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_datetime_mask_slicing</span><span class="s2">():</span>
    <span class="s6"># GH 16699</span>
    <span class="s1">dt_idx </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">to_datetime</span><span class="s2">([</span><span class="s4">&quot;2017-05-04&quot;</span><span class="s2">, </span><span class="s4">&quot;2017-05-05&quot;</span><span class="s2">])</span>
    <span class="s1">m_idx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([</span><span class="s1">dt_idx</span><span class="s2">, </span><span class="s1">dt_idx</span><span class="s2">], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;Idx1&quot;</span><span class="s2">, </span><span class="s4">&quot;Idx2&quot;</span><span class="s2">])</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">data</span><span class="s2">=[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">7</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">m_idx</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;C1&quot;</span><span class="s2">, </span><span class="s4">&quot;C2&quot;</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s1">dt_idx</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], (</span><span class="s1">df</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">get_level_values</span><span class="s2">(</span><span class="s5">1</span><span class="s2">) &gt; </span><span class="s4">&quot;2017-05-04&quot;</span><span class="s2">)), </span><span class="s4">&quot;C1&quot;</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s5">3</span><span class="s2">],</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;C1&quot;</span><span class="s2">,</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">(</span>
            <span class="s2">[(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2017-05-04&quot;</span><span class="s2">), </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2017-05-05&quot;</span><span class="s2">))],</span>
            <span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;Idx1&quot;</span><span class="s2">, </span><span class="s4">&quot;Idx2&quot;</span><span class="s2">],</span>
        <span class="s2">),</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_datetime_series_tuple_slicing</span><span class="s2">():</span>
    <span class="s6"># https://github.com/pandas-dev/pandas/issues/35858</span>
    <span class="s1">date </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2000&quot;</span><span class="s2">)</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
        <span class="s5">1</span><span class="s2">,</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s1">date</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">]),</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;c&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:, [</span><span class="s1">date</span><span class="s2">]]</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">ser</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_with_mi_indexer</span><span class="s2">():</span>
    <span class="s6"># https://github.com/pandas-dev/pandas/issues/35351</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">data</span><span class="s2">=[[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]],</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">(</span>
            <span class="s2">[(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;index&quot;</span><span class="s2">, </span><span class="s4">&quot;date&quot;</span><span class="s2">]</span>
        <span class="s2">),</span>
        <span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;author&quot;</span><span class="s2">, </span><span class="s4">&quot;price&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;index&quot;</span><span class="s2">, </span><span class="s4">&quot;date&quot;</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">idx</span><span class="s2">, :]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]],</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;index&quot;</span><span class="s2">, </span><span class="s4">&quot;date&quot;</span><span class="s2">]),</span>
        <span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;author&quot;</span><span class="s2">, </span><span class="s4">&quot;price&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_mi_with_level1_named_0</span><span class="s2">():</span>
    <span class="s6"># GH#37194</span>
    <span class="s1">dti </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s2">)</span>

    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">dti</span><span class="s2">)</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">to_frame</span><span class="s2">()</span>
    <span class="s1">df</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s1">dti</span>

    <span class="s1">df2 </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">set_index</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">append</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">df2</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== (</span><span class="s0">None</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">df2</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s1">dti</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])  </span><span class="s6"># smoke test</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">df2</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">dti</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">df2</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[[</span><span class="s5">0</span><span class="s2">]].</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s1">ser2 </span><span class="s2">= </span><span class="s1">df2</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">ser2</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== (</span><span class="s0">None</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">ser2</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">dti</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">ser2</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[[</span><span class="s5">0</span><span class="s2">]].</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_getitem_str_slice</span><span class="s2">():</span>
    <span class="s6"># GH#15928</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">[</span><span class="s4">&quot;20160525 13:30:00.023&quot;</span><span class="s2">, </span><span class="s4">&quot;MSFT&quot;</span><span class="s2">, </span><span class="s4">&quot;51.95&quot;</span><span class="s2">, </span><span class="s4">&quot;51.95&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;20160525 13:30:00.048&quot;</span><span class="s2">, </span><span class="s4">&quot;GOOG&quot;</span><span class="s2">, </span><span class="s4">&quot;720.50&quot;</span><span class="s2">, </span><span class="s4">&quot;720.93&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;20160525 13:30:00.076&quot;</span><span class="s2">, </span><span class="s4">&quot;AAPL&quot;</span><span class="s2">, </span><span class="s4">&quot;98.55&quot;</span><span class="s2">, </span><span class="s4">&quot;98.56&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;20160525 13:30:00.131&quot;</span><span class="s2">, </span><span class="s4">&quot;AAPL&quot;</span><span class="s2">, </span><span class="s4">&quot;98.61&quot;</span><span class="s2">, </span><span class="s4">&quot;98.62&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;20160525 13:30:00.135&quot;</span><span class="s2">, </span><span class="s4">&quot;MSFT&quot;</span><span class="s2">, </span><span class="s4">&quot;51.92&quot;</span><span class="s2">, </span><span class="s4">&quot;51.95&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;20160525 13:30:00.135&quot;</span><span class="s2">, </span><span class="s4">&quot;AAPL&quot;</span><span class="s2">, </span><span class="s4">&quot;98.61&quot;</span><span class="s2">, </span><span class="s4">&quot;98.62&quot;</span><span class="s2">],</span>
        <span class="s2">],</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s4">&quot;time,ticker,bid,ask&quot;</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">&quot;,&quot;</span><span class="s2">),</span>
    <span class="s2">)</span>
    <span class="s1">df2 </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">set_index</span><span class="s2">([</span><span class="s4">&quot;ticker&quot;</span><span class="s2">, </span><span class="s4">&quot;time&quot;</span><span class="s2">]).</span><span class="s1">sort_index</span><span class="s2">()</span>

    <span class="s1">res </span><span class="s2">= </span><span class="s1">df2</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;AAPL&quot;</span><span class="s2">, </span><span class="s1">slice</span><span class="s2">(</span><span class="s4">&quot;2016-05-25 13:30:00&quot;</span><span class="s2">)), :].</span><span class="s1">droplevel</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">df2</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;AAPL&quot;</span><span class="s2">].</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">slice</span><span class="s2">(</span><span class="s4">&quot;2016-05-25 13:30:00&quot;</span><span class="s2">), :]</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_3levels_leading_period_index</span><span class="s2">():</span>
    <span class="s6"># GH#24091</span>
    <span class="s1">pi </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">PeriodIndex</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s4">&quot;20181101 1100&quot;</span><span class="s2">, </span><span class="s4">&quot;20181101 1200&quot;</span><span class="s2">, </span><span class="s4">&quot;20181102 1300&quot;</span><span class="s2">, </span><span class="s4">&quot;20181102 1400&quot;</span><span class="s2">],</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;datetime&quot;</span><span class="s2">,</span>
        <span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;D&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">lev2 </span><span class="s2">= [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;Z&quot;</span><span class="s2">, </span><span class="s4">&quot;W&quot;</span><span class="s2">]</span>
    <span class="s1">lev3 </span><span class="s2">= [</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">, </span><span class="s4">&quot;Q&quot;</span><span class="s2">, </span><span class="s4">&quot;F&quot;</span><span class="s2">]</span>
    <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">lev2</span><span class="s2">, </span><span class="s1">lev3</span><span class="s2">])</span>

    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s1">pi</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">)]</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s5">0.0</span>


<span class="s0">class </span><span class="s1">TestKeyErrorsWithMultiIndex</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_missing_keys_raises_keyerror</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH#27420 KeyError, not TypeError</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">12</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">])</span>
        <span class="s1">df2 </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">set_index</span><span class="s2">([</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">])</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;1&quot;</span><span class="s2">):</span>
            <span class="s1">df2</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)]</span>

    <span class="s0">def </span><span class="s1">test_missing_key_raises_keyerror2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH#21168 KeyError, not &quot;IndexingError: Too many indexers&quot;</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]] * </span><span class="s5">2</span><span class="s2">))</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;\(0, 3\)&quot;</span><span class="s2">):</span>
            <span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_missing_key_combination</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6"># GH: 19556</span>
        <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">]),</span>
                <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">&quot;1&quot;</span><span class="s2">, </span><span class="s4">&quot;2&quot;</span><span class="s2">, </span><span class="s4">&quot;2&quot;</span><span class="s2">, </span><span class="s4">&quot;3&quot;</span><span class="s2">]),</span>
                <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">]),</span>
            <span class="s2">],</span>
            <span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;one&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">, </span><span class="s4">&quot;three&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">random</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">r&quot;\('b', '1', slice\(None, None, None\)\)&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s2">, </span><span class="s1">slice</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)), :]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">get_locs</span><span class="s2">((</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s2">, </span><span class="s1">slice</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)))</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;\('b', '1'\)&quot;</span><span class="s2">):</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s2">), :]</span>


<span class="s0">def </span><span class="s1">test_getitem_loc_commutability</span><span class="s2">(</span><span class="s1">multiindex_year_month_day_dataframe_random_data</span><span class="s2">):</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">multiindex_year_month_day_dataframe_random_data</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s4">&quot;A&quot;</span><span class="s2">]</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">[</span><span class="s5">2000</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s5">2000</span><span class="s2">, </span><span class="s5">5</span><span class="s2">][</span><span class="s4">&quot;A&quot;</span><span class="s2">]</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_with_nan</span><span class="s2">():</span>
    <span class="s6"># GH: 27104</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span><span class="s4">&quot;col&quot;</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], </span><span class="s4">&quot;ind1&quot;</span><span class="s2">: [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s4">&quot;ind2&quot;</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]}</span>
    <span class="s2">).</span><span class="s1">set_index</span><span class="s2">([</span><span class="s4">&quot;ind1&quot;</span><span class="s2">, </span><span class="s4">&quot;ind2&quot;</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[[</span><span class="s4">&quot;a&quot;</span><span class="s2">]]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span><span class="s4">&quot;col&quot;</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">]}, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;ind1&quot;</span><span class="s2">, </span><span class="s4">&quot;ind2&quot;</span><span class="s2">])</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;a&quot;</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">&quot;col&quot;</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">]}, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">Index</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;ind2&quot;</span><span class="s2">))</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_getitem_non_found_tuple</span><span class="s2">():</span>
    <span class="s6"># GH: 25236</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]], </span><span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">]).</span><span class="s1">set_index</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;\(2\.0, 2\.0, 3\.0\)&quot;</span><span class="s2">):</span>
        <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">)]</span>


<span class="s0">def </span><span class="s1">test_get_loc_datetime_index</span><span class="s2">():</span>
    <span class="s6"># GH#24263</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">&quot;2001-01-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">index</span><span class="s2">])</span>
    <span class="s6"># Check if get_loc matches for Index and MultiIndex</span>
    <span class="s0">assert </span><span class="s1">mi</span><span class="s2">.</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s4">&quot;2001-01&quot;</span><span class="s2">) == </span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">31</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">index</span><span class="s2">.</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s4">&quot;2001-01&quot;</span><span class="s2">) == </span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">31</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">loc </span><span class="s2">= </span><span class="s1">mi</span><span class="s2">[::</span><span class="s5">2</span><span class="s2">].</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s4">&quot;2001-01&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">index</span><span class="s2">[::</span><span class="s5">2</span><span class="s2">].</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s4">&quot;2001-01&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">loc </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s1">loc </span><span class="s2">= </span><span class="s1">mi</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s4">&quot;2001-01&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s5">2</span><span class="s2">).</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s4">&quot;2001-01&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">loc </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s1">loc </span><span class="s2">= </span><span class="s1">mi</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">mi</span><span class="s2">).</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s4">&quot;2001-01&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">index</span><span class="s2">).</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s4">&quot;2001-01&quot;</span><span class="s2">)</span>
    <span class="s6"># TODO: standardize return type for MultiIndex.get_loc</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">.</span><span class="s1">nonzero</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_setitem_indexer_differently_ordered</span><span class="s2">():</span>
    <span class="s6"># GH#34603</span>
    <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">]], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>

    <span class="s1">indexer </span><span class="s2">= (</span><span class="s4">&quot;a&quot;</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">indexer</span><span class="s2">, :] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">9</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], [</span><span class="s5">11</span><span class="s2">, </span><span class="s5">12</span><span class="s2">]])</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([[</span><span class="s5">11</span><span class="s2">, </span><span class="s5">12</span><span class="s2">], [</span><span class="s5">9</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">]], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_getitem_index_differently_ordered_slice_none</span><span class="s2">():</span>
    <span class="s6"># GH#31330</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">]],</span>
        <span class="s1">index</span><span class="s2">=[[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]],</span>
        <span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s1">slice</span><span class="s2">(</span><span class="s0">None</span><span class="s2">), [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]), :]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]],</span>
        <span class="s1">index</span><span class="s2">=[[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]],</span>
        <span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;indexer&quot;</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">7</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">]])</span>
<span class="s0">def </span><span class="s1">test_loc_getitem_index_differently_ordered_slice_none_duplicates</span><span class="s2">(</span><span class="s1">indexer</span><span class="s2">):</span>
    <span class="s6"># GH#40978</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s5">1</span><span class="s2">] * </span><span class="s5">8</span><span class="s2">,</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">(</span>
            <span class="s2">[(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">7</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">6</span><span class="s2">), (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">8</span><span class="s2">), (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">7</span><span class="s2">)]</span>
        <span class="s2">),</span>
        <span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s1">slice</span><span class="s2">(</span><span class="s0">None</span><span class="s2">), </span><span class="s1">indexer</span><span class="s2">), :]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s5">1</span><span class="s2">] * </span><span class="s5">8</span><span class="s2">,</span>
        <span class="s1">index</span><span class="s2">=[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">]],</span>
        <span class="s1">columns</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">df</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">isin</span><span class="s2">(</span><span class="s1">indexer</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s5">1</span><span class="s2">), :]</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">df</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_getitem_drops_levels_for_one_row_dataframe</span><span class="s2">():</span>
    <span class="s6"># GH#10521 &quot;x&quot; and &quot;z&quot; are both scalar indexing, so those levels are dropped</span>
    <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([[</span><span class="s4">&quot;x&quot;</span><span class="s2">], [</span><span class="s4">&quot;y&quot;</span><span class="s2">], [</span><span class="s4">&quot;z&quot;</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">])</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">&quot;d&quot;</span><span class="s2">: [</span><span class="s5">0</span><span class="s2">]}, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">droplevel</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;x&quot;</span><span class="s2">, :, </span><span class="s4">&quot;z&quot;</span><span class="s2">]</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;x&quot;</span><span class="s2">, :, </span><span class="s4">&quot;z&quot;</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">Index</span><span class="s2">([</span><span class="s4">&quot;y&quot;</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">))</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_mi_columns_loc_list_label_order</span><span class="s2">():</span>
    <span class="s6"># GH 10710</span>
    <span class="s1">cols </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]])</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)), </span><span class="s1">columns</span><span class="s2">=</span><span class="s1">cols</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[:, [</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">]]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)),</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)]),</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_mi_partial_indexing_list_raises</span><span class="s2">():</span>
    <span class="s6"># GH 13501</span>
    <span class="s1">frame </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">12</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)),</span>
        <span class="s1">index</span><span class="s2">=[[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]],</span>
        <span class="s1">columns</span><span class="s2">=[[</span><span class="s4">&quot;Ohio&quot;</span><span class="s2">, </span><span class="s4">&quot;Ohio&quot;</span><span class="s2">, </span><span class="s4">&quot;Colorado&quot;</span><span class="s2">], [</span><span class="s4">&quot;Green&quot;</span><span class="s2">, </span><span class="s4">&quot;Red&quot;</span><span class="s2">, </span><span class="s4">&quot;Green&quot;</span><span class="s2">]],</span>
    <span class="s2">)</span>
    <span class="s1">frame</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">names </span><span class="s2">= [</span><span class="s4">&quot;key1&quot;</span><span class="s2">, </span><span class="s4">&quot;key2&quot;</span><span class="s2">]</span>
    <span class="s1">frame</span><span class="s2">.</span><span class="s1">columns</span><span class="s2">.</span><span class="s1">names </span><span class="s2">= [</span><span class="s4">&quot;state&quot;</span><span class="s2">, </span><span class="s4">&quot;color&quot;</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;</span><span class="s0">\\</span><span class="s4">[2</span><span class="s0">\\</span><span class="s4">] not in index&quot;</span><span class="s2">):</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[[</span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s4">&quot;Colorado&quot;</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_mi_indexing_list_nonexistent_raises</span><span class="s2">():</span>
    <span class="s6"># GH 15452</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">]]))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;</span><span class="s0">\\</span><span class="s4">['not' 'found'</span><span class="s0">\\</span><span class="s4">] not in index&quot;</span><span class="s2">):</span>
        <span class="s1">s</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[[</span><span class="s4">&quot;not&quot;</span><span class="s2">, </span><span class="s4">&quot;found&quot;</span><span class="s2">]]</span>


<span class="s0">def </span><span class="s1">test_mi_add_cell_missing_row_non_unique</span><span class="s2">():</span>
    <span class="s6"># GH 16018</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">]],</span>
        <span class="s1">index</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">],</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">]]),</span>
    <span class="s2">)</span>
    <span class="s1">result</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;c&quot;</span><span class="s2">] = -</span><span class="s5">1</span>
    <span class="s1">result</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;c&quot;</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">)] = </span><span class="s5">3</span>
    <span class="s1">result</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;d&quot;</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s4">&quot;A&quot;</span><span class="s2">)] = </span><span class="s5">3</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">[</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">, </span><span class="s5">6.0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">, </span><span class="s5">7.0</span><span class="s2">, </span><span class="s5">8.0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s5">3.0</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s5">3.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">],</span>
        <span class="s2">],</span>
        <span class="s1">index</span><span class="s2">=[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">],</span>
        <span class="s1">columns</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">]]),</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_get_scalar_casting_to_float</span><span class="s2">():</span>
    <span class="s6"># GH#41369</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span><span class="s4">&quot;a&quot;</span><span class="s2">: </span><span class="s5">1.0</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">: </span><span class="s5">2</span><span class="s2">}, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([[</span><span class="s5">3</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">])</span>
    <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">), </span><span class="s4">&quot;b&quot;</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s5">2</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[[(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)], </span><span class="s4">&quot;b&quot;</span><span class="s2">].</span><span class="s1">iloc</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s5">2</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_empty_single_selector_with_names</span><span class="s2">():</span>
    <span class="s6"># GH 19517</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>
    <span class="s1">s2 </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">index</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">s2</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s4">&quot;a&quot;</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">Index</span><span class="s2">([</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s5">0</span><span class="s2">))</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_keyerror_rightmost_key_missing</span><span class="s2">():</span>
    <span class="s6"># GH 20951</span>

    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span>
            <span class="s4">&quot;A&quot;</span><span class="s2">: [</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">300</span><span class="s2">, </span><span class="s5">300</span><span class="s2">],</span>
            <span class="s4">&quot;B&quot;</span><span class="s2">: [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">21</span><span class="s2">, </span><span class="s5">31</span><span class="s2">, </span><span class="s5">33</span><span class="s2">],</span>
            <span class="s4">&quot;C&quot;</span><span class="s2">: </span><span class="s1">range</span><span class="s2">(</span><span class="s5">6</span><span class="s2">),</span>
        <span class="s2">}</span>
    <span class="s2">)</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">set_index</span><span class="s2">([</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;^1$&quot;</span><span class="s2">):</span>
        <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)]</span>


<span class="s0">def </span><span class="s1">test_multindex_series_loc_with_tuple_label</span><span class="s2">():</span>
    <span class="s6"># GH#43908</span>
    <span class="s1">mi </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">3</span><span class="s2">, (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))])</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">mi</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[(</span><span class="s5">3</span><span class="s2">, (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))]</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s5">2</span>
</pre>
</body>
</html>