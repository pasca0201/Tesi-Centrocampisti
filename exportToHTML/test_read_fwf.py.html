<html>
<head>
<title>test_read_fwf.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_read_fwf.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests the 'read_fwf' function in parsers.py. This 
test suite is independent of the others because the 
engine is set to 'python-fwf' internally. 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">datetime</span>
<span class="s2">from </span><span class="s1">io </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">BytesIO</span><span class="s3">,</span>
    <span class="s1">StringIO</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pathlib </span><span class="s2">import </span><span class="s1">Path</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s1">EmptyDataError</span>

<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">DataFrame</span><span class="s3">,</span>
    <span class="s1">DatetimeIndex</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_testing </span><span class="s2">as </span><span class="s1">tm</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">arrays </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">ArrowStringArray</span><span class="s3">,</span>
    <span class="s1">StringArray</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">common </span><span class="s2">import </span><span class="s1">urlopen</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">parsers </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">read_csv</span><span class="s3">,</span>
    <span class="s1">read_fwf</span><span class="s3">,</span>
<span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_basic</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A         B            C            D 
201158    360.242940   149.910199   11950.7 
201159    444.953632   166.985655   11788.4 
201160    364.136849   183.628767   11806.2 
201161    413.836124   184.375703   11916.8 
201162    502.953953   173.237159   12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">201158</span><span class="s3">, </span><span class="s5">360.242940</span><span class="s3">, </span><span class="s5">149.910199</span><span class="s3">, </span><span class="s5">11950.7</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">201159</span><span class="s3">, </span><span class="s5">444.953632</span><span class="s3">, </span><span class="s5">166.985655</span><span class="s3">, </span><span class="s5">11788.4</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">201160</span><span class="s3">, </span><span class="s5">364.136849</span><span class="s3">, </span><span class="s5">183.628767</span><span class="s3">, </span><span class="s5">11806.2</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">201161</span><span class="s3">, </span><span class="s5">413.836124</span><span class="s3">, </span><span class="s5">184.375703</span><span class="s3">, </span><span class="s5">11916.8</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">201162</span><span class="s3">, </span><span class="s5">502.953953</span><span class="s3">, </span><span class="s5">173.237159</span><span class="s3">, </span><span class="s5">12468.3</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_colspecs</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A   B     C            D            E 
201158    360.242940   149.910199   11950.7 
201159    444.953632   166.985655   11788.4 
201160    364.136849   183.628767   11806.2 
201161    413.836124   184.375703   11916.8 
201162    502.953953   173.237159   12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">colspecs </span><span class="s3">= [(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">4</span><span class="s3">), (</span><span class="s5">4</span><span class="s3">, </span><span class="s5">8</span><span class="s3">), (</span><span class="s5">8</span><span class="s3">, </span><span class="s5">20</span><span class="s3">), (</span><span class="s5">21</span><span class="s3">, </span><span class="s5">33</span><span class="s3">), (</span><span class="s5">34</span><span class="s3">, </span><span class="s5">43</span><span class="s3">)]</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">)</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">58</span><span class="s3">, </span><span class="s5">360.242940</span><span class="s3">, </span><span class="s5">149.910199</span><span class="s3">, </span><span class="s5">11950.7</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">59</span><span class="s3">, </span><span class="s5">444.953632</span><span class="s3">, </span><span class="s5">166.985655</span><span class="s3">, </span><span class="s5">11788.4</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">60</span><span class="s3">, </span><span class="s5">364.136849</span><span class="s3">, </span><span class="s5">183.628767</span><span class="s3">, </span><span class="s5">11806.2</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">61</span><span class="s3">, </span><span class="s5">413.836124</span><span class="s3">, </span><span class="s5">184.375703</span><span class="s3">, </span><span class="s5">11916.8</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">62</span><span class="s3">, </span><span class="s5">502.953953</span><span class="s3">, </span><span class="s5">173.237159</span><span class="s3">, </span><span class="s5">12468.3</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s4">&quot;E&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_widths</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A    B    C            D            E 
2011 58   360.242940   149.910199   11950.7 
2011 59   444.953632   166.985655   11788.4 
2011 60   364.136849   183.628767   11806.2 
2011 61   413.836124   184.375703   11916.8 
2011 62   502.953953   173.237159   12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">widths</span><span class="s3">=[</span><span class="s5">5</span><span class="s3">, </span><span class="s5">5</span><span class="s3">, </span><span class="s5">13</span><span class="s3">, </span><span class="s5">13</span><span class="s3">, </span><span class="s5">7</span><span class="s3">])</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">58</span><span class="s3">, </span><span class="s5">360.242940</span><span class="s3">, </span><span class="s5">149.910199</span><span class="s3">, </span><span class="s5">11950.7</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">59</span><span class="s3">, </span><span class="s5">444.953632</span><span class="s3">, </span><span class="s5">166.985655</span><span class="s3">, </span><span class="s5">11788.4</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">60</span><span class="s3">, </span><span class="s5">364.136849</span><span class="s3">, </span><span class="s5">183.628767</span><span class="s3">, </span><span class="s5">11806.2</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">61</span><span class="s3">, </span><span class="s5">413.836124</span><span class="s3">, </span><span class="s5">184.375703</span><span class="s3">, </span><span class="s5">11916.8</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">62</span><span class="s3">, </span><span class="s5">502.953953</span><span class="s3">, </span><span class="s5">173.237159</span><span class="s3">, </span><span class="s5">12468.3</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s4">&quot;E&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_non_space_filler</span><span class="s3">():</span>
    <span class="s6"># From Thomas Kluyver:</span>
    <span class="s6">#</span>
    <span class="s6"># Apparently, some non-space filler characters can be seen, this is</span>
    <span class="s6"># supported by specifying the 'delimiter' character:</span>
    <span class="s6">#</span>
    <span class="s6"># http://publib.boulder.ibm.com/infocenter/dmndhelp/v6r1mx/index.jsp?topic=/com.ibm.wbit.612.help.config.doc/topics/rfixwidth.html</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A~~~~B~~~~C~~~~~~~~~~~~D~~~~~~~~~~~~E 
201158~~~~360.242940~~~149.910199~~~11950.7 
201159~~~~444.953632~~~166.985655~~~11788.4 
201160~~~~364.136849~~~183.628767~~~11806.2 
201161~~~~413.836124~~~184.375703~~~11916.8 
201162~~~~502.953953~~~173.237159~~~12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">colspecs </span><span class="s3">= [(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">4</span><span class="s3">), (</span><span class="s5">4</span><span class="s3">, </span><span class="s5">8</span><span class="s3">), (</span><span class="s5">8</span><span class="s3">, </span><span class="s5">20</span><span class="s3">), (</span><span class="s5">21</span><span class="s3">, </span><span class="s5">33</span><span class="s3">), (</span><span class="s5">34</span><span class="s3">, </span><span class="s5">43</span><span class="s3">)]</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s4">&quot;~&quot;</span><span class="s3">)</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">58</span><span class="s3">, </span><span class="s5">360.242940</span><span class="s3">, </span><span class="s5">149.910199</span><span class="s3">, </span><span class="s5">11950.7</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">59</span><span class="s3">, </span><span class="s5">444.953632</span><span class="s3">, </span><span class="s5">166.985655</span><span class="s3">, </span><span class="s5">11788.4</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">60</span><span class="s3">, </span><span class="s5">364.136849</span><span class="s3">, </span><span class="s5">183.628767</span><span class="s3">, </span><span class="s5">11806.2</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">61</span><span class="s3">, </span><span class="s5">413.836124</span><span class="s3">, </span><span class="s5">184.375703</span><span class="s3">, </span><span class="s5">11916.8</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">2011</span><span class="s3">, </span><span class="s5">62</span><span class="s3">, </span><span class="s5">502.953953</span><span class="s3">, </span><span class="s5">173.237159</span><span class="s3">, </span><span class="s5">12468.3</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s4">&quot;E&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_over_specified</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A   B     C            D            E 
201158    360.242940   149.910199   11950.7 
201159    444.953632   166.985655   11788.4 
201160    364.136849   183.628767   11806.2 
201161    413.836124   184.375703   11916.8 
201162    502.953953   173.237159   12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">colspecs </span><span class="s3">= [(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">4</span><span class="s3">), (</span><span class="s5">4</span><span class="s3">, </span><span class="s5">8</span><span class="s3">), (</span><span class="s5">8</span><span class="s3">, </span><span class="s5">20</span><span class="s3">), (</span><span class="s5">21</span><span class="s3">, </span><span class="s5">33</span><span class="s3">), (</span><span class="s5">34</span><span class="s3">, </span><span class="s5">43</span><span class="s3">)]</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;must specify only one of&quot;</span><span class="s3">):</span>
        <span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">widths</span><span class="s3">=[</span><span class="s5">6</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">7</span><span class="s3">])</span>


<span class="s2">def </span><span class="s1">test_under_specified</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A   B     C            D            E 
201158    360.242940   149.910199   11950.7 
201159    444.953632   166.985655   11788.4 
201160    364.136849   183.628767   11806.2 
201161    413.836124   184.375703   11916.8 
201162    502.953953   173.237159   12468.3 
&quot;&quot;&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;Must specify either&quot;</span><span class="s3">):</span>
        <span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">widths</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_csv_compat</span><span class="s3">():</span>
    <span class="s1">csv_data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A,B,C,D,E 
2011,58,360.242940,149.910199,11950.7 
2011,59,444.953632,166.985655,11788.4 
2011,60,364.136849,183.628767,11806.2 
2011,61,413.836124,184.375703,11916.8 
2011,62,502.953953,173.237159,12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">csv_data</span><span class="s3">), </span><span class="s1">engine</span><span class="s3">=</span><span class="s4">&quot;python&quot;</span><span class="s3">)</span>

    <span class="s1">fwf_data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A   B     C            D            E 
201158    360.242940   149.910199   11950.7 
201159    444.953632   166.985655   11788.4 
201160    364.136849   183.628767   11806.2 
201161    413.836124   184.375703   11916.8 
201162    502.953953   173.237159   12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">colspecs </span><span class="s3">= [(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">4</span><span class="s3">), (</span><span class="s5">4</span><span class="s3">, </span><span class="s5">8</span><span class="s3">), (</span><span class="s5">8</span><span class="s3">, </span><span class="s5">20</span><span class="s3">), (</span><span class="s5">21</span><span class="s3">, </span><span class="s5">33</span><span class="s3">), (</span><span class="s5">34</span><span class="s3">, </span><span class="s5">43</span><span class="s3">)]</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">fwf_data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_bytes_io_input</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s1">BytesIO</span><span class="s3">(</span><span class="s4">&quot;שלום</span><span class="s2">\n</span><span class="s4">שלום&quot;</span><span class="s3">.</span><span class="s1">encode</span><span class="s3">())  </span><span class="s6"># noqa: RUF001</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">data</span><span class="s3">, </span><span class="s1">widths</span><span class="s3">=[</span><span class="s5">2</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], </span><span class="s1">encoding</span><span class="s3">=</span><span class="s4">&quot;utf8&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([[</span><span class="s4">&quot;של&quot;</span><span class="s3">, </span><span class="s4">&quot;ום&quot;</span><span class="s3">]], </span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;של&quot;</span><span class="s3">, </span><span class="s4">&quot;ום&quot;</span><span class="s3">])</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_fwf_colspecs_is_list_or_tuple</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;index,A,B,C,D 
foo,2,3,4,5 
bar,7,8,9,10 
baz,12,13,14,15 
qux,12,13,14,15 
foo2,12,13,14,15 
bar2,12,13,14,15 
&quot;&quot;&quot;</span>

    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;column specifications must be a list or tuple.+&quot;</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">={</span><span class="s4">&quot;a&quot;</span><span class="s3">: </span><span class="s5">1</span><span class="s3">}, </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s4">&quot;,&quot;</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_fwf_colspecs_is_list_or_tuple_of_two_element_tuples</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;index,A,B,C,D 
foo,2,3,4,5 
bar,7,8,9,10 
baz,12,13,14,15 
qux,12,13,14,15 
foo2,12,13,14,15 
bar2,12,13,14,15 
&quot;&quot;&quot;</span>

    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Each column specification must be.+&quot;</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=[(</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)])</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;colspecs,exp_data&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">([(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">3</span><span class="s3">), (</span><span class="s5">3</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)], [[</span><span class="s5">123</span><span class="s3">, </span><span class="s5">456</span><span class="s3">], [</span><span class="s5">456</span><span class="s3">, </span><span class="s5">789</span><span class="s3">]]),</span>
        <span class="s3">([(</span><span class="s2">None</span><span class="s3">, </span><span class="s5">3</span><span class="s3">), (</span><span class="s5">3</span><span class="s3">, </span><span class="s5">6</span><span class="s3">)], [[</span><span class="s5">123</span><span class="s3">, </span><span class="s5">456</span><span class="s3">], [</span><span class="s5">456</span><span class="s3">, </span><span class="s5">789</span><span class="s3">]]),</span>
        <span class="s3">([(</span><span class="s5">0</span><span class="s3">, </span><span class="s2">None</span><span class="s3">), (</span><span class="s5">3</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)], [[</span><span class="s5">123456</span><span class="s3">, </span><span class="s5">456</span><span class="s3">], [</span><span class="s5">456789</span><span class="s3">, </span><span class="s5">789</span><span class="s3">]]),</span>
        <span class="s3">([(</span><span class="s2">None</span><span class="s3">, </span><span class="s2">None</span><span class="s3">), (</span><span class="s5">3</span><span class="s3">, </span><span class="s5">6</span><span class="s3">)], [[</span><span class="s5">123456</span><span class="s3">, </span><span class="s5">456</span><span class="s3">], [</span><span class="s5">456789</span><span class="s3">, </span><span class="s5">789</span><span class="s3">]]),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_fwf_colspecs_none</span><span class="s3">(</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">exp_data</span><span class="s3">):</span>
    <span class="s6"># see gh-7079</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">123456 
456789 
&quot;&quot;&quot;</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">exp_data</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;infer_nrows,exp_data&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s6"># infer_nrows --&gt; colspec == [(2, 3), (5, 6)]</span>
        <span class="s3">(</span><span class="s5">1</span><span class="s3">, [[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], [</span><span class="s5">3</span><span class="s3">, </span><span class="s5">8</span><span class="s3">]]),</span>
        <span class="s6"># infer_nrows &gt; number of rows</span>
        <span class="s3">(</span><span class="s5">10</span><span class="s3">, [[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], [</span><span class="s5">123</span><span class="s3">, </span><span class="s5">98</span><span class="s3">]]),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_fwf_colspecs_infer_nrows</span><span class="s3">(</span><span class="s1">infer_nrows</span><span class="s3">, </span><span class="s1">exp_data</span><span class="s3">):</span>
    <span class="s6"># see gh-15138</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
  </span><span class="s4">1  2 
123 98 
&quot;&quot;&quot;</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">exp_data</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">infer_nrows</span><span class="s3">=</span><span class="s1">infer_nrows</span><span class="s3">, </span><span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_fwf_regression</span><span class="s3">():</span>
    <span class="s6"># see gh-3594</span>
    <span class="s6">#</span>
    <span class="s6"># Turns out &quot;T060&quot; is parsable as a datetime slice!</span>
    <span class="s1">tz_list </span><span class="s3">= [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">20</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">60</span><span class="s3">, </span><span class="s5">80</span><span class="s3">, </span><span class="s5">100</span><span class="s3">]</span>
    <span class="s1">widths </span><span class="s3">= [</span><span class="s5">16</span><span class="s3">] + [</span><span class="s5">8</span><span class="s3">] * </span><span class="s1">len</span><span class="s3">(</span><span class="s1">tz_list</span><span class="s3">)</span>
    <span class="s1">names </span><span class="s3">= [</span><span class="s4">&quot;SST&quot;</span><span class="s3">] + [</span><span class="s4">f&quot;T</span><span class="s2">{</span><span class="s1">z</span><span class="s2">:</span><span class="s4">03d</span><span class="s2">}</span><span class="s4">&quot; </span><span class="s2">for </span><span class="s1">z </span><span class="s2">in </span><span class="s1">tz_list</span><span class="s3">[</span><span class="s5">1</span><span class="s3">:]]</span>

    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;  2009164202000   9.5403  9.4105  8.6571  7.8372  6.0612  5.8843  5.5192 
2009164203000   9.5435  9.2010  8.6167  7.8176  6.0804  5.8728  5.4869 
2009164204000   9.5873  9.1326  8.4694  7.5889  6.0422  5.8526  5.4657 
2009164205000   9.5810  9.0896  8.4009  7.4652  6.0322  5.8189  5.4379 
2009164210000   9.6034  9.0897  8.3822  7.4905  6.0908  5.7904  5.4039 
&quot;&quot;&quot;</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;use 'date_format' instead&quot;</span><span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
            <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
            <span class="s1">index_col</span><span class="s3">=</span><span class="s5">0</span><span class="s3">,</span>
            <span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
            <span class="s1">names</span><span class="s3">=</span><span class="s1">names</span><span class="s3">,</span>
            <span class="s1">widths</span><span class="s3">=</span><span class="s1">widths</span><span class="s3">,</span>
            <span class="s1">parse_dates</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
            <span class="s1">date_parser</span><span class="s3">=</span><span class="s2">lambda </span><span class="s1">s</span><span class="s3">: </span><span class="s1">datetime</span><span class="s3">.</span><span class="s1">strptime</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s4">&quot;%Y%j%H%M%S&quot;</span><span class="s3">),</span>
        <span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">9.5403</span><span class="s3">, </span><span class="s5">9.4105</span><span class="s3">, </span><span class="s5">8.6571</span><span class="s3">, </span><span class="s5">7.8372</span><span class="s3">, </span><span class="s5">6.0612</span><span class="s3">, </span><span class="s5">5.8843</span><span class="s3">, </span><span class="s5">5.5192</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">9.5435</span><span class="s3">, </span><span class="s5">9.2010</span><span class="s3">, </span><span class="s5">8.6167</span><span class="s3">, </span><span class="s5">7.8176</span><span class="s3">, </span><span class="s5">6.0804</span><span class="s3">, </span><span class="s5">5.8728</span><span class="s3">, </span><span class="s5">5.4869</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">9.5873</span><span class="s3">, </span><span class="s5">9.1326</span><span class="s3">, </span><span class="s5">8.4694</span><span class="s3">, </span><span class="s5">7.5889</span><span class="s3">, </span><span class="s5">6.0422</span><span class="s3">, </span><span class="s5">5.8526</span><span class="s3">, </span><span class="s5">5.4657</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">9.5810</span><span class="s3">, </span><span class="s5">9.0896</span><span class="s3">, </span><span class="s5">8.4009</span><span class="s3">, </span><span class="s5">7.4652</span><span class="s3">, </span><span class="s5">6.0322</span><span class="s3">, </span><span class="s5">5.8189</span><span class="s3">, </span><span class="s5">5.4379</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">9.6034</span><span class="s3">, </span><span class="s5">9.0897</span><span class="s3">, </span><span class="s5">8.3822</span><span class="s3">, </span><span class="s5">7.4905</span><span class="s3">, </span><span class="s5">6.0908</span><span class="s3">, </span><span class="s5">5.7904</span><span class="s3">, </span><span class="s5">5.4039</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">index</span><span class="s3">=</span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s4">&quot;2009-06-13 20:20:00&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2009-06-13 20:30:00&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2009-06-13 20:40:00&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2009-06-13 20:50:00&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2009-06-13 21:00:00&quot;</span><span class="s3">,</span>
            <span class="s3">]</span>
        <span class="s3">),</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;SST&quot;</span><span class="s3">, </span><span class="s4">&quot;T010&quot;</span><span class="s3">, </span><span class="s4">&quot;T020&quot;</span><span class="s3">, </span><span class="s4">&quot;T030&quot;</span><span class="s3">, </span><span class="s4">&quot;T060&quot;</span><span class="s3">, </span><span class="s4">&quot;T080&quot;</span><span class="s3">, </span><span class="s4">&quot;T100&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
        <span class="s1">index_col</span><span class="s3">=</span><span class="s5">0</span><span class="s3">,</span>
        <span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">names</span><span class="s3">=</span><span class="s1">names</span><span class="s3">,</span>
        <span class="s1">widths</span><span class="s3">=</span><span class="s1">widths</span><span class="s3">,</span>
        <span class="s1">parse_dates</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">date_format</span><span class="s3">=</span><span class="s4">&quot;%Y%j%H%M%S&quot;</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_fwf_for_uint8</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;1421302965.213420    PRI=3 PGN=0xef00      DST=0x17 SRC=0x28    04 154 00 00 00 00 00 127 
1421302964.226776    PRI=6 PGN=0xf002               SRC=0x47    243 00 00 255 247 00 00 71&quot;&quot;&quot;  </span><span class="s6"># noqa: E501</span>
    <span class="s1">df </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
        <span class="s1">colspecs</span><span class="s3">=[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">17</span><span class="s3">), (</span><span class="s5">25</span><span class="s3">, </span><span class="s5">26</span><span class="s3">), (</span><span class="s5">33</span><span class="s3">, </span><span class="s5">37</span><span class="s3">), (</span><span class="s5">49</span><span class="s3">, </span><span class="s5">51</span><span class="s3">), (</span><span class="s5">58</span><span class="s3">, </span><span class="s5">62</span><span class="s3">), (</span><span class="s5">63</span><span class="s3">, </span><span class="s5">1000</span><span class="s3">)],</span>
        <span class="s1">names</span><span class="s3">=[</span><span class="s4">&quot;time&quot;</span><span class="s3">, </span><span class="s4">&quot;pri&quot;</span><span class="s3">, </span><span class="s4">&quot;pgn&quot;</span><span class="s3">, </span><span class="s4">&quot;dst&quot;</span><span class="s3">, </span><span class="s4">&quot;src&quot;</span><span class="s3">, </span><span class="s4">&quot;data&quot;</span><span class="s3">],</span>
        <span class="s1">converters</span><span class="s3">={</span>
            <span class="s4">&quot;pgn&quot;</span><span class="s3">: </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">int</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s5">16</span><span class="s3">),</span>
            <span class="s4">&quot;src&quot;</span><span class="s3">: </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">int</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s5">16</span><span class="s3">),</span>
            <span class="s4">&quot;dst&quot;</span><span class="s3">: </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">int</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s5">16</span><span class="s3">),</span>
            <span class="s4">&quot;data&quot;</span><span class="s3">: </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot; &quot;</span><span class="s3">)),</span>
        <span class="s3">},</span>
    <span class="s3">)</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">1421302965.213420</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s5">61184</span><span class="s3">, </span><span class="s5">23</span><span class="s3">, </span><span class="s5">40</span><span class="s3">, </span><span class="s5">8</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">1421302964.226776</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">61442</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s5">71</span><span class="s3">, </span><span class="s5">8</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;time&quot;</span><span class="s3">, </span><span class="s4">&quot;pri&quot;</span><span class="s3">, </span><span class="s4">&quot;pgn&quot;</span><span class="s3">, </span><span class="s4">&quot;dst&quot;</span><span class="s3">, </span><span class="s4">&quot;src&quot;</span><span class="s3">, </span><span class="s4">&quot;data&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">expected</span><span class="s3">[</span><span class="s4">&quot;dst&quot;</span><span class="s3">] = </span><span class="s1">expected</span><span class="s3">[</span><span class="s4">&quot;dst&quot;</span><span class="s3">].</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">df</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;comment&quot;</span><span class="s3">, [</span><span class="s4">&quot;#&quot;</span><span class="s3">, </span><span class="s4">&quot;~&quot;</span><span class="s3">, </span><span class="s4">&quot;!&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_fwf_comment</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
  </span><span class="s4">1   2.   4  #hello world 
  5  NaN  10.0 
&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s1">data</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;#&quot;</span><span class="s3">, </span><span class="s1">comment</span><span class="s3">)</span>

    <span class="s1">colspecs </span><span class="s3">= [(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">3</span><span class="s3">), (</span><span class="s5">4</span><span class="s3">, </span><span class="s5">9</span><span class="s3">), (</span><span class="s5">9</span><span class="s3">, </span><span class="s5">25</span><span class="s3">)]</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2.0</span><span class="s3">, </span><span class="s5">4</span><span class="s3">], [</span><span class="s5">5</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s5">10.0</span><span class="s3">]])</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">comment</span><span class="s3">=</span><span class="s1">comment</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_fwf_skip_blank_lines</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
 
A         B            C            D 
 
201158    360.242940   149.910199   11950.7 
201159    444.953632   166.985655   11788.4 
 
 
201162    502.953953   173.237159   12468.3 
 
&quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skip_blank_lines</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">201158</span><span class="s3">, </span><span class="s5">360.242940</span><span class="s3">, </span><span class="s5">149.910199</span><span class="s3">, </span><span class="s5">11950.7</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">201159</span><span class="s3">, </span><span class="s5">444.953632</span><span class="s3">, </span><span class="s5">166.985655</span><span class="s3">, </span><span class="s5">11788.4</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">201162</span><span class="s3">, </span><span class="s5">502.953953</span><span class="s3">, </span><span class="s5">173.237159</span><span class="s3">, </span><span class="s5">12468.3</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A         B            C            D 
201158    360.242940   149.910199   11950.7 
201159    444.953632   166.985655   11788.4 
 
 
201162    502.953953   173.237159   12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skip_blank_lines</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">201158</span><span class="s3">, </span><span class="s5">360.242940</span><span class="s3">, </span><span class="s5">149.910199</span><span class="s3">, </span><span class="s5">11950.7</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">201159</span><span class="s3">, </span><span class="s5">444.953632</span><span class="s3">, </span><span class="s5">166.985655</span><span class="s3">, </span><span class="s5">11788.4</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">201162</span><span class="s3">, </span><span class="s5">502.953953</span><span class="s3">, </span><span class="s5">173.237159</span><span class="s3">, </span><span class="s5">12468.3</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;thousands&quot;</span><span class="s3">, [</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;#&quot;</span><span class="s3">, </span><span class="s4">&quot;~&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_fwf_thousands</span><span class="s3">(</span><span class="s1">thousands</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
 </span><span class="s4">1 2,334.0    5 
10   13     10. 
&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s1">data</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s1">thousands</span><span class="s3">)</span>

    <span class="s1">colspecs </span><span class="s3">= [(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">3</span><span class="s3">), (</span><span class="s5">3</span><span class="s3">, </span><span class="s5">11</span><span class="s3">), (</span><span class="s5">12</span><span class="s3">, </span><span class="s5">16</span><span class="s3">)]</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([[</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2334.0</span><span class="s3">, </span><span class="s5">5</span><span class="s3">], [</span><span class="s5">10</span><span class="s3">, </span><span class="s5">13</span><span class="s3">, </span><span class="s5">10.0</span><span class="s3">]])</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">thousands</span><span class="s3">=</span><span class="s1">thousands</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;header&quot;</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_bool_header_arg</span><span class="s3">(</span><span class="s1">header</span><span class="s3">):</span>
    <span class="s6"># see gh-6114</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">MyColumn 
   a 
   b 
   a 
   b&quot;&quot;&quot;</span>

    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Passing a bool to header is invalid&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">header</span><span class="s3">=</span><span class="s1">header</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_full_file</span><span class="s3">():</span>
    <span class="s6"># File with all values.</span>
    <span class="s1">test </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;index                             A    B    C 
2000-01-03T00:00:00  0.980268513777    3  foo 
2000-01-04T00:00:00  1.04791624281    -4  bar 
2000-01-05T00:00:00  0.498580885705   73  baz 
2000-01-06T00:00:00  1.12020151869     1  foo 
2000-01-07T00:00:00  0.487094399463    0  bar 
2000-01-10T00:00:00  0.836648671666    2  baz 
2000-01-11T00:00:00  0.157160753327   34  foo&quot;&quot;&quot;</span>
    <span class="s1">colspecs </span><span class="s3">= ((</span><span class="s5">0</span><span class="s3">, </span><span class="s5">19</span><span class="s3">), (</span><span class="s5">21</span><span class="s3">, </span><span class="s5">35</span><span class="s3">), (</span><span class="s5">38</span><span class="s3">, </span><span class="s5">40</span><span class="s3">), (</span><span class="s5">42</span><span class="s3">, </span><span class="s5">45</span><span class="s3">))</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_full_file_with_missing</span><span class="s3">():</span>
    <span class="s6"># File with missing values.</span>
    <span class="s1">test </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;index                             A    B    C 
2000-01-03T00:00:00  0.980268513777    3  foo 
2000-01-04T00:00:00  1.04791624281    -4  bar 
                     0.498580885705   73  baz 
2000-01-06T00:00:00  1.12020151869     1  foo 
2000-01-07T00:00:00                    0  bar 
2000-01-10T00:00:00  0.836648671666    2  baz 
                                      34&quot;&quot;&quot;</span>
    <span class="s1">colspecs </span><span class="s3">= ((</span><span class="s5">0</span><span class="s3">, </span><span class="s5">19</span><span class="s3">), (</span><span class="s5">21</span><span class="s3">, </span><span class="s5">35</span><span class="s3">), (</span><span class="s5">38</span><span class="s3">, </span><span class="s5">40</span><span class="s3">), (</span><span class="s5">42</span><span class="s3">, </span><span class="s5">45</span><span class="s3">))</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_full_file_with_spaces</span><span class="s3">():</span>
    <span class="s6"># File with spaces in columns.</span>
    <span class="s1">test </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
Account                 Name  Balance     CreditLimit   AccountCreated 
101     Keanu Reeves          9315.45     10000.00           1/17/1998 
312     Gerard Butler         90.00       1000.00             8/6/2003 
868     Jennifer Love Hewitt  0           17000.00           5/25/1985 
761     Jada Pinkett-Smith    49654.87    100000.00          12/5/2006 
317     Bill Murray           789.65      5000.00             2/5/2007 
&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">(</span>
        <span class="s4">&quot;</span><span class="s2">\r\n</span><span class="s4">&quot;</span>
    <span class="s3">)</span>
    <span class="s1">colspecs </span><span class="s3">= ((</span><span class="s5">0</span><span class="s3">, </span><span class="s5">7</span><span class="s3">), (</span><span class="s5">8</span><span class="s3">, </span><span class="s5">28</span><span class="s3">), (</span><span class="s5">30</span><span class="s3">, </span><span class="s5">38</span><span class="s3">), (</span><span class="s5">42</span><span class="s3">, </span><span class="s5">53</span><span class="s3">), (</span><span class="s5">56</span><span class="s3">, </span><span class="s5">70</span><span class="s3">))</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_full_file_with_spaces_and_missing</span><span class="s3">():</span>
    <span class="s6"># File with spaces and missing values in columns.</span>
    <span class="s1">test </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
Account               Name    Balance     CreditLimit   AccountCreated 
101                           10000.00                       1/17/1998 
312     Gerard Butler         90.00       1000.00             8/6/2003 
868                                                          5/25/1985 
761     Jada Pinkett-Smith    49654.87    100000.00          12/5/2006 
317     Bill Murray           789.65 
&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">(</span>
        <span class="s4">&quot;</span><span class="s2">\r\n</span><span class="s4">&quot;</span>
    <span class="s3">)</span>
    <span class="s1">colspecs </span><span class="s3">= ((</span><span class="s5">0</span><span class="s3">, </span><span class="s5">7</span><span class="s3">), (</span><span class="s5">8</span><span class="s3">, </span><span class="s5">28</span><span class="s3">), (</span><span class="s5">30</span><span class="s3">, </span><span class="s5">38</span><span class="s3">), (</span><span class="s5">42</span><span class="s3">, </span><span class="s5">53</span><span class="s3">), (</span><span class="s5">56</span><span class="s3">, </span><span class="s5">70</span><span class="s3">))</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_messed_up_data</span><span class="s3">():</span>
    <span class="s6"># Completely messed up file.</span>
    <span class="s1">test </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
   Account          Name             Balance     Credit Limit   Account Created 
       101                           10000.00                       1/17/1998 
       312     Gerard Butler         90.00       1000.00 
 
       761     Jada Pinkett-Smith    49654.87    100000.00          12/5/2006 
  317          Bill Murray           789.65 
&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">(</span>
        <span class="s4">&quot;</span><span class="s2">\r\n</span><span class="s4">&quot;</span>
    <span class="s3">)</span>
    <span class="s1">colspecs </span><span class="s3">= ((</span><span class="s5">2</span><span class="s3">, </span><span class="s5">10</span><span class="s3">), (</span><span class="s5">15</span><span class="s3">, </span><span class="s5">33</span><span class="s3">), (</span><span class="s5">37</span><span class="s3">, </span><span class="s5">45</span><span class="s3">), (</span><span class="s5">49</span><span class="s3">, </span><span class="s5">61</span><span class="s3">), (</span><span class="s5">64</span><span class="s3">, </span><span class="s5">79</span><span class="s3">))</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_multiple_delimiters</span><span class="s3">():</span>
    <span class="s1">test </span><span class="s3">= </span><span class="s4">r&quot;&quot;&quot; 
col1~~~~~col2  col3++++++++++++++++++col4 
~~22.....11.0+++foo~~~~~~~~~~Keanu Reeves 
  33+++122.33\\\bar.........Gerard Butler 
++44~~~~12.01   baz~~Jennifer Love Hewitt 
~~55       11+++foo++++Jada Pinkett-Smith 
..66++++++.03~~~bar           Bill Murray 
&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">(</span>
        <span class="s4">&quot;</span><span class="s2">\r\n</span><span class="s4">&quot;</span>
    <span class="s3">)</span>
    <span class="s1">delimiter </span><span class="s3">= </span><span class="s4">&quot; +~.</span><span class="s2">\\</span><span class="s4">&quot;</span>
    <span class="s1">colspecs </span><span class="s3">= ((</span><span class="s5">0</span><span class="s3">, </span><span class="s5">4</span><span class="s3">), (</span><span class="s5">7</span><span class="s3">, </span><span class="s5">13</span><span class="s3">), (</span><span class="s5">15</span><span class="s3">, </span><span class="s5">19</span><span class="s3">), (</span><span class="s5">21</span><span class="s3">, </span><span class="s5">41</span><span class="s3">))</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s1">delimiter</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">test</span><span class="s3">), </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s1">delimiter</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_variable_width_unicode</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
שלום שלום 
ום   שלל 
של   ום 
&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">(</span>
        <span class="s4">&quot;</span><span class="s2">\r\n</span><span class="s4">&quot;</span>
    <span class="s3">)</span>
    <span class="s1">encoding </span><span class="s3">= </span><span class="s4">&quot;utf8&quot;</span>
    <span class="s1">kwargs </span><span class="s3">= {</span><span class="s4">&quot;header&quot;</span><span class="s3">: </span><span class="s2">None</span><span class="s3">, </span><span class="s4">&quot;encoding&quot;</span><span class="s3">: </span><span class="s1">encoding</span><span class="s3">}</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">BytesIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">.</span><span class="s1">encode</span><span class="s3">(</span><span class="s1">encoding</span><span class="s3">)), </span><span class="s1">colspecs</span><span class="s3">=[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">4</span><span class="s3">), (</span><span class="s5">5</span><span class="s3">, </span><span class="s5">9</span><span class="s3">)], **</span><span class="s1">kwargs</span>
    <span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">BytesIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">.</span><span class="s1">encode</span><span class="s3">(</span><span class="s1">encoding</span><span class="s3">)), **</span><span class="s1">kwargs</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dtype&quot;</span><span class="s3">, [{}, {</span><span class="s4">&quot;a&quot;</span><span class="s3">: </span><span class="s4">&quot;float64&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">: </span><span class="s4">&quot;int32&quot;</span><span class="s3">}])</span>
<span class="s2">def </span><span class="s1">test_dtype</span><span class="s3">(</span><span class="s1">dtype</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; a    b    c 
1    2    3.2 
3    4    5.2 
&quot;&quot;&quot;</span>
    <span class="s1">colspecs </span><span class="s3">= [(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">5</span><span class="s3">), (</span><span class="s5">5</span><span class="s3">, </span><span class="s5">10</span><span class="s3">), (</span><span class="s5">10</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)]</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">{</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">3</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: [</span><span class="s5">2</span><span class="s3">, </span><span class="s5">4</span><span class="s3">], </span><span class="s4">&quot;c&quot;</span><span class="s3">: [</span><span class="s5">3.2</span><span class="s3">, </span><span class="s5">5.2</span><span class="s3">]}, </span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">]</span>
    <span class="s3">)</span>

    <span class="s2">for </span><span class="s1">col</span><span class="s3">, </span><span class="s1">dt </span><span class="s2">in </span><span class="s1">dtype</span><span class="s3">.</span><span class="s1">items</span><span class="s3">():</span>
        <span class="s1">expected</span><span class="s3">[</span><span class="s1">col</span><span class="s3">] = </span><span class="s1">expected</span><span class="s3">[</span><span class="s1">col</span><span class="s3">].</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">dt</span><span class="s3">)</span>

    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_skiprows_inference</span><span class="s3">():</span>
    <span class="s6"># see gh-11256</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
Text contained in the file header 
 
DataCol1   DataCol2 
     0.0        1.0 
   101.6      956.1 
&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>
    <span class="s1">skiprows </span><span class="s3">= </span><span class="s5">2</span>

    <span class="s1">depr_msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' keyword in pd.read_csv is deprecated&quot;</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">):</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skiprows</span><span class="s3">=</span><span class="s1">skiprows</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skiprows</span><span class="s3">=</span><span class="s1">skiprows</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_skiprows_by_index_inference</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
To be skipped 
Not  To  Be  Skipped 
Once more to be skipped 
123  34   8      123 
456  78   9      456 
&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>
    <span class="s1">skiprows </span><span class="s3">= [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">]</span>

    <span class="s1">depr_msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' keyword in pd.read_csv is deprecated&quot;</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">):</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skiprows</span><span class="s3">=</span><span class="s1">skiprows</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skiprows</span><span class="s3">=</span><span class="s1">skiprows</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_skiprows_inference_empty</span><span class="s3">():</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
AA   BBB  C 
12   345  6 
78   901  2 
&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>

    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;No rows from which to infer column width&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">EmptyDataError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skiprows</span><span class="s3">=</span><span class="s5">3</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_whitespace_preservation</span><span class="s3">():</span>
    <span class="s6"># see gh-16772</span>
    <span class="s1">header </span><span class="s3">= </span><span class="s2">None</span>
    <span class="s1">csv_data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
 a ,bbb 
 cc,dd &quot;&quot;&quot;</span>

    <span class="s1">fwf_data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
 a bbb 
 ccdd &quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">fwf_data</span><span class="s3">), </span><span class="s1">widths</span><span class="s3">=[</span><span class="s5">3</span><span class="s3">, </span><span class="s5">3</span><span class="s3">], </span><span class="s1">header</span><span class="s3">=</span><span class="s1">header</span><span class="s3">, </span><span class="s1">skiprows</span><span class="s3">=[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s4">&quot;</span><span class="s2">\n\t</span><span class="s4">&quot;</span>
    <span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">csv_data</span><span class="s3">), </span><span class="s1">header</span><span class="s3">=</span><span class="s1">header</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_default_delimiter</span><span class="s3">():</span>
    <span class="s1">header </span><span class="s3">= </span><span class="s2">None</span>
    <span class="s1">csv_data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
a,bbb 
cc,dd&quot;&quot;&quot;</span>

    <span class="s1">fwf_data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
a </span><span class="s2">\t</span><span class="s4">bbb 
cc</span><span class="s2">\t</span><span class="s4">dd &quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">fwf_data</span><span class="s3">), </span><span class="s1">widths</span><span class="s3">=[</span><span class="s5">3</span><span class="s3">, </span><span class="s5">3</span><span class="s3">], </span><span class="s1">header</span><span class="s3">=</span><span class="s1">header</span><span class="s3">, </span><span class="s1">skiprows</span><span class="s3">=[</span><span class="s5">0</span><span class="s3">])</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">csv_data</span><span class="s3">), </span><span class="s1">header</span><span class="s3">=</span><span class="s1">header</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;infer&quot;</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_fwf_compression</span><span class="s3">(</span><span class="s1">compression_only</span><span class="s3">, </span><span class="s1">infer</span><span class="s3">, </span><span class="s1">compression_to_extension</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;1111111111 
    2222222222 
    3333333333&quot;&quot;&quot;</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">()</span>

    <span class="s1">compression </span><span class="s3">= </span><span class="s1">compression_only</span>
    <span class="s1">extension </span><span class="s3">= </span><span class="s1">compression_to_extension</span><span class="s3">[</span><span class="s1">compression</span><span class="s3">]</span>

    <span class="s1">kwargs </span><span class="s3">= {</span><span class="s4">&quot;widths&quot;</span><span class="s3">: [</span><span class="s5">5</span><span class="s3">, </span><span class="s5">5</span><span class="s3">], </span><span class="s4">&quot;names&quot;</span><span class="s3">: [</span><span class="s4">&quot;one&quot;</span><span class="s3">, </span><span class="s4">&quot;two&quot;</span><span class="s3">]}</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), **</span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s1">data </span><span class="s3">= </span><span class="s1">bytes</span><span class="s3">(</span><span class="s1">data</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s4">&quot;utf-8&quot;</span><span class="s3">)</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">ensure_clean</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">=</span><span class="s4">&quot;tmp.&quot; </span><span class="s3">+ </span><span class="s1">extension</span><span class="s3">) </span><span class="s2">as </span><span class="s1">path</span><span class="s3">:</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">write_to_compressed</span><span class="s3">(</span><span class="s1">compression</span><span class="s3">, </span><span class="s1">path</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">infer </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">kwargs</span><span class="s3">[</span><span class="s4">&quot;compression&quot;</span><span class="s3">] = </span><span class="s4">&quot;infer&quot; </span><span class="s2">if </span><span class="s1">infer </span><span class="s2">else </span><span class="s1">compression</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_binary_mode</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot; 
    read_fwf supports opening files in binary mode. 
 
    GH 18035. 
    &quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;aaa aaa aaa 
bba bab b a&quot;&quot;&quot;</span>
    <span class="s1">df_reference </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[[</span><span class="s4">&quot;bba&quot;</span><span class="s3">, </span><span class="s4">&quot;bab&quot;</span><span class="s3">, </span><span class="s4">&quot;b a&quot;</span><span class="s3">]], </span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;aaa&quot;</span><span class="s3">, </span><span class="s4">&quot;aaa.1&quot;</span><span class="s3">, </span><span class="s4">&quot;aaa.2&quot;</span><span class="s3">], </span><span class="s1">index</span><span class="s3">=[</span><span class="s5">0</span><span class="s3">]</span>
    <span class="s3">)</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">ensure_clean</span><span class="s3">() </span><span class="s2">as </span><span class="s1">path</span><span class="s3">:</span>
        <span class="s1">Path</span><span class="s3">(</span><span class="s1">path</span><span class="s3">).</span><span class="s1">write_text</span><span class="s3">(</span><span class="s1">data</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s4">&quot;utf-8&quot;</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">open</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s4">&quot;rb&quot;</span><span class="s3">) </span><span class="s2">as </span><span class="s1">file</span><span class="s3">:</span>
            <span class="s1">df </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
            <span class="s1">file</span><span class="s3">.</span><span class="s1">seek</span><span class="s3">(</span><span class="s5">0</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">df</span><span class="s3">, </span><span class="s1">df_reference</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;memory_map&quot;</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_encoding_mmap</span><span class="s3">(</span><span class="s1">memory_map</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    encoding should be working, even when using a memory-mapped file. 
 
    GH 23254. 
    &quot;&quot;&quot;</span>
    <span class="s1">encoding </span><span class="s3">= </span><span class="s4">&quot;iso8859_1&quot;</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">ensure_clean</span><span class="s3">() </span><span class="s2">as </span><span class="s1">path</span><span class="s3">:</span>
        <span class="s1">Path</span><span class="s3">(</span><span class="s1">path</span><span class="s3">).</span><span class="s1">write_bytes</span><span class="s3">(</span><span class="s4">&quot; 1 A Ä 2</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">.</span><span class="s1">encode</span><span class="s3">(</span><span class="s1">encoding</span><span class="s3">))</span>
        <span class="s1">df </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
            <span class="s1">path</span><span class="s3">,</span>
            <span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
            <span class="s1">widths</span><span class="s3">=[</span><span class="s5">2</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">2</span><span class="s3">],</span>
            <span class="s1">encoding</span><span class="s3">=</span><span class="s1">encoding</span><span class="s3">,</span>
            <span class="s1">memory_map</span><span class="s3">=</span><span class="s1">memory_map</span><span class="s3">,</span>
        <span class="s3">)</span>
    <span class="s1">df_reference </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([[</span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;Ä&quot;</span><span class="s3">, </span><span class="s5">2</span><span class="s3">]])</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">df</span><span class="s3">, </span><span class="s1">df_reference</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;colspecs, names, widths, index_col&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span>
            <span class="s3">[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">6</span><span class="s3">), (</span><span class="s5">6</span><span class="s3">, </span><span class="s5">12</span><span class="s3">), (</span><span class="s5">12</span><span class="s3">, </span><span class="s5">18</span><span class="s3">), (</span><span class="s5">18</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)],</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abcde&quot;</span><span class="s3">),</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s2">None</span><span class="s3">,</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abcde&quot;</span><span class="s3">),</span>
            <span class="s3">[</span><span class="s5">6</span><span class="s3">] * </span><span class="s5">4</span><span class="s3">,</span>
            <span class="s2">None</span><span class="s3">,</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s3">[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">6</span><span class="s3">), (</span><span class="s5">6</span><span class="s3">, </span><span class="s5">12</span><span class="s3">), (</span><span class="s5">12</span><span class="s3">, </span><span class="s5">18</span><span class="s3">), (</span><span class="s5">18</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)],</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abcde&quot;</span><span class="s3">),</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s2">True</span><span class="s3">,</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abcde&quot;</span><span class="s3">),</span>
            <span class="s3">[</span><span class="s5">6</span><span class="s3">] * </span><span class="s5">4</span><span class="s3">,</span>
            <span class="s2">False</span><span class="s3">,</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abcde&quot;</span><span class="s3">),</span>
            <span class="s3">[</span><span class="s5">6</span><span class="s3">] * </span><span class="s5">4</span><span class="s3">,</span>
            <span class="s2">True</span><span class="s3">,</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s3">[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">6</span><span class="s3">), (</span><span class="s5">6</span><span class="s3">, </span><span class="s5">12</span><span class="s3">), (</span><span class="s5">12</span><span class="s3">, </span><span class="s5">18</span><span class="s3">), (</span><span class="s5">18</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)],</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abcde&quot;</span><span class="s3">),</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s2">False</span><span class="s3">,</span>
        <span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_len_colspecs_len_names</span><span class="s3">(</span><span class="s1">colspecs</span><span class="s3">, </span><span class="s1">names</span><span class="s3">, </span><span class="s1">widths</span><span class="s3">, </span><span class="s1">index_col</span><span class="s3">):</span>
    <span class="s6"># GH#40830</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;col1  col2  col3  col4 
    bab   ba    2&quot;&quot;&quot;</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Length of colspecs must match length of names&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">read_fwf</span><span class="s3">(</span>
            <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
            <span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">,</span>
            <span class="s1">names</span><span class="s3">=</span><span class="s1">names</span><span class="s3">,</span>
            <span class="s1">widths</span><span class="s3">=</span><span class="s1">widths</span><span class="s3">,</span>
            <span class="s1">index_col</span><span class="s3">=</span><span class="s1">index_col</span><span class="s3">,</span>
        <span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;colspecs, names, widths, index_col, expected&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span>
            <span class="s3">[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">6</span><span class="s3">), (</span><span class="s5">6</span><span class="s3">, </span><span class="s5">12</span><span class="s3">), (</span><span class="s5">12</span><span class="s3">, </span><span class="s5">18</span><span class="s3">), (</span><span class="s5">18</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)],</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abc&quot;</span><span class="s3">),</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s5">0</span><span class="s3">,</span>
            <span class="s1">DataFrame</span><span class="s3">(</span>
                <span class="s1">index</span><span class="s3">=[</span><span class="s4">&quot;col1&quot;</span><span class="s3">, </span><span class="s4">&quot;ba&quot;</span><span class="s3">],</span>
                <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">],</span>
                <span class="s1">data</span><span class="s3">=[[</span><span class="s4">&quot;col2&quot;</span><span class="s3">, </span><span class="s4">&quot;col3&quot;</span><span class="s3">, </span><span class="s4">&quot;col4&quot;</span><span class="s3">], [</span><span class="s4">&quot;b   ba&quot;</span><span class="s3">, </span><span class="s4">&quot;2&quot;</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]],</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s3">[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">6</span><span class="s3">), (</span><span class="s5">6</span><span class="s3">, </span><span class="s5">12</span><span class="s3">), (</span><span class="s5">12</span><span class="s3">, </span><span class="s5">18</span><span class="s3">), (</span><span class="s5">18</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)],</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;ab&quot;</span><span class="s3">),</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s3">[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">],</span>
            <span class="s1">DataFrame</span><span class="s3">(</span>
                <span class="s1">index</span><span class="s3">=[[</span><span class="s4">&quot;col1&quot;</span><span class="s3">, </span><span class="s4">&quot;ba&quot;</span><span class="s3">], [</span><span class="s4">&quot;col2&quot;</span><span class="s3">, </span><span class="s4">&quot;b   ba&quot;</span><span class="s3">]],</span>
                <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">],</span>
                <span class="s1">data</span><span class="s3">=[[</span><span class="s4">&quot;col3&quot;</span><span class="s3">, </span><span class="s4">&quot;col4&quot;</span><span class="s3">], [</span><span class="s4">&quot;2&quot;</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]],</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s3">[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">6</span><span class="s3">), (</span><span class="s5">6</span><span class="s3">, </span><span class="s5">12</span><span class="s3">), (</span><span class="s5">12</span><span class="s3">, </span><span class="s5">18</span><span class="s3">), (</span><span class="s5">18</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)],</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;a&quot;</span><span class="s3">),</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s3">[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">],</span>
            <span class="s1">DataFrame</span><span class="s3">(</span>
                <span class="s1">index</span><span class="s3">=[[</span><span class="s4">&quot;col1&quot;</span><span class="s3">, </span><span class="s4">&quot;ba&quot;</span><span class="s3">], [</span><span class="s4">&quot;col2&quot;</span><span class="s3">, </span><span class="s4">&quot;b   ba&quot;</span><span class="s3">], [</span><span class="s4">&quot;col3&quot;</span><span class="s3">, </span><span class="s4">&quot;2&quot;</span><span class="s3">]],</span>
                <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">],</span>
                <span class="s1">data</span><span class="s3">=[[</span><span class="s4">&quot;col4&quot;</span><span class="s3">], [</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]],</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abc&quot;</span><span class="s3">),</span>
            <span class="s3">[</span><span class="s5">6</span><span class="s3">] * </span><span class="s5">4</span><span class="s3">,</span>
            <span class="s5">0</span><span class="s3">,</span>
            <span class="s1">DataFrame</span><span class="s3">(</span>
                <span class="s1">index</span><span class="s3">=[</span><span class="s4">&quot;col1&quot;</span><span class="s3">, </span><span class="s4">&quot;ba&quot;</span><span class="s3">],</span>
                <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">],</span>
                <span class="s1">data</span><span class="s3">=[[</span><span class="s4">&quot;col2&quot;</span><span class="s3">, </span><span class="s4">&quot;col3&quot;</span><span class="s3">, </span><span class="s4">&quot;col4&quot;</span><span class="s3">], [</span><span class="s4">&quot;b   ba&quot;</span><span class="s3">, </span><span class="s4">&quot;2&quot;</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]],</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;ab&quot;</span><span class="s3">),</span>
            <span class="s3">[</span><span class="s5">6</span><span class="s3">] * </span><span class="s5">4</span><span class="s3">,</span>
            <span class="s3">[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">],</span>
            <span class="s1">DataFrame</span><span class="s3">(</span>
                <span class="s1">index</span><span class="s3">=[[</span><span class="s4">&quot;col1&quot;</span><span class="s3">, </span><span class="s4">&quot;ba&quot;</span><span class="s3">], [</span><span class="s4">&quot;col2&quot;</span><span class="s3">, </span><span class="s4">&quot;b   ba&quot;</span><span class="s3">]],</span>
                <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">],</span>
                <span class="s1">data</span><span class="s3">=[[</span><span class="s4">&quot;col3&quot;</span><span class="s3">, </span><span class="s4">&quot;col4&quot;</span><span class="s3">], [</span><span class="s4">&quot;2&quot;</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]],</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;a&quot;</span><span class="s3">),</span>
            <span class="s3">[</span><span class="s5">6</span><span class="s3">] * </span><span class="s5">4</span><span class="s3">,</span>
            <span class="s3">[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">],</span>
            <span class="s1">DataFrame</span><span class="s3">(</span>
                <span class="s1">index</span><span class="s3">=[[</span><span class="s4">&quot;col1&quot;</span><span class="s3">, </span><span class="s4">&quot;ba&quot;</span><span class="s3">], [</span><span class="s4">&quot;col2&quot;</span><span class="s3">, </span><span class="s4">&quot;b   ba&quot;</span><span class="s3">], [</span><span class="s4">&quot;col3&quot;</span><span class="s3">, </span><span class="s4">&quot;2&quot;</span><span class="s3">]],</span>
                <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">],</span>
                <span class="s1">data</span><span class="s3">=[[</span><span class="s4">&quot;col4&quot;</span><span class="s3">], [</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]],</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_len_colspecs_len_names_with_index_col</span><span class="s3">(</span>
    <span class="s1">colspecs</span><span class="s3">, </span><span class="s1">names</span><span class="s3">, </span><span class="s1">widths</span><span class="s3">, </span><span class="s1">index_col</span><span class="s3">, </span><span class="s1">expected</span>
<span class="s3">):</span>
    <span class="s6"># GH#40830</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;col1  col2  col3  col4 
    bab   ba    2&quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
        <span class="s1">colspecs</span><span class="s3">=</span><span class="s1">colspecs</span><span class="s3">,</span>
        <span class="s1">names</span><span class="s3">=</span><span class="s1">names</span><span class="s3">,</span>
        <span class="s1">widths</span><span class="s3">=</span><span class="s1">widths</span><span class="s3">,</span>
        <span class="s1">index_col</span><span class="s3">=</span><span class="s1">index_col</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_colspecs_with_comment</span><span class="s3">():</span>
    <span class="s6"># GH 14135</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s4">&quot;#</span><span class="s2">\n</span><span class="s4">A1K</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">), </span><span class="s1">colspecs</span><span class="s3">=[(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">), (</span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">)], </span><span class="s1">comment</span><span class="s3">=</span><span class="s4">&quot;#&quot;</span><span class="s3">, </span><span class="s1">header</span><span class="s3">=</span><span class="s2">None</span>
    <span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([[</span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;K&quot;</span><span class="s3">]], </span><span class="s1">columns</span><span class="s3">=[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">])</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_skip_rows_and_n_rows</span><span class="s3">():</span>
    <span class="s6"># GH#44021</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;a</span><span class="s2">\t</span><span class="s4">b 
1</span><span class="s2">\t </span><span class="s4">a 
2</span><span class="s2">\t </span><span class="s4">b 
3</span><span class="s2">\t </span><span class="s4">c 
4</span><span class="s2">\t </span><span class="s4">d 
5</span><span class="s2">\t </span><span class="s4">e 
6</span><span class="s2">\t </span><span class="s4">f 
    &quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">nrows</span><span class="s3">=</span><span class="s5">4</span><span class="s3">, </span><span class="s1">skiprows</span><span class="s3">=[</span><span class="s5">2</span><span class="s3">, </span><span class="s5">4</span><span class="s3">])</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s5">5</span><span class="s3">, </span><span class="s5">6</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: [</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">, </span><span class="s4">&quot;e&quot;</span><span class="s3">, </span><span class="s4">&quot;f&quot;</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_skiprows_with_iterator</span><span class="s3">():</span>
    <span class="s6"># GH#10261, GH#56323</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;0 
1 
2 
3 
4 
5 
6 
7 
8 
9 
    &quot;&quot;&quot;</span>
    <span class="s1">df_iter </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
        <span class="s1">colspecs</span><span class="s3">=[(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">)],</span>
        <span class="s1">names</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">],</span>
        <span class="s1">iterator</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">chunksize</span><span class="s3">=</span><span class="s5">2</span><span class="s3">,</span>
        <span class="s1">skiprows</span><span class="s3">=[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">9</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">expected_frames </span><span class="s3">= [</span>
        <span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s5">3</span><span class="s3">, </span><span class="s5">4</span><span class="s3">]}),</span>
        <span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s5">5</span><span class="s3">, </span><span class="s5">7</span><span class="s3">]}, </span><span class="s1">index</span><span class="s3">=[</span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">]),</span>
        <span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s5">8</span><span class="s3">]}, </span><span class="s1">index</span><span class="s3">=[</span><span class="s5">4</span><span class="s3">]),</span>
    <span class="s3">]</span>
    <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">result </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">df_iter</span><span class="s3">):</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected_frames</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>


<span class="s2">def </span><span class="s1">test_names_and_infer_colspecs</span><span class="s3">():</span>
    <span class="s6"># GH#45337</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;X   Y   Z 
      959.0    345   22.2 
    &quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skiprows</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">usecols</span><span class="s3">=[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], </span><span class="s1">names</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">])</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s5">959.0</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: </span><span class="s5">22.2</span><span class="s3">})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_widths_and_usecols</span><span class="s3">():</span>
    <span class="s6"># GH#46580</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;0  1    n -0.4100.1 
0  2    p  0.2 90.1 
0  3    n -0.3140.4&quot;&quot;&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
        <span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">usecols</span><span class="s3">=(</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">3</span><span class="s3">),</span>
        <span class="s1">widths</span><span class="s3">=(</span><span class="s5">3</span><span class="s3">, </span><span class="s5">5</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">5</span><span class="s3">, </span><span class="s5">5</span><span class="s3">),</span>
        <span class="s1">index_col</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">names</span><span class="s3">=(</span><span class="s4">&quot;c0&quot;</span><span class="s3">, </span><span class="s4">&quot;c1&quot;</span><span class="s3">, </span><span class="s4">&quot;c3&quot;</span><span class="s3">),</span>
    <span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">{</span>
            <span class="s4">&quot;c0&quot;</span><span class="s3">: </span><span class="s5">0</span><span class="s3">,</span>
            <span class="s4">&quot;c1&quot;</span><span class="s3">: [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">],</span>
            <span class="s4">&quot;c3&quot;</span><span class="s3">: [-</span><span class="s5">0.4</span><span class="s3">, </span><span class="s5">0.2</span><span class="s3">, -</span><span class="s5">0.3</span><span class="s3">],</span>
        <span class="s3">}</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_dtype_backend</span><span class="s3">(</span><span class="s1">string_storage</span><span class="s3">, </span><span class="s1">dtype_backend</span><span class="s3">):</span>
    <span class="s6"># GH#50289</span>
    <span class="s2">if </span><span class="s1">string_storage </span><span class="s3">== </span><span class="s4">&quot;python&quot;</span><span class="s3">:</span>
        <span class="s1">arr </span><span class="s3">= </span><span class="s1">StringArray</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">object_</span><span class="s3">))</span>
        <span class="s1">arr_na </span><span class="s3">= </span><span class="s1">StringArray</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">NA</span><span class="s3">, </span><span class="s4">&quot;a&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">object_</span><span class="s3">))</span>
    <span class="s2">elif </span><span class="s1">dtype_backend </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">pa </span><span class="s3">= </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">importorskip</span><span class="s3">(</span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">)</span>
        <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">arrays </span><span class="s2">import </span><span class="s1">ArrowExtensionArray</span>

        <span class="s1">arr </span><span class="s3">= </span><span class="s1">ArrowExtensionArray</span><span class="s3">(</span><span class="s1">pa</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">]))</span>
        <span class="s1">arr_na </span><span class="s3">= </span><span class="s1">ArrowExtensionArray</span><span class="s3">(</span><span class="s1">pa</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">None</span><span class="s3">, </span><span class="s4">&quot;a&quot;</span><span class="s3">]))</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">pa </span><span class="s3">= </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">importorskip</span><span class="s3">(</span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">)</span>
        <span class="s1">arr </span><span class="s3">= </span><span class="s1">ArrowStringArray</span><span class="s3">(</span><span class="s1">pa</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">]))</span>
        <span class="s1">arr_na </span><span class="s3">= </span><span class="s1">ArrowStringArray</span><span class="s3">(</span><span class="s1">pa</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">None</span><span class="s3">, </span><span class="s4">&quot;a&quot;</span><span class="s3">]))</span>

    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;a  b    c      d  e     f  g    h  i 
1  2.5  True  a 
3  4.5  False b  True  6  7.5  a&quot;&quot;&quot;</span>
    <span class="s2">with </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">option_context</span><span class="s3">(</span><span class="s4">&quot;mode.string_storage&quot;</span><span class="s3">, </span><span class="s1">string_storage</span><span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">dtype_backend</span><span class="s3">=</span><span class="s1">dtype_backend</span><span class="s3">)</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">{</span>
            <span class="s4">&quot;a&quot;</span><span class="s3">: </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Series</span><span class="s3">([</span><span class="s5">1</span><span class="s3">, </span><span class="s5">3</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;Int64&quot;</span><span class="s3">),</span>
            <span class="s4">&quot;b&quot;</span><span class="s3">: </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Series</span><span class="s3">([</span><span class="s5">2.5</span><span class="s3">, </span><span class="s5">4.5</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;Float64&quot;</span><span class="s3">),</span>
            <span class="s4">&quot;c&quot;</span><span class="s3">: </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Series</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;boolean&quot;</span><span class="s3">),</span>
            <span class="s4">&quot;d&quot;</span><span class="s3">: </span><span class="s1">arr</span><span class="s3">,</span>
            <span class="s4">&quot;e&quot;</span><span class="s3">: </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Series</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">NA</span><span class="s3">, </span><span class="s2">True</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;boolean&quot;</span><span class="s3">),</span>
            <span class="s4">&quot;f&quot;</span><span class="s3">: </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Series</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">NA</span><span class="s3">, </span><span class="s5">6</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;Int64&quot;</span><span class="s3">),</span>
            <span class="s4">&quot;g&quot;</span><span class="s3">: </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Series</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">NA</span><span class="s3">, </span><span class="s5">7.5</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;Float64&quot;</span><span class="s3">),</span>
            <span class="s4">&quot;h&quot;</span><span class="s3">: </span><span class="s1">arr_na</span><span class="s3">,</span>
            <span class="s4">&quot;i&quot;</span><span class="s3">: </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Series</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">NA</span><span class="s3">, </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">NA</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;Int64&quot;</span><span class="s3">),</span>
        <span class="s3">}</span>
    <span class="s3">)</span>
    <span class="s2">if </span><span class="s1">dtype_backend </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">pa </span><span class="s3">= </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">importorskip</span><span class="s3">(</span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">)</span>
        <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">arrays </span><span class="s2">import </span><span class="s1">ArrowExtensionArray</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
            <span class="s3">{</span>
                <span class="s1">col</span><span class="s3">: </span><span class="s1">ArrowExtensionArray</span><span class="s3">(</span><span class="s1">pa</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">[</span><span class="s1">col</span><span class="s3">], </span><span class="s1">from_pandas</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
                <span class="s2">for </span><span class="s1">col </span><span class="s2">in </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">columns</span>
            <span class="s3">}</span>
        <span class="s3">)</span>
        <span class="s1">expected</span><span class="s3">[</span><span class="s4">&quot;i&quot;</span><span class="s3">] = </span><span class="s1">ArrowExtensionArray</span><span class="s3">(</span><span class="s1">pa</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">None</span><span class="s3">, </span><span class="s2">None</span><span class="s3">]))</span>

    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_invalid_dtype_backend</span><span class="s3">():</span>
    <span class="s1">msg </span><span class="s3">= (</span>
        <span class="s4">&quot;dtype_backend numpy is invalid, only 'numpy_nullable' and &quot;</span>
        <span class="s4">&quot;'pyarrow' are allowed.&quot;</span>
    <span class="s3">)</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">read_fwf</span><span class="s3">(</span><span class="s4">&quot;test&quot;</span><span class="s3">, </span><span class="s1">dtype_backend</span><span class="s3">=</span><span class="s4">&quot;numpy&quot;</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">network</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">single_cpu</span>
<span class="s2">def </span><span class="s1">test_url_urlopen</span><span class="s3">(</span><span class="s1">httpserver</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A         B            C            D 
201158    360.242940   149.910199   11950.7 
201159    444.953632   166.985655   11788.4 
201160    364.136849   183.628767   11806.2 
201161    413.836124   184.375703   11916.8 
201162    502.953953   173.237159   12468.3 
&quot;&quot;&quot;</span>
    <span class="s1">httpserver</span><span class="s3">.</span><span class="s1">serve_content</span><span class="s3">(</span><span class="s1">content</span><span class="s3">=</span><span class="s1">data</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Index</span><span class="s3">(</span><span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;ABCD&quot;</span><span class="s3">))</span>
    <span class="s2">with </span><span class="s1">urlopen</span><span class="s3">(</span><span class="s1">httpserver</span><span class="s3">.</span><span class="s1">url</span><span class="s3">) </span><span class="s2">as </span><span class="s1">f</span><span class="s3">:</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">read_fwf</span><span class="s3">(</span><span class="s1">f</span><span class="s3">).</span><span class="s1">columns</span>

    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
</pre>
</body>
</html>