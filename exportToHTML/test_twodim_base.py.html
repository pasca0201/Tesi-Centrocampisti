<html>
<head>
<title>test_twodim_base.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
.s6 { color: #7a7e85;}
.s7 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_twodim_base.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Test functions for matrix module 
 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">testing </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">assert_equal</span><span class="s3">, </span><span class="s1">assert_array_equal</span><span class="s3">, </span><span class="s1">assert_array_max_ulp</span><span class="s3">,</span>
    <span class="s1">assert_array_almost_equal</span><span class="s3">, </span><span class="s1">assert_raises</span><span class="s3">, </span><span class="s1">assert_</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">numpy </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">arange</span><span class="s3">, </span><span class="s1">add</span><span class="s3">, </span><span class="s1">fliplr</span><span class="s3">, </span><span class="s1">flipud</span><span class="s3">, </span><span class="s1">zeros</span><span class="s3">, </span><span class="s1">ones</span><span class="s3">, </span><span class="s1">eye</span><span class="s3">, </span><span class="s1">array</span><span class="s3">, </span><span class="s1">diag</span><span class="s3">, </span><span class="s1">histogram2d</span><span class="s3">,</span>
    <span class="s1">tri</span><span class="s3">, </span><span class="s1">mask_indices</span><span class="s3">, </span><span class="s1">triu_indices</span><span class="s3">, </span><span class="s1">triu_indices_from</span><span class="s3">, </span><span class="s1">tril_indices</span><span class="s3">,</span>
    <span class="s1">tril_indices_from</span><span class="s3">, </span><span class="s1">vander</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>

<span class="s2">import </span><span class="s1">pytest</span>


<span class="s2">def </span><span class="s1">get_mat</span><span class="s3">(</span><span class="s1">n</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s1">arange</span><span class="s3">(</span><span class="s1">n</span><span class="s3">)</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s1">add</span><span class="s3">.</span><span class="s1">outer</span><span class="s3">(</span><span class="s1">data</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">data</span>


<span class="s2">class </span><span class="s1">TestEye</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_basic</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">4</span><span class="s3">),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]]))</span>

        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">'f'</span><span class="s3">),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]], </span><span class="s5">'f'</span><span class="s3">))</span>

        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">) == </span><span class="s4">1</span><span class="s3">,</span>
                     <span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">bool</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_uint64</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># Regression test for gh-9982</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">uint64</span><span class="s3">(</span><span class="s4">2</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">int</span><span class="s3">), </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]]))</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">uint64</span><span class="s3">(</span><span class="s4">2</span><span class="s3">), </span><span class="s1">M</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">uint64</span><span class="s3">(</span><span class="s4">4</span><span class="s3">), </span><span class="s1">k</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">uint64</span><span class="s3">(</span><span class="s4">1</span><span class="s3">)),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]))</span>

    <span class="s2">def </span><span class="s1">test_diag</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]))</span>

        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=-</span><span class="s4">1</span><span class="s3">),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]))</span>

    <span class="s2">def </span><span class="s1">test_2d</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]))</span>

        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]))</span>

    <span class="s2">def </span><span class="s1">test_diag2d</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">2</span><span class="s3">),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]))</span>

        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=-</span><span class="s4">2</span><span class="s3">),</span>
                     <span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]))</span>

    <span class="s2">def </span><span class="s1">test_eye_bounds</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, -</span><span class="s4">2</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, -</span><span class="s4">2</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, -</span><span class="s4">3</span><span class="s3">), [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>

    <span class="s2">def </span><span class="s1">test_strings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">'S3'</span><span class="s3">),</span>
                     <span class="s3">[[</span><span class="s7">b'1'</span><span class="s3">, </span><span class="s7">b''</span><span class="s3">], [</span><span class="s7">b''</span><span class="s3">, </span><span class="s7">b'1'</span><span class="s3">]])</span>

    <span class="s2">def </span><span class="s1">test_bool</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">eye</span><span class="s3">(</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">bool</span><span class="s3">), [[</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">], [</span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">]])</span>

    <span class="s2">def </span><span class="s1">test_order</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">mat_c </span><span class="s3">= </span><span class="s1">eye</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=-</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">mat_f </span><span class="s3">= </span><span class="s1">eye</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">order</span><span class="s3">=</span><span class="s5">'F'</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">mat_c</span><span class="s3">, </span><span class="s1">mat_f</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">mat_c</span><span class="s3">.</span><span class="s1">flags</span><span class="s3">.</span><span class="s1">c_contiguous</span>
        <span class="s2">assert not </span><span class="s1">mat_c</span><span class="s3">.</span><span class="s1">flags</span><span class="s3">.</span><span class="s1">f_contiguous</span>
        <span class="s2">assert not </span><span class="s1">mat_f</span><span class="s3">.</span><span class="s1">flags</span><span class="s3">.</span><span class="s1">c_contiguous</span>
        <span class="s2">assert </span><span class="s1">mat_f</span><span class="s3">.</span><span class="s1">flags</span><span class="s3">.</span><span class="s1">f_contiguous</span>


<span class="s2">class </span><span class="s1">TestDiag</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_vector</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">vals </span><span class="s3">= (</span><span class="s4">100 </span><span class="s3">* </span><span class="s1">arange</span><span class="s3">(</span><span class="s4">5</span><span class="s3">)).</span><span class="s1">astype</span><span class="s3">(</span><span class="s5">'l'</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">))</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">5</span><span class="s3">):</span>
            <span class="s1">b</span><span class="s3">[</span><span class="s1">k</span><span class="s3">, </span><span class="s1">k</span><span class="s3">] = </span><span class="s1">vals</span><span class="s3">[</span><span class="s1">k</span><span class="s3">]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">), </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">7</span><span class="s3">, </span><span class="s4">7</span><span class="s3">))</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">b</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">5</span><span class="s3">):</span>
            <span class="s1">b</span><span class="s3">[</span><span class="s1">k</span><span class="s3">, </span><span class="s1">k </span><span class="s3">+ </span><span class="s4">2</span><span class="s3">] = </span><span class="s1">vals</span><span class="s3">[</span><span class="s1">k</span><span class="s3">]</span>
            <span class="s1">c</span><span class="s3">[</span><span class="s1">k </span><span class="s3">+ </span><span class="s4">2</span><span class="s3">, </span><span class="s1">k</span><span class="s3">] = </span><span class="s1">vals</span><span class="s3">[</span><span class="s1">k</span><span class="s3">]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">2</span><span class="s3">), </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=-</span><span class="s4">2</span><span class="s3">), </span><span class="s1">c</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_matrix</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">vals</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">vals </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">vals </span><span class="s3">= (</span><span class="s4">100 </span><span class="s3">* </span><span class="s1">get_mat</span><span class="s3">(</span><span class="s4">5</span><span class="s3">) + </span><span class="s4">1</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s5">'l'</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">5</span><span class="s3">,))</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">5</span><span class="s3">):</span>
            <span class="s1">b</span><span class="s3">[</span><span class="s1">k</span><span class="s3">] = </span><span class="s1">vals</span><span class="s3">[</span><span class="s1">k</span><span class="s3">, </span><span class="s1">k</span><span class="s3">]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">), </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">b </span><span class="s3">* </span><span class="s4">0</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">3</span><span class="s3">):</span>
            <span class="s1">b</span><span class="s3">[</span><span class="s1">k</span><span class="s3">] = </span><span class="s1">vals</span><span class="s3">[</span><span class="s1">k</span><span class="s3">, </span><span class="s1">k </span><span class="s3">+ </span><span class="s4">2</span><span class="s3">]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">, </span><span class="s4">2</span><span class="s3">), </span><span class="s1">b</span><span class="s3">[:</span><span class="s4">3</span><span class="s3">])</span>
        <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">3</span><span class="s3">):</span>
            <span class="s1">b</span><span class="s3">[</span><span class="s1">k</span><span class="s3">] = </span><span class="s1">vals</span><span class="s3">[</span><span class="s1">k </span><span class="s3">+ </span><span class="s4">2</span><span class="s3">, </span><span class="s1">k</span><span class="s3">]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">, -</span><span class="s4">2</span><span class="s3">), </span><span class="s1">b</span><span class="s3">[:</span><span class="s4">3</span><span class="s3">])</span>

    <span class="s2">def </span><span class="s1">test_fortran_order</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">vals </span><span class="s3">= </span><span class="s1">array</span><span class="s3">((</span><span class="s4">100 </span><span class="s3">* </span><span class="s1">get_mat</span><span class="s3">(</span><span class="s4">5</span><span class="s3">) + </span><span class="s4">1</span><span class="s3">), </span><span class="s1">order</span><span class="s3">=</span><span class="s5">'F'</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">'l'</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">test_matrix</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_diag_bounds</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">A </span><span class="s3">= [[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], [</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">], [</span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">]]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">A</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">2</span><span class="s3">), [])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">A</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">1</span><span class="s3">), [</span><span class="s4">2</span><span class="s3">])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">A</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">0</span><span class="s3">), [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">4</span><span class="s3">])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">A</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=-</span><span class="s4">1</span><span class="s3">), [</span><span class="s4">3</span><span class="s3">, </span><span class="s4">6</span><span class="s3">])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">A</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=-</span><span class="s4">2</span><span class="s3">), [</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">diag</span><span class="s3">(</span><span class="s1">A</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=-</span><span class="s4">3</span><span class="s3">), [])</span>

    <span class="s2">def </span><span class="s1">test_failure</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">diag</span><span class="s3">, [[[</span><span class="s4">1</span><span class="s3">]]])</span>


<span class="s2">class </span><span class="s1">TestFliplr</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_basic</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">fliplr</span><span class="s3">, </span><span class="s1">ones</span><span class="s3">(</span><span class="s4">4</span><span class="s3">))</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">get_mat</span><span class="s3">(</span><span class="s4">4</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[:, ::-</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">fliplr</span><span class="s3">(</span><span class="s1">a</span><span class="s3">), </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">a </span><span class="s3">= [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">]]</span>
        <span class="s1">b </span><span class="s3">= [[</span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">5</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">]]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">fliplr</span><span class="s3">(</span><span class="s1">a</span><span class="s3">), </span><span class="s1">b</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestFlipud</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_basic</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">get_mat</span><span class="s3">(</span><span class="s4">4</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[::-</span><span class="s4">1</span><span class="s3">, :]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">flipud</span><span class="s3">(</span><span class="s1">a</span><span class="s3">), </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">a </span><span class="s3">= [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">]]</span>
        <span class="s1">b </span><span class="s3">= [[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">]]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">flipud</span><span class="s3">(</span><span class="s1">a</span><span class="s3">), </span><span class="s1">b</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestHistogram2d</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_simple</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">0.41702200</span><span class="s3">, </span><span class="s4">0.72032449</span><span class="s3">, </span><span class="s4">1.1437481e-4</span><span class="s3">, </span><span class="s4">0.302332573</span><span class="s3">, </span><span class="s4">0.146755891</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">0.09233859</span><span class="s3">, </span><span class="s4">0.18626021</span><span class="s3">, </span><span class="s4">0.34556073</span><span class="s3">, </span><span class="s4">0.39676747</span><span class="s3">, </span><span class="s4">0.53881673</span><span class="s3">])</span>
        <span class="s1">xedges </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">)</span>
        <span class="s1">yedges </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">)</span>
        <span class="s1">H </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, (</span><span class="s1">xedges</span><span class="s3">, </span><span class="s1">yedges</span><span class="s3">))[</span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">answer </span><span class="s3">= </span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">.</span><span class="s1">T</span><span class="s3">, </span><span class="s1">answer</span><span class="s3">)</span>
        <span class="s1">H </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">xedges</span><span class="s3">)[</span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">.</span><span class="s1">T</span><span class="s3">, </span><span class="s1">answer</span><span class="s3">)</span>
        <span class="s1">H</span><span class="s3">, </span><span class="s1">xedges</span><span class="s3">, </span><span class="s1">yedges </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">list</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">)), </span><span class="s1">list</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">)))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">, </span><span class="s1">eye</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">10</span><span class="s3">))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">xedges</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">11</span><span class="s3">))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">yedges</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">11</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_asym</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">])</span>
        <span class="s1">H</span><span class="s3">, </span><span class="s1">xed</span><span class="s3">, </span><span class="s1">yed </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span>
            <span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, (</span><span class="s4">6</span><span class="s3">, </span><span class="s4">5</span><span class="s3">), </span><span class="s1">range</span><span class="s3">=[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">6</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">5</span><span class="s3">]], </span><span class="s1">density</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">answer </span><span class="s3">= </span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">, </span><span class="s1">answer</span><span class="s3">/</span><span class="s4">8.</span><span class="s3">, </span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">xed</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">yed</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_density</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">H</span><span class="s3">, </span><span class="s1">xed</span><span class="s3">, </span><span class="s1">yed </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span>
            <span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, [[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">]], </span><span class="s1">density</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">answer </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">.5</span><span class="s3">],</span>
                        <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">.5</span><span class="s3">],</span>
                        <span class="s3">[</span><span class="s4">.5</span><span class="s3">, </span><span class="s4">.5</span><span class="s3">, </span><span class="s4">.25</span><span class="s3">]])/</span><span class="s4">9.</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">, </span><span class="s1">answer</span><span class="s3">, </span><span class="s4">3</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_all_outliers</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">rand</span><span class="s3">(</span><span class="s4">100</span><span class="s3">) + </span><span class="s4">1. </span><span class="s3">+ </span><span class="s4">1e6  </span><span class="s6"># histogramdd rounds by decimal=6</span>
        <span class="s1">H</span><span class="s3">, </span><span class="s1">xed</span><span class="s3">, </span><span class="s1">yed </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, (</span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">), </span><span class="s1">range</span><span class="s3">=([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">, </span><span class="s4">0</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_empty</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">a</span><span class="s3">, </span><span class="s1">edge1</span><span class="s3">, </span><span class="s1">edge2 </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">([], [], </span><span class="s1">bins</span><span class="s3">=([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]))</span>
        <span class="s1">assert_array_max_ulp</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.</span><span class="s3">]]))</span>

        <span class="s1">a</span><span class="s3">, </span><span class="s1">edge1</span><span class="s3">, </span><span class="s1">edge2 </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">([], [], </span><span class="s1">bins</span><span class="s3">=</span><span class="s4">4</span><span class="s3">)</span>
        <span class="s1">assert_array_max_ulp</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">4</span><span class="s3">, </span><span class="s4">4</span><span class="s3">)))</span>

    <span class="s2">def </span><span class="s1">test_binparameter_combination</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0.09207008</span><span class="s3">, </span><span class="s4">0.64575234</span><span class="s3">, </span><span class="s4">0.12875982</span><span class="s3">, </span><span class="s4">0.47390599</span><span class="s3">,</span>
             <span class="s4">0.59944483</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0.14344267</span><span class="s3">, </span><span class="s4">0.48988575</span><span class="s3">, </span><span class="s4">0.30558665</span><span class="s3">, </span><span class="s4">0.44700682</span><span class="s3">,</span>
             <span class="s4">0.15886423</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">edges </span><span class="s3">= (</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.2</span><span class="s3">, </span><span class="s4">0.3</span><span class="s3">, </span><span class="s4">0.4</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">, </span><span class="s4">0.7</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">H</span><span class="s3">, </span><span class="s1">xe</span><span class="s3">, </span><span class="s1">ye </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, (</span><span class="s1">edges</span><span class="s3">, </span><span class="s4">4</span><span class="s3">))</span>
        <span class="s1">answer </span><span class="s3">= </span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[[</span><span class="s4">2.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">]])</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">, </span><span class="s1">answer</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">ye</span><span class="s3">, </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.25</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.75</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]))</span>
        <span class="s1">H</span><span class="s3">, </span><span class="s1">xe</span><span class="s3">, </span><span class="s1">ye </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, (</span><span class="s4">4</span><span class="s3">, </span><span class="s1">edges</span><span class="s3">))</span>
        <span class="s1">answer </span><span class="s3">= </span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[[</span><span class="s4">1.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">],</span>
             <span class="s3">[</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">]])</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">, </span><span class="s1">answer</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">xe</span><span class="s3">, </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.25</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.75</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]))</span>

    <span class="s2">def </span><span class="s1">test_dispatch</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">class </span><span class="s1">ShouldDispatch</span><span class="s3">:</span>
            <span class="s2">def </span><span class="s1">__array_function__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">function</span><span class="s3">, </span><span class="s1">types</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">types</span><span class="s3">, </span><span class="s1">args</span><span class="s3">, </span><span class="s1">kwargs</span>

        <span class="s1">xy </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">]</span>
        <span class="s1">s_d </span><span class="s3">= </span><span class="s1">ShouldDispatch</span><span class="s3">()</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">s_d</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">)</span>
        <span class="s6"># Cannot use assert_equal since that dispatches...</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">r </span><span class="s3">== ((</span><span class="s1">ShouldDispatch</span><span class="s3">,), (</span><span class="s1">s_d</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">), {}))</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">xy</span><span class="s3">, </span><span class="s1">s_d</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">r </span><span class="s3">== ((</span><span class="s1">ShouldDispatch</span><span class="s3">,), (</span><span class="s1">xy</span><span class="s3">, </span><span class="s1">s_d</span><span class="s3">), {}))</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">xy</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">, </span><span class="s1">bins</span><span class="s3">=</span><span class="s1">s_d</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, ((</span><span class="s1">ShouldDispatch</span><span class="s3">,), (</span><span class="s1">xy</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">), </span><span class="s1">dict</span><span class="s3">(</span><span class="s1">bins</span><span class="s3">=</span><span class="s1">s_d</span><span class="s3">)))</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">xy</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">, </span><span class="s1">bins</span><span class="s3">=[</span><span class="s1">s_d</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, ((</span><span class="s1">ShouldDispatch</span><span class="s3">,), (</span><span class="s1">xy</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">), </span><span class="s1">dict</span><span class="s3">(</span><span class="s1">bins</span><span class="s3">=[</span><span class="s1">s_d</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])))</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">Exception</span><span class="s3">, </span><span class="s1">histogram2d</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">, </span><span class="s1">bins</span><span class="s3">=[</span><span class="s1">s_d</span><span class="s3">])</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">xy</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">, </span><span class="s1">weights</span><span class="s3">=</span><span class="s1">s_d</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">r</span><span class="s3">, ((</span><span class="s1">ShouldDispatch</span><span class="s3">,), (</span><span class="s1">xy</span><span class="s3">, </span><span class="s1">xy</span><span class="s3">), </span><span class="s1">dict</span><span class="s3">(</span><span class="s1">weights</span><span class="s3">=</span><span class="s1">s_d</span><span class="s3">)))</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">((</span><span class="s5">&quot;x_len&quot;</span><span class="s3">, </span><span class="s5">&quot;y_len&quot;</span><span class="s3">), [(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">11</span><span class="s3">), (</span><span class="s4">20</span><span class="s3">, </span><span class="s4">19</span><span class="s3">)])</span>
    <span class="s2">def </span><span class="s1">test_bad_length</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">x_len</span><span class="s3">, </span><span class="s1">y_len</span><span class="s3">):</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">(</span><span class="s1">x_len</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">(</span><span class="s1">y_len</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">,</span>
                           <span class="s1">match</span><span class="s3">=</span><span class="s5">'x and y must have the same length.'</span><span class="s3">):</span>
            <span class="s1">histogram2d</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestTri</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_dtype</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">out </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                     <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                     <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">tri</span><span class="s3">(</span><span class="s4">3</span><span class="s3">), </span><span class="s1">out</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">tri</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">bool</span><span class="s3">), </span><span class="s1">out</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">bool</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">test_tril_triu_ndim2</span><span class="s3">():</span>
    <span class="s2">for </span><span class="s1">dtype </span><span class="s2">in </span><span class="s1">np</span><span class="s3">.</span><span class="s1">typecodes</span><span class="s3">[</span><span class="s5">'AllFloat'</span><span class="s3">] + </span><span class="s1">np</span><span class="s3">.</span><span class="s1">typecodes</span><span class="s3">[</span><span class="s5">'AllInteger'</span><span class="s3">]:</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">tril</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">triu</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">b</span><span class="s3">, [[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">b</span><span class="s3">.</span><span class="s1">T</span><span class="s3">)</span>
        <span class="s6"># should return the same dtype as the original array</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">b</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">a</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">a</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_tril_triu_ndim3</span><span class="s3">():</span>
    <span class="s2">for </span><span class="s1">dtype </span><span class="s2">in </span><span class="s1">np</span><span class="s3">.</span><span class="s1">typecodes</span><span class="s3">[</span><span class="s5">'AllFloat'</span><span class="s3">] + </span><span class="s1">np</span><span class="s3">.</span><span class="s1">typecodes</span><span class="s3">[</span><span class="s5">'AllInteger'</span><span class="s3">]:</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]],</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]],</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]],</span>
            <span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">a_tril_desired </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]],</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]],</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]],</span>
            <span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">a_triu_desired </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]],</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]],</span>
            <span class="s3">[[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]],</span>
            <span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">a_triu_observed </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">triu</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>
        <span class="s1">a_tril_observed </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">tril</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a_triu_observed</span><span class="s3">, </span><span class="s1">a_triu_desired</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a_tril_observed</span><span class="s3">, </span><span class="s1">a_tril_desired</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">a_triu_observed</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">a</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">a_tril_observed</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">a</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_tril_triu_with_inf</span><span class="s3">():</span>
    <span class="s6"># Issue 4859</span>
    <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">inf</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">inf</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
    <span class="s1">out_tril </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                         <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                         <span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">inf</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
    <span class="s1">out_triu </span><span class="s3">= </span><span class="s1">out_tril</span><span class="s3">.</span><span class="s1">T</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">triu</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">), </span><span class="s1">out_triu</span><span class="s3">)</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">tril</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">), </span><span class="s1">out_tril</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_tril_triu_dtype</span><span class="s3">():</span>
    <span class="s6"># Issue 4916</span>
    <span class="s6"># tril and triu should return the same dtype as input</span>
    <span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">np</span><span class="s3">.</span><span class="s1">typecodes</span><span class="s3">[</span><span class="s5">'All'</span><span class="s3">]:</span>
        <span class="s2">if </span><span class="s1">c </span><span class="s3">== </span><span class="s5">'V'</span><span class="s3">:</span>
            <span class="s2">continue</span>
        <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">triu</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">).</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">arr</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">tril</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">).</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">arr</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>

    <span class="s6"># check special cases</span>
    <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s5">'2001-01-01T12:00'</span><span class="s3">, </span><span class="s5">'2002-02-03T13:56'</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s5">'2004-01-01T12:00'</span><span class="s3">, </span><span class="s5">'2003-01-03T13:45'</span><span class="s3">]],</span>
                   <span class="s1">dtype</span><span class="s3">=</span><span class="s5">'datetime64'</span><span class="s3">)</span>
    <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">triu</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">).</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">arr</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>
    <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">tril</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">).</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">arr</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>

    <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">'f4,f4'</span><span class="s3">)</span>
    <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">triu</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">).</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">arr</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>
    <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">tril</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">).</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">arr</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_mask_indices</span><span class="s3">():</span>
    <span class="s6"># simple test without offset</span>
    <span class="s1">iu </span><span class="s3">= </span><span class="s1">mask_indices</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">triu</span><span class="s3">)</span>
    <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">9</span><span class="s3">).</span><span class="s1">reshape</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">)</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">[</span><span class="s1">iu</span><span class="s3">], </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">8</span><span class="s3">]))</span>
    <span class="s6"># Now with an offset</span>
    <span class="s1">iu1 </span><span class="s3">= </span><span class="s1">mask_indices</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">triu</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">[</span><span class="s1">iu1</span><span class="s3">], </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">]))</span>


<span class="s2">def </span><span class="s1">test_tril_indices</span><span class="s3">():</span>
    <span class="s6"># indices without and with offset</span>
    <span class="s1">il1 </span><span class="s3">= </span><span class="s1">tril_indices</span><span class="s3">(</span><span class="s4">4</span><span class="s3">)</span>
    <span class="s1">il2 </span><span class="s3">= </span><span class="s1">tril_indices</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">2</span><span class="s3">)</span>
    <span class="s1">il3 </span><span class="s3">= </span><span class="s1">tril_indices</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">m</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)</span>
    <span class="s1">il4 </span><span class="s3">= </span><span class="s1">tril_indices</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">m</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)</span>

    <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">],</span>
                  <span class="s3">[</span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s3">],</span>
                  <span class="s3">[</span><span class="s4">9</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">],</span>
                  <span class="s3">[</span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s3">, </span><span class="s4">15</span><span class="s3">, </span><span class="s4">16</span><span class="s3">]])</span>
    <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">21</span><span class="s3">).</span><span class="s1">reshape</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">)</span>

    <span class="s6"># indexing:</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">[</span><span class="s1">il1</span><span class="s3">],</span>
                       <span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s3">, </span><span class="s4">15</span><span class="s3">, </span><span class="s4">16</span><span class="s3">]))</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">b</span><span class="s3">[</span><span class="s1">il3</span><span class="s3">],</span>
                       <span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">16</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, </span><span class="s4">19</span><span class="s3">]))</span>

    <span class="s6"># And for assigning values:</span>
    <span class="s1">a</span><span class="s3">[</span><span class="s1">il1</span><span class="s3">] = -</span><span class="s4">1</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">,</span>
                       <span class="s1">array</span><span class="s3">([[-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">12</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">]]))</span>
    <span class="s1">b</span><span class="s3">[</span><span class="s1">il3</span><span class="s3">] = -</span><span class="s4">1</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">b</span><span class="s3">,</span>
                       <span class="s1">array</span><span class="s3">([[-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">10</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">14</span><span class="s3">, </span><span class="s4">15</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">20</span><span class="s3">]]))</span>
    <span class="s6"># These cover almost the whole array (two diagonals right of the main one):</span>
    <span class="s1">a</span><span class="s3">[</span><span class="s1">il2</span><span class="s3">] = -</span><span class="s4">10</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">,</span>
                       <span class="s1">array</span><span class="s3">([[-</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, </span><span class="s4">4</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">]]))</span>
    <span class="s1">b</span><span class="s3">[</span><span class="s1">il4</span><span class="s3">] = -</span><span class="s4">10</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">b</span><span class="s3">,</span>
                       <span class="s1">array</span><span class="s3">([[-</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, </span><span class="s4">10</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">],</span>
                              <span class="s3">[-</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">]]))</span>


<span class="s2">class </span><span class="s1">TestTriuIndices</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_triu_indices</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">iu1 </span><span class="s3">= </span><span class="s1">triu_indices</span><span class="s3">(</span><span class="s4">4</span><span class="s3">)</span>
        <span class="s1">iu2 </span><span class="s3">= </span><span class="s1">triu_indices</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">iu3 </span><span class="s3">= </span><span class="s1">triu_indices</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">m</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)</span>
        <span class="s1">iu4 </span><span class="s3">= </span><span class="s1">triu_indices</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">m</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)</span>

        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">9</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s3">, </span><span class="s4">15</span><span class="s3">, </span><span class="s4">16</span><span class="s3">]])</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">21</span><span class="s3">).</span><span class="s1">reshape</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">)</span>

        <span class="s6"># Both for indexing:</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">[</span><span class="s1">iu1</span><span class="s3">],</span>
                           <span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">16</span><span class="s3">]))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">b</span><span class="s3">[</span><span class="s1">iu3</span><span class="s3">],</span>
                           <span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">9</span><span class="s3">,</span>
                                  <span class="s4">10</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s3">, </span><span class="s4">15</span><span class="s3">, </span><span class="s4">19</span><span class="s3">, </span><span class="s4">20</span><span class="s3">]))</span>

        <span class="s6"># And for assigning values:</span>
        <span class="s1">a</span><span class="s3">[</span><span class="s1">iu1</span><span class="s3">] = -</span><span class="s4">1</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">,</span>
                           <span class="s1">array</span><span class="s3">([[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">5</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">9</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s3">, </span><span class="s4">15</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">]]))</span>
        <span class="s1">b</span><span class="s3">[</span><span class="s1">iu3</span><span class="s3">] = -</span><span class="s4">1</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">b</span><span class="s3">,</span>
                           <span class="s1">array</span><span class="s3">([[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">6</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">16</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">]]))</span>

        <span class="s6"># These cover almost the whole array (two diagonals right of the</span>
        <span class="s6"># main one):</span>
        <span class="s1">a</span><span class="s3">[</span><span class="s1">iu2</span><span class="s3">] = -</span><span class="s4">10</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">,</span>
                           <span class="s1">array</span><span class="s3">([[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">5</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">9</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">13</span><span class="s3">, </span><span class="s4">14</span><span class="s3">, </span><span class="s4">15</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">]]))</span>
        <span class="s1">b</span><span class="s3">[</span><span class="s1">iu4</span><span class="s3">] = -</span><span class="s4">10</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">b</span><span class="s3">,</span>
                           <span class="s1">array</span><span class="s3">([[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">6</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">10</span><span class="s3">],</span>
                                  <span class="s3">[</span><span class="s4">16</span><span class="s3">, </span><span class="s4">17</span><span class="s3">, </span><span class="s4">18</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">]]))</span>


<span class="s2">class </span><span class="s1">TestTrilIndicesFrom</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_exceptions</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">tril_indices_from</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">((</span><span class="s4">2</span><span class="s3">,)))</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">tril_indices_from</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">)))</span>
        <span class="s6"># assert_raises(ValueError, tril_indices_from, np.ones((2, 3)))</span>


<span class="s2">class </span><span class="s1">TestTriuIndicesFrom</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_exceptions</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">triu_indices_from</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">((</span><span class="s4">2</span><span class="s3">,)))</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">triu_indices_from</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">((</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">)))</span>
        <span class="s6"># assert_raises(ValueError, triu_indices_from, np.ones((2, 3)))</span>


<span class="s2">class </span><span class="s1">TestVander</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_basic</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, -</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">v </span><span class="s3">= </span><span class="s1">vander</span><span class="s3">(</span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">powers </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                           <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                           <span class="s3">[</span><span class="s4">16</span><span class="s3">, -</span><span class="s4">8</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, -</span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                           <span class="s3">[</span><span class="s4">81</span><span class="s3">, </span><span class="s4">27</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s6"># Check default value of N:</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">v</span><span class="s3">, </span><span class="s1">powers</span><span class="s3">[:, </span><span class="s4">1</span><span class="s3">:])</span>
        <span class="s6"># Check a range of N values, including 0 and 5 (greater than default)</span>
        <span class="s1">m </span><span class="s3">= </span><span class="s1">powers</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">6</span><span class="s3">):</span>
            <span class="s1">v </span><span class="s3">= </span><span class="s1">vander</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">N</span><span class="s3">=</span><span class="s1">n</span><span class="s3">)</span>
            <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">v</span><span class="s3">, </span><span class="s1">powers</span><span class="s3">[:, </span><span class="s1">m</span><span class="s3">-</span><span class="s1">n</span><span class="s3">:</span><span class="s1">m</span><span class="s3">])</span>

    <span class="s2">def </span><span class="s1">test_dtypes</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">11</span><span class="s3">, -</span><span class="s4">12</span><span class="s3">, </span><span class="s4">13</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">int8</span><span class="s3">)</span>
        <span class="s1">v </span><span class="s3">= </span><span class="s1">vander</span><span class="s3">(</span><span class="s1">c</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">121</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                             <span class="s3">[</span><span class="s4">144</span><span class="s3">, -</span><span class="s4">12</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                             <span class="s3">[</span><span class="s4">169</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">v</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">c </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1.0</span><span class="s3">+</span><span class="s4">1j</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">-</span><span class="s4">1j</span><span class="s3">])</span>
        <span class="s1">v </span><span class="s3">= </span><span class="s1">vander</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">N</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">2j</span><span class="s3">, </span><span class="s4">1</span><span class="s3">+</span><span class="s4">1j</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                             <span class="s3">[-</span><span class="s4">2j</span><span class="s3">, </span><span class="s4">1</span><span class="s3">-</span><span class="s4">1j</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s6"># The data is floating point, but the values are small integers,</span>
        <span class="s6"># so assert_array_equal *should* be safe here (rather than, say,</span>
        <span class="s6"># assert_array_almost_equal).</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">v</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
</pre>
</body>
</html>