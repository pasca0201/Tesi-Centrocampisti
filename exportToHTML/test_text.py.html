<html>
<head>
<title>test_text.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_text.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_almost_equal</span>
<span class="s0">from </span><span class="s1">packaging</span><span class="s2">.</span><span class="s1">version </span><span class="s0">import </span><span class="s1">parse </span><span class="s0">as </span><span class="s1">parse_version</span>
<span class="s0">import </span><span class="s1">pyparsing</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">backend_bases </span><span class="s0">import </span><span class="s1">MouseEvent</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">backends</span><span class="s2">.</span><span class="s1">backend_agg </span><span class="s0">import </span><span class="s1">RendererAgg</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">figure </span><span class="s0">import </span><span class="s1">Figure</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">font_manager </span><span class="s0">import </span><span class="s1">FontProperties</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">gridspec </span><span class="s0">import </span><span class="s1">GridSpec</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s2">, </span><span class="s1">image_comparison</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">_markers </span><span class="s0">import </span><span class="s1">needs_usetex</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">text </span><span class="s0">import </span><span class="s1">Text</span><span class="s2">, </span><span class="s1">Annotation</span><span class="s2">, </span><span class="s1">OffsetFrom</span>

<span class="s1">pyparsing_version </span><span class="s2">= </span><span class="s1">parse_version</span><span class="s2">(</span><span class="s1">pyparsing</span><span class="s2">.</span><span class="s1">__version__</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'font_styles'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_font_styles</span><span class="s2">():</span>

    <span class="s0">def </span><span class="s1">find_matplotlib_font</span><span class="s2">(**</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">prop </span><span class="s2">= </span><span class="s1">FontProperties</span><span class="s2">(**</span><span class="s1">kw</span><span class="s2">)</span>
        <span class="s1">path </span><span class="s2">= </span><span class="s1">findfont</span><span class="s2">(</span><span class="s1">prop</span><span class="s2">, </span><span class="s1">directory</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">get_data_path</span><span class="s2">())</span>
        <span class="s0">return </span><span class="s1">FontProperties</span><span class="s2">(</span><span class="s1">fname</span><span class="s2">=</span><span class="s1">path</span><span class="s2">)</span>

    <span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">font_manager </span><span class="s0">import </span><span class="s1">FontProperties</span><span class="s2">, </span><span class="s1">findfont</span>
    <span class="s1">warnings</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span>
        <span class="s3">'ignore'</span><span class="s2">,</span>
        <span class="s3">r&quot;findfont: Font family \[u?'Foo'\] not found. Falling back to .&quot;</span><span class="s2">,</span>
        <span class="s1">UserWarning</span><span class="s2">,</span>
        <span class="s1">module</span><span class="s2">=</span><span class="s3">'matplotlib.font_manager'</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">normal_font </span><span class="s2">= </span><span class="s1">find_matplotlib_font</span><span class="s2">(</span>
        <span class="s1">family</span><span class="s2">=</span><span class="s3">&quot;sans-serif&quot;</span><span class="s2">,</span>
        <span class="s1">style</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">variant</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">size</span><span class="s2">=</span><span class="s4">14</span><span class="s2">)</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">&quot;Normal Font&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">),</span>
        <span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">,</span>
        <span class="s1">fontproperties</span><span class="s2">=</span><span class="s1">normal_font</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">a</span><span class="s2">.</span><span class="s1">get_fontname</span><span class="s2">() == </span><span class="s3">'DejaVu Sans'</span>
    <span class="s0">assert </span><span class="s1">a</span><span class="s2">.</span><span class="s1">get_fontstyle</span><span class="s2">() == </span><span class="s3">'normal'</span>
    <span class="s0">assert </span><span class="s1">a</span><span class="s2">.</span><span class="s1">get_fontvariant</span><span class="s2">() == </span><span class="s3">'normal'</span>
    <span class="s0">assert </span><span class="s1">a</span><span class="s2">.</span><span class="s1">get_weight</span><span class="s2">() == </span><span class="s3">'normal'</span>
    <span class="s0">assert </span><span class="s1">a</span><span class="s2">.</span><span class="s1">get_stretch</span><span class="s2">() == </span><span class="s3">'normal'</span>

    <span class="s1">bold_font </span><span class="s2">= </span><span class="s1">find_matplotlib_font</span><span class="s2">(</span>
        <span class="s1">family</span><span class="s2">=</span><span class="s3">&quot;Foo&quot;</span><span class="s2">,</span>
        <span class="s1">style</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">variant</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">weight</span><span class="s2">=</span><span class="s3">&quot;bold&quot;</span><span class="s2">,</span>
        <span class="s1">stretch</span><span class="s2">=</span><span class="s4">500</span><span class="s2">,</span>
        <span class="s1">size</span><span class="s2">=</span><span class="s4">14</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">&quot;Bold Font&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">),</span>
        <span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">,</span>
        <span class="s1">fontproperties</span><span class="s2">=</span><span class="s1">bold_font</span><span class="s2">)</span>

    <span class="s1">bold_italic_font </span><span class="s2">= </span><span class="s1">find_matplotlib_font</span><span class="s2">(</span>
        <span class="s1">family</span><span class="s2">=</span><span class="s3">&quot;sans serif&quot;</span><span class="s2">,</span>
        <span class="s1">style</span><span class="s2">=</span><span class="s3">&quot;italic&quot;</span><span class="s2">,</span>
        <span class="s1">variant</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">weight</span><span class="s2">=</span><span class="s4">750</span><span class="s2">,</span>
        <span class="s1">stretch</span><span class="s2">=</span><span class="s4">500</span><span class="s2">,</span>
        <span class="s1">size</span><span class="s2">=</span><span class="s4">14</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">&quot;Bold Italic Font&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">),</span>
        <span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">,</span>
        <span class="s1">fontproperties</span><span class="s2">=</span><span class="s1">bold_italic_font</span><span class="s2">)</span>

    <span class="s1">light_font </span><span class="s2">= </span><span class="s1">find_matplotlib_font</span><span class="s2">(</span>
        <span class="s1">family</span><span class="s2">=</span><span class="s3">&quot;sans-serif&quot;</span><span class="s2">,</span>
        <span class="s1">style</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">variant</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">weight</span><span class="s2">=</span><span class="s4">200</span><span class="s2">,</span>
        <span class="s1">stretch</span><span class="s2">=</span><span class="s4">500</span><span class="s2">,</span>
        <span class="s1">size</span><span class="s2">=</span><span class="s4">14</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">&quot;Light Font&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">),</span>
        <span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">,</span>
        <span class="s1">fontproperties</span><span class="s2">=</span><span class="s1">light_font</span><span class="s2">)</span>

    <span class="s1">condensed_font </span><span class="s2">= </span><span class="s1">find_matplotlib_font</span><span class="s2">(</span>
        <span class="s1">family</span><span class="s2">=</span><span class="s3">&quot;sans-serif&quot;</span><span class="s2">,</span>
        <span class="s1">style</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">variant</span><span class="s2">=</span><span class="s3">&quot;normal&quot;</span><span class="s2">,</span>
        <span class="s1">weight</span><span class="s2">=</span><span class="s4">500</span><span class="s2">,</span>
        <span class="s1">stretch</span><span class="s2">=</span><span class="s4">100</span><span class="s2">,</span>
        <span class="s1">size</span><span class="s2">=</span><span class="s4">14</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">&quot;Condensed Font&quot;</span><span class="s2">,</span>
        <span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">),</span>
        <span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">,</span>
        <span class="s1">fontproperties</span><span class="s2">=</span><span class="s1">condensed_font</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'multiline'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_multiline</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">&quot;multiline</span><span class="s0">\n</span><span class="s3">text alignment&quot;</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span>
        <span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">&quot;TpTpTp</span><span class="s0">\n</span><span class="s3">$M$</span><span class="s0">\n</span><span class="s3">TpTpTp&quot;</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">20</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">&quot;center&quot;</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">&quot;top&quot;</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span>
        <span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">&quot;TpTpTp</span><span class="s0">\n</span><span class="s3">$M^{M^{M^{M}}}$</span><span class="s0">\n</span><span class="s3">TpTpTp&quot;</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">20</span><span class="s2">,</span>
        <span class="s1">ha</span><span class="s2">=</span><span class="s3">&quot;center&quot;</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">&quot;top&quot;</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span>
        <span class="s4">0.8</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">&quot;TpTpTp</span><span class="s0">\n</span><span class="s3">$M_{q_{q_{q}}}$</span><span class="s0">\n</span><span class="s3">TpTpTp&quot;</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">20</span><span class="s2">,</span>
        <span class="s1">ha</span><span class="s2">=</span><span class="s3">&quot;center&quot;</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">&quot;top&quot;</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlim</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylim</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.8</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'multiline2'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_multiline2</span><span class="s2">():</span>
    <span class="s5"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.kerning_factor'</span><span class="s2">] = </span><span class="s4">6</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1.4</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'C2'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s1">sts </span><span class="s2">= [</span><span class="s3">'Line'</span><span class="s2">, </span><span class="s3">'2 Lineg</span><span class="s0">\n </span><span class="s3">2 Lg'</span><span class="s2">, </span><span class="s3">'$</span><span class="s0">\\</span><span class="s3">sum_i x $'</span><span class="s2">, </span><span class="s3">'hi $</span><span class="s0">\\</span><span class="s3">sum_i x $</span><span class="s0">\n</span><span class="s3">test'</span><span class="s2">,</span>
           <span class="s3">'test</span><span class="s0">\n </span><span class="s3">$</span><span class="s0">\\</span><span class="s3">sum_i x $'</span><span class="s2">, </span><span class="s3">'$</span><span class="s0">\\</span><span class="s3">sum_i x $</span><span class="s0">\n </span><span class="s3">$</span><span class="s0">\\</span><span class="s3">sum_i x $'</span><span class="s2">]</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">draw_box</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">tt</span><span class="s2">):</span>
        <span class="s1">r </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                               <span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
        <span class="s1">r</span><span class="s2">.</span><span class="s1">set_bounds</span><span class="s2">(</span>
            <span class="s1">tt</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>
            <span class="s2">.</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">())</span>
            <span class="s2">.</span><span class="s1">bounds</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">r</span><span class="s2">)</span>

    <span class="s1">horal </span><span class="s2">= </span><span class="s3">'left'</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">st </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">sts</span><span class="s2">):</span>
        <span class="s1">tt </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.2 </span><span class="s2">* </span><span class="s1">nn </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">st</span><span class="s2">, </span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s1">horal</span><span class="s2">,</span>
                     <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s3">'bottom'</span><span class="s2">)</span>
        <span class="s1">draw_box</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">tt</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'Bottom align'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'C2'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s4">1.3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'C2'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">st </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">sts</span><span class="s2">):</span>
        <span class="s1">tt </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.2 </span><span class="s2">* </span><span class="s1">nn </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.3</span><span class="s2">, </span><span class="s1">st</span><span class="s2">, </span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s1">horal</span><span class="s2">,</span>
                     <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">)</span>
        <span class="s1">draw_box</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">tt</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">1.3</span><span class="s2">, </span><span class="s3">'Top align'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'C2'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s4">1.8</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'C2'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">st </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">sts</span><span class="s2">):</span>
        <span class="s1">tt </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.2 </span><span class="s2">* </span><span class="s1">nn </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.8</span><span class="s2">, </span><span class="s1">st</span><span class="s2">, </span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s1">horal</span><span class="s2">,</span>
                     <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s3">'baseline'</span><span class="s2">)</span>
        <span class="s1">draw_box</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">tt</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">1.8</span><span class="s2">, </span><span class="s3">'Baseline align'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'C2'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'C2'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">st </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">sts</span><span class="s2">):</span>
        <span class="s1">tt </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.2 </span><span class="s2">* </span><span class="s1">nn </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">st</span><span class="s2">, </span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s1">horal</span><span class="s2">,</span>
                     <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s3">'bottom'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s4">20</span><span class="s2">)</span>
        <span class="s1">draw_box</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">tt</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s3">'Bot align, rot20'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s3">'C2'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'antialiased.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_antialiasing</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.antialiased'</span><span class="s2">] = </span><span class="s0">False  </span><span class="s5"># Passed arguments should override.</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">5.25</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">, </span><span class="s3">&quot;antialiased&quot;</span><span class="s2">, </span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">,</span>
             <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">antialiased</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">, </span><span class="s3">r&quot;$\sqrt{x}$&quot;</span><span class="s2">, </span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">,</span>
             <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">antialiased</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.antialiased'</span><span class="s2">] = </span><span class="s0">True  </span><span class="s5"># Passed arguments should override.</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">, </span><span class="s3">&quot;not antialiased&quot;</span><span class="s2">, </span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">,</span>
             <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">antialiased</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">, </span><span class="s3">r&quot;$\sqrt{x}$&quot;</span><span class="s2">, </span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">,</span>
             <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">antialiased</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.antialiased'</span><span class="s2">] = </span><span class="s0">False  </span><span class="s5"># Should not affect existing text.</span>


<span class="s0">def </span><span class="s1">test_afm_kerning</span><span class="s2">():</span>
    <span class="s1">fn </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">font_manager</span><span class="s2">.</span><span class="s1">findfont</span><span class="s2">(</span><span class="s3">&quot;Helvetica&quot;</span><span class="s2">, </span><span class="s1">fontext</span><span class="s2">=</span><span class="s3">&quot;afm&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">, </span><span class="s3">'rb'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">fh</span><span class="s2">:</span>
        <span class="s1">afm </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">_afm</span><span class="s2">.</span><span class="s1">AFM</span><span class="s2">(</span><span class="s1">fh</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">afm</span><span class="s2">.</span><span class="s1">string_width_height</span><span class="s2">(</span><span class="s3">'VAVAVAVAVAVA'</span><span class="s2">) == (</span><span class="s4">7174.0</span><span class="s2">, </span><span class="s4">718</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'text_contains.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_contains</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>

    <span class="s1">mevent </span><span class="s2">= </span><span class="s1">MouseEvent</span><span class="s2">(</span><span class="s3">'button_press_event'</span><span class="s2">, </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">xs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)</span>
    <span class="s1">ys </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)</span>
    <span class="s1">xs</span><span class="s2">, </span><span class="s1">ys </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">, </span><span class="s1">ys</span><span class="s2">)</span>

    <span class="s1">txt </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span>
        <span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">, </span><span class="s3">'hello world'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">30</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>
    <span class="s5"># uncomment to draw the text's bounding box</span>
    <span class="s5"># txt.set_bbox(dict(edgecolor='black', facecolor='none'))</span>

    <span class="s5"># draw the text. This is important, as the contains method can only work</span>
    <span class="s5"># when a renderer exists.</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">ys</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">):</span>
        <span class="s1">mevent</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s1">mevent</span><span class="s2">.</span><span class="s1">y </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">().</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">])</span>
        <span class="s1">contains</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s1">mevent</span><span class="s2">)</span>
        <span class="s1">color </span><span class="s2">= </span><span class="s3">'yellow' </span><span class="s0">if </span><span class="s1">contains </span><span class="s0">else </span><span class="s3">'red'</span>

        <span class="s5"># capture the viewLim, plot a point, and reset the viewLim</span>
        <span class="s1">vl </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">viewLim</span><span class="s2">.</span><span class="s1">frozen</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s3">'o'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">viewLim</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">vl</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_annotation_contains</span><span class="s2">():</span>
    <span class="s5"># Check that Annotation.contains looks at the bboxes of the text and the</span>
    <span class="s5"># arrow separately, not at the joint bbox.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ann </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">&quot;hello&quot;</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s4">.4</span><span class="s2">, </span><span class="s4">.4</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s4">.6</span><span class="s2">, </span><span class="s4">.6</span><span class="s2">), </span><span class="s1">arrowprops</span><span class="s2">={</span><span class="s3">&quot;arrowstyle&quot;</span><span class="s2">: </span><span class="s3">&quot;-&gt;&quot;</span><span class="s2">})</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()  </span><span class="s5"># Needed for the same reason as in test_contains.</span>
    <span class="s1">event </span><span class="s2">= </span><span class="s1">MouseEvent</span><span class="s2">(</span>
        <span class="s3">&quot;button_press_event&quot;</span><span class="s2">, </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">, *</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">((</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.6</span><span class="s2">)))</span>
    <span class="s0">assert </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s1">event</span><span class="s2">) == (</span><span class="s0">False</span><span class="s2">, {})</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'err, xycoords, match'</span><span class="s2">, (</span>
    <span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">print</span><span class="s2">, </span><span class="s3">&quot;xycoords callable must return a BboxBase or Transform, not a&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s3">r&quot;'xycoords' must be an instance of str, tuple&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;'foo' is not a valid coordinate&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s3">&quot;foo bar&quot;</span><span class="s2">, </span><span class="s3">&quot;'foo bar' is not a valid coordinate&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s3">&quot;offset foo&quot;</span><span class="s2">, </span><span class="s3">&quot;xycoords cannot be an offset coordinate&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s3">&quot;axes foo&quot;</span><span class="s2">, </span><span class="s3">&quot;'foo' is not a recognized unit&quot;</span><span class="s2">),</span>
<span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_annotate_errors</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">xycoords</span><span class="s2">, </span><span class="s1">match</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">match</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'xy'</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">), </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s1">xycoords</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'titles'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_titles</span><span class="s2">():</span>
    <span class="s5"># left and right side titles</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">&quot;left title&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">&quot;right title&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'text_alignment'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_alignment</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s4">0.1</span>
    <span class="s0">for </span><span class="s1">rotation </span><span class="s0">in </span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">30</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">alignment </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'top'</span><span class="s2">, </span><span class="s3">'bottom'</span><span class="s2">, </span><span class="s3">'baseline'</span><span class="s2">, </span><span class="s3">'center'</span><span class="s2">):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span>
                <span class="s1">x</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">alignment </span><span class="s2">+ </span><span class="s3">&quot; Tj&quot;</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s1">alignment</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s1">rotation</span><span class="s2">,</span>
                <span class="s1">bbox</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">boxstyle</span><span class="s2">=</span><span class="s3">'round'</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s3">'wheat'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">))</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span>
                <span class="s1">x</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s3">r'$\sum_{i=0}^{j}$'</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s1">alignment</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s1">rotation</span><span class="s2">)</span>
            <span class="s1">x </span><span class="s2">+= </span><span class="s4">0.1</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">])</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'axes_titles.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_axes_titles</span><span class="s2">():</span>
    <span class="s5"># Related to issue #3327</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">20</span><span class="s2">, </span><span class="s1">fontweight</span><span class="s2">=</span><span class="s4">700</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">12</span><span class="s2">, </span><span class="s1">fontweight</span><span class="s2">=</span><span class="s4">400</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">'right'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s3">'right'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">12</span><span class="s2">, </span><span class="s1">fontweight</span><span class="s2">=</span><span class="s4">400</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_position</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s5"># test set_position</span>
    <span class="s1">ann </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">'test'</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s1">init_pos </span><span class="s2">= </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s1">shift_val </span><span class="s2">= </span><span class="s4">15</span>
    <span class="s1">ann</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">((</span><span class="s1">shift_val</span><span class="s2">, </span><span class="s1">shift_val</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">post_pos </span><span class="s2">= </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">renderer</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">init_pos</span><span class="s2">.</span><span class="s1">min</span><span class="s2">, </span><span class="s1">post_pos</span><span class="s2">.</span><span class="s1">min</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">a </span><span class="s2">+ </span><span class="s1">shift_val </span><span class="s2">== </span><span class="s1">b</span>

    <span class="s5"># test xyann</span>
    <span class="s1">ann </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">'test'</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s1">init_pos </span><span class="s2">= </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s1">shift_val </span><span class="s2">= </span><span class="s4">15</span>
    <span class="s1">ann</span><span class="s2">.</span><span class="s1">xyann </span><span class="s2">= (</span><span class="s1">shift_val</span><span class="s2">, </span><span class="s1">shift_val</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">post_pos </span><span class="s2">= </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">renderer</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">init_pos</span><span class="s2">.</span><span class="s1">min</span><span class="s2">, </span><span class="s1">post_pos</span><span class="s2">.</span><span class="s1">min</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">a </span><span class="s2">+ </span><span class="s1">shift_val </span><span class="s2">== </span><span class="s1">b</span>


<span class="s0">def </span><span class="s1">test_char_index_at</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">text </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">)</span>

    <span class="s1">text</span><span class="s2">.</span><span class="s1">set_text</span><span class="s2">(</span><span class="s3">&quot;i&quot;</span><span class="s2">)</span>
    <span class="s1">bbox </span><span class="s2">= </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>
    <span class="s1">size_i </span><span class="s2">= </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">x1 </span><span class="s2">- </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">x0</span>

    <span class="s1">text</span><span class="s2">.</span><span class="s1">set_text</span><span class="s2">(</span><span class="s3">&quot;m&quot;</span><span class="s2">)</span>
    <span class="s1">bbox </span><span class="s2">= </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>
    <span class="s1">size_m </span><span class="s2">= </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">x1 </span><span class="s2">- </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">x0</span>

    <span class="s1">text</span><span class="s2">.</span><span class="s1">set_text</span><span class="s2">(</span><span class="s3">&quot;iiiimmmm&quot;</span><span class="s2">)</span>
    <span class="s1">bbox </span><span class="s2">= </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>
    <span class="s1">origin </span><span class="s2">= </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">x0</span>

    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_char_index_at</span><span class="s2">(</span><span class="s1">origin </span><span class="s2">- </span><span class="s1">size_i</span><span class="s2">) == </span><span class="s4">0  </span><span class="s5"># left of first char</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_char_index_at</span><span class="s2">(</span><span class="s1">origin</span><span class="s2">) == </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_char_index_at</span><span class="s2">(</span><span class="s1">origin </span><span class="s2">+ </span><span class="s4">0.499</span><span class="s2">*</span><span class="s1">size_i</span><span class="s2">) == </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_char_index_at</span><span class="s2">(</span><span class="s1">origin </span><span class="s2">+ </span><span class="s4">0.501</span><span class="s2">*</span><span class="s1">size_i</span><span class="s2">) == </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_char_index_at</span><span class="s2">(</span><span class="s1">origin </span><span class="s2">+ </span><span class="s1">size_i</span><span class="s2">*</span><span class="s4">3</span><span class="s2">) == </span><span class="s4">3</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_char_index_at</span><span class="s2">(</span><span class="s1">origin </span><span class="s2">+ </span><span class="s1">size_i</span><span class="s2">*</span><span class="s4">4 </span><span class="s2">+ </span><span class="s1">size_m</span><span class="s2">*</span><span class="s4">3</span><span class="s2">) == </span><span class="s4">7</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_char_index_at</span><span class="s2">(</span><span class="s1">origin </span><span class="s2">+ </span><span class="s1">size_i</span><span class="s2">*</span><span class="s4">4 </span><span class="s2">+ </span><span class="s1">size_m</span><span class="s2">*</span><span class="s4">4</span><span class="s2">) == </span><span class="s4">8</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_char_index_at</span><span class="s2">(</span><span class="s1">origin </span><span class="s2">+ </span><span class="s1">size_i</span><span class="s2">*</span><span class="s4">4 </span><span class="s2">+ </span><span class="s1">size_m</span><span class="s2">*</span><span class="s4">10</span><span class="s2">) == </span><span class="s4">8</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'text'</span><span class="s2">, [</span><span class="s3">''</span><span class="s2">, </span><span class="s3">'O'</span><span class="s2">], </span><span class="s1">ids</span><span class="s2">=[</span><span class="s3">'empty'</span><span class="s2">, </span><span class="s3">'non-empty'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_non_default_dpi</span><span class="s2">(</span><span class="s1">text</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">t1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">'bottom'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">dpi </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">dpi</span>

    <span class="s1">bbox1 </span><span class="s2">= </span><span class="s1">t1</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>
    <span class="s1">bbox2 </span><span class="s2">= </span><span class="s1">t1</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s1">dpi </span><span class="s2">* </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bbox2</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">(), </span><span class="s1">bbox1</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">() * </span><span class="s4">10</span><span class="s2">,</span>
                               <span class="s1">rtol</span><span class="s2">=</span><span class="s4">5e-2</span><span class="s2">)</span>
    <span class="s5"># Text.get_window_extent should not permanently change dpi.</span>
    <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">dpi </span><span class="s2">== </span><span class="s1">dpi</span>


<span class="s0">def </span><span class="s1">test_get_rotation_string</span><span class="s2">():</span>
    <span class="s0">assert </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s3">'horizontal'</span><span class="s2">).</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s4">0.</span>
    <span class="s0">assert </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s3">'vertical'</span><span class="s2">).</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s4">90.</span>


<span class="s0">def </span><span class="s1">test_get_rotation_float</span><span class="s2">():</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s2">[</span><span class="s4">15.</span><span class="s2">, </span><span class="s4">16.70</span><span class="s2">, </span><span class="s4">77.4</span><span class="s2">]:</span>
        <span class="s0">assert </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s1">i</span><span class="s2">).</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s1">i</span>


<span class="s0">def </span><span class="s1">test_get_rotation_int</span><span class="s2">():</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s2">[</span><span class="s4">67</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">41</span><span class="s2">]:</span>
        <span class="s0">assert </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s1">i</span><span class="s2">).</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s1">float</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_rotation_raises</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">Text</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s3">'hozirontal'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_rotation_none</span><span class="s2">():</span>
    <span class="s0">assert </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s0">None</span><span class="s2">).</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s4">0.0</span>


<span class="s0">def </span><span class="s1">test_get_rotation_mod360</span><span class="s2">():</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">([</span><span class="s4">360.</span><span class="s2">, </span><span class="s4">377.</span><span class="s2">, </span><span class="s4">720</span><span class="s2">+</span><span class="s4">177.2</span><span class="s2">], [</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">17.</span><span class="s2">, </span><span class="s4">177.2</span><span class="s2">]):</span>
        <span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">Text</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s1">i</span><span class="s2">).</span><span class="s1">get_rotation</span><span class="s2">(), </span><span class="s1">j</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;ha&quot;</span><span class="s2">, [</span><span class="s3">&quot;center&quot;</span><span class="s2">, </span><span class="s3">&quot;right&quot;</span><span class="s2">, </span><span class="s3">&quot;left&quot;</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;va&quot;</span><span class="s2">, [</span><span class="s3">&quot;center&quot;</span><span class="s2">, </span><span class="s3">&quot;top&quot;</span><span class="s2">, </span><span class="s3">&quot;bottom&quot;</span><span class="s2">,</span>
                                <span class="s3">&quot;baseline&quot;</span><span class="s2">, </span><span class="s3">&quot;center_baseline&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_null_rotation_with_rotation_mode</span><span class="s2">(</span><span class="s1">ha</span><span class="s2">, </span><span class="s1">va</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">kw </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s1">va</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s1">ha</span><span class="s2">)</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">'test'</span><span class="s2">, </span><span class="s1">rotation_mode</span><span class="s2">=</span><span class="s3">'anchor'</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
    <span class="s1">t1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">'test'</span><span class="s2">, </span><span class="s1">rotation_mode</span><span class="s2">=</span><span class="s3">'default'</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">renderer</span><span class="s2">).</span><span class="s1">get_points</span><span class="s2">(),</span>
                        <span class="s1">t1</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">renderer</span><span class="s2">).</span><span class="s1">get_points</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'text_bboxclip'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bbox_clipping</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s3">'Is bbox clipped?'</span><span class="s2">, </span><span class="s1">backgroundcolor</span><span class="s2">=</span><span class="s3">'r'</span><span class="s2">, </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'Is fancy bbox clipped?'</span><span class="s2">, </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">t</span><span class="s2">.</span><span class="s1">set_bbox</span><span class="s2">({</span><span class="s3">&quot;boxstyle&quot;</span><span class="s2">: </span><span class="s3">&quot;round, pad=0.1&quot;</span><span class="s2">})</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'annotation_negative_ax_coords.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_annotation_negative_ax_coords</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'+ pts'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">30</span><span class="s2">, </span><span class="s4">20</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'axes points'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">30</span><span class="s2">, </span><span class="s4">20</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes points'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'- pts'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">30</span><span class="s2">, -</span><span class="s4">20</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'axes points'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">30</span><span class="s2">, -</span><span class="s4">20</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes points'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">,</span>
                <span class="s1">va</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'+ frac'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'- frac'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">0.75</span><span class="s2">, -</span><span class="s4">0.05</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">0.75</span><span class="s2">, -</span><span class="s4">0.05</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes fraction'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">,</span>
                <span class="s1">va</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'+ pixels'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">160</span><span class="s2">, </span><span class="s4">25</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'axes pixels'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">160</span><span class="s2">, </span><span class="s4">25</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes pixels'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'- pixels'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">160</span><span class="s2">, -</span><span class="s4">25</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'axes pixels'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">160</span><span class="s2">, -</span><span class="s4">25</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'axes pixels'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">,</span>
                <span class="s1">va</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'annotation_negative_fig_coords.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_annotation_negative_fig_coords</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'+ pts'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">120</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'figure points'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">120</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure points'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'- pts'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[-</span><span class="s4">10</span><span class="s2">, </span><span class="s4">180</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'figure points'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[-</span><span class="s4">10</span><span class="s2">, </span><span class="s4">180</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure points'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">,</span>
                <span class="s1">va</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'+ frac'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.55</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'figure fraction'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.55</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure fraction'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'- frac'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[-</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'figure fraction'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[-</span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure fraction'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">,</span>
                <span class="s1">va</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'+ pixels'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[</span><span class="s4">50</span><span class="s2">, </span><span class="s4">50</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'- pixels'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=[-</span><span class="s4">50</span><span class="s2">, </span><span class="s4">100</span><span class="s2">], </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">,</span>
                <span class="s1">xy</span><span class="s2">=[-</span><span class="s4">50</span><span class="s2">, </span><span class="s4">100</span><span class="s2">], </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">32</span><span class="s2">,</span>
                <span class="s1">va</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_text_stale</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw_all</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert not </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert not </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">stale</span>

    <span class="s1">txt1 </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">'aardvark'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert </span><span class="s1">txt1</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">stale</span>

    <span class="s1">ann1 </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'aardvark'</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=[</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert </span><span class="s1">ann1</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">stale</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw_all</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert not </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert not </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">stale</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'agg_text_clip.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_agg_text_clip</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s2">):</span>
        <span class="s1">ax1</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">ax2</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_text_size_binding</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'font.size'</span><span class="s2">] = </span><span class="s4">10</span>
    <span class="s1">fp </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">font_manager</span><span class="s2">.</span><span class="s1">FontProperties</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s3">'large'</span><span class="s2">)</span>
    <span class="s1">sz1 </span><span class="s2">= </span><span class="s1">fp</span><span class="s2">.</span><span class="s1">get_size_in_points</span><span class="s2">()</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'font.size'</span><span class="s2">] = </span><span class="s4">100</span>

    <span class="s0">assert </span><span class="s1">sz1 </span><span class="s2">== </span><span class="s1">fp</span><span class="s2">.</span><span class="s1">get_size_in_points</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'font_scaling.pdf'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_font_scaling</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'pdf.fonttype'</span><span class="s2">] = </span><span class="s4">42</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">6.4</span><span class="s2">, </span><span class="s4">12.4</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">NullLocator</span><span class="s2">())</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">NullLocator</span><span class="s2">())</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s4">10</span><span class="s2">, </span><span class="s4">600</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">fs </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">43</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">*</span><span class="s4">30</span><span class="s2">, </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">fs</span><span class="s0">} </span><span class="s3">pt font size&quot;</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'spacing1, spacing2'</span><span class="s2">, [(</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">), (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_two_2line_texts</span><span class="s2">(</span><span class="s1">spacing1</span><span class="s2">, </span><span class="s1">spacing2</span><span class="s2">):</span>
    <span class="s1">text_string </span><span class="s2">= </span><span class="s3">'line1</span><span class="s0">\n</span><span class="s3">line2'</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()</span>

    <span class="s1">text1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">text_string</span><span class="s2">, </span><span class="s1">linespacing</span><span class="s2">=</span><span class="s1">spacing1</span><span class="s2">)</span>
    <span class="s1">text2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">text_string</span><span class="s2">, </span><span class="s1">linespacing</span><span class="s2">=</span><span class="s1">spacing2</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s1">box1 </span><span class="s2">= </span><span class="s1">text1</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">=</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s1">box2 </span><span class="s2">= </span><span class="s1">text2</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">=</span><span class="s1">renderer</span><span class="s2">)</span>

    <span class="s5"># line spacing only affects height</span>
    <span class="s0">assert </span><span class="s1">box1</span><span class="s2">.</span><span class="s1">width </span><span class="s2">== </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">width</span>
    <span class="s0">if </span><span class="s1">spacing1 </span><span class="s2">== </span><span class="s1">spacing2</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">box1</span><span class="s2">.</span><span class="s1">height </span><span class="s2">== </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">height</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">box1</span><span class="s2">.</span><span class="s1">height </span><span class="s2">!= </span><span class="s1">box2</span><span class="s2">.</span><span class="s1">height</span>


<span class="s0">def </span><span class="s1">test_validate_linespacing</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.25</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">linespacing</span><span class="s2">=</span><span class="s3">&quot;abc&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_nonfinite_pos</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s3">'nan'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">'inf'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_hinting_factor_backends</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.hinting_factor'</span><span class="s2">] = </span><span class="s4">1</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'some text'</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">(), </span><span class="s1">format</span><span class="s2">=</span><span class="s3">'svg'</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">t</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">intervalx</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">(), </span><span class="s1">format</span><span class="s2">=</span><span class="s3">'png'</span><span class="s2">)</span>
    <span class="s5"># Backends should apply hinting_factor consistently (within 10%).</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">t</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">intervalx</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">,</span>
                               <span class="s1">rtol</span><span class="s2">=</span><span class="s4">0.1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">needs_usetex</span>
<span class="s0">def </span><span class="s1">test_usetex_is_copied</span><span class="s2">():</span>
    <span class="s5"># Indirectly tests that update_from (which is used to copy tick label</span>
    <span class="s5"># properties) copies usetex state.</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;text.usetex&quot;</span><span class="s2">] = </span><span class="s0">False</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s4">121</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;text.usetex&quot;</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s4">122</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">usetex </span><span class="s0">in </span><span class="s2">[(</span><span class="s1">ax1</span><span class="s2">, </span><span class="s0">False</span><span class="s2">), (</span><span class="s1">ax2</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)]:</span>
        <span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">t</span><span class="s2">.</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_usetex</span><span class="s2">() == </span><span class="s1">usetex</span>


<span class="s2">@</span><span class="s1">needs_usetex</span>
<span class="s0">def </span><span class="s1">test_single_artist_usetex</span><span class="s2">():</span>
    <span class="s5"># Check that a single artist marked with usetex does not get passed through</span>
    <span class="s5"># the mathtext parser at all (for the Agg backend) (the mathtext parser</span>
    <span class="s5"># currently fails to parse \frac12, requiring \frac{1}{2} instead).</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">r&quot;$\frac12$&quot;</span><span class="s2">, </span><span class="s1">usetex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;fmt&quot;</span><span class="s2">, [</span><span class="s3">&quot;png&quot;</span><span class="s2">, </span><span class="s3">&quot;pdf&quot;</span><span class="s2">, </span><span class="s3">&quot;svg&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_single_artist_usenotex</span><span class="s2">(</span><span class="s1">fmt</span><span class="s2">):</span>
    <span class="s5"># Check that a single artist can be marked as not-usetex even though the</span>
    <span class="s5"># rcParam is on (&quot;2_2_2&quot; fails if passed to TeX).  This currently skips</span>
    <span class="s5"># postscript output as the ps renderer doesn't support mixing usetex and</span>
    <span class="s5"># non-usetex.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">&quot;text.usetex&quot;</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">&quot;2_2_2&quot;</span><span class="s2">, </span><span class="s1">usetex</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">(), </span><span class="s1">format</span><span class="s2">=</span><span class="s1">fmt</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'text_as_path_opacity.svg'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_text_as_path_opacity</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">().</span><span class="s1">set_axis_off</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">, </span><span class="s3">'c'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">))</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'a'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">, </span><span class="s3">'x'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'text_as_text_opacity.svg'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_text_as_text_opacity</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'svg.fonttype'</span><span class="s2">] = </span><span class="s3">'none'</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">().</span><span class="s1">set_axis_off</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">, </span><span class="s3">'50% using `color`'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">))</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'50% using `alpha`'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">, </span><span class="s3">'50% using `alpha` and 100% `color`'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">,</span>
             <span class="s1">color</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_text_repr</span><span class="s2">():</span>
    <span class="s5"># smoketest to make sure text repr doesn't error for category</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s3">'A'</span><span class="s2">, </span><span class="s3">'B'</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">repr</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">([</span><span class="s3">'A'</span><span class="s2">], </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'Boo'</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_annotation_update</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">an </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'annotation'</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">))</span>
    <span class="s1">extent1 </span><span class="s2">= </span><span class="s1">an</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">())</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">tight_layout</span><span class="s2">()</span>
    <span class="s1">extent2 </span><span class="s2">= </span><span class="s1">an</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">())</span>

    <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">extent1</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">(), </span><span class="s1">extent2</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">(),</span>
                           <span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_annotation_units</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">(), </span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;o&quot;</span><span class="s2">)  </span><span class="s5"># Implicitly set axes extents.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">&quot;x&quot;</span><span class="s2">, (</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">(), </span><span class="s4">0.5</span><span class="s2">), </span><span class="s1">xycoords</span><span class="s2">=(</span><span class="s3">&quot;data&quot;</span><span class="s2">, </span><span class="s3">&quot;axes fraction&quot;</span><span class="s2">),</span>
                <span class="s5"># This used to crash before.</span>
                <span class="s1">xytext</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">&quot;offset points&quot;</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">(), </span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;o&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">&quot;x&quot;</span><span class="s2">, (</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">now</span><span class="s2">(), </span><span class="s4">0.5</span><span class="s2">), </span><span class="s1">xycoords</span><span class="s2">=(</span><span class="s3">&quot;data&quot;</span><span class="s2">, </span><span class="s3">&quot;axes fraction&quot;</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'large_subscript_title.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_large_subscript_title</span><span class="s2">():</span>
    <span class="s5"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.kerning_factor'</span><span class="s2">] = </span><span class="s4">6</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'axes.titley'</span><span class="s2">] = </span><span class="s0">None</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">9</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">), </span><span class="s1">constrained_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">r'$\sum_{i} x_i$'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">'New way'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticklabels</span><span class="s2">([])</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">r'$\sum_{i} x_i$'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">1.01</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s3">'Old Way'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticklabels</span><span class="s2">([])</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;x, rotation, halign&quot;</span><span class="s2">,</span>
    <span class="s2">[(</span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">95</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">'right'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">185</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_wrap</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">, </span><span class="s1">halign</span><span class="s2">):</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">18</span><span class="s2">, </span><span class="s4">18</span><span class="s2">))</span>
    <span class="s1">gs </span><span class="s2">= </span><span class="s1">GridSpec</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">figure</span><span class="s2">=</span><span class="s1">fig</span><span class="s2">)</span>
    <span class="s1">subfig </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subfigure</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s5"># we only use the central subfigure, which does not align with any</span>
    <span class="s5"># figure boundary, to ensure only subfigure boundaries are relevant</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s3">'This is a very long text that should be wrapped multiple times.'</span>
    <span class="s1">text </span><span class="s2">= </span><span class="s1">subfig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s1">rotation</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s1">halign</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_get_wrapped_text</span><span class="s2">() == (</span><span class="s3">'This is a very long</span><span class="s0">\n</span><span class="s3">'</span>
                                        <span class="s3">'text that should be</span><span class="s0">\n</span><span class="s3">'</span>
                                        <span class="s3">'wrapped multiple</span><span class="s0">\n</span><span class="s3">'</span>
                                        <span class="s3">'times.'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_mathwrap</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">4</span><span class="s2">))</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s3">r'This is a very $\overline{\mathrm{long}}$ line of Mathtext.'</span>
    <span class="s1">text </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">40</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_get_wrapped_text</span><span class="s2">() == (</span><span class="s3">'This is a very $</span><span class="s0">\\</span><span class="s3">overline{</span><span class="s0">\\</span><span class="s3">mathrm{long}}$</span><span class="s0">\n</span><span class="s3">'</span>
                                        <span class="s3">'line of Mathtext.'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_window_extent_wrapped</span><span class="s2">():</span>
    <span class="s5"># Test that a long title that wraps to two lines has the same vertical</span>
    <span class="s5"># extent as an explicit two line title.</span>

    <span class="s1">fig1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))</span>
    <span class="s1">fig1</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s3">&quot;suptitle that is clearly too long in this case&quot;</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">window_extent_test </span><span class="s2">= </span><span class="s1">fig1</span><span class="s2">.</span><span class="s1">_suptitle</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>

    <span class="s1">fig2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))</span>
    <span class="s1">fig2</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s3">&quot;suptitle that is clearly</span><span class="s0">\n</span><span class="s3">too long in this case&quot;</span><span class="s2">)</span>
    <span class="s1">window_extent_ref </span><span class="s2">= </span><span class="s1">fig2</span><span class="s2">.</span><span class="s1">_suptitle</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">window_extent_test</span><span class="s2">.</span><span class="s1">y0 </span><span class="s2">== </span><span class="s1">window_extent_ref</span><span class="s2">.</span><span class="s1">y0</span>
    <span class="s0">assert </span><span class="s1">window_extent_test</span><span class="s2">.</span><span class="s1">y1 </span><span class="s2">== </span><span class="s1">window_extent_ref</span><span class="s2">.</span><span class="s1">y1</span>


<span class="s0">def </span><span class="s1">test_long_word_wrap</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">4</span><span class="s2">))</span>
    <span class="s1">text </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">9.5</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s3">'Alonglineoftexttowrap'</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_get_wrapped_text</span><span class="s2">() == </span><span class="s3">'Alonglineoftexttowrap'</span>


<span class="s0">def </span><span class="s1">test_wrap_no_wrap</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">4</span><span class="s2">))</span>
    <span class="s1">text </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">'non wrapped text'</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">_get_wrapped_text</span><span class="s2">() == </span><span class="s3">'non wrapped text'</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_buffer_size</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s5"># On old versions of the Agg renderer, large non-ascii single-character</span>
    <span class="s5"># strings (here, &quot;€&quot;) would be rendered clipped because the rendering</span>
    <span class="s5"># buffer would be set by the physical size of the smaller &quot;a&quot; character.</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticklabels</span><span class="s2">([</span><span class="s3">&quot;€&quot;</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">set_color</span><span class="s2">(</span><span class="s3">&quot;w&quot;</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticklabels</span><span class="s2">([</span><span class="s3">&quot;€&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_fontproperties_kwarg_precedence</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test that kwargs take precedence over fontproperties defaults.&quot;&quot;&quot;</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">text1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">xlabel</span><span class="s2">(</span><span class="s3">&quot;value&quot;</span><span class="s2">, </span><span class="s1">fontproperties</span><span class="s2">=</span><span class="s3">'Times New Roman'</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">40.0</span><span class="s2">)</span>
    <span class="s1">text2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">ylabel</span><span class="s2">(</span><span class="s3">&quot;counts&quot;</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">40.0</span><span class="s2">, </span><span class="s1">fontproperties</span><span class="s2">=</span><span class="s3">'Times New Roman'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">text1</span><span class="s2">.</span><span class="s1">get_size</span><span class="s2">() == </span><span class="s4">40.0</span>
    <span class="s0">assert </span><span class="s1">text2</span><span class="s2">.</span><span class="s1">get_size</span><span class="s2">() == </span><span class="s4">40.0</span>


<span class="s0">def </span><span class="s1">test_transform_rotates_text</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">transform </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Affine2D</span><span class="s2">().</span><span class="s1">rotate_deg</span><span class="s2">(</span><span class="s4">30</span><span class="s2">)</span>
    <span class="s1">text </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">'test'</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">transform</span><span class="s2">,</span>
                   <span class="s1">transform_rotates_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_rotation</span><span class="s2">()</span>
    <span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_update_mutate_input</span><span class="s2">():</span>
    <span class="s1">inp </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">fontproperties</span><span class="s2">=</span><span class="s1">FontProperties</span><span class="s2">(</span><span class="s1">weight</span><span class="s2">=</span><span class="s3">&quot;bold&quot;</span><span class="s2">),</span>
               <span class="s1">bbox</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">cache </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">inp</span><span class="s2">)</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">()</span>
    <span class="s1">t</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">inp</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">inp</span><span class="s2">[</span><span class="s3">'fontproperties'</span><span class="s2">] == </span><span class="s1">cache</span><span class="s2">[</span><span class="s3">'fontproperties'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">inp</span><span class="s2">[</span><span class="s3">'bbox'</span><span class="s2">] == </span><span class="s1">cache</span><span class="s2">[</span><span class="s3">'bbox'</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'rotation'</span><span class="s2">, [</span><span class="s3">'invalid string'</span><span class="s2">, [</span><span class="s4">90</span><span class="s2">]])</span>
<span class="s0">def </span><span class="s1">test_invalid_rotation_values</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">ValueError</span><span class="s2">,</span>
            <span class="s1">match</span><span class="s2">=(</span><span class="s3">&quot;rotation must be 'vertical', 'horizontal' or a number&quot;</span><span class="s2">)):</span>
        <span class="s1">Text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">'foo'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s1">rotation</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_invalid_color</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">figtext</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s3">&quot;foobar&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'text_pdf_kerning.pdf'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pdf_kerning</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figtext</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">&quot;ATATATATATATATATATA&quot;</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_unsupported_script</span><span class="s2">(</span><span class="s1">recwarn</span><span class="s2">):</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">&quot;</span><span class="s0">\N{BENGALI DIGIT ZERO}</span><span class="s3">&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">warn</span><span class="s2">.</span><span class="s1">message</span><span class="s2">, </span><span class="s1">UserWarning</span><span class="s2">) </span><span class="s0">for </span><span class="s1">warn </span><span class="s0">in </span><span class="s1">recwarn</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span>
        <span class="s2">[</span><span class="s1">warn</span><span class="s2">.</span><span class="s1">message</span><span class="s2">.</span><span class="s1">args </span><span class="s0">for </span><span class="s1">warn </span><span class="s0">in </span><span class="s1">recwarn</span><span class="s2">] ==</span>
        <span class="s2">[(</span><span class="s3">r&quot;Glyph 2534 (\N{BENGALI DIGIT ZERO}) missing from font(s) &quot;</span>
            <span class="s2">+ </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">t</span><span class="s2">.</span><span class="s1">get_fontname</span><span class="s2">()</span><span class="s0">}</span><span class="s3">.&quot;</span><span class="s2">,),</span>
         <span class="s2">(</span><span class="s3">r&quot;Matplotlib currently does not support Bengali natively.&quot;</span><span class="s2">,)])</span>


<span class="s5"># See gh-26152 for more information on this xfail</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">pyparsing_version</span><span class="s2">.</span><span class="s1">release </span><span class="s2">== (</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">),</span>
                   <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Error messages are incorrect with pyparsing 3.1.0&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_parse_math</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">r&quot;$ \wrong{math} $&quot;</span><span class="s2">, </span><span class="s1">parse_math</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">r&quot;$ \wrong{math} $&quot;</span><span class="s2">, </span><span class="s1">parse_math</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'Unknown symbol'</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s5"># See gh-26152 for more information on this xfail</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">pyparsing_version</span><span class="s2">.</span><span class="s1">release </span><span class="s2">== (</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">),</span>
                   <span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Error messages are incorrect with pyparsing 3.1.0&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_parse_math_rcparams</span><span class="s2">():</span>
    <span class="s5"># Default is True</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">r&quot;$ \wrong{math} $&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'Unknown symbol'</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s5"># Setting rcParams to False</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">({</span><span class="s3">'text.parse_math'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s3">r&quot;$ \wrong{math} $&quot;</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'text_pdf_font42_kerning.pdf'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pdf_font42_kerning</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'pdf.fonttype'</span><span class="s2">] = </span><span class="s4">42</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figtext</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">&quot;ATAVATAVATAVATAVATA&quot;</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s3">'text_pdf_chars_beyond_bmp.pdf'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pdf_chars_beyond_bmp</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'pdf.fonttype'</span><span class="s2">] = </span><span class="s4">42</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'mathtext.fontset'</span><span class="s2">] = </span><span class="s3">'stixsans'</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figtext</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">&quot;Mass $m$ </span><span class="s0">\U00010308</span><span class="s3">&quot;</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">needs_usetex</span>
<span class="s0">def </span><span class="s1">test_metrics_cache</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">text</span><span class="s2">.</span><span class="s1">_get_text_metrics_with_cache_impl</span><span class="s2">.</span><span class="s1">cache_clear</span><span class="s2">()</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.3</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">bar&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.3</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">bar&quot;</span><span class="s2">, </span><span class="s1">usetex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">bar&quot;</span><span class="s2">, </span><span class="s1">usetex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">_get_renderer</span><span class="s2">()</span>
    <span class="s1">ys </span><span class="s2">= {}  </span><span class="s5"># mapping of strings to where they were drawn in y with draw_tex.</span>

    <span class="s0">def </span><span class="s1">call</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">renderer</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, *</span><span class="s1">_ </span><span class="s2">= </span><span class="s1">args</span>
        <span class="s1">ys</span><span class="s2">.</span><span class="s1">setdefault</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s1">set</span><span class="s2">()).</span><span class="s1">add</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">renderer</span><span class="s2">.</span><span class="s1">draw_tex </span><span class="s2">= </span><span class="s1">call</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s2">[*</span><span class="s1">ys</span><span class="s2">] == [</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s3">&quot;bar&quot;</span><span class="s2">]</span>
    <span class="s5"># Check that both TeX strings were drawn with the same y-position for both</span>
    <span class="s5"># single-line substrings.  Previously, there used to be an incorrect cache</span>
    <span class="s5"># collision with the non-TeX string (drawn first here) whose metrics would</span>
    <span class="s5"># get incorrectly reused by the first TeX string.</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">ys</span><span class="s2">[</span><span class="s3">&quot;foo&quot;</span><span class="s2">]) == </span><span class="s1">len</span><span class="s2">(</span><span class="s1">ys</span><span class="s2">[</span><span class="s3">&quot;bar&quot;</span><span class="s2">]) == </span><span class="s4">1</span>

    <span class="s1">info </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">text</span><span class="s2">.</span><span class="s1">_get_text_metrics_with_cache_impl</span><span class="s2">.</span><span class="s1">cache_info</span><span class="s2">()</span>
    <span class="s5"># Every string gets a miss for the first layouting (extents), then a hit</span>
    <span class="s5"># when drawing, but &quot;foo\nbar&quot; gets two hits as it's drawn twice.</span>
    <span class="s0">assert </span><span class="s1">info</span><span class="s2">.</span><span class="s1">hits </span><span class="s2">&gt; </span><span class="s1">info</span><span class="s2">.</span><span class="s1">misses</span>


<span class="s0">def </span><span class="s1">test_annotate_offset_fontsize</span><span class="s2">():</span>
    <span class="s5"># Test that offset_fontsize parameter works and uses accurate values</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">text_coords </span><span class="s2">= [</span><span class="s3">'offset points'</span><span class="s2">, </span><span class="s3">'offset fontsize'</span><span class="s2">]</span>
    <span class="s5"># 10 points should be equal to 1 fontsize unit at fontsize=10</span>
    <span class="s1">xy_text </span><span class="s2">= [(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]</span>
    <span class="s1">anns </span><span class="s2">= [</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">'test'</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">),</span>
                        <span class="s1">xytext</span><span class="s2">=</span><span class="s1">xy_text</span><span class="s2">[</span><span class="s1">i</span><span class="s2">],</span>
                        <span class="s1">fontsize</span><span class="s2">=</span><span class="s3">'10'</span><span class="s2">,</span>
                        <span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'data'</span><span class="s2">,</span>
                        <span class="s1">textcoords</span><span class="s2">=</span><span class="s1">text_coords</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)]</span>
    <span class="s1">points_coords</span><span class="s2">, </span><span class="s1">fontsize_coords </span><span class="s2">= [</span><span class="s1">ann</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">() </span><span class="s0">for </span><span class="s1">ann </span><span class="s0">in </span><span class="s1">anns</span><span class="s2">]</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">str</span><span class="s2">(</span><span class="s1">points_coords</span><span class="s2">) == </span><span class="s1">str</span><span class="s2">(</span><span class="s1">fontsize_coords</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_set_antialiased</span><span class="s2">():</span>
    <span class="s1">txt </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">(</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">bar&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">_antialiased </span><span class="s2">== </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.antialiased'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">get_antialiased</span><span class="s2">() == </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.antialiased'</span><span class="s2">]</span>

    <span class="s1">txt</span><span class="s2">.</span><span class="s1">set_antialiased</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">_antialiased </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">get_antialiased</span><span class="s2">() == </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">_antialiased</span>

    <span class="s1">txt</span><span class="s2">.</span><span class="s1">set_antialiased</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">_antialiased </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">get_antialiased</span><span class="s2">() == </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">_antialiased</span>


<span class="s0">def </span><span class="s1">test_annotation_antialiased</span><span class="s2">():</span>
    <span class="s1">annot </span><span class="s2">= </span><span class="s1">Annotation</span><span class="s2">(</span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">bar&quot;</span><span class="s2">, (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">), </span><span class="s1">antialiased</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">annot</span><span class="s2">.</span><span class="s1">_antialiased </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">annot</span><span class="s2">.</span><span class="s1">get_antialiased</span><span class="s2">() == </span><span class="s1">annot</span><span class="s2">.</span><span class="s1">_antialiased</span>

    <span class="s1">annot2 </span><span class="s2">= </span><span class="s1">Annotation</span><span class="s2">(</span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">bar&quot;</span><span class="s2">, (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">), </span><span class="s1">antialiased</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">annot2</span><span class="s2">.</span><span class="s1">_antialiased </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">annot2</span><span class="s2">.</span><span class="s1">get_antialiased</span><span class="s2">() == </span><span class="s1">annot2</span><span class="s2">.</span><span class="s1">_antialiased</span>

    <span class="s1">annot3 </span><span class="s2">= </span><span class="s1">Annotation</span><span class="s2">(</span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">bar&quot;</span><span class="s2">, (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">), </span><span class="s1">antialiased</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">annot3</span><span class="s2">.</span><span class="s1">set_antialiased</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">annot3</span><span class="s2">.</span><span class="s1">get_antialiased</span><span class="s2">() </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">annot3</span><span class="s2">.</span><span class="s1">_antialiased </span><span class="s0">is True</span>

    <span class="s1">annot4 </span><span class="s2">= </span><span class="s1">Annotation</span><span class="s2">(</span><span class="s3">&quot;foo</span><span class="s0">\n</span><span class="s3">bar&quot;</span><span class="s2">, (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">annot4</span><span class="s2">.</span><span class="s1">_antialiased </span><span class="s2">== </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.antialiased'</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s3">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_annotate_and_offsetfrom_copy_input</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s5"># Both approaches place the text (10, 0) pixels away from the center of the line.</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">l</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">of_xy </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s1">OffsetFrom</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s1">of_xy</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">),</span>
                <span class="s1">xy</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">))  </span><span class="s5"># xy is unused.</span>
    <span class="s1">of_xy</span><span class="s2">[:] = </span><span class="s4">1</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">l</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">an_xy </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=</span><span class="s1">an_xy</span><span class="s2">, </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s1">l</span><span class="s2">, </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s3">&quot;offset points&quot;</span><span class="s2">)</span>
    <span class="s1">an_xy</span><span class="s2">[:] = </span><span class="s4">2</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_text_antialiased_off_default_vs_manual</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'6 inches x 2 inches'</span><span class="s2">,</span>
                             <span class="s1">antialiased</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.antialiased'</span><span class="s2">] = </span><span class="s0">False</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'6 inches x 2 inches'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_text_antialiased_on_default_vs_manual</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'6 inches x 2 inches'</span><span class="s2">, </span><span class="s1">antialiased</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s3">'text.antialiased'</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'6 inches x 2 inches'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_text_annotation_get_window_extent</span><span class="s2">():</span>
    <span class="s1">figure </span><span class="s2">= </span><span class="s1">Figure</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">RendererAgg</span><span class="s2">(</span><span class="s4">200</span><span class="s2">, </span><span class="s4">200</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>

    <span class="s5"># Only text annotation</span>
    <span class="s1">annotation </span><span class="s2">= </span><span class="s1">Annotation</span><span class="s2">(</span><span class="s3">'test'</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">)</span>
    <span class="s1">annotation</span><span class="s2">.</span><span class="s1">set_figure</span><span class="s2">(</span><span class="s1">figure</span><span class="s2">)</span>

    <span class="s1">text </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">text</span><span class="s2">=</span><span class="s3">'test'</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">text</span><span class="s2">.</span><span class="s1">set_figure</span><span class="s2">(</span><span class="s1">figure</span><span class="s2">)</span>

    <span class="s1">bbox </span><span class="s2">= </span><span class="s1">annotation</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">=</span><span class="s1">renderer</span><span class="s2">)</span>

    <span class="s1">text_bbox </span><span class="s2">= </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">=</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">width </span><span class="s2">== </span><span class="s1">text_bbox</span><span class="s2">.</span><span class="s1">width</span>
    <span class="s0">assert </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">height </span><span class="s2">== </span><span class="s1">text_bbox</span><span class="s2">.</span><span class="s1">height</span>

    <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">d </span><span class="s2">= </span><span class="s1">renderer</span><span class="s2">.</span><span class="s1">get_text_width_height_descent</span><span class="s2">(</span>
        <span class="s3">'text'</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">.</span><span class="s1">_fontproperties</span><span class="s2">, </span><span class="s1">ismath</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">lp_d </span><span class="s2">= </span><span class="s1">renderer</span><span class="s2">.</span><span class="s1">get_text_width_height_descent</span><span class="s2">(</span>
        <span class="s3">'lp'</span><span class="s2">, </span><span class="s1">annotation</span><span class="s2">.</span><span class="s1">_fontproperties</span><span class="s2">, </span><span class="s1">ismath</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">below_line </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">lp_d</span><span class="s2">)</span>

    <span class="s5"># These numbers are specific to the current implementation of Text</span>
    <span class="s1">points </span><span class="s2">= </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] == </span><span class="s4">0.0</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] == </span><span class="s1">text_bbox</span><span class="s2">.</span><span class="s1">width</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] == -</span><span class="s1">below_line</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] == </span><span class="s1">text_bbox</span><span class="s2">.</span><span class="s1">height </span><span class="s2">- </span><span class="s1">below_line</span>


<span class="s0">def </span><span class="s1">test_text_with_arrow_annotation_get_window_extent</span><span class="s2">():</span>
    <span class="s1">headwidth </span><span class="s2">= </span><span class="s4">21</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">txt </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">s</span><span class="s2">=</span><span class="s3">'test'</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">ann </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span>
        <span class="s3">'test'</span><span class="s2">,</span>
        <span class="s1">xy</span><span class="s2">=(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">50.0</span><span class="s2">),</span>
        <span class="s1">xytext</span><span class="s2">=(</span><span class="s4">50.0</span><span class="s2">, </span><span class="s4">50.0</span><span class="s2">), </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">,</span>
        <span class="s1">arrowprops</span><span class="s2">={</span>
            <span class="s3">'facecolor'</span><span class="s2">: </span><span class="s3">'black'</span><span class="s2">, </span><span class="s3">'width'</span><span class="s2">: </span><span class="s4">2</span><span class="s2">,</span>
            <span class="s3">'headwidth'</span><span class="s2">: </span><span class="s1">headwidth</span><span class="s2">, </span><span class="s3">'shrink'</span><span class="s2">: </span><span class="s4">0.0</span><span class="s2">})</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">renderer</span>
    <span class="s5"># bounding box of text</span>
    <span class="s1">text_bbox </span><span class="s2">= </span><span class="s1">txt</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">=</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s5"># bounding box of annotation (text + arrow)</span>
    <span class="s1">bbox </span><span class="s2">= </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">=</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s5"># bounding box of arrow</span>
    <span class="s1">arrow_bbox </span><span class="s2">= </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">arrow_patch</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s5"># bounding box of annotation text</span>
    <span class="s1">ann_txt_bbox </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">ann</span><span class="s2">)</span>

    <span class="s5"># make sure annotation width is 50 px wider than</span>
    <span class="s5"># just the text</span>
    <span class="s0">assert </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">width </span><span class="s2">== </span><span class="s1">text_bbox</span><span class="s2">.</span><span class="s1">width </span><span class="s2">+ </span><span class="s4">50.0</span>
    <span class="s5"># make sure the annotation text bounding box is same size</span>
    <span class="s5"># as the bounding box of the same string as a Text object</span>
    <span class="s0">assert </span><span class="s1">ann_txt_bbox</span><span class="s2">.</span><span class="s1">height </span><span class="s2">== </span><span class="s1">text_bbox</span><span class="s2">.</span><span class="s1">height</span>
    <span class="s0">assert </span><span class="s1">ann_txt_bbox</span><span class="s2">.</span><span class="s1">width </span><span class="s2">== </span><span class="s1">text_bbox</span><span class="s2">.</span><span class="s1">width</span>
    <span class="s5"># compute the expected bounding box of arrow + text</span>
    <span class="s1">expected_bbox </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">union</span><span class="s2">([</span><span class="s1">ann_txt_bbox</span><span class="s2">, </span><span class="s1">arrow_bbox</span><span class="s2">])</span>
    <span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">height</span><span class="s2">, </span><span class="s1">expected_bbox</span><span class="s2">.</span><span class="s1">height</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_arrow_annotation_get_window_extent</span><span class="s2">():</span>
    <span class="s1">dpi </span><span class="s2">= </span><span class="s4">100</span>
    <span class="s1">dots_per_point </span><span class="s2">= </span><span class="s1">dpi </span><span class="s2">/ </span><span class="s4">72</span>
    <span class="s1">figure </span><span class="s2">= </span><span class="s1">Figure</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s1">dpi</span><span class="s2">)</span>
    <span class="s1">figure</span><span class="s2">.</span><span class="s1">set_figwidth</span><span class="s2">(</span><span class="s4">2.0</span><span class="s2">)</span>
    <span class="s1">figure</span><span class="s2">.</span><span class="s1">set_figheight</span><span class="s2">(</span><span class="s4">2.0</span><span class="s2">)</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">RendererAgg</span><span class="s2">(</span><span class="s4">200</span><span class="s2">, </span><span class="s4">200</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>

    <span class="s5"># Text annotation with arrow; arrow dimensions are in points</span>
    <span class="s1">annotation </span><span class="s2">= </span><span class="s1">Annotation</span><span class="s2">(</span>
        <span class="s3">''</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">50.0</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s4">50.0</span><span class="s2">, </span><span class="s4">50.0</span><span class="s2">), </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">,</span>
        <span class="s1">arrowprops</span><span class="s2">={</span>
            <span class="s3">'facecolor'</span><span class="s2">: </span><span class="s3">'black'</span><span class="s2">, </span><span class="s3">'width'</span><span class="s2">: </span><span class="s4">8</span><span class="s2">, </span><span class="s3">'headwidth'</span><span class="s2">: </span><span class="s4">10</span><span class="s2">, </span><span class="s3">'shrink'</span><span class="s2">: </span><span class="s4">0.0</span><span class="s2">})</span>
    <span class="s1">annotation</span><span class="s2">.</span><span class="s1">set_figure</span><span class="s2">(</span><span class="s1">figure</span><span class="s2">)</span>
    <span class="s1">annotation</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>

    <span class="s1">bbox </span><span class="s2">= </span><span class="s1">annotation</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>
    <span class="s1">points </span><span class="s2">= </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">width </span><span class="s2">== </span><span class="s4">50.0</span>
    <span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">height</span><span class="s2">, </span><span class="s4">10.0 </span><span class="s2">* </span><span class="s1">dots_per_point</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] == </span><span class="s4">0.0</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] == </span><span class="s4">50.0 </span><span class="s2">- </span><span class="s4">5 </span><span class="s2">* </span><span class="s1">dots_per_point</span>


<span class="s0">def </span><span class="s1">test_empty_annotation_get_window_extent</span><span class="s2">():</span>
    <span class="s1">figure </span><span class="s2">= </span><span class="s1">Figure</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">figure</span><span class="s2">.</span><span class="s1">set_figwidth</span><span class="s2">(</span><span class="s4">2.0</span><span class="s2">)</span>
    <span class="s1">figure</span><span class="s2">.</span><span class="s1">set_figheight</span><span class="s2">(</span><span class="s4">2.0</span><span class="s2">)</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">RendererAgg</span><span class="s2">(</span><span class="s4">200</span><span class="s2">, </span><span class="s4">200</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>

    <span class="s5"># Text annotation with arrow</span>
    <span class="s1">annotation </span><span class="s2">= </span><span class="s1">Annotation</span><span class="s2">(</span>
        <span class="s3">''</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">50.0</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">50.0</span><span class="s2">), </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s3">'figure pixels'</span><span class="s2">)</span>
    <span class="s1">annotation</span><span class="s2">.</span><span class="s1">set_figure</span><span class="s2">(</span><span class="s1">figure</span><span class="s2">)</span>
    <span class="s1">annotation</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>

    <span class="s1">bbox </span><span class="s2">= </span><span class="s1">annotation</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>
    <span class="s1">points </span><span class="s2">= </span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] == </span><span class="s4">0.0</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] == </span><span class="s4">0.0</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] == </span><span class="s4">50.0</span>
    <span class="s0">assert </span><span class="s1">points</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] == </span><span class="s4">50.0</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span><span class="s1">baseline_images</span><span class="s2">=[</span><span class="s3">'basictext_wrap'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s3">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_basic_wrap</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">])</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s3">&quot;This is a really long string that I'd rather have wrapped so that&quot; </span><span class="s1">\</span>
        <span class="s3">&quot; it doesn't go outside of the figure, but if it's long enough it&quot; </span><span class="s1">\</span>
        <span class="s3">&quot; will go off the top or bottom!&quot;</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s4">15</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s4">15</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'right'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=-</span><span class="s4">15</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">18</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'oblique'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">,</span>
             <span class="s1">va</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">family</span><span class="s2">=</span><span class="s3">'serif'</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'italic'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'right'</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=-</span><span class="s4">15</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span><span class="s1">baseline_images</span><span class="s2">=[</span><span class="s3">'fonttext_wrap'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s3">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_font_wrap</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">])</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s3">&quot;This is a really long string that I'd rather have wrapped so that&quot; </span><span class="s1">\</span>
        <span class="s3">&quot; it doesn't go outside of the figure, but if it's long enough it&quot; </span><span class="s1">\</span>
        <span class="s3">&quot; will go off the top or bottom!&quot;</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">18</span><span class="s2">, </span><span class="s1">family</span><span class="s2">=</span><span class="s3">'serif'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s4">15</span><span class="s2">,</span>
             <span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">family</span><span class="s2">=</span><span class="s3">'sans serif'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s4">15</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">weight</span><span class="s2">=</span><span class="s3">'heavy'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'center'</span><span class="s2">, </span><span class="s1">va</span><span class="s2">=</span><span class="s3">'top'</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">family</span><span class="s2">=</span><span class="s3">'monospace'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'right'</span><span class="s2">, </span><span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">14</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s3">'italic'</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s3">'left'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=-</span><span class="s4">15</span><span class="s2">,</span>
             <span class="s1">wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
</pre>
</body>
</html>