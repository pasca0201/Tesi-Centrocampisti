<html>
<head>
<title>test_lines.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_lines.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests specific to the lines module. 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">itertools</span>
<span class="s2">import </span><span class="s1">platform</span>
<span class="s2">import </span><span class="s1">timeit</span>
<span class="s2">from </span><span class="s1">types </span><span class="s2">import </span><span class="s1">SimpleNamespace</span>

<span class="s2">from </span><span class="s1">cycler </span><span class="s2">import </span><span class="s1">cycler</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">testing </span><span class="s2">import </span><span class="s1">assert_array_equal</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">import </span><span class="s1">matplotlib</span>
<span class="s2">import </span><span class="s1">matplotlib </span><span class="s2">as </span><span class="s1">mpl</span>
<span class="s2">from </span><span class="s1">matplotlib </span><span class="s2">import </span><span class="s1">_path</span>
<span class="s2">import </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">lines </span><span class="s2">as </span><span class="s1">mlines</span>
<span class="s2">from </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">markers </span><span class="s2">import </span><span class="s1">MarkerStyle</span>
<span class="s2">from </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">path </span><span class="s2">import </span><span class="s1">Path</span>
<span class="s2">import </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">pyplot </span><span class="s2">as </span><span class="s1">plt</span>
<span class="s2">import </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">transforms </span><span class="s2">as </span><span class="s1">mtransforms</span>
<span class="s2">from </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">testing</span><span class="s3">.</span><span class="s1">decorators </span><span class="s2">import </span><span class="s1">image_comparison</span><span class="s3">, </span><span class="s1">check_figures_equal</span>


<span class="s2">def </span><span class="s1">test_segment_hits</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot;Test a problematic case.&quot;&quot;&quot;</span>
    <span class="s1">cx</span><span class="s3">, </span><span class="s1">cy </span><span class="s3">= </span><span class="s4">553</span><span class="s3">, </span><span class="s4">902</span>
    <span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">553.</span><span class="s3">, </span><span class="s4">553.</span><span class="s3">]), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">95.</span><span class="s3">, </span><span class="s4">947.</span><span class="s3">])</span>
    <span class="s1">radius </span><span class="s3">= </span><span class="s4">6.94</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">segment_hits</span><span class="s3">(</span><span class="s1">cx</span><span class="s3">, </span><span class="s1">cy</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">radius</span><span class="s3">), [</span><span class="s4">0</span><span class="s3">])</span>


<span class="s5"># Runtimes on a loaded system are inherently flaky. Not so much that a rerun</span>
<span class="s5"># won't help, hopefully.</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">flaky</span><span class="s3">(</span><span class="s1">reruns</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_invisible_Line_rendering</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot; 
    GitHub issue #1256 identified a bug in Line.draw method 
 
    Despite visibility attribute set to False, the draw method was not 
    returning early enough and some pre-rendering code was executed 
    though not necessary. 
 
    Consequence was an excessive draw time for invisible Line instances 
    holding a large number of points (Npts&gt; 10**6) 
    &quot;&quot;&quot;</span>
    <span class="s5"># Creates big x and y data:</span>
    <span class="s1">N </span><span class="s3">= </span><span class="s4">10</span><span class="s3">**</span><span class="s4">7</span>
    <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">N</span><span class="s3">)</span>
    <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">normal</span><span class="s3">(</span><span class="s1">size</span><span class="s3">=</span><span class="s1">N</span><span class="s3">)</span>

    <span class="s5"># Create a plot figure:</span>
    <span class="s1">fig </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">figure</span><span class="s3">()</span>
    <span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplot</span><span class="s3">()</span>

    <span class="s5"># Create a &quot;big&quot; Line instance:</span>
    <span class="s1">l </span><span class="s3">= </span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
    <span class="s1">l</span><span class="s3">.</span><span class="s1">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
    <span class="s5"># but don't add it to the Axis instance `ax`</span>

    <span class="s5"># [here Interactive panning and zooming is pretty responsive]</span>
    <span class="s5"># Time the canvas drawing:</span>
    <span class="s1">t_no_line </span><span class="s3">= </span><span class="s1">min</span><span class="s3">(</span><span class="s1">timeit</span><span class="s3">.</span><span class="s1">repeat</span><span class="s3">(</span><span class="s1">fig</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">, </span><span class="s1">number</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">repeat</span><span class="s3">=</span><span class="s4">3</span><span class="s3">))</span>
    <span class="s5"># (gives about 25 ms)</span>

    <span class="s5"># Add the big invisible Line:</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">add_line</span><span class="s3">(</span><span class="s1">l</span><span class="s3">)</span>

    <span class="s5"># [Now interactive panning and zooming is very slow]</span>
    <span class="s5"># Time the canvas drawing:</span>
    <span class="s1">t_invisible_line </span><span class="s3">= </span><span class="s1">min</span><span class="s3">(</span><span class="s1">timeit</span><span class="s3">.</span><span class="s1">repeat</span><span class="s3">(</span><span class="s1">fig</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">, </span><span class="s1">number</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">repeat</span><span class="s3">=</span><span class="s4">3</span><span class="s3">))</span>
    <span class="s5"># gives about 290 ms for N = 10**7 pts</span>

    <span class="s1">slowdown_factor </span><span class="s3">= </span><span class="s1">t_invisible_line </span><span class="s3">/ </span><span class="s1">t_no_line</span>
    <span class="s1">slowdown_threshold </span><span class="s3">= </span><span class="s4">2  </span><span class="s5"># trying to avoid false positive failures</span>
    <span class="s2">assert </span><span class="s1">slowdown_factor </span><span class="s3">&lt; </span><span class="s1">slowdown_threshold</span>


<span class="s2">def </span><span class="s1">test_set_line_coll_dash</span><span class="s3">():</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">seed</span><span class="s3">(</span><span class="s4">0</span><span class="s3">)</span>
    <span class="s5"># Testing setting linestyles for line collections.</span>
    <span class="s5"># This should not produce an error.</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">contour</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">randn</span><span class="s3">(</span><span class="s4">20</span><span class="s3">, </span><span class="s4">30</span><span class="s3">), </span><span class="s1">linestyles</span><span class="s3">=[(</span><span class="s4">0</span><span class="s3">, (</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">))])</span>


<span class="s2">def </span><span class="s1">test_invalid_line_data</span><span class="s3">():</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">RuntimeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s6">'xdata must be'</span><span class="s3">):</span>
        <span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, [])</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">RuntimeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s6">'ydata must be'</span><span class="s3">):</span>
        <span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">([], </span><span class="s4">1</span><span class="s3">)</span>

    <span class="s1">line </span><span class="s3">= </span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">([], [])</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">RuntimeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s6">'x must be'</span><span class="s3">):</span>
        <span class="s1">line</span><span class="s3">.</span><span class="s1">set_xdata</span><span class="s3">(</span><span class="s4">0</span><span class="s3">)</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">RuntimeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s6">'y must be'</span><span class="s3">):</span>
        <span class="s1">line</span><span class="s3">.</span><span class="s1">set_ydata</span><span class="s3">(</span><span class="s4">0</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">image_comparison</span><span class="s3">([</span><span class="s6">'line_dashes'</span><span class="s3">], </span><span class="s1">remove_text</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">tol</span><span class="s3">=</span><span class="s4">0.003</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_line_dashes</span><span class="s3">():</span>
    <span class="s5"># Tolerance introduced after reordering of floating-point operations</span>
    <span class="s5"># Remove when regenerating the images</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>

    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">linestyle</span><span class="s3">=(</span><span class="s4">0</span><span class="s3">, (</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">)), </span><span class="s1">lw</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_line_colors</span><span class="s3">():</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">color</span><span class="s3">=</span><span class="s6">'none'</span><span class="s3">)</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">color</span><span class="s3">=</span><span class="s6">'r'</span><span class="s3">)</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">color</span><span class="s3">=</span><span class="s6">'.3'</span><span class="s3">)</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">color</span><span class="s3">=(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">))</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">color</span><span class="s3">=(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">))</span>
    <span class="s1">fig</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">()</span>


<span class="s2">def </span><span class="s1">test_valid_colors</span><span class="s3">():</span>
    <span class="s1">line </span><span class="s3">= </span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">([], [])</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">):</span>
        <span class="s1">line</span><span class="s3">.</span><span class="s1">set_color</span><span class="s3">(</span><span class="s6">&quot;foobar&quot;</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_linestyle_variants</span><span class="s3">():</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s2">for </span><span class="s1">ls </span><span class="s2">in </span><span class="s3">[</span><span class="s6">&quot;-&quot;</span><span class="s3">, </span><span class="s6">&quot;solid&quot;</span><span class="s3">, </span><span class="s6">&quot;--&quot;</span><span class="s3">, </span><span class="s6">&quot;dashed&quot;</span><span class="s3">,</span>
               <span class="s6">&quot;-.&quot;</span><span class="s3">, </span><span class="s6">&quot;dashdot&quot;</span><span class="s3">, </span><span class="s6">&quot;:&quot;</span><span class="s3">, </span><span class="s6">&quot;dotted&quot;</span><span class="s3">,</span>
               <span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s2">None</span><span class="s3">), (</span><span class="s4">0</span><span class="s3">, ()), (</span><span class="s4">0</span><span class="s3">, []),  </span><span class="s5"># gh-22930</span>
               <span class="s3">]:</span>
        <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">linestyle</span><span class="s3">=</span><span class="s1">ls</span><span class="s3">)</span>
    <span class="s1">fig</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">()</span>


<span class="s2">def </span><span class="s1">test_valid_linestyles</span><span class="s3">():</span>
    <span class="s1">line </span><span class="s3">= </span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">([], [])</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">):</span>
        <span class="s1">line</span><span class="s3">.</span><span class="s1">set_linestyle</span><span class="s3">(</span><span class="s6">'aardvark'</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">image_comparison</span><span class="s3">([</span><span class="s6">'drawstyle_variants.png'</span><span class="s3">], </span><span class="s1">remove_text</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                  <span class="s1">tol</span><span class="s3">=</span><span class="s4">0.03 </span><span class="s2">if </span><span class="s1">platform</span><span class="s3">.</span><span class="s1">machine</span><span class="s3">() == </span><span class="s6">'arm64' </span><span class="s2">else </span><span class="s4">0</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_drawstyle_variants</span><span class="s3">():</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">axs </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">(</span><span class="s4">6</span><span class="s3">)</span>
    <span class="s1">dss </span><span class="s3">= [</span><span class="s6">&quot;default&quot;</span><span class="s3">, </span><span class="s6">&quot;steps-mid&quot;</span><span class="s3">, </span><span class="s6">&quot;steps-pre&quot;</span><span class="s3">, </span><span class="s6">&quot;steps-post&quot;</span><span class="s3">, </span><span class="s6">&quot;steps&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">]</span>
    <span class="s5"># We want to check that drawstyles are properly handled even for very long</span>
    <span class="s5"># lines (for which the subslice optimization is on); however, we need</span>
    <span class="s5"># to zoom in so that the difference between the drawstyles is actually</span>
    <span class="s5"># visible.</span>
    <span class="s2">for </span><span class="s1">ax</span><span class="s3">, </span><span class="s1">ds </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">axs</span><span class="s3">.</span><span class="s1">flat</span><span class="s3">, </span><span class="s1">dss</span><span class="s3">):</span>
        <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">2000</span><span class="s3">), </span><span class="s1">drawstyle</span><span class="s3">=</span><span class="s1">ds</span><span class="s3">)</span>
        <span class="s1">ax</span><span class="s3">.</span><span class="s1">set</span><span class="s3">(</span><span class="s1">xlim</span><span class="s3">=(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">), </span><span class="s1">ylim</span><span class="s3">=(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">))</span>


<span class="s3">@</span><span class="s1">check_figures_equal</span><span class="s3">(</span><span class="s1">extensions</span><span class="s3">=(</span><span class="s6">'png'</span><span class="s3">,))</span>
<span class="s2">def </span><span class="s1">test_no_subslice_with_transform</span><span class="s3">(</span><span class="s1">fig_ref</span><span class="s3">, </span><span class="s1">fig_test</span><span class="s3">):</span>
    <span class="s1">ax </span><span class="s3">= </span><span class="s1">fig_ref</span><span class="s3">.</span><span class="s1">add_subplot</span><span class="s3">()</span>
    <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">2000</span><span class="s3">)</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">x </span><span class="s3">+ </span><span class="s4">2000</span><span class="s3">, </span><span class="s1">x</span><span class="s3">)</span>

    <span class="s1">ax </span><span class="s3">= </span><span class="s1">fig_test</span><span class="s3">.</span><span class="s1">add_subplot</span><span class="s3">()</span>
    <span class="s1">t </span><span class="s3">= </span><span class="s1">mtransforms</span><span class="s3">.</span><span class="s1">Affine2D</span><span class="s3">().</span><span class="s1">translate</span><span class="s3">(</span><span class="s4">2000.0</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">)</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">transform</span><span class="s3">=</span><span class="s1">t</span><span class="s3">+</span><span class="s1">ax</span><span class="s3">.</span><span class="s1">transData</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_valid_drawstyles</span><span class="s3">():</span>
    <span class="s1">line </span><span class="s3">= </span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">([], [])</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">):</span>
        <span class="s1">line</span><span class="s3">.</span><span class="s1">set_drawstyle</span><span class="s3">(</span><span class="s6">'foobar'</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_set_drawstyle</span><span class="s3">():</span>
    <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">*</span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">10</span><span class="s3">)</span>
    <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">sin</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>

    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">line</span><span class="s3">, = </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
    <span class="s1">line</span><span class="s3">.</span><span class="s1">set_drawstyle</span><span class="s3">(</span><span class="s6">&quot;steps-pre&quot;</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">line</span><span class="s3">.</span><span class="s1">get_path</span><span class="s3">().</span><span class="s1">vertices</span><span class="s3">) == </span><span class="s4">2</span><span class="s3">*</span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)-</span><span class="s4">1</span>

    <span class="s1">line</span><span class="s3">.</span><span class="s1">set_drawstyle</span><span class="s3">(</span><span class="s6">&quot;default&quot;</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">line</span><span class="s3">.</span><span class="s1">get_path</span><span class="s3">().</span><span class="s1">vertices</span><span class="s3">) == </span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">image_comparison</span><span class="s3">(</span>
    <span class="s3">[</span><span class="s6">'line_collection_dashes'</span><span class="s3">], </span><span class="s1">remove_text</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">style</span><span class="s3">=</span><span class="s6">'mpl20'</span><span class="s3">,</span>
    <span class="s1">tol</span><span class="s3">=</span><span class="s4">0 </span><span class="s2">if </span><span class="s1">platform</span><span class="s3">.</span><span class="s1">machine</span><span class="s3">() == </span><span class="s6">'x86_64' </span><span class="s2">else </span><span class="s4">0.65</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_set_line_coll_dash_image</span><span class="s3">():</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">seed</span><span class="s3">(</span><span class="s4">0</span><span class="s3">)</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">contour</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">randn</span><span class="s3">(</span><span class="s4">20</span><span class="s3">, </span><span class="s4">30</span><span class="s3">), </span><span class="s1">linestyles</span><span class="s3">=[(</span><span class="s4">0</span><span class="s3">, (</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">))])</span>


<span class="s3">@</span><span class="s1">image_comparison</span><span class="s3">([</span><span class="s6">'marker_fill_styles.png'</span><span class="s3">], </span><span class="s1">remove_text</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_marker_fill_styles</span><span class="s3">():</span>
    <span class="s1">colors </span><span class="s3">= </span><span class="s1">itertools</span><span class="s3">.</span><span class="s1">cycle</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], </span><span class="s6">'g'</span><span class="s3">, </span><span class="s6">'#ff0000'</span><span class="s3">, </span><span class="s6">'c'</span><span class="s3">, </span><span class="s6">'m'</span><span class="s3">, </span><span class="s6">'y'</span><span class="s3">,</span>
                              <span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">])])</span>
    <span class="s1">altcolor </span><span class="s3">= </span><span class="s6">'lightgreen'</span>

    <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
    <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">9</span><span class="s3">])</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>

    <span class="s5"># This hard-coded list of markers correspond to an earlier iteration of</span>
    <span class="s5"># MarkerStyle.filled_markers; the value of that attribute has changed but</span>
    <span class="s5"># we kept the old value here to not regenerate the baseline image.</span>
    <span class="s5"># Replace with mlines.Line2D.filled_markers when the image is regenerated.</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s3">, </span><span class="s1">marker </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s6">&quot;ov^&lt;&gt;8sp*hHDdPX&quot;</span><span class="s3">):</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">fs </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">.</span><span class="s1">fillStyles</span><span class="s3">):</span>
            <span class="s1">color </span><span class="s3">= </span><span class="s1">next</span><span class="s3">(</span><span class="s1">colors</span><span class="s3">)</span>
            <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">j </span><span class="s3">* </span><span class="s4">10 </span><span class="s3">+ </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s3">+ </span><span class="s1">i </span><span class="s3">+ </span><span class="s4">.5 </span><span class="s3">* (</span><span class="s1">j </span><span class="s3">% </span><span class="s4">2</span><span class="s3">),</span>
                    <span class="s1">marker</span><span class="s3">=</span><span class="s1">marker</span><span class="s3">,</span>
                    <span class="s1">markersize</span><span class="s3">=</span><span class="s4">20</span><span class="s3">,</span>
                    <span class="s1">markerfacecoloralt</span><span class="s3">=</span><span class="s1">altcolor</span><span class="s3">,</span>
                    <span class="s1">fillstyle</span><span class="s3">=</span><span class="s1">fs</span><span class="s3">,</span>
                    <span class="s1">label</span><span class="s3">=</span><span class="s1">fs</span><span class="s3">,</span>
                    <span class="s1">linewidth</span><span class="s3">=</span><span class="s4">5</span><span class="s3">,</span>
                    <span class="s1">color</span><span class="s3">=</span><span class="s1">color</span><span class="s3">,</span>
                    <span class="s1">markeredgecolor</span><span class="s3">=</span><span class="s1">color</span><span class="s3">,</span>
                    <span class="s1">markeredgewidth</span><span class="s3">=</span><span class="s4">2</span><span class="s3">)</span>

    <span class="s1">ax</span><span class="s3">.</span><span class="s1">set_ylim</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">7.5</span><span class="s3">])</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">set_xlim</span><span class="s3">([-</span><span class="s4">5</span><span class="s3">, </span><span class="s4">155</span><span class="s3">])</span>


<span class="s2">def </span><span class="s1">test_markerfacecolor_fillstyle</span><span class="s3">():</span>
    <span class="s0">&quot;&quot;&quot;Test that markerfacecolor does not override fillstyle='none'.&quot;&quot;&quot;</span>
    <span class="s1">l</span><span class="s3">, = </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], </span><span class="s1">marker</span><span class="s3">=</span><span class="s1">MarkerStyle</span><span class="s3">(</span><span class="s6">'o'</span><span class="s3">, </span><span class="s1">fillstyle</span><span class="s3">=</span><span class="s6">'none'</span><span class="s3">),</span>
                  <span class="s1">markerfacecolor</span><span class="s3">=</span><span class="s6">'red'</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">l</span><span class="s3">.</span><span class="s1">get_fillstyle</span><span class="s3">() == </span><span class="s6">'none'</span>
    <span class="s2">assert </span><span class="s1">l</span><span class="s3">.</span><span class="s1">get_markerfacecolor</span><span class="s3">() == </span><span class="s6">'none'</span>


<span class="s3">@</span><span class="s1">image_comparison</span><span class="s3">([</span><span class="s6">'scaled_lines'</span><span class="s3">], </span><span class="s1">style</span><span class="s3">=</span><span class="s6">'default'</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_lw_scaling</span><span class="s3">():</span>
    <span class="s1">th </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">32</span><span class="s3">)</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">lins_styles </span><span class="s3">= [</span><span class="s6">'dashed'</span><span class="s3">, </span><span class="s6">'dotted'</span><span class="s3">, </span><span class="s6">'dashdot'</span><span class="s3">]</span>
    <span class="s1">cy </span><span class="s3">= </span><span class="s1">cycler</span><span class="s3">(</span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">rcParams</span><span class="s3">[</span><span class="s6">'axes.prop_cycle'</span><span class="s3">])</span>
    <span class="s2">for </span><span class="s1">j</span><span class="s3">, (</span><span class="s1">ls</span><span class="s3">, </span><span class="s1">sty</span><span class="s3">) </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(</span><span class="s1">lins_styles</span><span class="s3">, </span><span class="s1">cy</span><span class="s3">)):</span>
        <span class="s2">for </span><span class="s1">lw </span><span class="s2">in </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">.5</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">10</span><span class="s3">):</span>
            <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">th</span><span class="s3">, </span><span class="s1">j</span><span class="s3">*</span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">(</span><span class="s4">50</span><span class="s3">) + </span><span class="s4">.1 </span><span class="s3">* </span><span class="s1">lw</span><span class="s3">, </span><span class="s1">linestyle</span><span class="s3">=</span><span class="s1">ls</span><span class="s3">, </span><span class="s1">lw</span><span class="s3">=</span><span class="s1">lw</span><span class="s3">, **</span><span class="s1">sty</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_is_sorted_and_has_non_nan</span><span class="s3">():</span>
    <span class="s2">assert </span><span class="s1">_path</span><span class="s3">.</span><span class="s1">is_sorted_and_has_non_nan</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">]))</span>
    <span class="s2">assert </span><span class="s1">_path</span><span class="s3">.</span><span class="s1">is_sorted_and_has_non_nan</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s4">3</span><span class="s3">]))</span>
    <span class="s2">assert not </span><span class="s1">_path</span><span class="s3">.</span><span class="s1">is_sorted_and_has_non_nan</span><span class="s3">([</span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">] + [</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">] * </span><span class="s4">100 </span><span class="s3">+ [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">])</span>
    <span class="s5"># [2, 256] byteswapped:</span>
    <span class="s2">assert not </span><span class="s1">_path</span><span class="s3">.</span><span class="s1">is_sorted_and_has_non_nan</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">33554432</span><span class="s3">, </span><span class="s4">65536</span><span class="s3">], </span><span class="s6">&quot;&gt;i4&quot;</span><span class="s3">))</span>
    <span class="s1">n </span><span class="s3">= </span><span class="s4">2 </span><span class="s3">* </span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">.</span><span class="s1">_subslice_optim_min_size</span>
    <span class="s1">plt</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">([</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">] * </span><span class="s1">n</span><span class="s3">, </span><span class="s1">range</span><span class="s3">(</span><span class="s1">n</span><span class="s3">))</span>


<span class="s3">@</span><span class="s1">check_figures_equal</span><span class="s3">()</span>
<span class="s2">def </span><span class="s1">test_step_markers</span><span class="s3">(</span><span class="s1">fig_test</span><span class="s3">, </span><span class="s1">fig_ref</span><span class="s3">):</span>
    <span class="s1">fig_test</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">().</span><span class="s1">step</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], </span><span class="s6">&quot;-o&quot;</span><span class="s3">)</span>
    <span class="s1">fig_ref</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">().</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], </span><span class="s6">&quot;-o&quot;</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">])</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s6">&quot;parent&quot;</span><span class="s3">, [</span><span class="s6">&quot;figure&quot;</span><span class="s3">, </span><span class="s6">&quot;axes&quot;</span><span class="s3">])</span>
<span class="s3">@</span><span class="s1">check_figures_equal</span><span class="s3">(</span><span class="s1">extensions</span><span class="s3">=(</span><span class="s6">'png'</span><span class="s3">,))</span>
<span class="s2">def </span><span class="s1">test_markevery</span><span class="s3">(</span><span class="s1">fig_test</span><span class="s3">, </span><span class="s1">fig_ref</span><span class="s3">, </span><span class="s1">parent</span><span class="s3">):</span>
    <span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">seed</span><span class="s3">(</span><span class="s4">42</span><span class="s3">)</span>
    <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">14</span><span class="s3">)</span>
    <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">rand</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">))</span>

    <span class="s1">cases_test </span><span class="s3">= [</span><span class="s2">None</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, (</span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">), [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">11</span><span class="s3">],</span>
                  <span class="s3">[</span><span class="s4">0</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">], </span><span class="s1">slice</span><span class="s3">(</span><span class="s4">5</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">2</span><span class="s3">),</span>
                  <span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">))[</span><span class="s1">y </span><span class="s3">&gt; </span><span class="s4">0.5</span><span class="s3">],</span>
                  <span class="s4">0.3</span><span class="s3">, (</span><span class="s4">0.3</span><span class="s3">, </span><span class="s4">0.4</span><span class="s3">)]</span>
    <span class="s1">cases_ref </span><span class="s3">= [</span><span class="s6">&quot;11111111111111&quot;</span><span class="s3">, </span><span class="s6">&quot;10001000100010&quot;</span><span class="s3">, </span><span class="s6">&quot;00100001000010&quot;</span><span class="s3">,</span>
                 <span class="s6">&quot;01000100000100&quot;</span><span class="s3">, </span><span class="s6">&quot;10000000000001&quot;</span><span class="s3">, </span><span class="s6">&quot;00000101010000&quot;</span><span class="s3">,</span>
                 <span class="s6">&quot;01110001110110&quot;</span><span class="s3">, </span><span class="s6">&quot;11011011011110&quot;</span><span class="s3">, </span><span class="s6">&quot;01010011011101&quot;</span><span class="s3">]</span>

    <span class="s2">if </span><span class="s1">parent </span><span class="s3">== </span><span class="s6">&quot;figure&quot;</span><span class="s3">:</span>
        <span class="s5"># float markevery (&quot;relative to axes size&quot;) is not supported.</span>
        <span class="s1">cases_test </span><span class="s3">= </span><span class="s1">cases_test</span><span class="s3">[:-</span><span class="s4">2</span><span class="s3">]</span>
        <span class="s1">cases_ref </span><span class="s3">= </span><span class="s1">cases_ref</span><span class="s3">[:-</span><span class="s4">2</span><span class="s3">]</span>

        <span class="s2">def </span><span class="s1">add_test</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, *, </span><span class="s1">markevery</span><span class="s3">):</span>
            <span class="s1">fig_test</span><span class="s3">.</span><span class="s1">add_artist</span><span class="s3">(</span>
                <span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">marker</span><span class="s3">=</span><span class="s6">&quot;o&quot;</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">markevery</span><span class="s3">))</span>

        <span class="s2">def </span><span class="s1">add_ref</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, *, </span><span class="s1">markevery</span><span class="s3">):</span>
            <span class="s1">fig_ref</span><span class="s3">.</span><span class="s1">add_artist</span><span class="s3">(</span>
                <span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">marker</span><span class="s3">=</span><span class="s6">&quot;o&quot;</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">markevery</span><span class="s3">))</span>

    <span class="s2">elif </span><span class="s1">parent </span><span class="s3">== </span><span class="s6">&quot;axes&quot;</span><span class="s3">:</span>
        <span class="s1">axs_test </span><span class="s3">= </span><span class="s1">iter</span><span class="s3">(</span><span class="s1">fig_test</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">).</span><span class="s1">flat</span><span class="s3">)</span>
        <span class="s1">axs_ref </span><span class="s3">= </span><span class="s1">iter</span><span class="s3">(</span><span class="s1">fig_ref</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">).</span><span class="s1">flat</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">add_test</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, *, </span><span class="s1">markevery</span><span class="s3">):</span>
            <span class="s1">next</span><span class="s3">(</span><span class="s1">axs_test</span><span class="s3">).</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s6">&quot;-gD&quot;</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">markevery</span><span class="s3">)</span>

        <span class="s2">def </span><span class="s1">add_ref</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, *, </span><span class="s1">markevery</span><span class="s3">):</span>
            <span class="s1">next</span><span class="s3">(</span><span class="s1">axs_ref</span><span class="s3">).</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s6">&quot;-gD&quot;</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">markevery</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">case </span><span class="s2">in </span><span class="s1">cases_test</span><span class="s3">:</span>
        <span class="s1">add_test</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">case</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">case </span><span class="s2">in </span><span class="s1">cases_ref</span><span class="s3">:</span>
        <span class="s1">me </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">list</span><span class="s3">(</span><span class="s1">case</span><span class="s3">)).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">int</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">bool</span><span class="s3">)</span>
        <span class="s1">add_ref</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">me</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_markevery_figure_line_unsupported_relsize</span><span class="s3">():</span>
    <span class="s1">fig </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">figure</span><span class="s3">()</span>
    <span class="s1">fig</span><span class="s3">.</span><span class="s1">add_artist</span><span class="s3">(</span><span class="s1">mlines</span><span class="s3">.</span><span class="s1">Line2D</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], </span><span class="s1">marker</span><span class="s3">=</span><span class="s6">&quot;o&quot;</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s4">.5</span><span class="s3">))</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">):</span>
        <span class="s1">fig</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">()</span>


<span class="s2">def </span><span class="s1">test_marker_as_markerstyle</span><span class="s3">():</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">line</span><span class="s3">, = </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">3</span><span class="s3">], </span><span class="s1">marker</span><span class="s3">=</span><span class="s1">MarkerStyle</span><span class="s3">(</span><span class="s6">&quot;D&quot;</span><span class="s3">))</span>
    <span class="s1">fig</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">line</span><span class="s3">.</span><span class="s1">get_marker</span><span class="s3">() == </span><span class="s6">&quot;D&quot;</span>

    <span class="s5"># continue with smoke tests:</span>
    <span class="s1">line</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s6">&quot;s&quot;</span><span class="s3">)</span>
    <span class="s1">fig</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">()</span>
    <span class="s1">line</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s1">MarkerStyle</span><span class="s3">(</span><span class="s6">&quot;o&quot;</span><span class="s3">))</span>
    <span class="s1">fig</span><span class="s3">.</span><span class="s1">canvas</span><span class="s3">.</span><span class="s1">draw</span><span class="s3">()</span>
    <span class="s5"># test Path roundtrip</span>
    <span class="s1">triangle1 </span><span class="s3">= </span><span class="s1">Path</span><span class="s3">.</span><span class="s1">_create_closed</span><span class="s3">([[-</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">]])</span>
    <span class="s1">line2</span><span class="s3">, = </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], </span><span class="s1">marker</span><span class="s3">=</span><span class="s1">MarkerStyle</span><span class="s3">(</span><span class="s1">triangle1</span><span class="s3">), </span><span class="s1">ms</span><span class="s3">=</span><span class="s4">22</span><span class="s3">)</span>
    <span class="s1">line3</span><span class="s3">, = </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], </span><span class="s1">marker</span><span class="s3">=</span><span class="s1">triangle1</span><span class="s3">, </span><span class="s1">ms</span><span class="s3">=</span><span class="s4">22</span><span class="s3">)</span>

    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">line2</span><span class="s3">.</span><span class="s1">get_marker</span><span class="s3">().</span><span class="s1">vertices</span><span class="s3">, </span><span class="s1">triangle1</span><span class="s3">.</span><span class="s1">vertices</span><span class="s3">)</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">line3</span><span class="s3">.</span><span class="s1">get_marker</span><span class="s3">().</span><span class="s1">vertices</span><span class="s3">, </span><span class="s1">triangle1</span><span class="s3">.</span><span class="s1">vertices</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">image_comparison</span><span class="s3">([</span><span class="s6">'striped_line.png'</span><span class="s3">], </span><span class="s1">remove_text</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">style</span><span class="s3">=</span><span class="s6">'mpl20'</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_striped_lines</span><span class="s3">():</span>
    <span class="s1">rng </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">default_rng</span><span class="s3">(</span><span class="s4">19680801</span><span class="s3">)</span>
    <span class="s1">_</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">.</span><span class="s1">uniform</span><span class="s3">(</span><span class="s1">size</span><span class="s3">=</span><span class="s4">12</span><span class="s3">), </span><span class="s1">color</span><span class="s3">=</span><span class="s6">'orange'</span><span class="s3">, </span><span class="s1">gapcolor</span><span class="s3">=</span><span class="s6">'blue'</span><span class="s3">,</span>
            <span class="s1">linestyle</span><span class="s3">=</span><span class="s6">'--'</span><span class="s3">, </span><span class="s1">lw</span><span class="s3">=</span><span class="s4">5</span><span class="s3">, </span><span class="s1">label</span><span class="s3">=</span><span class="s6">' '</span><span class="s3">)</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">.</span><span class="s1">uniform</span><span class="s3">(</span><span class="s1">size</span><span class="s3">=</span><span class="s4">12</span><span class="s3">), </span><span class="s1">color</span><span class="s3">=</span><span class="s6">'red'</span><span class="s3">, </span><span class="s1">gapcolor</span><span class="s3">=</span><span class="s6">'black'</span><span class="s3">,</span>
            <span class="s1">linestyle</span><span class="s3">=(</span><span class="s4">0</span><span class="s3">, (</span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">2</span><span class="s3">)), </span><span class="s1">lw</span><span class="s3">=</span><span class="s4">5</span><span class="s3">, </span><span class="s1">label</span><span class="s3">=</span><span class="s6">' '</span><span class="s3">, </span><span class="s1">alpha</span><span class="s3">=</span><span class="s4">0.5</span><span class="s3">)</span>
    <span class="s1">ax</span><span class="s3">.</span><span class="s1">legend</span><span class="s3">(</span><span class="s1">handlelength</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">check_figures_equal</span><span class="s3">()</span>
<span class="s2">def </span><span class="s1">test_odd_dashes</span><span class="s3">(</span><span class="s1">fig_test</span><span class="s3">, </span><span class="s1">fig_ref</span><span class="s3">):</span>
    <span class="s1">fig_test</span><span class="s3">.</span><span class="s1">add_subplot</span><span class="s3">().</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], </span><span class="s1">dashes</span><span class="s3">=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
    <span class="s1">fig_ref</span><span class="s3">.</span><span class="s1">add_subplot</span><span class="s3">().</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], </span><span class="s1">dashes</span><span class="s3">=[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>


<span class="s2">def </span><span class="s1">test_picking</span><span class="s3">():</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">mouse_event </span><span class="s3">= </span><span class="s1">SimpleNamespace</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">fig</span><span class="s3">.</span><span class="s1">bbox</span><span class="s3">.</span><span class="s1">width </span><span class="s3">// </span><span class="s4">2</span><span class="s3">,</span>
                                  <span class="s1">y</span><span class="s3">=</span><span class="s1">fig</span><span class="s3">.</span><span class="s1">bbox</span><span class="s3">.</span><span class="s1">height </span><span class="s3">// </span><span class="s4">2 </span><span class="s3">+ </span><span class="s4">15</span><span class="s3">)</span>

    <span class="s5"># Default pickradius is 5, so event should not pick this line.</span>
    <span class="s1">l0</span><span class="s3">, = </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], </span><span class="s1">picker</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
    <span class="s1">found</span><span class="s3">, </span><span class="s1">indices </span><span class="s3">= </span><span class="s1">l0</span><span class="s3">.</span><span class="s1">contains</span><span class="s3">(</span><span class="s1">mouse_event</span><span class="s3">)</span>
    <span class="s2">assert not </span><span class="s1">found</span>

    <span class="s5"># But with a larger pickradius, this should be picked.</span>
    <span class="s1">l1</span><span class="s3">, = </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], </span><span class="s1">picker</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">pickradius</span><span class="s3">=</span><span class="s4">20</span><span class="s3">)</span>
    <span class="s1">found</span><span class="s3">, </span><span class="s1">indices </span><span class="s3">= </span><span class="s1">l1</span><span class="s3">.</span><span class="s1">contains</span><span class="s3">(</span><span class="s1">mouse_event</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">found</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">indices</span><span class="s3">[</span><span class="s6">'ind'</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">])</span>

    <span class="s5"># And if we modify the pickradius after creation, it should work as well.</span>
    <span class="s1">l2</span><span class="s3">, = </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], </span><span class="s1">picker</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
    <span class="s1">found</span><span class="s3">, </span><span class="s1">indices </span><span class="s3">= </span><span class="s1">l2</span><span class="s3">.</span><span class="s1">contains</span><span class="s3">(</span><span class="s1">mouse_event</span><span class="s3">)</span>
    <span class="s2">assert not </span><span class="s1">found</span>
    <span class="s1">l2</span><span class="s3">.</span><span class="s1">set_pickradius</span><span class="s3">(</span><span class="s4">20</span><span class="s3">)</span>
    <span class="s1">found</span><span class="s3">, </span><span class="s1">indices </span><span class="s3">= </span><span class="s1">l2</span><span class="s3">.</span><span class="s1">contains</span><span class="s3">(</span><span class="s1">mouse_event</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">found</span>
    <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">indices</span><span class="s3">[</span><span class="s6">'ind'</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">])</span>


<span class="s3">@</span><span class="s1">check_figures_equal</span><span class="s3">()</span>
<span class="s2">def </span><span class="s1">test_input_copy</span><span class="s3">(</span><span class="s1">fig_test</span><span class="s3">, </span><span class="s1">fig_ref</span><span class="s3">):</span>

    <span class="s1">t </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">2</span><span class="s3">)</span>
    <span class="s1">l</span><span class="s3">, = </span><span class="s1">fig_test</span><span class="s3">.</span><span class="s1">add_subplot</span><span class="s3">().</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, </span><span class="s1">t</span><span class="s3">, </span><span class="s6">&quot;.-&quot;</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">[:] = </span><span class="s1">range</span><span class="s3">(</span><span class="s4">3</span><span class="s3">)</span>
    <span class="s5"># Trigger cache invalidation</span>
    <span class="s1">l</span><span class="s3">.</span><span class="s1">set_drawstyle</span><span class="s3">(</span><span class="s6">&quot;steps&quot;</span><span class="s3">)</span>
    <span class="s1">fig_ref</span><span class="s3">.</span><span class="s1">add_subplot</span><span class="s3">().</span><span class="s1">plot</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">], </span><span class="s6">&quot;.-&quot;</span><span class="s3">, </span><span class="s1">drawstyle</span><span class="s3">=</span><span class="s6">&quot;steps&quot;</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">check_figures_equal</span><span class="s3">(</span><span class="s1">extensions</span><span class="s3">=[</span><span class="s6">&quot;png&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_markevery_prop_cycle</span><span class="s3">(</span><span class="s1">fig_test</span><span class="s3">, </span><span class="s1">fig_ref</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Test that we can set markevery prop_cycle.&quot;&quot;&quot;</span>
    <span class="s1">cases </span><span class="s3">= [</span><span class="s2">None</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, (</span><span class="s4">30</span><span class="s3">, </span><span class="s4">8</span><span class="s3">), [</span><span class="s4">16</span><span class="s3">, </span><span class="s4">24</span><span class="s3">, </span><span class="s4">30</span><span class="s3">], [</span><span class="s4">0</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">],</span>
             <span class="s1">slice</span><span class="s3">(</span><span class="s4">100</span><span class="s3">, </span><span class="s4">200</span><span class="s3">, </span><span class="s4">3</span><span class="s3">), </span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.3</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">,</span>
             <span class="s3">(</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">), (</span><span class="s4">0.45</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">)]</span>

    <span class="s1">cmap </span><span class="s3">= </span><span class="s1">mpl</span><span class="s3">.</span><span class="s1">colormaps</span><span class="s3">[</span><span class="s6">'jet'</span><span class="s3">]</span>
    <span class="s1">colors </span><span class="s3">= </span><span class="s1">cmap</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.2</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s1">len</span><span class="s3">(</span><span class="s1">cases</span><span class="s3">)))</span>

    <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
    <span class="s1">y </span><span class="s3">= </span><span class="s4">5 </span><span class="s3">* </span><span class="s1">x</span><span class="s3">**</span><span class="s4">2</span>

    <span class="s1">axs </span><span class="s3">= </span><span class="s1">fig_ref</span><span class="s3">.</span><span class="s1">add_subplot</span><span class="s3">()</span>
    <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">markevery </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">cases</span><span class="s3">):</span>
        <span class="s1">axs</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">y </span><span class="s3">- </span><span class="s1">i</span><span class="s3">, </span><span class="s6">'o-'</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">markevery</span><span class="s3">, </span><span class="s1">color</span><span class="s3">=</span><span class="s1">colors</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>

    <span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">rcParams</span><span class="s3">[</span><span class="s6">'axes.prop_cycle'</span><span class="s3">] = </span><span class="s1">cycler</span><span class="s3">(</span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">cases</span><span class="s3">,</span>
                                                    <span class="s1">color</span><span class="s3">=</span><span class="s1">colors</span><span class="s3">)</span>

    <span class="s1">ax </span><span class="s3">= </span><span class="s1">fig_test</span><span class="s3">.</span><span class="s1">add_subplot</span><span class="s3">()</span>
    <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">_ </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">cases</span><span class="s3">):</span>
        <span class="s1">ax</span><span class="s3">.</span><span class="s1">plot</span><span class="s3">(</span><span class="s1">y </span><span class="s3">- </span><span class="s1">i</span><span class="s3">, </span><span class="s6">'o-'</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_axline_setters</span><span class="s3">():</span>
    <span class="s1">fig</span><span class="s3">, </span><span class="s1">ax </span><span class="s3">= </span><span class="s1">plt</span><span class="s3">.</span><span class="s1">subplots</span><span class="s3">()</span>
    <span class="s1">line1 </span><span class="s3">= </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">axline</span><span class="s3">((</span><span class="s4">.1</span><span class="s3">, </span><span class="s4">.1</span><span class="s3">), </span><span class="s1">slope</span><span class="s3">=</span><span class="s4">0.6</span><span class="s3">)</span>
    <span class="s1">line2 </span><span class="s3">= </span><span class="s1">ax</span><span class="s3">.</span><span class="s1">axline</span><span class="s3">((</span><span class="s4">.1</span><span class="s3">, </span><span class="s4">.1</span><span class="s3">), (</span><span class="s4">.8</span><span class="s3">, </span><span class="s4">.4</span><span class="s3">))</span>
    <span class="s5"># Testing xy1, xy2 and slope setters.</span>
    <span class="s5"># This should not produce an error.</span>
    <span class="s1">line1</span><span class="s3">.</span><span class="s1">set_xy1</span><span class="s3">(</span><span class="s4">.2</span><span class="s3">, </span><span class="s4">.3</span><span class="s3">)</span>
    <span class="s1">line1</span><span class="s3">.</span><span class="s1">set_slope</span><span class="s3">(</span><span class="s4">2.4</span><span class="s3">)</span>
    <span class="s1">line2</span><span class="s3">.</span><span class="s1">set_xy1</span><span class="s3">(</span><span class="s4">.3</span><span class="s3">, </span><span class="s4">.2</span><span class="s3">)</span>
    <span class="s1">line2</span><span class="s3">.</span><span class="s1">set_xy2</span><span class="s3">(</span><span class="s4">.6</span><span class="s3">, </span><span class="s4">.8</span><span class="s3">)</span>
    <span class="s5"># Testing xy1, xy2 and slope getters.</span>
    <span class="s5"># Should return the modified values.</span>
    <span class="s2">assert </span><span class="s1">line1</span><span class="s3">.</span><span class="s1">get_xy1</span><span class="s3">() == (</span><span class="s4">.2</span><span class="s3">, </span><span class="s4">.3</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">line1</span><span class="s3">.</span><span class="s1">get_slope</span><span class="s3">() == </span><span class="s4">2.4</span>
    <span class="s2">assert </span><span class="s1">line2</span><span class="s3">.</span><span class="s1">get_xy1</span><span class="s3">() == (</span><span class="s4">.3</span><span class="s3">, </span><span class="s4">.2</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">line2</span><span class="s3">.</span><span class="s1">get_xy2</span><span class="s3">() == (</span><span class="s4">.6</span><span class="s3">, </span><span class="s4">.8</span><span class="s3">)</span>
    <span class="s5"># Testing setting xy2 and slope together.</span>
    <span class="s5"># These test should raise a ValueError</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">,</span>
                       <span class="s1">match</span><span class="s3">=</span><span class="s6">&quot;Cannot set an 'xy2' value while 'slope' is set&quot;</span><span class="s3">):</span>
        <span class="s1">line1</span><span class="s3">.</span><span class="s1">set_xy2</span><span class="s3">(</span><span class="s4">.2</span><span class="s3">, </span><span class="s4">.3</span><span class="s3">)</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">,</span>
                       <span class="s1">match</span><span class="s3">=</span><span class="s6">&quot;Cannot set a 'slope' value while 'xy2' is set&quot;</span><span class="s3">):</span>
        <span class="s1">line2</span><span class="s3">.</span><span class="s1">set_slope</span><span class="s3">(</span><span class="s4">3</span><span class="s3">)</span>
</pre>
</body>
</html>