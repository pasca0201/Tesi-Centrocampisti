<html>
<head>
<title>test_colorbar.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #5f826b; font-style: italic;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_colorbar.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">platform</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">cm</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>


<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">rc_context</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">BoundaryNorm</span><span class="s2">, </span><span class="s1">LogNorm</span><span class="s2">, </span><span class="s1">PowerNorm</span><span class="s2">, </span><span class="s1">Normalize</span><span class="s2">, </span><span class="s1">NoNorm</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colorbar </span><span class="s0">import </span><span class="s1">Colorbar</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">ticker </span><span class="s0">import </span><span class="s1">FixedLocator</span><span class="s2">, </span><span class="s1">LogFormatter</span><span class="s2">, </span><span class="s1">StrMethodFormatter</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span>


<span class="s0">def </span><span class="s1">_get_cmap_norms</span><span class="s2">():</span>
    <span class="s3">&quot;&quot;&quot; 
    Define a colormap and appropriate norms for each of the four 
    possible settings of the extend keyword. 
 
    Helper function for _colorbar_extension_shape and 
    colorbar_extension_length. 
    &quot;&quot;&quot;</span>
    <span class="s4"># Create a colormap and specify the levels it represents.</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">&quot;RdBu&quot;</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s6">5</span><span class="s2">)</span>
    <span class="s1">clevs </span><span class="s2">= [-</span><span class="s6">5.</span><span class="s2">, -</span><span class="s6">2.5</span><span class="s2">, -</span><span class="s6">.5</span><span class="s2">, </span><span class="s6">.5</span><span class="s2">, </span><span class="s6">1.5</span><span class="s2">, </span><span class="s6">3.5</span><span class="s2">]</span>
    <span class="s4"># Define norms for the colormaps.</span>
    <span class="s1">norms </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">()</span>
    <span class="s1">norms</span><span class="s2">[</span><span class="s5">'neither'</span><span class="s2">] = </span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">) - </span><span class="s6">1</span><span class="s2">)</span>
    <span class="s1">norms</span><span class="s2">[</span><span class="s5">'min'</span><span class="s2">] = </span><span class="s1">BoundaryNorm</span><span class="s2">([-</span><span class="s6">10</span><span class="s2">] + </span><span class="s1">clevs</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:], </span><span class="s1">len</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">) - </span><span class="s6">1</span><span class="s2">)</span>
    <span class="s1">norms</span><span class="s2">[</span><span class="s5">'max'</span><span class="s2">] = </span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">] + [</span><span class="s6">10</span><span class="s2">], </span><span class="s1">len</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">) - </span><span class="s6">1</span><span class="s2">)</span>
    <span class="s1">norms</span><span class="s2">[</span><span class="s5">'both'</span><span class="s2">] = </span><span class="s1">BoundaryNorm</span><span class="s2">([-</span><span class="s6">10</span><span class="s2">] + </span><span class="s1">clevs</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:-</span><span class="s6">1</span><span class="s2">] + [</span><span class="s6">10</span><span class="s2">], </span><span class="s1">len</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">) - </span><span class="s6">1</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norms</span>


<span class="s0">def </span><span class="s1">_colorbar_extension_shape</span><span class="s2">(</span><span class="s1">spacing</span><span class="s2">):</span>
    <span class="s3">&quot;&quot;&quot; 
    Produce 4 colorbars with rectangular extensions for either uniform 
    or proportional spacing. 
 
    Helper function for test_colorbar_extension_shape. 
    &quot;&quot;&quot;</span>
    <span class="s4"># Get a colormap and appropriate norms for each extension type.</span>
    <span class="s1">cmap</span><span class="s2">, </span><span class="s1">norms </span><span class="s2">= </span><span class="s1">_get_cmap_norms</span><span class="s2">()</span>
    <span class="s4"># Create a figure and adjust whitespace for subplots.</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">hspace</span><span class="s2">=</span><span class="s6">4</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">extension_type </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">((</span><span class="s5">'neither'</span><span class="s2">, </span><span class="s5">'min'</span><span class="s2">, </span><span class="s5">'max'</span><span class="s2">, </span><span class="s5">'both'</span><span class="s2">)):</span>
        <span class="s4"># Get the appropriate norm and use it to get colorbar boundaries.</span>
        <span class="s1">norm </span><span class="s2">= </span><span class="s1">norms</span><span class="s2">[</span><span class="s1">extension_type</span><span class="s2">]</span>
        <span class="s1">boundaries </span><span class="s2">= </span><span class="s1">values </span><span class="s2">= </span><span class="s1">norm</span><span class="s2">.</span><span class="s1">boundaries</span>
        <span class="s4"># note that the last value was silently dropped pre 3.3:</span>
        <span class="s1">values </span><span class="s2">= </span><span class="s1">values</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">]</span>
        <span class="s4"># Create a subplot.</span>
        <span class="s1">cax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s1">i </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s4"># Generate the colorbar.</span>
        <span class="s1">Colorbar</span><span class="s2">(</span><span class="s1">cax</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">,</span>
                 <span class="s1">boundaries</span><span class="s2">=</span><span class="s1">boundaries</span><span class="s2">, </span><span class="s1">values</span><span class="s2">=</span><span class="s1">values</span><span class="s2">,</span>
                 <span class="s1">extend</span><span class="s2">=</span><span class="s1">extension_type</span><span class="s2">, </span><span class="s1">extendrect</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                 <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s1">spacing</span><span class="s2">)</span>
        <span class="s4"># Turn off text and ticks.</span>
        <span class="s1">cax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">labelleft</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                        <span class="s1">bottom</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">labelbottom</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s4"># Return the figure to the caller.</span>
    <span class="s0">return </span><span class="s1">fig</span>


<span class="s0">def </span><span class="s1">_colorbar_extension_length</span><span class="s2">(</span><span class="s1">spacing</span><span class="s2">):</span>
    <span class="s3">&quot;&quot;&quot; 
    Produce 12 colorbars with variable length extensions for either 
    uniform or proportional spacing. 
 
    Helper function for test_colorbar_extension_length. 
    &quot;&quot;&quot;</span>
    <span class="s4"># Get a colormap and appropriate norms for each extension type.</span>
    <span class="s1">cmap</span><span class="s2">, </span><span class="s1">norms </span><span class="s2">= </span><span class="s1">_get_cmap_norms</span><span class="s2">()</span>
    <span class="s4"># Create a figure and adjust whitespace for subplots.</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">hspace</span><span class="s2">=</span><span class="s6">.6</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">extension_type </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">((</span><span class="s5">'neither'</span><span class="s2">, </span><span class="s5">'min'</span><span class="s2">, </span><span class="s5">'max'</span><span class="s2">, </span><span class="s5">'both'</span><span class="s2">)):</span>
        <span class="s4"># Get the appropriate norm and use it to get colorbar boundaries.</span>
        <span class="s1">norm </span><span class="s2">= </span><span class="s1">norms</span><span class="s2">[</span><span class="s1">extension_type</span><span class="s2">]</span>
        <span class="s1">boundaries </span><span class="s2">= </span><span class="s1">values </span><span class="s2">= </span><span class="s1">norm</span><span class="s2">.</span><span class="s1">boundaries</span>
        <span class="s1">values </span><span class="s2">= </span><span class="s1">values</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">extendfrac </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">((</span><span class="s0">None</span><span class="s2">, </span><span class="s5">'auto'</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">)):</span>
            <span class="s4"># Create a subplot.</span>
            <span class="s1">cax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s6">12</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">*</span><span class="s6">3 </span><span class="s2">+ </span><span class="s1">j </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">)</span>
            <span class="s4"># Generate the colorbar.</span>
            <span class="s1">Colorbar</span><span class="s2">(</span><span class="s1">cax</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">,</span>
                     <span class="s1">boundaries</span><span class="s2">=</span><span class="s1">boundaries</span><span class="s2">, </span><span class="s1">values</span><span class="s2">=</span><span class="s1">values</span><span class="s2">,</span>
                     <span class="s1">extend</span><span class="s2">=</span><span class="s1">extension_type</span><span class="s2">, </span><span class="s1">extendfrac</span><span class="s2">=</span><span class="s1">extendfrac</span><span class="s2">,</span>
                     <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s1">spacing</span><span class="s2">)</span>
            <span class="s4"># Turn off text and ticks.</span>
            <span class="s1">cax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">labelleft</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                              <span class="s1">bottom</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">labelbottom</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s4"># Return the figure to the caller.</span>
    <span class="s0">return </span><span class="s1">fig</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'colorbar_extensions_shape_uniform.png'</span><span class="s2">,</span>
                   <span class="s5">'colorbar_extensions_shape_proportional.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_extension_shape</span><span class="s2">():</span>
    <span class="s3">&quot;&quot;&quot;Test rectangular colorbar extensions.&quot;&quot;&quot;</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s4"># Create figures for uniform and proportionally spaced colorbars.</span>
    <span class="s1">_colorbar_extension_shape</span><span class="s2">(</span><span class="s5">'uniform'</span><span class="s2">)</span>
    <span class="s1">_colorbar_extension_shape</span><span class="s2">(</span><span class="s5">'proportional'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'colorbar_extensions_uniform.png'</span><span class="s2">,</span>
                   <span class="s5">'colorbar_extensions_proportional.png'</span><span class="s2">],</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s6">1.0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_extension_length</span><span class="s2">():</span>
    <span class="s3">&quot;&quot;&quot;Test variable length colorbar extensions.&quot;&quot;&quot;</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s4"># Create figures for uniform and proportionally spaced colorbars.</span>
    <span class="s1">_colorbar_extension_length</span><span class="s2">(</span><span class="s5">'uniform'</span><span class="s2">)</span>
    <span class="s1">_colorbar_extension_length</span><span class="s2">(</span><span class="s5">'proportional'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;orientation&quot;</span><span class="s2">, [</span><span class="s5">&quot;horizontal&quot;</span><span class="s2">, </span><span class="s5">&quot;vertical&quot;</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;extend,expected&quot;</span><span class="s2">, [(</span><span class="s5">&quot;min&quot;</span><span class="s2">, (</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)),</span>
                                             <span class="s2">(</span><span class="s5">&quot;max&quot;</span><span class="s2">, (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)),</span>
                                             <span class="s2">(</span><span class="s5">&quot;both&quot;</span><span class="s2">, (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">))])</span>
<span class="s0">def </span><span class="s1">test_colorbar_extension_inverted_axis</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s3">&quot;&quot;&quot;Test extension color with an inverted axis&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">12</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">&quot;viridis&quot;</span><span class="s2">].</span><span class="s1">with_extremes</span><span class="s2">(</span><span class="s1">under</span><span class="s2">=(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">),</span>
                                                  <span class="s1">over</span><span class="s2">=(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">))</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s1">orientation</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s1">extend</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s5">&quot;horizontal&quot;</span><span class="s2">:</span>
        <span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_xaxis</span><span class="s2">()</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">_extend_patches</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">get_facecolor</span><span class="s2">() == </span><span class="s1">expected</span>
    <span class="s0">if </span><span class="s1">extend </span><span class="s2">== </span><span class="s5">&quot;both&quot;</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">_extend_patches</span><span class="s2">) == </span><span class="s6">2</span>
        <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">_extend_patches</span><span class="s2">[</span><span class="s6">1</span><span class="s2">].</span><span class="s1">get_facecolor</span><span class="s2">() == (</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">_extend_patches</span><span class="s2">) == </span><span class="s6">1</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'use_gridspec'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'cbar_with_orientation'</span><span class="s2">,</span>
                   <span class="s5">'cbar_locationing'</span><span class="s2">,</span>
                   <span class="s5">'double_cbar'</span><span class="s2">,</span>
                   <span class="s5">'cbar_sharing'</span><span class="s2">,</span>
                   <span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s5">'dpi'</span><span class="s2">: </span><span class="s6">40</span><span class="s2">})</span>
<span class="s0">def </span><span class="s1">test_colorbar_positioning</span><span class="s2">(</span><span class="s1">use_gridspec</span><span class="s2">):</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1200</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">30</span><span class="s2">, </span><span class="s6">40</span><span class="s2">)</span>
    <span class="s1">levels </span><span class="s2">= [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">200</span><span class="s2">, </span><span class="s6">400</span><span class="s2">, </span><span class="s6">600</span><span class="s2">, </span><span class="s6">800</span><span class="s2">, </span><span class="s6">1000</span><span class="s2">, </span><span class="s6">1200</span><span class="s2">]</span>

    <span class="s4"># -------------------</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s1">use_gridspec</span><span class="s2">)</span>

    <span class="s1">locations </span><span class="s2">= [</span><span class="s5">'left'</span><span class="s2">, </span><span class="s5">'right'</span><span class="s2">, </span><span class="s5">'top'</span><span class="s2">, </span><span class="s5">'bottom'</span><span class="s2">]</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">location </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">locations</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s1">i </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">location</span><span class="s2">=</span><span class="s1">location</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s1">use_gridspec</span><span class="s2">)</span>

    <span class="s4"># -------------------</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s4"># make some other data (random integers)</span>
    <span class="s1">data_2nd </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], [</span><span class="s6">1.5</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">]])</span>
    <span class="s4"># make the random data expand to the shape of the main data</span>
    <span class="s1">data_2nd </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">data_2nd</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s6">1</span><span class="s2">), </span><span class="s6">10</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s6">0</span><span class="s2">)</span>

    <span class="s1">color_mappable </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s4"># test extend frac here</span>
    <span class="s1">hatch_mappable </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data_2nd</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">], </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'none'</span><span class="s2">,</span>
                                  <span class="s1">hatches</span><span class="s2">=[</span><span class="s5">'/'</span><span class="s2">, </span><span class="s5">'o'</span><span class="s2">, </span><span class="s5">'+'</span><span class="s2">], </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'max'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">hatch_mappable</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'black'</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">color_mappable</span><span class="s2">, </span><span class="s1">location</span><span class="s2">=</span><span class="s5">'left'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'variable 1'</span><span class="s2">,</span>
                 <span class="s1">use_gridspec</span><span class="s2">=</span><span class="s1">use_gridspec</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">hatch_mappable</span><span class="s2">, </span><span class="s1">location</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'variable 2'</span><span class="s2">,</span>
                 <span class="s1">use_gridspec</span><span class="s2">=</span><span class="s1">use_gridspec</span><span class="s2">)</span>

    <span class="s4"># -------------------</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s6">211</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=</span><span class="s5">'NE'</span><span class="s2">, </span><span class="s1">aspect</span><span class="s2">=</span><span class="s5">'equal'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s6">223</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">ax3 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s6">224</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=[</span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax1</span><span class="s2">], </span><span class="s1">location</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=</span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">shrink</span><span class="s2">=</span><span class="s6">0.5</span><span class="s2">,</span>
                 <span class="s1">panchor</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s1">use_gridspec</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=[</span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax1</span><span class="s2">], </span><span class="s1">location</span><span class="s2">=</span><span class="s5">'left'</span><span class="s2">, </span><span class="s1">shrink</span><span class="s2">=</span><span class="s6">0.5</span><span class="s2">,</span>
                 <span class="s1">panchor</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s1">use_gridspec</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">=[</span><span class="s1">ax1</span><span class="s2">], </span><span class="s1">location</span><span class="s2">=</span><span class="s5">'bottom'</span><span class="s2">, </span><span class="s1">panchor</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                 <span class="s1">anchor</span><span class="s2">=(</span><span class="s6">0.8</span><span class="s2">, </span><span class="s6">0.5</span><span class="s2">), </span><span class="s1">shrink</span><span class="s2">=</span><span class="s6">0.6</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s1">use_gridspec</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_single_ax_panchor_false</span><span class="s2">():</span>
    <span class="s4"># Note that this differs from the tests above with panchor=False because</span>
    <span class="s4"># there use_gridspec is actually ineffective: passing *ax* as lists always</span>
    <span class="s4"># disables use_gridspec.</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s6">111</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=</span><span class="s5">'N'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">panchor</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_anchor</span><span class="s2">() == </span><span class="s5">'N'</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'constrained'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">],</span>
                         <span class="s1">ids</span><span class="s2">=[</span><span class="s5">'standard'</span><span class="s2">, </span><span class="s5">'constrained'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_single_ax_panchor_east</span><span class="s2">(</span><span class="s1">constrained</span><span class="s2">):</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">constrained_layout</span><span class="s2">=</span><span class="s1">constrained</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s6">111</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=</span><span class="s5">'N'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">panchor</span><span class="s2">=</span><span class="s5">'E'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_anchor</span><span class="s2">() == </span><span class="s5">'E'</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_colorbar.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s6">0 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'x86_64' </span><span class="s0">else </span><span class="s6">0.054</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_colorbar</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1200</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">30</span><span class="s2">, </span><span class="s6">40</span><span class="s2">) - </span><span class="s6">500</span>
    <span class="s1">levels </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">200</span><span class="s2">, </span><span class="s6">400</span><span class="s2">, </span><span class="s6">600</span><span class="s2">, </span><span class="s6">800</span><span class="s2">, </span><span class="s6">1000</span><span class="s2">, </span><span class="s6">1200</span><span class="s2">]) - </span><span class="s6">500</span>

    <span class="s1">CS </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">CS</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">CS</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'cbar_with_subplots_adjust.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s5">'dpi'</span><span class="s2">: </span><span class="s6">40</span><span class="s2">})</span>
<span class="s0">def </span><span class="s1">test_gridspec_make_colorbar</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1200</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">30</span><span class="s2">, </span><span class="s6">40</span><span class="s2">)</span>
    <span class="s1">levels </span><span class="s2">= [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">200</span><span class="s2">, </span><span class="s6">400</span><span class="s2">, </span><span class="s6">600</span><span class="s2">, </span><span class="s6">800</span><span class="s2">, </span><span class="s6">1000</span><span class="s2">, </span><span class="s6">1200</span><span class="s2">]</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s6">121</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s6">122</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">top</span><span class="s2">=</span><span class="s6">0.95</span><span class="s2">, </span><span class="s1">right</span><span class="s2">=</span><span class="s6">0.95</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s6">0.2</span><span class="s2">, </span><span class="s1">hspace</span><span class="s2">=</span><span class="s6">0.25</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'colorbar_single_scatter.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s5">'dpi'</span><span class="s2">: </span><span class="s6">40</span><span class="s2">})</span>
<span class="s0">def </span><span class="s1">test_colorbar_single_scatter</span><span class="s2">():</span>
    <span class="s4"># Issue #2642: if a path collection has only one entry,</span>
    <span class="s4"># the norm scaling within the colorbar must ensure a</span>
    <span class="s4"># finite range, otherwise a zero denominator will occur in _locate.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">y </span><span class="s2">= [</span><span class="s6">0</span><span class="s2">]</span>
    <span class="s1">z </span><span class="s2">= [</span><span class="s6">50</span><span class="s2">]</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">'jet'</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s6">16</span><span class="s2">)</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">z</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'use_gridspec'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'nested_gridspecs'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_remove_from_figure</span><span class="s2">(</span><span class="s1">nested_gridspecs</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">):</span>
    <span class="s3">&quot;&quot;&quot;Test `remove` with the specified ``use_gridspec`` setting.&quot;&quot;&quot;</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">nested_gridspecs</span><span class="s2">:</span>
        <span class="s1">gs </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_gridspec</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">].</span><span class="s1">subgridspec</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">sc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">])</span>
    <span class="s1">sc</span><span class="s2">.</span><span class="s1">set_array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">5</span><span class="s2">, </span><span class="s6">6</span><span class="s2">]))</span>
    <span class="s1">pre_position </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sc</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s1">use_gridspec</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">()</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">()</span>
    <span class="s1">post_position </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">pre_position</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">() == </span><span class="s1">post_position</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">()).</span><span class="s1">all</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_remove_from_figure_cl</span><span class="s2">():</span>
    <span class="s3">&quot;&quot;&quot;Test `remove` with constrained_layout.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">constrained_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">sc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">])</span>
    <span class="s1">sc</span><span class="s2">.</span><span class="s1">set_array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">5</span><span class="s2">, </span><span class="s6">6</span><span class="s2">]))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s1">pre_position </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sc</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s1">post_position </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">pre_position</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">(),</span>
                               <span class="s1">post_position</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">())</span>


<span class="s0">def </span><span class="s1">test_colorbarbase</span><span class="s2">():</span>
    <span class="s4"># smoke test from #3805</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">Colorbar</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">bone</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_parentless_mappable</span><span class="s2">():</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">collections</span><span class="s2">.</span><span class="s1">PatchCollection</span><span class="s2">([], </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">get_cmap</span><span class="s2">(</span><span class="s5">'viridis'</span><span class="s2">), </span><span class="s1">array</span><span class="s2">=[])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">'Unable to determine Axes to steal'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'colorbar_closed_patch.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_closed_patch</span><span class="s2">():</span>
    <span class="s4"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">8</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s6">0.05</span><span class="s2">, </span><span class="s6">0.85</span><span class="s2">, </span><span class="s6">0.9</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">])</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s6">0.1</span><span class="s2">, </span><span class="s6">0.65</span><span class="s2">, </span><span class="s6">0.75</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">])</span>
    <span class="s1">ax3 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s6">0.05</span><span class="s2">, </span><span class="s6">0.45</span><span class="s2">, </span><span class="s6">0.9</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">])</span>
    <span class="s1">ax4 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s6">0.05</span><span class="s2">, </span><span class="s6">0.25</span><span class="s2">, </span><span class="s6">0.9</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">])</span>
    <span class="s1">ax5 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s6">0.05</span><span class="s2">, </span><span class="s6">0.05</span><span class="s2">, </span><span class="s6">0.9</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">])</span>

    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">&quot;RdBu&quot;</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s6">5</span><span class="s2">)</span>

    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, </span><span class="s6">16</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s6">4</span><span class="s2">, </span><span class="s6">4</span><span class="s2">)), </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">)</span>

    <span class="s4"># The use of a &quot;values&quot; kwarg here is unusual.  It works only</span>
    <span class="s4"># because it is matched to the data range in the image and to</span>
    <span class="s4"># the number of colors in the LUT.</span>
    <span class="s1">values </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, </span><span class="s6">5</span><span class="s2">)</span>
    <span class="s1">cbar_kw </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s1">values</span><span class="s2">=</span><span class="s1">values</span><span class="s2">, </span><span class="s1">ticks</span><span class="s2">=[])</span>

    <span class="s4"># The wide line is to show that the closed path is being handled</span>
    <span class="s4"># correctly.  See PR #4186.</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s5">'axes.linewidth'</span><span class="s2">: </span><span class="s6">16</span><span class="s2">}):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">, </span><span class="s1">extendfrac</span><span class="s2">=</span><span class="s6">0.5</span><span class="s2">, **</span><span class="s1">cbar_kw</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">, **</span><span class="s1">cbar_kw</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax4</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">, </span><span class="s1">extendrect</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, **</span><span class="s1">cbar_kw</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax5</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'neither'</span><span class="s2">, **</span><span class="s1">cbar_kw</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_ticks</span><span class="s2">():</span>
    <span class="s4"># test fix for #5673</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">3.0</span><span class="s2">, </span><span class="s6">4.001</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">4.0</span><span class="s2">, </span><span class="s6">3.001</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">X </span><span class="s2">* </span><span class="s1">Y</span>
    <span class="s1">clevs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s6">12</span><span class="s2">, -</span><span class="s6">5</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">12</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">float</span><span class="s2">)</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">, </span><span class="s5">'c'</span><span class="s2">]</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">clevs</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'neither'</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s1">ticks</span><span class="s2">=</span><span class="s1">clevs</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_ticklocs</span><span class="s2">()) == </span><span class="s1">len</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_minorticks_on_off</span><span class="s2">():</span>
    <span class="s4"># test for github issue #11510 and PR #11584</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s1">seed</span><span class="s2">=</span><span class="s6">12345</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s6">20</span><span class="s2">, </span><span class="s6">20</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s5">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s4"># purposefully setting vmin and vmax to odd fractions</span>
        <span class="s4"># so as to check for the correct locations of the minor ticks</span>
        <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">vmin</span><span class="s2">=-</span><span class="s6">2.3</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">3.3</span><span class="s2">)</span>

        <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
        <span class="s4"># testing after minorticks_on()</span>
        <span class="s1">cbar</span><span class="s2">.</span><span class="s1">minorticks_on</span><span class="s2">()</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span>
            <span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">(),</span>
            <span class="s2">[-</span><span class="s6">2.2</span><span class="s2">, -</span><span class="s6">1.8</span><span class="s2">, -</span><span class="s6">1.6</span><span class="s2">, -</span><span class="s6">1.4</span><span class="s2">, -</span><span class="s6">1.2</span><span class="s2">, -</span><span class="s6">0.8</span><span class="s2">, -</span><span class="s6">0.6</span><span class="s2">, -</span><span class="s6">0.4</span><span class="s2">, -</span><span class="s6">0.2</span><span class="s2">,</span>
             <span class="s6">0.2</span><span class="s2">, </span><span class="s6">0.4</span><span class="s2">, </span><span class="s6">0.6</span><span class="s2">, </span><span class="s6">0.8</span><span class="s2">, </span><span class="s6">1.2</span><span class="s2">, </span><span class="s6">1.4</span><span class="s2">, </span><span class="s6">1.6</span><span class="s2">, </span><span class="s6">1.8</span><span class="s2">, </span><span class="s6">2.2</span><span class="s2">, </span><span class="s6">2.4</span><span class="s2">, </span><span class="s6">2.6</span><span class="s2">, </span><span class="s6">2.8</span><span class="s2">, </span><span class="s6">3.2</span><span class="s2">])</span>
        <span class="s4"># testing after minorticks_off()</span>
        <span class="s1">cbar</span><span class="s2">.</span><span class="s1">minorticks_off</span><span class="s2">()</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">(), [])</span>

        <span class="s1">im</span><span class="s2">.</span><span class="s1">set_clim</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=-</span><span class="s6">1.2</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">1.2</span><span class="s2">)</span>
        <span class="s1">cbar</span><span class="s2">.</span><span class="s1">minorticks_on</span><span class="s2">()</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span>
            <span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">(),</span>
            <span class="s2">[-</span><span class="s6">1.2</span><span class="s2">, -</span><span class="s6">1.1</span><span class="s2">, -</span><span class="s6">0.9</span><span class="s2">, -</span><span class="s6">0.8</span><span class="s2">, -</span><span class="s6">0.7</span><span class="s2">, -</span><span class="s6">0.6</span><span class="s2">, -</span><span class="s6">0.4</span><span class="s2">, -</span><span class="s6">0.3</span><span class="s2">, -</span><span class="s6">0.2</span><span class="s2">, -</span><span class="s6">0.1</span><span class="s2">,</span>
             <span class="s6">0.1</span><span class="s2">, </span><span class="s6">0.2</span><span class="s2">, </span><span class="s6">0.3</span><span class="s2">, </span><span class="s6">0.4</span><span class="s2">, </span><span class="s6">0.6</span><span class="s2">, </span><span class="s6">0.7</span><span class="s2">, </span><span class="s6">0.8</span><span class="s2">, </span><span class="s6">0.9</span><span class="s2">, </span><span class="s6">1.1</span><span class="s2">, </span><span class="s6">1.2</span><span class="s2">])</span>

    <span class="s4"># tests for github issue #13257 and PR #13265</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span><span class="s1">low</span><span class="s2">=</span><span class="s6">1</span><span class="s2">, </span><span class="s1">high</span><span class="s2">=</span><span class="s6">10</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s6">20</span><span class="s2">, </span><span class="s6">20</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">())</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">default_minorticklocks </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">()</span>
    <span class="s4"># test that minorticks turn off for LogNorm</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">minorticks_off</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">(), [])</span>

    <span class="s4"># test that minorticks turn back on for LogNorm</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">minorticks_on</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">(),</span>
                            <span class="s1">default_minorticklocks</span><span class="s2">)</span>

    <span class="s4"># test issue #13339: minorticks for LogNorm should stay off</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">minorticks_off</span><span class="s2">()</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">([</span><span class="s6">3</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, </span><span class="s6">9</span><span class="s2">])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">(), [])</span>


<span class="s0">def </span><span class="s1">test_cbar_minorticks_for_rc_xyminortickvisible</span><span class="s2">():</span>
    <span class="s3">&quot;&quot;&quot; 
    issue gh-16468. 
 
    Making sure that minor ticks on the colorbar are turned on 
    (internally) using the cbar.minorticks_on() method when 
    rcParams['xtick.minor.visible'] = True (for horizontal cbar) 
    rcParams['ytick.minor.visible'] = True (for vertical cbar). 
    Using cbar.minorticks_on() ensures that the minor ticks 
    don't overflow into the extend regions of the colorbar. 
    &quot;&quot;&quot;</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'ytick.minor.visible'</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'xtick.minor.visible'</span><span class="s2">] = </span><span class="s0">True</span>

    <span class="s1">vmin</span><span class="s2">, </span><span class="s1">vmax </span><span class="s2">= </span><span class="s6">0.4</span><span class="s2">, </span><span class="s6">2.6</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">([[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">]], </span><span class="s1">vmin</span><span class="s2">=</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s1">vmax</span><span class="s2">)</span>

    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">()[</span><span class="s6">0</span><span class="s2">] &gt;= </span><span class="s1">vmin</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">()[-</span><span class="s6">1</span><span class="s2">] &lt;= </span><span class="s1">vmax</span>

    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">()[</span><span class="s6">0</span><span class="s2">] &gt;= </span><span class="s1">vmin</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_minorticklocs</span><span class="s2">()[-</span><span class="s6">1</span><span class="s2">] &lt;= </span><span class="s1">vmax</span>


<span class="s0">def </span><span class="s1">test_colorbar_autoticks</span><span class="s2">():</span>
    <span class="s4"># Test new autotick modes. Needs to be classic because</span>
    <span class="s4"># non-classic doesn't go this route.</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s5">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">3.0</span><span class="s2">, </span><span class="s6">4.001</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">4.0</span><span class="s2">, </span><span class="s6">3.001</span><span class="s2">)</span>
        <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
        <span class="s1">Z </span><span class="s2">= </span><span class="s1">X </span><span class="s2">* </span><span class="s1">Y</span>
        <span class="s1">Z </span><span class="s2">= </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">, :-</span><span class="s6">1</span><span class="s2">]</span>
        <span class="s1">pcm </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">)</span>
        <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pcm</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">,</span>
                            <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">)</span>

        <span class="s1">pcm </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">[</span><span class="s6">1</span><span class="s2">].</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">)</span>
        <span class="s1">cbar2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pcm</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">,</span>
                             <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">, </span><span class="s1">shrink</span><span class="s2">=</span><span class="s6">0.4</span><span class="s2">)</span>
        <span class="s4"># note only -10 to 10 are visible,</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_ticklocs</span><span class="s2">(),</span>
                                       <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">15</span><span class="s2">, </span><span class="s6">16</span><span class="s2">, </span><span class="s6">5</span><span class="s2">))</span>
        <span class="s4"># note only -10 to 10 are visible</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">cbar2</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_ticklocs</span><span class="s2">(),</span>
                                       <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">20</span><span class="s2">, </span><span class="s6">21</span><span class="s2">, </span><span class="s6">10</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_colorbar_autotickslog</span><span class="s2">():</span>
    <span class="s4"># Test new autotick modes...</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s5">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">3.0</span><span class="s2">, </span><span class="s6">4.001</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">4.0</span><span class="s2">, </span><span class="s6">3.001</span><span class="s2">)</span>
        <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
        <span class="s1">Z </span><span class="s2">= </span><span class="s1">X </span><span class="s2">* </span><span class="s1">Y</span>
        <span class="s1">Z </span><span class="s2">= </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">, :-</span><span class="s6">1</span><span class="s2">]</span>
        <span class="s1">pcm </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s6">10</span><span class="s2">**</span><span class="s1">Z</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">())</span>
        <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pcm</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">,</span>
                            <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">)</span>

        <span class="s1">pcm </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">[</span><span class="s6">1</span><span class="s2">].</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s6">10</span><span class="s2">**</span><span class="s1">Z</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">())</span>
        <span class="s1">cbar2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pcm</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">,</span>
                             <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">, </span><span class="s1">shrink</span><span class="s2">=</span><span class="s6">0.4</span><span class="s2">)</span>
        <span class="s4"># note only -12 to +12 are visible</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_ticklocs</span><span class="s2">(),</span>
                                       <span class="s6">10</span><span class="s2">**</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">16.</span><span class="s2">, </span><span class="s6">16.2</span><span class="s2">, </span><span class="s6">4.</span><span class="s2">))</span>
        <span class="s4"># note only -24 to +24 are visible</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">cbar2</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_ticklocs</span><span class="s2">(),</span>
                                       <span class="s6">10</span><span class="s2">**</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">24.</span><span class="s2">, </span><span class="s6">25.</span><span class="s2">, </span><span class="s6">12.</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_colorbar_get_ticks</span><span class="s2">():</span>
    <span class="s4"># test feature for #5792</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1200</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">30</span><span class="s2">, </span><span class="s6">40</span><span class="s2">)</span>
    <span class="s1">levels </span><span class="s2">= [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">200</span><span class="s2">, </span><span class="s6">400</span><span class="s2">, </span><span class="s6">600</span><span class="s2">, </span><span class="s6">800</span><span class="s2">, </span><span class="s6">1000</span><span class="s2">, </span><span class="s6">1200</span><span class="s2">]</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s4"># testing getter for user set ticks</span>
    <span class="s1">userTicks </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">ticks</span><span class="s2">=[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">600</span><span class="s2">, </span><span class="s6">1200</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">userTicks</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">().</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">600</span><span class="s2">, </span><span class="s6">1200</span><span class="s2">]</span>

    <span class="s4"># testing for getter after calling set_ticks</span>
    <span class="s1">userTicks</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">([</span><span class="s6">600</span><span class="s2">, </span><span class="s6">700</span><span class="s2">, </span><span class="s6">800</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">userTicks</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">().</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s6">600</span><span class="s2">, </span><span class="s6">700</span><span class="s2">, </span><span class="s6">800</span><span class="s2">]</span>

    <span class="s4"># testing for getter after calling set_ticks with some ticks out of bounds</span>
    <span class="s4"># removed #20054: other axes don't trim fixed lists, so colorbars</span>
    <span class="s4"># should not either:</span>
    <span class="s4"># userTicks.set_ticks([600, 1300, 1400, 1500])</span>
    <span class="s4"># assert userTicks.get_ticks().tolist() == [600]</span>

    <span class="s4"># testing getter when no ticks are assigned</span>
    <span class="s1">defTicks </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">defTicks</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">().</span><span class="s1">tolist</span><span class="s2">(), </span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s4"># test normal ticks and minor ticks</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">3.0</span><span class="s2">, </span><span class="s6">4.001</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">4.0</span><span class="s2">, </span><span class="s6">3.001</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">X </span><span class="s2">* </span><span class="s1">Y</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">, :-</span><span class="s6">1</span><span class="s2">]</span>
    <span class="s1">pcm </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pcm</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">,</span>
                        <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">)</span>
    <span class="s1">ticks </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ticks</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">15</span><span class="s2">, </span><span class="s6">16</span><span class="s2">, </span><span class="s6">5</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">(</span><span class="s1">minor</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)) == </span><span class="s6">0</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;extend&quot;</span><span class="s2">, [</span><span class="s5">'both'</span><span class="s2">, </span><span class="s5">'min'</span><span class="s2">, </span><span class="s5">'max'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_lognorm_extension</span><span class="s2">(</span><span class="s1">extend</span><span class="s2">):</span>
    <span class="s4"># Test that colorbar with lognorm is extended correctly</span>
    <span class="s1">f</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">Colorbar</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=</span><span class="s6">0.1</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">1000.0</span><span class="s2">),</span>
                  <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s1">extend</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] &gt;= </span><span class="s6">0.0</span>


<span class="s0">def </span><span class="s1">test_colorbar_powernorm_extension</span><span class="s2">():</span>
    <span class="s4"># Test that colorbar with powernorm is extended correctly</span>
    <span class="s4"># Just a smoke test that adding the colorbar doesn't raise an error or warning</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">Colorbar</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">PowerNorm</span><span class="s2">(</span><span class="s1">gamma</span><span class="s2">=</span><span class="s6">0.5</span><span class="s2">, </span><span class="s1">vmin</span><span class="s2">=</span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">1.0</span><span class="s2">),</span>
             <span class="s1">orientation</span><span class="s2">=</span><span class="s5">'vertical'</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_axes_kw</span><span class="s2">():</span>
    <span class="s4"># test fix for #8493: This does only test, that axes-related keywords pass</span>
    <span class="s4"># and do not raise an exception.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">]])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s1">fraction</span><span class="s2">=</span><span class="s6">0.2</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=</span><span class="s6">0.2</span><span class="s2">, </span><span class="s1">shrink</span><span class="s2">=</span><span class="s6">0.5</span><span class="s2">,</span>
                 <span class="s1">aspect</span><span class="s2">=</span><span class="s6">10</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=(</span><span class="s6">0.</span><span class="s2">, </span><span class="s6">0.</span><span class="s2">), </span><span class="s1">panchor</span><span class="s2">=(</span><span class="s6">0.</span><span class="s2">, </span><span class="s6">1.</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_colorbar_log_minortick_labels</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s5">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">pcm </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">10000</span><span class="s2">, </span><span class="s6">50000</span><span class="s2">]], </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">())</span>
        <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pcm</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">lb </span><span class="s2">= [</span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_ticklabels</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)]</span>
        <span class="s1">expected </span><span class="s2">= [</span><span class="s5">r'$\mathdefault{10^{4}}$'</span><span class="s2">,</span>
                    <span class="s5">r'$\mathdefault{2\times10^{4}}$'</span><span class="s2">,</span>
                    <span class="s5">r'$\mathdefault{3\times10^{4}}$'</span><span class="s2">,</span>
                    <span class="s5">r'$\mathdefault{4\times10^{4}}$'</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">exp </span><span class="s0">in </span><span class="s1">expected</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">exp </span><span class="s0">in </span><span class="s1">lb</span>


<span class="s0">def </span><span class="s1">test_colorbar_renorm</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ogrid</span><span class="s2">[-</span><span class="s6">4</span><span class="s2">:</span><span class="s6">4</span><span class="s2">:</span><span class="s6">31j</span><span class="s2">, -</span><span class="s6">4</span><span class="s2">:</span><span class="s6">4</span><span class="s2">:</span><span class="s6">31j</span><span class="s2">]</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s6">120000</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">**</span><span class="s6">2 </span><span class="s2">- </span><span class="s1">y</span><span class="s2">**</span><span class="s6">2</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_majorticklocs</span><span class="s2">(),</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">120000.1</span><span class="s2">, </span><span class="s6">20000</span><span class="s2">))</span>

    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">locator</span><span class="s2">, </span><span class="s1">FixedLocator</span><span class="s2">)</span>

    <span class="s1">norm </span><span class="s2">= </span><span class="s1">LogNorm</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(), </span><span class="s1">z</span><span class="s2">.</span><span class="s1">max</span><span class="s2">())</span>
    <span class="s1">im</span><span class="s2">.</span><span class="s1">set_norm</span><span class="s2">(</span><span class="s1">norm</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_majorticklocs</span><span class="s2">(),</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">logspace</span><span class="s2">(-</span><span class="s6">10</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, </span><span class="s6">18</span><span class="s2">))</span>
    <span class="s4"># note that set_norm removes the FixedLocator...</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isclose</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">z</span><span class="s2">.</span><span class="s1">min</span><span class="s2">())</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">locator</span><span class="s2">, </span><span class="s1">FixedLocator</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_majorticklocs</span><span class="s2">(),</span>
                               <span class="s2">[</span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">2.0</span><span class="s2">, </span><span class="s6">3.0</span><span class="s2">])</span>

    <span class="s1">norm </span><span class="s2">= </span><span class="s1">LogNorm</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">min</span><span class="s2">() * </span><span class="s6">1000</span><span class="s2">, </span><span class="s1">z</span><span class="s2">.</span><span class="s1">max</span><span class="s2">() * </span><span class="s6">1000</span><span class="s2">)</span>
    <span class="s1">im</span><span class="s2">.</span><span class="s1">set_norm</span><span class="s2">(</span><span class="s1">norm</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isclose</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">z</span><span class="s2">.</span><span class="s1">min</span><span class="s2">() * </span><span class="s6">1000</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isclose</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">vmax</span><span class="s2">, </span><span class="s1">z</span><span class="s2">.</span><span class="s1">max</span><span class="s2">() * </span><span class="s6">1000</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'fmt'</span><span class="s2">, [</span><span class="s5">'%4.2e'</span><span class="s2">, </span><span class="s5">'{x:.2e}'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_format</span><span class="s2">(</span><span class="s1">fmt</span><span class="s2">):</span>
    <span class="s4"># make sure that format is passed properly</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ogrid</span><span class="s2">[-</span><span class="s6">4</span><span class="s2">:</span><span class="s6">4</span><span class="s2">:</span><span class="s6">31j</span><span class="s2">, -</span><span class="s6">4</span><span class="s2">:</span><span class="s6">4</span><span class="s2">:</span><span class="s6">31j</span><span class="s2">]</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s6">120000</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">**</span><span class="s6">2 </span><span class="s2">- </span><span class="s1">y</span><span class="s2">**</span><span class="s6">2</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">format</span><span class="s2">=</span><span class="s1">fmt</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_ticklabels</span><span class="s2">()[</span><span class="s6">4</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'8.00e+04'</span>

    <span class="s4"># make sure that if we change the clim of the mappable that the</span>
    <span class="s4"># formatting is *not* lost:</span>
    <span class="s1">im</span><span class="s2">.</span><span class="s1">set_clim</span><span class="s2">([</span><span class="s6">4</span><span class="s2">, </span><span class="s6">200</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_ticklabels</span><span class="s2">()[</span><span class="s6">4</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'2.00e+02'</span>

    <span class="s4"># but if we change the norm:</span>
    <span class="s1">im</span><span class="s2">.</span><span class="s1">set_norm</span><span class="s2">(</span><span class="s1">LogNorm</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=</span><span class="s6">0.1</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">10</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_ticklabels</span><span class="s2">()[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() ==</span>
            <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{10^{-2}}$'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_scale_reset</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ogrid</span><span class="s2">[-</span><span class="s6">4</span><span class="s2">:</span><span class="s6">4</span><span class="s2">:</span><span class="s6">31j</span><span class="s2">, -</span><span class="s6">4</span><span class="s2">:</span><span class="s6">4</span><span class="s2">:</span><span class="s6">31j</span><span class="s2">]</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s6">120000</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">**</span><span class="s6">2 </span><span class="s2">- </span><span class="s1">y</span><span class="s2">**</span><span class="s6">2</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">pcm </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">, </span><span class="s1">rasterized</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pcm</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">outline</span><span class="s2">.</span><span class="s1">set_edgecolor</span><span class="s2">(</span><span class="s5">'red'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_scale</span><span class="s2">() == </span><span class="s5">'linear'</span>

    <span class="s1">pcm</span><span class="s2">.</span><span class="s1">set_norm</span><span class="s2">(</span><span class="s1">LogNorm</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=</span><span class="s6">1</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">100</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_scale</span><span class="s2">() == </span><span class="s5">'log'</span>
    <span class="s1">pcm</span><span class="s2">.</span><span class="s1">set_norm</span><span class="s2">(</span><span class="s1">Normalize</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=-</span><span class="s6">20</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s6">20</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_scale</span><span class="s2">() == </span><span class="s5">'linear'</span>

    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">outline</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">() == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s5">'red'</span><span class="s2">)</span>

    <span class="s4"># log scale with no vmin/vmax set should scale to the data if there</span>
    <span class="s4"># is a mappable already associated with the colorbar, not (0, 1)</span>
    <span class="s1">pcm</span><span class="s2">.</span><span class="s1">norm </span><span class="s2">= </span><span class="s1">LogNorm</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">pcm</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">vmin </span><span class="s2">== </span><span class="s1">z</span><span class="s2">.</span><span class="s1">min</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">pcm</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">vmax </span><span class="s2">== </span><span class="s1">z</span><span class="s2">.</span><span class="s1">max</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_colorbar_get_ticks_2</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'_internal.classic_mode'</span><span class="s2">] = </span><span class="s0">False</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">([[</span><span class="s6">.05</span><span class="s2">, </span><span class="s6">.95</span><span class="s2">]])</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">(), [</span><span class="s6">0.</span><span class="s2">, </span><span class="s6">0.2</span><span class="s2">, </span><span class="s6">0.4</span><span class="s2">, </span><span class="s6">0.6</span><span class="s2">, </span><span class="s6">0.8</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_colorbar_inverted_ticks</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s6">10</span><span class="s2">**</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">5</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">), </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">())</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">ticks </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">()</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ticks</span><span class="s2">, </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">())</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">5</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">minorticks_on</span><span class="s2">()</span>
    <span class="s1">ticks </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">()</span>
    <span class="s1">minorticks </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">(</span><span class="s1">minor</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">minorticks</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ticks</span><span class="s2">, </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">())</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">minorticks</span><span class="s2">, </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">get_ticks</span><span class="s2">(</span><span class="s1">minor</span><span class="s2">=</span><span class="s0">True</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_mappable_no_alpha</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">sm </span><span class="s2">= </span><span class="s1">cm</span><span class="s2">.</span><span class="s1">ScalarMappable</span><span class="s2">(</span><span class="s1">norm</span><span class="s2">=</span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">Normalize</span><span class="s2">(), </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'viridis'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sm</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">sm</span><span class="s2">.</span><span class="s1">set_cmap</span><span class="s2">(</span><span class="s5">'plasma'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_mappable_2d_alpha</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">5</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)/</span><span class="s6">4</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s4"># The colorbar's alpha should be None and the mappable should still have</span>
    <span class="s4"># the original alpha array</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">alpha </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() </span><span class="s0">is </span><span class="s1">x</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_colorbar_label</span><span class="s2">():</span>
    <span class="s3">&quot;&quot;&quot; 
    Test the label parameter. It should just be mapped to the xlabel/ylabel of 
    the axes, depending on the orientation. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">]])</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'cbar'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylabel</span><span class="s2">() == </span><span class="s5">'cbar'</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylabel</span><span class="s2">() == </span><span class="s5">''</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s5">'cbar 2'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylabel</span><span class="s2">() == </span><span class="s5">'cbar 2'</span>

    <span class="s1">cbar2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cbar2</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylabel</span><span class="s2">() == </span><span class="s5">''</span>

    <span class="s1">cbar3 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'horizontal cbar'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cbar3</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlabel</span><span class="s2">() == </span><span class="s5">'horizontal cbar'</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'colorbar_keeping_xlabel.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_keeping_xlabel</span><span class="s2">():</span>
    <span class="s4"># github issue #23398 - xlabels being ignored in colorbar axis</span>
    <span class="s1">arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">25</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s6">5</span><span class="s2">, </span><span class="s6">5</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s5">'Visible Xlabel'</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s5">'YLabel'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;clim&quot;</span><span class="s2">, [(-</span><span class="s6">20000</span><span class="s2">, </span><span class="s6">20000</span><span class="s2">), (-</span><span class="s6">32768</span><span class="s2">, </span><span class="s6">0</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_colorbar_int</span><span class="s2">(</span><span class="s1">clim</span><span class="s2">):</span>
    <span class="s4"># Check that we cast to float early enough to not</span>
    <span class="s4"># overflow ``int16(20000) - int16(-20000)`` or</span>
    <span class="s4"># run into ``abs(int16(-32768)) == -32768``.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[*</span><span class="s1">map</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">, </span><span class="s1">clim</span><span class="s2">)]])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">im</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">im</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">vmax</span><span class="s2">) == </span><span class="s1">clim</span>


<span class="s0">def </span><span class="s1">test_anchored_cbar_position_using_specgrid</span><span class="s2">():</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1200</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">30</span><span class="s2">, </span><span class="s6">40</span><span class="s2">)</span>
    <span class="s1">levels </span><span class="s2">= [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">200</span><span class="s2">, </span><span class="s6">400</span><span class="s2">, </span><span class="s6">600</span><span class="s2">, </span><span class="s6">800</span><span class="s2">, </span><span class="s6">1000</span><span class="s2">, </span><span class="s6">1200</span><span class="s2">]</span>
    <span class="s1">shrink </span><span class="s2">= </span><span class="s6">0.5</span>
    <span class="s1">anchor_y </span><span class="s2">= </span><span class="s6">0.3</span>
    <span class="s4"># right</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span>
            <span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
            <span class="s1">location</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=(</span><span class="s6">1</span><span class="s2">, </span><span class="s1">anchor_y</span><span class="s2">), </span><span class="s1">shrink</span><span class="s2">=</span><span class="s1">shrink</span><span class="s2">)</span>

    <span class="s4"># the bottom left corner of one ax is (x0, y0)</span>
    <span class="s4"># the top right corner of one ax is (x1, y1)</span>
    <span class="s4"># p0: the vertical / horizontal position of anchor</span>
    <span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span>
    <span class="s1">cx0</span><span class="s2">, </span><span class="s1">cy0</span><span class="s2">, </span><span class="s1">cx1</span><span class="s2">, </span><span class="s1">cy1 </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span>
    <span class="s1">p0 </span><span class="s2">= (</span><span class="s1">y1 </span><span class="s2">- </span><span class="s1">y0</span><span class="s2">) * </span><span class="s1">anchor_y </span><span class="s2">+ </span><span class="s1">y0</span>

    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">cy1</span><span class="s2">, </span><span class="s1">cy0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s1">y1 </span><span class="s2">* </span><span class="s1">shrink </span><span class="s2">+ (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">shrink</span><span class="s2">) * </span><span class="s1">p0</span><span class="s2">, </span><span class="s1">p0 </span><span class="s2">* (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">shrink</span><span class="s2">) + </span><span class="s1">y0 </span><span class="s2">* </span><span class="s1">shrink</span><span class="s2">])</span>

    <span class="s4"># left</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span>
            <span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
            <span class="s1">location</span><span class="s2">=</span><span class="s5">'left'</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=(</span><span class="s6">1</span><span class="s2">, </span><span class="s1">anchor_y</span><span class="s2">), </span><span class="s1">shrink</span><span class="s2">=</span><span class="s1">shrink</span><span class="s2">)</span>

    <span class="s4"># the bottom left corner of one ax is (x0, y0)</span>
    <span class="s4"># the top right corner of one ax is (x1, y1)</span>
    <span class="s4"># p0: the vertical / horizontal position of anchor</span>
    <span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span>
    <span class="s1">cx0</span><span class="s2">, </span><span class="s1">cy0</span><span class="s2">, </span><span class="s1">cx1</span><span class="s2">, </span><span class="s1">cy1 </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span>
    <span class="s1">p0 </span><span class="s2">= (</span><span class="s1">y1 </span><span class="s2">- </span><span class="s1">y0</span><span class="s2">) * </span><span class="s1">anchor_y </span><span class="s2">+ </span><span class="s1">y0</span>

    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">cy1</span><span class="s2">, </span><span class="s1">cy0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s1">y1 </span><span class="s2">* </span><span class="s1">shrink </span><span class="s2">+ (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">shrink</span><span class="s2">) * </span><span class="s1">p0</span><span class="s2">, </span><span class="s1">p0 </span><span class="s2">* (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">shrink</span><span class="s2">) + </span><span class="s1">y0 </span><span class="s2">* </span><span class="s1">shrink</span><span class="s2">])</span>

    <span class="s4"># top</span>
    <span class="s1">shrink </span><span class="s2">= </span><span class="s6">0.5</span>
    <span class="s1">anchor_x </span><span class="s2">= </span><span class="s6">0.3</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span>
            <span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
            <span class="s1">location</span><span class="s2">=</span><span class="s5">'top'</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=(</span><span class="s1">anchor_x</span><span class="s2">, </span><span class="s6">1</span><span class="s2">), </span><span class="s1">shrink</span><span class="s2">=</span><span class="s1">shrink</span><span class="s2">)</span>

    <span class="s4"># the bottom left corner of one ax is (x0, y0)</span>
    <span class="s4"># the top right corner of one ax is (x1, y1)</span>
    <span class="s4"># p0: the vertical / horizontal position of anchor</span>
    <span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span>
    <span class="s1">cx0</span><span class="s2">, </span><span class="s1">cy0</span><span class="s2">, </span><span class="s1">cx1</span><span class="s2">, </span><span class="s1">cy1 </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span>
    <span class="s1">p0 </span><span class="s2">= (</span><span class="s1">x1 </span><span class="s2">- </span><span class="s1">x0</span><span class="s2">) * </span><span class="s1">anchor_x </span><span class="s2">+ </span><span class="s1">x0</span>

    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">cx1</span><span class="s2">, </span><span class="s1">cx0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s1">x1 </span><span class="s2">* </span><span class="s1">shrink </span><span class="s2">+ (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">shrink</span><span class="s2">) * </span><span class="s1">p0</span><span class="s2">, </span><span class="s1">p0 </span><span class="s2">* (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">shrink</span><span class="s2">) + </span><span class="s1">x0 </span><span class="s2">* </span><span class="s1">shrink</span><span class="s2">])</span>

    <span class="s4"># bottom</span>
    <span class="s1">shrink </span><span class="s2">= </span><span class="s6">0.5</span>
    <span class="s1">anchor_x </span><span class="s2">= </span><span class="s6">0.3</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span>
            <span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">use_gridspec</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
            <span class="s1">location</span><span class="s2">=</span><span class="s5">'bottom'</span><span class="s2">, </span><span class="s1">anchor</span><span class="s2">=(</span><span class="s1">anchor_x</span><span class="s2">, </span><span class="s6">1</span><span class="s2">), </span><span class="s1">shrink</span><span class="s2">=</span><span class="s1">shrink</span><span class="s2">)</span>

    <span class="s4"># the bottom left corner of one ax is (x0, y0)</span>
    <span class="s4"># the top right corner of one ax is (x1, y1)</span>
    <span class="s4"># p0: the vertical / horizontal position of anchor</span>
    <span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span>
    <span class="s1">cx0</span><span class="s2">, </span><span class="s1">cy0</span><span class="s2">, </span><span class="s1">cx1</span><span class="s2">, </span><span class="s1">cy1 </span><span class="s2">= </span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span>
    <span class="s1">p0 </span><span class="s2">= (</span><span class="s1">x1 </span><span class="s2">- </span><span class="s1">x0</span><span class="s2">) * </span><span class="s1">anchor_x </span><span class="s2">+ </span><span class="s1">x0</span>

    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">cx1</span><span class="s2">, </span><span class="s1">cx0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s1">x1 </span><span class="s2">* </span><span class="s1">shrink </span><span class="s2">+ (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">shrink</span><span class="s2">) * </span><span class="s1">p0</span><span class="s2">, </span><span class="s1">p0 </span><span class="s2">* (</span><span class="s6">1 </span><span class="s2">- </span><span class="s1">shrink</span><span class="s2">) + </span><span class="s1">x0 </span><span class="s2">* </span><span class="s1">shrink</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'colorbar_change_lim_scale.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_change_lim_scale</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s1">constrained_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">100</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">)+</span><span class="s6">1</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s5">'log'</span><span class="s2">)</span>

    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">[</span><span class="s6">1</span><span class="s2">].</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">100</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">)+</span><span class="s6">1</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">[</span><span class="s6">1</span><span class="s2">], </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">([</span><span class="s6">20</span><span class="s2">, </span><span class="s6">90</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s5">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_axes_handles_same_functions</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">):</span>
    <span class="s4"># prove that cax and cb.ax are functionally the same</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">fig </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">([</span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">]):</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
        <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s6">300</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">30</span><span class="s2">))</span>
        <span class="s1">cax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s6">0.9</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">, </span><span class="s6">0.03</span><span class="s2">, </span><span class="s6">0.8</span><span class="s2">])</span>
        <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">cax</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">nn </span><span class="s2">== </span><span class="s6">0</span><span class="s2">:</span>
            <span class="s1">caxx </span><span class="s2">= </span><span class="s1">cax</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">caxx </span><span class="s2">= </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span>
        <span class="s1">caxx</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">20</span><span class="s2">))</span>
        <span class="s1">caxx</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s5">'log'</span><span class="s2">)</span>
        <span class="s1">caxx</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">([</span><span class="s6">0.92</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">, </span><span class="s6">0.02</span><span class="s2">, </span><span class="s6">0.7</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_inset_colorbar_layout</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">constrained_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">3</span><span class="s2">, </span><span class="s6">6</span><span class="s2">))</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">100</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">))</span>
    <span class="s1">cax </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s6">1.02</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">, </span><span class="s6">0.03</span><span class="s2">, </span><span class="s6">0.8</span><span class="s2">])</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">cax</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s4"># make sure this is in the figure. In the colorbar swapping</span>
    <span class="s4"># it was being dropped from the list of children...</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">bounds</span><span class="s2">,</span>
                               <span class="s2">[</span><span class="s6">0.87</span><span class="s2">, </span><span class="s6">0.342</span><span class="s2">, </span><span class="s6">0.0237</span><span class="s2">, </span><span class="s6">0.315</span><span class="s2">], </span><span class="s1">atol</span><span class="s2">=</span><span class="s6">0.01</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">child_axes</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'colorbar_twoslope.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_twoslope_colorbar</span><span class="s2">():</span>
    <span class="s4"># Note that the second tick = 20, and should be in the middle</span>
    <span class="s4"># of the colorbar (white)</span>
    <span class="s4"># There should be no tick right at the bottom, nor at the top.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">TwoSlopeNorm</span><span class="s2">(</span><span class="s6">20</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">95</span><span class="s2">)</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">11</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">11</span><span class="s2">),</span>
                       <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">100</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">),</span>
                       <span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s5">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_remove_cb_whose_mappable_has_no_figure</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">ScalarMappable</span><span class="s2">(), </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_aspects</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">8</span><span class="s2">, </span><span class="s6">8</span><span class="s2">))</span>
    <span class="s1">aspects </span><span class="s2">= [</span><span class="s6">20</span><span class="s2">, </span><span class="s6">20</span><span class="s2">, </span><span class="s6">10</span><span class="s2">]</span>
    <span class="s1">extends </span><span class="s2">= [</span><span class="s5">'neither'</span><span class="s2">, </span><span class="s5">'both'</span><span class="s2">, </span><span class="s5">'both'</span><span class="s2">]</span>
    <span class="s1">cb </span><span class="s2">= [[</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">], [</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">]]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">orient </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">([</span><span class="s5">'vertical'</span><span class="s2">, </span><span class="s5">'horizontal'</span><span class="s2">]):</span>
        <span class="s0">for </span><span class="s1">mm</span><span class="s2">, (</span><span class="s1">aspect</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">) </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">zip</span><span class="s2">(</span><span class="s1">aspects</span><span class="s2">, </span><span class="s1">extends</span><span class="s2">)):</span>
            <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">[</span><span class="s1">mm</span><span class="s2">, </span><span class="s1">nn</span><span class="s2">].</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">100</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">))</span>
            <span class="s1">cb</span><span class="s2">[</span><span class="s1">nn</span><span class="s2">][</span><span class="s1">mm</span><span class="s2">] = </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">[</span><span class="s1">mm</span><span class="s2">, </span><span class="s1">nn</span><span class="s2">], </span><span class="s1">orientation</span><span class="s2">=</span><span class="s1">orient</span><span class="s2">,</span>
                                      <span class="s1">aspect</span><span class="s2">=</span><span class="s1">aspect</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s1">extend</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s4"># check the extends are right ratio:</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">1</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">height</span><span class="s2">,</span>
                                   <span class="s1">cb</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">height </span><span class="s2">* </span><span class="s6">0.9</span><span class="s2">,</span>
                                   <span class="s1">decimal</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s4"># horizontal</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">[</span><span class="s6">1</span><span class="s2">][</span><span class="s6">1</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">width</span><span class="s2">,</span>
                                   <span class="s1">cb</span><span class="s2">[</span><span class="s6">1</span><span class="s2">][</span><span class="s6">0</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">width </span><span class="s2">* </span><span class="s6">0.9</span><span class="s2">,</span>
                                   <span class="s1">decimal</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s4"># check correct aspect:</span>
    <span class="s1">pos </span><span class="s2">= </span><span class="s1">cb</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">original</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">.</span><span class="s1">height</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">.</span><span class="s1">width </span><span class="s2">* </span><span class="s6">20</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">pos </span><span class="s2">= </span><span class="s1">cb</span><span class="s2">[</span><span class="s6">1</span><span class="s2">][</span><span class="s6">0</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">original</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">.</span><span class="s1">height </span><span class="s2">* </span><span class="s6">20</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s4"># check twice as wide if aspect is 10 instead of 20</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span>
        <span class="s1">cb</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">0</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">original</span><span class="s2">=</span><span class="s0">False</span><span class="s2">).</span><span class="s1">width </span><span class="s2">* </span><span class="s6">2</span><span class="s2">,</span>
        <span class="s1">cb</span><span class="s2">[</span><span class="s6">0</span><span class="s2">][</span><span class="s6">2</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">original</span><span class="s2">=</span><span class="s0">False</span><span class="s2">).</span><span class="s1">width</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span>
        <span class="s1">cb</span><span class="s2">[</span><span class="s6">1</span><span class="s2">][</span><span class="s6">0</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">original</span><span class="s2">=</span><span class="s0">False</span><span class="s2">).</span><span class="s1">height </span><span class="s2">* </span><span class="s6">2</span><span class="s2">,</span>
        <span class="s1">cb</span><span class="s2">[</span><span class="s6">1</span><span class="s2">][</span><span class="s6">2</span><span class="s2">].</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">original</span><span class="s2">=</span><span class="s0">False</span><span class="s2">).</span><span class="s1">height</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'proportional_colorbars.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_proportional_colorbars</span><span class="s2">():</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">3.0</span><span class="s2">, </span><span class="s6">3.01</span><span class="s2">, </span><span class="s6">0.025</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">X</span><span class="s2">**</span><span class="s6">2 </span><span class="s2">- </span><span class="s1">Y</span><span class="s2">**</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">Z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-(</span><span class="s1">X </span><span class="s2">- </span><span class="s6">1</span><span class="s2">)**</span><span class="s6">2 </span><span class="s2">- (</span><span class="s1">Y </span><span class="s2">- </span><span class="s6">1</span><span class="s2">)**</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= (</span><span class="s1">Z1 </span><span class="s2">- </span><span class="s1">Z2</span><span class="s2">) * </span><span class="s6">2</span>

    <span class="s1">levels </span><span class="s2">= [-</span><span class="s6">1.25</span><span class="s2">, -</span><span class="s6">0.5</span><span class="s2">, -</span><span class="s6">0.125</span><span class="s2">, </span><span class="s6">0.125</span><span class="s2">, </span><span class="s6">0.5</span><span class="s2">, </span><span class="s6">1.25</span><span class="s2">]</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">ListedColormap</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s5">'0.3'</span><span class="s2">, </span><span class="s5">'0.5'</span><span class="s2">, </span><span class="s5">'white'</span><span class="s2">, </span><span class="s5">'lightblue'</span><span class="s2">, </span><span class="s5">'steelblue'</span><span class="s2">])</span>
    <span class="s1">cmap</span><span class="s2">.</span><span class="s1">set_under</span><span class="s2">(</span><span class="s5">'darkred'</span><span class="s2">)</span>
    <span class="s1">cmap</span><span class="s2">.</span><span class="s1">set_over</span><span class="s2">(</span><span class="s5">'crimson'</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">.</span><span class="s1">N</span><span class="s2">)</span>

    <span class="s1">extends </span><span class="s2">= [</span><span class="s5">'neither'</span><span class="s2">, </span><span class="s5">'both'</span><span class="s2">]</span>
    <span class="s1">spacings </span><span class="s2">= [</span><span class="s5">'uniform'</span><span class="s2">, </span><span class="s5">'proportional'</span><span class="s2">]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">2</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">2</span><span class="s2">):</span>
            <span class="s1">CS3 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">].</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">,</span>
                                     <span class="s1">extend</span><span class="s2">=</span><span class="s1">extends</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">CS3</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s1">spacings</span><span class="s2">[</span><span class="s1">j</span><span class="s2">], </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">axs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'extend_drawedges.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_extend_drawedges</span><span class="s2">():</span>
    <span class="s1">params </span><span class="s2">= [</span>
        <span class="s2">(</span><span class="s5">'both'</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, [[[</span><span class="s6">1.1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">1.1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]],</span>
                     <span class="s2">[[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]],</span>
                     <span class="s2">[[</span><span class="s6">2.9</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">2.9</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]]]),</span>
        <span class="s2">(</span><span class="s5">'min'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, [[[</span><span class="s6">1.1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">1.1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]],</span>
                    <span class="s2">[[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]]]),</span>
        <span class="s2">(</span><span class="s5">'max'</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, [[[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]],</span>
                    <span class="s2">[[</span><span class="s6">2.9</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">2.9</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]]]),</span>
        <span class="s2">(</span><span class="s5">'neither'</span><span class="s2">, -</span><span class="s6">1</span><span class="s2">, [[[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]]]),</span>
    <span class="s2">]</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'axes.linewidth'</span><span class="s2">] = </span><span class="s6">2</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">4</span><span class="s2">))</span>
    <span class="s1">subfigs </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">subfigures</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">orientation</span><span class="s2">, </span><span class="s1">subfig </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">([</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s5">'vertical'</span><span class="s2">], </span><span class="s1">subfigs</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s5">'horizontal'</span><span class="s2">:</span>
            <span class="s1">axs </span><span class="s2">= </span><span class="s1">subfig</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">4</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">axs </span><span class="s2">= </span><span class="s1">subfig</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">4</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s6">0.05</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s6">0.05</span><span class="s2">, </span><span class="s1">right</span><span class="s2">=</span><span class="s6">0.95</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s6">0.95</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, (</span><span class="s1">extend</span><span class="s2">, </span><span class="s1">coloroffset</span><span class="s2">, </span><span class="s1">res</span><span class="s2">) </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">, </span><span class="s1">params</span><span class="s2">):</span>
            <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">&quot;viridis&quot;</span><span class="s2">]</span>
            <span class="s1">bounds </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">5</span><span class="s2">)</span>
            <span class="s1">nb_colors </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">bounds</span><span class="s2">) + </span><span class="s1">coloroffset</span>
            <span class="s1">colors </span><span class="s2">= </span><span class="s1">cmap</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s6">100</span><span class="s2">, </span><span class="s6">255</span><span class="s2">, </span><span class="s1">nb_colors</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">int</span><span class="s2">))</span>
            <span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">from_levels_and_colors</span><span class="s2">(</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">,</span>
                                                        <span class="s1">extend</span><span class="s2">=</span><span class="s1">extend</span><span class="s2">)</span>

            <span class="s1">cbar </span><span class="s2">= </span><span class="s1">Colorbar</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s1">orientation</span><span class="s2">,</span>
                            <span class="s1">drawedges</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s4"># Set limits such that only two colours are visible, and the</span>
            <span class="s4"># dividers would be outside the Axes, to ensure that a) they are</span>
            <span class="s4"># not drawn outside, and b) a divider still appears between the</span>
            <span class="s4"># main colour and the extension.</span>
            <span class="s0">if </span><span class="s1">orientation </span><span class="s2">== </span><span class="s5">'horizontal'</span><span class="s2">:</span>
                <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s6">1.1</span><span class="s2">, </span><span class="s6">2.9</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s6">1.1</span><span class="s2">, </span><span class="s6">2.9</span><span class="s2">)</span>
                <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">res</span><span class="s2">)[:, :, [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">]]</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">cbar</span><span class="s2">.</span><span class="s1">dividers</span><span class="s2">.</span><span class="s1">get_segments</span><span class="s2">(), </span><span class="s1">res</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contourf_extend_patches.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_colorbar_contourf_extend_patches</span><span class="s2">():</span>
    <span class="s1">params </span><span class="s2">= [</span>
        <span class="s2">(</span><span class="s5">'both'</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, [</span><span class="s5">'</span><span class="s0">\\</span><span class="s5">'</span><span class="s2">, </span><span class="s5">'//'</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s5">'min'</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, [</span><span class="s5">'+'</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s5">'max'</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, [</span><span class="s5">'|'</span><span class="s2">, </span><span class="s5">'-'</span><span class="s2">, </span><span class="s5">'/'</span><span class="s2">, </span><span class="s5">'</span><span class="s0">\\</span><span class="s5">'</span><span class="s2">, </span><span class="s5">'//'</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s5">'neither'</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, [</span><span class="s5">'//'</span><span class="s2">, </span><span class="s5">'</span><span class="s0">\\</span><span class="s5">'</span><span class="s2">, </span><span class="s5">'||'</span><span class="s2">]),</span>
    <span class="s2">]</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'axes.linewidth'</span><span class="s2">] = </span><span class="s6">2</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">4</span><span class="s2">))</span>
    <span class="s1">subfigs </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">subfigures</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s6">0.05</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s6">0.05</span><span class="s2">, </span><span class="s1">right</span><span class="s2">=</span><span class="s6">0.95</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s6">0.95</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">50</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">30</span><span class="s2">)</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">, :]) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[:, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">])</span>

    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">&quot;viridis&quot;</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">orientation</span><span class="s2">, </span><span class="s1">subfig </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">([</span><span class="s5">'horizontal'</span><span class="s2">, </span><span class="s5">'vertical'</span><span class="s2">], </span><span class="s1">subfigs</span><span class="s2">):</span>
        <span class="s1">axs </span><span class="s2">= </span><span class="s1">subfig</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">).</span><span class="s1">ravel</span><span class="s2">()</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, (</span><span class="s1">extend</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">, </span><span class="s1">hatches</span><span class="s2">) </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">, </span><span class="s1">params</span><span class="s2">):</span>
            <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">, </span><span class="s1">hatches</span><span class="s2">=</span><span class="s1">hatches</span><span class="s2">,</span>
                             <span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s1">extend</span><span class="s2">)</span>
            <span class="s1">subfig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s1">orientation</span><span class="s2">, </span><span class="s1">fraction</span><span class="s2">=</span><span class="s6">0.4</span><span class="s2">,</span>
                            <span class="s1">extendfrac</span><span class="s2">=</span><span class="s6">0.2</span><span class="s2">, </span><span class="s1">aspect</span><span class="s2">=</span><span class="s6">5</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_negative_boundarynorm</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">))</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">&quot;viridis&quot;</span><span class="s2">]</span>

    <span class="s1">clevs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">94</span><span class="s2">, -</span><span class="s6">85</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">.</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">ScalarMappable</span><span class="s2">(</span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">), </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), [</span><span class="s1">clevs</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">clevs</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticks</span><span class="s2">(), </span><span class="s1">clevs</span><span class="s2">)</span>

    <span class="s1">clevs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">85</span><span class="s2">, </span><span class="s6">94</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">.</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">ScalarMappable</span><span class="s2">(</span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">), </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), [</span><span class="s1">clevs</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">clevs</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticks</span><span class="s2">(), </span><span class="s1">clevs</span><span class="s2">)</span>

    <span class="s1">clevs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">3</span><span class="s2">, </span><span class="s6">3</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">.</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">ScalarMappable</span><span class="s2">(</span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">), </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), [</span><span class="s1">clevs</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">clevs</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticks</span><span class="s2">(), </span><span class="s1">clevs</span><span class="s2">)</span>

    <span class="s1">clevs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s6">8</span><span class="s2">, </span><span class="s6">1</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">clevs</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">.</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">ScalarMappable</span><span class="s2">(</span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">), </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), [</span><span class="s1">clevs</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">clevs</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticks</span><span class="s2">(), </span><span class="s1">clevs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_centerednorm</span><span class="s2">():</span>
    <span class="s4"># Test default centered norm gets expanded with non-singular limits</span>
    <span class="s4"># when plot data is all equal (autoscale halfrange == 0)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">))</span>

    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">CenteredNorm</span><span class="s2">()</span>
    <span class="s1">mappable </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s6">3</span><span class="s2">, </span><span class="s6">3</span><span class="s2">)), </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">mappable</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">.</span><span class="s1">vmax</span><span class="s2">) == (-</span><span class="s6">0.1</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'nonorm_colorbars.svg'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_nonorm</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'svg.fonttype'</span><span class="s2">] = </span><span class="s5">'none'</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">5</span><span class="s2">]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">6</span><span class="s2">, </span><span class="s6">1</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">bottom</span><span class="s2">=</span><span class="s6">0.5</span><span class="s2">)</span>

    <span class="s1">norm </span><span class="s2">= </span><span class="s1">NoNorm</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=</span><span class="s1">min</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s1">vmax</span><span class="s2">=</span><span class="s1">max</span><span class="s2">(</span><span class="s1">data</span><span class="s2">))</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">&quot;viridis&quot;</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">data</span><span class="s2">))</span>
    <span class="s1">mappable </span><span class="s2">= </span><span class="s1">cm</span><span class="s2">.</span><span class="s1">ScalarMappable</span><span class="s2">(</span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">mappable</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s5">&quot;horizontal&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'test_boundaries.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boundaries</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s1">seed</span><span class="s2">=</span><span class="s6">19680808</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">))</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">), </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">boundaries</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s6">3</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">7</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_colorbar_no_warning_rcparams_grid_true</span><span class="s2">():</span>
    <span class="s4"># github issue #21723 - If mpl style has 'axes.grid' = True,</span>
    <span class="s4"># fig.colorbar raises a warning about Auto-removal of grids</span>
    <span class="s4"># by pcolor() and pcolormesh(). This is fixed by PR #22216.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'axes.grid'</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [[</span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s4"># make sure that no warning is raised by fig.colorbar</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_set_formatter_locator</span><span class="s2">():</span>
    <span class="s4"># check that the locator properties echo what is on the axis:</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">))</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">FixedLocator</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">10</span><span class="s2">)))</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_minor_locator</span><span class="s2">(</span><span class="s1">FixedLocator</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, </span><span class="s6">0.2</span><span class="s2">)))</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">locator </span><span class="s0">is </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_locator</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">minorlocator </span><span class="s0">is </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minor_locator</span><span class="s2">()</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">LogFormatter</span><span class="s2">())</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_minor_formatter</span><span class="s2">(</span><span class="s1">LogFormatter</span><span class="s2">())</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">formatter </span><span class="s0">is </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_formatter</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">minorformatter </span><span class="s0">is </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minor_formatter</span><span class="s2">()</span>

    <span class="s4"># check that the setter works as expected:</span>
    <span class="s1">loc </span><span class="s2">= </span><span class="s1">FixedLocator</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">7</span><span class="s2">))</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">locator </span><span class="s2">= </span><span class="s1">loc</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_locator</span><span class="s2">() </span><span class="s0">is </span><span class="s1">loc</span>
    <span class="s1">loc </span><span class="s2">= </span><span class="s1">FixedLocator</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">))</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">minorlocator </span><span class="s2">= </span><span class="s1">loc</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minor_locator</span><span class="s2">() </span><span class="s0">is </span><span class="s1">loc</span>
    <span class="s1">fmt </span><span class="s2">= </span><span class="s1">LogFormatter</span><span class="s2">()</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">formatter </span><span class="s2">= </span><span class="s1">fmt</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_formatter</span><span class="s2">() </span><span class="s0">is </span><span class="s1">fmt</span>
    <span class="s1">fmt </span><span class="s2">= </span><span class="s1">LogFormatter</span><span class="s2">()</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">minorformatter </span><span class="s2">= </span><span class="s1">fmt</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minor_formatter</span><span class="s2">() </span><span class="s0">is </span><span class="s1">fmt</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'colorbar_extend_alpha.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s5">'dpi'</span><span class="s2">: </span><span class="s6">40</span><span class="s2">})</span>
<span class="s0">def </span><span class="s1">test_colorbar_extend_alpha</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]], </span><span class="s1">alpha</span><span class="s2">=</span><span class="s6">0.3</span><span class="s2">, </span><span class="s1">interpolation</span><span class="s2">=</span><span class="s5">&quot;none&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">, </span><span class="s1">boundaries</span><span class="s2">=[</span><span class="s6">0.5</span><span class="s2">, </span><span class="s6">1.5</span><span class="s2">, </span><span class="s6">2.5</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_offset_text_loc</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">use</span><span class="s2">(</span><span class="s5">'mpl20'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s1">seed</span><span class="s2">=</span><span class="s6">19680808</span><span class="s2">)</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">)*</span><span class="s6">1e6</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">location</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'max'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s4"># check that the offsetText is in the proper place above the</span>
    <span class="s4"># colorbar axes.  In this case the colorbar axes is the same</span>
    <span class="s4"># height as the parent, so use the parents bbox.</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()[</span><span class="s6">1</span><span class="s2">] &gt; </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">y1</span>


<span class="s0">def </span><span class="s1">test_title_text_loc</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">use</span><span class="s2">(</span><span class="s5">'mpl20'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s1">seed</span><span class="s2">=</span><span class="s6">19680808</span><span class="s2">)</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s6">10</span><span class="s2">, </span><span class="s6">10</span><span class="s2">))</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">, </span><span class="s1">location</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'max'</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">'Aardvark'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s4"># check that the title is in the proper place above the</span>
    <span class="s4"># colorbar axes, including its extend triangles....</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()).</span><span class="s1">ymax </span><span class="s2">&gt;</span>
            <span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">[</span><span class="s5">'outline'</span><span class="s2">].</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">ymax</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s5">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_passing_location</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">):</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]])</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1.05</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0.05</span><span class="s2">]),</span>
                           <span class="s1">orientation</span><span class="s2">=</span><span class="s5">&quot;horizontal&quot;</span><span class="s2">, </span><span class="s1">ticklocation</span><span class="s2">=</span><span class="s5">&quot;top&quot;</span><span class="s2">)</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax_test</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]])</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">cax</span><span class="s2">=</span><span class="s1">ax_test</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1.05</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0.05</span><span class="s2">]),</span>
                            <span class="s1">location</span><span class="s2">=</span><span class="s5">&quot;top&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;kwargs,error,message&quot;</span><span class="s2">, [</span>
    <span class="s2">({</span><span class="s5">'location'</span><span class="s2">: </span><span class="s5">'top'</span><span class="s2">, </span><span class="s5">'orientation'</span><span class="s2">: </span><span class="s5">'vertical'</span><span class="s2">}, </span><span class="s1">TypeError</span><span class="s2">,</span>
     <span class="s5">&quot;location and orientation are mutually exclusive&quot;</span><span class="s2">),</span>
    <span class="s2">({</span><span class="s5">'location'</span><span class="s2">: </span><span class="s5">'top'</span><span class="s2">, </span><span class="s5">'orientation'</span><span class="s2">: </span><span class="s5">'vertical'</span><span class="s2">, </span><span class="s5">'cax'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}, </span><span class="s1">TypeError</span><span class="s2">,</span>
     <span class="s5">&quot;location and orientation are mutually exclusive&quot;</span><span class="s2">),  </span><span class="s4"># Different to above</span>
    <span class="s2">({</span><span class="s5">'ticklocation'</span><span class="s2">: </span><span class="s5">'top'</span><span class="s2">, </span><span class="s5">'orientation'</span><span class="s2">: </span><span class="s5">'vertical'</span><span class="s2">, </span><span class="s5">'cax'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">},</span>
     <span class="s1">ValueError</span><span class="s2">, </span><span class="s5">&quot;'top' is not a valid value for position&quot;</span><span class="s2">),</span>
    <span class="s2">({</span><span class="s5">'location'</span><span class="s2">: </span><span class="s5">'top'</span><span class="s2">, </span><span class="s5">'extendfrac'</span><span class="s2">: (</span><span class="s6">0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)}, </span><span class="s1">ValueError</span><span class="s2">,</span>
     <span class="s5">&quot;invalid value for extendfrac&quot;</span><span class="s2">),</span>
    <span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_colorbar_errors</span><span class="s2">(</span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">error</span><span class="s2">, </span><span class="s1">message</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]])</span>
    <span class="s0">if </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s5">'cax'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">) </span><span class="s0">is True</span><span class="s2">:</span>
        <span class="s1">kwargs</span><span class="s2">[</span><span class="s5">'cax'</span><span class="s2">] = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1.05</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0.05</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">error</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_colorbar_axes_parmeters</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]])</span>
    <span class="s4"># colorbar should accept any form of axes sequence:</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=[</span><span class="s1">_ax </span><span class="s0">for </span><span class="s1">_ax </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=(</span><span class="s1">ax</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">ax</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">={</span><span class="s1">i</span><span class="s2">: </span><span class="s1">_ax </span><span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">_ax </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">)}.</span><span class="s1">values</span><span class="s2">())</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_colorbar_wrong_figure</span><span class="s2">():</span>
    <span class="s4"># If we decide in the future to disallow calling colorbar() on the &quot;wrong&quot; figure,</span>
    <span class="s4"># just delete this test.</span>
    <span class="s1">fig_tl </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">layout</span><span class="s2">=</span><span class="s5">&quot;tight&quot;</span><span class="s2">)</span>
    <span class="s1">fig_cl </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">layout</span><span class="s2">=</span><span class="s5">&quot;constrained&quot;</span><span class="s2">)</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">fig_cl</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">().</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s4"># Make sure this doesn't try to setup a gridspec-controlled colorbar on fig_cl,</span>
    <span class="s4"># which would crash CL.</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;different Figure&quot;</span><span class="s2">):</span>
        <span class="s1">fig_tl</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">im</span><span class="s2">)</span>
    <span class="s1">fig_tl</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s1">fig_cl</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_colorbar_format_string_and_old</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">]])</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">format</span><span class="s2">=</span><span class="s5">&quot;{x}%&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">_formatter</span><span class="s2">, </span><span class="s1">StrMethodFormatter</span><span class="s2">)</span>
</pre>
</body>
</html>