<html>
<head>
<title>test_export.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_export.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Testing for export functions of decision trees (sklearn.tree.export). 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">io </span><span class="s2">import </span><span class="s1">StringIO</span>
<span class="s2">from </span><span class="s1">re </span><span class="s2">import </span><span class="s1">finditer</span><span class="s3">, </span><span class="s1">search</span>
<span class="s2">from </span><span class="s1">textwrap </span><span class="s2">import </span><span class="s1">dedent</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">from </span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">random </span><span class="s2">import </span><span class="s1">RandomState</span>

<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">base </span><span class="s2">import </span><span class="s1">is_classifier</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">ensemble </span><span class="s2">import </span><span class="s1">GradientBoostingClassifier</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">exceptions </span><span class="s2">import </span><span class="s1">NotFittedError</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">tree </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">DecisionTreeClassifier</span><span class="s3">,</span>
    <span class="s1">DecisionTreeRegressor</span><span class="s3">,</span>
    <span class="s1">export_graphviz</span><span class="s3">,</span>
    <span class="s1">export_text</span><span class="s3">,</span>
    <span class="s1">plot_tree</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s4"># toy sample</span>
<span class="s1">X </span><span class="s3">= [[-</span><span class="s5">2</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">2</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], [</span><span class="s5">2</span><span class="s3">, </span><span class="s5">1</span><span class="s3">]]</span>
<span class="s1">y </span><span class="s3">= [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">]</span>
<span class="s1">y2 </span><span class="s3">= [[-</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">3</span><span class="s3">]]</span>
<span class="s1">w </span><span class="s3">= [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">, </span><span class="s5">0.5</span><span class="s3">]</span>
<span class="s1">y_degraded </span><span class="s3">= [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">]</span>


<span class="s2">def </span><span class="s1">test_graphviz_toy</span><span class="s3">():</span>
    <span class="s4"># Check correctness of export_graphviz</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span>
        <span class="s1">max_depth</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">min_samples_split</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">criterion</span><span class="s3">=</span><span class="s6">&quot;gini&quot;</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">2</span>
    <span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s4"># Test export code</span>
    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'edge [fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'0 [label=&quot;x[0] &lt;= 0.0</span><span class="s2">\\</span><span class="s6">ngini = 0.5</span><span class="s2">\\</span><span class="s6">nsamples = 6</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'value = [3, 3]&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'1 [label=&quot;gini = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">nvalue = [3, 0]&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 1 [labeldistance=2.5, labelangle=45, &quot;</span>
        <span class="s6">'headlabel=&quot;True&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'2 [label=&quot;gini = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">nvalue = [0, 3]&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 2 [labeldistance=2.5, labelangle=-45, &quot;</span>
        <span class="s6">'headlabel=&quot;False&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">contents1 </span><span class="s3">== </span><span class="s1">contents2</span>

    <span class="s4"># Test plot_options</span>
    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span>
        <span class="s1">clf</span><span class="s3">,</span>
        <span class="s1">filled</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">impurity</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">proportion</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">special_characters</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">rounded</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">fontname</span><span class="s3">=</span><span class="s6">&quot;sans&quot;</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, style=&quot;filled, rounded&quot;, color=&quot;black&quot;, '</span>
        <span class="s6">'fontname=&quot;sans&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'edge [fontname=&quot;sans&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 [label=&lt;x&lt;SUB&gt;0&lt;/SUB&gt; &amp;le; 0.0&lt;br/&gt;samples = 100.0%&lt;br/&gt;&quot;</span>
        <span class="s6">'value = [0.5, 0.5]&gt;, fillcolor=&quot;#ffffff&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;1 [label=&lt;samples = 50.0%&lt;br/&gt;value = [1.0, 0.0]&gt;, &quot;</span>
        <span class="s6">'fillcolor=&quot;#e58139&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 1 [labeldistance=2.5, labelangle=45, &quot;</span>
        <span class="s6">'headlabel=&quot;True&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;2 [label=&lt;samples = 50.0%&lt;br/&gt;value = [0.0, 1.0]&gt;, &quot;</span>
        <span class="s6">'fillcolor=&quot;#399de5&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 2 [labeldistance=2.5, labelangle=-45, &quot;</span>
        <span class="s6">'headlabel=&quot;False&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">contents1 </span><span class="s3">== </span><span class="s1">contents2</span>

    <span class="s4"># Test max_depth</span>
    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s1">class_names</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'edge [fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'0 [label=&quot;x[0] &lt;= 0.0</span><span class="s2">\\</span><span class="s6">ngini = 0.5</span><span class="s2">\\</span><span class="s6">nsamples = 6</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'value = [3, 3]</span><span class="s2">\\</span><span class="s6">nclass = y[0]&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'1 [label=&quot;(...)&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 1 ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'2 [label=&quot;(...)&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 2 ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">contents1 </span><span class="s3">== </span><span class="s1">contents2</span>

    <span class="s4"># Test max_depth with plot_options</span>
    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span>
        <span class="s1">clf</span><span class="s3">, </span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s1">filled</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">node_ids</span><span class="s3">=</span><span class="s2">True</span>
    <span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, style=&quot;filled&quot;, color=&quot;black&quot;, '</span>
        <span class="s6">'fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'edge [fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'0 [label=&quot;node #0</span><span class="s2">\\</span><span class="s6">nx[0] &lt;= 0.0</span><span class="s2">\\</span><span class="s6">ngini = 0.5</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'samples = 6</span><span class="s2">\\</span><span class="s6">nvalue = [3, 3]&quot;, fillcolor=&quot;#ffffff&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'1 [label=&quot;(...)&quot;, fillcolor=&quot;#C0C0C0&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 1 ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'2 [label=&quot;(...)&quot;, fillcolor=&quot;#C0C0C0&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 2 ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">contents1 </span><span class="s3">== </span><span class="s1">contents2</span>

    <span class="s4"># Test multi-output with weighted samples</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span>
        <span class="s1">max_depth</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">min_samples_split</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">criterion</span><span class="s3">=</span><span class="s6">&quot;gini&quot;</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">2</span>
    <span class="s3">)</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y2</span><span class="s3">, </span><span class="s1">sample_weight</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>

    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">filled</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">impurity</span><span class="s3">=</span><span class="s2">False</span><span class="s3">, </span><span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, style=&quot;filled&quot;, color=&quot;black&quot;, '</span>
        <span class="s6">'fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'edge [fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'0 [label=&quot;x[0] &lt;= 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 6</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">&quot;value = [[3.0, 1.5, 0.0]</span><span class="s2">\\</span><span class="s6">n&quot;</span>
        <span class="s6">'[3.0, 1.0, 0.5]]&quot;, fillcolor=&quot;#ffffff&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'1 [label=&quot;samples = 3</span><span class="s2">\\</span><span class="s6">nvalue = [[3, 0, 0]</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'[3, 0, 0]]&quot;, fillcolor=&quot;#e58139&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 1 [labeldistance=2.5, labelangle=45, &quot;</span>
        <span class="s6">'headlabel=&quot;True&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'2 [label=&quot;x[0] &lt;= 1.5</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">&quot;value = [[0.0, 1.5, 0.0]</span><span class="s2">\\</span><span class="s6">n&quot;</span>
        <span class="s6">'[0.0, 1.0, 0.5]]&quot;, fillcolor=&quot;#f1bd97&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 2 [labeldistance=2.5, labelangle=-45, &quot;</span>
        <span class="s6">'headlabel=&quot;False&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'3 [label=&quot;samples = 2</span><span class="s2">\\</span><span class="s6">nvalue = [[0, 1, 0]</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'[0, 1, 0]]&quot;, fillcolor=&quot;#e58139&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;2 -&gt; 3 ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'4 [label=&quot;samples = 1</span><span class="s2">\\</span><span class="s6">nvalue = [[0.0, 0.5, 0.0]</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'[0.0, 0.0, 0.5]]&quot;, fillcolor=&quot;#e58139&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;2 -&gt; 4 ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">contents1 </span><span class="s3">== </span><span class="s1">contents2</span>

    <span class="s4"># Test regression output with plot_options</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeRegressor</span><span class="s3">(</span>
        <span class="s1">max_depth</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">min_samples_split</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">criterion</span><span class="s3">=</span><span class="s6">&quot;squared_error&quot;</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">2</span>
    <span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span>
        <span class="s1">clf</span><span class="s3">,</span>
        <span class="s1">filled</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">leaves_parallel</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">rotate</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">rounded</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">fontname</span><span class="s3">=</span><span class="s6">&quot;sans&quot;</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, style=&quot;filled, rounded&quot;, color=&quot;black&quot;, '</span>
        <span class="s6">'fontname=&quot;sans&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;graph [ranksep=equally, splines=polyline] ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'edge [fontname=&quot;sans&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;rankdir=LR ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'0 [label=&quot;x[0] &lt;= 0.0</span><span class="s2">\\</span><span class="s6">nsquared_error = 1.0</span><span class="s2">\\</span><span class="s6">nsamples = 6</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'value = 0.0&quot;, fillcolor=&quot;#f2c09c&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'1 [label=&quot;squared_error = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">'</span>
        <span class="s6">'nvalue = -1.0&quot;, '</span>
        <span class="s6">'fillcolor=&quot;#ffffff&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 1 [labeldistance=2.5, labelangle=-45, &quot;</span>
        <span class="s6">'headlabel=&quot;True&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'2 [label=&quot;squared_error = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">nvalue = 1.0&quot;, '</span>
        <span class="s6">'fillcolor=&quot;#e58139&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 2 [labeldistance=2.5, labelangle=45, &quot;</span>
        <span class="s6">'headlabel=&quot;False&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;{rank=same ; 0} ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">&quot;{rank=same ; 1; 2} ;</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">contents1 </span><span class="s3">== </span><span class="s1">contents2</span>

    <span class="s4"># Test classifier with degraded learning set</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">3</span><span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y_degraded</span><span class="s3">)</span>

    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">filled</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, style=&quot;filled&quot;, color=&quot;black&quot;, '</span>
        <span class="s6">'fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'edge [fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'0 [label=&quot;gini = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 6</span><span class="s2">\\</span><span class="s6">nvalue = 6.0&quot;, '</span>
        <span class="s6">'fillcolor=&quot;#ffffff&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s6">&quot;constructor&quot;</span><span class="s3">, [</span><span class="s1">list</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_graphviz_feature_class_names_array_support</span><span class="s3">(</span><span class="s1">constructor</span><span class="s3">):</span>
    <span class="s4"># Check that export_graphviz treats feature names</span>
    <span class="s4"># and class names correctly and supports arrays</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span>
        <span class="s1">max_depth</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">min_samples_split</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">criterion</span><span class="s3">=</span><span class="s6">&quot;gini&quot;</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">2</span>
    <span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s4"># Test with feature_names</span>
    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span>
        <span class="s1">clf</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=</span><span class="s1">constructor</span><span class="s3">([</span><span class="s6">&quot;feature0&quot;</span><span class="s3">, </span><span class="s6">&quot;feature1&quot;</span><span class="s3">]), </span><span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span>
    <span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'edge [fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'0 [label=&quot;feature0 &lt;= 0.0</span><span class="s2">\\</span><span class="s6">ngini = 0.5</span><span class="s2">\\</span><span class="s6">nsamples = 6</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'value = [3, 3]&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'1 [label=&quot;gini = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">nvalue = [3, 0]&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 1 [labeldistance=2.5, labelangle=45, &quot;</span>
        <span class="s6">'headlabel=&quot;True&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'2 [label=&quot;gini = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">nvalue = [0, 3]&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 2 [labeldistance=2.5, labelangle=-45, &quot;</span>
        <span class="s6">'headlabel=&quot;False&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">contents1 </span><span class="s3">== </span><span class="s1">contents2</span>

    <span class="s4"># Test with class_names</span>
    <span class="s1">contents1 </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span>
        <span class="s1">clf</span><span class="s3">, </span><span class="s1">class_names</span><span class="s3">=</span><span class="s1">constructor</span><span class="s3">([</span><span class="s6">&quot;yes&quot;</span><span class="s3">, </span><span class="s6">&quot;no&quot;</span><span class="s3">]), </span><span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span>
    <span class="s3">)</span>
    <span class="s1">contents2 </span><span class="s3">= (</span>
        <span class="s6">&quot;digraph Tree {</span><span class="s2">\n</span><span class="s6">&quot;</span>
        <span class="s6">'node [shape=box, fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'edge [fontname=&quot;helvetica&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'0 [label=&quot;x[0] &lt;= 0.0</span><span class="s2">\\</span><span class="s6">ngini = 0.5</span><span class="s2">\\</span><span class="s6">nsamples = 6</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'value = [3, 3]</span><span class="s2">\\</span><span class="s6">nclass = yes&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'1 [label=&quot;gini = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">nvalue = [3, 0]</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'class = yes&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 1 [labeldistance=2.5, labelangle=45, &quot;</span>
        <span class="s6">'headlabel=&quot;True&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">'2 [label=&quot;gini = 0.0</span><span class="s2">\\</span><span class="s6">nsamples = 3</span><span class="s2">\\</span><span class="s6">nvalue = [0, 3]</span><span class="s2">\\</span><span class="s6">n'</span>
        <span class="s6">'class = no&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;0 -&gt; 2 [labeldistance=2.5, labelangle=-45, &quot;</span>
        <span class="s6">'headlabel=&quot;False&quot;] ;</span><span class="s2">\n</span><span class="s6">'</span>
        <span class="s6">&quot;}&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">contents1 </span><span class="s3">== </span><span class="s1">contents2</span>


<span class="s2">def </span><span class="s1">test_graphviz_errors</span><span class="s3">():</span>
    <span class="s4"># Check for errors of export_graphviz</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">min_samples_split</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)</span>

    <span class="s4"># Check not-fitted decision tree error</span>
    <span class="s1">out </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">()</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">NotFittedError</span><span class="s3">):</span>
        <span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">out</span><span class="s3">)</span>

    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s4"># Check if it errors when length of feature_names</span>
    <span class="s4"># mismatches with number of features</span>
    <span class="s1">message </span><span class="s3">= </span><span class="s6">&quot;Length of feature_names, 1 does not match number of features, 2&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">message</span><span class="s3">):</span>
        <span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=[</span><span class="s6">&quot;a&quot;</span><span class="s3">])</span>

    <span class="s1">message </span><span class="s3">= </span><span class="s6">&quot;Length of feature_names, 3 does not match number of features, 2&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">message</span><span class="s3">):</span>
        <span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=[</span><span class="s6">&quot;a&quot;</span><span class="s3">, </span><span class="s6">&quot;b&quot;</span><span class="s3">, </span><span class="s6">&quot;c&quot;</span><span class="s3">])</span>

    <span class="s4"># Check error when argument is not an estimator</span>
    <span class="s1">message </span><span class="s3">= </span><span class="s6">&quot;is not an estimator instance&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">message</span><span class="s3">):</span>
        <span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">).</span><span class="s1">tree_</span><span class="s3">)</span>

    <span class="s4"># Check class_names error</span>
    <span class="s1">out </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">()</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">IndexError</span><span class="s3">):</span>
        <span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">out</span><span class="s3">, </span><span class="s1">class_names</span><span class="s3">=[])</span>


<span class="s2">def </span><span class="s1">test_friedman_mse_in_graphviz</span><span class="s3">():</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeRegressor</span><span class="s3">(</span><span class="s1">criterion</span><span class="s3">=</span><span class="s6">&quot;friedman_mse&quot;</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
    <span class="s1">dot_data </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">()</span>
    <span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">out_file</span><span class="s3">=</span><span class="s1">dot_data</span><span class="s3">)</span>

    <span class="s1">clf </span><span class="s3">= </span><span class="s1">GradientBoostingClassifier</span><span class="s3">(</span><span class="s1">n_estimators</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
    <span class="s2">for </span><span class="s1">estimator </span><span class="s2">in </span><span class="s1">clf</span><span class="s3">.</span><span class="s1">estimators_</span><span class="s3">:</span>
        <span class="s1">export_graphviz</span><span class="s3">(</span><span class="s1">estimator</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">out_file</span><span class="s3">=</span><span class="s1">dot_data</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">finding </span><span class="s2">in </span><span class="s1">finditer</span><span class="s3">(</span><span class="s6">r&quot;\[.*?samples.*?\]&quot;</span><span class="s3">, </span><span class="s1">dot_data</span><span class="s3">.</span><span class="s1">getvalue</span><span class="s3">()):</span>
        <span class="s2">assert </span><span class="s6">&quot;friedman_mse&quot; </span><span class="s2">in </span><span class="s1">finding</span><span class="s3">.</span><span class="s1">group</span><span class="s3">()</span>


<span class="s2">def </span><span class="s1">test_precision</span><span class="s3">():</span>
    <span class="s1">rng_reg </span><span class="s3">= </span><span class="s1">RandomState</span><span class="s3">(</span><span class="s5">2</span><span class="s3">)</span>
    <span class="s1">rng_clf </span><span class="s3">= </span><span class="s1">RandomState</span><span class="s3">(</span><span class="s5">8</span><span class="s3">)</span>
    <span class="s2">for </span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">clf </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span>
        <span class="s3">(</span><span class="s1">rng_reg</span><span class="s3">.</span><span class="s1">random_sample</span><span class="s3">((</span><span class="s5">5</span><span class="s3">, </span><span class="s5">2</span><span class="s3">)), </span><span class="s1">rng_clf</span><span class="s3">.</span><span class="s1">random_sample</span><span class="s3">((</span><span class="s5">1000</span><span class="s3">, </span><span class="s5">4</span><span class="s3">))),</span>
        <span class="s3">(</span><span class="s1">rng_reg</span><span class="s3">.</span><span class="s1">random_sample</span><span class="s3">((</span><span class="s5">5</span><span class="s3">,)), </span><span class="s1">rng_clf</span><span class="s3">.</span><span class="s1">randint</span><span class="s3">(</span><span class="s5">2</span><span class="s3">, </span><span class="s1">size</span><span class="s3">=(</span><span class="s5">1000</span><span class="s3">,))),</span>
        <span class="s3">(</span>
            <span class="s1">DecisionTreeRegressor</span><span class="s3">(</span>
                <span class="s1">criterion</span><span class="s3">=</span><span class="s6">&quot;friedman_mse&quot;</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">, </span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">1</span>
            <span class="s3">),</span>
            <span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">),</span>
        <span class="s3">),</span>
    <span class="s3">):</span>
        <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">precision </span><span class="s2">in </span><span class="s3">(</span><span class="s5">4</span><span class="s3">, </span><span class="s5">3</span><span class="s3">):</span>
            <span class="s1">dot_data </span><span class="s3">= </span><span class="s1">export_graphviz</span><span class="s3">(</span>
                <span class="s1">clf</span><span class="s3">, </span><span class="s1">out_file</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">precision</span><span class="s3">=</span><span class="s1">precision</span><span class="s3">, </span><span class="s1">proportion</span><span class="s3">=</span><span class="s2">True</span>
            <span class="s3">)</span>

            <span class="s4"># With the current random state, the impurity and the threshold</span>
            <span class="s4"># will have the number of precision set in the export_graphviz</span>
            <span class="s4"># function. We will check the number of precision with a strict</span>
            <span class="s4"># equality. The value reported will have only 2 precision and</span>
            <span class="s4"># therefore, only a less equal comparison will be done.</span>

            <span class="s4"># check value</span>
            <span class="s2">for </span><span class="s1">finding </span><span class="s2">in </span><span class="s1">finditer</span><span class="s3">(</span><span class="s6">r&quot;value = \d+\.\d+&quot;</span><span class="s3">, </span><span class="s1">dot_data</span><span class="s3">):</span>
                <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">search</span><span class="s3">(</span><span class="s6">r&quot;\.\d+&quot;</span><span class="s3">, </span><span class="s1">finding</span><span class="s3">.</span><span class="s1">group</span><span class="s3">()).</span><span class="s1">group</span><span class="s3">()) &lt;= </span><span class="s1">precision </span><span class="s3">+ </span><span class="s5">1</span>
            <span class="s4"># check impurity</span>
            <span class="s2">if </span><span class="s1">is_classifier</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">):</span>
                <span class="s1">pattern </span><span class="s3">= </span><span class="s6">r&quot;gini = \d+\.\d+&quot;</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">pattern </span><span class="s3">= </span><span class="s6">r&quot;friedman_mse = \d+\.\d+&quot;</span>

            <span class="s4"># check impurity</span>
            <span class="s2">for </span><span class="s1">finding </span><span class="s2">in </span><span class="s1">finditer</span><span class="s3">(</span><span class="s1">pattern</span><span class="s3">, </span><span class="s1">dot_data</span><span class="s3">):</span>
                <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">search</span><span class="s3">(</span><span class="s6">r&quot;\.\d+&quot;</span><span class="s3">, </span><span class="s1">finding</span><span class="s3">.</span><span class="s1">group</span><span class="s3">()).</span><span class="s1">group</span><span class="s3">()) == </span><span class="s1">precision </span><span class="s3">+ </span><span class="s5">1</span>
            <span class="s4"># check threshold</span>
            <span class="s2">for </span><span class="s1">finding </span><span class="s2">in </span><span class="s1">finditer</span><span class="s3">(</span><span class="s6">r&quot;&lt;= \d+\.\d+&quot;</span><span class="s3">, </span><span class="s1">dot_data</span><span class="s3">):</span>
                <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">search</span><span class="s3">(</span><span class="s6">r&quot;\.\d+&quot;</span><span class="s3">, </span><span class="s1">finding</span><span class="s3">.</span><span class="s1">group</span><span class="s3">()).</span><span class="s1">group</span><span class="s3">()) == </span><span class="s1">precision </span><span class="s3">+ </span><span class="s5">1</span>


<span class="s2">def </span><span class="s1">test_export_text_errors</span><span class="s3">():</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
    <span class="s1">err_msg </span><span class="s3">= </span><span class="s6">&quot;feature_names must contain 2 elements, got 1&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">err_msg</span><span class="s3">):</span>
        <span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=[</span><span class="s6">&quot;a&quot;</span><span class="s3">])</span>
    <span class="s1">err_msg </span><span class="s3">= (</span>
        <span class="s6">&quot;When `class_names` is an array, it should contain as&quot;</span>
        <span class="s6">&quot; many items as `decision_tree.classes_`. Got 1 while&quot;</span>
        <span class="s6">&quot; the tree was fitted with 2 classes.&quot;</span>
    <span class="s3">)</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">err_msg</span><span class="s3">):</span>
        <span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">class_names</span><span class="s3">=[</span><span class="s6">&quot;a&quot;</span><span class="s3">])</span>


<span class="s2">def </span><span class="s1">test_export_text</span><span class="s3">():</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s1">expected_report </span><span class="s3">= </span><span class="s1">dedent</span><span class="s3">(</span>
        <span class="s6">&quot;&quot;&quot; 
    |--- feature_1 &lt;= 0.00 
    |   |--- class: -1 
    |--- feature_1 &gt;  0.00 
    |   |--- class: 1 
    &quot;&quot;&quot;</span>
    <span class="s3">).</span><span class="s1">lstrip</span><span class="s3">()</span>

    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">) == </span><span class="s1">expected_report</span>
    <span class="s4"># testing that leaves at level 1 are not truncated</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">0</span><span class="s3">) == </span><span class="s1">expected_report</span>
    <span class="s4"># testing that the rest of the tree is truncated</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">10</span><span class="s3">) == </span><span class="s1">expected_report</span>

    <span class="s1">expected_report </span><span class="s3">= </span><span class="s1">dedent</span><span class="s3">(</span>
        <span class="s6">&quot;&quot;&quot; 
    |--- feature_1 &lt;= 0.00 
    |   |--- weights: [3.00, 0.00] class: -1 
    |--- feature_1 &gt;  0.00 
    |   |--- weights: [0.00, 3.00] class: 1 
    &quot;&quot;&quot;</span>
    <span class="s3">).</span><span class="s1">lstrip</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">show_weights</span><span class="s3">=</span><span class="s2">True</span><span class="s3">) == </span><span class="s1">expected_report</span>

    <span class="s1">expected_report </span><span class="s3">= </span><span class="s1">dedent</span><span class="s3">(</span>
        <span class="s6">&quot;&quot;&quot; 
    |- feature_1 &lt;= 0.00 
    | |- class: -1 
    |- feature_1 &gt;  0.00 
    | |- class: 1 
    &quot;&quot;&quot;</span>
    <span class="s3">).</span><span class="s1">lstrip</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">spacing</span><span class="s3">=</span><span class="s5">1</span><span class="s3">) == </span><span class="s1">expected_report</span>

    <span class="s1">X_l </span><span class="s3">= [[-</span><span class="s5">2</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">2</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], [</span><span class="s5">2</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">]]</span>
    <span class="s1">y_l </span><span class="s3">= [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">]</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">4</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X_l</span><span class="s3">, </span><span class="s1">y_l</span><span class="s3">)</span>
    <span class="s1">expected_report </span><span class="s3">= </span><span class="s1">dedent</span><span class="s3">(</span>
        <span class="s6">&quot;&quot;&quot; 
    |--- feature_1 &lt;= 0.00 
    |   |--- class: -1 
    |--- feature_1 &gt;  0.00 
    |   |--- truncated branch of depth 2 
    &quot;&quot;&quot;</span>
    <span class="s3">).</span><span class="s1">lstrip</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">0</span><span class="s3">) == </span><span class="s1">expected_report</span>

    <span class="s1">X_mo </span><span class="s3">= [[-</span><span class="s5">2</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">2</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], [</span><span class="s5">2</span><span class="s3">, </span><span class="s5">1</span><span class="s3">]]</span>
    <span class="s1">y_mo </span><span class="s3">= [[-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">]]</span>

    <span class="s1">reg </span><span class="s3">= </span><span class="s1">DecisionTreeRegressor</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
    <span class="s1">reg</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X_mo</span><span class="s3">, </span><span class="s1">y_mo</span><span class="s3">)</span>

    <span class="s1">expected_report </span><span class="s3">= </span><span class="s1">dedent</span><span class="s3">(</span>
        <span class="s6">&quot;&quot;&quot; 
    |--- feature_1 &lt;= 0.0 
    |   |--- value: [-1.0, -1.0] 
    |--- feature_1 &gt;  0.0 
    |   |--- value: [1.0, 1.0] 
    &quot;&quot;&quot;</span>
    <span class="s3">).</span><span class="s1">lstrip</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">reg</span><span class="s3">, </span><span class="s1">decimals</span><span class="s3">=</span><span class="s5">1</span><span class="s3">) == </span><span class="s1">expected_report</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">reg</span><span class="s3">, </span><span class="s1">decimals</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">show_weights</span><span class="s3">=</span><span class="s2">True</span><span class="s3">) == </span><span class="s1">expected_report</span>

    <span class="s1">X_single </span><span class="s3">= [[-</span><span class="s5">2</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">], [</span><span class="s5">2</span><span class="s3">]]</span>
    <span class="s1">reg </span><span class="s3">= </span><span class="s1">DecisionTreeRegressor</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
    <span class="s1">reg</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X_single</span><span class="s3">, </span><span class="s1">y_mo</span><span class="s3">)</span>

    <span class="s1">expected_report </span><span class="s3">= </span><span class="s1">dedent</span><span class="s3">(</span>
        <span class="s6">&quot;&quot;&quot; 
    |--- first &lt;= 0.0 
    |   |--- value: [-1.0, -1.0] 
    |--- first &gt;  0.0 
    |   |--- value: [1.0, 1.0] 
    &quot;&quot;&quot;</span>
    <span class="s3">).</span><span class="s1">lstrip</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">reg</span><span class="s3">, </span><span class="s1">decimals</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=[</span><span class="s6">&quot;first&quot;</span><span class="s3">]) == </span><span class="s1">expected_report</span>
    <span class="s2">assert </span><span class="s3">(</span>
        <span class="s1">export_text</span><span class="s3">(</span><span class="s1">reg</span><span class="s3">, </span><span class="s1">decimals</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">show_weights</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=[</span><span class="s6">&quot;first&quot;</span><span class="s3">])</span>
        <span class="s3">== </span><span class="s1">expected_report</span>
    <span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s6">&quot;constructor&quot;</span><span class="s3">, [</span><span class="s1">list</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_export_text_feature_class_names_array_support</span><span class="s3">(</span><span class="s1">constructor</span><span class="s3">):</span>
    <span class="s4"># Check that export_graphviz treats feature names</span>
    <span class="s4"># and class names correctly and supports arrays</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span><span class="s1">max_depth</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s1">expected_report </span><span class="s3">= </span><span class="s1">dedent</span><span class="s3">(</span>
        <span class="s6">&quot;&quot;&quot; 
    |--- b &lt;= 0.00 
    |   |--- class: -1 
    |--- b &gt;  0.00 
    |   |--- class: 1 
    &quot;&quot;&quot;</span>
    <span class="s3">).</span><span class="s1">lstrip</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=</span><span class="s1">constructor</span><span class="s3">([</span><span class="s6">&quot;a&quot;</span><span class="s3">, </span><span class="s6">&quot;b&quot;</span><span class="s3">])) == </span><span class="s1">expected_report</span>

    <span class="s1">expected_report </span><span class="s3">= </span><span class="s1">dedent</span><span class="s3">(</span>
        <span class="s6">&quot;&quot;&quot; 
    |--- feature_1 &lt;= 0.00 
    |   |--- class: cat 
    |--- feature_1 &gt;  0.00 
    |   |--- class: dog 
    &quot;&quot;&quot;</span>
    <span class="s3">).</span><span class="s1">lstrip</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">export_text</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">class_names</span><span class="s3">=</span><span class="s1">constructor</span><span class="s3">([</span><span class="s6">&quot;cat&quot;</span><span class="s3">, </span><span class="s6">&quot;dog&quot;</span><span class="s3">])) == </span><span class="s1">expected_report</span>


<span class="s2">def </span><span class="s1">test_plot_tree_entropy</span><span class="s3">(</span><span class="s1">pyplot</span><span class="s3">):</span>
    <span class="s4"># mostly smoke tests</span>
    <span class="s4"># Check correctness of export_graphviz for criterion = entropy</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span>
        <span class="s1">max_depth</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">min_samples_split</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">criterion</span><span class="s3">=</span><span class="s6">&quot;entropy&quot;</span><span class="s3">, </span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">2</span>
    <span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s4"># Test export code</span>
    <span class="s1">feature_names </span><span class="s3">= [</span><span class="s6">&quot;first feat&quot;</span><span class="s3">, </span><span class="s6">&quot;sepal_width&quot;</span><span class="s3">]</span>
    <span class="s1">nodes </span><span class="s3">= </span><span class="s1">plot_tree</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=</span><span class="s1">feature_names</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">nodes</span><span class="s3">) == </span><span class="s5">5</span>
    <span class="s2">assert </span><span class="s3">(</span>
        <span class="s1">nodes</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">()</span>
        <span class="s3">== </span><span class="s6">&quot;first feat &lt;= 0.0</span><span class="s2">\n</span><span class="s6">entropy = 1.0</span><span class="s2">\n</span><span class="s6">samples = 6</span><span class="s2">\n</span><span class="s6">value = [3, 3]&quot;</span>
    <span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">nodes</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">() == </span><span class="s6">&quot;entropy = 0.0</span><span class="s2">\n</span><span class="s6">samples = 3</span><span class="s2">\n</span><span class="s6">value = [3, 0]&quot;</span>
    <span class="s2">assert </span><span class="s1">nodes</span><span class="s3">[</span><span class="s5">2</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">() == </span><span class="s6">&quot;True  &quot;</span>
    <span class="s2">assert </span><span class="s1">nodes</span><span class="s3">[</span><span class="s5">3</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">() == </span><span class="s6">&quot;entropy = 0.0</span><span class="s2">\n</span><span class="s6">samples = 3</span><span class="s2">\n</span><span class="s6">value = [0, 3]&quot;</span>
    <span class="s2">assert </span><span class="s1">nodes</span><span class="s3">[</span><span class="s5">4</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">() == </span><span class="s6">&quot;  False&quot;</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s6">&quot;fontsize&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s5">10</span><span class="s3">, </span><span class="s5">20</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_plot_tree_gini</span><span class="s3">(</span><span class="s1">pyplot</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">):</span>
    <span class="s4"># mostly smoke tests</span>
    <span class="s4"># Check correctness of export_graphviz for criterion = gini</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeClassifier</span><span class="s3">(</span>
        <span class="s1">max_depth</span><span class="s3">=</span><span class="s5">3</span><span class="s3">,</span>
        <span class="s1">min_samples_split</span><span class="s3">=</span><span class="s5">2</span><span class="s3">,</span>
        <span class="s1">criterion</span><span class="s3">=</span><span class="s6">&quot;gini&quot;</span><span class="s3">,</span>
        <span class="s1">random_state</span><span class="s3">=</span><span class="s5">2</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s1">clf</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s4"># Test export code</span>
    <span class="s1">feature_names </span><span class="s3">= [</span><span class="s6">&quot;first feat&quot;</span><span class="s3">, </span><span class="s6">&quot;sepal_width&quot;</span><span class="s3">]</span>
    <span class="s1">nodes </span><span class="s3">= </span><span class="s1">plot_tree</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">, </span><span class="s1">feature_names</span><span class="s3">=</span><span class="s1">feature_names</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">=</span><span class="s1">fontsize</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">nodes</span><span class="s3">) == </span><span class="s5">5</span>
    <span class="s2">if </span><span class="s1">fontsize </span><span class="s2">is not None</span><span class="s3">:</span>
        <span class="s2">assert </span><span class="s1">all</span><span class="s3">(</span><span class="s1">node</span><span class="s3">.</span><span class="s1">get_fontsize</span><span class="s3">() == </span><span class="s1">fontsize </span><span class="s2">for </span><span class="s1">node </span><span class="s2">in </span><span class="s1">nodes</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s3">(</span>
        <span class="s1">nodes</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">()</span>
        <span class="s3">== </span><span class="s6">&quot;first feat &lt;= 0.0</span><span class="s2">\n</span><span class="s6">gini = 0.5</span><span class="s2">\n</span><span class="s6">samples = 6</span><span class="s2">\n</span><span class="s6">value = [3, 3]&quot;</span>
    <span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">nodes</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">() == </span><span class="s6">&quot;gini = 0.0</span><span class="s2">\n</span><span class="s6">samples = 3</span><span class="s2">\n</span><span class="s6">value = [3, 0]&quot;</span>
    <span class="s2">assert </span><span class="s1">nodes</span><span class="s3">[</span><span class="s5">2</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">() == </span><span class="s6">&quot;True  &quot;</span>
    <span class="s2">assert </span><span class="s1">nodes</span><span class="s3">[</span><span class="s5">3</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">() == </span><span class="s6">&quot;gini = 0.0</span><span class="s2">\n</span><span class="s6">samples = 3</span><span class="s2">\n</span><span class="s6">value = [0, 3]&quot;</span>
    <span class="s2">assert </span><span class="s1">nodes</span><span class="s3">[</span><span class="s5">4</span><span class="s3">].</span><span class="s1">get_text</span><span class="s3">() == </span><span class="s6">&quot;  False&quot;</span>


<span class="s2">def </span><span class="s1">test_not_fitted_tree</span><span class="s3">(</span><span class="s1">pyplot</span><span class="s3">):</span>
    <span class="s4"># Testing if not fitted tree throws the correct error</span>
    <span class="s1">clf </span><span class="s3">= </span><span class="s1">DecisionTreeRegressor</span><span class="s3">()</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">NotFittedError</span><span class="s3">):</span>
        <span class="s1">plot_tree</span><span class="s3">(</span><span class="s1">clf</span><span class="s3">)</span>
</pre>
</body>
</html>