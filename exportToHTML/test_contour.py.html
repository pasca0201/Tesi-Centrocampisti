<html>
<head>
<title>test_contour.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_contour.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">platform</span>
<span class="s0">import </span><span class="s1">re</span>
<span class="s0">from </span><span class="s1">unittest </span><span class="s0">import </span><span class="s1">mock</span>

<span class="s0">import </span><span class="s1">contourpy</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">, </span><span class="s1">assert_array_almost_equal_nulp</span><span class="s2">, </span><span class="s1">assert_array_equal</span><span class="s2">)</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span><span class="s2">, </span><span class="s1">rc_context</span><span class="s2">, </span><span class="s1">ticker</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors </span><span class="s0">import </span><span class="s1">LogNorm</span><span class="s2">, </span><span class="s1">same_color</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s2">, </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">pytest</span>


<span class="s3"># Helper to test the transition from ContourSets holding multiple Collections to being a</span>
<span class="s3"># single Collection; remove once the deprecated old layout expires.</span>
<span class="s0">def </span><span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">do_split</span><span class="s2">):</span>
    <span class="s0">if not </span><span class="s1">do_split</span><span class="s2">:</span>
        <span class="s0">return</span>
    <span class="s0">for </span><span class="s1">fig </span><span class="s0">in </span><span class="s1">map</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">, </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">get_fignums</span><span class="s2">()):</span>
        <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">coll </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">collections</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">.</span><span class="s1">ContourSet</span><span class="s2">):</span>
                    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">_api</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
                        <span class="s1">coll</span><span class="s2">.</span><span class="s1">collections</span>


<span class="s0">def </span><span class="s1">test_contour_shape_1d_valid</span><span class="s2">():</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">9</span><span class="s2">)</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_contour_shape_2d_valid</span><span class="s2">():</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">9</span><span class="s2">)</span>
    <span class="s1">xg</span><span class="s2">, </span><span class="s1">yg </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">xg</span><span class="s2">, </span><span class="s1">yg</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;args, message&quot;</span><span class="s2">, [</span>
    <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">9</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">9</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))),</span>
     <span class="s5">'Length of x (9) must match number of columns in z (10)'</span><span class="s2">),</span>
    <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))),</span>
     <span class="s5">'Length of y (10) must match number of rows in z (9)'</span><span class="s2">),</span>
    <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))),</span>
     <span class="s5">'Number of dimensions of x (2) and y (1) do not match'</span><span class="s2">),</span>
    <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))),</span>
     <span class="s5">'Number of dimensions of x (1) and y (2) do not match'</span><span class="s2">),</span>
    <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))),</span>
     <span class="s5">'Shapes of x (9, 9) and z (9, 10) do not match'</span><span class="s2">),</span>
    <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))),</span>
     <span class="s5">'Shapes of y (9, 9) and z (9, 10) do not match'</span><span class="s2">),</span>
    <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))),</span>
     <span class="s5">'Inputs x and y must be 1D or 2D, not 3D'</span><span class="s2">),</span>
    <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))),</span>
     <span class="s5">'Input z must be 2D, not 3D'</span><span class="s2">),</span>
    <span class="s2">(([[</span><span class="s4">0</span><span class="s2">]],),  </span><span class="s3"># github issue 8197</span>
     <span class="s5">'Input z must be at least a (2, 2) shaped array, but has shape (1, 1)'</span><span class="s2">),</span>
    <span class="s2">(([</span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">], [[</span><span class="s4">0</span><span class="s2">]]),</span>
     <span class="s5">'Input z must be at least a (2, 2) shaped array, but has shape (1, 1)'</span><span class="s2">),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_contour_shape_error</span><span class="s2">(</span><span class="s1">args</span><span class="s2">, </span><span class="s1">message</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">re</span><span class="s2">.</span><span class="s1">escape</span><span class="s2">(</span><span class="s1">message</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_contour_no_valid_levels</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># no warning for empty levels.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">9</span><span class="s2">, </span><span class="s4">9</span><span class="s2">), </span><span class="s1">levels</span><span class="s2">=[])</span>
    <span class="s3"># no warning if levels is given and is not within the range of z.</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">81</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)), </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">100</span><span class="s2">])</span>
    <span class="s3"># ... and if fmt is given.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">={</span><span class="s4">100</span><span class="s2">: </span><span class="s5">'%1.2f'</span><span class="s2">})</span>
    <span class="s3"># no warning if z is uniform.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s4">9</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)))</span>


<span class="s0">def </span><span class="s1">test_contour_Nlevels</span><span class="s2">():</span>
    <span class="s3"># A scalar levels arg or kwarg should trigger auto level generation.</span>
    <span class="s3"># https://github.com/matplotlib/matplotlib/issues/11913</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">12</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">cs1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">cs1</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">) &gt; </span><span class="s4">1</span>
    <span class="s1">cs2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s4">5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">cs1</span><span class="s2">.</span><span class="s1">levels </span><span class="s2">== </span><span class="s1">cs2</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">).</span><span class="s1">all</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_contour_set_paths</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">cs_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">contour</span><span class="s2">([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]])</span>
    <span class="s1">cs_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">contour</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]])</span>

    <span class="s1">cs_test</span><span class="s2">.</span><span class="s1">set_paths</span><span class="s2">(</span><span class="s1">cs_ref</span><span class="s2">.</span><span class="s1">get_paths</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_manual_labels'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s4">0.26</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_manual_labels</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dstack</span><span class="s2">([</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)]), </span><span class="s4">2</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">200</span><span class="s2">)</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>

    <span class="s1">pts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([(</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">), (</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">4.4</span><span class="s2">), (</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">6.0</span><span class="s2">)])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">, </span><span class="s1">manual</span><span class="s2">=</span><span class="s1">pts</span><span class="s2">)</span>
    <span class="s1">pts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([(</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">), (</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">4.4</span><span class="s2">), (</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">6.0</span><span class="s2">)])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">, </span><span class="s1">manual</span><span class="s2">=</span><span class="s1">pts</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s5">'small'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=(</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_contour_manual_moveto</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>

    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">Z </span><span class="s2">= </span><span class="s1">X</span><span class="s2">**</span><span class="s4">2 </span><span class="s2">* </span><span class="s4">1 </span><span class="s2">/ </span><span class="s1">Y</span><span class="s2">**</span><span class="s4">2 </span><span class="s2">- </span><span class="s4">1</span>

    <span class="s1">contours </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">100</span><span class="s2">])</span>

    <span class="s3"># This point lies on the `MOVETO` line for the 100 contour</span>
    <span class="s3"># but is actually closest to the 0 contour</span>
    <span class="s1">point </span><span class="s2">= (</span><span class="s4">1.3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">clabels </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">contours</span><span class="s2">, </span><span class="s1">manual</span><span class="s2">=[</span><span class="s1">point</span><span class="s2">])</span>

    <span class="s3"># Ensure that the 0 contour was chosen, not the 100 contour</span>
    <span class="s0">assert </span><span class="s1">clabels</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">&quot;0&quot;</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_disconnected_segments'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">, </span><span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_contour_label_with_disconnected_segments</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mgrid</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">:</span><span class="s4">1</span><span class="s2">:</span><span class="s4">21j</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">:</span><span class="s4">1</span><span class="s2">:</span><span class="s4">21j</span><span class="s2">]</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s4">1 </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">0.01 </span><span class="s2">+ (</span><span class="s1">x </span><span class="s2">+ </span><span class="s4">0.3</span><span class="s2">) ** </span><span class="s4">2 </span><span class="s2">+ </span><span class="s1">y </span><span class="s2">** </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">z </span><span class="s2">+= </span><span class="s4">1 </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">0.01 </span><span class="s2">+ (</span><span class="s1">x </span><span class="s2">- </span><span class="s4">0.3</span><span class="s2">) ** </span><span class="s4">2 </span><span class="s2">+ </span><span class="s1">y </span><span class="s2">** </span><span class="s4">2</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">7</span><span class="s2">])</span>

    <span class="s3"># Adding labels should invalidate the old style</span>
    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>

    <span class="s1">cs</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">manual</span><span class="s2">=[(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">)])</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_manual_colors_and_levels.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">0.018 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'arm64' </span><span class="s0">else </span><span class="s4">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_given_colors_levels_and_extends</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">_</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)</span>

    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">12</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)</span>

    <span class="s1">colors </span><span class="s2">= [</span><span class="s5">'red'</span><span class="s2">, </span><span class="s5">'yellow'</span><span class="s2">, </span><span class="s5">'pink'</span><span class="s2">, </span><span class="s5">'blue'</span><span class="s2">, </span><span class="s5">'black'</span><span class="s2">]</span>
    <span class="s1">levels </span><span class="s2">= [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">10</span><span class="s2">]</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">):</span>
        <span class="s1">filled </span><span class="s2">= </span><span class="s1">i </span><span class="s2">% </span><span class="s4">2 </span><span class="s2">== </span><span class="s4">0.</span>
        <span class="s1">extend </span><span class="s2">= [</span><span class="s5">'neither'</span><span class="s2">, </span><span class="s5">'min'</span><span class="s2">, </span><span class="s5">'max'</span><span class="s2">, </span><span class="s5">'both'</span><span class="s2">][</span><span class="s1">i </span><span class="s2">// </span><span class="s4">2</span><span class="s2">]</span>

        <span class="s0">if </span><span class="s1">filled</span><span class="s2">:</span>
            <span class="s3"># If filled, we have 3 colors with no extension,</span>
            <span class="s3"># 4 colors with one extension, and 5 colors with both extensions</span>
            <span class="s1">first_color </span><span class="s2">= </span><span class="s4">1 </span><span class="s0">if </span><span class="s1">extend </span><span class="s0">in </span><span class="s2">[</span><span class="s5">'max'</span><span class="s2">, </span><span class="s5">'neither'</span><span class="s2">] </span><span class="s0">else None</span>
            <span class="s1">last_color </span><span class="s2">= -</span><span class="s4">1 </span><span class="s0">if </span><span class="s1">extend </span><span class="s0">in </span><span class="s2">[</span><span class="s5">'min'</span><span class="s2">, </span><span class="s5">'neither'</span><span class="s2">] </span><span class="s0">else None</span>
            <span class="s1">c </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">[</span><span class="s1">first_color</span><span class="s2">:</span><span class="s1">last_color</span><span class="s2">],</span>
                            <span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s1">extend</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s3"># If not filled, we have 4 levels and 4 colors</span>
            <span class="s1">c </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">[:-</span><span class="s4">1</span><span class="s2">],</span>
                           <span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s1">extend</span><span class="s2">)</span>

        <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_log_locator.svg'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_log_locator_levels</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">N </span><span class="s2">= </span><span class="s4">100</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s1">N</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">N</span><span class="s2">)</span>

    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">Z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">X</span><span class="s2">**</span><span class="s4">2 </span><span class="s2">- </span><span class="s1">Y</span><span class="s2">**</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">Z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-(</span><span class="s1">X </span><span class="s2">* </span><span class="s4">10</span><span class="s2">)**</span><span class="s4">2 </span><span class="s2">- (</span><span class="s1">Y </span><span class="s2">* </span><span class="s4">10</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">Z1 </span><span class="s2">+ </span><span class="s4">50 </span><span class="s2">* </span><span class="s1">Z2</span>

    <span class="s1">c </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">locator</span><span class="s2">=</span><span class="s1">ticker</span><span class="s2">.</span><span class="s1">LogLocator</span><span class="s2">())</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">c</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">power</span><span class="s2">(</span><span class="s4">10.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">6</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)))</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticks</span><span class="s2">(), </span><span class="s1">c</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_datetime_axis.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_datetime_axis</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">hspace</span><span class="s2">=</span><span class="s4">0.4</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s4">0.98</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s4">.15</span><span class="s2">)</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2013</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">base </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s1">d</span><span class="s2">) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">20</span><span class="s2">)])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">z1</span><span class="s2">, </span><span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">20</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">20</span><span class="s2">))</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">z1 </span><span class="s2">* </span><span class="s1">z2</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">221</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">222</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">], </span><span class="s4">20</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[:, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">], </span><span class="s4">20</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">223</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">224</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">get_axes</span><span class="s2">():</span>
        <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">():</span>
            <span class="s1">label</span><span class="s2">.</span><span class="s1">set_ha</span><span class="s2">(</span><span class="s5">'right'</span><span class="s2">)</span>
            <span class="s1">label</span><span class="s2">.</span><span class="s1">set_rotation</span><span class="s2">(</span><span class="s4">30</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_test_label_transforms.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s4">1.1</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_labels</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s3"># Adapted from pylab_examples example code: contour_demo.py</span>
    <span class="s3"># see issues #2475, #2843, and #2818 for explanation</span>
    <span class="s1">delta </span><span class="s2">= </span><span class="s4">0.025</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-(</span><span class="s1">X</span><span class="s2">**</span><span class="s4">2 </span><span class="s2">+ </span><span class="s1">Y</span><span class="s2">**</span><span class="s4">2</span><span class="s2">) / </span><span class="s4">2</span><span class="s2">) / (</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">)</span>
    <span class="s1">Z2 </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-(((</span><span class="s1">X </span><span class="s2">- </span><span class="s4">1</span><span class="s2">) / </span><span class="s4">1.5</span><span class="s2">)**</span><span class="s4">2 </span><span class="s2">+ ((</span><span class="s1">Y </span><span class="s2">- </span><span class="s4">1</span><span class="s2">) / </span><span class="s4">0.5</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">) / </span><span class="s4">2</span><span class="s2">) /</span>
          <span class="s2">(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s4">0.5 </span><span class="s2">* </span><span class="s4">1.5</span><span class="s2">))</span>

    <span class="s3"># difference of Gaussians</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s4">10.0 </span><span class="s2">* (</span><span class="s1">Z2 </span><span class="s2">- </span><span class="s1">Z1</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">CS </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">)</span>
    <span class="s1">disp_units </span><span class="s2">= [(</span><span class="s4">216</span><span class="s2">, </span><span class="s4">177</span><span class="s2">), (</span><span class="s4">359</span><span class="s2">, </span><span class="s4">290</span><span class="s2">), (</span><span class="s4">521</span><span class="s2">, </span><span class="s4">406</span><span class="s2">)]</span>
    <span class="s1">data_units </span><span class="s2">= [(-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1.5</span><span class="s2">), (</span><span class="s4">2.8</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]</span>

    <span class="s3"># Adding labels should invalidate the old style</span>
    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>

    <span class="s1">CS</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">()</span>

    <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">data_units</span><span class="s2">:</span>
        <span class="s1">CS</span><span class="s2">.</span><span class="s1">add_label_near</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s0">in </span><span class="s1">disp_units</span><span class="s2">:</span>
        <span class="s1">CS</span><span class="s2">.</span><span class="s1">add_label_near</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_label_contour_start</span><span class="s2">():</span>
    <span class="s3"># Set up data and figure/axes that result in automatic labelling adding the</span>
    <span class="s3"># label to the start of a contour</span>

    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">lats </span><span class="s2">= </span><span class="s1">lons </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">, </span><span class="s4">50</span><span class="s2">)</span>
    <span class="s1">lons</span><span class="s2">, </span><span class="s1">lats </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">lons</span><span class="s2">, </span><span class="s1">lats</span><span class="s2">)</span>
    <span class="s1">wave </span><span class="s2">= </span><span class="s4">0.75 </span><span class="s2">* (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">lats</span><span class="s2">) ** </span><span class="s4">8</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s4">4 </span><span class="s2">* </span><span class="s1">lons</span><span class="s2">)</span>
    <span class="s1">mean </span><span class="s2">= </span><span class="s4">0.5 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">lats</span><span class="s2">) * ((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">lats</span><span class="s2">)) ** </span><span class="s4">2 </span><span class="s2">+ </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">wave </span><span class="s2">+ </span><span class="s1">mean</span>

    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">lons</span><span class="s2">, </span><span class="s1">lats</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">.</span><span class="s1">object</span><span class="s2">(</span>
            <span class="s1">cs</span><span class="s2">, </span><span class="s5">'_split_path_and_get_label_rotation'</span><span class="s2">,</span>
            <span class="s1">wraps</span><span class="s2">=</span><span class="s1">cs</span><span class="s2">.</span><span class="s1">_split_path_and_get_label_rotation</span><span class="s2">) </span><span class="s0">as </span><span class="s1">mocked_splitter</span><span class="s2">:</span>
        <span class="s3"># Smoke test that we can add the labels</span>
        <span class="s1">cs</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">9</span><span class="s2">)</span>

    <span class="s3"># Verify at least one label was added to the start of a contour.  I.e. the</span>
    <span class="s3"># splitting method was called with idx=0 at least once.</span>
    <span class="s1">idxs </span><span class="s2">= [</span><span class="s1">cargs</span><span class="s2">[</span><span class="s4">0</span><span class="s2">][</span><span class="s4">1</span><span class="s2">] </span><span class="s0">for </span><span class="s1">cargs </span><span class="s0">in </span><span class="s1">mocked_splitter</span><span class="s2">.</span><span class="s1">call_args_list</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s4">0 </span><span class="s0">in </span><span class="s1">idxs</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_corner_mask_False.png'</span><span class="s2">, </span><span class="s5">'contour_corner_mask_True.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s4">1.88</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_corner_mask</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s4">60</span>
    <span class="s1">mask_level </span><span class="s2">= </span><span class="s4">0.95</span>
    <span class="s1">noise_amp </span><span class="s2">= </span><span class="s4">1.0</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">([</span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">))</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s4">7</span><span class="s2">*</span><span class="s1">x</span><span class="s2">)*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s4">8</span><span class="s2">*</span><span class="s1">y</span><span class="s2">) + </span><span class="s1">noise_amp</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
    <span class="s1">mask </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">n</span><span class="s2">) &gt;= </span><span class="s1">mask_level</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">mask</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">corner_mask </span><span class="s0">in </span><span class="s2">[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]:</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">corner_mask</span><span class="s2">=</span><span class="s1">corner_mask</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_contourf_decreasing_levels</span><span class="s2">():</span>
    <span class="s3"># github issue 5477.</span>
    <span class="s1">z </span><span class="s2">= [[</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">]]</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_contourf_symmetric_locator</span><span class="s2">():</span>
    <span class="s3"># github issue 7271</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">12</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">))</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">MaxNLocator</span><span class="s2">(</span><span class="s1">nbins</span><span class="s2">=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">symmetric</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">locator</span><span class="s2">=</span><span class="s1">locator</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">12</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">5</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_circular_contour_warning</span><span class="s2">():</span>
    <span class="s3"># Check that almost circular contours don't throw a warning</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">))</span>
    <span class="s1">r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hypot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;use_clabeltext, contour_zorder, clabel_zorder&quot;</span><span class="s2">,</span>
                         <span class="s2">[(</span><span class="s0">True</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s4">1234</span><span class="s2">), (</span><span class="s0">False</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s4">1234</span><span class="s2">),</span>
                          <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s0">None</span><span class="s2">), (</span><span class="s0">False</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_clabel_zorder</span><span class="s2">(</span><span class="s1">use_clabeltext</span><span class="s2">, </span><span class="s1">contour_zorder</span><span class="s2">, </span><span class="s1">clabel_zorder</span><span class="s2">):</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dstack</span><span class="s2">([</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)]), </span><span class="s4">2</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s1">contour_zorder</span><span class="s2">)</span>
    <span class="s1">cs_filled </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s1">contour_zorder</span><span class="s2">)</span>
    <span class="s1">clabels1 </span><span class="s2">= </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">zorder</span><span class="s2">=</span><span class="s1">clabel_zorder</span><span class="s2">, </span><span class="s1">use_clabeltext</span><span class="s2">=</span><span class="s1">use_clabeltext</span><span class="s2">)</span>
    <span class="s1">clabels2 </span><span class="s2">= </span><span class="s1">cs_filled</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">zorder</span><span class="s2">=</span><span class="s1">clabel_zorder</span><span class="s2">,</span>
                                <span class="s1">use_clabeltext</span><span class="s2">=</span><span class="s1">use_clabeltext</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">clabel_zorder </span><span class="s0">is None</span><span class="s2">:</span>
        <span class="s1">expected_clabel_zorder </span><span class="s2">= </span><span class="s4">2</span><span class="s2">+</span><span class="s1">contour_zorder</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">expected_clabel_zorder </span><span class="s2">= </span><span class="s1">clabel_zorder</span>

    <span class="s0">for </span><span class="s1">clabel </span><span class="s0">in </span><span class="s1">clabels1</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">clabel</span><span class="s2">.</span><span class="s1">get_zorder</span><span class="s2">() == </span><span class="s1">expected_clabel_zorder</span>
    <span class="s0">for </span><span class="s1">clabel </span><span class="s0">in </span><span class="s1">clabels2</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">clabel</span><span class="s2">.</span><span class="s1">get_zorder</span><span class="s2">() == </span><span class="s1">expected_clabel_zorder</span>


<span class="s0">def </span><span class="s1">test_clabel_with_large_spacing</span><span class="s2">():</span>
    <span class="s3"># When the inline spacing is large relative to the contour, it may cause the</span>
    <span class="s3"># entire contour to be removed. In current implementation, one line segment is</span>
    <span class="s3"># retained between the identified points.</span>
    <span class="s3"># This behavior may be worth reconsidering, but check to be sure we do not produce</span>
    <span class="s3"># an invalid path, which results in an error at clabel call time.</span>
    <span class="s3"># see gh-27045 for more information</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">3.01</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">X</span><span class="s2">**</span><span class="s4">2 </span><span class="s2">- </span><span class="s1">Y</span><span class="s2">**</span><span class="s4">2</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">contourset </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">0.01</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.8</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">contourset</span><span class="s2">, </span><span class="s1">inline_spacing</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>


<span class="s3"># tol because ticks happen to fall on pixel boundaries so small</span>
<span class="s3"># floating point changes in tick location flip which pixel gets</span>
<span class="s3"># the tick.</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'contour_log_extension.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">1.444</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contourf_log_extension</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s3"># Test that contourf with lognorm is extended correctly</span>
    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">5</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s4">0.05</span><span class="s2">, </span><span class="s1">right</span><span class="s2">=</span><span class="s4">0.95</span><span class="s2">)</span>

    <span class="s3"># make data set with large range e.g. between 1e-8 and 1e10</span>
    <span class="s1">data_exp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">7.5</span><span class="s2">, </span><span class="s4">9.5</span><span class="s2">, </span><span class="s4">1200</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">power</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s1">data_exp</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
    <span class="s3"># make manual levels e.g. between 1e-4 and 1e-6</span>
    <span class="s1">levels_exp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">4.</span><span class="s2">, </span><span class="s4">7.</span><span class="s2">)</span>
    <span class="s1">levels </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">power</span><span class="s2">(</span><span class="s4">10.</span><span class="s2">, </span><span class="s1">levels_exp</span><span class="s2">)</span>

    <span class="s3"># original data</span>
    <span class="s1">c1 </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">,</span>
                      <span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=</span><span class="s1">data</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(), </span><span class="s1">vmax</span><span class="s2">=</span><span class="s1">data</span><span class="s2">.</span><span class="s1">max</span><span class="s2">()))</span>
    <span class="s3"># just show data in levels</span>
    <span class="s1">c2 </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">,</span>
                      <span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(), </span><span class="s1">vmax</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">max</span><span class="s2">()),</span>
                      <span class="s1">extend</span><span class="s2">=</span><span class="s5">'neither'</span><span class="s2">)</span>
    <span class="s3"># extend data from levels</span>
    <span class="s1">c3 </span><span class="s2">= </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">,</span>
                      <span class="s1">norm</span><span class="s2">=</span><span class="s1">LogNorm</span><span class="s2">(</span><span class="s1">vmin</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(), </span><span class="s1">vmax</span><span class="s2">=</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">max</span><span class="s2">()),</span>
                      <span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">c1</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s4">1e-8</span><span class="s2">, </span><span class="s4">1e10</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">c2</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax2</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal_nulp</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">((</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s4">1e6</span><span class="s2">)))</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">c3</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax3</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span>
    <span class="s2">[</span><span class="s5">'contour_addlines.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">,</span>
    <span class="s1">tol</span><span class="s2">=</span><span class="s4">0.15 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() </span><span class="s0">in </span><span class="s2">(</span><span class="s5">'aarch64'</span><span class="s2">, </span><span class="s5">'ppc64le'</span><span class="s2">, </span><span class="s5">'s390x'</span><span class="s2">)</span>
        <span class="s0">else </span><span class="s4">0.03</span><span class="s2">)</span>
<span class="s3"># tolerance is because image changed minutely when tick finding on</span>
<span class="s3"># colorbars was cleaned up...</span>
<span class="s0">def </span><span class="s1">test_contour_addlines</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s4">19680812</span><span class="s2">)</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)*</span><span class="s4">10000</span>
    <span class="s1">pcm </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s3"># add 1000 to make colors visible...</span>
    <span class="s1">cont </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">+</span><span class="s4">1000</span><span class="s2">)</span>
    <span class="s1">cb </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">pcm</span><span class="s2">)</span>
    <span class="s1">cb</span><span class="s2">.</span><span class="s1">add_lines</span><span class="s2">(</span><span class="s1">cont</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">cb</span><span class="s2">.</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), [</span><span class="s4">114.3091</span><span class="s2">, </span><span class="s4">9972.30735</span><span class="s2">], </span><span class="s4">3</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span><span class="s1">baseline_images</span><span class="s2">=[</span><span class="s5">'contour_uneven'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_uneven</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">24</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s5">'proportional'</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s5">'uniform'</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s5">&quot;rc_lines_linewidth, rc_contour_linewidth, call_linewidths, expected&quot;</span><span class="s2">, [</span>
        <span class="s2">(</span><span class="s4">1.23</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s4">1.23</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1.23</span><span class="s2">, </span><span class="s4">4.24</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s4">4.24</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1.23</span><span class="s2">, </span><span class="s4">4.24</span><span class="s2">, </span><span class="s4">5.02</span><span class="s2">, </span><span class="s4">5.02</span><span class="s2">)</span>
        <span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_contour_linewidth</span><span class="s2">(</span>
        <span class="s1">rc_lines_linewidth</span><span class="s2">, </span><span class="s1">rc_contour_linewidth</span><span class="s2">, </span><span class="s1">call_linewidths</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>

    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">={</span><span class="s5">&quot;lines.linewidth&quot;</span><span class="s2">: </span><span class="s1">rc_lines_linewidth</span><span class="s2">,</span>
                        <span class="s5">&quot;contour.linewidth&quot;</span><span class="s2">: </span><span class="s1">rc_contour_linewidth</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">4</span><span class="s2">*</span><span class="s4">3</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>
        <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">linewidths</span><span class="s2">=</span><span class="s1">call_linewidths</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">get_linewidths</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">] == </span><span class="s1">expected</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;tlinewidths&quot;</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">tlinewidths</span><span class="s2">[</span><span class="s4">0</span><span class="s2">][</span><span class="s4">0</span><span class="s2">] == </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">backend</span><span class="s2">(</span><span class="s5">&quot;pdf&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_label_nonagg</span><span class="s2">():</span>
    <span class="s3"># This should not crash even if the canvas doesn't have a get_renderer().</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]]))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span><span class="s1">baseline_images</span><span class="s2">=[</span><span class="s5">'contour_closed_line_loop'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_closed_line_loop</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s3"># github issue 19568.</span>
    <span class="s1">z </span><span class="s2">= [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [</span><span class="s4">0.5</span><span class="s2">], </span><span class="s1">linewidths</span><span class="s2">=[</span><span class="s4">20</span><span class="s2">], </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.7</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">2.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">3.1</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_quadcontourset_reuse</span><span class="s2">():</span>
    <span class="s3"># If QuadContourSet returned from one contour(f) call is passed as first</span>
    <span class="s3"># argument to another the underlying C++ contour generator will be reused.</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">([</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">])</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">y</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">qcs1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s1">qcs2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">qcs2</span><span class="s2">.</span><span class="s1">_contour_generator </span><span class="s2">!= </span><span class="s1">qcs1</span><span class="s2">.</span><span class="s1">_contour_generator</span>
    <span class="s1">qcs3 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">qcs1</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">qcs3</span><span class="s2">.</span><span class="s1">_contour_generator </span><span class="s2">== </span><span class="s1">qcs1</span><span class="s2">.</span><span class="s1">_contour_generator</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span><span class="s1">baseline_images</span><span class="s2">=[</span><span class="s5">'contour_manual'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s4">0.89</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_manual</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s3"># Manually specifying contour lines/polygons to plot.</span>
    <span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">contour </span><span class="s0">import </span><span class="s1">ContourSet</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">))</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s5">'viridis'</span>

    <span class="s3"># Segments only (no 'kind' codes).</span>
    <span class="s1">lines0 </span><span class="s2">= [[[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]]]  </span><span class="s3"># Single line.</span>
    <span class="s1">lines1 </span><span class="s2">= [[[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]], [[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]]]  </span><span class="s3"># Two lines.</span>
    <span class="s1">filled01 </span><span class="s2">= [[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]]]</span>
    <span class="s1">filled12 </span><span class="s2">= [[[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]],  </span><span class="s3"># Two polygons.</span>
                <span class="s2">[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]]]</span>
    <span class="s1">ContourSet</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s1">filled01</span><span class="s2">, </span><span class="s1">filled12</span><span class="s2">], </span><span class="s1">filled</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">)</span>
    <span class="s1">ContourSet</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s1">lines0</span><span class="s2">, </span><span class="s1">lines1</span><span class="s2">], </span><span class="s1">linewidths</span><span class="s2">=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=[</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'k'</span><span class="s2">])</span>

    <span class="s3"># Segments and kind codes (1 = MOVETO, 2 = LINETO, 79 = CLOSEPOLY).</span>
    <span class="s1">segs </span><span class="s2">= [[[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">7</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">7</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">6</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]]]</span>
    <span class="s1">kinds </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">79</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">79</span><span class="s2">]]  </span><span class="s3"># Polygon containing hole.</span>
    <span class="s1">ContourSet</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s1">segs</span><span class="s2">], [</span><span class="s1">kinds</span><span class="s2">], </span><span class="s1">filled</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">)</span>
    <span class="s1">ContourSet</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, [</span><span class="s4">2</span><span class="s2">], [</span><span class="s1">segs</span><span class="s2">], [</span><span class="s1">kinds</span><span class="s2">], </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">, </span><span class="s1">linewidths</span><span class="s2">=</span><span class="s4">3</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span><span class="s1">baseline_images</span><span class="s2">=[</span><span class="s5">'contour_line_start_on_corner_edge'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_line_start_on_corner_edge</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">5</span><span class="s2">))</span>

    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s4">1.2 </span><span class="s2">- (</span><span class="s1">x </span><span class="s2">- </span><span class="s4">2</span><span class="s2">)**</span><span class="s4">2 </span><span class="s2">+ (</span><span class="s1">y </span><span class="s2">- </span><span class="s4">1</span><span class="s2">)**</span><span class="s4">2</span>
    <span class="s1">mask </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">)</span>
    <span class="s1">mask</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">mask</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">mask</span><span class="s2">)</span>

    <span class="s1">filled </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">corner_mask</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">)</span>
    <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">corner_mask</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">add_lines</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_find_nearest_contour</span><span class="s2">():</span>
    <span class="s1">xy </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">indices</span><span class="s2">((</span><span class="s4">15</span><span class="s2">, </span><span class="s4">15</span><span class="s2">))</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">((</span><span class="s1">xy </span><span class="s2">- </span><span class="s4">5</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)/</span><span class="s4">5.</span><span class="s2">**</span><span class="s4">2</span><span class="s2">))</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">img</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>

    <span class="s1">nearest_contour </span><span class="s2">= </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">find_nearest_contour</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">pixel</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">expected_nearest </span><span class="s2">= (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">33</span><span class="s2">, </span><span class="s4">1.965966</span><span class="s2">, </span><span class="s4">1.965966</span><span class="s2">, </span><span class="s4">1.866183</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">nearest_contour</span><span class="s2">, </span><span class="s1">expected_nearest</span><span class="s2">)</span>

    <span class="s1">nearest_contour </span><span class="s2">= </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">find_nearest_contour</span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">pixel</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">expected_nearest </span><span class="s2">= (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">7.550173</span><span class="s2">, </span><span class="s4">1.587542</span><span class="s2">, </span><span class="s4">0.547550</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">nearest_contour</span><span class="s2">, </span><span class="s1">expected_nearest</span><span class="s2">)</span>

    <span class="s1">nearest_contour </span><span class="s2">= </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">find_nearest_contour</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">pixel</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">expected_nearest </span><span class="s2">= (</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">21</span><span class="s2">, </span><span class="s4">1.884384</span><span class="s2">, </span><span class="s4">5.023335</span><span class="s2">, </span><span class="s4">0.013911</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">nearest_contour</span><span class="s2">, </span><span class="s1">expected_nearest</span><span class="s2">)</span>

    <span class="s1">nearest_contour </span><span class="s2">= </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">find_nearest_contour</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">=(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">), </span><span class="s1">pixel</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">expected_nearest </span><span class="s2">= (</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">2.628202</span><span class="s2">, </span><span class="s4">5.0</span><span class="s2">, </span><span class="s4">0.394638</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">nearest_contour</span><span class="s2">, </span><span class="s1">expected_nearest</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_find_nearest_contour_no_filled</span><span class="s2">():</span>
    <span class="s1">xy </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">indices</span><span class="s2">((</span><span class="s4">15</span><span class="s2">, </span><span class="s4">15</span><span class="s2">))</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">((</span><span class="s1">xy </span><span class="s2">- </span><span class="s4">5</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)/</span><span class="s4">5.</span><span class="s2">**</span><span class="s4">2</span><span class="s2">))</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">img</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Method does not support filled contours&quot;</span><span class="s2">):</span>
        <span class="s1">cs</span><span class="s2">.</span><span class="s1">find_nearest_contour</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">pixel</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Method does not support filled contours&quot;</span><span class="s2">):</span>
        <span class="s1">cs</span><span class="s2">.</span><span class="s1">find_nearest_contour</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">=(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">), </span><span class="s1">pixel</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Method does not support filled contours&quot;</span><span class="s2">):</span>
        <span class="s1">cs</span><span class="s2">.</span><span class="s1">find_nearest_contour</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">=(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">7</span><span class="s2">), </span><span class="s1">pixel</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s5">&quot;default&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_autolabel_beyond_powerlimits</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">geomspace</span><span class="s2">(</span><span class="s4">1e-6</span><span class="s2">, </span><span class="s4">1e-4</span><span class="s2">, </span><span class="s4">100</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">),</span>
                     <span class="s1">levels</span><span class="s2">=[</span><span class="s4">.25e-5</span><span class="s2">, </span><span class="s4">1e-5</span><span class="s2">, </span><span class="s4">4e-5</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">)</span>
    <span class="s3"># Currently, the exponent is missing, but that may be fixed in the future.</span>
    <span class="s0">assert </span><span class="s2">{</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">texts</span><span class="s2">} == {</span><span class="s5">&quot;0.25&quot;</span><span class="s2">, </span><span class="s5">&quot;1.00&quot;</span><span class="s2">, </span><span class="s5">&quot;4.00&quot;</span><span class="s2">}</span>


<span class="s0">def </span><span class="s1">test_contourf_legend_elements</span><span class="s2">():</span>
    <span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches </span><span class="s0">import </span><span class="s1">Rectangle</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">x </span><span class="s2">* </span><span class="s1">y</span>

    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">50</span><span class="s2">],</span>
                      <span class="s1">colors</span><span class="s2">=[</span><span class="s5">'#FFFF00'</span><span class="s2">, </span><span class="s5">'#FF00FF'</span><span class="s2">, </span><span class="s5">'#00FFFF'</span><span class="s2">],</span>
                      <span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">cs</span><span class="s2">.</span><span class="s1">cmap</span><span class="s2">.</span><span class="s1">set_over</span><span class="s2">(</span><span class="s5">'red'</span><span class="s2">)</span>
    <span class="s1">cs</span><span class="s2">.</span><span class="s1">cmap</span><span class="s2">.</span><span class="s1">set_under</span><span class="s2">(</span><span class="s5">'blue'</span><span class="s2">)</span>
    <span class="s1">cs</span><span class="s2">.</span><span class="s1">changed</span><span class="s2">()</span>
    <span class="s1">artists</span><span class="s2">, </span><span class="s1">labels </span><span class="s2">= </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">legend_elements</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">labels </span><span class="s2">== [</span><span class="s5">'$x </span><span class="s0">\\</span><span class="s5">leq -1e+250s$'</span><span class="s2">,</span>
                      <span class="s5">'$10.0 &lt; x </span><span class="s0">\\</span><span class="s5">leq 30.0$'</span><span class="s2">,</span>
                      <span class="s5">'$30.0 &lt; x </span><span class="s0">\\</span><span class="s5">leq 50.0$'</span><span class="s2">,</span>
                      <span class="s5">'$x &gt; 1e+250s$'</span><span class="s2">]</span>
    <span class="s1">expected_colors </span><span class="s2">= (</span><span class="s5">'blue'</span><span class="s2">, </span><span class="s5">'#FFFF00'</span><span class="s2">, </span><span class="s5">'#FF00FF'</span><span class="s2">, </span><span class="s5">'red'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">Rectangle</span><span class="s2">) </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">artists</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">(), </span><span class="s1">c</span><span class="s2">)</span>
               <span class="s0">for </span><span class="s1">a</span><span class="s2">, </span><span class="s1">c </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">artists</span><span class="s2">, </span><span class="s1">expected_colors</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_contour_legend_elements</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">x </span><span class="s2">* </span><span class="s1">y</span>

    <span class="s1">colors </span><span class="s2">= [</span><span class="s5">'blue'</span><span class="s2">, </span><span class="s5">'#00FF00'</span><span class="s2">, </span><span class="s5">'red'</span><span class="s2">]</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">50</span><span class="s2">],</span>
                     <span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
                     <span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">artists</span><span class="s2">, </span><span class="s1">labels </span><span class="s2">= </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">legend_elements</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">labels </span><span class="s2">== [</span><span class="s5">'$x = 10.0$'</span><span class="s2">, </span><span class="s5">'$x = 30.0$'</span><span class="s2">, </span><span class="s5">'$x = 50.0$'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">) </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">artists</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">c</span><span class="s2">)</span>
               <span class="s0">for </span><span class="s1">a</span><span class="s2">, </span><span class="s1">c </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">artists</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s5">&quot;algorithm, klass&quot;</span><span class="s2">,</span>
    <span class="s2">[(</span><span class="s5">'mpl2005'</span><span class="s2">, </span><span class="s1">contourpy</span><span class="s2">.</span><span class="s1">Mpl2005ContourGenerator</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s5">'mpl2014'</span><span class="s2">, </span><span class="s1">contourpy</span><span class="s2">.</span><span class="s1">Mpl2014ContourGenerator</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s5">'serial'</span><span class="s2">, </span><span class="s1">contourpy</span><span class="s2">.</span><span class="s1">SerialContourGenerator</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s5">'threaded'</span><span class="s2">, </span><span class="s1">contourpy</span><span class="s2">.</span><span class="s1">ThreadedContourGenerator</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s5">'invalid'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_algorithm_name</span><span class="s2">(</span><span class="s1">algorithm</span><span class="s2">, </span><span class="s1">klass</span><span class="s2">):</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">], [</span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">]])</span>
    <span class="s0">if </span><span class="s1">klass </span><span class="s0">is not None</span><span class="s2">:</span>
        <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">algorithm</span><span class="s2">=</span><span class="s1">algorithm</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">.</span><span class="s1">_contour_generator</span><span class="s2">, </span><span class="s1">klass</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">algorithm</span><span class="s2">=</span><span class="s1">algorithm</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s5">&quot;algorithm&quot;</span><span class="s2">, [</span><span class="s5">'mpl2005'</span><span class="s2">, </span><span class="s5">'mpl2014'</span><span class="s2">, </span><span class="s5">'serial'</span><span class="s2">, </span><span class="s5">'threaded'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_algorithm_supports_corner_mask</span><span class="s2">(</span><span class="s1">algorithm</span><span class="s2">):</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">], [</span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">]])</span>

    <span class="s3"># All algorithms support corner_mask=False</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">algorithm</span><span class="s2">=</span><span class="s1">algorithm</span><span class="s2">, </span><span class="s1">corner_mask</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s3"># Only some algorithms support corner_mask=True</span>
    <span class="s0">if </span><span class="s1">algorithm </span><span class="s2">!= </span><span class="s5">'mpl2005'</span><span class="s2">:</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">algorithm</span><span class="s2">=</span><span class="s1">algorithm</span><span class="s2">, </span><span class="s1">corner_mask</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">algorithm</span><span class="s2">=</span><span class="s1">algorithm</span><span class="s2">, </span><span class="s1">corner_mask</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;split_collections&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span><span class="s1">baseline_images</span><span class="s2">=[</span><span class="s5">'contour_all_algorithms'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s4">0.06</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_all_algorithms</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">):</span>
    <span class="s1">algorithms </span><span class="s2">= [</span><span class="s5">'mpl2005'</span><span class="s2">, </span><span class="s5">'mpl2014'</span><span class="s2">, </span><span class="s5">'serial'</span><span class="s2">, </span><span class="s5">'threaded'</span><span class="s2">]</span>

    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">2981</span><span class="s2">)</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">6</span><span class="s2">))</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s4">15</span><span class="s2">*</span><span class="s1">x</span><span class="s2">)*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s4">10</span><span class="s2">*</span><span class="s1">y</span><span class="s2">) + </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">mask </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">)</span>
    <span class="s1">mask</span><span class="s2">[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">7</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">mask</span><span class="s2">)</span>

    <span class="s1">_</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">algorithm </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">(), </span><span class="s1">algorithms</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">algorithm</span><span class="s2">=</span><span class="s1">algorithm</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">algorithm</span><span class="s2">=</span><span class="s1">algorithm</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s1">algorithm</span><span class="s2">)</span>

    <span class="s1">_maybe_split_collections</span><span class="s2">(</span><span class="s1">split_collections</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_subfigure_clabel</span><span class="s2">():</span>
    <span class="s3"># Smoke test for gh#23173</span>
    <span class="s1">delta </span><span class="s2">= </span><span class="s4">0.025</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-(</span><span class="s1">X</span><span class="s2">**</span><span class="s4">2</span><span class="s2">) - </span><span class="s1">Y</span><span class="s2">**</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">Z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-((</span><span class="s1">X </span><span class="s2">- </span><span class="s4">1</span><span class="s2">) ** </span><span class="s4">2</span><span class="s2">) - (</span><span class="s1">Y </span><span class="s2">- </span><span class="s4">1</span><span class="s2">) ** </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= (</span><span class="s1">Z1 </span><span class="s2">- </span><span class="s1">Z2</span><span class="s2">) * </span><span class="s4">2</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">figs </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">subfigures</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">figs</span><span class="s2">:</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">CS </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">CS</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">&quot;Simplest default with labels&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s5">&quot;style&quot;</span><span class="s2">, [</span><span class="s5">'solid'</span><span class="s2">, </span><span class="s5">'dashed'</span><span class="s2">, </span><span class="s5">'dashdot'</span><span class="s2">, </span><span class="s5">'dotted'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_linestyles</span><span class="s2">(</span><span class="s1">style</span><span class="s2">):</span>
    <span class="s1">delta </span><span class="s2">= </span><span class="s4">0.025</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">X</span><span class="s2">**</span><span class="s4">2 </span><span class="s2">- </span><span class="s1">Y</span><span class="s2">**</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">Z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-(</span><span class="s1">X </span><span class="s2">- </span><span class="s4">1</span><span class="s2">)**</span><span class="s4">2 </span><span class="s2">- (</span><span class="s1">Y </span><span class="s2">- </span><span class="s4">1</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= (</span><span class="s1">Z1 </span><span class="s2">- </span><span class="s1">Z2</span><span class="s2">) * </span><span class="s4">2</span>

    <span class="s3"># Positive contour defaults to solid</span>
    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">CS1 </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">CS1</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">'Single color - positive contours solid (default)'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">CS1</span><span class="s2">.</span><span class="s1">linestyles </span><span class="s0">is None  </span><span class="s3"># default</span>

    <span class="s3"># Change linestyles using linestyles kwarg</span>
    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">CS2 </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">, </span><span class="s1">linestyles</span><span class="s2">=</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">CS2</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">f'Single color - positive contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s5">'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">CS2</span><span class="s2">.</span><span class="s1">linestyles </span><span class="s2">== </span><span class="s1">style</span>

    <span class="s3"># Ensure linestyles do not change when negative_linestyles is defined</span>
    <span class="s1">fig3</span><span class="s2">, </span><span class="s1">ax3 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">CS3 </span><span class="s2">= </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">, </span><span class="s1">linestyles</span><span class="s2">=</span><span class="s1">style</span><span class="s2">,</span>
                      <span class="s1">negative_linestyles</span><span class="s2">=</span><span class="s5">'dashdot'</span><span class="s2">)</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">CS3</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">f'Single color - positive contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s5">'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">CS3</span><span class="s2">.</span><span class="s1">linestyles </span><span class="s2">== </span><span class="s1">style</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s5">&quot;style&quot;</span><span class="s2">, [</span><span class="s5">'solid'</span><span class="s2">, </span><span class="s5">'dashed'</span><span class="s2">, </span><span class="s5">'dashdot'</span><span class="s2">, </span><span class="s5">'dotted'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_negative_linestyles</span><span class="s2">(</span><span class="s1">style</span><span class="s2">):</span>
    <span class="s1">delta </span><span class="s2">= </span><span class="s4">0.025</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">X</span><span class="s2">**</span><span class="s4">2 </span><span class="s2">- </span><span class="s1">Y</span><span class="s2">**</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">Z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-(</span><span class="s1">X </span><span class="s2">- </span><span class="s4">1</span><span class="s2">)**</span><span class="s4">2 </span><span class="s2">- (</span><span class="s1">Y </span><span class="s2">- </span><span class="s4">1</span><span class="s2">)**</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= (</span><span class="s1">Z1 </span><span class="s2">- </span><span class="s1">Z2</span><span class="s2">) * </span><span class="s4">2</span>

    <span class="s3"># Negative contour defaults to dashed</span>
    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">CS1 </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">CS1</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">'Single color - negative contours dashed (default)'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">CS1</span><span class="s2">.</span><span class="s1">negative_linestyles </span><span class="s2">== </span><span class="s5">'dashed'  </span><span class="s3"># default</span>

    <span class="s3"># Change negative_linestyles using rcParams</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'contour.negative_linestyle'</span><span class="s2">] = </span><span class="s1">style</span>
    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">CS2 </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">CS2</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">f'Single color - negative contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s5">'</span>
                   <span class="s5">'(using rcParams)'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">CS2</span><span class="s2">.</span><span class="s1">negative_linestyles </span><span class="s2">== </span><span class="s1">style</span>

    <span class="s3"># Change negative_linestyles using negative_linestyles kwarg</span>
    <span class="s1">fig3</span><span class="s2">, </span><span class="s1">ax3 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">CS3 </span><span class="s2">= </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">, </span><span class="s1">negative_linestyles</span><span class="s2">=</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">CS3</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">f'Single color - negative contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s5">'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">CS3</span><span class="s2">.</span><span class="s1">negative_linestyles </span><span class="s2">== </span><span class="s1">style</span>

    <span class="s3"># Ensure negative_linestyles do not change when linestyles is defined</span>
    <span class="s1">fig4</span><span class="s2">, </span><span class="s1">ax4 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">CS4 </span><span class="s2">= </span><span class="s1">ax4</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">, </span><span class="s1">linestyles</span><span class="s2">=</span><span class="s5">'dashdot'</span><span class="s2">,</span>
                      <span class="s1">negative_linestyles</span><span class="s2">=</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">(</span><span class="s1">CS4</span><span class="s2">, </span><span class="s1">fontsize</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">inline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s5">f'Single color - negative contours </span><span class="s0">{</span><span class="s1">style</span><span class="s0">}</span><span class="s5">'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">CS4</span><span class="s2">.</span><span class="s1">negative_linestyles </span><span class="s2">== </span><span class="s1">style</span>


<span class="s0">def </span><span class="s1">test_contour_remove</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">orig_children </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_children</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">16</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)))</span>
    <span class="s1">cs</span><span class="s2">.</span><span class="s1">clabel</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_children</span><span class="s2">() != </span><span class="s1">orig_children</span>
    <span class="s1">cs</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_children</span><span class="s2">() == </span><span class="s1">orig_children</span>


<span class="s0">def </span><span class="s1">test_contour_no_args</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">r&quot;contour\(\) takes from 1 to 4&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_contour_clip_path</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]]</span>
    <span class="s1">circle </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Circle</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">clip_path</span><span class="s2">=</span><span class="s1">circle</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">get_clip_path</span><span class="s2">() </span><span class="s0">is not None</span>


<span class="s0">def </span><span class="s1">test_bool_autolevel</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)</span>
    <span class="s1">z </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">9</span><span class="s2">) % </span><span class="s4">2</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">bool</span><span class="s2">)</span>
    <span class="s1">m </span><span class="s2">= [[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">], [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">], [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">()).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">.5</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">z</span><span class="s2">).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">.5</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">.5</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">()).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">z</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">tricontour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">()).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">.5</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">tricontour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">.5</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">tricontourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">()).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">tricontourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">).</span><span class="s1">levels</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_all_nan</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]])</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">).</span><span class="s1">levels</span><span class="s2">,</span>
                              <span class="s2">[-</span><span class="s4">1e-13</span><span class="s2">, -</span><span class="s4">7.5e-14</span><span class="s2">, -</span><span class="s4">5e-14</span><span class="s2">, -</span><span class="s4">2.4e-14</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">,</span>
                                <span class="s4">2.4e-14</span><span class="s2">, </span><span class="s4">5e-14</span><span class="s2">, </span><span class="s4">7.5e-14</span><span class="s2">, </span><span class="s4">1e-13</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_allsegs_allkinds</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s2">))</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">])</span>

    <span class="s3"># Expect two levels, the first with 5 segments and the second with 4.</span>
    <span class="s0">for </span><span class="s1">result </span><span class="s0">in </span><span class="s2">[</span><span class="s1">cs</span><span class="s2">.</span><span class="s1">allsegs</span><span class="s2">, </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">allkinds</span><span class="s2">]:</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">result</span><span class="s2">) == </span><span class="s4">2</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">result</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]) == </span><span class="s4">5</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">result</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]) == </span><span class="s4">4</span>


<span class="s0">def </span><span class="s1">test_deprecated_apis</span><span class="s2">():</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">16</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;collections&quot;</span><span class="s2">):</span>
        <span class="s1">colls </span><span class="s2">= </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">collections</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;tcolors&quot;</span><span class="s2">):</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">.</span><span class="s1">tcolors</span><span class="s2">, [</span><span class="s1">c</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">() </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">colls</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;tlinewidths&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">tlinewidths </span><span class="s2">== [</span><span class="s1">c</span><span class="s2">.</span><span class="s1">get_linewidth</span><span class="s2">() </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">colls</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;antialiased&quot;</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">antialiased</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;antialiased&quot;</span><span class="s2">):</span>
        <span class="s1">cs</span><span class="s2">.</span><span class="s1">antialiased </span><span class="s2">= </span><span class="s0">False</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;antialiased&quot;</span><span class="s2">):</span>
        <span class="s0">assert not </span><span class="s1">cs</span><span class="s2">.</span><span class="s1">antialiased</span>
</pre>
</body>
</html>