<html>
<head>
<title>test_old_base.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_old_base.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">weakref</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_config </span><span class="s0">import </span><span class="s1">using_pyarrow_string_dtype</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs </span><span class="s0">import </span><span class="s1">Timestamp</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">dtypes</span><span class="s2">.</span><span class="s1">common </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">is_integer_dtype</span><span class="s2">,</span>
    <span class="s1">is_numeric_dtype</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">dtypes</span><span class="s2">.</span><span class="s1">dtypes </span><span class="s0">import </span><span class="s1">CategoricalDtype</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">CategoricalIndex</span><span class="s2">,</span>
    <span class="s1">DatetimeIndex</span><span class="s2">,</span>
    <span class="s1">DatetimeTZDtype</span><span class="s2">,</span>
    <span class="s1">Index</span><span class="s2">,</span>
    <span class="s1">IntervalIndex</span><span class="s2">,</span>
    <span class="s1">MultiIndex</span><span class="s2">,</span>
    <span class="s1">PeriodIndex</span><span class="s2">,</span>
    <span class="s1">RangeIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">TimedeltaIndex</span><span class="s2">,</span>
    <span class="s1">isna</span><span class="s2">,</span>
    <span class="s1">period_range</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">algorithms </span><span class="s0">as </span><span class="s1">algos</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">arrays </span><span class="s0">import </span><span class="s1">BaseMaskedArray</span>


<span class="s0">class </span><span class="s1">TestBase</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span>
        <span class="s1">params</span><span class="s2">=[</span>
            <span class="s1">RangeIndex</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">=</span><span class="s3">20</span><span class="s2">, </span><span class="s1">step</span><span class="s2">=</span><span class="s3">2</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s4">&quot;abcde&quot;</span><span class="s2">)),</span>
            <span class="s1">Index</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">]),</span>
            <span class="s1">period_range</span><span class="s2">(</span><span class="s4">&quot;20130101&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s3">5</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;D&quot;</span><span class="s2">),</span>
            <span class="s1">TimedeltaIndex</span><span class="s2">(</span>
                <span class="s2">[</span>
                    <span class="s4">&quot;0 days 01:00:00&quot;</span><span class="s2">,</span>
                    <span class="s4">&quot;1 days 01:00:00&quot;</span><span class="s2">,</span>
                    <span class="s4">&quot;2 days 01:00:00&quot;</span><span class="s2">,</span>
                    <span class="s4">&quot;3 days 01:00:00&quot;</span><span class="s2">,</span>
                    <span class="s4">&quot;4 days 01:00:00&quot;</span><span class="s2">,</span>
                <span class="s2">],</span>
                <span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;timedelta64[ns]&quot;</span><span class="s2">,</span>
                <span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s2">),</span>
            <span class="s1">DatetimeIndex</span><span class="s2">(</span>
                <span class="s2">[</span><span class="s4">&quot;2013-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-01-02&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-01-03&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-01-04&quot;</span><span class="s2">, </span><span class="s4">&quot;2013-01-05&quot;</span><span class="s2">],</span>
                <span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s2">,</span>
                <span class="s1">freq</span><span class="s2">=</span><span class="s4">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s2">),</span>
            <span class="s1">IntervalIndex</span><span class="s2">.</span><span class="s1">from_breaks</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">11</span><span class="s2">), </span><span class="s1">closed</span><span class="s2">=</span><span class="s4">&quot;right&quot;</span><span class="s2">),</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">simple_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>

    <span class="s0">def </span><span class="s1">test_pickle_compat_construction</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># need an object to create with</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;RangeIndex() is a valid constructor&quot;</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;|&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4">r&quot;Index\(\.\.\.\) must be called with a collection of some &quot;</span>
                <span class="s4">r&quot;kind, None was passed&quot;</span><span class="s2">,</span>
                <span class="s4">r&quot;DatetimeIndex\(\) must be called with a collection of some &quot;</span>
                <span class="s4">r&quot;kind, None was passed&quot;</span><span class="s2">,</span>
                <span class="s4">r&quot;TimedeltaIndex\(\) must be called with a collection of some &quot;</span>
                <span class="s4">r&quot;kind, None was passed&quot;</span><span class="s2">,</span>
                <span class="s4">r&quot;__new__\(\) missing 1 required positional argument: 'data'&quot;</span><span class="s2">,</span>
                <span class="s4">r&quot;__new__\(\) takes at least 2 arguments \(1 given\)&quot;</span><span class="s2">,</span>
            <span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">)()</span>

    <span class="s0">def </span><span class="s1">test_shift</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH8083 test the base class for shift</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, (</span><span class="s1">DatetimeIndex</span><span class="s2">, </span><span class="s1">TimedeltaIndex</span><span class="s2">, </span><span class="s1">PeriodIndex</span><span class="s2">)):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested in test_ops/test_arithmetic&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">msg </span><span class="s2">= (</span>
            <span class="s4">f&quot;This method is only implemented for DatetimeIndex, PeriodIndex and &quot;</span>
            <span class="s4">f&quot;TimedeltaIndex; Got type </span><span class="s0">{</span><span class="s1">type</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">).</span><span class="s1">__name__</span><span class="s0">}</span><span class="s4">&quot;</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">NotImplementedError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">(</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">NotImplementedError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_constructor_name_unhashable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH#29069 check that name is hashable</span>
        <span class="s5"># See also same-named test in tests.series.test_constructors</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Index.name must be a hashable type&quot;</span><span class="s2">):</span>
            <span class="s1">type</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=[])</span>

    <span class="s0">def </span><span class="s1">test_create_index_existing_name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH11193, when an existing index is passed, and a new name is not</span>
        <span class="s5"># specified, the new index should inherit the previous object name</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">MultiIndex</span><span class="s2">):</span>
            <span class="s1">expected</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s4">&quot;foo&quot;</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

            <span class="s1">result </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;bar&quot;</span><span class="s2">)</span>
            <span class="s1">expected</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s4">&quot;bar&quot;</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">expected</span><span class="s2">.</span><span class="s1">names </span><span class="s2">= [</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s2">]</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span>
                <span class="s1">result</span><span class="s2">,</span>
                <span class="s1">Index</span><span class="s2">(</span>
                    <span class="s1">Index</span><span class="s2">(</span>
                        <span class="s2">[</span>
                            <span class="s2">(</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;one&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;one&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;baz&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;qux&quot;</span><span class="s2">, </span><span class="s4">&quot;one&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;qux&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">),</span>
                        <span class="s2">],</span>
                        <span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;object&quot;</span><span class="s2">,</span>
                    <span class="s2">),</span>
                    <span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;bar&quot;</span><span class="s2">],</span>
                <span class="s2">),</span>
            <span class="s2">)</span>

            <span class="s1">result </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">])</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span>
                <span class="s1">result</span><span class="s2">,</span>
                <span class="s1">Index</span><span class="s2">(</span>
                    <span class="s1">Index</span><span class="s2">(</span>
                        <span class="s2">[</span>
                            <span class="s2">(</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;one&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;one&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;baz&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;qux&quot;</span><span class="s2">, </span><span class="s4">&quot;one&quot;</span><span class="s2">),</span>
                            <span class="s2">(</span><span class="s4">&quot;qux&quot;</span><span class="s2">, </span><span class="s4">&quot;two&quot;</span><span class="s2">),</span>
                        <span class="s2">],</span>
                        <span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;object&quot;</span><span class="s2">,</span>
                    <span class="s2">),</span>
                    <span class="s1">names</span><span class="s2">=[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">],</span>
                <span class="s2">),</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_numeric_compat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s5"># Check that this doesn't cover MultiIndex case, if/when it does,</span>
        <span class="s5">#  we can remove multi.test_compat.test_numeric_compat</span>
        <span class="s0">assert not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">MultiIndex</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">type</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">) </span><span class="s0">is </span><span class="s1">Index</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Not applicable for Index&quot;</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">is_numeric_dtype</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">) </span><span class="s0">or </span><span class="s1">isinstance</span><span class="s2">(</span>
            <span class="s1">simple_index</span><span class="s2">, </span><span class="s1">TimedeltaIndex</span>
        <span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere.&quot;</span><span class="s2">)</span>

        <span class="s1">typ </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">).</span><span class="s1">__name__</span>
        <span class="s1">cls </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">).</span><span class="s1">__name__</span>
        <span class="s1">lmsg </span><span class="s2">= </span><span class="s4">&quot;|&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4">rf&quot;unsupported operand type\(s\) for \*: '</span><span class="s0">{</span><span class="s1">typ</span><span class="s0">}</span><span class="s4">' and 'int'&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;cannot perform (__mul__|__truediv__|__floordiv__) with &quot;</span>
                <span class="s4">f&quot;this index type: (</span><span class="s0">{</span><span class="s1">cls</span><span class="s0">}</span><span class="s4">|</span><span class="s0">{</span><span class="s1">typ</span><span class="s0">}</span><span class="s4">)&quot;</span><span class="s2">,</span>
            <span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">lmsg</span><span class="s2">):</span>
            <span class="s1">idx </span><span class="s2">* </span><span class="s3">1</span>
        <span class="s1">rmsg </span><span class="s2">= </span><span class="s4">&quot;|&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4">rf&quot;unsupported operand type\(s\) for \*: 'int' and '</span><span class="s0">{</span><span class="s1">typ</span><span class="s0">}</span><span class="s4">'&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;cannot perform (__rmul__|__rtruediv__|__rfloordiv__) with &quot;</span>
                <span class="s4">f&quot;this index type: (</span><span class="s0">{</span><span class="s1">cls</span><span class="s0">}</span><span class="s4">|</span><span class="s0">{</span><span class="s1">typ</span><span class="s0">}</span><span class="s4">)&quot;</span><span class="s2">,</span>
            <span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">rmsg</span><span class="s2">):</span>
            <span class="s3">1 </span><span class="s2">* </span><span class="s1">idx</span>

        <span class="s1">div_err </span><span class="s2">= </span><span class="s1">lmsg</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">&quot;*&quot;</span><span class="s2">, </span><span class="s4">&quot;/&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">div_err</span><span class="s2">):</span>
            <span class="s1">idx </span><span class="s2">/ </span><span class="s3">1</span>
        <span class="s1">div_err </span><span class="s2">= </span><span class="s1">rmsg</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">&quot;*&quot;</span><span class="s2">, </span><span class="s4">&quot;/&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">div_err</span><span class="s2">):</span>
            <span class="s3">1 </span><span class="s2">/ </span><span class="s1">idx</span>

        <span class="s1">floordiv_err </span><span class="s2">= </span><span class="s1">lmsg</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">&quot;*&quot;</span><span class="s2">, </span><span class="s4">&quot;//&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">floordiv_err</span><span class="s2">):</span>
            <span class="s1">idx </span><span class="s2">// </span><span class="s3">1</span>
        <span class="s1">floordiv_err </span><span class="s2">= </span><span class="s1">rmsg</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">&quot;*&quot;</span><span class="s2">, </span><span class="s4">&quot;//&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">floordiv_err</span><span class="s2">):</span>
            <span class="s3">1 </span><span class="s2">// </span><span class="s1">idx</span>

    <span class="s0">def </span><span class="s1">test_logical_compat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">dtype </span><span class="s0">in </span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s4">&quot;string&quot;</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere.&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">if </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">kind </span><span class="s0">in </span><span class="s4">&quot;iufcbm&quot;</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">all</span><span class="s2">() == </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">all</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">all</span><span class="s2">() == </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">to_series</span><span class="s2">().</span><span class="s1">all</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">any</span><span class="s2">() == </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">any</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">any</span><span class="s2">() == </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">to_series</span><span class="s2">().</span><span class="s1">any</span><span class="s2">()</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;cannot perform (any|all)&quot;</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">IntervalIndex</span><span class="s2">):</span>
                <span class="s1">msg </span><span class="s2">= (</span>
                    <span class="s4">r&quot;'IntervalArray' with dtype interval\[.*\] does &quot;</span>
                    <span class="s4">&quot;not support reduction '(any|all)'&quot;</span>
                <span class="s2">)</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">.</span><span class="s1">all</span><span class="s2">()</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">.</span><span class="s1">any</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_repr_roundtrip</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">IntervalIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">f&quot;Not a valid repr for </span><span class="s0">{</span><span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">).</span><span class="s1">__name__</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">eval</span><span class="s2">(</span><span class="s1">repr</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)), </span><span class="s1">idx</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_repr_max_seq_item_setting</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH10182</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">IntervalIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">f&quot;Not a valid repr for </span><span class="s0">{</span><span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">).</span><span class="s1">__name__</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s3">50</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">option_context</span><span class="s2">(</span><span class="s4">&quot;display.max_seq_items&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">):</span>
            <span class="s1">repr</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s4">&quot;...&quot; </span><span class="s0">not in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s4">r&quot;ignore:PeriodDtype\[B\] is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_ensure_copied_data</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s5"># Check the &quot;copy&quot; argument of each Index.__new__ is honoured</span>
        <span class="s5"># GH12309</span>
        <span class="s1">init_kwargs </span><span class="s2">= {}</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">PeriodIndex</span><span class="s2">):</span>
            <span class="s5"># Needs &quot;freq&quot; specification:</span>
            <span class="s1">init_kwargs</span><span class="s2">[</span><span class="s4">&quot;freq&quot;</span><span class="s2">] = </span><span class="s1">index</span><span class="s2">.</span><span class="s1">freq</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, (</span><span class="s1">RangeIndex</span><span class="s2">, </span><span class="s1">MultiIndex</span><span class="s2">, </span><span class="s1">CategoricalIndex</span><span class="s2">)):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span>
                <span class="s4">&quot;RangeIndex cannot be initialized from data, &quot;</span>
                <span class="s4">&quot;MultiIndex and CategoricalIndex are tested separately&quot;</span>
            <span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">object </span><span class="s0">and </span><span class="s1">index</span><span class="s2">.</span><span class="s1">inferred_type </span><span class="s2">== </span><span class="s4">&quot;boolean&quot;</span><span class="s2">:</span>
            <span class="s1">init_kwargs</span><span class="s2">[</span><span class="s4">&quot;dtype&quot;</span><span class="s2">] = </span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span>

        <span class="s1">index_type </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">index_type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, **</span><span class="s1">init_kwargs</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">DatetimeTZDtype</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s4">&quot;UTC&quot;</span><span class="s2">).</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, (</span><span class="s1">DatetimeIndex</span><span class="s2">, </span><span class="s1">TimedeltaIndex</span><span class="s2">)):</span>
            <span class="s1">index </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">_with_freq</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">result</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">PeriodIndex</span><span class="s2">):</span>
            <span class="s5"># .values an object array of Period, thus copied</span>
            <span class="s1">depr_msg </span><span class="s2">= </span><span class="s4">&quot;The 'ordinal' keyword in PeriodIndex is deprecated&quot;</span>
            <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">depr_msg</span><span class="s2">):</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">index_type</span><span class="s2">(</span><span class="s1">ordinal</span><span class="s2">=</span><span class="s1">index</span><span class="s2">.</span><span class="s1">asi8</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, **</span><span class="s1">init_kwargs</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">asi8</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">asi8</span><span class="s2">, </span><span class="s1">check_same</span><span class="s2">=</span><span class="s4">&quot;same&quot;</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">IntervalIndex</span><span class="s2">):</span>
            <span class="s5"># checked in test_interval.py</span>
            <span class="s0">pass</span>
        <span class="s0">elif </span><span class="s1">type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) </span><span class="s0">is </span><span class="s1">Index </span><span class="s0">and not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">index_type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, **</span><span class="s1">init_kwargs</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">index</span><span class="s2">)</span>

            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">, </span><span class="s1">BaseMaskedArray</span><span class="s2">):</span>
                <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">shares_memory</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">)</span>
                <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span>
                    <span class="s1">index</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">check_same</span><span class="s2">=</span><span class="s4">&quot;same&quot;</span>
                <span class="s2">)</span>
                <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">shares_memory</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_mask</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_mask</span><span class="s2">)</span>
                <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span>
                    <span class="s1">index</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_mask</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_mask</span><span class="s2">, </span><span class="s1">check_same</span><span class="s2">=</span><span class="s4">&quot;same&quot;</span>
                <span class="s2">)</span>
            <span class="s0">elif </span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s4">&quot;string[python]&quot;</span><span class="s2">:</span>
                <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">shares_memory</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_ndarray</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_ndarray</span><span class="s2">)</span>
                <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span>
                    <span class="s1">index</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_ndarray</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">.</span><span class="s1">_ndarray</span><span class="s2">, </span><span class="s1">check_same</span><span class="s2">=</span><span class="s4">&quot;same&quot;</span>
                <span class="s2">)</span>
            <span class="s0">elif </span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype </span><span class="s0">in </span><span class="s2">(</span><span class="s4">&quot;string[pyarrow]&quot;</span><span class="s2">, </span><span class="s4">&quot;string[pyarrow_numpy]&quot;</span><span class="s2">):</span>
                <span class="s0">assert </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">shares_memory</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">, </span><span class="s1">index</span><span class="s2">.</span><span class="s1">_values</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">raise </span><span class="s1">NotImplementedError</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">index_type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, **</span><span class="s1">init_kwargs</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">check_same</span><span class="s2">=</span><span class="s4">&quot;same&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_memory_usage</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s1">index</span><span class="s2">.</span><span class="s1">_engine</span><span class="s2">.</span><span class="s1">clear_mapping</span><span class="s2">()</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">memory_usage</span><span class="s2">()</span>
        <span class="s0">if </span><span class="s1">index</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
            <span class="s5"># we report 0 for no-length</span>
            <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s3">0</span>
            <span class="s0">return</span>

        <span class="s5"># non-zero length</span>
        <span class="s1">index</span><span class="s2">.</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s1">index</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])</span>
        <span class="s1">result2 </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">memory_usage</span><span class="s2">()</span>
        <span class="s1">result3 </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">memory_usage</span><span class="s2">(</span><span class="s1">deep</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s5"># RangeIndex, IntervalIndex</span>
        <span class="s5"># don't have engines</span>
        <span class="s5"># Index[EA] has engine but it does not have a Hashtable .mapping</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, (</span><span class="s1">RangeIndex</span><span class="s2">, </span><span class="s1">IntervalIndex</span><span class="s2">)) </span><span class="s0">and not </span><span class="s2">(</span>
            <span class="s1">type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) </span><span class="s0">is </span><span class="s1">Index </span><span class="s0">and not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">result2 </span><span class="s2">&gt; </span><span class="s1">result</span>

        <span class="s0">if </span><span class="s1">index</span><span class="s2">.</span><span class="s1">inferred_type </span><span class="s2">== </span><span class="s4">&quot;object&quot;</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">result3 </span><span class="s2">&gt; </span><span class="s1">result2</span>

    <span class="s0">def </span><span class="s1">test_argsort</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">CategoricalIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">).</span><span class="s1">__name__</span><span class="s0">} </span><span class="s4">separately tested&quot;</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">index</span><span class="s2">).</span><span class="s1">argsort</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">check_dtype</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_numpy_argsort</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s4">&quot;mergesort&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">=</span><span class="s4">&quot;mergesort&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s5"># these are the only two types that perform</span>
        <span class="s5"># pandas compatibility input validation - the</span>
        <span class="s5"># rest already perform separate (or no) such</span>
        <span class="s5"># validation via their 'values' attribute as</span>
        <span class="s5"># defined in pandas.core.indexes/base.py - they</span>
        <span class="s5"># cannot be changed at the moment due to</span>
        <span class="s5"># backwards compatibility concerns</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, (</span><span class="s1">CategoricalIndex</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">)):</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;the 'axis' parameter is not supported&quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">np</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>

            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;the 'order' parameter is not supported&quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">np</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">order</span><span class="s2">=(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_repeat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s1">rep </span><span class="s2">= </span><span class="s3">2</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">new_index_cls </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_constructor</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">new_index_cls</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">values</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">rep</span><span class="s2">), </span><span class="s1">name</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">rep</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">rep </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">))</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">new_index_cls</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">values</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">rep</span><span class="s2">), </span><span class="s1">name</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">rep</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_numpy_repeat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s1">rep </span><span class="s2">= </span><span class="s3">2</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">rep</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rep</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;the 'axis' parameter is not supported&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">rep</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_where</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">listlike_box</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, (</span><span class="s1">IntervalIndex</span><span class="s2">, </span><span class="s1">PeriodIndex</span><span class="s2">)) </span><span class="s0">or </span><span class="s1">is_numeric_dtype</span><span class="s2">(</span>
            <span class="s1">simple_index</span><span class="s2">.</span><span class="s1">dtype</span>
        <span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere.&quot;</span><span class="s2">)</span>
        <span class="s1">klass </span><span class="s2">= </span><span class="s1">listlike_box</span>

        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, (</span><span class="s1">DatetimeIndex</span><span class="s2">, </span><span class="s1">TimedeltaIndex</span><span class="s2">)):</span>
            <span class="s5"># where does not preserve freq</span>
            <span class="s1">idx </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_with_freq</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>

        <span class="s1">cond </span><span class="s2">= [</span><span class="s0">True</span><span class="s2">] * </span><span class="s1">len</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">klass</span><span class="s2">(</span><span class="s1">cond</span><span class="s2">))</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">idx</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">cond </span><span class="s2">= [</span><span class="s0">False</span><span class="s2">] + [</span><span class="s0">True</span><span class="s2">] * </span><span class="s1">len</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:])</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_na_value</span><span class="s2">] + </span><span class="s1">idx</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:].</span><span class="s1">tolist</span><span class="s2">(), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">klass</span><span class="s2">(</span><span class="s1">cond</span><span class="s2">))</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_insert_base</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s1">trimmed </span><span class="s2">= </span><span class="s1">index</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:</span><span class="s3">4</span><span class="s2">]</span>

        <span class="s0">if not </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Not applicable for empty index&quot;</span><span class="s2">)</span>

        <span class="s5"># test 0th element</span>
        <span class="s1">warn </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">if </span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">object </span><span class="s0">and </span><span class="s1">index</span><span class="s2">.</span><span class="s1">inferred_type </span><span class="s2">== </span><span class="s4">&quot;boolean&quot;</span><span class="s2">:</span>
            <span class="s5"># GH#51363</span>
            <span class="s1">warn </span><span class="s2">= </span><span class="s1">FutureWarning</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;The behavior of Index.insert with object-dtype is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">warn</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">trimmed</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">index</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])</span>
        <span class="s0">assert </span><span class="s1">index</span><span class="s2">[</span><span class="s3">0</span><span class="s2">:</span><span class="s3">4</span><span class="s2">].</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">result</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span>
        <span class="s1">using_pyarrow_string_dtype</span><span class="s2">(),</span>
        <span class="s1">reason</span><span class="s2">=</span><span class="s4">&quot;completely different behavior, tested elsewher&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_insert_out_of_bounds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s5"># TypeError/IndexError matches what np.insert raises in these cases</span>

        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) &gt; </span><span class="s3">0</span><span class="s2">:</span>
            <span class="s1">err </span><span class="s2">= </span><span class="s1">TypeError</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">err </span><span class="s2">= </span><span class="s1">IndexError</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) == </span><span class="s3">0</span><span class="s2">:</span>
            <span class="s5"># 0 vs 0.5 in error message varies with numpy version</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;index (0|0.5) is out of bounds for axis 0 with size 0&quot;</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;slice indices must be integers or None or have an __index__ method&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">index</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s3">0.5</span><span class="s2">, </span><span class="s4">&quot;foo&quot;</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;|&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s4">r&quot;index -?\d+ is out of bounds for axis 0 with size \d+&quot;</span><span class="s2">,</span>
                <span class="s4">&quot;loc must be an integer between&quot;</span><span class="s2">,</span>
            <span class="s2">]</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">index</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) + </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">index</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(-</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) - </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_delete_base</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Not applicable for empty index&quot;</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">):</span>
            <span class="s5"># tested in class</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">).</span><span class="s1">__name__</span><span class="s0">} </span><span class="s4">tested elsewhere&quot;</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">index</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:]</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">delete</span><span class="s2">(</span><span class="s3">0</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">name</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">index</span><span class="s2">[:-</span><span class="s3">1</span><span class="s2">]</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">delete</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">name</span>

        <span class="s1">length </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">f&quot;index </span><span class="s0">{</span><span class="s1">length</span><span class="s0">} </span><span class="s4">is out of bounds for axis 0 with size </span><span class="s0">{</span><span class="s1">length</span><span class="s0">}</span><span class="s4">&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">index</span><span class="s2">.</span><span class="s1">delete</span><span class="s2">(</span><span class="s1">length</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s4">r&quot;ignore:PeriodDtype\[B\] is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_equals</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">IntervalIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">).</span><span class="s1">__name__</span><span class="s0">} </span><span class="s4">tested elsewhere&quot;</span><span class="s2">)</span>

        <span class="s1">is_ea_idx </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) </span><span class="s0">is </span><span class="s1">Index </span><span class="s0">and not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">index</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">index</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">())</span>
        <span class="s0">if not </span><span class="s1">is_ea_idx</span><span class="s2">:</span>
            <span class="s5"># doesn't hold for e.g. IntegerDtype</span>
            <span class="s0">assert </span><span class="s1">index</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">object</span><span class="s2">))</span>

        <span class="s0">assert not </span><span class="s1">index</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))</span>
        <span class="s0">assert not </span><span class="s1">index</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))</span>

        <span class="s5"># Cannot pass in non-int64 dtype to RangeIndex</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">) </span><span class="s0">and not </span><span class="s1">is_ea_idx</span><span class="s2">:</span>
            <span class="s1">same_values </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">index</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">same_values</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">same_values</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">index</span><span class="s2">.</span><span class="s1">nlevels </span><span class="s2">== </span><span class="s3">1</span><span class="s2">:</span>
            <span class="s5"># do not test MultiIndex</span>
            <span class="s0">assert not </span><span class="s1">index</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_equals_op</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH9947, GH10637</span>
        <span class="s1">index_a </span><span class="s2">= </span><span class="s1">simple_index</span>

        <span class="s1">n </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">)</span>
        <span class="s1">index_b </span><span class="s2">= </span><span class="s1">index_a</span><span class="s2">[</span><span class="s3">0</span><span class="s2">:-</span><span class="s3">1</span><span class="s2">]</span>
        <span class="s1">index_c </span><span class="s2">= </span><span class="s1">index_a</span><span class="s2">[</span><span class="s3">0</span><span class="s2">:-</span><span class="s3">1</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">[-</span><span class="s3">2</span><span class="s2">:-</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">index_d </span><span class="s2">= </span><span class="s1">index_a</span><span class="s2">[</span><span class="s3">0</span><span class="s2">:</span><span class="s3">1</span><span class="s2">]</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Lengths must match|could not be broadcast&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">index_a </span><span class="s2">== </span><span class="s1">index_b</span>
        <span class="s1">expected1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">True</span><span class="s2">] * </span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">expected2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">True</span><span class="s2">] * (</span><span class="s1">n </span><span class="s2">- </span><span class="s3">1</span><span class="s2">) + [</span><span class="s0">False</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index_a </span><span class="s2">== </span><span class="s1">index_a</span><span class="s2">, </span><span class="s1">expected1</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index_a </span><span class="s2">== </span><span class="s1">index_c</span><span class="s2">, </span><span class="s1">expected2</span><span class="s2">)</span>

        <span class="s5"># test comparisons with numpy arrays</span>
        <span class="s1">array_a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">)</span>
        <span class="s1">array_b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">[</span><span class="s3">0</span><span class="s2">:-</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">array_c </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">[</span><span class="s3">0</span><span class="s2">:-</span><span class="s3">1</span><span class="s2">].</span><span class="s1">append</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">[-</span><span class="s3">2</span><span class="s2">:-</span><span class="s3">1</span><span class="s2">]))</span>
        <span class="s1">array_d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">[</span><span class="s3">0</span><span class="s2">:</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">index_a </span><span class="s2">== </span><span class="s1">array_b</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index_a </span><span class="s2">== </span><span class="s1">array_a</span><span class="s2">, </span><span class="s1">expected1</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index_a </span><span class="s2">== </span><span class="s1">array_c</span><span class="s2">, </span><span class="s1">expected2</span><span class="s2">)</span>

        <span class="s5"># test comparisons with Series</span>
        <span class="s1">series_a </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">array_a</span><span class="s2">)</span>
        <span class="s1">series_b </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">array_b</span><span class="s2">)</span>
        <span class="s1">series_c </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">array_c</span><span class="s2">)</span>
        <span class="s1">series_d </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">array_d</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">index_a </span><span class="s2">== </span><span class="s1">series_b</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index_a </span><span class="s2">== </span><span class="s1">series_a</span><span class="s2">, </span><span class="s1">expected1</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index_a </span><span class="s2">== </span><span class="s1">series_c</span><span class="s2">, </span><span class="s1">expected2</span><span class="s2">)</span>

        <span class="s5"># cases where length is 1 for one of them</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Lengths must match&quot;</span><span class="s2">):</span>
            <span class="s1">index_a </span><span class="s2">== </span><span class="s1">index_d</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Lengths must match&quot;</span><span class="s2">):</span>
            <span class="s1">index_a </span><span class="s2">== </span><span class="s1">series_d</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Lengths must match&quot;</span><span class="s2">):</span>
            <span class="s1">index_a </span><span class="s2">== </span><span class="s1">array_d</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Can only compare identically-labeled Series objects&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">series_a </span><span class="s2">== </span><span class="s1">series_d</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Lengths must match&quot;</span><span class="s2">):</span>
            <span class="s1">series_a </span><span class="s2">== </span><span class="s1">array_d</span>

        <span class="s5"># comparing with a scalar should broadcast; note that we are excluding</span>
        <span class="s5"># MultiIndex because in this case each item in the index is a tuple of</span>
        <span class="s5"># length 2, and therefore is considered an array of length 2 in the</span>
        <span class="s5"># comparison instead of a scalar</span>
        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">, </span><span class="s1">MultiIndex</span><span class="s2">):</span>
            <span class="s1">expected3 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">False</span><span class="s2">] * (</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index_a</span><span class="s2">) - </span><span class="s3">2</span><span class="s2">) + [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
            <span class="s5"># assuming the 2nd to last item is unique in the data</span>
            <span class="s1">item </span><span class="s2">= </span><span class="s1">index_a</span><span class="s2">[-</span><span class="s3">2</span><span class="s2">]</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index_a </span><span class="s2">== </span><span class="s1">item</span><span class="s2">, </span><span class="s1">expected3</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">series_a </span><span class="s2">== </span><span class="s1">item</span><span class="s2">, </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">expected3</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_format</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH35439</span>
        <span class="s0">if </span><span class="s1">is_numeric_dtype</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">) </span><span class="s0">or </span><span class="s1">isinstance</span><span class="s2">(</span>
            <span class="s1">simple_index</span><span class="s2">, </span><span class="s1">DatetimeIndex</span>
        <span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere.&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">expected </span><span class="s2">= [</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">idx</span><span class="s2">]</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">r&quot;Index\.format is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">format</span><span class="s2">() == </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_format_empty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH35712</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, (</span><span class="s1">PeriodIndex</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">)):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere&quot;</span><span class="s2">)</span>
        <span class="s1">empty_idx </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">)([])</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">r&quot;Index\.format is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">empty_idx</span><span class="s2">.</span><span class="s1">format</span><span class="s2">() == []</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">empty_idx</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s0">True</span><span class="s2">) == [</span><span class="s4">&quot;&quot;</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_fillna</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s5"># GH 11343</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) == </span><span class="s3">0</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Not relevant for empty index&quot;</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">bool</span><span class="s2">:</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s0">} </span><span class="s4">cannot hold NAs&quot;</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">Index</span><span class="s2">) </span><span class="s0">and </span><span class="s1">is_integer_dtype</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">f&quot;Not relevant for Index with </span><span class="s0">{</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">MultiIndex</span><span class="s2">):</span>
            <span class="s1">idx </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">deep</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;isna is not defined for MultiIndex&quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">NotImplementedError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">.</span><span class="s1">fillna</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">idx </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">deep</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">fillna</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">result </span><span class="s0">is not </span><span class="s1">idx</span>

            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;'value' must be a scalar, passed: &quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">.</span><span class="s1">fillna</span><span class="s2">([</span><span class="s1">idx</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]])</span>

            <span class="s1">idx </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">deep</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">values </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_values</span>

            <span class="s1">values</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>

            <span class="s1">idx </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)(</span><span class="s1">values</span><span class="s2">)</span>

            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;does not support 'downcast'&quot;</span>
            <span class="s1">msg2 </span><span class="s2">= </span><span class="s4">r&quot;The 'downcast' keyword in .*Index\.fillna is deprecated&quot;</span>
            <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg2</span><span class="s2">):</span>
                <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">NotImplementedError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                    <span class="s5"># For now at least, we only raise if there are NAs present</span>
                    <span class="s1">idx</span><span class="s2">.</span><span class="s1">fillna</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">downcast</span><span class="s2">=</span><span class="s4">&quot;infer&quot;</span><span class="s2">)</span>

            <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s0">False</span><span class="s2">] * </span><span class="s1">len</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">)</span>
            <span class="s1">expected</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s0">True</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_isnan</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">hasnans </span><span class="s0">is True</span>

    <span class="s0">def </span><span class="s1">test_nulls</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">):</span>
        <span class="s5"># this is really a smoke test for the methods</span>
        <span class="s5"># as these are adequately tested for function elsewhere</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) == </span><span class="s3">0</span><span class="s2">:</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">isna</span><span class="s2">(), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">))</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">MultiIndex</span><span class="s2">):</span>
            <span class="s1">idx </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;isna is not defined for MultiIndex&quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">NotImplementedError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">.</span><span class="s1">isna</span><span class="s2">()</span>
        <span class="s0">elif not </span><span class="s1">index</span><span class="s2">.</span><span class="s1">hasnans</span><span class="s2">:</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">isna</span><span class="s2">(), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">))</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">notna</span><span class="s2">(), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">isna</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">isna</span><span class="s2">(), </span><span class="s1">result</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">notna</span><span class="s2">(), ~</span><span class="s1">result</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_empty</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH 15270</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">assert not </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">empty</span>
        <span class="s0">assert </span><span class="s1">idx</span><span class="s2">[:</span><span class="s3">0</span><span class="s2">].</span><span class="s1">empty</span>

    <span class="s0">def </span><span class="s1">test_join_self_unique</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">join_type</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">if </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">is_unique</span><span class="s2">:</span>
            <span class="s1">joined </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s1">join_type</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">simple_index</span>
            <span class="s0">if </span><span class="s1">join_type </span><span class="s2">== </span><span class="s4">&quot;outer&quot;</span><span class="s2">:</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">algos</span><span class="s2">.</span><span class="s1">safe_sort</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">joined</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_map</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># callable</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, (</span><span class="s1">TimedeltaIndex</span><span class="s2">, </span><span class="s1">PeriodIndex</span><span class="s2">)):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere.&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s5"># RangeIndex are equivalent to the similar Index with int64 dtype</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s4">&quot;equiv&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s4">&quot;mapper&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s0">lambda </span><span class="s1">values</span><span class="s2">, </span><span class="s1">index</span><span class="s2">: {</span><span class="s1">i</span><span class="s2">: </span><span class="s1">e </span><span class="s0">for </span><span class="s1">e</span><span class="s2">, </span><span class="s1">i </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">index</span><span class="s2">)},</span>
            <span class="s0">lambda </span><span class="s1">values</span><span class="s2">, </span><span class="s1">index</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">index</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s4">r&quot;ignore:PeriodDtype\[B\] is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_map_dictlike</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mapper</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">request</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, (</span><span class="s1">DatetimeIndex</span><span class="s2">, </span><span class="s1">TimedeltaIndex</span><span class="s2">, </span><span class="s1">PeriodIndex</span><span class="s2">)):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere.&quot;</span><span class="s2">)</span>

        <span class="s1">identity </span><span class="s2">= </span><span class="s1">mapper</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">identity</span><span class="s2">)</span>
        <span class="s5"># RangeIndex are equivalent to the similar Index with int64 dtype</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s4">&quot;equiv&quot;</span><span class="s2">)</span>

        <span class="s5"># empty mappable</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">if </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">== </span><span class="s4">&quot;f&quot;</span><span class="s2">:</span>
            <span class="s1">dtype </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">dtype</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">] * </span><span class="s1">len</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">mapper</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">))</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_map_str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH 31202</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">CategoricalIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;See test_map.py&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">str</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">idx</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;copy&quot;</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;name&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s4">&quot;foo&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;ordered&quot;</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_astype_category</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">ordered</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH 18630</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">if </span><span class="s1">name</span><span class="s2">:</span>
            <span class="s1">idx </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">rename</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>

        <span class="s5"># standard categories</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s1">CategoricalDtype</span><span class="s2">(</span><span class="s1">ordered</span><span class="s2">=</span><span class="s1">ordered</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s1">copy</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">CategoricalIndex</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">, </span><span class="s1">ordered</span><span class="s2">=</span><span class="s1">ordered</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s5"># non-standard categories</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s1">CategoricalDtype</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">unique</span><span class="s2">().</span><span class="s1">tolist</span><span class="s2">()[:-</span><span class="s3">1</span><span class="s2">], </span><span class="s1">ordered</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s1">copy</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">CategoricalIndex</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">ordered </span><span class="s0">is False</span><span class="s2">:</span>
            <span class="s5"># dtype='category' defaults to ordered=False, so only test once</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s4">&quot;category&quot;</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s1">copy</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">CategoricalIndex</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_is_unique</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># initialize a unique index</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">drop_duplicates</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">index</span><span class="s2">.</span><span class="s1">is_unique </span><span class="s0">is True</span>

        <span class="s5"># empty index should be unique</span>
        <span class="s1">index_empty </span><span class="s2">= </span><span class="s1">index</span><span class="s2">[:</span><span class="s3">0</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">index_empty</span><span class="s2">.</span><span class="s1">is_unique </span><span class="s0">is True</span>

        <span class="s5"># test basic dupes</span>
        <span class="s1">index_dup </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">index</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])</span>
        <span class="s0">assert </span><span class="s1">index_dup</span><span class="s2">.</span><span class="s1">is_unique </span><span class="s0">is False</span>

        <span class="s5"># single NA should be unique</span>
        <span class="s1">index_na </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">index_na</span><span class="s2">.</span><span class="s1">is_unique </span><span class="s0">is True</span>

        <span class="s5"># multiple NA should not be unique</span>
        <span class="s1">index_na_dup </span><span class="s2">= </span><span class="s1">index_na</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">index_na_dup</span><span class="s2">.</span><span class="s1">is_unique </span><span class="s0">is False</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">arm_slow</span>
    <span class="s0">def </span><span class="s1">test_engine_reference_cycle</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH27585</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">ref </span><span class="s2">= </span><span class="s1">weakref</span><span class="s2">.</span><span class="s1">ref</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">index</span><span class="s2">.</span><span class="s1">_engine</span>
        <span class="s0">del </span><span class="s1">index</span>
        <span class="s0">assert </span><span class="s1">ref</span><span class="s2">() </span><span class="s0">is None</span>

    <span class="s0">def </span><span class="s1">test_getitem_2d_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH#30588, GH#31479</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">IntervalIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Multi-dimensional indexing|too many|only&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">((</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">IndexError</span><span class="s2">), </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">[:, </span><span class="s0">None</span><span class="s2">]</span>

        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">):</span>
            <span class="s5"># GH#44051 RangeIndex already raised pre-2.0 with a different message</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">((</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">IndexError</span><span class="s2">), </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">[</span><span class="s0">True</span><span class="s2">]</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">((</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">IndexError</span><span class="s2">), </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">[</span><span class="s0">False</span><span class="s2">]</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;only integers, slices&quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">[</span><span class="s0">True</span><span class="s2">]</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s1">idx</span><span class="s2">[</span><span class="s0">False</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">test_copy_shares_cache</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH32898, GH36840</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])  </span><span class="s5"># populates the _cache.</span>
        <span class="s1">copy </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s0">assert </span><span class="s1">copy</span><span class="s2">.</span><span class="s1">_cache </span><span class="s0">is </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_cache</span>

    <span class="s0">def </span><span class="s1">test_shallow_copy_shares_cache</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH32669, GH36840</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">get_loc</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])  </span><span class="s5"># populates the _cache.</span>
        <span class="s1">shallow_copy </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_view</span><span class="s2">()</span>

        <span class="s0">assert </span><span class="s1">shallow_copy</span><span class="s2">.</span><span class="s1">_cache </span><span class="s0">is </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_cache</span>

        <span class="s1">shallow_copy </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_shallow_copy</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">shallow_copy</span><span class="s2">.</span><span class="s1">_cache </span><span class="s0">is not </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_cache</span>
        <span class="s0">assert </span><span class="s1">shallow_copy</span><span class="s2">.</span><span class="s1">_cache </span><span class="s2">== {}</span>

    <span class="s0">def </span><span class="s1">test_index_groupby</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span><span class="s2">[:</span><span class="s3">5</span><span class="s2">]</span>
        <span class="s1">to_groupby </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_dict_equal</span><span class="s2">(</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">groupby</span><span class="s2">(</span><span class="s1">to_groupby</span><span class="s2">), {</span><span class="s3">1.0</span><span class="s2">: </span><span class="s1">idx</span><span class="s2">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">]], </span><span class="s3">2.0</span><span class="s2">: </span><span class="s1">idx</span><span class="s2">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">]]}</span>
        <span class="s2">)</span>

        <span class="s1">to_groupby </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s1">datetime</span><span class="s2">(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">1</span><span class="s2">),</span>
                <span class="s1">datetime</span><span class="s2">(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">1</span><span class="s2">),</span>
                <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                <span class="s1">datetime</span><span class="s2">(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">12</span><span class="s2">, </span><span class="s3">1</span><span class="s2">),</span>
                <span class="s1">datetime</span><span class="s2">(</span><span class="s3">2011</span><span class="s2">, </span><span class="s3">11</span><span class="s2">, </span><span class="s3">1</span><span class="s2">),</span>
            <span class="s2">],</span>
            <span class="s1">tz</span><span class="s2">=</span><span class="s4">&quot;UTC&quot;</span><span class="s2">,</span>
        <span class="s2">).</span><span class="s1">values</span>

        <span class="s1">ex_keys </span><span class="s2">= [</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2011-11-01&quot;</span><span class="s2">), </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s4">&quot;2011-12-01&quot;</span><span class="s2">)]</span>
        <span class="s1">expected </span><span class="s2">= {</span><span class="s1">ex_keys</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]: </span><span class="s1">idx</span><span class="s2">[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">4</span><span class="s2">]], </span><span class="s1">ex_keys</span><span class="s2">[</span><span class="s3">1</span><span class="s2">]: </span><span class="s1">idx</span><span class="s2">[[</span><span class="s3">1</span><span class="s2">, </span><span class="s3">3</span><span class="s2">]]}</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_dict_equal</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">groupby</span><span class="s2">(</span><span class="s1">to_groupby</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_append_preserves_dtype</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># In particular Index with dtype float32</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">[:</span><span class="s1">N</span><span class="s2">], </span><span class="s1">index</span><span class="s2">, </span><span class="s1">check_exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">[</span><span class="s1">N</span><span class="s2">:], </span><span class="s1">index</span><span class="s2">, </span><span class="s1">check_exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s1">alt </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">take</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)) * </span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">alt</span><span class="s2">, </span><span class="s1">check_exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_inv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">using_infer_string</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>

        <span class="s0">if </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">kind </span><span class="s0">in </span><span class="s2">[</span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;u&quot;</span><span class="s2">]:</span>
            <span class="s1">res </span><span class="s2">= ~</span><span class="s1">idx</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(~</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

            <span class="s5"># check that we are matching Series behavior</span>
            <span class="s1">res2 </span><span class="s2">= ~</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>
            <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">res2</span><span class="s2">, </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">== </span><span class="s4">&quot;f&quot;</span><span class="s2">:</span>
                <span class="s1">err </span><span class="s2">= </span><span class="s1">TypeError</span>
                <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;ufunc 'invert' not supported for the input types&quot;</span>
            <span class="s0">elif </span><span class="s1">using_infer_string </span><span class="s0">and </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s4">&quot;string&quot;</span><span class="s2">:</span>
                <span class="s0">import </span><span class="s1">pyarrow </span><span class="s0">as </span><span class="s1">pa</span>

                <span class="s1">err </span><span class="s2">= </span><span class="s1">pa</span><span class="s2">.</span><span class="s1">lib</span><span class="s2">.</span><span class="s1">ArrowNotImplementedError</span>
                <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;has no kernel&quot;</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">err </span><span class="s2">= </span><span class="s1">TypeError</span>
                <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;bad operand&quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s2">~</span><span class="s1">idx</span>

            <span class="s5"># check that we get the same behavior with Series</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
                <span class="s2">~</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_is_boolean_is_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH50042</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">is_boolean</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_is_floating_is_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH50042</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">is_floating</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_is_integer_is_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH50042</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">is_integer</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_holds_integer_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH50243</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">type</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">).</span><span class="s1">__name__</span><span class="s0">}</span><span class="s4">.holds_integer is deprecated. &quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">holds_integer</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_is_numeric_is_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH50042</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span>
            <span class="s1">FutureWarning</span><span class="s2">,</span>
            <span class="s1">match</span><span class="s2">=</span><span class="s4">f&quot;</span><span class="s0">{</span><span class="s1">type</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">).</span><span class="s1">__name__</span><span class="s0">}</span><span class="s4">.is_numeric is deprecated. &quot;</span><span class="s2">,</span>
        <span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">is_numeric</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_is_categorical_is_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH50042</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span>
            <span class="s1">FutureWarning</span><span class="s2">,</span>
            <span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;Use pandas\.api\.types\.is_categorical_dtype instead&quot;</span><span class="s2">,</span>
        <span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">is_categorical</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_is_interval_is_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH50042</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">is_interval</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_is_object_is_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH50042</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">):</span>
            <span class="s1">idx</span><span class="s2">.</span><span class="s1">is_object</span><span class="s2">()</span>


<span class="s0">class </span><span class="s1">TestNumericBase</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span>
        <span class="s1">params</span><span class="s2">=[</span>
            <span class="s1">RangeIndex</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">stop</span><span class="s2">=</span><span class="s3">20</span><span class="s2">, </span><span class="s1">step</span><span class="s2">=</span><span class="s3">2</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">)),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">),</span>
            <span class="s1">Index</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">),</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">simple_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">request</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>

    <span class="s0">def </span><span class="s1">test_constructor_unwraps_index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere.&quot;</span><span class="s2">)</span>
        <span class="s1">index_cls </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">)</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">dtype</span>

        <span class="s1">idx </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">index_cls</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_can_hold_identifiers</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">key </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_can_hold_identifiers_and_holds_name</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) </span><span class="s0">is False</span>

    <span class="s0">def </span><span class="s1">test_view</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere.&quot;</span><span class="s2">)</span>
        <span class="s1">index_cls </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">)</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">dtype</span>

        <span class="s1">idx </span><span class="s2">= </span><span class="s1">index_cls</span><span class="s2">([], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;Foo&quot;</span><span class="s2">)</span>
        <span class="s1">idx_view </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">view</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">idx_view</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s4">&quot;Foo&quot;</span>

        <span class="s1">idx_view </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">index_cls</span><span class="s2">(</span><span class="s1">idx_view</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;Foo&quot;</span><span class="s2">), </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s4">&quot;Passing a type in .*Index.view is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">idx_view </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s1">index_cls</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">index_cls</span><span class="s2">(</span><span class="s1">idx_view</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s4">&quot;Foo&quot;</span><span class="s2">), </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_format</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH35439</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">DatetimeIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;Tested elsewhere&quot;</span><span class="s2">)</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">max_width </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">idx</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= [</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">).</span><span class="s1">ljust</span><span class="s2">(</span><span class="s1">max_width</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">idx</span><span class="s2">]</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s4">r&quot;Index\.format is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">format</span><span class="s2">() == </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_insert_non_na</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH#43921 inserting an element that we know we can hold should</span>
        <span class="s5">#  not change dtype or type (except for RangeIndex)</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">simple_index</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">index</span><span class="s2">[</span><span class="s3">0</span><span class="s2">])</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s1">index</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]] + </span><span class="s1">list</span><span class="s2">(</span><span class="s1">index</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_insert_na</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">nulls_fixture</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH 18295 (test missing)</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">simple_index</span>
        <span class="s1">na_val </span><span class="s2">= </span><span class="s1">nulls_fixture</span>

        <span class="s0">if </span><span class="s1">na_val </span><span class="s0">is </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s1">index</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">] + </span><span class="s1">list</span><span class="s2">(</span><span class="s1">index</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:]), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">([</span><span class="s1">index</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">] + </span><span class="s1">list</span><span class="s2">(</span><span class="s1">index</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:]))</span>
            <span class="s5"># GH#43921 we preserve float dtype</span>
            <span class="s0">if </span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">== </span><span class="s4">&quot;f&quot;</span><span class="s2">:</span>
                <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">na_val</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_arithmetic_explicit_conversions</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s5"># GH 8608</span>
        <span class="s5"># add/sub are overridden explicitly for Float/Int Index</span>
        <span class="s1">index_cls </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">index_cls </span><span class="s0">is </span><span class="s1">RangeIndex</span><span class="s2">:</span>
            <span class="s1">idx </span><span class="s2">= </span><span class="s1">RangeIndex</span><span class="s2">(</span><span class="s3">5</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">idx </span><span class="s2">= </span><span class="s1">index_cls</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int64&quot;</span><span class="s2">))</span>

        <span class="s5"># float conversions</span>
        <span class="s1">arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;int64&quot;</span><span class="s2">) * </span><span class="s3">3.2</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">fidx </span><span class="s2">= </span><span class="s1">idx </span><span class="s2">* </span><span class="s3">3.2</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">fidx</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s1">fidx </span><span class="s2">= </span><span class="s3">3.2 </span><span class="s2">* </span><span class="s1">idx</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">fidx</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s5"># interops with numpy arrays</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;float64&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">fidx </span><span class="s2">- </span><span class="s1">a</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Index</span><span class="s2">(-</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;float64&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">a </span><span class="s2">- </span><span class="s1">fidx</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;complex_dtype&quot;</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_astype_to_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">complex_dtype</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">complex_dtype</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">result</span><span class="s2">) </span><span class="s0">is </span><span class="s1">Index </span><span class="s0">and </span><span class="s1">result</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">complex_dtype</span>

    <span class="s0">def </span><span class="s1">test_cast_string</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_index</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">, </span><span class="s1">RangeIndex</span><span class="s2">):</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s4">&quot;casting of strings not relevant for RangeIndex&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">)([</span><span class="s4">&quot;0&quot;</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s2">, </span><span class="s4">&quot;2&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">simple_index</span><span class="s2">)([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">simple_index</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
</pre>
</body>
</html>