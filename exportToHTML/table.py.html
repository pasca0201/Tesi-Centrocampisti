<html>
<head>
<title>table.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #2aacb8;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
table.py</font>
</center></td></tr></table>
<pre><span class="s0"># Original code by:</span>
<span class="s0">#    John Gill &lt;jng@europe.renre.com&gt;</span>
<span class="s0">#    Copyright 2004 John Gill and John Hunter</span>
<span class="s0">#</span>
<span class="s0"># Subsequent changes:</span>
<span class="s0">#    The Matplotlib development team</span>
<span class="s0">#    Copyright The Matplotlib development team</span>

<span class="s2">&quot;&quot;&quot; 
Tables drawing. 
 
.. note:: 
    The table implementation in Matplotlib is lightly maintained. For a more 
    featureful table implementation, you may wish to try `blume 
    &lt;https://github.com/swfiua/blume&gt;`_. 
 
Use the factory function `~matplotlib.table.table` to create a ready-made 
table from texts. If you need more control, use the `.Table` class and its 
methods. 
 
The table consists of a grid of cells, which are indexed by (row, column). 
The cell (0, 0) is positioned at the top left. 
 
Thanks to John Gill for providing the class and table. 
&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>

<span class="s3">from </span><span class="s4">. </span><span class="s3">import </span><span class="s1">_api</span><span class="s4">, </span><span class="s1">_docstring</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">artist </span><span class="s3">import </span><span class="s1">Artist</span><span class="s4">, </span><span class="s1">allow_rasterization</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">patches </span><span class="s3">import </span><span class="s1">Rectangle</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">text </span><span class="s3">import </span><span class="s1">Text</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">transforms </span><span class="s3">import </span><span class="s1">Bbox</span>
<span class="s3">from </span><span class="s4">.</span><span class="s1">path </span><span class="s3">import </span><span class="s1">Path</span>


<span class="s3">class </span><span class="s1">Cell</span><span class="s4">(</span><span class="s1">Rectangle</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot; 
    A cell is a `.Rectangle` with some associated `.Text`. 
 
    As a user, you'll most likely not creates cells yourself. Instead, you 
    should use either the `~matplotlib.table.table` factory function or 
    `.Table.add_cell`. 
    &quot;&quot;&quot;</span>

    <span class="s1">PAD </span><span class="s4">= </span><span class="s5">0.1</span>
    <span class="s6">&quot;&quot;&quot;Padding between text and rectangle.&quot;&quot;&quot;</span>

    <span class="s1">_edges </span><span class="s4">= </span><span class="s6">'BRTL'</span>
    <span class="s1">_edge_aliases </span><span class="s4">= {</span><span class="s6">'open'</span><span class="s4">:         </span><span class="s6">''</span><span class="s4">,</span>
                     <span class="s6">'closed'</span><span class="s4">:       </span><span class="s1">_edges</span><span class="s4">,  </span><span class="s0"># default</span>
                     <span class="s6">'horizontal'</span><span class="s4">:   </span><span class="s6">'BT'</span><span class="s4">,</span>
                     <span class="s6">'vertical'</span><span class="s4">:     </span><span class="s6">'RL'</span>
                     <span class="s4">}</span>

    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">xy</span><span class="s4">, </span><span class="s1">width</span><span class="s4">, </span><span class="s1">height</span><span class="s4">, *,</span>
                 <span class="s1">edgecolor</span><span class="s4">=</span><span class="s6">'k'</span><span class="s4">, </span><span class="s1">facecolor</span><span class="s4">=</span><span class="s6">'w'</span><span class="s4">,</span>
                 <span class="s1">fill</span><span class="s4">=</span><span class="s3">True</span><span class="s4">,</span>
                 <span class="s1">text</span><span class="s4">=</span><span class="s6">''</span><span class="s4">,</span>
                 <span class="s1">loc</span><span class="s4">=</span><span class="s6">'right'</span><span class="s4">,</span>
                 <span class="s1">fontproperties</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
                 <span class="s1">visible_edges</span><span class="s4">=</span><span class="s6">'closed'</span><span class="s4">,</span>
                 <span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        xy : 2-tuple 
            The position of the bottom left corner of the cell. 
        width : float 
            The cell width. 
        height : float 
            The cell height. 
        edgecolor : :mpltype:`color`, default: 'k' 
            The color of the cell border. 
        facecolor : :mpltype:`color`, default: 'w' 
            The cell facecolor. 
        fill : bool, default: True 
            Whether the cell background is filled. 
        text : str, optional 
            The cell text. 
        loc : {'right', 'center', 'left'} 
            The alignment of the text within the cell. 
        fontproperties : dict, optional 
            A dict defining the font properties of the text. Supported keys and 
            values are the keyword arguments accepted by `.FontProperties`. 
        visible_edges : {'closed', 'open', 'horizontal', 'vertical'} or \ 
substring of 'BRTL' 
            The cell edges to be drawn with a line: a substring of 'BRTL' 
            (bottom, right, top, left), or one of 'open' (no edges drawn), 
            'closed' (all edges drawn), 'horizontal' (bottom and top), 
            'vertical' (right and left). 
        &quot;&quot;&quot;</span>

        <span class="s0"># Call base</span>
        <span class="s1">super</span><span class="s4">().</span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">xy</span><span class="s4">, </span><span class="s1">width</span><span class="s4">=</span><span class="s1">width</span><span class="s4">, </span><span class="s1">height</span><span class="s4">=</span><span class="s1">height</span><span class="s4">, </span><span class="s1">fill</span><span class="s4">=</span><span class="s1">fill</span><span class="s4">,</span>
                         <span class="s1">edgecolor</span><span class="s4">=</span><span class="s1">edgecolor</span><span class="s4">, </span><span class="s1">facecolor</span><span class="s4">=</span><span class="s1">facecolor</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">set_clip_on</span><span class="s4">(</span><span class="s3">False</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">visible_edges </span><span class="s4">= </span><span class="s1">visible_edges</span>

        <span class="s0"># Create text object</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s4">= </span><span class="s1">loc</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_text </span><span class="s4">= </span><span class="s1">Text</span><span class="s4">(</span><span class="s1">x</span><span class="s4">=</span><span class="s1">xy</span><span class="s4">[</span><span class="s5">0</span><span class="s4">], </span><span class="s1">y</span><span class="s4">=</span><span class="s1">xy</span><span class="s4">[</span><span class="s5">1</span><span class="s4">], </span><span class="s1">clip_on</span><span class="s4">=</span><span class="s3">False</span><span class="s4">,</span>
                          <span class="s1">text</span><span class="s4">=</span><span class="s1">text</span><span class="s4">, </span><span class="s1">fontproperties</span><span class="s4">=</span><span class="s1">fontproperties</span><span class="s4">,</span>
                          <span class="s1">horizontalalignment</span><span class="s4">=</span><span class="s1">loc</span><span class="s4">, </span><span class="s1">verticalalignment</span><span class="s4">=</span><span class="s6">'center'</span><span class="s4">)</span>

    <span class="s4">@</span><span class="s1">_api</span><span class="s4">.</span><span class="s1">rename_parameter</span><span class="s4">(</span><span class="s6">&quot;3.8&quot;</span><span class="s4">, </span><span class="s6">&quot;trans&quot;</span><span class="s4">, </span><span class="s6">&quot;t&quot;</span><span class="s4">)</span>
    <span class="s3">def </span><span class="s1">set_transform</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">t</span><span class="s4">):</span>
        <span class="s1">super</span><span class="s4">().</span><span class="s1">set_transform</span><span class="s4">(</span><span class="s1">t</span><span class="s4">)</span>
        <span class="s0"># the text does not get the transform!</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">def </span><span class="s1">set_figure</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">fig</span><span class="s4">):</span>
        <span class="s1">super</span><span class="s4">().</span><span class="s1">set_figure</span><span class="s4">(</span><span class="s1">fig</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span><span class="s4">.</span><span class="s1">set_figure</span><span class="s4">(</span><span class="s1">fig</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">get_text</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Return the cell `.Text` instance.&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span>

    <span class="s3">def </span><span class="s1">set_fontsize</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">size</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Set the text fontsize.&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span><span class="s4">.</span><span class="s1">set_fontsize</span><span class="s4">(</span><span class="s1">size</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">def </span><span class="s1">get_fontsize</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Return the cell fontsize.&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span><span class="s4">.</span><span class="s1">get_fontsize</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">auto_set_font_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Shrink font size until the text fits into the cell width.&quot;&quot;&quot;</span>
        <span class="s1">fontsize </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_fontsize</span><span class="s4">()</span>
        <span class="s1">required </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_required_width</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
        <span class="s3">while </span><span class="s1">fontsize </span><span class="s4">&gt; </span><span class="s5">1 </span><span class="s3">and </span><span class="s1">required </span><span class="s4">&gt; </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_width</span><span class="s4">():</span>
            <span class="s1">fontsize </span><span class="s4">-= </span><span class="s5">1</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">set_fontsize</span><span class="s4">(</span><span class="s1">fontsize</span><span class="s4">)</span>
            <span class="s1">required </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_required_width</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>

        <span class="s3">return </span><span class="s1">fontsize</span>

    <span class="s4">@</span><span class="s1">allow_rasterization</span>
    <span class="s3">def </span><span class="s1">draw</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_visible</span><span class="s4">():</span>
            <span class="s3">return</span>
        <span class="s0"># draw the rectangle</span>
        <span class="s1">super</span><span class="s4">().</span><span class="s1">draw</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
        <span class="s0"># position the text</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_set_text_position</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span><span class="s4">.</span><span class="s1">draw</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">False</span>

    <span class="s3">def </span><span class="s1">_set_text_position</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Set text up so it is drawn in the right place.&quot;&quot;&quot;</span>
        <span class="s1">bbox </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_window_extent</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
        <span class="s0"># center vertically</span>
        <span class="s1">y </span><span class="s4">= </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">y0 </span><span class="s4">+ </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">height </span><span class="s4">/ </span><span class="s5">2</span>
        <span class="s0"># position horizontally</span>
        <span class="s1">loc </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span><span class="s4">.</span><span class="s1">get_horizontalalignment</span><span class="s4">()</span>
        <span class="s3">if </span><span class="s1">loc </span><span class="s4">== </span><span class="s6">'center'</span><span class="s4">:</span>
            <span class="s1">x </span><span class="s4">= </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">x0 </span><span class="s4">+ </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">width </span><span class="s4">/ </span><span class="s5">2</span>
        <span class="s3">elif </span><span class="s1">loc </span><span class="s4">== </span><span class="s6">'left'</span><span class="s4">:</span>
            <span class="s1">x </span><span class="s4">= </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">x0 </span><span class="s4">+ </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">width </span><span class="s4">* </span><span class="s1">self</span><span class="s4">.</span><span class="s1">PAD</span>
        <span class="s3">else</span><span class="s4">:  </span><span class="s0"># right.</span>
            <span class="s1">x </span><span class="s4">= </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">x0 </span><span class="s4">+ </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">width </span><span class="s4">* (</span><span class="s5">1 </span><span class="s4">- </span><span class="s1">self</span><span class="s4">.</span><span class="s1">PAD</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span><span class="s4">.</span><span class="s1">set_position</span><span class="s4">((</span><span class="s1">x</span><span class="s4">, </span><span class="s1">y</span><span class="s4">))</span>

    <span class="s3">def </span><span class="s1">get_text_bounds</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Return the text bounds as *(x, y, width, height)* in table coordinates. 
        &quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span><span class="s4">.</span><span class="s1">get_window_extent</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
                <span class="s4">.</span><span class="s1">transformed</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_data_transform</span><span class="s4">().</span><span class="s1">inverted</span><span class="s4">())</span>
                <span class="s4">.</span><span class="s1">bounds</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">get_required_width</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Return the minimal required width for the cell.&quot;&quot;&quot;</span>
        <span class="s1">l</span><span class="s4">, </span><span class="s1">b</span><span class="s4">, </span><span class="s1">w</span><span class="s4">, </span><span class="s1">h </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_text_bounds</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
        <span class="s3">return </span><span class="s1">w </span><span class="s4">* (</span><span class="s5">1.0 </span><span class="s4">+ (</span><span class="s5">2.0 </span><span class="s4">* </span><span class="s1">self</span><span class="s4">.</span><span class="s1">PAD</span><span class="s4">))</span>

    <span class="s4">@</span><span class="s1">_docstring</span><span class="s4">.</span><span class="s1">dedent_interpd</span>
    <span class="s3">def </span><span class="s1">set_text_props</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Update the text properties. 
 
        Valid keyword arguments are: 
 
        %(Text:kwdoc)s 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_text</span><span class="s4">.</span><span class="s1">_internal_update</span><span class="s4">(</span><span class="s1">kwargs</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">visible_edges</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        The cell edges to be drawn with a line. 
 
        Reading this property returns a substring of 'BRTL' (bottom, right, 
        top, left'). 
 
        When setting this property, you can use a substring of 'BRTL' or one 
        of {'open', 'closed', 'horizontal', 'vertical'}. 
        &quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_visible_edges</span>

    <span class="s4">@</span><span class="s1">visible_edges</span><span class="s4">.</span><span class="s1">setter</span>
    <span class="s3">def </span><span class="s1">visible_edges</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">value</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">value </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_visible_edges </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_edges</span>
        <span class="s3">elif </span><span class="s1">value </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_edge_aliases</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_visible_edges </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_edge_aliases</span><span class="s4">[</span><span class="s1">value</span><span class="s4">]</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">any</span><span class="s4">(</span><span class="s1">edge </span><span class="s3">not in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_edges </span><span class="s3">for </span><span class="s1">edge </span><span class="s3">in </span><span class="s1">value</span><span class="s4">):</span>
                <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">'Invalid edge param {}, must only be one of '</span>
                                 <span class="s6">'{} or string of {}'</span><span class="s4">.</span><span class="s1">format</span><span class="s4">(</span>
                                     <span class="s1">value</span><span class="s4">,</span>
                                     <span class="s6">&quot;, &quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_edge_aliases</span><span class="s4">),</span>
                                     <span class="s6">&quot;, &quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_edges</span><span class="s4">)))</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_visible_edges </span><span class="s4">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">def </span><span class="s1">get_path</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Return a `.Path` for the `.visible_edges`.&quot;&quot;&quot;</span>
        <span class="s1">codes </span><span class="s4">= [</span><span class="s1">Path</span><span class="s4">.</span><span class="s1">MOVETO</span><span class="s4">]</span>
        <span class="s1">codes</span><span class="s4">.</span><span class="s1">extend</span><span class="s4">(</span>
            <span class="s1">Path</span><span class="s4">.</span><span class="s1">LINETO </span><span class="s3">if </span><span class="s1">edge </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_visible_edges </span><span class="s3">else </span><span class="s1">Path</span><span class="s4">.</span><span class="s1">MOVETO</span>
            <span class="s3">for </span><span class="s1">edge </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_edges</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">Path</span><span class="s4">.</span><span class="s1">MOVETO </span><span class="s3">not in </span><span class="s1">codes</span><span class="s4">[</span><span class="s5">1</span><span class="s4">:]:  </span><span class="s0"># All sides are visible</span>
            <span class="s1">codes</span><span class="s4">[-</span><span class="s5">1</span><span class="s4">] = </span><span class="s1">Path</span><span class="s4">.</span><span class="s1">CLOSEPOLY</span>
        <span class="s3">return </span><span class="s1">Path</span><span class="s4">(</span>
            <span class="s4">[[</span><span class="s5">0.0</span><span class="s4">, </span><span class="s5">0.0</span><span class="s4">], [</span><span class="s5">1.0</span><span class="s4">, </span><span class="s5">0.0</span><span class="s4">], [</span><span class="s5">1.0</span><span class="s4">, </span><span class="s5">1.0</span><span class="s4">], [</span><span class="s5">0.0</span><span class="s4">, </span><span class="s5">1.0</span><span class="s4">], [</span><span class="s5">0.0</span><span class="s4">, </span><span class="s5">0.0</span><span class="s4">]],</span>
            <span class="s1">codes</span><span class="s4">,</span>
            <span class="s1">readonly</span><span class="s4">=</span><span class="s3">True</span>
            <span class="s4">)</span>


<span class="s1">CustomCell </span><span class="s4">= </span><span class="s1">Cell  </span><span class="s0"># Backcompat. alias.</span>


<span class="s3">class </span><span class="s1">Table</span><span class="s4">(</span><span class="s1">Artist</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot; 
    A table of cells. 
 
    The table consists of a grid of cells, which are indexed by (row, column). 
 
    For a simple table, you'll have a full grid of cells with indices from 
    (0, 0) to (num_rows-1, num_cols-1), in which the cell (0, 0) is positioned 
    at the top left. However, you can also add cells with negative indices. 
    You don't have to add a cell to every grid position, so you can create 
    tables that have holes. 
 
    *Note*: You'll usually not create an empty table from scratch. Instead use 
    `~matplotlib.table.table` to create a table from data. 
    &quot;&quot;&quot;</span>
    <span class="s1">codes </span><span class="s4">= {</span><span class="s6">'best'</span><span class="s4">: </span><span class="s5">0</span><span class="s4">,</span>
             <span class="s6">'upper right'</span><span class="s4">:  </span><span class="s5">1</span><span class="s4">,  </span><span class="s0"># default</span>
             <span class="s6">'upper left'</span><span class="s4">:   </span><span class="s5">2</span><span class="s4">,</span>
             <span class="s6">'lower left'</span><span class="s4">:   </span><span class="s5">3</span><span class="s4">,</span>
             <span class="s6">'lower right'</span><span class="s4">:  </span><span class="s5">4</span><span class="s4">,</span>
             <span class="s6">'center left'</span><span class="s4">:  </span><span class="s5">5</span><span class="s4">,</span>
             <span class="s6">'center right'</span><span class="s4">: </span><span class="s5">6</span><span class="s4">,</span>
             <span class="s6">'lower center'</span><span class="s4">: </span><span class="s5">7</span><span class="s4">,</span>
             <span class="s6">'upper center'</span><span class="s4">: </span><span class="s5">8</span><span class="s4">,</span>
             <span class="s6">'center'</span><span class="s4">:       </span><span class="s5">9</span><span class="s4">,</span>
             <span class="s6">'top right'</span><span class="s4">:    </span><span class="s5">10</span><span class="s4">,</span>
             <span class="s6">'top left'</span><span class="s4">:     </span><span class="s5">11</span><span class="s4">,</span>
             <span class="s6">'bottom left'</span><span class="s4">:  </span><span class="s5">12</span><span class="s4">,</span>
             <span class="s6">'bottom right'</span><span class="s4">: </span><span class="s5">13</span><span class="s4">,</span>
             <span class="s6">'right'</span><span class="s4">:        </span><span class="s5">14</span><span class="s4">,</span>
             <span class="s6">'left'</span><span class="s4">:         </span><span class="s5">15</span><span class="s4">,</span>
             <span class="s6">'top'</span><span class="s4">:          </span><span class="s5">16</span><span class="s4">,</span>
             <span class="s6">'bottom'</span><span class="s4">:       </span><span class="s5">17</span><span class="s4">,</span>
             <span class="s4">}</span>
    <span class="s6">&quot;&quot;&quot;Possible values where to place the table relative to the Axes.&quot;&quot;&quot;</span>

    <span class="s1">FONTSIZE </span><span class="s4">= </span><span class="s5">10</span>

    <span class="s1">AXESPAD </span><span class="s4">= </span><span class="s5">0.02</span>
    <span class="s6">&quot;&quot;&quot;The border between the Axes and the table edge in Axes units.&quot;&quot;&quot;</span>

    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">ax</span><span class="s4">, </span><span class="s1">loc</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">bbox</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        ax : `~matplotlib.axes.Axes` 
            The `~.axes.Axes` to plot the table into. 
        loc : str, optional 
            The position of the cell with respect to *ax*. This must be one of 
            the `~.Table.codes`. 
        bbox : `.Bbox` or [xmin, ymin, width, height], optional 
            A bounding box to draw the table into. If this is not *None*, this 
            overrides *loc*. 
 
        Other Parameters 
        ---------------- 
        **kwargs 
            `.Artist` properties. 
        &quot;&quot;&quot;</span>

        <span class="s1">super</span><span class="s4">().</span><span class="s1">__init__</span><span class="s4">()</span>

        <span class="s3">if </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">loc</span><span class="s4">, </span><span class="s1">str</span><span class="s4">):</span>
            <span class="s3">if </span><span class="s1">loc </span><span class="s3">not in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">codes</span><span class="s4">:</span>
                <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span>
                    <span class="s6">&quot;Unrecognized location {!r}. Valid locations are</span><span class="s3">\n\t</span><span class="s6">{}&quot;</span>
                    <span class="s4">.</span><span class="s1">format</span><span class="s4">(</span><span class="s1">loc</span><span class="s4">, </span><span class="s6">'</span><span class="s3">\n\t</span><span class="s6">'</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">codes</span><span class="s4">)))</span>
            <span class="s1">loc </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">codes</span><span class="s4">[</span><span class="s1">loc</span><span class="s4">]</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">set_figure</span><span class="s4">(</span><span class="s1">ax</span><span class="s4">.</span><span class="s1">figure</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_axes </span><span class="s4">= </span><span class="s1">ax</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s4">= </span><span class="s1">loc</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_bbox </span><span class="s4">= </span><span class="s1">bbox</span>

        <span class="s0"># use axes coords</span>
        <span class="s1">ax</span><span class="s4">.</span><span class="s1">_unstale_viewLim</span><span class="s4">()</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">set_transform</span><span class="s4">(</span><span class="s1">ax</span><span class="s4">.</span><span class="s1">transAxes</span><span class="s4">)</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_cells </span><span class="s4">= {}</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_edges </span><span class="s4">= </span><span class="s3">None</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_autoColumns </span><span class="s4">= []</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_autoFontsize </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_internal_update</span><span class="s4">(</span><span class="s1">kwargs</span><span class="s4">)</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">set_clip_on</span><span class="s4">(</span><span class="s3">False</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">add_cell</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">row</span><span class="s4">, </span><span class="s1">col</span><span class="s4">, *</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Create a cell and add it to the table. 
 
        Parameters 
        ---------- 
        row : int 
            Row index. 
        col : int 
            Column index. 
        *args, **kwargs 
            All other parameters are passed on to `Cell`. 
 
        Returns 
        ------- 
        `.Cell` 
            The created cell. 
 
        &quot;&quot;&quot;</span>
        <span class="s1">xy </span><span class="s4">= (</span><span class="s5">0</span><span class="s4">, </span><span class="s5">0</span><span class="s4">)</span>
        <span class="s1">cell </span><span class="s4">= </span><span class="s1">Cell</span><span class="s4">(</span><span class="s1">xy</span><span class="s4">, </span><span class="s1">visible_edges</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">edges</span><span class="s4">, *</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">[</span><span class="s1">row</span><span class="s4">, </span><span class="s1">col</span><span class="s4">] = </span><span class="s1">cell</span>
        <span class="s3">return </span><span class="s1">cell</span>

    <span class="s3">def </span><span class="s1">__setitem__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">position</span><span class="s4">, </span><span class="s1">cell</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Set a custom cell in a given position. 
        &quot;&quot;&quot;</span>
        <span class="s1">_api</span><span class="s4">.</span><span class="s1">check_isinstance</span><span class="s4">(</span><span class="s1">Cell</span><span class="s4">, </span><span class="s1">cell</span><span class="s4">=</span><span class="s1">cell</span><span class="s4">)</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">row</span><span class="s4">, </span><span class="s1">col </span><span class="s4">= </span><span class="s1">position</span><span class="s4">[</span><span class="s5">0</span><span class="s4">], </span><span class="s1">position</span><span class="s4">[</span><span class="s5">1</span><span class="s4">]</span>
        <span class="s3">except </span><span class="s1">Exception </span><span class="s3">as </span><span class="s1">err</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">KeyError</span><span class="s4">(</span><span class="s6">'Only tuples length 2 are accepted as '</span>
                           <span class="s6">'coordinates'</span><span class="s4">) </span><span class="s3">from </span><span class="s1">err</span>
        <span class="s1">cell</span><span class="s4">.</span><span class="s1">set_figure</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">figure</span><span class="s4">)</span>
        <span class="s1">cell</span><span class="s4">.</span><span class="s1">set_transform</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_transform</span><span class="s4">())</span>
        <span class="s1">cell</span><span class="s4">.</span><span class="s1">set_clip_on</span><span class="s4">(</span><span class="s3">False</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">[</span><span class="s1">row</span><span class="s4">, </span><span class="s1">col</span><span class="s4">] = </span><span class="s1">cell</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">def </span><span class="s1">__getitem__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">position</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Retrieve a custom cell from a given position.&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">[</span><span class="s1">position</span><span class="s4">]</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">edges</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        The default value of `~.Cell.visible_edges` for newly added 
        cells using `.add_cell`. 
 
        Notes 
        ----- 
        This setting does currently only affect newly created cells using 
        `.add_cell`. 
 
        To change existing cells, you have to set their edges explicitly:: 
 
            for c in tab.get_celld().values(): 
                c.visible_edges = 'horizontal' 
 
        &quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_edges</span>

    <span class="s4">@</span><span class="s1">edges</span><span class="s4">.</span><span class="s1">setter</span>
    <span class="s3">def </span><span class="s1">edges</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">value</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_edges </span><span class="s4">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">def </span><span class="s1">_approx_text_height</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">FONTSIZE </span><span class="s4">/ </span><span class="s5">72.0 </span><span class="s4">* </span><span class="s1">self</span><span class="s4">.</span><span class="s1">figure</span><span class="s4">.</span><span class="s1">dpi </span><span class="s4">/</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">_axes</span><span class="s4">.</span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">height </span><span class="s4">* </span><span class="s5">1.2</span><span class="s4">)</span>

    <span class="s4">@</span><span class="s1">allow_rasterization</span>
    <span class="s3">def </span><span class="s1">draw</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s0"># docstring inherited</span>

        <span class="s0"># Need a renderer to do hit tests on mouseevent; assume the last one</span>
        <span class="s0"># will do</span>
        <span class="s3">if </span><span class="s1">renderer </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s1">renderer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">figure</span><span class="s4">.</span><span class="s1">_get_renderer</span><span class="s4">()</span>
        <span class="s3">if </span><span class="s1">renderer </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">RuntimeError</span><span class="s4">(</span><span class="s6">'No renderer defined'</span><span class="s4">)</span>

        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_visible</span><span class="s4">():</span>
            <span class="s3">return</span>
        <span class="s1">renderer</span><span class="s4">.</span><span class="s1">open_group</span><span class="s4">(</span><span class="s6">'table'</span><span class="s4">, </span><span class="s1">gid</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_gid</span><span class="s4">())</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_update_positions</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>

        <span class="s3">for </span><span class="s1">key </span><span class="s3">in </span><span class="s1">sorted</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">[</span><span class="s1">key</span><span class="s4">].</span><span class="s1">draw</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>

        <span class="s1">renderer</span><span class="s4">.</span><span class="s1">close_group</span><span class="s4">(</span><span class="s6">'table'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">False</span>

    <span class="s3">def </span><span class="s1">_get_grid_bbox</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Get a bbox, in axes coordinates for the cells. 
 
        Only include those in the range (0, 0) to (maxRow, maxCol). 
        &quot;&quot;&quot;</span>
        <span class="s1">boxes </span><span class="s4">= [</span><span class="s1">cell</span><span class="s4">.</span><span class="s1">get_window_extent</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
                 <span class="s3">for </span><span class="s4">(</span><span class="s1">row</span><span class="s4">, </span><span class="s1">col</span><span class="s4">), </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">items</span><span class="s4">()</span>
                 <span class="s3">if </span><span class="s1">row </span><span class="s4">&gt;= </span><span class="s5">0 </span><span class="s3">and </span><span class="s1">col </span><span class="s4">&gt;= </span><span class="s5">0</span><span class="s4">]</span>
        <span class="s1">bbox </span><span class="s4">= </span><span class="s1">Bbox</span><span class="s4">.</span><span class="s1">union</span><span class="s4">(</span><span class="s1">boxes</span><span class="s4">)</span>
        <span class="s3">return </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">transformed</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_transform</span><span class="s4">().</span><span class="s1">inverted</span><span class="s4">())</span>

    <span class="s3">def </span><span class="s1">contains</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">mouseevent</span><span class="s4">):</span>
        <span class="s0"># docstring inherited</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_different_canvas</span><span class="s4">(</span><span class="s1">mouseevent</span><span class="s4">):</span>
            <span class="s3">return False</span><span class="s4">, {}</span>
        <span class="s0"># TODO: Return index of the cell containing the cursor so that the user</span>
        <span class="s0"># doesn't have to bind to each one individually.</span>
        <span class="s1">renderer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">figure</span><span class="s4">.</span><span class="s1">_get_renderer</span><span class="s4">()</span>
        <span class="s3">if </span><span class="s1">renderer </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s1">boxes </span><span class="s4">= [</span><span class="s1">cell</span><span class="s4">.</span><span class="s1">get_window_extent</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
                     <span class="s3">for </span><span class="s4">(</span><span class="s1">row</span><span class="s4">, </span><span class="s1">col</span><span class="s4">), </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">items</span><span class="s4">()</span>
                     <span class="s3">if </span><span class="s1">row </span><span class="s4">&gt;= </span><span class="s5">0 </span><span class="s3">and </span><span class="s1">col </span><span class="s4">&gt;= </span><span class="s5">0</span><span class="s4">]</span>
            <span class="s1">bbox </span><span class="s4">= </span><span class="s1">Bbox</span><span class="s4">.</span><span class="s1">union</span><span class="s4">(</span><span class="s1">boxes</span><span class="s4">)</span>
            <span class="s3">return </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">contains</span><span class="s4">(</span><span class="s1">mouseevent</span><span class="s4">.</span><span class="s1">x</span><span class="s4">, </span><span class="s1">mouseevent</span><span class="s4">.</span><span class="s1">y</span><span class="s4">), {}</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return False</span><span class="s4">, {}</span>

    <span class="s3">def </span><span class="s1">get_children</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Return the Artists contained by the table.&quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">list</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">values</span><span class="s4">())</span>

    <span class="s3">def </span><span class="s1">get_window_extent</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
        <span class="s0"># docstring inherited</span>
        <span class="s3">if </span><span class="s1">renderer </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s1">renderer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">figure</span><span class="s4">.</span><span class="s1">_get_renderer</span><span class="s4">()</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_update_positions</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
        <span class="s1">boxes </span><span class="s4">= [</span><span class="s1">cell</span><span class="s4">.</span><span class="s1">get_window_extent</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
                 <span class="s3">for </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">values</span><span class="s4">()]</span>
        <span class="s3">return </span><span class="s1">Bbox</span><span class="s4">.</span><span class="s1">union</span><span class="s4">(</span><span class="s1">boxes</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_do_cell_alignment</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Calculate row heights and column widths; position cells accordingly. 
        &quot;&quot;&quot;</span>
        <span class="s0"># Calculate row/column widths</span>
        <span class="s1">widths </span><span class="s4">= {}</span>
        <span class="s1">heights </span><span class="s4">= {}</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s1">row</span><span class="s4">, </span><span class="s1">col</span><span class="s4">), </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">items</span><span class="s4">():</span>
            <span class="s1">height </span><span class="s4">= </span><span class="s1">heights</span><span class="s4">.</span><span class="s1">setdefault</span><span class="s4">(</span><span class="s1">row</span><span class="s4">, </span><span class="s5">0.0</span><span class="s4">)</span>
            <span class="s1">heights</span><span class="s4">[</span><span class="s1">row</span><span class="s4">] = </span><span class="s1">max</span><span class="s4">(</span><span class="s1">height</span><span class="s4">, </span><span class="s1">cell</span><span class="s4">.</span><span class="s1">get_height</span><span class="s4">())</span>
            <span class="s1">width </span><span class="s4">= </span><span class="s1">widths</span><span class="s4">.</span><span class="s1">setdefault</span><span class="s4">(</span><span class="s1">col</span><span class="s4">, </span><span class="s5">0.0</span><span class="s4">)</span>
            <span class="s1">widths</span><span class="s4">[</span><span class="s1">col</span><span class="s4">] = </span><span class="s1">max</span><span class="s4">(</span><span class="s1">width</span><span class="s4">, </span><span class="s1">cell</span><span class="s4">.</span><span class="s1">get_width</span><span class="s4">())</span>

        <span class="s0"># work out left position for each column</span>
        <span class="s1">xpos </span><span class="s4">= </span><span class="s5">0</span>
        <span class="s1">lefts </span><span class="s4">= {}</span>
        <span class="s3">for </span><span class="s1">col </span><span class="s3">in </span><span class="s1">sorted</span><span class="s4">(</span><span class="s1">widths</span><span class="s4">):</span>
            <span class="s1">lefts</span><span class="s4">[</span><span class="s1">col</span><span class="s4">] = </span><span class="s1">xpos</span>
            <span class="s1">xpos </span><span class="s4">+= </span><span class="s1">widths</span><span class="s4">[</span><span class="s1">col</span><span class="s4">]</span>

        <span class="s1">ypos </span><span class="s4">= </span><span class="s5">0</span>
        <span class="s1">bottoms </span><span class="s4">= {}</span>
        <span class="s3">for </span><span class="s1">row </span><span class="s3">in </span><span class="s1">sorted</span><span class="s4">(</span><span class="s1">heights</span><span class="s4">, </span><span class="s1">reverse</span><span class="s4">=</span><span class="s3">True</span><span class="s4">):</span>
            <span class="s1">bottoms</span><span class="s4">[</span><span class="s1">row</span><span class="s4">] = </span><span class="s1">ypos</span>
            <span class="s1">ypos </span><span class="s4">+= </span><span class="s1">heights</span><span class="s4">[</span><span class="s1">row</span><span class="s4">]</span>

        <span class="s0"># set cell positions</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s1">row</span><span class="s4">, </span><span class="s1">col</span><span class="s4">), </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">items</span><span class="s4">():</span>
            <span class="s1">cell</span><span class="s4">.</span><span class="s1">set_x</span><span class="s4">(</span><span class="s1">lefts</span><span class="s4">[</span><span class="s1">col</span><span class="s4">])</span>
            <span class="s1">cell</span><span class="s4">.</span><span class="s1">set_y</span><span class="s4">(</span><span class="s1">bottoms</span><span class="s4">[</span><span class="s1">row</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">auto_set_column_width</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">col</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Automatically set the widths of given columns to optimal sizes. 
 
        Parameters 
        ---------- 
        col : int or sequence of ints 
            The indices of the columns to auto-scale. 
        &quot;&quot;&quot;</span>
        <span class="s1">col1d </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">atleast_1d</span><span class="s4">(</span><span class="s1">col</span><span class="s4">)</span>
        <span class="s3">if not </span><span class="s1">np</span><span class="s4">.</span><span class="s1">issubdtype</span><span class="s4">(</span><span class="s1">col1d</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">integer</span><span class="s4">):</span>
            <span class="s1">_api</span><span class="s4">.</span><span class="s1">warn_deprecated</span><span class="s4">(</span><span class="s6">&quot;3.8&quot;</span><span class="s4">, </span><span class="s1">name</span><span class="s4">=</span><span class="s6">&quot;col&quot;</span><span class="s4">,</span>
                                 <span class="s1">message</span><span class="s4">=</span><span class="s6">&quot;%(name)r must be an int or sequence of ints. &quot;</span>
                                 <span class="s6">&quot;Passing other types is deprecated since %(since)s &quot;</span>
                                 <span class="s6">&quot;and will be removed %(removal)s.&quot;</span><span class="s4">)</span>
            <span class="s3">return</span>
        <span class="s3">for </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">col1d</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_autoColumns</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">cell</span><span class="s4">)</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">def </span><span class="s1">_auto_set_column_width</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">col</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Automatically set width for column.&quot;&quot;&quot;</span>
        <span class="s1">cells </span><span class="s4">= [</span><span class="s1">cell </span><span class="s3">for </span><span class="s1">key</span><span class="s4">, </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">items</span><span class="s4">() </span><span class="s3">if </span><span class="s1">key</span><span class="s4">[</span><span class="s5">1</span><span class="s4">] == </span><span class="s1">col</span><span class="s4">]</span>
        <span class="s1">max_width </span><span class="s4">= </span><span class="s1">max</span><span class="s4">((</span><span class="s1">cell</span><span class="s4">.</span><span class="s1">get_required_width</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">) </span><span class="s3">for </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">cells</span><span class="s4">),</span>
                        <span class="s1">default</span><span class="s4">=</span><span class="s5">0</span><span class="s4">)</span>
        <span class="s3">for </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">cells</span><span class="s4">:</span>
            <span class="s1">cell</span><span class="s4">.</span><span class="s1">set_width</span><span class="s4">(</span><span class="s1">max_width</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">auto_set_font_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">value</span><span class="s4">=</span><span class="s3">True</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Automatically set font size.&quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_autoFontsize </span><span class="s4">= </span><span class="s1">value</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">def </span><span class="s1">_auto_set_font_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>

        <span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">) == </span><span class="s5">0</span><span class="s4">:</span>
            <span class="s3">return</span>
        <span class="s1">fontsize </span><span class="s4">= </span><span class="s1">next</span><span class="s4">(</span><span class="s1">iter</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">values</span><span class="s4">())).</span><span class="s1">get_fontsize</span><span class="s4">()</span>
        <span class="s1">cells </span><span class="s4">= []</span>
        <span class="s3">for </span><span class="s1">key</span><span class="s4">, </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">items</span><span class="s4">():</span>
            <span class="s0"># ignore auto-sized columns</span>
            <span class="s3">if </span><span class="s1">key</span><span class="s4">[</span><span class="s5">1</span><span class="s4">] </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_autoColumns</span><span class="s4">:</span>
                <span class="s3">continue</span>
            <span class="s1">size </span><span class="s4">= </span><span class="s1">cell</span><span class="s4">.</span><span class="s1">auto_set_font_size</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
            <span class="s1">fontsize </span><span class="s4">= </span><span class="s1">min</span><span class="s4">(</span><span class="s1">fontsize</span><span class="s4">, </span><span class="s1">size</span><span class="s4">)</span>
            <span class="s1">cells</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">cell</span><span class="s4">)</span>

        <span class="s0"># now set all fontsizes equal</span>
        <span class="s3">for </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">values</span><span class="s4">():</span>
            <span class="s1">cell</span><span class="s4">.</span><span class="s1">set_fontsize</span><span class="s4">(</span><span class="s1">fontsize</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">scale</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">xscale</span><span class="s4">, </span><span class="s1">yscale</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Scale column widths by *xscale* and row heights by *yscale*.&quot;&quot;&quot;</span>
        <span class="s3">for </span><span class="s1">c </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">values</span><span class="s4">():</span>
            <span class="s1">c</span><span class="s4">.</span><span class="s1">set_width</span><span class="s4">(</span><span class="s1">c</span><span class="s4">.</span><span class="s1">get_width</span><span class="s4">() * </span><span class="s1">xscale</span><span class="s4">)</span>
            <span class="s1">c</span><span class="s4">.</span><span class="s1">set_height</span><span class="s4">(</span><span class="s1">c</span><span class="s4">.</span><span class="s1">get_height</span><span class="s4">() * </span><span class="s1">yscale</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">set_fontsize</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">size</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; 
        Set the font size, in points, of the cell text. 
 
        Parameters 
        ---------- 
        size : float 
 
        Notes 
        ----- 
        As long as auto font size has not been disabled, the value will be 
        clipped such that the text fits horizontally into the cell. 
 
        You can disable this behavior using `.auto_set_font_size`. 
 
        &gt;&gt;&gt; the_table.auto_set_font_size(False) 
        &gt;&gt;&gt; the_table.set_fontsize(20) 
 
        However, there is no automatic scaling of the row height so that the 
        text may exceed the cell boundary. 
        &quot;&quot;&quot;</span>
        <span class="s3">for </span><span class="s1">cell </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">values</span><span class="s4">():</span>
            <span class="s1">cell</span><span class="s4">.</span><span class="s1">set_fontsize</span><span class="s4">(</span><span class="s1">size</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">stale </span><span class="s4">= </span><span class="s3">True</span>

    <span class="s3">def </span><span class="s1">_offset</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">ox</span><span class="s4">, </span><span class="s1">oy</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Move all the artists by ox, oy (axes coords).&quot;&quot;&quot;</span>
        <span class="s3">for </span><span class="s1">c </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span><span class="s4">.</span><span class="s1">values</span><span class="s4">():</span>
            <span class="s1">x</span><span class="s4">, </span><span class="s1">y </span><span class="s4">= </span><span class="s1">c</span><span class="s4">.</span><span class="s1">get_x</span><span class="s4">(), </span><span class="s1">c</span><span class="s4">.</span><span class="s1">get_y</span><span class="s4">()</span>
            <span class="s1">c</span><span class="s4">.</span><span class="s1">set_x</span><span class="s4">(</span><span class="s1">x </span><span class="s4">+ </span><span class="s1">ox</span><span class="s4">)</span>
            <span class="s1">c</span><span class="s4">.</span><span class="s1">set_y</span><span class="s4">(</span><span class="s1">y </span><span class="s4">+ </span><span class="s1">oy</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_update_positions</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">):</span>
        <span class="s0"># called from renderer to allow more precise estimates of</span>
        <span class="s0"># widths and heights with get_window_extent</span>

        <span class="s0"># Do any auto width setting</span>
        <span class="s3">for </span><span class="s1">col </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_autoColumns</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_auto_set_column_width</span><span class="s4">(</span><span class="s1">col</span><span class="s4">, </span><span class="s1">renderer</span><span class="s4">)</span>

        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_autoFontsize</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_auto_set_font_size</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>

        <span class="s0"># Align all the cells</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_do_cell_alignment</span><span class="s4">()</span>

        <span class="s1">bbox </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_get_grid_bbox</span><span class="s4">(</span><span class="s1">renderer</span><span class="s4">)</span>
        <span class="s1">l</span><span class="s4">, </span><span class="s1">b</span><span class="s4">, </span><span class="s1">w</span><span class="s4">, </span><span class="s1">h </span><span class="s4">= </span><span class="s1">bbox</span><span class="s4">.</span><span class="s1">bounds</span>

        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_bbox </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s0"># Position according to bbox</span>
            <span class="s3">if </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_bbox</span><span class="s4">, </span><span class="s1">Bbox</span><span class="s4">):</span>
                <span class="s1">rl</span><span class="s4">, </span><span class="s1">rb</span><span class="s4">, </span><span class="s1">rw</span><span class="s4">, </span><span class="s1">rh </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_bbox</span><span class="s4">.</span><span class="s1">bounds</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s1">rl</span><span class="s4">, </span><span class="s1">rb</span><span class="s4">, </span><span class="s1">rw</span><span class="s4">, </span><span class="s1">rh </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_bbox</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">scale</span><span class="s4">(</span><span class="s1">rw </span><span class="s4">/ </span><span class="s1">w</span><span class="s4">, </span><span class="s1">rh </span><span class="s4">/ </span><span class="s1">h</span><span class="s4">)</span>
            <span class="s1">ox </span><span class="s4">= </span><span class="s1">rl </span><span class="s4">- </span><span class="s1">l</span>
            <span class="s1">oy </span><span class="s4">= </span><span class="s1">rb </span><span class="s4">- </span><span class="s1">b</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_do_cell_alignment</span><span class="s4">()</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s0"># Position using loc</span>
            <span class="s4">(</span><span class="s1">BEST</span><span class="s4">, </span><span class="s1">UR</span><span class="s4">, </span><span class="s1">UL</span><span class="s4">, </span><span class="s1">LL</span><span class="s4">, </span><span class="s1">LR</span><span class="s4">, </span><span class="s1">CL</span><span class="s4">, </span><span class="s1">CR</span><span class="s4">, </span><span class="s1">LC</span><span class="s4">, </span><span class="s1">UC</span><span class="s4">, </span><span class="s1">C</span><span class="s4">,</span>
             <span class="s1">TR</span><span class="s4">, </span><span class="s1">TL</span><span class="s4">, </span><span class="s1">BL</span><span class="s4">, </span><span class="s1">BR</span><span class="s4">, </span><span class="s1">R</span><span class="s4">, </span><span class="s1">L</span><span class="s4">, </span><span class="s1">T</span><span class="s4">, </span><span class="s1">B</span><span class="s4">) = </span><span class="s1">range</span><span class="s4">(</span><span class="s1">len</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">codes</span><span class="s4">))</span>
            <span class="s0"># defaults for center</span>
            <span class="s1">ox </span><span class="s4">= (</span><span class="s5">0.5 </span><span class="s4">- </span><span class="s1">w </span><span class="s4">/ </span><span class="s5">2</span><span class="s4">) - </span><span class="s1">l</span>
            <span class="s1">oy </span><span class="s4">= (</span><span class="s5">0.5 </span><span class="s4">- </span><span class="s1">h </span><span class="s4">/ </span><span class="s5">2</span><span class="s4">) - </span><span class="s1">b</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">UL</span><span class="s4">, </span><span class="s1">LL</span><span class="s4">, </span><span class="s1">CL</span><span class="s4">):   </span><span class="s0"># left</span>
                <span class="s1">ox </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">AXESPAD </span><span class="s4">- </span><span class="s1">l</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">BEST</span><span class="s4">, </span><span class="s1">UR</span><span class="s4">, </span><span class="s1">LR</span><span class="s4">, </span><span class="s1">R</span><span class="s4">, </span><span class="s1">CR</span><span class="s4">):  </span><span class="s0"># right</span>
                <span class="s1">ox </span><span class="s4">= </span><span class="s5">1 </span><span class="s4">- (</span><span class="s1">l </span><span class="s4">+ </span><span class="s1">w </span><span class="s4">+ </span><span class="s1">self</span><span class="s4">.</span><span class="s1">AXESPAD</span><span class="s4">)</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">BEST</span><span class="s4">, </span><span class="s1">UR</span><span class="s4">, </span><span class="s1">UL</span><span class="s4">, </span><span class="s1">UC</span><span class="s4">):     </span><span class="s0"># upper</span>
                <span class="s1">oy </span><span class="s4">= </span><span class="s5">1 </span><span class="s4">- (</span><span class="s1">b </span><span class="s4">+ </span><span class="s1">h </span><span class="s4">+ </span><span class="s1">self</span><span class="s4">.</span><span class="s1">AXESPAD</span><span class="s4">)</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">LL</span><span class="s4">, </span><span class="s1">LR</span><span class="s4">, </span><span class="s1">LC</span><span class="s4">):           </span><span class="s0"># lower</span>
                <span class="s1">oy </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">AXESPAD </span><span class="s4">- </span><span class="s1">b</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">LC</span><span class="s4">, </span><span class="s1">UC</span><span class="s4">, </span><span class="s1">C</span><span class="s4">):            </span><span class="s0"># center x</span>
                <span class="s1">ox </span><span class="s4">= (</span><span class="s5">0.5 </span><span class="s4">- </span><span class="s1">w </span><span class="s4">/ </span><span class="s5">2</span><span class="s4">) - </span><span class="s1">l</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">CL</span><span class="s4">, </span><span class="s1">CR</span><span class="s4">, </span><span class="s1">C</span><span class="s4">):            </span><span class="s0"># center y</span>
                <span class="s1">oy </span><span class="s4">= (</span><span class="s5">0.5 </span><span class="s4">- </span><span class="s1">h </span><span class="s4">/ </span><span class="s5">2</span><span class="s4">) - </span><span class="s1">b</span>

            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">TL</span><span class="s4">, </span><span class="s1">BL</span><span class="s4">, </span><span class="s1">L</span><span class="s4">):            </span><span class="s0"># out left</span>
                <span class="s1">ox </span><span class="s4">= - (</span><span class="s1">l </span><span class="s4">+ </span><span class="s1">w</span><span class="s4">)</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">TR</span><span class="s4">, </span><span class="s1">BR</span><span class="s4">, </span><span class="s1">R</span><span class="s4">):            </span><span class="s0"># out right</span>
                <span class="s1">ox </span><span class="s4">= </span><span class="s5">1.0 </span><span class="s4">- </span><span class="s1">l</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">TR</span><span class="s4">, </span><span class="s1">TL</span><span class="s4">, </span><span class="s1">T</span><span class="s4">):            </span><span class="s0"># out top</span>
                <span class="s1">oy </span><span class="s4">= </span><span class="s5">1.0 </span><span class="s4">- </span><span class="s1">b</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_loc </span><span class="s3">in </span><span class="s4">(</span><span class="s1">BL</span><span class="s4">, </span><span class="s1">BR</span><span class="s4">, </span><span class="s1">B</span><span class="s4">):           </span><span class="s0"># out bottom</span>
                <span class="s1">oy </span><span class="s4">= - (</span><span class="s1">b </span><span class="s4">+ </span><span class="s1">h</span><span class="s4">)</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_offset</span><span class="s4">(</span><span class="s1">ox</span><span class="s4">, </span><span class="s1">oy</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">get_celld</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">r&quot;&quot;&quot; 
        Return a dict of cells in the table mapping *(row, column)* to 
        `.Cell`\s. 
 
        Notes 
        ----- 
        You can also directly index into the Table object to access individual 
        cells:: 
 
            cell = table[row, col] 
 
        &quot;&quot;&quot;</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cells</span>


<span class="s4">@</span><span class="s1">_docstring</span><span class="s4">.</span><span class="s1">dedent_interpd</span>
<span class="s3">def </span><span class="s1">table</span><span class="s4">(</span><span class="s1">ax</span><span class="s4">,</span>
          <span class="s1">cellText</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">cellColours</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
          <span class="s1">cellLoc</span><span class="s4">=</span><span class="s6">'right'</span><span class="s4">, </span><span class="s1">colWidths</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
          <span class="s1">rowLabels</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">rowColours</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">rowLoc</span><span class="s4">=</span><span class="s6">'left'</span><span class="s4">,</span>
          <span class="s1">colLabels</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">colColours</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">colLoc</span><span class="s4">=</span><span class="s6">'center'</span><span class="s4">,</span>
          <span class="s1">loc</span><span class="s4">=</span><span class="s6">'bottom'</span><span class="s4">, </span><span class="s1">bbox</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">edges</span><span class="s4">=</span><span class="s6">'closed'</span><span class="s4">,</span>
          <span class="s4">**</span><span class="s1">kwargs</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot; 
    Add a table to an `~.axes.Axes`. 
 
    At least one of *cellText* or *cellColours* must be specified. These 
    parameters must be 2D lists, in which the outer lists define the rows and 
    the inner list define the column values per row. Each row must have the 
    same number of elements. 
 
    The table can optionally have row and column headers, which are configured 
    using *rowLabels*, *rowColours*, *rowLoc* and *colLabels*, *colColours*, 
    *colLoc* respectively. 
 
    For finer grained control over tables, use the `.Table` class and add it to 
    the Axes with `.Axes.add_table`. 
 
    Parameters 
    ---------- 
    cellText : 2D list of str, optional 
        The texts to place into the table cells. 
 
        *Note*: Line breaks in the strings are currently not accounted for and 
        will result in the text exceeding the cell boundaries. 
 
    cellColours : 2D list of :mpltype:`color`, optional 
        The background colors of the cells. 
 
    cellLoc : {'right', 'center', 'left'} 
        The alignment of the text within the cells. 
 
    colWidths : list of float, optional 
        The column widths in units of the axes. If not given, all columns will 
        have a width of *1 / ncols*. 
 
    rowLabels : list of str, optional 
        The text of the row header cells. 
 
    rowColours : list of :mpltype:`color`, optional 
        The colors of the row header cells. 
 
    rowLoc : {'left', 'center', 'right'} 
        The text alignment of the row header cells. 
 
    colLabels : list of str, optional 
        The text of the column header cells. 
 
    colColours : list of :mpltype:`color`, optional 
        The colors of the column header cells. 
 
    colLoc : {'center', 'left', 'right'} 
        The text alignment of the column header cells. 
 
    loc : str, default: 'bottom' 
        The position of the cell with respect to *ax*. This must be one of 
        the `~.Table.codes`. 
 
    bbox : `.Bbox` or [xmin, ymin, width, height], optional 
        A bounding box to draw the table into. If this is not *None*, this 
        overrides *loc*. 
 
    edges : {'closed', 'open', 'horizontal', 'vertical'} or substring of 'BRTL' 
        The cell edges to be drawn with a line. See also 
        `~.Cell.visible_edges`. 
 
    Returns 
    ------- 
    `~matplotlib.table.Table` 
        The created table. 
 
    Other Parameters 
    ---------------- 
    **kwargs 
        `.Table` properties. 
 
    %(Table:kwdoc)s 
    &quot;&quot;&quot;</span>

    <span class="s3">if </span><span class="s1">cellColours </span><span class="s3">is None and </span><span class="s1">cellText </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">'At least one argument from &quot;cellColours&quot; or '</span>
                         <span class="s6">'&quot;cellText&quot; must be provided to create a table.'</span><span class="s4">)</span>

    <span class="s0"># Check we have some cellText</span>
    <span class="s3">if </span><span class="s1">cellText </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s0"># assume just colours are needed</span>
        <span class="s1">rows </span><span class="s4">= </span><span class="s1">len</span><span class="s4">(</span><span class="s1">cellColours</span><span class="s4">)</span>
        <span class="s1">cols </span><span class="s4">= </span><span class="s1">len</span><span class="s4">(</span><span class="s1">cellColours</span><span class="s4">[</span><span class="s5">0</span><span class="s4">])</span>
        <span class="s1">cellText </span><span class="s4">= [[</span><span class="s6">''</span><span class="s4">] * </span><span class="s1">cols</span><span class="s4">] * </span><span class="s1">rows</span>

    <span class="s1">rows </span><span class="s4">= </span><span class="s1">len</span><span class="s4">(</span><span class="s1">cellText</span><span class="s4">)</span>
    <span class="s1">cols </span><span class="s4">= </span><span class="s1">len</span><span class="s4">(</span><span class="s1">cellText</span><span class="s4">[</span><span class="s5">0</span><span class="s4">])</span>
    <span class="s3">for </span><span class="s1">row </span><span class="s3">in </span><span class="s1">cellText</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">row</span><span class="s4">) != </span><span class="s1">cols</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">f&quot;Each row in 'cellText' must have </span><span class="s3">{</span><span class="s1">cols</span><span class="s3">} </span><span class="s6">&quot;</span>
                             <span class="s6">&quot;columns&quot;</span><span class="s4">)</span>

    <span class="s3">if </span><span class="s1">cellColours </span><span class="s3">is not None</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">cellColours</span><span class="s4">) != </span><span class="s1">rows</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">f&quot;'cellColours' must have </span><span class="s3">{</span><span class="s1">rows</span><span class="s3">} </span><span class="s6">rows&quot;</span><span class="s4">)</span>
        <span class="s3">for </span><span class="s1">row </span><span class="s3">in </span><span class="s1">cellColours</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">row</span><span class="s4">) != </span><span class="s1">cols</span><span class="s4">:</span>
                <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">&quot;Each row in 'cellColours' must have &quot;</span>
                                 <span class="s6">f&quot;</span><span class="s3">{</span><span class="s1">cols</span><span class="s3">} </span><span class="s6">columns&quot;</span><span class="s4">)</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s1">cellColours </span><span class="s4">= [</span><span class="s6">'w' </span><span class="s4">* </span><span class="s1">cols</span><span class="s4">] * </span><span class="s1">rows</span>

    <span class="s0"># Set colwidths if not given</span>
    <span class="s3">if </span><span class="s1">colWidths </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s1">colWidths </span><span class="s4">= [</span><span class="s5">1.0 </span><span class="s4">/ </span><span class="s1">cols</span><span class="s4">] * </span><span class="s1">cols</span>

    <span class="s0"># Fill in missing information for column</span>
    <span class="s0"># and row labels</span>
    <span class="s1">rowLabelWidth </span><span class="s4">= </span><span class="s5">0</span>
    <span class="s3">if </span><span class="s1">rowLabels </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">rowColours </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s1">rowLabels </span><span class="s4">= [</span><span class="s6">''</span><span class="s4">] * </span><span class="s1">rows</span>
            <span class="s1">rowLabelWidth </span><span class="s4">= </span><span class="s1">colWidths</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>
    <span class="s3">elif </span><span class="s1">rowColours </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s1">rowColours </span><span class="s4">= </span><span class="s6">'w' </span><span class="s4">* </span><span class="s1">rows</span>

    <span class="s3">if </span><span class="s1">rowLabels </span><span class="s3">is not None</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">rowLabels</span><span class="s4">) != </span><span class="s1">rows</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">f&quot;'rowLabels' must be of length </span><span class="s3">{</span><span class="s1">rows</span><span class="s3">}</span><span class="s6">&quot;</span><span class="s4">)</span>

    <span class="s0"># If we have column labels, need to shift</span>
    <span class="s0"># the text and colour arrays down 1 row</span>
    <span class="s1">offset </span><span class="s4">= </span><span class="s5">1</span>
    <span class="s3">if </span><span class="s1">colLabels </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">colColours </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s1">colLabels </span><span class="s4">= [</span><span class="s6">''</span><span class="s4">] * </span><span class="s1">cols</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">offset </span><span class="s4">= </span><span class="s5">0</span>
    <span class="s3">elif </span><span class="s1">colColours </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s1">colColours </span><span class="s4">= </span><span class="s6">'w' </span><span class="s4">* </span><span class="s1">cols</span>

    <span class="s0"># Set up cell colours if not given</span>
    <span class="s3">if </span><span class="s1">cellColours </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s1">cellColours </span><span class="s4">= [</span><span class="s6">'w' </span><span class="s4">* </span><span class="s1">cols</span><span class="s4">] * </span><span class="s1">rows</span>

    <span class="s0"># Now create the table</span>
    <span class="s1">table </span><span class="s4">= </span><span class="s1">Table</span><span class="s4">(</span><span class="s1">ax</span><span class="s4">, </span><span class="s1">loc</span><span class="s4">, </span><span class="s1">bbox</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">)</span>
    <span class="s1">table</span><span class="s4">.</span><span class="s1">edges </span><span class="s4">= </span><span class="s1">edges</span>
    <span class="s1">height </span><span class="s4">= </span><span class="s1">table</span><span class="s4">.</span><span class="s1">_approx_text_height</span><span class="s4">()</span>

    <span class="s0"># Add the cells</span>
    <span class="s3">for </span><span class="s1">row </span><span class="s3">in </span><span class="s1">range</span><span class="s4">(</span><span class="s1">rows</span><span class="s4">):</span>
        <span class="s3">for </span><span class="s1">col </span><span class="s3">in </span><span class="s1">range</span><span class="s4">(</span><span class="s1">cols</span><span class="s4">):</span>
            <span class="s1">table</span><span class="s4">.</span><span class="s1">add_cell</span><span class="s4">(</span><span class="s1">row </span><span class="s4">+ </span><span class="s1">offset</span><span class="s4">, </span><span class="s1">col</span><span class="s4">,</span>
                           <span class="s1">width</span><span class="s4">=</span><span class="s1">colWidths</span><span class="s4">[</span><span class="s1">col</span><span class="s4">], </span><span class="s1">height</span><span class="s4">=</span><span class="s1">height</span><span class="s4">,</span>
                           <span class="s1">text</span><span class="s4">=</span><span class="s1">cellText</span><span class="s4">[</span><span class="s1">row</span><span class="s4">][</span><span class="s1">col</span><span class="s4">],</span>
                           <span class="s1">facecolor</span><span class="s4">=</span><span class="s1">cellColours</span><span class="s4">[</span><span class="s1">row</span><span class="s4">][</span><span class="s1">col</span><span class="s4">],</span>
                           <span class="s1">loc</span><span class="s4">=</span><span class="s1">cellLoc</span><span class="s4">)</span>
    <span class="s0"># Do column labels</span>
    <span class="s3">if </span><span class="s1">colLabels </span><span class="s3">is not None</span><span class="s4">:</span>
        <span class="s3">for </span><span class="s1">col </span><span class="s3">in </span><span class="s1">range</span><span class="s4">(</span><span class="s1">cols</span><span class="s4">):</span>
            <span class="s1">table</span><span class="s4">.</span><span class="s1">add_cell</span><span class="s4">(</span><span class="s5">0</span><span class="s4">, </span><span class="s1">col</span><span class="s4">,</span>
                           <span class="s1">width</span><span class="s4">=</span><span class="s1">colWidths</span><span class="s4">[</span><span class="s1">col</span><span class="s4">], </span><span class="s1">height</span><span class="s4">=</span><span class="s1">height</span><span class="s4">,</span>
                           <span class="s1">text</span><span class="s4">=</span><span class="s1">colLabels</span><span class="s4">[</span><span class="s1">col</span><span class="s4">], </span><span class="s1">facecolor</span><span class="s4">=</span><span class="s1">colColours</span><span class="s4">[</span><span class="s1">col</span><span class="s4">],</span>
                           <span class="s1">loc</span><span class="s4">=</span><span class="s1">colLoc</span><span class="s4">)</span>

    <span class="s0"># Do row labels</span>
    <span class="s3">if </span><span class="s1">rowLabels </span><span class="s3">is not None</span><span class="s4">:</span>
        <span class="s3">for </span><span class="s1">row </span><span class="s3">in </span><span class="s1">range</span><span class="s4">(</span><span class="s1">rows</span><span class="s4">):</span>
            <span class="s1">table</span><span class="s4">.</span><span class="s1">add_cell</span><span class="s4">(</span><span class="s1">row </span><span class="s4">+ </span><span class="s1">offset</span><span class="s4">, -</span><span class="s5">1</span><span class="s4">,</span>
                           <span class="s1">width</span><span class="s4">=</span><span class="s1">rowLabelWidth </span><span class="s3">or </span><span class="s5">1e-15</span><span class="s4">, </span><span class="s1">height</span><span class="s4">=</span><span class="s1">height</span><span class="s4">,</span>
                           <span class="s1">text</span><span class="s4">=</span><span class="s1">rowLabels</span><span class="s4">[</span><span class="s1">row</span><span class="s4">], </span><span class="s1">facecolor</span><span class="s4">=</span><span class="s1">rowColours</span><span class="s4">[</span><span class="s1">row</span><span class="s4">],</span>
                           <span class="s1">loc</span><span class="s4">=</span><span class="s1">rowLoc</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">rowLabelWidth </span><span class="s4">== </span><span class="s5">0</span><span class="s4">:</span>
            <span class="s1">table</span><span class="s4">.</span><span class="s1">auto_set_column_width</span><span class="s4">(-</span><span class="s5">1</span><span class="s4">)</span>

    <span class="s1">ax</span><span class="s4">.</span><span class="s1">add_table</span><span class="s4">(</span><span class="s1">table</span><span class="s4">)</span>
    <span class="s3">return </span><span class="s1">table</span>
</pre>
</body>
</html>