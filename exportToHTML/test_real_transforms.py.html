<html>
<head>
<title>test_real_transforms.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_real_transforms.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">os</span><span class="s2">.</span><span class="s1">path </span><span class="s0">import </span><span class="s1">join</span><span class="s2">, </span><span class="s1">dirname</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_array_almost_equal</span><span class="s2">, </span><span class="s1">assert_equal</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>

<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">fftpack</span><span class="s2">.</span><span class="s1">_realtransforms </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">dct</span><span class="s2">, </span><span class="s1">idct</span><span class="s2">, </span><span class="s1">dst</span><span class="s2">, </span><span class="s1">idst</span><span class="s2">, </span><span class="s1">dctn</span><span class="s2">, </span><span class="s1">idctn</span><span class="s2">, </span><span class="s1">dstn</span><span class="s2">, </span><span class="s1">idstn</span><span class="s2">)</span>

<span class="s3"># Matlab reference data</span>
<span class="s1">MDATA </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">join</span><span class="s2">(</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">__file__</span><span class="s2">), </span><span class="s4">'test.npz'</span><span class="s2">))</span>
<span class="s1">X </span><span class="s2">= [</span><span class="s1">MDATA</span><span class="s2">[</span><span class="s4">'x%d' </span><span class="s2">% </span><span class="s1">i</span><span class="s2">] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">8</span><span class="s2">)]</span>
<span class="s1">Y </span><span class="s2">= [</span><span class="s1">MDATA</span><span class="s2">[</span><span class="s4">'y%d' </span><span class="s2">% </span><span class="s1">i</span><span class="s2">] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">8</span><span class="s2">)]</span>

<span class="s3"># FFTW reference data: the data are organized as follows:</span>
<span class="s3">#    * SIZES is an array containing all available sizes</span>
<span class="s3">#    * for every type (1, 2, 3, 4) and every size, the array dct_type_size</span>
<span class="s3">#    contains the output of the DCT applied to the input np.linspace(0, size-1,</span>
<span class="s3">#    size)</span>
<span class="s1">FFTWDATA_DOUBLE </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">join</span><span class="s2">(</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">__file__</span><span class="s2">), </span><span class="s4">'fftw_double_ref.npz'</span><span class="s2">))</span>
<span class="s1">FFTWDATA_SINGLE </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">join</span><span class="s2">(</span><span class="s1">dirname</span><span class="s2">(</span><span class="s1">__file__</span><span class="s2">), </span><span class="s4">'fftw_single_ref.npz'</span><span class="s2">))</span>
<span class="s1">FFTWDATA_SIZES </span><span class="s2">= </span><span class="s1">FFTWDATA_DOUBLE</span><span class="s2">[</span><span class="s4">'sizes'</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">fftw_dct_ref</span><span class="s2">(</span><span class="s1">type</span><span class="s2">, </span><span class="s1">size</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">size</span><span class="s2">-</span><span class="s5">1</span><span class="s2">, </span><span class="s1">size</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">result_type</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">dt </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">:</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">FFTWDATA_DOUBLE</span>
    <span class="s0">elif </span><span class="s1">dt </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">:</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">FFTWDATA_SINGLE</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">()</span>
    <span class="s1">y </span><span class="s2">= (</span><span class="s1">data</span><span class="s2">[</span><span class="s4">'dct_%d_%d' </span><span class="s2">% (</span><span class="s1">type</span><span class="s2">, </span><span class="s1">size</span><span class="s2">)]).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">fftw_dst_ref</span><span class="s2">(</span><span class="s1">type</span><span class="s2">, </span><span class="s1">size</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">size</span><span class="s2">-</span><span class="s5">1</span><span class="s2">, </span><span class="s1">size</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">result_type</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">dt </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">:</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">FFTWDATA_DOUBLE</span>
    <span class="s0">elif </span><span class="s1">dt </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">:</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">FFTWDATA_SINGLE</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">()</span>
    <span class="s1">y </span><span class="s2">= (</span><span class="s1">data</span><span class="s2">[</span><span class="s4">'dst_%d_%d' </span><span class="s2">% (</span><span class="s1">type</span><span class="s2">, </span><span class="s1">size</span><span class="s2">)]).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">dct_2d_ref</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Calculate reference values for testing dct2.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">row </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]):</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, :] = </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, :], **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">col </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]):</span>
        <span class="s1">x</span><span class="s2">[:, </span><span class="s1">col</span><span class="s2">] = </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:, </span><span class="s1">col</span><span class="s2">], **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">x</span>


<span class="s0">def </span><span class="s1">idct_2d_ref</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Calculate reference values for testing idct2.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">row </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]):</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, :] = </span><span class="s1">idct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, :], **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">col </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]):</span>
        <span class="s1">x</span><span class="s2">[:, </span><span class="s1">col</span><span class="s2">] = </span><span class="s1">idct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:, </span><span class="s1">col</span><span class="s2">], **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">x</span>


<span class="s0">def </span><span class="s1">dst_2d_ref</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Calculate reference values for testing dst2.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">row </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]):</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, :] = </span><span class="s1">dst</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, :], **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">col </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]):</span>
        <span class="s1">x</span><span class="s2">[:, </span><span class="s1">col</span><span class="s2">] = </span><span class="s1">dst</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:, </span><span class="s1">col</span><span class="s2">], **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">x</span>


<span class="s0">def </span><span class="s1">idst_2d_ref</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Calculate reference values for testing idst2.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">row </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]):</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, :] = </span><span class="s1">idst</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, :], **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">col </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]):</span>
        <span class="s1">x</span><span class="s2">[:, </span><span class="s1">col</span><span class="s2">] = </span><span class="s1">idst</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:, </span><span class="s1">col</span><span class="s2">], **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">x</span>


<span class="s0">def </span><span class="s1">naive_dct1</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Calculate textbook definition version of DCT-I.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">M </span><span class="s2">= </span><span class="s1">N</span><span class="s2">-</span><span class="s5">1</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s1">m0</span><span class="s2">, </span><span class="s1">m </span><span class="s2">= </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span>
    <span class="s0">if </span><span class="s1">norm </span><span class="s2">== </span><span class="s4">'ortho'</span><span class="s2">:</span>
        <span class="s1">m0 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">1.0</span><span class="s2">/</span><span class="s1">M</span><span class="s2">)</span>
        <span class="s1">m </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">2.0</span><span class="s2">/</span><span class="s1">M</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">N</span><span class="s2">-</span><span class="s5">1</span><span class="s2">):</span>
            <span class="s1">y</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] += </span><span class="s1">m</span><span class="s2">*</span><span class="s1">x</span><span class="s2">[</span><span class="s1">n</span><span class="s2">]*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*</span><span class="s1">n</span><span class="s2">*</span><span class="s1">k</span><span class="s2">/</span><span class="s1">M</span><span class="s2">)</span>
        <span class="s1">y</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] += </span><span class="s1">m0 </span><span class="s2">* </span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">y</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] += </span><span class="s1">m0 </span><span class="s2">* </span><span class="s1">x</span><span class="s2">[</span><span class="s1">N</span><span class="s2">-</span><span class="s5">1</span><span class="s2">] * (</span><span class="s5">1 </span><span class="s0">if </span><span class="s1">k </span><span class="s2">% </span><span class="s5">2 </span><span class="s2">== </span><span class="s5">0 </span><span class="s0">else </span><span class="s2">-</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">norm </span><span class="s2">== </span><span class="s4">'ortho'</span><span class="s2">:</span>
        <span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] *= </span><span class="s5">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">y</span><span class="s2">[</span><span class="s1">N</span><span class="s2">-</span><span class="s5">1</span><span class="s2">] *= </span><span class="s5">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">y</span>


<span class="s0">def </span><span class="s1">naive_dst1</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Calculate textbook definition version  of DST-I.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">M </span><span class="s2">= </span><span class="s1">N</span><span class="s2">+</span><span class="s5">1</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">):</span>
            <span class="s1">y</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] += </span><span class="s5">2</span><span class="s2">*</span><span class="s1">x</span><span class="s2">[</span><span class="s1">n</span><span class="s2">]*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*(</span><span class="s1">n</span><span class="s2">+</span><span class="s5">1.0</span><span class="s2">)*(</span><span class="s1">k</span><span class="s2">+</span><span class="s5">1.0</span><span class="s2">)/</span><span class="s1">M</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">norm </span><span class="s2">== </span><span class="s4">'ortho'</span><span class="s2">:</span>
        <span class="s1">y </span><span class="s2">*= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">/</span><span class="s1">M</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">y</span>


<span class="s0">def </span><span class="s1">naive_dct4</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Calculate textbook definition version of DCT-IV.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">):</span>
            <span class="s1">y</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] += </span><span class="s1">x</span><span class="s2">[</span><span class="s1">n</span><span class="s2">]*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*(</span><span class="s1">n</span><span class="s2">+</span><span class="s5">0.5</span><span class="s2">)*(</span><span class="s1">k</span><span class="s2">+</span><span class="s5">0.5</span><span class="s2">)/(</span><span class="s1">N</span><span class="s2">))</span>
    <span class="s0">if </span><span class="s1">norm </span><span class="s2">== </span><span class="s4">'ortho'</span><span class="s2">:</span>
        <span class="s1">y </span><span class="s2">*= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">2.0</span><span class="s2">/</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">y </span><span class="s2">*= </span><span class="s5">2</span>
    <span class="s0">return </span><span class="s1">y</span>


<span class="s0">def </span><span class="s1">naive_dst4</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Calculate textbook definition version of DST-IV.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">):</span>
            <span class="s1">y</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] += </span><span class="s1">x</span><span class="s2">[</span><span class="s1">n</span><span class="s2">]*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*(</span><span class="s1">n</span><span class="s2">+</span><span class="s5">0.5</span><span class="s2">)*(</span><span class="s1">k</span><span class="s2">+</span><span class="s5">0.5</span><span class="s2">)/(</span><span class="s1">N</span><span class="s2">))</span>
    <span class="s0">if </span><span class="s1">norm </span><span class="s2">== </span><span class="s4">'ortho'</span><span class="s2">:</span>
        <span class="s1">y </span><span class="s2">*= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">2.0</span><span class="s2">/</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">y </span><span class="s2">*= </span><span class="s5">2</span>
    <span class="s0">return </span><span class="s1">y</span>


<span class="s0">class </span><span class="s1">TestComplex</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_dct_complex64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s5">1j</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">))</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s5">1j</span><span class="s2">*</span><span class="s1">dct</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dct_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)*</span><span class="s5">1j</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s5">1j</span><span class="s2">*</span><span class="s1">dct</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_idct_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">idct</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)*</span><span class="s5">1j</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s5">1j</span><span class="s2">*</span><span class="s1">idct</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dst_complex64</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">dst</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex64</span><span class="s2">)*</span><span class="s5">1j</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s5">1j</span><span class="s2">*</span><span class="s1">dst</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dst_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">dst</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)*</span><span class="s5">1j</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s5">1j</span><span class="s2">*</span><span class="s1">dst</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_idst_complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">idst</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)*</span><span class="s5">1j</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s5">1j</span><span class="s2">*</span><span class="s1">idst</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">_TestDCTBase</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">test_definition</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">FFTWDATA_SIZES</span><span class="s2">:</span>
            <span class="s1">x</span><span class="s2">, </span><span class="s1">yr</span><span class="s2">, </span><span class="s1">dt </span><span class="s2">= </span><span class="s1">fftw_dct_ref</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s3"># XXX: we divide by np.max(y) because the tests fail otherwise. We</span>
            <span class="s3"># should really use something like assert_array_approx_equal. The</span>
            <span class="s3"># difference is due to fftw using a better algorithm w.r.t error</span>
            <span class="s3"># propagation compared to the ones from fftpack.</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">yr </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">,</span>
                    <span class="s1">err_msg</span><span class="s2">=</span><span class="s4">&quot;Size %d failed&quot; </span><span class="s2">% </span><span class="s1">i</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_axis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">nt </span><span class="s2">= </span><span class="s5">2</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s2">[</span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">32</span><span class="s2">, </span><span class="s5">64</span><span class="s2">]:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s1">nt</span><span class="s2">, </span><span class="s1">i</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">nt</span><span class="s2">):</span>
                <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s1">j</span><span class="s2">], </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">j</span><span class="s2">], </span><span class="s1">type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">),</span>
                        <span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>

            <span class="s1">x </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">T</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">nt</span><span class="s2">):</span>
                <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[:,</span><span class="s1">j</span><span class="s2">], </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:,</span><span class="s1">j</span><span class="s2">], </span><span class="s1">type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">),</span>
                        <span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">_TestDCTIBase</span><span class="s2">(</span><span class="s1">_TestDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">test_definition_ortho</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test orthornomal mode.</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">result_type</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">xr </span><span class="s0">in </span><span class="s1">X</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">y2 </span><span class="s2">= </span><span class="s1">naive_dct1</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">y2 </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">_TestDCTIIBase</span><span class="s2">(</span><span class="s1">_TestDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">test_definition_matlab</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test correspondence with MATLAB (orthornomal mode).</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">result_type</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">xr</span><span class="s2">, </span><span class="s1">yr </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">):</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">&quot;ortho&quot;</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">yr</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">_TestDCTIIIBase</span><span class="s2">(</span><span class="s1">_TestDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">test_definition_ortho</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test orthornomal mode.</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">result_type</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">xr </span><span class="s0">in </span><span class="s1">X</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
            <span class="s1">xi </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">&quot;ortho&quot;</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">xi</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">xi</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">_TestDCTIVBase</span><span class="s2">(</span><span class="s1">_TestDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">test_definition_ortho</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test orthornomal mode.</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">result_type</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">xr </span><span class="s0">in </span><span class="s1">X</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dct</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>
            <span class="s1">y2 </span><span class="s2">= </span><span class="s1">naive_dct4</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">y2 </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestDCTIDouble</span><span class="s2">(</span><span class="s1">_TestDCTIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">10</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestDCTIFloat</span><span class="s2">(</span><span class="s1">_TestDCTIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">4</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestDCTIInt</span><span class="s2">(</span><span class="s1">_TestDCTIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestDCTIIDouble</span><span class="s2">(</span><span class="s1">_TestDCTIIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">10</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestDCTIIFloat</span><span class="s2">(</span><span class="s1">_TestDCTIIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestDCTIIInt</span><span class="s2">(</span><span class="s1">_TestDCTIIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestDCTIIIDouble</span><span class="s2">(</span><span class="s1">_TestDCTIIIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestDCTIIIFloat</span><span class="s2">(</span><span class="s1">_TestDCTIIIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestDCTIIIInt</span><span class="s2">(</span><span class="s1">_TestDCTIIIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestDCTIVDouble</span><span class="s2">(</span><span class="s1">_TestDCTIVBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">12</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestDCTIVFloat</span><span class="s2">(</span><span class="s1">_TestDCTIVBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestDCTIVInt</span><span class="s2">(</span><span class="s1">_TestDCTIVBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">_TestIDCTBase</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">test_definition</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">FFTWDATA_SIZES</span><span class="s2">:</span>
            <span class="s1">xr</span><span class="s2">, </span><span class="s1">yr</span><span class="s2">, </span><span class="s1">dt </span><span class="s2">= </span><span class="s1">fftw_dct_ref</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">idct</span><span class="s2">(</span><span class="s1">yr</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">== </span><span class="s5">1</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">/= </span><span class="s5">2 </span><span class="s2">* (</span><span class="s1">i</span><span class="s2">-</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">/= </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">i</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s3"># XXX: we divide by np.max(y) because the tests fail otherwise. We</span>
            <span class="s3"># should really use something like assert_array_approx_equal. The</span>
            <span class="s3"># difference is due to fftw using a better algorithm w.r.t error</span>
            <span class="s3"># propagation compared to the ones from fftpack.</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">xr </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">,</span>
                    <span class="s1">err_msg</span><span class="s2">=</span><span class="s4">&quot;Size %d failed&quot; </span><span class="s2">% </span><span class="s1">i</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIDCTIDouble</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">10</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestIDCTIFloat</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">4</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestIDCTIInt</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">4</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestIDCTIIDouble</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">10</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestIDCTIIFloat</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestIDCTIIInt</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestIDCTIIIDouble</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestIDCTIIIFloat</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestIDCTIIIInt</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>

<span class="s0">class </span><span class="s1">TestIDCTIVDouble</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">12</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>


<span class="s0">class </span><span class="s1">TestIDCTIVFloat</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>


<span class="s0">class </span><span class="s1">TestIDCTIVInt</span><span class="s2">(</span><span class="s1">_TestIDCTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>

<span class="s0">class </span><span class="s1">_TestDSTBase</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s0">None  </span><span class="s3"># dtype</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s0">None  </span><span class="s3"># number of decimals to match</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s0">None  </span><span class="s3"># dst type</span>

    <span class="s0">def </span><span class="s1">test_definition</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">FFTWDATA_SIZES</span><span class="s2">:</span>
            <span class="s1">xr</span><span class="s2">, </span><span class="s1">yr</span><span class="s2">, </span><span class="s1">dt </span><span class="s2">= </span><span class="s1">fftw_dst_ref</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dst</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s3"># XXX: we divide by np.max(y) because the tests fail otherwise. We</span>
            <span class="s3"># should really use something like assert_array_approx_equal. The</span>
            <span class="s3"># difference is due to fftw using a better algorithm w.r.t error</span>
            <span class="s3"># propagation compared to the ones from fftpack.</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">yr </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">,</span>
                    <span class="s1">err_msg</span><span class="s2">=</span><span class="s4">&quot;Size %d failed&quot; </span><span class="s2">% </span><span class="s1">i</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">_TestDSTIBase</span><span class="s2">(</span><span class="s1">_TestDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">test_definition_ortho</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test orthornomal mode.</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">result_type</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">xr </span><span class="s0">in </span><span class="s1">X</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dst</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">y2 </span><span class="s2">= </span><span class="s1">naive_dst1</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">y2 </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">_TestDSTIVBase</span><span class="s2">(</span><span class="s1">_TestDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">test_definition_ortho</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test orthornomal mode.</span>
        <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">result_type</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">xr </span><span class="s0">in </span><span class="s1">X</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dst</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>
            <span class="s1">y2 </span><span class="s2">= </span><span class="s1">naive_dst4</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">TestDSTIDouble</span><span class="s2">(</span><span class="s1">_TestDSTIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">12</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestDSTIFloat</span><span class="s2">(</span><span class="s1">_TestDSTIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">4</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestDSTIInt</span><span class="s2">(</span><span class="s1">_TestDSTIBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestDSTIIDouble</span><span class="s2">(</span><span class="s1">_TestDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestDSTIIFloat</span><span class="s2">(</span><span class="s1">_TestDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">6</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestDSTIIInt</span><span class="s2">(</span><span class="s1">_TestDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">6</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestDSTIIIDouble</span><span class="s2">(</span><span class="s1">_TestDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestDSTIIIFloat</span><span class="s2">(</span><span class="s1">_TestDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">7</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestDSTIIIInt</span><span class="s2">(</span><span class="s1">_TestDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">7</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestDSTIVDouble</span><span class="s2">(</span><span class="s1">_TestDSTIVBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">12</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>


<span class="s0">class </span><span class="s1">TestDSTIVFloat</span><span class="s2">(</span><span class="s1">_TestDSTIVBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">4</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>


<span class="s0">class </span><span class="s1">TestDSTIVInt</span><span class="s2">(</span><span class="s1">_TestDSTIVBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">5</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>


<span class="s0">class </span><span class="s1">_TestIDSTBase</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">test_definition</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">FFTWDATA_SIZES</span><span class="s2">:</span>
            <span class="s1">xr</span><span class="s2">, </span><span class="s1">yr</span><span class="s2">, </span><span class="s1">dt </span><span class="s2">= </span><span class="s1">fftw_dst_ref</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rdt</span><span class="s2">)</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">idst</span><span class="s2">(</span><span class="s1">yr</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">== </span><span class="s5">1</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">/= </span><span class="s5">2 </span><span class="s2">* (</span><span class="s1">i</span><span class="s2">+</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">x </span><span class="s2">/= </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">i</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">)</span>
            <span class="s3"># XXX: we divide by np.max(x) because the tests fail otherwise. We</span>
            <span class="s3"># should really use something like assert_array_approx_equal. The</span>
            <span class="s3"># difference is due to fftw using a better algorithm w.r.t error</span>
            <span class="s3"># propagation compared to the ones from fftpack.</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">x </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">xr </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">,</span>
                    <span class="s1">err_msg</span><span class="s2">=</span><span class="s4">&quot;Size %d failed&quot; </span><span class="s2">% </span><span class="s1">i</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIDSTIDouble</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">12</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestIDSTIFloat</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">4</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestIDSTIInt</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">4</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">1</span>


<span class="s0">class </span><span class="s1">TestIDSTIIDouble</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestIDSTIIFloat</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">6</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestIDSTIIInt</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">6</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">2</span>


<span class="s0">class </span><span class="s1">TestIDSTIIIDouble</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestIDSTIIIFloat</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">6</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestIDSTIIIInt</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">6</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">3</span>


<span class="s0">class </span><span class="s1">TestIDSTIVDouble</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">12</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>


<span class="s0">class </span><span class="s1">TestIDSTIVFloat</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">6</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>


<span class="s0">class </span><span class="s1">TestIDSTIVnt</span><span class="s2">(</span><span class="s1">_TestIDSTBase</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rdt </span><span class="s2">= </span><span class="s1">int</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dec </span><span class="s2">= </span><span class="s5">6</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s5">4</span>


<span class="s0">class </span><span class="s1">TestOverwrite</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Check input overwrite behavior.&quot;&quot;&quot;</span>

    <span class="s1">real_dtypes </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">_check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">routine</span><span class="s2">, </span><span class="s1">type</span><span class="s2">, </span><span class="s1">fftsize</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">, </span><span class="s1">overwrite_x</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">):</span>
        <span class="s1">x2 </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">routine</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s1">type</span><span class="s2">, </span><span class="s1">fftsize</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">, </span><span class="s1">overwrite_x</span><span class="s2">=</span><span class="s1">overwrite_x</span><span class="s2">)</span>

        <span class="s1">sig </span><span class="s2">= </span><span class="s4">&quot;{}({}{!r}, {!r}, axis={!r}, overwrite_x={!r})&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
            <span class="s1">routine</span><span class="s2">.</span><span class="s1">__name__</span><span class="s2">, </span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">fftsize</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">, </span><span class="s1">overwrite_x</span><span class="s2">)</span>
        <span class="s0">if not </span><span class="s1">overwrite_x</span><span class="s2">:</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s4">&quot;spurious overwrite in %s&quot; </span><span class="s2">% </span><span class="s1">sig</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">routine</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">1234</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">issubdtype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complexfloating</span><span class="s2">):</span>
            <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(*</span><span class="s1">shape</span><span class="s2">) + </span><span class="s5">1j</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(*</span><span class="s1">shape</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(*</span><span class="s1">shape</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>

        <span class="s0">for </span><span class="s1">type </span><span class="s0">in </span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">overwrite_x </span><span class="s0">in </span><span class="s2">[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]:</span>
                <span class="s0">for </span><span class="s1">norm </span><span class="s0">in </span><span class="s2">[</span><span class="s0">None</span><span class="s2">, </span><span class="s4">'ortho'</span><span class="s2">]:</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_check</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">routine</span><span class="s2">, </span><span class="s1">type</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">,</span>
                                <span class="s1">overwrite_x</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dct</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">real_dtypes</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">dct</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">,), -</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">dct</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s5">0</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">dct</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">16</span><span class="s2">), </span><span class="s5">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_idct</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">real_dtypes</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">idct</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">,), -</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">idct</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s5">0</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">idct</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">16</span><span class="s2">), </span><span class="s5">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dst</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">real_dtypes</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">dst</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">,), -</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">dst</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s5">0</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">dst</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">16</span><span class="s2">), </span><span class="s5">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_idst</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">real_dtypes</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">idst</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">,), -</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">idst</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">16</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s5">0</span><span class="s2">)</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_check_1d</span><span class="s2">(</span><span class="s1">idst</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">16</span><span class="s2">), </span><span class="s5">1</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">Test_DCTN_IDCTN</span><span class="s2">:</span>
    <span class="s1">dec </span><span class="s2">= </span><span class="s5">14</span>
    <span class="s1">dct_type </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">norms </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">, </span><span class="s4">'ortho'</span><span class="s2">]</span>
    <span class="s1">rstate </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s5">1234</span><span class="s2">)</span>
    <span class="s1">shape </span><span class="s2">= (</span><span class="s5">32</span><span class="s2">, </span><span class="s5">16</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">rstate</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(*</span><span class="s1">shape</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'fforward,finverse'</span><span class="s2">, [(</span><span class="s1">dctn</span><span class="s2">, </span><span class="s1">idctn</span><span class="s2">),</span>
                                                   <span class="s2">(</span><span class="s1">dstn</span><span class="s2">, </span><span class="s1">idstn</span><span class="s2">)])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'axes'</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">,</span>
                                      <span class="s5">1</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">,), [</span><span class="s5">1</span><span class="s2">],</span>
                                      <span class="s5">0</span><span class="s2">, (</span><span class="s5">0</span><span class="s2">,), [</span><span class="s5">0</span><span class="s2">],</span>
                                      <span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                                      <span class="s2">(-</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">), [-</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'dct_type'</span><span class="s2">, </span><span class="s1">dct_type</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'norm'</span><span class="s2">, [</span><span class="s4">'ortho'</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_axes_round_trip</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fforward</span><span class="s2">, </span><span class="s1">finverse</span><span class="s2">, </span><span class="s1">axes</span><span class="s2">, </span><span class="s1">dct_type</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">):</span>
        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">fforward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">dct_type</span><span class="s2">, </span><span class="s1">axes</span><span class="s2">=</span><span class="s1">axes</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">finverse</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">dct_type</span><span class="s2">, </span><span class="s1">axes</span><span class="s2">=</span><span class="s1">axes</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">12</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'fforward,fforward_ref'</span><span class="s2">, [(</span><span class="s1">dctn</span><span class="s2">, </span><span class="s1">dct_2d_ref</span><span class="s2">),</span>
                                                       <span class="s2">(</span><span class="s1">dstn</span><span class="s2">, </span><span class="s1">dst_2d_ref</span><span class="s2">)])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'dct_type'</span><span class="s2">, </span><span class="s1">dct_type</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'norm'</span><span class="s2">, </span><span class="s1">norms</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_dctn_vs_2d_reference</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fforward</span><span class="s2">, </span><span class="s1">fforward_ref</span><span class="s2">,</span>
                                  <span class="s1">dct_type</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">):</span>
        <span class="s1">y1 </span><span class="s2">= </span><span class="s1">fforward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">dct_type</span><span class="s2">, </span><span class="s1">axes</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
        <span class="s1">y2 </span><span class="s2">= </span><span class="s1">fforward_ref</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">dct_type</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">11</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'finverse,finverse_ref'</span><span class="s2">, [(</span><span class="s1">idctn</span><span class="s2">, </span><span class="s1">idct_2d_ref</span><span class="s2">),</span>
                                                       <span class="s2">(</span><span class="s1">idstn</span><span class="s2">, </span><span class="s1">idst_2d_ref</span><span class="s2">)])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'dct_type'</span><span class="s2">, </span><span class="s1">dct_type</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'norm'</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s4">'ortho'</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_idctn_vs_2d_reference</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">finverse</span><span class="s2">, </span><span class="s1">finverse_ref</span><span class="s2">,</span>
                                   <span class="s1">dct_type</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">):</span>
        <span class="s1">fdata </span><span class="s2">= </span><span class="s1">dctn</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">dct_type</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
        <span class="s1">y1 </span><span class="s2">= </span><span class="s1">finverse</span><span class="s2">(</span><span class="s1">fdata</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">dct_type</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
        <span class="s1">y2 </span><span class="s2">= </span><span class="s1">finverse_ref</span><span class="s2">(</span><span class="s1">fdata</span><span class="s2">, </span><span class="s1">type</span><span class="s2">=</span><span class="s1">dct_type</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">11</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'fforward,finverse'</span><span class="s2">, [(</span><span class="s1">dctn</span><span class="s2">, </span><span class="s1">idctn</span><span class="s2">),</span>
                                                   <span class="s2">(</span><span class="s1">dstn</span><span class="s2">, </span><span class="s1">idstn</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_axes_and_shape</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fforward</span><span class="s2">, </span><span class="s1">finverse</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;when given, axes and shape arguments&quot;</span>
                           <span class="s4">&quot; have to be of the same length&quot;</span><span class="s2">):</span>
            <span class="s1">fforward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">axes</span><span class="s2">=(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>

        <span class="s0">with </span><span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;when given, axes and shape arguments&quot;</span>
                           <span class="s4">&quot; have to be of the same length&quot;</span><span class="s2">):</span>
            <span class="s1">fforward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">axes</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;when given, axes and shape arguments&quot;</span>
                           <span class="s4">&quot; have to be of the same length&quot;</span><span class="s2">):</span>
            <span class="s1">fforward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">axes</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'fforward'</span><span class="s2">, [</span><span class="s1">dctn</span><span class="s2">, </span><span class="s1">dstn</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_shape</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fforward</span><span class="s2">):</span>
        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">fforward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">=(</span><span class="s5">128</span><span class="s2">, </span><span class="s5">128</span><span class="s2">), </span><span class="s1">axes</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s5">128</span><span class="s2">, </span><span class="s5">128</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'fforward,finverse'</span><span class="s2">, [(</span><span class="s1">dctn</span><span class="s2">, </span><span class="s1">idctn</span><span class="s2">),</span>
                                                   <span class="s2">(</span><span class="s1">dstn</span><span class="s2">, </span><span class="s1">idstn</span><span class="s2">)])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'axes'</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">,), [</span><span class="s5">1</span><span class="s2">],</span>
                                      <span class="s5">0</span><span class="s2">, (</span><span class="s5">0</span><span class="s2">,), [</span><span class="s5">0</span><span class="s2">]])</span>
    <span class="s0">def </span><span class="s1">test_shape_is_none_with_axes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fforward</span><span class="s2">, </span><span class="s1">finverse</span><span class="s2">, </span><span class="s1">axes</span><span class="s2">):</span>
        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">fforward</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">axes</span><span class="s2">=</span><span class="s1">axes</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">)</span>
        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">finverse</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">axes</span><span class="s2">=</span><span class="s1">axes</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s4">'ortho'</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dec</span><span class="s2">)</span>
</pre>
</body>
</html>