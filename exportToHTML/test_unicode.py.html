<html>
<head>
<title>test_unicode.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
.s6 { color: #5f826b; font-style: italic;}
.s7 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_unicode.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_</span><span class="s2">, </span><span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_array_equal</span>

<span class="s0">def </span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s0">if not </span><span class="s1">arr</span><span class="s2">:</span>
            <span class="s1">charmax </span><span class="s2">= </span><span class="s3">0</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">charmax </span><span class="s2">= </span><span class="s1">max</span><span class="s2">([</span><span class="s1">ord</span><span class="s2">(</span><span class="s1">c</span><span class="s2">) </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">arr</span><span class="s2">])</span>
        <span class="s0">if </span><span class="s1">charmax </span><span class="s2">&lt; </span><span class="s3">256</span><span class="s2">:</span>
            <span class="s1">size </span><span class="s2">= </span><span class="s3">1</span>
        <span class="s0">elif </span><span class="s1">charmax </span><span class="s2">&lt; </span><span class="s3">65536</span><span class="s2">:</span>
            <span class="s1">size </span><span class="s2">= </span><span class="s3">2</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">size </span><span class="s2">= </span><span class="s3">4</span>
        <span class="s0">return </span><span class="s1">size </span><span class="s2">* </span><span class="s1">len</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">)</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">memoryview</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">v</span><span class="s2">.</span><span class="s1">shape </span><span class="s0">is None</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) * </span><span class="s1">v</span><span class="s2">.</span><span class="s1">itemsize</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">np</span><span class="s2">.</span><span class="s1">prod</span><span class="s2">(</span><span class="s1">v</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">) * </span><span class="s1">v</span><span class="s2">.</span><span class="s1">itemsize</span>


<span class="s4"># In both cases below we need to make sure that the byte swapped value (as</span>
<span class="s4"># UCS4) is still a valid unicode:</span>
<span class="s4"># Value that can be represented in UCS2 interpreters</span>
<span class="s1">ucs2_value </span><span class="s2">= </span><span class="s5">'</span><span class="s0">\u0900</span><span class="s5">'</span>
<span class="s4"># Value that cannot be represented in UCS2 interpreters (but can in UCS4)</span>
<span class="s1">ucs4_value </span><span class="s2">= </span><span class="s5">'</span><span class="s0">\U00100900</span><span class="s5">'</span>


<span class="s0">def </span><span class="s1">test_string_cast</span><span class="s2">():</span>
    <span class="s1">str_arr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">&quot;1234&quot;</span><span class="s2">, </span><span class="s5">&quot;1234</span><span class="s0">\0\0</span><span class="s5">&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'S'</span><span class="s2">)</span>
    <span class="s1">uni_arr1 </span><span class="s2">= </span><span class="s1">str_arr</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s5">'&gt;U'</span><span class="s2">)</span>
    <span class="s1">uni_arr2 </span><span class="s2">= </span><span class="s1">str_arr</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s5">'&lt;U'</span><span class="s2">)</span>

    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">str_arr </span><span class="s2">!= </span><span class="s1">uni_arr1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">))</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">uni_arr1 </span><span class="s2">!= </span><span class="s1">str_arr</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">))</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">str_arr </span><span class="s2">== </span><span class="s1">uni_arr1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">))</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">uni_arr1 </span><span class="s2">== </span><span class="s1">str_arr</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">))</span>

    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">uni_arr1</span><span class="s2">, </span><span class="s1">uni_arr2</span><span class="s2">)</span>


<span class="s4">############################################################</span>
<span class="s4">#    Creation tests</span>
<span class="s4">############################################################</span>

<span class="s0">class </span><span class="s1">CreateZeros</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of zero-valued arrays&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua_scalar</span><span class="s2">, </span><span class="s1">nbytes</span><span class="s2">):</span>

        <span class="s4"># Check the length of the unicode base type</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">int</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">str</span><span class="s2">[</span><span class="s3">2</span><span class="s2">:]) == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s4"># Check the length of the data buffer</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">) == </span><span class="s1">nbytes</span><span class="s2">)</span>
        <span class="s4"># Small check that data in array element is ok</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua_scalar </span><span class="s2">== </span><span class="s5">''</span><span class="s2">)</span>
        <span class="s4"># Encode to ascii and double check</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua_scalar</span><span class="s2">.</span><span class="s1">encode</span><span class="s2">(</span><span class="s5">'ascii'</span><span class="s2">) == </span><span class="s7">b''</span><span class="s2">)</span>
        <span class="s4"># Check buffer lengths for scalars</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">ua_scalar</span><span class="s2">) == </span><span class="s3">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zeros0D</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check creation of 0-dimensional objects</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[()], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zerosSD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check creation of single-dimensional objects</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s3">2</span><span class="s2">,), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_zerosMD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check creation of multi-dimensional objects</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">*</span><span class="s3">3</span><span class="s2">*</span><span class="s3">4</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">*</span><span class="s3">3</span><span class="s2">*</span><span class="s3">4</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestCreateZeros_1</span><span class="s2">(</span><span class="s1">CreateZeros</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of zero-valued arrays (size 1)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1</span>


<span class="s0">class </span><span class="s1">TestCreateZeros_2</span><span class="s2">(</span><span class="s1">CreateZeros</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of zero-valued arrays (size 2)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">2</span>


<span class="s0">class </span><span class="s1">TestCreateZeros_1009</span><span class="s2">(</span><span class="s1">CreateZeros</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of zero-valued arrays (size 1009)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1009</span>


<span class="s0">class </span><span class="s1">CreateValues</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of unicode arrays with values&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua_scalar</span><span class="s2">, </span><span class="s1">nbytes</span><span class="s2">):</span>

        <span class="s4"># Check the length of the unicode base type</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">int</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">str</span><span class="s2">[</span><span class="s3">2</span><span class="s2">:]) == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s4"># Check the length of the data buffer</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">) == </span><span class="s1">nbytes</span><span class="s2">)</span>
        <span class="s4"># Small check that data in array element is ok</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua_scalar </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s4"># Encode to UTF-8 and double check</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua_scalar</span><span class="s2">.</span><span class="s1">encode</span><span class="s2">(</span><span class="s5">'utf-8'</span><span class="s2">) ==</span>
                        <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">).</span><span class="s1">encode</span><span class="s2">(</span><span class="s5">'utf-8'</span><span class="s2">))</span>
        <span class="s4"># Check buffer lengths for scalars</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value </span><span class="s2">== </span><span class="s1">ucs4_value</span><span class="s2">:</span>
            <span class="s4"># In UCS2, the \U0010FFFF will be represented using a</span>
            <span class="s4"># surrogate *pair*</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">ua_scalar</span><span class="s2">) == </span><span class="s3">2</span><span class="s2">*</span><span class="s3">2</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s4"># In UCS2, the \uFFFF will be represented using a</span>
            <span class="s4"># regular 2-byte word</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">ua_scalar</span><span class="s2">) == </span><span class="s3">2</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_values0D</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check creation of 0-dimensional objects with values</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[()], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_valuesSD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check creation of single-dimensional objects with values</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">]*</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_valuesMD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check creation of multi-dimensional objects with values</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">]*</span><span class="s3">2</span><span class="s2">]*</span><span class="s3">3</span><span class="s2">]*</span><span class="s3">4</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">*</span><span class="s3">3</span><span class="s2">*</span><span class="s3">4</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">*</span><span class="s3">3</span><span class="s2">*</span><span class="s3">4</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestCreateValues_1_UCS2</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of valued arrays (size 1, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestCreateValues_1_UCS4</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of valued arrays (size 1, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>


<span class="s0">class </span><span class="s1">TestCreateValues_2_UCS2</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of valued arrays (size 2, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">2</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestCreateValues_2_UCS4</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of valued arrays (size 2, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">2</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>


<span class="s0">class </span><span class="s1">TestCreateValues_1009_UCS2</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of valued arrays (size 1009, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1009</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestCreateValues_1009_UCS4</span><span class="s2">(</span><span class="s1">CreateValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the creation of valued arrays (size 1009, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1009</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>


<span class="s4">############################################################</span>
<span class="s4">#    Assignment tests</span>
<span class="s4">############################################################</span>

<span class="s0">class </span><span class="s1">AssignValues</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Check the assignment of unicode arrays with values&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua_scalar</span><span class="s2">, </span><span class="s1">nbytes</span><span class="s2">):</span>

        <span class="s4"># Check the length of the unicode base type</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">int</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">str</span><span class="s2">[</span><span class="s3">2</span><span class="s2">:]) == </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s4"># Check the length of the data buffer</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">) == </span><span class="s1">nbytes</span><span class="s2">)</span>
        <span class="s4"># Small check that data in array element is ok</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua_scalar </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s4"># Encode to UTF-8 and double check</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua_scalar</span><span class="s2">.</span><span class="s1">encode</span><span class="s2">(</span><span class="s5">'utf-8'</span><span class="s2">) ==</span>
                        <span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">).</span><span class="s1">encode</span><span class="s2">(</span><span class="s5">'utf-8'</span><span class="s2">))</span>
        <span class="s4"># Check buffer lengths for scalars</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value </span><span class="s2">== </span><span class="s1">ucs4_value</span><span class="s2">:</span>
            <span class="s4"># In UCS2, the \U0010FFFF will be represented using a</span>
            <span class="s4"># surrogate *pair*</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">ua_scalar</span><span class="s2">) == </span><span class="s3">2</span><span class="s2">*</span><span class="s3">2</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s4"># In UCS2, the \uFFFF will be represented using a</span>
            <span class="s4"># regular 2-byte word</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">buffer_length</span><span class="s2">(</span><span class="s1">ua_scalar</span><span class="s2">) == </span><span class="s3">2</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_values0D</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check assignment of 0-dimensional objects with values</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">ua</span><span class="s2">[()] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[()], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_valuesSD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check assignment of single-dimensional objects with values</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s3">2</span><span class="s2">,), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">ua</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">)</span>
        <span class="s1">ua</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">1</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_valuesMD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check assignment of multi-dimensional objects with values</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">, </span><span class="s3">4</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">ua</span><span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">*</span><span class="s3">3</span><span class="s2">*</span><span class="s3">4</span><span class="s2">)</span>
        <span class="s1">ua</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content_check</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">], </span><span class="s3">4</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">*</span><span class="s3">2</span><span class="s2">*</span><span class="s3">3</span><span class="s2">*</span><span class="s3">4</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestAssignValues_1_UCS2</span><span class="s2">(</span><span class="s1">AssignValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the assignment of valued arrays (size 1, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestAssignValues_1_UCS4</span><span class="s2">(</span><span class="s1">AssignValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the assignment of valued arrays (size 1, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>


<span class="s0">class </span><span class="s1">TestAssignValues_2_UCS2</span><span class="s2">(</span><span class="s1">AssignValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the assignment of valued arrays (size 2, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">2</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestAssignValues_2_UCS4</span><span class="s2">(</span><span class="s1">AssignValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the assignment of valued arrays (size 2, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">2</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>


<span class="s0">class </span><span class="s1">TestAssignValues_1009_UCS2</span><span class="s2">(</span><span class="s1">AssignValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the assignment of valued arrays (size 1009, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1009</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestAssignValues_1009_UCS4</span><span class="s2">(</span><span class="s1">AssignValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the assignment of valued arrays (size 1009, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1009</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>


<span class="s4">############################################################</span>
<span class="s4">#    Byteorder tests</span>
<span class="s4">############################################################</span>

<span class="s0">class </span><span class="s1">ByteorderValues</span><span class="s2">:</span>
    <span class="s6">&quot;&quot;&quot;Check the byteorder of unicode arrays in round-trip conversions&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">test_values0D</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check byteorder of 0-dimensional objects</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">ua2 </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">newbyteorder</span><span class="s2">())</span>
        <span class="s4"># This changes the interpretation of the data region (but not the</span>
        <span class="s4">#  actual data), therefore the returned scalars are not</span>
        <span class="s4">#  the same (they are byte-swapped versions of each other).</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">[()] != </span><span class="s1">ua2</span><span class="s2">[()])</span>
        <span class="s1">ua3 </span><span class="s2">= </span><span class="s1">ua2</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s1">ua2</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">newbyteorder</span><span class="s2">())</span>
        <span class="s4"># Arrays must be equal after the round-trip</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_valuesSD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check byteorder of single-dimensional objects</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">]*</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">ua2 </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">newbyteorder</span><span class="s2">())</span>
        <span class="s1">assert_</span><span class="s2">((</span><span class="s1">ua </span><span class="s2">!= </span><span class="s1">ua2</span><span class="s2">).</span><span class="s1">all</span><span class="s2">())</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] != </span><span class="s1">ua2</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">ua3 </span><span class="s2">= </span><span class="s1">ua2</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s1">ua2</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">newbyteorder</span><span class="s2">())</span>
        <span class="s4"># Arrays must be equal after the round-trip</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_valuesMD</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check byteorder of multi-dimensional objects</span>
        <span class="s1">ua </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[[</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">]*</span><span class="s3">2</span><span class="s2">]*</span><span class="s3">3</span><span class="s2">]*</span><span class="s3">4</span><span class="s2">,</span>
                      <span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">ua2 </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">newbyteorder</span><span class="s2">())</span>
        <span class="s1">assert_</span><span class="s2">((</span><span class="s1">ua </span><span class="s2">!= </span><span class="s1">ua2</span><span class="s2">).</span><span class="s1">all</span><span class="s2">())</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">] != </span><span class="s1">ua2</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s1">ua3 </span><span class="s2">= </span><span class="s1">ua2</span><span class="s2">.</span><span class="s1">view</span><span class="s2">(</span><span class="s1">ua2</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">newbyteorder</span><span class="s2">())</span>
        <span class="s4"># Arrays must be equal after the round-trip</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_values_cast</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check byteorder of when casting the array for a strided and</span>
        <span class="s4"># contiguous array:</span>
        <span class="s1">test1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">]*</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">test2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">test1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">)[::</span><span class="s3">2</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">ua </span><span class="s0">in </span><span class="s2">(</span><span class="s1">test1</span><span class="s2">, </span><span class="s1">test2</span><span class="s2">):</span>
            <span class="s1">ua2 </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">newbyteorder</span><span class="s2">())</span>
            <span class="s1">assert_</span><span class="s2">((</span><span class="s1">ua </span><span class="s2">== </span><span class="s1">ua2</span><span class="s2">).</span><span class="s1">all</span><span class="s2">())</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s1">ua2</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">])</span>
            <span class="s1">ua3 </span><span class="s2">= </span><span class="s1">ua2</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
            <span class="s4"># Arrays must be equal after the round-trip</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_values_updowncast</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s4"># Check byteorder of when casting the array to a longer and shorter</span>
        <span class="s4"># string length for strided and contiguous arrays</span>
        <span class="s1">test1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ucs_value</span><span class="s2">*</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">]*</span><span class="s3">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'U%s' </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">)</span>
        <span class="s1">test2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">test1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">)[::</span><span class="s3">2</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">ua </span><span class="s0">in </span><span class="s2">(</span><span class="s1">test1</span><span class="s2">, </span><span class="s1">test2</span><span class="s2">):</span>
            <span class="s4"># Cast to a longer type with zero padding</span>
            <span class="s1">longer_type </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s5">'U%s' </span><span class="s2">% (</span><span class="s1">self</span><span class="s2">.</span><span class="s1">ulen</span><span class="s2">+</span><span class="s3">1</span><span class="s2">)).</span><span class="s1">newbyteorder</span><span class="s2">()</span>
            <span class="s1">ua2 </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">longer_type</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">((</span><span class="s1">ua </span><span class="s2">== </span><span class="s1">ua2</span><span class="s2">).</span><span class="s1">all</span><span class="s2">())</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s1">ua2</span><span class="s2">[-</span><span class="s3">1</span><span class="s2">])</span>
            <span class="s4"># Cast back again with truncating:</span>
            <span class="s1">ua3 </span><span class="s2">= </span><span class="s1">ua2</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">ua</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
            <span class="s4"># Arrays must be equal after the round-trip</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">, </span><span class="s1">ua3</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestByteorder_1_UCS2</span><span class="s2">(</span><span class="s1">ByteorderValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the byteorder in unicode (size 1, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestByteorder_1_UCS4</span><span class="s2">(</span><span class="s1">ByteorderValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the byteorder in unicode (size 1, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>


<span class="s0">class </span><span class="s1">TestByteorder_2_UCS2</span><span class="s2">(</span><span class="s1">ByteorderValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the byteorder in unicode (size 2, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">2</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestByteorder_2_UCS4</span><span class="s2">(</span><span class="s1">ByteorderValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the byteorder in unicode (size 2, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">2</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>


<span class="s0">class </span><span class="s1">TestByteorder_1009_UCS2</span><span class="s2">(</span><span class="s1">ByteorderValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the byteorder in unicode (size 1009, UCS2 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1009</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs2_value</span>


<span class="s0">class </span><span class="s1">TestByteorder_1009_UCS4</span><span class="s2">(</span><span class="s1">ByteorderValues</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check the byteorder in unicode (size 1009, UCS4 values)&quot;&quot;&quot;</span>
    <span class="s1">ulen </span><span class="s2">= </span><span class="s3">1009</span>
    <span class="s1">ucs_value </span><span class="s2">= </span><span class="s1">ucs4_value</span>
</pre>
</body>
</html>