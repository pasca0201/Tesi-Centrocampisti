<html>
<head>
<title>test_filter_design.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_filter_design.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">_lib </span><span class="s0">import </span><span class="s1">_pep440</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span><span class="s1">assert_array_almost_equal</span><span class="s2">,</span>
                           <span class="s1">assert_array_almost_equal_nulp</span><span class="s2">,</span>
                           <span class="s1">assert_array_equal</span><span class="s2">, </span><span class="s1">assert_array_less</span><span class="s2">,</span>
                           <span class="s1">assert_equal</span><span class="s2">, </span><span class="s1">assert_</span><span class="s2">,</span>
                           <span class="s1">assert_allclose</span><span class="s2">, </span><span class="s1">assert_warns</span><span class="s2">, </span><span class="s1">suppress_warnings</span><span class="s2">)</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>

<span class="s0">from </span><span class="s1">numpy </span><span class="s0">import </span><span class="s1">array</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">, </span><span class="s1">sin</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s1">sort</span><span class="s2">, </span><span class="s1">sqrt</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">signal </span><span class="s0">import </span><span class="s2">(</span><span class="s1">argrelextrema</span><span class="s2">, </span><span class="s1">BadCoefficients</span><span class="s2">, </span><span class="s1">bessel</span><span class="s2">, </span><span class="s1">besselap</span><span class="s2">, </span><span class="s1">bilinear</span><span class="s2">,</span>
                          <span class="s1">buttap</span><span class="s2">, </span><span class="s1">butter</span><span class="s2">, </span><span class="s1">buttord</span><span class="s2">, </span><span class="s1">cheb1ap</span><span class="s2">, </span><span class="s1">cheb1ord</span><span class="s2">, </span><span class="s1">cheb2ap</span><span class="s2">,</span>
                          <span class="s1">cheb2ord</span><span class="s2">, </span><span class="s1">cheby1</span><span class="s2">, </span><span class="s1">cheby2</span><span class="s2">, </span><span class="s1">ellip</span><span class="s2">, </span><span class="s1">ellipap</span><span class="s2">, </span><span class="s1">ellipord</span><span class="s2">,</span>
                          <span class="s1">firwin</span><span class="s2">, </span><span class="s1">freqs_zpk</span><span class="s2">, </span><span class="s1">freqs</span><span class="s2">, </span><span class="s1">freqz</span><span class="s2">, </span><span class="s1">freqz_zpk</span><span class="s2">,</span>
                          <span class="s1">gammatone</span><span class="s2">, </span><span class="s1">group_delay</span><span class="s2">, </span><span class="s1">iircomb</span><span class="s2">, </span><span class="s1">iirdesign</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">,</span>
                          <span class="s1">iirnotch</span><span class="s2">, </span><span class="s1">iirpeak</span><span class="s2">, </span><span class="s1">lp2bp</span><span class="s2">, </span><span class="s1">lp2bs</span><span class="s2">, </span><span class="s1">lp2hp</span><span class="s2">, </span><span class="s1">lp2lp</span><span class="s2">, </span><span class="s1">normalize</span><span class="s2">,</span>
                          <span class="s1">medfilt</span><span class="s2">, </span><span class="s1">order_filter</span><span class="s2">,</span>
                          <span class="s1">sos2tf</span><span class="s2">, </span><span class="s1">sos2zpk</span><span class="s2">, </span><span class="s1">sosfreqz</span><span class="s2">, </span><span class="s1">tf2sos</span><span class="s2">, </span><span class="s1">tf2zpk</span><span class="s2">, </span><span class="s1">zpk2sos</span><span class="s2">,</span>
                          <span class="s1">zpk2tf</span><span class="s2">, </span><span class="s1">bilinear_zpk</span><span class="s2">, </span><span class="s1">lp2lp_zpk</span><span class="s2">, </span><span class="s1">lp2hp_zpk</span><span class="s2">, </span><span class="s1">lp2bp_zpk</span><span class="s2">,</span>
                          <span class="s1">lp2bs_zpk</span><span class="s2">)</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">signal</span><span class="s2">.</span><span class="s1">_filter_design </span><span class="s0">import </span><span class="s2">(</span><span class="s1">_cplxreal</span><span class="s2">, </span><span class="s1">_cplxpair</span><span class="s2">, </span><span class="s1">_norm_factor</span><span class="s2">,</span>
                                        <span class="s1">_bessel_poly</span><span class="s2">, </span><span class="s1">_bessel_zeros</span><span class="s2">)</span>

<span class="s0">try</span><span class="s2">:</span>
    <span class="s0">import </span><span class="s1">mpmath</span>
<span class="s0">except </span><span class="s1">ImportError</span><span class="s2">:</span>
    <span class="s1">mpmath </span><span class="s2">= </span><span class="s0">None</span>


<span class="s0">def </span><span class="s1">mpmath_check</span><span class="s2">(</span><span class="s1">min_ver</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span>
        <span class="s1">mpmath </span><span class="s0">is None</span>
        <span class="s0">or </span><span class="s1">_pep440</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">mpmath</span><span class="s2">.</span><span class="s1">__version__</span><span class="s2">) &lt; </span><span class="s1">_pep440</span><span class="s2">.</span><span class="s1">Version</span><span class="s2">(</span><span class="s1">min_ver</span><span class="s2">),</span>
        <span class="s1">reason</span><span class="s2">=</span><span class="s3">f&quot;mpmath version &gt;= </span><span class="s0">{</span><span class="s1">min_ver</span><span class="s0">} </span><span class="s3">required&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestCplxPair</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_trivial_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">([]).</span><span class="s1">size</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">(</span><span class="s4">1</span><span class="s2">), </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_output_order</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">([</span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">]), [</span><span class="s4">1</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">])</span>

        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">(</span><span class="s1">a</span><span class="s2">), </span><span class="s1">b</span><span class="s2">)</span>

        <span class="s5"># points spaced around the unit circle</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s4">2j</span><span class="s2">*</span><span class="s1">pi</span><span class="s2">*</span><span class="s1">array</span><span class="s2">([</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])/</span><span class="s4">7</span><span class="s2">)</span>
        <span class="s1">z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">shuffle</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">z1</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">shuffle</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">z1</span><span class="s2">)</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">shuffle</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">z1</span><span class="s2">)</span>

        <span class="s5"># Should be able to pair up all the conjugates</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">10000</span><span class="s2">) + </span><span class="s4">1j </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">10000</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">()</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">10000</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">))</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">shuffle</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">_cplxpair</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s5"># Every other element of head should be conjugates:</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">c</span><span class="s2">[</span><span class="s4">0</span><span class="s2">:</span><span class="s4">20000</span><span class="s2">:</span><span class="s4">2</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">c</span><span class="s2">[</span><span class="s4">1</span><span class="s2">:</span><span class="s4">20000</span><span class="s2">:</span><span class="s4">2</span><span class="s2">]))</span>
        <span class="s5"># Real parts of head should be in sorted order:</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">c</span><span class="s2">[</span><span class="s4">0</span><span class="s2">:</span><span class="s4">20000</span><span class="s2">:</span><span class="s4">2</span><span class="s2">].</span><span class="s1">real</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">c</span><span class="s2">[</span><span class="s4">0</span><span class="s2">:</span><span class="s4">20000</span><span class="s2">:</span><span class="s4">2</span><span class="s2">].</span><span class="s1">real</span><span class="s2">))</span>
        <span class="s5"># Tail should be sorted real numbers:</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">c</span><span class="s2">[</span><span class="s4">20000</span><span class="s2">:], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">c</span><span class="s2">[</span><span class="s4">20000</span><span class="s2">:]))</span>

    <span class="s0">def </span><span class="s1">test_real_integer_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]), [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_tolerances</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">eps </span><span class="s2">= </span><span class="s1">spacing</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">([</span><span class="s4">1j</span><span class="s2">, -</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">*</span><span class="s1">eps</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s4">2</span><span class="s2">*</span><span class="s1">eps</span><span class="s2">),</span>
                        <span class="s2">[-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">*</span><span class="s1">eps</span><span class="s2">])</span>

        <span class="s5"># sorting close to 0</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">([-</span><span class="s1">eps</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, +</span><span class="s1">eps</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">]), [-</span><span class="s4">1j</span><span class="s2">, +</span><span class="s4">1j</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">([+</span><span class="s1">eps</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, -</span><span class="s1">eps</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">]), [-</span><span class="s4">1j</span><span class="s2">, +</span><span class="s4">1j</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">([+</span><span class="s4">1j</span><span class="s2">, -</span><span class="s4">1j</span><span class="s2">]), [-</span><span class="s4">1j</span><span class="s2">, +</span><span class="s4">1j</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_unmatched_conjugates</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 1+2j is unmatched</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxpair</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">])</span>

        <span class="s5"># 1+2j and 1-3j are unmatched</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxpair</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">])</span>

        <span class="s5"># 1+3j is unmatched</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxpair</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">])</span>

        <span class="s5"># Not conjugates</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxpair</span><span class="s2">, [</span><span class="s4">4</span><span class="s2">+</span><span class="s4">5j</span><span class="s2">, </span><span class="s4">4</span><span class="s2">+</span><span class="s4">5j</span><span class="s2">])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxpair</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">-</span><span class="s4">7j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">7j</span><span class="s2">])</span>

        <span class="s5"># No pairs</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxpair</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxpair</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestCplxReal</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_trivial_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">_cplxreal</span><span class="s2">([]), ([], []))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">_cplxreal</span><span class="s2">(</span><span class="s4">1</span><span class="s2">), ([], [</span><span class="s4">1</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_output_order</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">zc</span><span class="s2">, </span><span class="s1">zr </span><span class="s2">= </span><span class="s1">_cplxreal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">roots</span><span class="s2">(</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">zc</span><span class="s2">, </span><span class="s1">zr</span><span class="s2">), [</span><span class="s4">1</span><span class="s2">/</span><span class="s4">2 </span><span class="s2">+ </span><span class="s4">1j</span><span class="s2">*</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">pi</span><span class="s2">/</span><span class="s4">3</span><span class="s2">), -</span><span class="s4">1</span><span class="s2">])</span>

        <span class="s1">eps </span><span class="s2">= </span><span class="s1">spacing</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>

        <span class="s1">a </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s1">eps </span><span class="s2">+ </span><span class="s4">1j</span><span class="s2">, </span><span class="s1">eps </span><span class="s2">- </span><span class="s4">1j</span><span class="s2">, -</span><span class="s1">eps </span><span class="s2">+ </span><span class="s4">1j</span><span class="s2">, -</span><span class="s1">eps </span><span class="s2">- </span><span class="s4">1j</span><span class="s2">,</span>
             <span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
             <span class="s4">2</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">,</span>
             <span class="s4">1</span><span class="s2">-</span><span class="s1">eps </span><span class="s2">+ </span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s1">eps </span><span class="s2">- </span><span class="s4">1j</span><span class="s2">,  </span><span class="s5"># sorts out of order</span>
             <span class="s4">3</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">,</span>
             <span class="s4">2</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">]</span>
        <span class="s1">zc</span><span class="s2">, </span><span class="s1">zr </span><span class="s2">= </span><span class="s1">_cplxreal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">zc</span><span class="s2">, [</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">,</span>
                             <span class="s4">3</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">zr</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">])</span>

        <span class="s1">z </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">-</span><span class="s1">eps </span><span class="s2">+ </span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s1">eps </span><span class="s2">- </span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s1">eps</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">2</span><span class="s2">*</span><span class="s1">eps</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">,</span>
                   <span class="s4">0</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">+</span><span class="s4">4j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">-</span><span class="s4">4j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">+</span><span class="s4">7j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">-</span><span class="s4">7j</span><span class="s2">, </span><span class="s4">4</span><span class="s2">-</span><span class="s1">eps</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">,</span>
                   <span class="s4">4</span><span class="s2">+</span><span class="s1">eps</span><span class="s2">-</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">4</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">4</span><span class="s2">-</span><span class="s1">eps</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">])</span>

        <span class="s1">zc</span><span class="s2">, </span><span class="s1">zr </span><span class="s2">= </span><span class="s1">_cplxreal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">zc</span><span class="s2">, [</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">2</span><span class="s2">+</span><span class="s4">4j</span><span class="s2">, </span><span class="s4">3</span><span class="s2">+</span><span class="s4">7j</span><span class="s2">, </span><span class="s4">4</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">,</span>
                             <span class="s4">4</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">zr</span><span class="s2">, [])</span>

    <span class="s0">def </span><span class="s1">test_unmatched_conjugates</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 1+2j is unmatched</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxreal</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">])</span>

        <span class="s5"># 1+2j and 1-3j are unmatched</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxreal</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">])</span>

        <span class="s5"># 1+3j is unmatched</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxreal</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">])</span>

        <span class="s5"># No pairs</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxreal</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">+</span><span class="s4">3j</span><span class="s2">])</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_cplxreal</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">-</span><span class="s4">3j</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_real_integer_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">zc</span><span class="s2">, </span><span class="s1">zr </span><span class="s2">= </span><span class="s1">_cplxreal</span><span class="s2">([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">zc</span><span class="s2">, [])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">zr</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestTf2zpk</span><span class="s2">:</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'dt'</span><span class="s2">, (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">complex128</span><span class="s2">))</span>
    <span class="s0">def </span><span class="s1">test_simple</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">):</span>
        <span class="s1">z_r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">])</span>
        <span class="s1">p_r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.j </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), -</span><span class="s4">1.j </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)])</span>
        <span class="s5"># Sort the zeros/poles so that we don't fail the test if the order</span>
        <span class="s5"># changes</span>
        <span class="s1">z_r</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">()</span>
        <span class="s1">p_r</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">()</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">poly</span><span class="s2">(</span><span class="s1">z_r</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">poly</span><span class="s2">(</span><span class="s1">p_r</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>

        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">tf2zpk</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">z</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">()</span>
        <span class="s5"># The real part of `p` is ~0.0, so sort by imaginary part</span>
        <span class="s1">p </span><span class="s2">= </span><span class="s1">p</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">argsort</span><span class="s2">(</span><span class="s1">p</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">)]</span>

        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z_r</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">p_r</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">k</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">dt</span>

    <span class="s0">def </span><span class="s1">test_bad_filter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Regression test for #651: better handling of badly conditioned</span>
        <span class="s5"># filter coefficients.</span>
        <span class="s0">with </span><span class="s1">suppress_warnings</span><span class="s2">():</span>
            <span class="s1">warnings</span><span class="s2">.</span><span class="s1">simplefilter</span><span class="s2">(</span><span class="s3">&quot;error&quot;</span><span class="s2">, </span><span class="s1">BadCoefficients</span><span class="s2">)</span>
            <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">BadCoefficients</span><span class="s2">, </span><span class="s1">tf2zpk</span><span class="s2">, [</span><span class="s4">1e-15</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestZpk2Tf</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_identity</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Test the identity transfer function.&quot;&quot;&quot;</span>
        <span class="s1">z </span><span class="s2">= []</span>
        <span class="s1">p </span><span class="s2">= []</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">1.</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">zpk2tf</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">)</span>
        <span class="s1">b_r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.</span><span class="s2">])  </span><span class="s5"># desired result</span>
        <span class="s1">a_r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.</span><span class="s2">])  </span><span class="s5"># desired result</span>
        <span class="s5"># The test for the *type* of the return values is a regression</span>
        <span class="s5"># test for ticket #1095. In the case p=[], zpk2tf used to</span>
        <span class="s5"># return the scalar 1.0 instead of array([1.0]).</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b_r</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a_r</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestSos2Zpk</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">sos </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">0.81</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, +</span><span class="s4">0.49</span><span class="s2">]]</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">sos2zpk</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">1j</span><span class="s2">, -</span><span class="s4">1j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [</span><span class="s4">0.9</span><span class="s2">, -</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.7j</span><span class="s2">, -</span><span class="s4">0.7j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">1</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">)</span>

        <span class="s1">sos </span><span class="s2">= [[</span><span class="s4">1.00000</span><span class="s2">, +</span><span class="s4">0.61803</span><span class="s2">, </span><span class="s4">1.0000</span><span class="s2">, </span><span class="s4">1.00000</span><span class="s2">, +</span><span class="s4">0.60515</span><span class="s2">, </span><span class="s4">0.95873</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s4">1.00000</span><span class="s2">, -</span><span class="s4">1.61803</span><span class="s2">, </span><span class="s4">1.0000</span><span class="s2">, </span><span class="s4">1.00000</span><span class="s2">, -</span><span class="s4">1.58430</span><span class="s2">, </span><span class="s4">0.95873</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s4">1.00000</span><span class="s2">, +</span><span class="s4">1.00000</span><span class="s2">, </span><span class="s4">0.0000</span><span class="s2">, </span><span class="s4">1.00000</span><span class="s2">, +</span><span class="s4">0.97915</span><span class="s2">, </span><span class="s4">0.00000</span><span class="s2">]]</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">sos2zpk</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [-</span><span class="s4">0.3090 </span><span class="s2">+ </span><span class="s4">0.9511j</span><span class="s2">, -</span><span class="s4">0.3090 </span><span class="s2">- </span><span class="s4">0.9511j</span><span class="s2">, </span><span class="s4">0.8090 </span><span class="s2">+ </span><span class="s4">0.5878j</span><span class="s2">,</span>
              <span class="s4">0.8090 </span><span class="s2">- </span><span class="s4">0.5878j</span><span class="s2">, -</span><span class="s4">1.0000 </span><span class="s2">+ </span><span class="s4">0.0000j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">0.3026 </span><span class="s2">+ </span><span class="s4">0.9312j</span><span class="s2">, -</span><span class="s4">0.3026 </span><span class="s2">- </span><span class="s4">0.9312j</span><span class="s2">, </span><span class="s4">0.7922 </span><span class="s2">+ </span><span class="s4">0.5755j</span><span class="s2">,</span>
              <span class="s4">0.7922 </span><span class="s2">- </span><span class="s4">0.5755j</span><span class="s2">, -</span><span class="s4">0.9791 </span><span class="s2">+ </span><span class="s4">0.0000j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">1</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

        <span class="s1">sos </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">],</span>
                     <span class="s2">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]])</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([-</span><span class="s4">1 </span><span class="s2">- </span><span class="s4">1.41421356237310j</span><span class="s2">, -</span><span class="s4">1 </span><span class="s2">+ </span><span class="s4">1.41421356237310j</span><span class="s2">,</span>
                  <span class="s2">-</span><span class="s4">0.625 </span><span class="s2">- </span><span class="s4">1.05326872164704j</span><span class="s2">, -</span><span class="s4">0.625 </span><span class="s2">+ </span><span class="s4">1.05326872164704j</span><span class="s2">])</span>
        <span class="s1">p </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([-</span><span class="s4">0.2 </span><span class="s2">- </span><span class="s4">0.678232998312527j</span><span class="s2">, -</span><span class="s4">0.2 </span><span class="s2">+ </span><span class="s4">0.678232998312527j</span><span class="s2">,</span>
                  <span class="s2">-</span><span class="s4">0.1 </span><span class="s2">- </span><span class="s4">0.538516480713450j</span><span class="s2">, -</span><span class="s4">0.1 </span><span class="s2">+ </span><span class="s4">0.538516480713450j</span><span class="s2">])</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">4</span>
        <span class="s1">z2</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">, </span><span class="s1">k2 </span><span class="s2">= </span><span class="s1">sos2zpk</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">), </span><span class="s1">z</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">_cplxpair</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">), </span><span class="s1">p</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k2</span><span class="s2">, </span><span class="s1">k</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fewer_zeros</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Test not the expected number of p/z (effectively at origin).&quot;&quot;&quot;</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">sos2zpk</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">z</span><span class="s2">) == </span><span class="s4">4</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) == </span><span class="s4">4</span>

        <span class="s1">sos </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">12</span><span class="s2">, [</span><span class="s4">5.</span><span class="s2">, </span><span class="s4">30.</span><span class="s2">], </span><span class="s3">'bandpass'</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">1200.</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                    <span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">BadCoefficients</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'Badly conditioned'</span><span class="s2">):</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">sos2zpk</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">z</span><span class="s2">) == </span><span class="s4">24</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) == </span><span class="s4">24</span>


<span class="s0">class </span><span class="s1">TestSos2Tf</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">sos </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">],</span>
               <span class="s2">[-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]]</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">sos2tf</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">10</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestTf2Sos</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">num </span><span class="s2">= [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">44</span><span class="s2">, </span><span class="s4">56</span><span class="s2">, </span><span class="s4">32</span><span class="s2">]</span>
        <span class="s1">den </span><span class="s2">= [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, -</span><span class="s4">15</span><span class="s2">, </span><span class="s4">18</span><span class="s2">, -</span><span class="s4">12</span><span class="s2">]</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">tf2sos</span><span class="s2">(</span><span class="s1">num</span><span class="s2">, </span><span class="s1">den</span><span class="s2">)</span>
        <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">0.6667</span><span class="s2">, </span><span class="s4">4.0000</span><span class="s2">, </span><span class="s4">5.3333</span><span class="s2">, </span><span class="s4">1.0000</span><span class="s2">, +</span><span class="s4">2.0000</span><span class="s2">, -</span><span class="s4">4.0000</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s4">1.0000</span><span class="s2">, </span><span class="s4">2.0000</span><span class="s2">, </span><span class="s4">2.0000</span><span class="s2">, </span><span class="s4">1.0000</span><span class="s2">, -</span><span class="s4">1.0000</span><span class="s2">, +</span><span class="s4">1.0000</span><span class="s2">]]</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

        <span class="s1">b </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, -</span><span class="s4">27</span><span class="s2">, </span><span class="s4">18</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">16</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, -</span><span class="s4">4</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">tf2sos</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">0.0625</span><span class="s2">, -</span><span class="s4">0.1875</span><span class="s2">, </span><span class="s4">0.1250</span><span class="s2">, </span><span class="s4">1.0000</span><span class="s2">, -</span><span class="s4">0.2500</span><span class="s2">, -</span><span class="s4">0.1250</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s4">1.0000</span><span class="s2">, +</span><span class="s4">0.0000</span><span class="s2">, </span><span class="s4">9.0000</span><span class="s2">, </span><span class="s4">1.0000</span><span class="s2">, +</span><span class="s4">1.0000</span><span class="s2">, +</span><span class="s4">0.5000</span><span class="s2">]]</span>
        <span class="s5"># assert_array_almost_equal(sos, sos2, decimal=4)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'b, a, analog, sos'</span><span class="s2">,</span>
                             <span class="s2">[([</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">], </span><span class="s0">False</span><span class="s2">, [[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">]]),</span>
                              <span class="s2">([</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">], </span><span class="s0">True</span><span class="s2">, [[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">]]),</span>
                              <span class="s2">([</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">1.01</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.01</span><span class="s2">], </span><span class="s0">False</span><span class="s2">,</span>
                               <span class="s2">[[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">0.01</span><span class="s2">],</span>
                                <span class="s2">[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]]),</span>
                              <span class="s2">([</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">1.01</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.01</span><span class="s2">], </span><span class="s0">True</span><span class="s2">,</span>
                               <span class="s2">[[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">],</span>
                                <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">0.01</span><span class="s2">]])])</span>
    <span class="s0">def </span><span class="s1">test_analog</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">, </span><span class="s1">sos</span><span class="s2">):</span>
        <span class="s1">sos2 </span><span class="s2">= </span><span class="s1">tf2sos</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s1">analog</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestZpk2Sos</span><span class="s2">:</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'dt'</span><span class="s2">, </span><span class="s3">'fdgFDG'</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'pairing, analog'</span><span class="s2">,</span>
                             <span class="s2">[(</span><span class="s3">'nearest'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s3">'keep_odd'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s3">'minimal'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s3">'minimal'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_dtypes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">):</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>
        <span class="s1">ct </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">upper</span><span class="s2">()  </span><span class="s5"># the poles have to be complex</span>
        <span class="s1">p </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.57149 </span><span class="s2">+ </span><span class="s4">0.29360j</span><span class="s2">, </span><span class="s4">0.57149 </span><span class="s2">- </span><span class="s4">0.29360j</span><span class="s2">]).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">ct</span><span class="s2">)</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">1</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s1">analog</span><span class="s2">)</span>
        <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.14298</span><span class="s2">, </span><span class="s4">0.41280</span><span class="s2">]]  </span><span class="s5"># octave &amp; MATLAB</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">pairing </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'nearest'</span><span class="s2">, </span><span class="s3">'keep_odd'</span><span class="s2">):</span>
            <span class="s5">#</span>
            <span class="s5"># Cases that match octave</span>
            <span class="s5">#</span>

            <span class="s1">z </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]</span>
            <span class="s1">p </span><span class="s2">= [</span><span class="s4">0.57149 </span><span class="s2">+ </span><span class="s4">0.29360j</span><span class="s2">, </span><span class="s4">0.57149 </span><span class="s2">- </span><span class="s4">0.29360j</span><span class="s2">]</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.14298</span><span class="s2">, </span><span class="s4">0.41280</span><span class="s2">]]  </span><span class="s5"># octave &amp; MATLAB</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

            <span class="s1">z </span><span class="s2">= [</span><span class="s4">1j</span><span class="s2">, -</span><span class="s4">1j</span><span class="s2">]</span>
            <span class="s1">p </span><span class="s2">= [</span><span class="s4">0.9</span><span class="s2">, -</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.7j</span><span class="s2">, -</span><span class="s4">0.7j</span><span class="s2">]</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, +</span><span class="s4">0.49</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">0.81</span><span class="s2">]]  </span><span class="s5"># octave</span>
            <span class="s5"># sos2 = [[0, 0, 1, 1, -0.9, 0],</span>
            <span class="s5">#         [1, 0, 1, 1, 0.9, 0]]  # MATLAB</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

            <span class="s1">z </span><span class="s2">= []</span>
            <span class="s1">p </span><span class="s2">= [</span><span class="s4">0.8</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">+</span><span class="s4">0.25j</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">-</span><span class="s4">0.25j</span><span class="s2">]</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">1.</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.3125</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">0.8</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">]]  </span><span class="s5"># octave, MATLAB fails</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

            <span class="s1">z </span><span class="s2">= [</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.9j</span><span class="s2">, -</span><span class="s4">0.9j</span><span class="s2">]</span>
            <span class="s1">p </span><span class="s2">= [</span><span class="s4">0.99</span><span class="s2">+</span><span class="s4">0.01j</span><span class="s2">, </span><span class="s4">0.99</span><span class="s2">-</span><span class="s4">0.01j</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">+</span><span class="s4">0.9j</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">-</span><span class="s4">0.9j</span><span class="s2">]</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.81</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.82</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.98</span><span class="s2">, </span><span class="s4">0.9802</span><span class="s2">]]  </span><span class="s5"># octave</span>
            <span class="s5"># sos2 = [[1, -2, 1, 1,  -0.2, 0.82],</span>
            <span class="s5">#         [1, 0, 0.81, 1, -1.98, 0.9802]]  # MATLAB</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

            <span class="s1">z </span><span class="s2">= [</span><span class="s4">0.9</span><span class="s2">+</span><span class="s4">0.1j</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">-</span><span class="s4">0.1j</span><span class="s2">, -</span><span class="s4">0.9</span><span class="s2">]</span>
            <span class="s1">p </span><span class="s2">= [</span><span class="s4">0.75</span><span class="s2">+</span><span class="s4">0.25j</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">-</span><span class="s4">0.25j</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">]</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">pairing </span><span class="s2">== </span><span class="s3">'keep_odd'</span><span class="s2">:</span>
                <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.8</span><span class="s2">, </span><span class="s4">0.82</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">0.625</span><span class="s2">],</span>
                        <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]]  </span><span class="s5"># octave; MATLAB fails</span>
                <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:  </span><span class="s5"># pairing == 'nearest'</span>
                <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">0.625</span><span class="s2">],</span>
                        <span class="s2">[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.8</span><span class="s2">, </span><span class="s4">0.82</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]]  </span><span class="s5"># our algorithm</span>
                <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

            <span class="s5">#</span>
            <span class="s5"># Cases that differ from octave:</span>
            <span class="s5">#</span>

            <span class="s1">z </span><span class="s2">= [-</span><span class="s4">0.3090 </span><span class="s2">+ </span><span class="s4">0.9511j</span><span class="s2">, -</span><span class="s4">0.3090 </span><span class="s2">- </span><span class="s4">0.9511j</span><span class="s2">, </span><span class="s4">0.8090 </span><span class="s2">+ </span><span class="s4">0.5878j</span><span class="s2">,</span>
                 <span class="s2">+</span><span class="s4">0.8090 </span><span class="s2">- </span><span class="s4">0.5878j</span><span class="s2">, -</span><span class="s4">1.0000 </span><span class="s2">+ </span><span class="s4">0.0000j</span><span class="s2">]</span>
            <span class="s1">p </span><span class="s2">= [-</span><span class="s4">0.3026 </span><span class="s2">+ </span><span class="s4">0.9312j</span><span class="s2">, -</span><span class="s4">0.3026 </span><span class="s2">- </span><span class="s4">0.9312j</span><span class="s2">, </span><span class="s4">0.7922 </span><span class="s2">+ </span><span class="s4">0.5755j</span><span class="s2">,</span>
                 <span class="s2">+</span><span class="s4">0.7922 </span><span class="s2">- </span><span class="s4">0.5755j</span><span class="s2">, -</span><span class="s4">0.9791 </span><span class="s2">+ </span><span class="s4">0.0000j</span><span class="s2">]</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
            <span class="s5"># sos2 = [[1, 0.618, 1, 1, 0.6052, 0.95870],</span>
            <span class="s5">#         [1, -1.618, 1, 1, -1.5844, 0.95878],</span>
            <span class="s5">#         [1, 1, 0, 1, 0.9791, 0]]  # octave, MATLAB fails</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, +</span><span class="s4">0.97915</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.61803</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, +</span><span class="s4">0.60515</span><span class="s2">, </span><span class="s4">0.95873</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.61803</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.58430</span><span class="s2">, </span><span class="s4">0.95873</span><span class="s2">]]</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

            <span class="s1">z </span><span class="s2">= [-</span><span class="s4">1 </span><span class="s2">- </span><span class="s4">1.4142j</span><span class="s2">, -</span><span class="s4">1 </span><span class="s2">+ </span><span class="s4">1.4142j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">0.625 </span><span class="s2">- </span><span class="s4">1.0533j</span><span class="s2">, -</span><span class="s4">0.625 </span><span class="s2">+ </span><span class="s4">1.0533j</span><span class="s2">]</span>
            <span class="s1">p </span><span class="s2">= [-</span><span class="s4">0.2 </span><span class="s2">- </span><span class="s4">0.6782j</span><span class="s2">, -</span><span class="s4">0.2 </span><span class="s2">+ </span><span class="s4">0.6782j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">0.1 </span><span class="s2">- </span><span class="s4">0.5385j</span><span class="s2">, -</span><span class="s4">0.1 </span><span class="s2">+ </span><span class="s4">0.5385j</span><span class="s2">]</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">4</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.25</span><span class="s2">, </span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]]  </span><span class="s5"># MATLAB</span>
            <span class="s5"># sos2 = [[4, 8, 12, 1, 0.4, 0.5],</span>
            <span class="s5">#         [1, 1.25, 1.5, 1, 0.2, 0.3]]  # octave</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>

            <span class="s1">z </span><span class="s2">= []</span>
            <span class="s1">p </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">+</span><span class="s4">0.25j</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">-</span><span class="s4">0.25j</span><span class="s2">]</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">1.</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.3125</span><span class="s2">]]</span>
            <span class="s5"># sos2 = [[1., 0., 0., 1., 1., 0.3125],</span>
            <span class="s5">#         [1., 0., 0., 1., -0.2, 0]]  # octave, MATLAB fails</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

            <span class="s5"># The next two examples are adapted from Leland B. Jackson,</span>
            <span class="s5"># &quot;Digital Filters and Signal Processing (1995) p.400:</span>
            <span class="s5"># http://books.google.com/books?id=VZ8uabI1pNMC&amp;lpg=PA400&amp;ots=gRD9pi8Jua&amp;dq=Pole%2Fzero%20pairing%20for%20minimum%20roundoff%20noise%20in%20BSF.&amp;pg=PA400#v=onepage&amp;q=Pole%2Fzero%20pairing%20for%20minimum%20roundoff%20noise%20in%20BSF.&amp;f=false</span>

            <span class="s1">deg2rad </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s4">180.</span>
            <span class="s1">k </span><span class="s2">= </span><span class="s4">1.</span>

            <span class="s5"># first example</span>
            <span class="s1">thetas </span><span class="s2">= [</span><span class="s4">22.5</span><span class="s2">, </span><span class="s4">45</span><span class="s2">, </span><span class="s4">77.5</span><span class="s2">]</span>
            <span class="s1">mags </span><span class="s2">= [</span><span class="s4">0.8</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">]</span>
            <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s1">theta </span><span class="s2">* </span><span class="s1">deg2rad </span><span class="s2">* </span><span class="s4">1j</span><span class="s2">) </span><span class="s0">for </span><span class="s1">theta </span><span class="s0">in </span><span class="s1">thetas</span><span class="s2">])</span>
            <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">z</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)))</span>
            <span class="s1">p </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">mag </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s1">theta </span><span class="s2">* </span><span class="s1">deg2rad </span><span class="s2">* </span><span class="s4">1j</span><span class="s2">)</span>
                          <span class="s0">for </span><span class="s1">theta</span><span class="s2">, </span><span class="s1">mag </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">thetas</span><span class="s2">, </span><span class="s1">mags</span><span class="s2">)])</span>
            <span class="s1">p </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">p</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">p</span><span class="s2">)))</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">)</span>
            <span class="s5"># sos2 = [[1, -0.43288, 1, 1, -0.38959, 0.81],  # octave,</span>
            <span class="s5">#         [1, -1.41421, 1, 1, -0.84853, 0.36],  # MATLAB fails</span>
            <span class="s5">#         [1, -1.84776, 1, 1, -1.47821, 0.64]]</span>
            <span class="s5"># Note that pole-zero pairing matches, but ordering is different</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.41421</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.84853</span><span class="s2">, </span><span class="s4">0.36</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.84776</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.47821</span><span class="s2">, </span><span class="s4">0.64</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.43288</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.38959</span><span class="s2">, </span><span class="s4">0.81</span><span class="s2">]]</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

            <span class="s5"># second example</span>
            <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s1">theta </span><span class="s2">* </span><span class="s1">deg2rad </span><span class="s2">* </span><span class="s4">1j</span><span class="s2">)</span>
                          <span class="s0">for </span><span class="s1">theta </span><span class="s0">in </span><span class="s2">(</span><span class="s4">85.</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">)])</span>
            <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">z</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), [</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]))</span>
            <span class="s1">sos </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">)</span>

            <span class="s5"># sos2 = [[1, -0.17431, 1, 1, -0.38959, 0.81],  # octave &quot;wrong&quot;,</span>
            <span class="s5">#         [1, -1.96962, 1, 1, -0.84853, 0.36],  # MATLAB fails</span>
            <span class="s5">#         [1, 0, -1, 1, -1.47821, 0.64000]]</span>
            <span class="s5"># Our pole-zero pairing matches the text, Octave does not</span>
            <span class="s1">sos2 </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.84853</span><span class="s2">, </span><span class="s4">0.36</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.96962</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.47821</span><span class="s2">, </span><span class="s4">0.64</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.17431</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.38959</span><span class="s2">, </span><span class="s4">0.81</span><span class="s2">]]</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

    <span class="s5"># these examples are taken from the doc string, and show the</span>
    <span class="s5"># effect of the 'pairing' argument</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'pairing, sos'</span><span class="s2">,</span>
                             <span class="s2">[(</span><span class="s3">'nearest'</span><span class="s2">,</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">],</span>
                                         <span class="s2">[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">1.6</span><span class="s2">, </span><span class="s4">0.65</span><span class="s2">]])),</span>
                              <span class="s2">(</span><span class="s3">'keep_odd'</span><span class="s2">,</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">],</span>
                                         <span class="s2">[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">1.6</span><span class="s2">, </span><span class="s4">0.65</span><span class="s2">]])),</span>
                              <span class="s2">(</span><span class="s3">'minimal'</span><span class="s2">,</span>
                               <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">0.75</span><span class="s2">],</span>
                                         <span class="s2">[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">1.6</span><span class="s2">, </span><span class="s4">0.65</span><span class="s2">]]))])</span>
    <span class="s0">def </span><span class="s1">test_pairing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">, </span><span class="s1">sos</span><span class="s2">):</span>
        <span class="s1">z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">-</span><span class="s4">0.5j</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">+</span><span class="s4">0.5j</span><span class="s2">])</span>
        <span class="s1">p1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.75</span><span class="s2">, </span><span class="s4">0.8</span><span class="s2">+</span><span class="s4">0.1j</span><span class="s2">, </span><span class="s4">0.8</span><span class="s2">-</span><span class="s4">0.1j</span><span class="s2">])</span>
        <span class="s1">sos2 </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">(</span><span class="s1">z1</span><span class="s2">, </span><span class="s1">p1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s1">pairing</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'p, sos_dt'</span><span class="s2">,</span>
                             <span class="s2">[([-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">],</span>
                               <span class="s2">[[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">0.01</span><span class="s2">],</span>
                                <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]]),</span>
                              <span class="s2">([-</span><span class="s4">0.7071</span><span class="s2">+</span><span class="s4">0.7071j</span><span class="s2">, -</span><span class="s4">0.7071</span><span class="s2">-</span><span class="s4">0.7071j</span><span class="s2">, -</span><span class="s4">0.1j</span><span class="s2">, </span><span class="s4">0.1j</span><span class="s2">],</span>
                               <span class="s2">[[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.01</span><span class="s2">],</span>
                                <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.4142</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">]])])</span>
    <span class="s0">def </span><span class="s1">test_analog</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">sos_dt</span><span class="s2">):</span>
        <span class="s5"># test `analog` argument</span>
        <span class="s5"># for discrete time, poles closest to unit circle should appear last</span>
        <span class="s5"># for cont. time, poles closest to imaginary axis should appear last</span>
        <span class="s1">sos2_dt </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">([], </span><span class="s1">p</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s3">'minimal'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">sos2_ct </span><span class="s2">= </span><span class="s1">zpk2sos</span><span class="s2">([], </span><span class="s1">p</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s3">'minimal'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos_dt</span><span class="s2">, </span><span class="s1">sos2_dt</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos_dt</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">sos2_ct</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bad_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">r'pairing must be one of'</span><span class="s2">):</span>
            <span class="s1">zpk2sos</span><span class="s2">([</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s3">'no_such_pairing'</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">r'.*pairing must be &quot;minimal&quot;'</span><span class="s2">):</span>
            <span class="s1">zpk2sos</span><span class="s2">([</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s1">pairing</span><span class="s2">=</span><span class="s3">'keep_odd'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s3">r'.*must have len\(p\)&gt;=len\(z\)'</span><span class="s2">):</span>
            <span class="s1">zpk2sos</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">r'k must be real'</span><span class="s2">):</span>
            <span class="s1">zpk2sos</span><span class="s2">([</span><span class="s4">1</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">], </span><span class="s1">k</span><span class="s2">=</span><span class="s4">1j</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestFreqs</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 1st order low-pass filter: H(s) = 1 / (s + 1)</span>
        <span class="s1">w </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">]</span>
        <span class="s1">num </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">den </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">H </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">num</span><span class="s2">, </span><span class="s1">den</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">w </span><span class="s2">* </span><span class="s4">1j</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s4">1 </span><span class="s2">/ (</span><span class="s1">s </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">H</span><span class="s2">.</span><span class="s1">real</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">real</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">H</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_freq_range</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test that freqresp() finds a reasonable frequency range.</span>
        <span class="s5"># 1st order low-pass filter: H(s) = 1 / (s + 1)</span>
        <span class="s5"># Expected range is from 0.01 to 10.</span>
        <span class="s1">num </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">den </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s4">10</span>
        <span class="s1">expected_w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">logspace</span><span class="s2">(-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">H </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">num</span><span class="s2">, </span><span class="s1">den</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_plot</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s0">def </span><span class="s1">plot</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">h</span><span class="s2">):</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ZeroDivisionError</span><span class="s2">, </span><span class="s1">freqs</span><span class="s2">, [</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">,</span>
                      <span class="s1">plot</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">w</span><span class="s2">, </span><span class="s1">h</span><span class="s2">: </span><span class="s4">1 </span><span class="s2">/ </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">freqs</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">plot</span><span class="s2">=</span><span class="s1">plot</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_backward_compat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># For backward compatibility, test if None act as a wrapper for default</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">])</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_w_or_N_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Measure at 8 equally-spaced points</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">8</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">8</span><span class="s2">)):</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">w</span><span class="s2">), </span><span class="s4">8</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

        <span class="s5"># Measure at frequency 8 rad/sec</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">, </span><span class="s4">8.0</span><span class="s2">+</span><span class="s4">0j</span><span class="s2">):</span>
            <span class="s1">w_out</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w_out</span><span class="s2">, [</span><span class="s4">8</span><span class="s2">])</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestFreqs_zpk</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs_zpk</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 1st order low-pass filter: H(s) = 1 / (s + 1)</span>
        <span class="s1">w </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">100</span><span class="s2">]</span>
        <span class="s1">z </span><span class="s2">= []</span>
        <span class="s1">p </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">H </span><span class="s2">= </span><span class="s1">freqs_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">w </span><span class="s2">* </span><span class="s4">1j</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s4">1 </span><span class="s2">/ (</span><span class="s1">s </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">H</span><span class="s2">.</span><span class="s1">real</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">real</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">H</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_freq_range</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test that freqresp() finds a reasonable frequency range.</span>
        <span class="s5"># 1st order low-pass filter: H(s) = 1 / (s + 1)</span>
        <span class="s5"># Expected range is from 0.01 to 10.</span>
        <span class="s1">z </span><span class="s2">= []</span>
        <span class="s1">p </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s4">10</span>
        <span class="s1">expected_w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">logspace</span><span class="s2">(-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">H </span><span class="s2">= </span><span class="s1">freqs_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_vs_freqs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'ba'</span><span class="s2">)</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>

        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqs_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_backward_compat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># For backward compatibility, test if None act as a wrapper for default</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqs_zpk</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">])</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqs_zpk</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_w_or_N_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Measure at 8 equally-spaced points</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">8</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">8</span><span class="s2">)):</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs_zpk</span><span class="s2">([], [], </span><span class="s4">1</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">w</span><span class="s2">), </span><span class="s4">8</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

        <span class="s5"># Measure at frequency 8 rad/sec</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">, </span><span class="s4">8.0</span><span class="s2">+</span><span class="s4">0j</span><span class="s2">):</span>
            <span class="s1">w_out</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs_zpk</span><span class="s2">([], [], </span><span class="s4">1</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w_out</span><span class="s2">, [</span><span class="s4">8</span><span class="s2">])</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestFreqz</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_ticket1441</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Regression test for ticket 1441.&quot;&quot;&quot;</span>
        <span class="s5"># Because freqz previously used arange instead of linspace,</span>
        <span class="s5"># when N was large, it would return one more point than</span>
        <span class="s5"># requested.</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">100000</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s1">N</span><span class="s2">,))</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">8</span><span class="s2">) / </span><span class="s4">8.</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">9</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">9</span><span class="s2">) / </span><span class="s4">9.</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">9</span><span class="s2">))</span>

        <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)]:</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">,))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">,))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s3">'complex128'</span><span class="s2">))</span>

        <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">h_whole </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span>
                <span class="s2">([</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">t</span><span class="s2">)),</span>
                <span class="s2">([</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]),</span>
                <span class="s2">([</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, -</span><span class="s4">4j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">4j</span><span class="s2">])):</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">expected_w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">h_whole</span><span class="s2">)</span>
            <span class="s5"># simultaneously check int-like support</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">4</span><span class="s2">), </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">h_whole</span><span class="s2">)</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">h_whole</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_basic_whole</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">) / </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_plot</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s0">def </span><span class="s1">plot</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">h</span><span class="s2">):</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">) / </span><span class="s4">8</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ZeroDivisionError</span><span class="s2">, </span><span class="s1">freqz</span><span class="s2">, [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">,</span>
                      <span class="s1">plot</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">w</span><span class="s2">, </span><span class="s1">h</span><span class="s2">: </span><span class="s4">1 </span><span class="s2">/ </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">plot</span><span class="s2">=</span><span class="s1">plot</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fft_wrapping</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Some simple real FIR filters</span>
        <span class="s1">bs </span><span class="s2">= </span><span class="s1">list</span><span class="s2">()  </span><span class="s5"># filters</span>
        <span class="s1">as_ </span><span class="s2">= </span><span class="s1">list</span><span class="s2">()</span>
        <span class="s1">hs_whole </span><span class="s2">= </span><span class="s1">list</span><span class="s2">()</span>
        <span class="s1">hs_half </span><span class="s2">= </span><span class="s1">list</span><span class="s2">()</span>
        <span class="s5"># 3 taps</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">bs</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">t</span><span class="s2">))</span>
        <span class="s1">as_</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s4">3.</span><span class="s2">)</span>
        <span class="s1">hs_whole</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, -</span><span class="s4">0.5j</span><span class="s2">, </span><span class="s4">0.5j</span><span class="s2">])</span>
        <span class="s1">hs_half</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">1.</span><span class="s2">/</span><span class="s4">12.</span><span class="s2">), -</span><span class="s4">0.5j</span><span class="s2">])</span>
        <span class="s5"># 4 taps</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">bs</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">t</span><span class="s2">))</span>
        <span class="s1">as_</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">)</span>
        <span class="s1">hs_whole</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, -</span><span class="s4">4j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">4j</span><span class="s2">])</span>
        <span class="s1">hs_half</span><span class="s2">.</span><span class="s1">append</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), -</span><span class="s4">4j</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">8</span><span class="s2">)])</span>
        <span class="s0">del </span><span class="s1">t</span>
        <span class="s0">for </span><span class="s1">ii</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">bs</span><span class="s2">):</span>
            <span class="s5"># whole</span>
            <span class="s1">a </span><span class="s2">= </span><span class="s1">as_</span><span class="s2">[</span><span class="s1">ii</span><span class="s2">]</span>
            <span class="s1">expected_w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">expected_w</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)  </span><span class="s5"># polyval</span>
            <span class="s1">err_msg </span><span class="s2">= </span><span class="s3">f'b = </span><span class="s0">{</span><span class="s1">b</span><span class="s0">}</span><span class="s3">, a=</span><span class="s0">{</span><span class="s1">a</span><span class="s0">}</span><span class="s3">'</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">err_msg</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">hs_whole</span><span class="s2">[</span><span class="s1">ii</span><span class="s2">], </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">err_msg</span><span class="s2">)</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">len</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)  </span><span class="s5"># FFT</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">err_msg</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">hs_whole</span><span class="s2">[</span><span class="s1">ii</span><span class="s2">], </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">err_msg</span><span class="s2">)</span>
            <span class="s5"># non-whole</span>
            <span class="s1">expected_w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">expected_w</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)  </span><span class="s5"># polyval</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">err_msg</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">hs_half</span><span class="s2">[</span><span class="s1">ii</span><span class="s2">], </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">err_msg</span><span class="s2">)</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">len</span><span class="s2">(</span><span class="s1">b</span><span class="s2">), </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)  </span><span class="s5"># FFT</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">err_msg</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">hs_half</span><span class="s2">[</span><span class="s1">ii</span><span class="s2">], </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">err_msg</span><span class="s2">)</span>

        <span class="s5"># some random FIR filters (real + complex)</span>
        <span class="s5"># assume polyval is accurate</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">ii </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">10</span><span class="s2">):  </span><span class="s5"># number of taps</span>
            <span class="s1">b </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s1">ii</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">kk </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">2</span><span class="s2">):</span>
                <span class="s1">a </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s4">1</span><span class="s2">) </span><span class="s0">if </span><span class="s1">kk </span><span class="s2">== </span><span class="s4">0 </span><span class="s0">else </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s4">3</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">jj </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">2</span><span class="s2">):</span>
                    <span class="s0">if </span><span class="s1">jj </span><span class="s2">== </span><span class="s4">1</span><span class="s2">:</span>
                        <span class="s1">b </span><span class="s2">= </span><span class="s1">b </span><span class="s2">+ </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s1">ii</span><span class="s2">) * </span><span class="s4">1j</span>
                    <span class="s5"># whole</span>
                    <span class="s1">expected_w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">ii</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
                    <span class="s1">w</span><span class="s2">, </span><span class="s1">expected_h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">expected_w</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
                    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>
                    <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">ii</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
                    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>
                    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">expected_h</span><span class="s2">)</span>
                    <span class="s5"># half</span>
                    <span class="s1">expected_w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">ii</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
                    <span class="s1">w</span><span class="s2">, </span><span class="s1">expected_h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">expected_w</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
                    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>
                    <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">ii</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
                    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">expected_w</span><span class="s2">)</span>
                    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">expected_h</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_broadcasting1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test broadcasting with worN an integer or a 1-D array,</span>
        <span class="s5"># b and a are n-dimensional arrays.</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s4">123</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">whole </span><span class="s0">in </span><span class="s2">[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]:</span>
            <span class="s5"># Test with worN being integers (one fast for FFT and one not),</span>
            <span class="s5"># a 1-D array, and an empty array.</span>
            <span class="s0">for </span><span class="s1">worN </span><span class="s0">in </span><span class="s2">[</span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([])]:</span>
                <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">worN</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]):</span>
                    <span class="s1">bk </span><span class="s2">= </span><span class="s1">b</span><span class="s2">[:, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
                    <span class="s1">ak </span><span class="s2">= </span><span class="s1">a</span><span class="s2">[:, </span><span class="s4">0</span><span class="s2">]</span>
                    <span class="s1">ww</span><span class="s2">, </span><span class="s1">hh </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">bk</span><span class="s2">, </span><span class="s1">ak</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">worN</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">)</span>
                    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ww</span><span class="s2">, </span><span class="s1">w</span><span class="s2">)</span>
                    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">hh</span><span class="s2">, </span><span class="s1">h</span><span class="s2">[</span><span class="s1">k</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_broadcasting2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test broadcasting with worN an integer or a 1-D array,</span>
        <span class="s5"># b is an n-dimensional array, and a is left at the default value.</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s4">123</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">whole </span><span class="s0">in </span><span class="s2">[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">worN </span><span class="s0">in </span><span class="s2">[</span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)]:</span>
                <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">worN</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]):</span>
                    <span class="s1">bk </span><span class="s2">= </span><span class="s1">b</span><span class="s2">[:, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
                    <span class="s1">ww</span><span class="s2">, </span><span class="s1">hh </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">bk</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">worN</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">)</span>
                    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ww</span><span class="s2">, </span><span class="s1">w</span><span class="s2">)</span>
                    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">hh</span><span class="s2">, </span><span class="s1">h</span><span class="s2">[</span><span class="s1">k</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_broadcasting3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test broadcasting where b.shape[-1] is the same length</span>
        <span class="s5"># as worN, and a is left at the default value.</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s4">123</span><span class="s2">)</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">16</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s1">N</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">whole </span><span class="s0">in </span><span class="s2">[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">worN </span><span class="s0">in </span><span class="s2">[</span><span class="s1">N</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">N</span><span class="s2">)]:</span>
                <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">worN</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">)</span>
                <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">.</span><span class="s1">size</span><span class="s2">, </span><span class="s1">N</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">):</span>
                    <span class="s1">bk </span><span class="s2">= </span><span class="s1">b</span><span class="s2">[:, </span><span class="s1">k</span><span class="s2">]</span>
                    <span class="s1">ww</span><span class="s2">, </span><span class="s1">hh </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">bk</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">[</span><span class="s1">k</span><span class="s2">], </span><span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">)</span>
                    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ww</span><span class="s2">, </span><span class="s1">w</span><span class="s2">[</span><span class="s1">k</span><span class="s2">])</span>
                    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">hh</span><span class="s2">, </span><span class="s1">h</span><span class="s2">[</span><span class="s1">k</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_broadcasting4</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test broadcasting with worN a 2-D array.</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s4">123</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">whole </span><span class="s0">in </span><span class="s2">[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">worN </span><span class="s0">in </span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">6</span><span class="s2">, </span><span class="s4">0</span><span class="s2">))]:</span>
                <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">worN</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">)</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
                <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s4">2</span><span class="s2">,) + </span><span class="s1">worN</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">2</span><span class="s2">):</span>
                    <span class="s1">ww</span><span class="s2">, </span><span class="s1">hh </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">[:, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">a</span><span class="s2">[:, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
                                   <span class="s1">worN</span><span class="s2">=</span><span class="s1">worN</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">(),</span>
                                   <span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">)</span>
                    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ww</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">(), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
                    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">hh</span><span class="s2">, </span><span class="s1">h</span><span class="s2">[</span><span class="s1">k</span><span class="s2">, :, :].</span><span class="s1">ravel</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_backward_compat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># For backward compatibility, test if None act as a wrapper for default</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">900</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s4">0.039479155677484369</span><span class="s2">, </span><span class="s4">0.11843746703245311</span><span class="s2">, </span><span class="s4">0.11843746703245311</span><span class="s2">,</span>
             <span class="s4">0.039479155677484369</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1.0</span><span class="s2">, -</span><span class="s4">1.3199152021838287</span><span class="s2">, </span><span class="s4">0.80341991081938424</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">0.16767146321568049</span><span class="s2">]</span>

        <span class="s5"># N = None, whole=False</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">, </span><span class="s4">512</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = None, whole=True</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">, </span><span class="s4">512</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = 5, whole=False</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = 5, whole=True</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># w is an array_like</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">([</span><span class="s4">123</span><span class="s2">], (</span><span class="s4">123</span><span class="s2">,), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">123</span><span class="s2">]), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s4">230</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">50</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s4">230</span><span class="s2">])):</span>
            <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">w</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
            <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">pi</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">w</span><span class="s2">)/</span><span class="s1">fs</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">w1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_w_or_N_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Measure at 7 (polyval) or 8 (fft) equally-spaced points</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">7</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">7</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s4">7</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">7</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">7</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">7</span><span class="s2">),</span>
                  <span class="s4">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">8</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">8</span><span class="s2">)):</span>

            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">N</span><span class="s2">) / </span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">N</span><span class="s2">))</span>

            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s1">N</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">N</span><span class="s2">))</span>

        <span class="s5"># Measure at frequency 8 Hz</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">, </span><span class="s4">8.0</span><span class="s2">+</span><span class="s4">0j</span><span class="s2">):</span>
            <span class="s5"># Only makes sense when fs is specified</span>
            <span class="s1">w_out</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w_out</span><span class="s2">, [</span><span class="s4">8</span><span class="s2">])</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_nyquist</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">include_nyquist</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">8</span><span class="s2">) / </span><span class="s4">7.</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">include_nyquist</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">9</span><span class="s2">) / </span><span class="s4">8.</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">9</span><span class="s2">))</span>

        <span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)]:</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">include_nyquist</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">,))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">,))</span>
            <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s3">'complex128'</span><span class="s2">))</span>

        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">whole </span><span class="s2">= </span><span class="s0">True</span><span class="s2">, </span><span class="s1">include_nyquist</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">whole </span><span class="s2">= </span><span class="s0">True</span><span class="s2">, </span><span class="s1">include_nyquist</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>

    <span class="s5"># https://github.com/scipy/scipy/issues/17289</span>
    <span class="s5"># https://github.com/scipy/scipy/issues/15273</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'whole,nyquist,worN'</span><span class="s2">,</span>
                             <span class="s2">[(</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">32</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s4">32</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">32</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s4">32</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">257</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s4">257</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">257</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s4">257</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_17289</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">, </span><span class="s1">nyquist</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">):</span>
        <span class="s1">d </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">Drfft </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">32</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s1">whole</span><span class="s2">, </span><span class="s1">include_nyquist</span><span class="s2">=</span><span class="s1">nyquist</span><span class="s2">)</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">Dpoly </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Drfft</span><span class="s2">, </span><span class="s1">Dpoly</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*be none.&quot;</span><span class="s2">):</span>
            <span class="s1">freqz</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">fs</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestSOSFreqz</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_sosfreqz_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compare the results of freqz and sosfreqz for a low order</span>
        <span class="s5"># Butterworth filter.</span>

        <span class="s1">N </span><span class="s2">= </span><span class="s4">500</span>

        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">w2</span><span class="s2">, </span><span class="s1">w</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h2</span><span class="s2">, </span><span class="s1">h</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, (</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">), </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'bandpass'</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, (</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">), </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'bandpass'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">w2</span><span class="s2">, </span><span class="s1">w</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h2</span><span class="s2">, </span><span class="s1">h</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s5"># must have at least one section</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">sosfreqz</span><span class="s2">, </span><span class="s1">sos</span><span class="s2">[:</span><span class="s4">0</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_sosfrez_design</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compare sosfreqz output against expected values for different</span>
        <span class="s5"># filter types</span>

        <span class="s5"># from cheb2ord</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s4">20 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.1</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s4">20 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.6</span><span class="s2">]), </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[(</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.2</span><span class="s2">) &amp; (</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.5</span><span class="s2">)], </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-3</span><span class="s2">)  </span><span class="s5"># &lt;= -60 dB</span>

        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">dB </span><span class="s2">= </span><span class="s4">20</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">))</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.1</span><span class="s2">], </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.6</span><span class="s2">], </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[(</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.2</span><span class="s2">) &amp; (</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.5</span><span class="s2">)], -</span><span class="s4">149.9</span><span class="s2">)</span>

        <span class="s5"># from cheb1ord</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s4">20 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.2</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.3</span><span class="s2">], </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)  </span><span class="s5"># &lt;= -40 dB</span>

        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">dB </span><span class="s2">= </span><span class="s4">20</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">))</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.2</span><span class="s2">], </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1.01</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.3</span><span class="s2">], -</span><span class="s4">149.9</span><span class="s2">)</span>

        <span class="s5"># adapted from ellipord</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s4">20 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.3</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.1</span><span class="s2">], </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1.5e-3</span><span class="s2">)  </span><span class="s5"># &lt;= -60 dB (approx)</span>

        <span class="s5"># adapted from buttord</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">([</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], [</span><span class="s4">0.14</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'band'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.14</span><span class="s2">], </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)  </span><span class="s5"># &lt;= -40 dB</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.6</span><span class="s2">], </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)  </span><span class="s5"># &lt;= -40 dB</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s4">20 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[(</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.2</span><span class="s2">) &amp; (</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.5</span><span class="s2">)]),</span>
                        <span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>

        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">([</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], [</span><span class="s4">0.14</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'band'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">dB </span><span class="s2">= </span><span class="s4">20</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">maximum</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">), </span><span class="s4">1e-10</span><span class="s2">))</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[(</span><span class="s1">w </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">) &amp; (</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.14</span><span class="s2">)], -</span><span class="s4">99.9</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.6</span><span class="s2">], -</span><span class="s4">99.9</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[(</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.2</span><span class="s2">) &amp; (</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.5</span><span class="s2">)], </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_sosfreqz_design_ellip</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s4">20 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.3</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">3.01</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.1</span><span class="s2">], </span><span class="s4">0.</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1.5e-3</span><span class="s2">)  </span><span class="s5"># &lt;= -60 dB (approx)</span>

        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">150</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">150</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">dB </span><span class="s2">= </span><span class="s4">20</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">maximum</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">), </span><span class="s4">1e-10</span><span class="s2">))</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&gt;= </span><span class="s4">0.3</span><span class="s2">], </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">.55</span><span class="s2">)</span>
        <span class="s5"># Allow some numerical slop in the upper bound -150, so this is</span>
        <span class="s5"># a check that dB[w &lt;= 0.2] is less than or almost equal to -150.</span>
        <span class="s0">assert </span><span class="s1">dB</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s4">0.2</span><span class="s2">].</span><span class="s1">max</span><span class="s2">() &lt; -</span><span class="s4">150</span><span class="s2">*(</span><span class="s4">1 </span><span class="s2">- </span><span class="s4">1e-12</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">mpmath_check</span><span class="s2">(</span><span class="s3">&quot;0.10&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_sos_freqz_against_mp</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compare the result of sosfreqz applied to a high order Butterworth</span>
        <span class="s5"># filter against the result computed using mpmath.  (signal.freqz fails</span>
        <span class="s5"># miserably with such high order filters.)</span>
        <span class="s0">from </span><span class="s2">. </span><span class="s0">import </span><span class="s1">mpsig</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">500</span>
        <span class="s1">order </span><span class="s2">= </span><span class="s4">25</span>
        <span class="s1">Wn </span><span class="s2">= </span><span class="s4">0.15</span>
        <span class="s0">with </span><span class="s1">mpmath</span><span class="s2">.</span><span class="s1">workdps</span><span class="s2">(</span><span class="s4">80</span><span class="s2">):</span>
            <span class="s1">z_mp</span><span class="s2">, </span><span class="s1">p_mp</span><span class="s2">, </span><span class="s1">k_mp </span><span class="s2">= </span><span class="s1">mpsig</span><span class="s2">.</span><span class="s1">butter_lp</span><span class="s2">(</span><span class="s1">order</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">)</span>
            <span class="s1">w_mp</span><span class="s2">, </span><span class="s1">h_mp </span><span class="s2">= </span><span class="s1">mpsig</span><span class="s2">.</span><span class="s1">zpkfreqz</span><span class="s2">(</span><span class="s1">z_mp</span><span class="s2">, </span><span class="s1">p_mp</span><span class="s2">, </span><span class="s1">k_mp</span><span class="s2">, </span><span class="s1">N</span><span class="s2">)</span>
        <span class="s1">w_mp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">float</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">w_mp</span><span class="s2">])</span>
        <span class="s1">h_mp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">complex</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">h_mp</span><span class="s2">])</span>

        <span class="s1">sos </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">order</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">w_mp</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-12</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">h_mp</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-12</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">900</span>
        <span class="s1">sos </span><span class="s2">= [[</span><span class="s4">0.03934683014103762</span><span class="s2">, </span><span class="s4">0.07869366028207524</span><span class="s2">, </span><span class="s4">0.03934683014103762</span><span class="s2">,</span>
                <span class="s4">1.0</span><span class="s2">, -</span><span class="s4">0.37256600288916636</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, -</span><span class="s4">0.9495739996946778</span><span class="s2">, </span><span class="s4">0.45125966317124144</span><span class="s2">]]</span>

        <span class="s5"># N = None, whole=False</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">, </span><span class="s4">512</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = None, whole=True</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-27</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">, </span><span class="s4">512</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = 5, whole=False</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = 5, whole=True</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># w is an array_like</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">([</span><span class="s4">123</span><span class="s2">], (</span><span class="s4">123</span><span class="s2">,), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">123</span><span class="s2">]), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s4">230</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">50</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s4">230</span><span class="s2">])):</span>
            <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">w</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
            <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">pi</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">w</span><span class="s2">)/</span><span class="s1">fs</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">w1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_w_or_N_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Measure at 7 (polyval) or 8 (fft) equally-spaced points</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">7</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">7</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s4">7</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">7</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">7</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">7</span><span class="s2">),</span>
                  <span class="s4">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">8</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">8</span><span class="s2">)):</span>

            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">N</span><span class="s2">) / </span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">N</span><span class="s2">))</span>

            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s1">N</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">N</span><span class="s2">))</span>

        <span class="s5"># Measure at frequency 8 Hz</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">, </span><span class="s4">8.0</span><span class="s2">+</span><span class="s4">0j</span><span class="s2">):</span>
            <span class="s5"># Only makes sense when fs is specified</span>
            <span class="s1">w_out</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w_out</span><span class="s2">, [</span><span class="s4">8</span><span class="s2">])</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestFreqz_zpk</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_ticket1441</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Regression test for ticket 1441.&quot;&quot;&quot;</span>
        <span class="s5"># Because freqz previously used arange instead of linspace,</span>
        <span class="s5"># when N was large, it would return one more point than</span>
        <span class="s5"># requested.</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">100000</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s1">N</span><span class="s2">,))</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">) / </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_basic_whole</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s4">8</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">) / </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_vs_freqz</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'ba'</span><span class="s2">)</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>

        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_backward_compat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># For backward compatibility, test if None act as a wrapper for default</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1.0</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1.0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">900</span>
        <span class="s1">z </span><span class="s2">= [-</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">p </span><span class="s2">= [</span><span class="s4">0.4747869998473389</span><span class="s2">+</span><span class="s4">0.4752230717749344j</span><span class="s2">, </span><span class="s4">0.37256600288916636</span><span class="s2">,</span>
             <span class="s4">0.4747869998473389</span><span class="s2">-</span><span class="s4">0.4752230717749344j</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">0.03934683014103762</span>

        <span class="s5"># N = None, whole=False</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">, </span><span class="s4">512</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = None, whole=True</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">, </span><span class="s4">512</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = 5, whole=False</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># N = 5, whole=True</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

        <span class="s5"># w is an array_like</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">([</span><span class="s4">123</span><span class="s2">], (</span><span class="s4">123</span><span class="s2">,), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">123</span><span class="s2">]), (</span><span class="s4">50</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s4">230</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">50</span><span class="s2">, </span><span class="s4">123</span><span class="s2">, </span><span class="s4">230</span><span class="s2">])):</span>
            <span class="s1">w1</span><span class="s2">, </span><span class="s1">h1 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">w</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
            <span class="s1">w2</span><span class="s2">, </span><span class="s1">h2 </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">pi</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">w</span><span class="s2">)/</span><span class="s1">fs</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">w1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_w_or_N_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Measure at 8 equally-spaced points</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">8</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">8</span><span class="s2">)):</span>

            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">([], [], </span><span class="s4">1</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">8</span><span class="s2">) / </span><span class="s4">8.</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

            <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">([], [], </span><span class="s4">1</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

        <span class="s5"># Measure at frequency 8 Hz</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">, </span><span class="s4">8.0</span><span class="s2">+</span><span class="s4">0j</span><span class="s2">):</span>
            <span class="s5"># Only makes sense when fs is specified</span>
            <span class="s1">w_out</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz_zpk</span><span class="s2">([], [], </span><span class="s4">1</span><span class="s2">, </span><span class="s1">worN</span><span class="s2">=</span><span class="s1">w</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w_out</span><span class="s2">, [</span><span class="s4">8</span><span class="s2">])</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">freqz_zpk</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*be none.&quot;</span><span class="s2">):</span>
            <span class="s1">freqz_zpk</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">fs</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestNormalize</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_allclose</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Test for false positive on allclose in normalize() in 
        filter_design.py&quot;&quot;&quot;</span>
        <span class="s5"># Test to make sure the allclose call within signal.normalize does not</span>
        <span class="s5"># choose false positives. Then check against a known output from MATLAB</span>
        <span class="s5"># to make sure the fix doesn't break anything.</span>

        <span class="s5"># These are the coefficients returned from</span>
        <span class="s5">#   `[b,a] = cheby1(8, 0.5, 0.048)'</span>
        <span class="s5"># in MATLAB. There are at least 15 significant figures in each</span>
        <span class="s5"># coefficient, so it makes sense to test for errors on the order of</span>
        <span class="s5"># 1e-13 (this can always be relaxed if different platforms have</span>
        <span class="s5"># different rounding errors)</span>
        <span class="s1">b_matlab </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">2.150733144728282e-11</span><span class="s2">, </span><span class="s4">1.720586515782626e-10</span><span class="s2">,</span>
                             <span class="s4">6.022052805239190e-10</span><span class="s2">, </span><span class="s4">1.204410561047838e-09</span><span class="s2">,</span>
                             <span class="s4">1.505513201309798e-09</span><span class="s2">, </span><span class="s4">1.204410561047838e-09</span><span class="s2">,</span>
                             <span class="s4">6.022052805239190e-10</span><span class="s2">, </span><span class="s4">1.720586515782626e-10</span><span class="s2">,</span>
                             <span class="s4">2.150733144728282e-11</span><span class="s2">])</span>
        <span class="s1">a_matlab </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.000000000000000e+00</span><span class="s2">, -</span><span class="s4">7.782402035027959e+00</span><span class="s2">,</span>
                             <span class="s4">2.654354569747454e+01</span><span class="s2">, -</span><span class="s4">5.182182531666387e+01</span><span class="s2">,</span>
                             <span class="s4">6.334127355102684e+01</span><span class="s2">, -</span><span class="s4">4.963358186631157e+01</span><span class="s2">,</span>
                             <span class="s4">2.434862182949389e+01</span><span class="s2">, -</span><span class="s4">6.836925348604676e+00</span><span class="s2">,</span>
                             <span class="s4">8.412934944449140e-01</span><span class="s2">])</span>

        <span class="s5"># This is the input to signal.normalize after passing through the</span>
        <span class="s5"># equivalent steps in signal.iirfilter as was done for MATLAB</span>
        <span class="s1">b_norm_in </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.5543135865293012e-06</span><span class="s2">, </span><span class="s4">1.2434508692234413e-05</span><span class="s2">,</span>
                              <span class="s4">4.3520780422820447e-05</span><span class="s2">, </span><span class="s4">8.7041560845640893e-05</span><span class="s2">,</span>
                              <span class="s4">1.0880195105705122e-04</span><span class="s2">, </span><span class="s4">8.7041560845640975e-05</span><span class="s2">,</span>
                              <span class="s4">4.3520780422820447e-05</span><span class="s2">, </span><span class="s4">1.2434508692234413e-05</span><span class="s2">,</span>
                              <span class="s4">1.5543135865293012e-06</span><span class="s2">])</span>
        <span class="s1">a_norm_in </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">7.2269025909127173e+04</span><span class="s2">, -</span><span class="s4">5.6242661430467968e+05</span><span class="s2">,</span>
                              <span class="s4">1.9182761917308895e+06</span><span class="s2">, -</span><span class="s4">3.7451128364682454e+06</span><span class="s2">,</span>
                              <span class="s4">4.5776121393762771e+06</span><span class="s2">, -</span><span class="s4">3.5869706138592605e+06</span><span class="s2">,</span>
                              <span class="s4">1.7596511818472347e+06</span><span class="s2">, -</span><span class="s4">4.9409793515707983e+05</span><span class="s2">,</span>
                              <span class="s4">6.0799461347219651e+04</span><span class="s2">])</span>

        <span class="s1">b_output</span><span class="s2">, </span><span class="s1">a_output </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">b_norm_in</span><span class="s2">, </span><span class="s1">a_norm_in</span><span class="s2">)</span>

        <span class="s5"># The test on b works for decimal=14 but the one for a does not. For</span>
        <span class="s5"># the sake of consistency, both of these are decimal=13. If something</span>
        <span class="s5"># breaks on another platform, it is probably fine to relax this lower.</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b_matlab</span><span class="s2">, </span><span class="s1">b_output</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">13</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a_matlab</span><span class="s2">, </span><span class="s1">a_output</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">13</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_errors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Test the error cases.&quot;&quot;&quot;</span>
        <span class="s5"># all zero denominator</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">normalize</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s4">0</span><span class="s2">)</span>

        <span class="s5"># denominator not 1 dimensional</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">normalize</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [[</span><span class="s4">1</span><span class="s2">]])</span>

        <span class="s5"># numerator too many dimensions</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">normalize</span><span class="s2">, [[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]]], </span><span class="s4">1</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLp2lp</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">b_lp</span><span class="s2">, </span><span class="s1">a_lp </span><span class="s2">= </span><span class="s1">lp2lp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">0.38574256627112119</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b_lp</span><span class="s2">, [</span><span class="s4">0.1488</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a_lp</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.5455</span><span class="s2">, </span><span class="s4">0.1488</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLp2hp</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s4">0.25059432325190018</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.59724041654134863</span><span class="s2">, </span><span class="s4">0.92834805757524175</span><span class="s2">, </span><span class="s4">0.25059432325190018</span><span class="s2">]</span>
        <span class="s1">b_hp</span><span class="s2">, </span><span class="s1">a_hp </span><span class="s2">= </span><span class="s1">lp2hp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*</span><span class="s4">5000</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b_hp</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a_hp</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.1638e5</span><span class="s2">, </span><span class="s4">2.3522e9</span><span class="s2">, </span><span class="s4">1.2373e14</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLp2bp</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">b_bp</span><span class="s2">, </span><span class="s1">a_bp </span><span class="s2">= </span><span class="s1">lp2bp</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*</span><span class="s4">4000</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b_bp</span><span class="s2">, [</span><span class="s4">1.9844e12</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a_bp</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2.5133e4</span><span class="s2">, </span><span class="s4">2.2108e9</span><span class="s2">, </span><span class="s4">3.3735e13</span><span class="s2">,</span>
                               <span class="s4">1.3965e18</span><span class="s2">, </span><span class="s4">1.0028e22</span><span class="s2">, </span><span class="s4">2.5202e26</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLp2bs</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">b_bs</span><span class="s2">, </span><span class="s1">a_bs </span><span class="s2">= </span><span class="s1">lp2bs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">0.41722257286366754</span><span class="s2">, </span><span class="s4">0.18460575326152251</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b_bs</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.17407</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a_bs</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.18461</span><span class="s2">, </span><span class="s4">0.17407</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">5</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestBilinear</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s4">0.14879732743343033</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.54552236880522209</span><span class="s2">, </span><span class="s4">0.14879732743343033</span><span class="s2">]</span>
        <span class="s1">b_z</span><span class="s2">, </span><span class="s1">a_z </span><span class="s2">= </span><span class="s1">bilinear</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b_z</span><span class="s2">, [</span><span class="s4">0.087821</span><span class="s2">, </span><span class="s4">0.17564</span><span class="s2">, </span><span class="s4">0.087821</span><span class="s2">],</span>
                                  <span class="s1">decimal</span><span class="s2">=</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a_z</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.0048</span><span class="s2">, </span><span class="s4">0.35606</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

        <span class="s1">b </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.17407467530697837</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.18460575326152251</span><span class="s2">, </span><span class="s4">0.17407467530697837</span><span class="s2">]</span>
        <span class="s1">b_z</span><span class="s2">, </span><span class="s1">a_z </span><span class="s2">= </span><span class="s1">bilinear</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b_z</span><span class="s2">, [</span><span class="s4">0.86413</span><span class="s2">, -</span><span class="s4">1.2158</span><span class="s2">, </span><span class="s4">0.86413</span><span class="s2">],</span>
                                  <span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a_z</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1.2158</span><span class="s2">, </span><span class="s4">0.72826</span><span class="s2">],</span>
                                  <span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s4">0.14879732743343033</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.54552236880522209</span><span class="s2">, </span><span class="s4">0.14879732743343033</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">bilinear</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*be none&quot;</span><span class="s2">):</span>
            <span class="s1">bilinear</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLp2lp_zpk</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z </span><span class="s2">= []</span>
        <span class="s1">p </span><span class="s2">= [(-</span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">)/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), (-</span><span class="s4">1</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">)/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>
        <span class="s1">z_lp</span><span class="s2">, </span><span class="s1">p_lp</span><span class="s2">, </span><span class="s1">k_lp </span><span class="s2">= </span><span class="s1">lp2lp_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z_lp</span><span class="s2">, [])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p_lp</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p</span><span class="s2">)*</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k_lp</span><span class="s2">, </span><span class="s4">25</span><span class="s2">)</span>

        <span class="s5"># Pseudo-Chebyshev with both poles and zeros</span>
        <span class="s1">z </span><span class="s2">= [-</span><span class="s4">2j</span><span class="s2">, +</span><span class="s4">2j</span><span class="s2">]</span>
        <span class="s1">p </span><span class="s2">= [-</span><span class="s4">0.75</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">-</span><span class="s4">0.5j</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">+</span><span class="s4">0.5j</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">z_lp</span><span class="s2">, </span><span class="s1">p_lp</span><span class="s2">, </span><span class="s1">k_lp </span><span class="s2">= </span><span class="s1">lp2lp_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z_lp</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([-</span><span class="s4">40j</span><span class="s2">, +</span><span class="s4">40j</span><span class="s2">]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p_lp</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([-</span><span class="s4">15</span><span class="s2">, -</span><span class="s4">10</span><span class="s2">-</span><span class="s4">10j</span><span class="s2">, -</span><span class="s4">10</span><span class="s2">+</span><span class="s4">10j</span><span class="s2">]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k_lp</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z </span><span class="s2">= [-</span><span class="s4">2j</span><span class="s2">, +</span><span class="s4">2j</span><span class="s2">]</span>
        <span class="s1">p </span><span class="s2">= [-</span><span class="s4">0.75</span><span class="s2">, -</span><span class="s4">0.5 </span><span class="s2">- </span><span class="s4">0.5j</span><span class="s2">, -</span><span class="s4">0.5 </span><span class="s2">+ </span><span class="s4">0.5j</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">3</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">bilinear_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*be none&quot;</span><span class="s2">):</span>
            <span class="s1">bilinear_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLp2hp_zpk</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z </span><span class="s2">= []</span>
        <span class="s1">p </span><span class="s2">= [(-</span><span class="s4">1</span><span class="s2">+</span><span class="s4">1j</span><span class="s2">)/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), (-</span><span class="s4">1</span><span class="s2">-</span><span class="s4">1j</span><span class="s2">)/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">1</span>

        <span class="s1">z_hp</span><span class="s2">, </span><span class="s1">p_hp</span><span class="s2">, </span><span class="s1">k_hp </span><span class="s2">= </span><span class="s1">lp2hp_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z_hp</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p_hp</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p</span><span class="s2">)*</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k_hp</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

        <span class="s1">z </span><span class="s2">= [-</span><span class="s4">2j</span><span class="s2">, +</span><span class="s4">2j</span><span class="s2">]</span>
        <span class="s1">p </span><span class="s2">= [-</span><span class="s4">0.75</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">-</span><span class="s4">0.5j</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">+</span><span class="s4">0.5j</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">z_hp</span><span class="s2">, </span><span class="s1">p_hp</span><span class="s2">, </span><span class="s1">k_hp </span><span class="s2">= </span><span class="s1">lp2hp_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z_hp</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([-</span><span class="s4">3j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, +</span><span class="s4">3j</span><span class="s2">]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p_hp</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([-</span><span class="s4">8</span><span class="s2">, -</span><span class="s4">6</span><span class="s2">-</span><span class="s4">6j</span><span class="s2">, -</span><span class="s4">6</span><span class="s2">+</span><span class="s4">6j</span><span class="s2">]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k_hp</span><span class="s2">, </span><span class="s4">32</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLp2bp_zpk</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z </span><span class="s2">= [-</span><span class="s4">2j</span><span class="s2">, +</span><span class="s4">2j</span><span class="s2">]</span>
        <span class="s1">p </span><span class="s2">= [-</span><span class="s4">0.75</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">-</span><span class="s4">0.5j</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">+</span><span class="s4">0.5j</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">z_bp</span><span class="s2">, </span><span class="s1">p_bp</span><span class="s2">, </span><span class="s1">k_bp </span><span class="s2">= </span><span class="s1">lp2bp_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">15</span><span class="s2">, </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z_bp</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([-</span><span class="s4">25j</span><span class="s2">, -</span><span class="s4">9j</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, +</span><span class="s4">9j</span><span class="s2">, +</span><span class="s4">25j</span><span class="s2">]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p_bp</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([-</span><span class="s4">3 </span><span class="s2">+ </span><span class="s4">6j</span><span class="s2">*</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">6</span><span class="s2">),</span>
                                          <span class="s2">-</span><span class="s4">3 </span><span class="s2">- </span><span class="s4">6j</span><span class="s2">*</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">6</span><span class="s2">),</span>
                                          <span class="s2">+</span><span class="s4">2j</span><span class="s2">+</span><span class="s1">sqrt</span><span class="s2">(-</span><span class="s4">8j</span><span class="s2">-</span><span class="s4">225</span><span class="s2">)-</span><span class="s4">2</span><span class="s2">,</span>
                                          <span class="s2">-</span><span class="s4">2j</span><span class="s2">+</span><span class="s1">sqrt</span><span class="s2">(+</span><span class="s4">8j</span><span class="s2">-</span><span class="s4">225</span><span class="s2">)-</span><span class="s4">2</span><span class="s2">,</span>
                                          <span class="s2">+</span><span class="s4">2j</span><span class="s2">-</span><span class="s1">sqrt</span><span class="s2">(-</span><span class="s4">8j</span><span class="s2">-</span><span class="s4">225</span><span class="s2">)-</span><span class="s4">2</span><span class="s2">,</span>
                                          <span class="s2">-</span><span class="s4">2j</span><span class="s2">-</span><span class="s1">sqrt</span><span class="s2">(+</span><span class="s4">8j</span><span class="s2">-</span><span class="s4">225</span><span class="s2">)-</span><span class="s4">2</span><span class="s2">, ]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k_bp</span><span class="s2">, </span><span class="s4">24</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestLp2bs_zpk</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z </span><span class="s2">= [-</span><span class="s4">2j</span><span class="s2">, +</span><span class="s4">2j</span><span class="s2">]</span>
        <span class="s1">p </span><span class="s2">= [-</span><span class="s4">0.75</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">-</span><span class="s4">0.5j</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">+</span><span class="s4">0.5j</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">3</span>

        <span class="s1">z_bs</span><span class="s2">, </span><span class="s1">p_bs</span><span class="s2">, </span><span class="s1">k_bs </span><span class="s2">= </span><span class="s1">lp2bs_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">35</span><span class="s2">, </span><span class="s4">12</span><span class="s2">)</span>

        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z_bs</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([+</span><span class="s4">35j</span><span class="s2">, -</span><span class="s4">35j</span><span class="s2">,</span>
                                          <span class="s2">+</span><span class="s4">3j</span><span class="s2">+</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">1234</span><span class="s2">)*</span><span class="s4">1j</span><span class="s2">,</span>
                                          <span class="s2">-</span><span class="s4">3j</span><span class="s2">+</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">1234</span><span class="s2">)*</span><span class="s4">1j</span><span class="s2">,</span>
                                          <span class="s2">+</span><span class="s4">3j</span><span class="s2">-</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">1234</span><span class="s2">)*</span><span class="s4">1j</span><span class="s2">,</span>
                                          <span class="s2">-</span><span class="s4">3j</span><span class="s2">-</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">1234</span><span class="s2">)*</span><span class="s4">1j</span><span class="s2">]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p_bs</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([+</span><span class="s4">3j</span><span class="s2">*</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">129</span><span class="s2">) - </span><span class="s4">8</span><span class="s2">,</span>
                                          <span class="s2">-</span><span class="s4">3j</span><span class="s2">*</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">129</span><span class="s2">) - </span><span class="s4">8</span><span class="s2">,</span>
                                          <span class="s2">(-</span><span class="s4">6 </span><span class="s2">+ </span><span class="s4">6j</span><span class="s2">) - </span><span class="s1">sqrt</span><span class="s2">(-</span><span class="s4">1225 </span><span class="s2">- </span><span class="s4">72j</span><span class="s2">),</span>
                                          <span class="s2">(-</span><span class="s4">6 </span><span class="s2">- </span><span class="s4">6j</span><span class="s2">) - </span><span class="s1">sqrt</span><span class="s2">(-</span><span class="s4">1225 </span><span class="s2">+ </span><span class="s4">72j</span><span class="s2">),</span>
                                          <span class="s2">(-</span><span class="s4">6 </span><span class="s2">+ </span><span class="s4">6j</span><span class="s2">) + </span><span class="s1">sqrt</span><span class="s2">(-</span><span class="s4">1225 </span><span class="s2">- </span><span class="s4">72j</span><span class="s2">),</span>
                                          <span class="s2">(-</span><span class="s4">6 </span><span class="s2">- </span><span class="s4">6j</span><span class="s2">) + </span><span class="s1">sqrt</span><span class="s2">(-</span><span class="s4">1225 </span><span class="s2">+ </span><span class="s4">72j</span><span class="s2">), ]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k_bs</span><span class="s2">, </span><span class="s4">32</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestBilinear_zpk</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z </span><span class="s2">= [-</span><span class="s4">2j</span><span class="s2">, +</span><span class="s4">2j</span><span class="s2">]</span>
        <span class="s1">p </span><span class="s2">= [-</span><span class="s4">0.75</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">-</span><span class="s4">0.5j</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">+</span><span class="s4">0.5j</span><span class="s2">]</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s4">3</span>

        <span class="s1">z_d</span><span class="s2">, </span><span class="s1">p_d</span><span class="s2">, </span><span class="s1">k_d </span><span class="s2">= </span><span class="s1">bilinear_zpk</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>

        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">z_d</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([(</span><span class="s4">20</span><span class="s2">-</span><span class="s4">2j</span><span class="s2">)/(</span><span class="s4">20</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">), (</span><span class="s4">20</span><span class="s2">+</span><span class="s4">2j</span><span class="s2">)/(</span><span class="s4">20</span><span class="s2">-</span><span class="s4">2j</span><span class="s2">),</span>
                                         <span class="s2">-</span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">p_d</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">([</span><span class="s4">77</span><span class="s2">/</span><span class="s4">83</span><span class="s2">,</span>
                                         <span class="s2">(</span><span class="s4">1j</span><span class="s2">/</span><span class="s4">2 </span><span class="s2">+ </span><span class="s4">39</span><span class="s2">/</span><span class="s4">2</span><span class="s2">) / (</span><span class="s4">41</span><span class="s2">/</span><span class="s4">2 </span><span class="s2">- </span><span class="s4">1j</span><span class="s2">/</span><span class="s4">2</span><span class="s2">),</span>
                                         <span class="s2">(</span><span class="s4">39</span><span class="s2">/</span><span class="s4">2 </span><span class="s2">- </span><span class="s4">1j</span><span class="s2">/</span><span class="s4">2</span><span class="s2">) / (</span><span class="s4">1j</span><span class="s2">/</span><span class="s4">2 </span><span class="s2">+ </span><span class="s4">41</span><span class="s2">/</span><span class="s4">2</span><span class="s2">), ]))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k_d</span><span class="s2">, </span><span class="s4">9696</span><span class="s2">/</span><span class="s4">69803</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestPrototypeType</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_output_type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Prototypes should consistently output arrays, not lists</span>
        <span class="s5"># https://github.com/scipy/scipy/pull/441</span>
        <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s2">(</span><span class="s1">buttap</span><span class="s2">,</span>
                     <span class="s1">besselap</span><span class="s2">,</span>
                     <span class="s0">lambda </span><span class="s1">N</span><span class="s2">: </span><span class="s1">cheb1ap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),</span>
                     <span class="s0">lambda </span><span class="s1">N</span><span class="s2">: </span><span class="s1">cheb2ap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">20</span><span class="s2">),</span>
                     <span class="s0">lambda </span><span class="s1">N</span><span class="s2">: </span><span class="s1">ellipap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)):</span>
            <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">7</span><span class="s2">):</span>
                <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)</span>
                <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">))</span>
                <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
    <span class="s5"># Return magnitude in decibels, avoiding divide-by-zero warnings</span>
    <span class="s5"># (and deal with some &quot;not less-ordered&quot; errors when -inf shows up)</span>
    <span class="s0">return </span><span class="s4">20 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">maximum</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">finfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">tiny</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">TestButtord</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_lowpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'lowpass'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">ws </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]), -</span><span class="s1">rs</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">16</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">2.0002776782743284e-01</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_highpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">70</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'highpass'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">wp </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">]), -</span><span class="s1">rs</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">18</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">2.9996603079132672e-01</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">80</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bandpass'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">18</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">1.9998742411409134e-01</span><span class="s2">, </span><span class="s4">5.0002139595676276e-01</span><span class="s2">],</span>
                        <span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandstop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">90</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bandstop'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]),</span>
                          <span class="s2">-</span><span class="s1">rs</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">1.4759432329294042e-01</span><span class="s2">, </span><span class="s4">5.9997365985276407e-01</span><span class="s2">],</span>
                        <span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_analog</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">200</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">600</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'lowpass'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">ws </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]), -</span><span class="s1">rs</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">7</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">2.0006785355671877e+02</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

        <span class="s1">n</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">550</span><span class="s2">/</span><span class="s4">450</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">26</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s4">19</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">1.0361980524629517</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">buttord</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">], </span><span class="s4">55</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">4410</span><span class="s2">, </span><span class="s4">11025</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">2205</span><span class="s2">, </span><span class="s4">13230</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">80</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">44100</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bandpass'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">18</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">4409.722701715714</span><span class="s2">, </span><span class="s4">11025.47178084662</span><span class="s2">],</span>
                        <span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_invalid_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">buttord</span><span class="s2">([</span><span class="s4">20</span><span class="s2">, </span><span class="s4">50</span><span class="s2">], [</span><span class="s4">14</span><span class="s2">, </span><span class="s4">60</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gpass should be smaller than gstop&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">buttord</span><span class="s2">([</span><span class="s4">20</span><span class="s2">, </span><span class="s4">50</span><span class="s2">], [</span><span class="s4">14</span><span class="s2">, </span><span class="s4">60</span><span class="s2">], -</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gpass should be larger than 0.0&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">buttord</span><span class="s2">([</span><span class="s4">20</span><span class="s2">, </span><span class="s4">50</span><span class="s2">], [</span><span class="s4">14</span><span class="s2">, </span><span class="s4">60</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gstop should be larger than 0.0&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_runtime_warnings</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Order is zero.*|divide by zero encountered&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">buttord</span><span class="s2">(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ellip_butter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># The purpose of the test is to compare to some known output from past</span>
        <span class="s5"># scipy versions. The values to compare to are generated with scipy</span>
        <span class="s5"># 1.9.1 (there is nothing special about this particular version though)</span>
        <span class="s1">n</span><span class="s2">, </span><span class="s1">wn </span><span class="s2">= </span><span class="s1">buttord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">n </span><span class="s2">== </span><span class="s4">14</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">buttord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestCheb1ord</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_lowpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">ws </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_highpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">70</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">wp </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">80</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'band'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandstop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">90</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">0.14758232569947785</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_analog</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">700</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">100</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">70</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">wp </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">700</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">], </span><span class="s4">17</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">4800</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">7200</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">48000</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">ws </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">4800</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_invalid_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">cheb1ord</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gpass should be smaller than gstop&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">cheb1ord</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gpass should be larger than 0.0&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">cheb1ord</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gstop should be larger than 0.0&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ellip_cheb1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># The purpose of the test is to compare to some known output from past</span>
        <span class="s5"># scipy versions. The values to compare to are generated with scipy</span>
        <span class="s5"># 1.9.1 (there is nothing special about this particular version though)</span>
        <span class="s1">n</span><span class="s2">, </span><span class="s1">wn </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">n </span><span class="s2">== </span><span class="s4">7</span>

        <span class="s1">n2</span><span class="s2">, </span><span class="s1">w2 </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s2">(</span><span class="s1">wn </span><span class="s2">== </span><span class="s1">w2</span><span class="s2">).</span><span class="s1">all</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">cheb1ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestCheb2ord</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_lowpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'lp'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">ws </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">0.28647639976553163</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_highpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">70</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'hp'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">wp </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">0.20697492182903282</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">80</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bp'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">0.14876937565923479</span><span class="s2">, </span><span class="s4">0.59748447842351482</span><span class="s2">],</span>
                        <span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandstop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">90</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">0.19926249974781743</span><span class="s2">, </span><span class="s4">0.50125246585567362</span><span class="s2">],</span>
                        <span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_analog</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">20</span><span class="s2">, </span><span class="s4">50</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">10</span><span class="s2">, </span><span class="s4">60</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">80</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bp'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">11</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">1.673740595370124e+01</span><span class="s2">, </span><span class="s4">5.974641487254268e+01</span><span class="s2">],</span>
                        <span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">150</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">100</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">70</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'hp'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">wp </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">103.4874609145164</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_invalid_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">cheb2ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gpass should be smaller than gstop&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">cheb2ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], -</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gpass should be larger than 0.0&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">cheb2ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gstop should be larger than 0.0&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ellip_cheb2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># The purpose of the test is to compare to some known output from past</span>
        <span class="s5"># scipy versions. The values to compare to are generated with scipy</span>
        <span class="s5"># 1.9.1 (there is nothing special about this particular version though)</span>
        <span class="s1">n</span><span class="s2">, </span><span class="s1">wn </span><span class="s2">= </span><span class="s1">cheb2ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">n </span><span class="s2">== </span><span class="s4">7</span>

        <span class="s1">n1</span><span class="s2">, </span><span class="s1">w1 </span><span class="s2">= </span><span class="s1">cheb1ord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s2">(</span><span class="s1">wn </span><span class="s2">== </span><span class="s1">w1</span><span class="s2">).</span><span class="s1">all</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">cheb2ord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestEllipord</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_lowpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'lp'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">ws </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_lowpass_1000dB</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># failed when ellipkm1 wasn't used in ellipord and ellipap</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'lp'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">sosfreqz</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">ws </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_highpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">70</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'hp'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">wp </span><span class="s2">&lt;= </span><span class="s1">w</span><span class="s2">]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">]), -</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">80</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bp'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandstop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">90</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">/= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">7</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">0.14758232794342988</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_analog</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">6000</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">5000</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">90</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">1666.6666</span><span class="s2">, </span><span class="s4">6000</span><span class="s2">])</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">ellipord</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">], </span><span class="s4">9</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= [</span><span class="s4">400</span><span class="s2">, </span><span class="s4">2400</span><span class="s2">]</span>
        <span class="s1">ws </span><span class="s2">= [</span><span class="s4">800</span><span class="s2">, </span><span class="s4">2000</span><span class="s2">]</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">90</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">8000</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">Wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
        <span class="s1">assert_array_less</span><span class="s2">(-</span><span class="s1">rp </span><span class="s2">- </span><span class="s4">0.1</span><span class="s2">,</span>
                          <span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_or</span><span class="s2">(</span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">wp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">)]))</span>
        <span class="s1">assert_array_less</span><span class="s2">(</span><span class="s1">dB</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">logical_and</span><span class="s2">(</span><span class="s1">ws</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] &lt;= </span><span class="s1">w</span><span class="s2">, </span><span class="s1">w </span><span class="s2">&lt;= </span><span class="s1">ws</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])]),</span>
                          <span class="s2">-</span><span class="s1">rs </span><span class="s2">+ </span><span class="s4">0.1</span><span class="s2">)</span>

        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">7</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">Wn</span><span class="s2">, [</span><span class="s4">590.3293117737195</span><span class="s2">, </span><span class="s4">2400</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_invalid_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">ellipord</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gpass should be smaller than gstop&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">ellipord</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gpass should be larger than 0.0&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">) </span><span class="s0">as </span><span class="s1">exc_info</span><span class="s2">:</span>
            <span class="s1">ellipord</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s3">&quot;gstop should be larger than 0.0&quot; </span><span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">exc_info</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ellip_butter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># The purpose of the test is to compare to some known output from past</span>
        <span class="s5"># scipy versions. The values to compare to are generated with scipy</span>
        <span class="s5"># 1.9.1 (there is nothing special about this particular version though)</span>
        <span class="s1">n</span><span class="s2">, </span><span class="s1">wn </span><span class="s2">= </span><span class="s1">ellipord</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">3</span><span class="s2">, </span><span class="s4">60</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">n </span><span class="s2">== </span><span class="s4">5</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">wp </span><span class="s2">= </span><span class="s4">0.2</span>
        <span class="s1">ws </span><span class="s2">= </span><span class="s4">0.3</span>
        <span class="s1">rp </span><span class="s2">= </span><span class="s4">3</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s4">60</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">ellipord</span><span class="s2">(</span><span class="s1">wp</span><span class="s2">, </span><span class="s1">ws</span><span class="s2">, </span><span class="s1">rp</span><span class="s2">, </span><span class="s1">rs</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestBessel</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_degenerate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">norm </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'delay'</span><span class="s2">, </span><span class="s3">'phase'</span><span class="s2">, </span><span class="s3">'mag'</span><span class="s2">):</span>
            <span class="s5"># 0-order filter is just a passthrough</span>
            <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
            <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
            <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

            <span class="s5"># 1-order filter is same for all types</span>
            <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
            <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [])</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, [-</span><span class="s4">0.3</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_high_order</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># high even order, 'phase'</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">24</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= []</span>
        <span class="s1">p2 </span><span class="s2">= [</span>
             <span class="s2">-</span><span class="s4">9.055312334014323e+01 </span><span class="s2">+ </span><span class="s4">4.844005815403969e+00j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">8.983105162681878e+01 </span><span class="s2">+ </span><span class="s4">1.454056170018573e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">8.837357994162065e+01 </span><span class="s2">+ </span><span class="s4">2.426335240122282e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">8.615278316179575e+01 </span><span class="s2">+ </span><span class="s4">3.403202098404543e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">8.312326467067703e+01 </span><span class="s2">+ </span><span class="s4">4.386985940217900e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">7.921695461084202e+01 </span><span class="s2">+ </span><span class="s4">5.380628489700191e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">7.433392285433246e+01 </span><span class="s2">+ </span><span class="s4">6.388084216250878e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">6.832565803501586e+01 </span><span class="s2">+ </span><span class="s4">7.415032695116071e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">6.096221567378025e+01 </span><span class="s2">+ </span><span class="s4">8.470292433074425e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">5.185914574820616e+01 </span><span class="s2">+ </span><span class="s4">9.569048385258847e+01j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">4.027853855197555e+01 </span><span class="s2">+ </span><span class="s4">1.074195196518679e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">2.433481337524861e+01 </span><span class="s2">+ </span><span class="s4">1.207298683731973e+02j</span><span class="s2">,</span>
             <span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">9.999999999999989e+47</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">union1d</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">)), </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

        <span class="s5"># high odd order, 'phase'</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">23</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= []</span>
        <span class="s1">p2 </span><span class="s2">= [</span>
             <span class="s2">-</span><span class="s4">2.497697202208956e+02 </span><span class="s2">+ </span><span class="s4">1.202813187870698e+03j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">4.126986617510172e+02 </span><span class="s2">+ </span><span class="s4">1.065328794475509e+03j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">5.304922463809596e+02 </span><span class="s2">+ </span><span class="s4">9.439760364018479e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">9.027564978975828e+02 </span><span class="s2">+ </span><span class="s4">1.010534334242318e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">8.909283244406079e+02 </span><span class="s2">+ </span><span class="s4">2.023024699647598e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">8.709469394347836e+02 </span><span class="s2">+ </span><span class="s4">3.039581994804637e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">8.423805948131370e+02 </span><span class="s2">+ </span><span class="s4">4.062657947488952e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">8.045561642249877e+02 </span><span class="s2">+ </span><span class="s4">5.095305912401127e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">7.564660146766259e+02 </span><span class="s2">+ </span><span class="s4">6.141594859516342e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">6.965966033906477e+02 </span><span class="s2">+ </span><span class="s4">7.207341374730186e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">6.225903228776276e+02 </span><span class="s2">+ </span><span class="s4">8.301558302815096e+02j</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">9.066732476324988e+02</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">9.999999999999983e+68</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">union1d</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">)), </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

        <span class="s5"># high even order, 'delay' (Orchard 1965 &quot;The Roots of the</span>
        <span class="s5"># Maximally Flat-Delay Polynomials&quot; Table 1)</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">31</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'delay'</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">20.876706</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">20.826543 </span><span class="s2">+ </span><span class="s4">1.735732j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">20.675502 </span><span class="s2">+ </span><span class="s4">3.473320j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">20.421895 </span><span class="s2">+ </span><span class="s4">5.214702j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">20.062802 </span><span class="s2">+ </span><span class="s4">6.961982j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">19.593895 </span><span class="s2">+ </span><span class="s4">8.717546j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">19.009148 </span><span class="s2">+ </span><span class="s4">10.484195j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">18.300400 </span><span class="s2">+ </span><span class="s4">12.265351j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">17.456663 </span><span class="s2">+ </span><span class="s4">14.065350j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">16.463032 </span><span class="s2">+ </span><span class="s4">15.889910j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">15.298849 </span><span class="s2">+ </span><span class="s4">17.746914j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">13.934466 </span><span class="s2">+ </span><span class="s4">19.647827j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">12.324914 </span><span class="s2">+ </span><span class="s4">21.610519j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">10.395893 </span><span class="s2">+ </span><span class="s4">23.665701j</span><span class="s2">,</span>
              <span class="s2">- </span><span class="s4">8.005600 </span><span class="s2">+ </span><span class="s4">25.875019j</span><span class="s2">,</span>
              <span class="s2">- </span><span class="s4">4.792045 </span><span class="s2">+ </span><span class="s4">28.406037j</span><span class="s2">,</span>
              <span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">union1d</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">)), </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">))</span>

        <span class="s5"># high odd order, 'delay'</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">30</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'delay'</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">20.201029 </span><span class="s2">+ </span><span class="s4">0.867750j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">20.097257 </span><span class="s2">+ </span><span class="s4">2.604235j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">19.888485 </span><span class="s2">+ </span><span class="s4">4.343721j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">19.572188 </span><span class="s2">+ </span><span class="s4">6.088363j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">19.144380 </span><span class="s2">+ </span><span class="s4">7.840570j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">18.599342 </span><span class="s2">+ </span><span class="s4">9.603147j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">17.929195 </span><span class="s2">+ </span><span class="s4">11.379494j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">17.123228 </span><span class="s2">+ </span><span class="s4">13.173901j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">16.166808 </span><span class="s2">+ </span><span class="s4">14.992008j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">15.039580 </span><span class="s2">+ </span><span class="s4">16.841580j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">13.712245 </span><span class="s2">+ </span><span class="s4">18.733902j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">12.140295 </span><span class="s2">+ </span><span class="s4">20.686563j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">10.250119 </span><span class="s2">+ </span><span class="s4">22.729808j</span><span class="s2">,</span>
              <span class="s2">- </span><span class="s4">7.901170 </span><span class="s2">+ </span><span class="s4">24.924391j</span><span class="s2">,</span>
              <span class="s2">- </span><span class="s4">4.734679 </span><span class="s2">+ </span><span class="s4">27.435615j</span><span class="s2">,</span>
              <span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">union1d</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">)), </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_refs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compare to http://www.crbond.com/papers/bsf2.pdf</span>
        <span class="s5"># &quot;Delay Normalized Bessel Polynomial Coefficients&quot;</span>
        <span class="s1">bond_b </span><span class="s2">= </span><span class="s4">10395</span>
        <span class="s1">bond_a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">21</span><span class="s2">, </span><span class="s4">210</span><span class="s2">, </span><span class="s4">1260</span><span class="s2">, </span><span class="s4">4725</span><span class="s2">, </span><span class="s4">10395</span><span class="s2">, </span><span class="s4">10395</span><span class="s2">]</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'delay'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bond_b</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bond_a</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>

        <span class="s5"># &quot;Delay Normalized Bessel Pole Locations&quot;</span>
        <span class="s1">bond_poles </span><span class="s2">= {</span>
            <span class="s4">1</span><span class="s2">: [-</span><span class="s4">1.0000000000</span><span class="s2">],</span>
            <span class="s4">2</span><span class="s2">: [-</span><span class="s4">1.5000000000 </span><span class="s2">+ </span><span class="s4">0.8660254038j</span><span class="s2">],</span>
            <span class="s4">3</span><span class="s2">: [-</span><span class="s4">1.8389073227 </span><span class="s2">+ </span><span class="s4">1.7543809598j</span><span class="s2">, -</span><span class="s4">2.3221853546</span><span class="s2">],</span>
            <span class="s4">4</span><span class="s2">: [-</span><span class="s4">2.1037893972 </span><span class="s2">+ </span><span class="s4">2.6574180419j</span><span class="s2">, -</span><span class="s4">2.8962106028 </span><span class="s2">+ </span><span class="s4">0.8672341289j</span><span class="s2">],</span>
            <span class="s4">5</span><span class="s2">: [-</span><span class="s4">2.3246743032 </span><span class="s2">+ </span><span class="s4">3.5710229203j</span><span class="s2">, -</span><span class="s4">3.3519563992 </span><span class="s2">+ </span><span class="s4">1.7426614162j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">3.6467385953</span><span class="s2">],</span>
            <span class="s4">6</span><span class="s2">: [-</span><span class="s4">2.5159322478 </span><span class="s2">+ </span><span class="s4">4.4926729537j</span><span class="s2">, -</span><span class="s4">3.7357083563 </span><span class="s2">+ </span><span class="s4">2.6262723114j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">4.2483593959 </span><span class="s2">+ </span><span class="s4">0.8675096732j</span><span class="s2">],</span>
            <span class="s4">7</span><span class="s2">: [-</span><span class="s4">2.6856768789 </span><span class="s2">+ </span><span class="s4">5.4206941307j</span><span class="s2">, -</span><span class="s4">4.0701391636 </span><span class="s2">+ </span><span class="s4">3.5171740477j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">4.7582905282 </span><span class="s2">+ </span><span class="s4">1.7392860611j</span><span class="s2">, -</span><span class="s4">4.9717868585</span><span class="s2">],</span>
            <span class="s4">8</span><span class="s2">: [-</span><span class="s4">2.8389839489 </span><span class="s2">+ </span><span class="s4">6.3539112986j</span><span class="s2">, -</span><span class="s4">4.3682892172 </span><span class="s2">+ </span><span class="s4">4.4144425005j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">5.2048407906 </span><span class="s2">+ </span><span class="s4">2.6161751526j</span><span class="s2">, -</span><span class="s4">5.5878860433 </span><span class="s2">+ </span><span class="s4">0.8676144454j</span><span class="s2">],</span>
            <span class="s4">9</span><span class="s2">: [-</span><span class="s4">2.9792607982 </span><span class="s2">+ </span><span class="s4">7.2914636883j</span><span class="s2">, -</span><span class="s4">4.6384398872 </span><span class="s2">+ </span><span class="s4">5.3172716754j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">5.6044218195 </span><span class="s2">+ </span><span class="s4">3.4981569179j</span><span class="s2">, -</span><span class="s4">6.1293679043 </span><span class="s2">+ </span><span class="s4">1.7378483835j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">6.2970191817</span><span class="s2">],</span>
            <span class="s4">10</span><span class="s2">: [-</span><span class="s4">3.1089162336 </span><span class="s2">+ </span><span class="s4">8.2326994591j</span><span class="s2">, -</span><span class="s4">4.8862195669 </span><span class="s2">+ </span><span class="s4">6.2249854825j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">5.9675283286 </span><span class="s2">+ </span><span class="s4">4.3849471889j</span><span class="s2">, -</span><span class="s4">6.6152909655 </span><span class="s2">+ </span><span class="s4">2.6115679208j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">6.9220449054 </span><span class="s2">+ </span><span class="s4">0.8676651955j</span><span class="s2">]</span>
            <span class="s2">}</span>

        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">11</span><span class="s2">):</span>
            <span class="s1">p1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">bond_poles</span><span class="s2">[</span><span class="s1">N</span><span class="s2">])</span>
            <span class="s1">p2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">(</span><span class="s1">_cplxreal</span><span class="s2">(</span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'delay'</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">])))</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">10</span><span class="s2">)</span>

        <span class="s5"># &quot;Frequency Normalized Bessel Pole Locations&quot;</span>
        <span class="s1">bond_poles </span><span class="s2">= {</span>
            <span class="s4">1</span><span class="s2">: [-</span><span class="s4">1.0000000000</span><span class="s2">],</span>
            <span class="s4">2</span><span class="s2">: [-</span><span class="s4">1.1016013306 </span><span class="s2">+ </span><span class="s4">0.6360098248j</span><span class="s2">],</span>
            <span class="s4">3</span><span class="s2">: [-</span><span class="s4">1.0474091610 </span><span class="s2">+ </span><span class="s4">0.9992644363j</span><span class="s2">, -</span><span class="s4">1.3226757999</span><span class="s2">],</span>
            <span class="s4">4</span><span class="s2">: [-</span><span class="s4">0.9952087644 </span><span class="s2">+ </span><span class="s4">1.2571057395j</span><span class="s2">, -</span><span class="s4">1.3700678306 </span><span class="s2">+ </span><span class="s4">0.4102497175j</span><span class="s2">],</span>
            <span class="s4">5</span><span class="s2">: [-</span><span class="s4">0.9576765486 </span><span class="s2">+ </span><span class="s4">1.4711243207j</span><span class="s2">, -</span><span class="s4">1.3808773259 </span><span class="s2">+ </span><span class="s4">0.7179095876j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">1.5023162714</span><span class="s2">],</span>
            <span class="s4">6</span><span class="s2">: [-</span><span class="s4">0.9306565229 </span><span class="s2">+ </span><span class="s4">1.6618632689j</span><span class="s2">, -</span><span class="s4">1.3818580976 </span><span class="s2">+ </span><span class="s4">0.9714718907j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">1.5714904036 </span><span class="s2">+ </span><span class="s4">0.3208963742j</span><span class="s2">],</span>
            <span class="s4">7</span><span class="s2">: [-</span><span class="s4">0.9098677806 </span><span class="s2">+ </span><span class="s4">1.8364513530j</span><span class="s2">, -</span><span class="s4">1.3789032168 </span><span class="s2">+ </span><span class="s4">1.1915667778j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">1.6120387662 </span><span class="s2">+ </span><span class="s4">0.5892445069j</span><span class="s2">, -</span><span class="s4">1.6843681793</span><span class="s2">],</span>
            <span class="s4">8</span><span class="s2">: [-</span><span class="s4">0.8928697188 </span><span class="s2">+ </span><span class="s4">1.9983258436j</span><span class="s2">, -</span><span class="s4">1.3738412176 </span><span class="s2">+ </span><span class="s4">1.3883565759j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">1.6369394181 </span><span class="s2">+ </span><span class="s4">0.8227956251j</span><span class="s2">, -</span><span class="s4">1.7574084004 </span><span class="s2">+ </span><span class="s4">0.2728675751j</span><span class="s2">],</span>
            <span class="s4">9</span><span class="s2">: [-</span><span class="s4">0.8783992762 </span><span class="s2">+ </span><span class="s4">2.1498005243j</span><span class="s2">, -</span><span class="s4">1.3675883098 </span><span class="s2">+ </span><span class="s4">1.5677337122j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">1.6523964846 </span><span class="s2">+ </span><span class="s4">1.0313895670j</span><span class="s2">, -</span><span class="s4">1.8071705350 </span><span class="s2">+ </span><span class="s4">0.5123837306j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">1.8566005012</span><span class="s2">],</span>
            <span class="s4">10</span><span class="s2">: [-</span><span class="s4">0.8657569017 </span><span class="s2">+ </span><span class="s4">2.2926048310j</span><span class="s2">, -</span><span class="s4">1.3606922784 </span><span class="s2">+ </span><span class="s4">1.7335057427j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">1.6618102414 </span><span class="s2">+ </span><span class="s4">1.2211002186j</span><span class="s2">, -</span><span class="s4">1.8421962445 </span><span class="s2">+ </span><span class="s4">0.7272575978j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">1.9276196914 </span><span class="s2">+ </span><span class="s4">0.2416234710j</span><span class="s2">]</span>
            <span class="s2">}</span>

        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">11</span><span class="s2">):</span>
            <span class="s1">p1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">bond_poles</span><span class="s2">[</span><span class="s1">N</span><span class="s2">])</span>
            <span class="s1">p2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">(</span><span class="s1">_cplxreal</span><span class="s2">(</span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'mag'</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">])))</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">10</span><span class="s2">)</span>

        <span class="s5"># Compare to https://www.ranecommercial.com/legacy/note147.html</span>
        <span class="s5"># &quot;Table 1 - Bessel Crossovers of Second, Third, and Fourth-Order&quot;</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s4">3</span><span class="s2">]</span>
        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'delay'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">a2</span><span class="s2">/</span><span class="s1">b2</span><span class="s2">)</span>

        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">/</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s4">15</span><span class="s2">]</span>
        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'delay'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">a2</span><span class="s2">/</span><span class="s1">b2</span><span class="s2">)</span>

        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">9</span><span class="s2">/</span><span class="s4">21</span><span class="s2">, </span><span class="s4">2</span><span class="s2">/</span><span class="s4">21</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s4">105</span><span class="s2">]</span>
        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'delay'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">a2</span><span class="s2">/</span><span class="s1">b2</span><span class="s2">)</span>

        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">3</span><span class="s2">), </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'phase'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">a2</span><span class="s2">/</span><span class="s1">b2</span><span class="s2">)</span>

        <span class="s5"># TODO: Why so inaccurate?  Is reference flawed?</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2.481</span><span class="s2">, </span><span class="s4">2.463</span><span class="s2">, </span><span class="s4">1.018</span><span class="s2">]</span>
        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'phase'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">a2</span><span class="s2">/</span><span class="s1">b2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>

        <span class="s5"># TODO: Why so inaccurate?  Is reference flawed?</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3.240</span><span class="s2">, </span><span class="s4">4.5</span><span class="s2">, </span><span class="s4">3.240</span><span class="s2">, </span><span class="s4">1.050</span><span class="s2">]</span>
        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'phase'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">a2</span><span class="s2">/</span><span class="s1">b2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>

        <span class="s5"># Table of -3 dB factors:</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1.272</span>
        <span class="s1">scale2 </span><span class="s2">= </span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'mag'</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">] / </span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'phase'</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">scale2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">3</span><span class="s2">)</span>

        <span class="s5"># TODO: Why so inaccurate?  Is reference flawed?</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1.413</span>
        <span class="s1">scale2 </span><span class="s2">= </span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'mag'</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">] / </span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'phase'</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">scale2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>

        <span class="s5"># TODO: Why so inaccurate?  Is reference flawed?</span>
        <span class="s1">N</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s4">4</span><span class="s2">, </span><span class="s4">1.533</span>
        <span class="s1">scale2 </span><span class="s2">= </span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'mag'</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">] / </span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'phase'</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">scale2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_hardcoded</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compare to values from original hardcoded implementation</span>
        <span class="s1">originals </span><span class="s2">= {</span>
            <span class="s4">0</span><span class="s2">: [],</span>
            <span class="s4">1</span><span class="s2">: [-</span><span class="s4">1</span><span class="s2">],</span>
            <span class="s4">2</span><span class="s2">: [-</span><span class="s4">.8660254037844386467637229 </span><span class="s2">+ </span><span class="s4">.4999999999999999999999996j</span><span class="s2">],</span>
            <span class="s4">3</span><span class="s2">: [-</span><span class="s4">.9416000265332067855971980</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.7456403858480766441810907 </span><span class="s2">+ </span><span class="s4">.7113666249728352680992154j</span><span class="s2">],</span>
            <span class="s4">4</span><span class="s2">: [-</span><span class="s4">.6572111716718829545787788 </span><span class="s2">+ </span><span class="s4">.8301614350048733772399715j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.9047587967882449459642624 </span><span class="s2">+ </span><span class="s4">.2709187330038746636700926j</span><span class="s2">],</span>
            <span class="s4">5</span><span class="s2">: [-</span><span class="s4">.9264420773877602247196260</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.8515536193688395541722677 </span><span class="s2">+ </span><span class="s4">.4427174639443327209850002j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.5905759446119191779319432 </span><span class="s2">+ </span><span class="s4">.9072067564574549539291747j</span><span class="s2">],</span>
            <span class="s4">6</span><span class="s2">: [-</span><span class="s4">.9093906830472271808050953 </span><span class="s2">+ </span><span class="s4">.1856964396793046769246397j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.7996541858328288520243325 </span><span class="s2">+ </span><span class="s4">.5621717346937317988594118j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.5385526816693109683073792 </span><span class="s2">+ </span><span class="s4">.9616876881954277199245657j</span><span class="s2">],</span>
            <span class="s4">7</span><span class="s2">: [-</span><span class="s4">.9194871556490290014311619</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.8800029341523374639772340 </span><span class="s2">+ </span><span class="s4">.3216652762307739398381830j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.7527355434093214462291616 </span><span class="s2">+ </span><span class="s4">.6504696305522550699212995j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.4966917256672316755024763 </span><span class="s2">+ </span><span class="s4">1.002508508454420401230220j</span><span class="s2">],</span>
            <span class="s4">8</span><span class="s2">: [-</span><span class="s4">.9096831546652910216327629 </span><span class="s2">+ </span><span class="s4">.1412437976671422927888150j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.8473250802359334320103023 </span><span class="s2">+ </span><span class="s4">.4259017538272934994996429j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.7111381808485399250796172 </span><span class="s2">+ </span><span class="s4">.7186517314108401705762571j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.4621740412532122027072175 </span><span class="s2">+ </span><span class="s4">1.034388681126901058116589j</span><span class="s2">],</span>
            <span class="s4">9</span><span class="s2">: [-</span><span class="s4">.9154957797499037686769223</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.8911217017079759323183848 </span><span class="s2">+ </span><span class="s4">.2526580934582164192308115j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.8148021112269012975514135 </span><span class="s2">+ </span><span class="s4">.5085815689631499483745341j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.6743622686854761980403401 </span><span class="s2">+ </span><span class="s4">.7730546212691183706919682j</span><span class="s2">,</span>
                <span class="s2">-</span><span class="s4">.4331415561553618854685942 </span><span class="s2">+ </span><span class="s4">1.060073670135929666774323j</span><span class="s2">],</span>
            <span class="s4">10</span><span class="s2">: [-</span><span class="s4">.9091347320900502436826431 </span><span class="s2">+ </span><span class="s4">.1139583137335511169927714j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8688459641284764527921864 </span><span class="s2">+ </span><span class="s4">.3430008233766309973110589j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7837694413101441082655890 </span><span class="s2">+ </span><span class="s4">.5759147538499947070009852j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6417513866988316136190854 </span><span class="s2">+ </span><span class="s4">.8175836167191017226233947j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4083220732868861566219785 </span><span class="s2">+ </span><span class="s4">1.081274842819124562037210j</span><span class="s2">],</span>
            <span class="s4">11</span><span class="s2">: [-</span><span class="s4">.9129067244518981934637318</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8963656705721166099815744 </span><span class="s2">+ </span><span class="s4">.2080480375071031919692341j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8453044014712962954184557 </span><span class="s2">+ </span><span class="s4">.4178696917801248292797448j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7546938934722303128102142 </span><span class="s2">+ </span><span class="s4">.6319150050721846494520941j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6126871554915194054182909 </span><span class="s2">+ </span><span class="s4">.8547813893314764631518509j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.3868149510055090879155425 </span><span class="s2">+ </span><span class="s4">1.099117466763120928733632j</span><span class="s2">],</span>
            <span class="s4">12</span><span class="s2">: [-</span><span class="s4">.9084478234140682638817772 </span><span class="s2">+ </span><span class="s4">95506365213450398415258360e-27j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8802534342016826507901575 </span><span class="s2">+ </span><span class="s4">.2871779503524226723615457j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8217296939939077285792834 </span><span class="s2">+ </span><span class="s4">.4810212115100676440620548j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7276681615395159454547013 </span><span class="s2">+ </span><span class="s4">.6792961178764694160048987j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5866369321861477207528215 </span><span class="s2">+ </span><span class="s4">.8863772751320727026622149j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.3679640085526312839425808 </span><span class="s2">+ </span><span class="s4">1.114373575641546257595657j</span><span class="s2">],</span>
            <span class="s4">13</span><span class="s2">: [-</span><span class="s4">.9110914665984182781070663</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8991314665475196220910718 </span><span class="s2">+ </span><span class="s4">.1768342956161043620980863j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8625094198260548711573628 </span><span class="s2">+ </span><span class="s4">.3547413731172988997754038j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7987460692470972510394686 </span><span class="s2">+ </span><span class="s4">.5350752120696801938272504j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7026234675721275653944062 </span><span class="s2">+ </span><span class="s4">.7199611890171304131266374j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5631559842430199266325818 </span><span class="s2">+ </span><span class="s4">.9135900338325109684927731j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.3512792323389821669401925 </span><span class="s2">+ </span><span class="s4">1.127591548317705678613239j</span><span class="s2">],</span>
            <span class="s4">14</span><span class="s2">: [-</span><span class="s4">.9077932138396487614720659 </span><span class="s2">+ </span><span class="s4">82196399419401501888968130e-27j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8869506674916445312089167 </span><span class="s2">+ </span><span class="s4">.2470079178765333183201435j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8441199160909851197897667 </span><span class="s2">+ </span><span class="s4">.4131653825102692595237260j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7766591387063623897344648 </span><span class="s2">+ </span><span class="s4">.5819170677377608590492434j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6794256425119233117869491 </span><span class="s2">+ </span><span class="s4">.7552857305042033418417492j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5418766775112297376541293 </span><span class="s2">+ </span><span class="s4">.9373043683516919569183099j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.3363868224902037330610040 </span><span class="s2">+ </span><span class="s4">1.139172297839859991370924j</span><span class="s2">],</span>
            <span class="s4">15</span><span class="s2">: [-</span><span class="s4">.9097482363849064167228581</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.9006981694176978324932918 </span><span class="s2">+ </span><span class="s4">.1537681197278439351298882j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8731264620834984978337843 </span><span class="s2">+ </span><span class="s4">.3082352470564267657715883j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8256631452587146506294553 </span><span class="s2">+ </span><span class="s4">.4642348752734325631275134j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7556027168970728127850416 </span><span class="s2">+ </span><span class="s4">.6229396358758267198938604j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6579196593110998676999362 </span><span class="s2">+ </span><span class="s4">.7862895503722515897065645j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5224954069658330616875186 </span><span class="s2">+ </span><span class="s4">.9581787261092526478889345j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.3229963059766444287113517 </span><span class="s2">+ </span><span class="s4">1.149416154583629539665297j</span><span class="s2">],</span>
            <span class="s4">16</span><span class="s2">: [-</span><span class="s4">.9072099595087001356491337 </span><span class="s2">+ </span><span class="s4">72142113041117326028823950e-27j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8911723070323647674780132 </span><span class="s2">+ </span><span class="s4">.2167089659900576449410059j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8584264231521330481755780 </span><span class="s2">+ </span><span class="s4">.3621697271802065647661080j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8074790293236003885306146 </span><span class="s2">+ </span><span class="s4">.5092933751171800179676218j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7356166304713115980927279 </span><span class="s2">+ </span><span class="s4">.6591950877860393745845254j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6379502514039066715773828 </span><span class="s2">+ </span><span class="s4">.8137453537108761895522580j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5047606444424766743309967 </span><span class="s2">+ </span><span class="s4">.9767137477799090692947061j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.3108782755645387813283867 </span><span class="s2">+ </span><span class="s4">1.158552841199330479412225j</span><span class="s2">],</span>
            <span class="s4">17</span><span class="s2">: [-</span><span class="s4">.9087141161336397432860029</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.9016273850787285964692844 </span><span class="s2">+ </span><span class="s4">.1360267995173024591237303j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8801100704438627158492165 </span><span class="s2">+ </span><span class="s4">.2725347156478803885651973j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8433414495836129204455491 </span><span class="s2">+ </span><span class="s4">.4100759282910021624185986j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7897644147799708220288138 </span><span class="s2">+ </span><span class="s4">.5493724405281088674296232j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7166893842372349049842743 </span><span class="s2">+ </span><span class="s4">.6914936286393609433305754j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6193710717342144521602448 </span><span class="s2">+ </span><span class="s4">.8382497252826992979368621j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4884629337672704194973683 </span><span class="s2">+ </span><span class="s4">.9932971956316781632345466j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2998489459990082015466971 </span><span class="s2">+ </span><span class="s4">1.166761272925668786676672j</span><span class="s2">],</span>
            <span class="s4">18</span><span class="s2">: [-</span><span class="s4">.9067004324162775554189031 </span><span class="s2">+ </span><span class="s4">64279241063930693839360680e-27j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8939764278132455733032155 </span><span class="s2">+ </span><span class="s4">.1930374640894758606940586j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8681095503628830078317207 </span><span class="s2">+ </span><span class="s4">.3224204925163257604931634j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8281885016242836608829018 </span><span class="s2">+ </span><span class="s4">.4529385697815916950149364j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7726285030739558780127746 </span><span class="s2">+ </span><span class="s4">.5852778162086640620016316j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6987821445005273020051878 </span><span class="s2">+ </span><span class="s4">.7204696509726630531663123j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6020482668090644386627299 </span><span class="s2">+ </span><span class="s4">.8602708961893664447167418j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4734268069916151511140032 </span><span class="s2">+ </span><span class="s4">1.008234300314801077034158j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2897592029880489845789953 </span><span class="s2">+ </span><span class="s4">1.174183010600059128532230j</span><span class="s2">],</span>
            <span class="s4">19</span><span class="s2">: [-</span><span class="s4">.9078934217899404528985092</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.9021937639390660668922536 </span><span class="s2">+ </span><span class="s4">.1219568381872026517578164j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8849290585034385274001112 </span><span class="s2">+ </span><span class="s4">.2442590757549818229026280j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8555768765618421591093993 </span><span class="s2">+ </span><span class="s4">.3672925896399872304734923j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8131725551578197705476160 </span><span class="s2">+ </span><span class="s4">.4915365035562459055630005j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7561260971541629355231897 </span><span class="s2">+ </span><span class="s4">.6176483917970178919174173j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6818424412912442033411634 </span><span class="s2">+ </span><span class="s4">.7466272357947761283262338j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5858613321217832644813602 </span><span class="s2">+ </span><span class="s4">.8801817131014566284786759j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4595043449730988600785456 </span><span class="s2">+ </span><span class="s4">1.021768776912671221830298j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2804866851439370027628724 </span><span class="s2">+ </span><span class="s4">1.180931628453291873626003j</span><span class="s2">],</span>
            <span class="s4">20</span><span class="s2">: [-</span><span class="s4">.9062570115576771146523497 </span><span class="s2">+ </span><span class="s4">57961780277849516990208850e-27j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8959150941925768608568248 </span><span class="s2">+ </span><span class="s4">.1740317175918705058595844j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8749560316673332850673214 </span><span class="s2">+ </span><span class="s4">.2905559296567908031706902j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8427907479956670633544106 </span><span class="s2">+ </span><span class="s4">.4078917326291934082132821j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7984251191290606875799876 </span><span class="s2">+ </span><span class="s4">.5264942388817132427317659j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7402780309646768991232610 </span><span class="s2">+ </span><span class="s4">.6469975237605228320268752j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6658120544829934193890626 </span><span class="s2">+ </span><span class="s4">.7703721701100763015154510j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5707026806915714094398061 </span><span class="s2">+ </span><span class="s4">.8982829066468255593407161j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4465700698205149555701841 </span><span class="s2">+ </span><span class="s4">1.034097702560842962315411j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2719299580251652601727704 </span><span class="s2">+ </span><span class="s4">1.187099379810885886139638j</span><span class="s2">],</span>
            <span class="s4">21</span><span class="s2">: [-</span><span class="s4">.9072262653142957028884077</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.9025428073192696303995083 </span><span class="s2">+ </span><span class="s4">.1105252572789856480992275j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8883808106664449854431605 </span><span class="s2">+ </span><span class="s4">.2213069215084350419975358j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8643915813643204553970169 </span><span class="s2">+ </span><span class="s4">.3326258512522187083009453j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8299435470674444100273463 </span><span class="s2">+ </span><span class="s4">.4448177739407956609694059j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7840287980408341576100581 </span><span class="s2">+ </span><span class="s4">.5583186348022854707564856j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7250839687106612822281339 </span><span class="s2">+ </span><span class="s4">.6737426063024382240549898j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6506315378609463397807996 </span><span class="s2">+ </span><span class="s4">.7920349342629491368548074j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5564766488918562465935297 </span><span class="s2">+ </span><span class="s4">.9148198405846724121600860j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4345168906815271799687308 </span><span class="s2">+ </span><span class="s4">1.045382255856986531461592j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2640041595834031147954813 </span><span class="s2">+ </span><span class="s4">1.192762031948052470183960j</span><span class="s2">],</span>
            <span class="s4">22</span><span class="s2">: [-</span><span class="s4">.9058702269930872551848625 </span><span class="s2">+ </span><span class="s4">52774908289999045189007100e-27j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8972983138153530955952835 </span><span class="s2">+ </span><span class="s4">.1584351912289865608659759j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8799661455640176154025352 </span><span class="s2">+ </span><span class="s4">.2644363039201535049656450j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8534754036851687233084587 </span><span class="s2">+ </span><span class="s4">.3710389319482319823405321j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8171682088462720394344996 </span><span class="s2">+ </span><span class="s4">.4785619492202780899653575j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7700332930556816872932937 </span><span class="s2">+ </span><span class="s4">.5874255426351153211965601j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7105305456418785989070935 </span><span class="s2">+ </span><span class="s4">.6982266265924524000098548j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6362427683267827226840153 </span><span class="s2">+ </span><span class="s4">.8118875040246347267248508j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5430983056306302779658129 </span><span class="s2">+ </span><span class="s4">.9299947824439872998916657j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4232528745642628461715044 </span><span class="s2">+ </span><span class="s4">1.055755605227545931204656j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2566376987939318038016012 </span><span class="s2">+ </span><span class="s4">1.197982433555213008346532j</span><span class="s2">],</span>
            <span class="s4">23</span><span class="s2">: [-</span><span class="s4">.9066732476324988168207439</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.9027564979912504609412993 </span><span class="s2">+ </span><span class="s4">.1010534335314045013252480j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8909283242471251458653994 </span><span class="s2">+ </span><span class="s4">.2023024699381223418195228j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8709469395587416239596874 </span><span class="s2">+ </span><span class="s4">.3039581993950041588888925j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8423805948021127057054288 </span><span class="s2">+ </span><span class="s4">.4062657948237602726779246j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8045561642053176205623187 </span><span class="s2">+ </span><span class="s4">.5095305912227258268309528j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7564660146829880581478138 </span><span class="s2">+ </span><span class="s4">.6141594859476032127216463j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6965966033912705387505040 </span><span class="s2">+ </span><span class="s4">.7207341374753046970247055j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6225903228771341778273152 </span><span class="s2">+ </span><span class="s4">.8301558302812980678845563j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5304922463810191698502226 </span><span class="s2">+ </span><span class="s4">.9439760364018300083750242j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4126986617510148836149955 </span><span class="s2">+ </span><span class="s4">1.065328794475513585531053j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2497697202208956030229911 </span><span class="s2">+ </span><span class="s4">1.202813187870697831365338j</span><span class="s2">],</span>
            <span class="s4">24</span><span class="s2">: [-</span><span class="s4">.9055312363372773709269407 </span><span class="s2">+ </span><span class="s4">48440066540478700874836350e-27j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8983105104397872954053307 </span><span class="s2">+ </span><span class="s4">.1454056133873610120105857j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8837358034555706623131950 </span><span class="s2">+ </span><span class="s4">.2426335234401383076544239j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8615278304016353651120610 </span><span class="s2">+ </span><span class="s4">.3403202112618624773397257j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8312326466813240652679563 </span><span class="s2">+ </span><span class="s4">.4386985933597305434577492j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7921695462343492518845446 </span><span class="s2">+ </span><span class="s4">.5380628490968016700338001j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7433392285088529449175873 </span><span class="s2">+ </span><span class="s4">.6388084216222567930378296j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6832565803536521302816011 </span><span class="s2">+ </span><span class="s4">.7415032695091650806797753j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6096221567378335562589532 </span><span class="s2">+ </span><span class="s4">.8470292433077202380020454j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5185914574820317343536707 </span><span class="s2">+ </span><span class="s4">.9569048385259054576937721j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.4027853855197518014786978 </span><span class="s2">+ </span><span class="s4">1.074195196518674765143729j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2433481337524869675825448 </span><span class="s2">+ </span><span class="s4">1.207298683731972524975429j</span><span class="s2">],</span>
            <span class="s4">25</span><span class="s2">: [-</span><span class="s4">.9062073871811708652496104</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.9028833390228020537142561 </span><span class="s2">+ </span><span class="s4">93077131185102967450643820e-27j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8928551459883548836774529 </span><span class="s2">+ </span><span class="s4">.1863068969804300712287138j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8759497989677857803656239 </span><span class="s2">+ </span><span class="s4">.2798521321771408719327250j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8518616886554019782346493 </span><span class="s2">+ </span><span class="s4">.3738977875907595009446142j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.8201226043936880253962552 </span><span class="s2">+ </span><span class="s4">.4686668574656966589020580j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7800496278186497225905443 </span><span class="s2">+ </span><span class="s4">.5644441210349710332887354j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.7306549271849967721596735 </span><span class="s2">+ </span><span class="s4">.6616149647357748681460822j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.6704827128029559528610523 </span><span class="s2">+ </span><span class="s4">.7607348858167839877987008j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5972898661335557242320528 </span><span class="s2">+ </span><span class="s4">.8626676330388028512598538j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.5073362861078468845461362 </span><span class="s2">+ </span><span class="s4">.9689006305344868494672405j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.3934529878191079606023847 </span><span class="s2">+ </span><span class="s4">1.082433927173831581956863j</span><span class="s2">,</span>
                 <span class="s2">-</span><span class="s4">.2373280669322028974199184 </span><span class="s2">+ </span><span class="s4">1.211476658382565356579418j</span><span class="s2">],</span>
            <span class="s2">}</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">originals</span><span class="s2">:</span>
            <span class="s1">p1 </span><span class="s2">= </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">union1d</span><span class="s2">(</span><span class="s1">originals</span><span class="s2">[</span><span class="s1">N</span><span class="s2">],</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(</span><span class="s1">originals</span><span class="s2">[</span><span class="s1">N</span><span class="s2">])), </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">)</span>
            <span class="s1">p2 </span><span class="s2">= </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_norm_phase</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test some orders and frequencies and see that they have the right</span>
        <span class="s5"># phase at w0</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">51</span><span class="s2">, </span><span class="s4">72</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">w0 </span><span class="s0">in </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">100</span><span class="s2">):</span>
                <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'phase'</span><span class="s2">)</span>
                <span class="s1">w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>
                <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">w</span><span class="s2">)</span>
                <span class="s1">phase </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">unwrap</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">(</span><span class="s1">h</span><span class="s2">))</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">phase</span><span class="s2">[[</span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]], (</span><span class="s4">0</span><span class="s2">, -</span><span class="s1">N</span><span class="s2">*</span><span class="s1">pi</span><span class="s2">/</span><span class="s4">4</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_norm_mag</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test some orders and frequencies and see that they have the right</span>
        <span class="s5"># mag at w0</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">51</span><span class="s2">, </span><span class="s4">72</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">w0 </span><span class="s0">in </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">100</span><span class="s2">):</span>
                <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'mag'</span><span class="s2">)</span>
                <span class="s1">w </span><span class="s2">= (</span><span class="s4">0</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">)</span>
                <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">w</span><span class="s2">)</span>
                <span class="s1">mag </span><span class="s2">= </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">mag</span><span class="s2">, (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_norm_delay</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test some orders and frequencies and see that they have the right</span>
        <span class="s5"># delay at DC</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">51</span><span class="s2">, </span><span class="s4">72</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">w0 </span><span class="s0">in </span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">100</span><span class="s2">):</span>
                <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s3">'delay'</span><span class="s2">)</span>
                <span class="s1">w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">*</span><span class="s1">w0</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">)</span>
                <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">w</span><span class="s2">)</span>
                <span class="s1">delay </span><span class="s2">= -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">unwrap</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)))/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">w</span><span class="s2">)</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">delay</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s4">1</span><span class="s2">/</span><span class="s1">w0</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_norm_factor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">mpmath_values </span><span class="s2">= {</span>
            <span class="s4">1</span><span class="s2">: </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">: </span><span class="s4">1.361654128716130520</span><span class="s2">, </span><span class="s4">3</span><span class="s2">: </span><span class="s4">1.755672368681210649</span><span class="s2">,</span>
            <span class="s4">4</span><span class="s2">: </span><span class="s4">2.113917674904215843</span><span class="s2">, </span><span class="s4">5</span><span class="s2">: </span><span class="s4">2.427410702152628137</span><span class="s2">,</span>
            <span class="s4">6</span><span class="s2">: </span><span class="s4">2.703395061202921876</span><span class="s2">, </span><span class="s4">7</span><span class="s2">: </span><span class="s4">2.951722147038722771</span><span class="s2">,</span>
            <span class="s4">8</span><span class="s2">: </span><span class="s4">3.179617237510651330</span><span class="s2">, </span><span class="s4">9</span><span class="s2">: </span><span class="s4">3.391693138911660101</span><span class="s2">,</span>
            <span class="s4">10</span><span class="s2">: </span><span class="s4">3.590980594569163482</span><span class="s2">, </span><span class="s4">11</span><span class="s2">: </span><span class="s4">3.779607416439620092</span><span class="s2">,</span>
            <span class="s4">12</span><span class="s2">: </span><span class="s4">3.959150821144285315</span><span class="s2">, </span><span class="s4">13</span><span class="s2">: </span><span class="s4">4.130825499383535980</span><span class="s2">,</span>
            <span class="s4">14</span><span class="s2">: </span><span class="s4">4.295593409533637564</span><span class="s2">, </span><span class="s4">15</span><span class="s2">: </span><span class="s4">4.454233021624377494</span><span class="s2">,</span>
            <span class="s4">16</span><span class="s2">: </span><span class="s4">4.607385465472647917</span><span class="s2">, </span><span class="s4">17</span><span class="s2">: </span><span class="s4">4.755586548961147727</span><span class="s2">,</span>
            <span class="s4">18</span><span class="s2">: </span><span class="s4">4.899289677284488007</span><span class="s2">, </span><span class="s4">19</span><span class="s2">: </span><span class="s4">5.038882681488207605</span><span class="s2">,</span>
            <span class="s4">20</span><span class="s2">: </span><span class="s4">5.174700441742707423</span><span class="s2">, </span><span class="s4">21</span><span class="s2">: </span><span class="s4">5.307034531360917274</span><span class="s2">,</span>
            <span class="s4">22</span><span class="s2">: </span><span class="s4">5.436140703250035999</span><span class="s2">, </span><span class="s4">23</span><span class="s2">: </span><span class="s4">5.562244783787878196</span><span class="s2">,</span>
            <span class="s4">24</span><span class="s2">: </span><span class="s4">5.685547371295963521</span><span class="s2">, </span><span class="s4">25</span><span class="s2">: </span><span class="s4">5.806227623775418541</span><span class="s2">,</span>
            <span class="s4">50</span><span class="s2">: </span><span class="s4">8.268963160013226298</span><span class="s2">, </span><span class="s4">51</span><span class="s2">: </span><span class="s4">8.352374541546012058</span><span class="s2">,</span>
            <span class="s2">}</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">mpmath_values</span><span class="s2">:</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">besselap</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s3">'delay'</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">mpmath_values</span><span class="s2">[</span><span class="s1">N</span><span class="s2">], </span><span class="s1">_norm_factor</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">k</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bessel_poly</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">_bessel_poly</span><span class="s2">(</span><span class="s4">5</span><span class="s2">), [</span><span class="s4">945</span><span class="s2">, </span><span class="s4">945</span><span class="s2">, </span><span class="s4">420</span><span class="s2">, </span><span class="s4">105</span><span class="s2">, </span><span class="s4">15</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">_bessel_poly</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s0">True</span><span class="s2">), [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">45</span><span class="s2">, </span><span class="s4">105</span><span class="s2">, </span><span class="s4">105</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_bessel_zeros</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">_bessel_zeros</span><span class="s2">(</span><span class="s4">0</span><span class="s2">), [])</span>

    <span class="s0">def </span><span class="s1">test_invalid</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">besselap</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s3">'nonsense'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">besselap</span><span class="s2">, -</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">besselap</span><span class="s2">, </span><span class="s4">3.2</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_bessel_poly</span><span class="s2">, -</span><span class="s4">3</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">_bessel_poly</span><span class="s2">, </span><span class="s4">3.3</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">fail_slow</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">norm </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'phase'</span><span class="s2">, </span><span class="s3">'mag'</span><span class="s2">, </span><span class="s3">'delay'</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">fs </span><span class="s0">in </span><span class="s2">(</span><span class="s4">900</span><span class="s2">, </span><span class="s4">900.1</span><span class="s2">, </span><span class="s4">1234.567</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">10</span><span class="s2">):</span>
                    <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">432.12345</span><span class="s2">):</span>
                        <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'lp'</span><span class="s2">, </span><span class="s3">'hp'</span><span class="s2">):</span>
                            <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                            <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">), </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
                            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>
                    <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">((</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">), (</span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">200.2</span><span class="s2">), (</span><span class="s4">321.123</span><span class="s2">, </span><span class="s4">432.123</span><span class="s2">)):</span>
                        <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'bp'</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">):</span>
                            <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                            <span class="s0">for </span><span class="s1">seq </span><span class="s0">in </span><span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">array</span><span class="s2">):</span>
                                <span class="s1">fcnorm </span><span class="s2">= </span><span class="s1">seq</span><span class="s2">([</span><span class="s1">f</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">) </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">fc</span><span class="s2">])</span>
                                <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">bessel</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fcnorm</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
                                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestButter</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_degenerate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 0-order filter is just a passthrough</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

        <span class="s5"># 1-order filter is same for all types</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>

        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [-</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, [</span><span class="s4">3.249196962329063e-01</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s4">3.375401518835469e-01</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># analog s-plane</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">25</span><span class="s2">):</span>
            <span class="s1">wn </span><span class="s2">= </span><span class="s4">0.01</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">wn</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">([], </span><span class="s1">z</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) == </span><span class="s1">N</span><span class="s2">)</span>
            <span class="s5"># All poles should be at distance wn from origin</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">wn</span><span class="s2">, </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">real</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) &lt;= </span><span class="s4">0</span><span class="s2">))  </span><span class="s5"># No poles in right half of S-plane</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">wn</span><span class="s2">**</span><span class="s1">N</span><span class="s2">, </span><span class="s1">k</span><span class="s2">)</span>

        <span class="s5"># digital z-plane</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">25</span><span class="s2">):</span>
            <span class="s1">wn </span><span class="s2">= </span><span class="s4">0.01</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
            <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">N</span><span class="s2">), </span><span class="s1">z</span><span class="s2">)  </span><span class="s5"># All zeros exactly at DC</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) &lt;= </span><span class="s4">1</span><span class="s2">))  </span><span class="s5"># No poles outside unit circle</span>

        <span class="s1">b1</span><span class="s2">, </span><span class="s1">a1 </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b1</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a1</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s4">1</span><span class="s2">])</span>

        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b2</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a2</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3.2361</span><span class="s2">, </span><span class="s4">5.2361</span><span class="s2">,</span>
                                       <span class="s4">5.2361</span><span class="s2">, </span><span class="s4">3.2361</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

        <span class="s1">b3</span><span class="s2">, </span><span class="s1">a3 </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b3</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a3</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">6.3925</span><span class="s2">, </span><span class="s4">20.4317</span><span class="s2">, </span><span class="s4">42.8021</span><span class="s2">, </span><span class="s4">64.8824</span><span class="s2">,</span>
                                       <span class="s4">74.2334</span><span class="s2">, </span><span class="s4">64.8824</span><span class="s2">, </span><span class="s4">42.8021</span><span class="s2">, </span><span class="s4">20.4317</span><span class="s2">,</span>
                                       <span class="s4">6.3925</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">19</span><span class="s2">, </span><span class="s4">1.0441379169150726</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b2</span><span class="s2">, [</span><span class="s4">2.2720</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a2</span><span class="s2">, </span><span class="s4">1.0e+004 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span>
                        <span class="s4">0.0001</span><span class="s2">, </span><span class="s4">0.0013</span><span class="s2">, </span><span class="s4">0.0080</span><span class="s2">, </span><span class="s4">0.0335</span><span class="s2">, </span><span class="s4">0.1045</span><span class="s2">, </span><span class="s4">0.2570</span><span class="s2">,</span>
                        <span class="s4">0.5164</span><span class="s2">, </span><span class="s4">0.8669</span><span class="s2">, </span><span class="s4">1.2338</span><span class="s2">, </span><span class="s4">1.5010</span><span class="s2">, </span><span class="s4">1.5672</span><span class="s2">, </span><span class="s4">1.4044</span><span class="s2">,</span>
                        <span class="s4">1.0759</span><span class="s2">, </span><span class="s4">0.6986</span><span class="s2">, </span><span class="s4">0.3791</span><span class="s2">, </span><span class="s4">0.1681</span><span class="s2">, </span><span class="s4">0.0588</span><span class="s2">, </span><span class="s4">0.0153</span><span class="s2">,</span>
                        <span class="s4">0.0026</span><span class="s2">, </span><span class="s4">0.0002</span><span class="s2">]), </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>

        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">0.0219</span><span class="s2">, </span><span class="s4">0.1097</span><span class="s2">, </span><span class="s4">0.2194</span><span class="s2">,</span>
                                      <span class="s4">0.2194</span><span class="s2">, </span><span class="s4">0.1097</span><span class="s2">, </span><span class="s4">0.0219</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1.0000</span><span class="s2">, -</span><span class="s4">0.9853</span><span class="s2">, </span><span class="s4">0.9738</span><span class="s2">,</span>
                                      <span class="s2">-</span><span class="s4">0.3864</span><span class="s2">, </span><span class="s4">0.1112</span><span class="s2">, -</span><span class="s4">0.0113</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_highpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># highpass, high even order</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">28</span><span class="s2">, </span><span class="s4">0.43</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">28</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= [</span>
            <span class="s4">2.068257195514592e-01 </span><span class="s2">+ </span><span class="s4">9.238294351481734e-01j</span><span class="s2">,</span>
            <span class="s4">2.068257195514592e-01 </span><span class="s2">- </span><span class="s4">9.238294351481734e-01j</span><span class="s2">,</span>
            <span class="s4">1.874933103892023e-01 </span><span class="s2">+ </span><span class="s4">8.269455076775277e-01j</span><span class="s2">,</span>
            <span class="s4">1.874933103892023e-01 </span><span class="s2">- </span><span class="s4">8.269455076775277e-01j</span><span class="s2">,</span>
            <span class="s4">1.717435567330153e-01 </span><span class="s2">+ </span><span class="s4">7.383078571194629e-01j</span><span class="s2">,</span>
            <span class="s4">1.717435567330153e-01 </span><span class="s2">- </span><span class="s4">7.383078571194629e-01j</span><span class="s2">,</span>
            <span class="s4">1.588266870755982e-01 </span><span class="s2">+ </span><span class="s4">6.564623730651094e-01j</span><span class="s2">,</span>
            <span class="s4">1.588266870755982e-01 </span><span class="s2">- </span><span class="s4">6.564623730651094e-01j</span><span class="s2">,</span>
            <span class="s4">1.481881532502603e-01 </span><span class="s2">+ </span><span class="s4">5.802343458081779e-01j</span><span class="s2">,</span>
            <span class="s4">1.481881532502603e-01 </span><span class="s2">- </span><span class="s4">5.802343458081779e-01j</span><span class="s2">,</span>
            <span class="s4">1.394122576319697e-01 </span><span class="s2">+ </span><span class="s4">5.086609000582009e-01j</span><span class="s2">,</span>
            <span class="s4">1.394122576319697e-01 </span><span class="s2">- </span><span class="s4">5.086609000582009e-01j</span><span class="s2">,</span>
            <span class="s4">1.321840881809715e-01 </span><span class="s2">+ </span><span class="s4">4.409411734716436e-01j</span><span class="s2">,</span>
            <span class="s4">1.321840881809715e-01 </span><span class="s2">- </span><span class="s4">4.409411734716436e-01j</span><span class="s2">,</span>
            <span class="s4">1.262633413354405e-01 </span><span class="s2">+ </span><span class="s4">3.763990035551881e-01j</span><span class="s2">,</span>
            <span class="s4">1.262633413354405e-01 </span><span class="s2">- </span><span class="s4">3.763990035551881e-01j</span><span class="s2">,</span>
            <span class="s4">1.214660449478046e-01 </span><span class="s2">+ </span><span class="s4">3.144545234797277e-01j</span><span class="s2">,</span>
            <span class="s4">1.214660449478046e-01 </span><span class="s2">- </span><span class="s4">3.144545234797277e-01j</span><span class="s2">,</span>
            <span class="s4">1.104868766650320e-01 </span><span class="s2">+ </span><span class="s4">2.771505404367791e-02j</span><span class="s2">,</span>
            <span class="s4">1.104868766650320e-01 </span><span class="s2">- </span><span class="s4">2.771505404367791e-02j</span><span class="s2">,</span>
            <span class="s4">1.111768629525075e-01 </span><span class="s2">+ </span><span class="s4">8.331369153155753e-02j</span><span class="s2">,</span>
            <span class="s4">1.111768629525075e-01 </span><span class="s2">- </span><span class="s4">8.331369153155753e-02j</span><span class="s2">,</span>
            <span class="s4">1.125740630842972e-01 </span><span class="s2">+ </span><span class="s4">1.394219509611784e-01j</span><span class="s2">,</span>
            <span class="s4">1.125740630842972e-01 </span><span class="s2">- </span><span class="s4">1.394219509611784e-01j</span><span class="s2">,</span>
            <span class="s4">1.147138487992747e-01 </span><span class="s2">+ </span><span class="s4">1.963932363793666e-01j</span><span class="s2">,</span>
            <span class="s4">1.147138487992747e-01 </span><span class="s2">- </span><span class="s4">1.963932363793666e-01j</span><span class="s2">,</span>
            <span class="s4">1.176516491045901e-01 </span><span class="s2">+ </span><span class="s4">2.546021573417188e-01j</span><span class="s2">,</span>
            <span class="s4">1.176516491045901e-01 </span><span class="s2">- </span><span class="s4">2.546021573417188e-01j</span><span class="s2">,</span>
            <span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">1.446671081817286e-06</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-7</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>

        <span class="s5"># highpass, high odd order</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">27</span><span class="s2">, </span><span class="s4">0.56</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">27</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= [</span>
            <span class="s2">-</span><span class="s4">1.772572785680147e-01 </span><span class="s2">+ </span><span class="s4">9.276431102995948e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.772572785680147e-01 </span><span class="s2">- </span><span class="s4">9.276431102995948e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.600766565322114e-01 </span><span class="s2">+ </span><span class="s4">8.264026279893268e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.600766565322114e-01 </span><span class="s2">- </span><span class="s4">8.264026279893268e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.461948419016121e-01 </span><span class="s2">+ </span><span class="s4">7.341841939120078e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.461948419016121e-01 </span><span class="s2">- </span><span class="s4">7.341841939120078e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.348975284762046e-01 </span><span class="s2">+ </span><span class="s4">6.493235066053785e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.348975284762046e-01 </span><span class="s2">- </span><span class="s4">6.493235066053785e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.256628210712206e-01 </span><span class="s2">+ </span><span class="s4">5.704921366889227e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.256628210712206e-01 </span><span class="s2">- </span><span class="s4">5.704921366889227e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.181038235962314e-01 </span><span class="s2">+ </span><span class="s4">4.966120551231630e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.181038235962314e-01 </span><span class="s2">- </span><span class="s4">4.966120551231630e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.119304913239356e-01 </span><span class="s2">+ </span><span class="s4">4.267938916403775e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.119304913239356e-01 </span><span class="s2">- </span><span class="s4">4.267938916403775e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.069237739782691e-01 </span><span class="s2">+ </span><span class="s4">3.602914879527338e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.069237739782691e-01 </span><span class="s2">- </span><span class="s4">3.602914879527338e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.029178030691416e-01 </span><span class="s2">+ </span><span class="s4">2.964677964142126e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">1.029178030691416e-01 </span><span class="s2">- </span><span class="s4">2.964677964142126e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.978747500816100e-02 </span><span class="s2">+ </span><span class="s4">2.347687643085738e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.978747500816100e-02 </span><span class="s2">- </span><span class="s4">2.347687643085738e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.743974496324025e-02 </span><span class="s2">+ </span><span class="s4">1.747028739092479e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.743974496324025e-02 </span><span class="s2">- </span><span class="s4">1.747028739092479e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.580754551625957e-02 </span><span class="s2">+ </span><span class="s4">1.158246860771989e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.580754551625957e-02 </span><span class="s2">- </span><span class="s4">1.158246860771989e-01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.484562207782568e-02 </span><span class="s2">+ </span><span class="s4">5.772118357151691e-02j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.484562207782568e-02 </span><span class="s2">- </span><span class="s4">5.772118357151691e-02j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.452783117928215e-02</span>
            <span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">9.585686688851069e-09</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-8</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">8</span><span class="s2">, [</span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">0.33</span><span class="s2">], </span><span class="s3">'band'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [</span>
            <span class="s4">4.979909925436156e-01 </span><span class="s2">+ </span><span class="s4">8.367609424799387e-01j</span><span class="s2">,</span>
            <span class="s4">4.979909925436156e-01 </span><span class="s2">- </span><span class="s4">8.367609424799387e-01j</span><span class="s2">,</span>
            <span class="s4">4.913338722555539e-01 </span><span class="s2">+ </span><span class="s4">7.866774509868817e-01j</span><span class="s2">,</span>
            <span class="s4">4.913338722555539e-01 </span><span class="s2">- </span><span class="s4">7.866774509868817e-01j</span><span class="s2">,</span>
            <span class="s4">5.035229361778706e-01 </span><span class="s2">+ </span><span class="s4">7.401147376726750e-01j</span><span class="s2">,</span>
            <span class="s4">5.035229361778706e-01 </span><span class="s2">- </span><span class="s4">7.401147376726750e-01j</span><span class="s2">,</span>
            <span class="s4">5.307617160406101e-01 </span><span class="s2">+ </span><span class="s4">7.029184459442954e-01j</span><span class="s2">,</span>
            <span class="s4">5.307617160406101e-01 </span><span class="s2">- </span><span class="s4">7.029184459442954e-01j</span><span class="s2">,</span>
            <span class="s4">5.680556159453138e-01 </span><span class="s2">+ </span><span class="s4">6.788228792952775e-01j</span><span class="s2">,</span>
            <span class="s4">5.680556159453138e-01 </span><span class="s2">- </span><span class="s4">6.788228792952775e-01j</span><span class="s2">,</span>
            <span class="s4">6.100962560818854e-01 </span><span class="s2">+ </span><span class="s4">6.693849403338664e-01j</span><span class="s2">,</span>
            <span class="s4">6.100962560818854e-01 </span><span class="s2">- </span><span class="s4">6.693849403338664e-01j</span><span class="s2">,</span>
            <span class="s4">6.904694312740631e-01 </span><span class="s2">+ </span><span class="s4">6.930501690145245e-01j</span><span class="s2">,</span>
            <span class="s4">6.904694312740631e-01 </span><span class="s2">- </span><span class="s4">6.930501690145245e-01j</span><span class="s2">,</span>
            <span class="s4">6.521767004237027e-01 </span><span class="s2">+ </span><span class="s4">6.744414640183752e-01j</span><span class="s2">,</span>
            <span class="s4">6.521767004237027e-01 </span><span class="s2">- </span><span class="s4">6.744414640183752e-01j</span><span class="s2">,</span>
            <span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">3.398854055800844e-08</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>

        <span class="s5"># bandpass analog</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, [</span><span class="s4">90.5</span><span class="s2">, </span><span class="s4">110.5</span><span class="s2">], </span><span class="s3">'bp'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= [</span>
            <span class="s2">-</span><span class="s4">4.179137760733086e+00 </span><span class="s2">+ </span><span class="s4">1.095935899082837e+02j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">4.179137760733086e+00 </span><span class="s2">- </span><span class="s4">1.095935899082837e+02j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.593598668443835e+00 </span><span class="s2">+ </span><span class="s4">1.034745398029734e+02j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">9.593598668443835e+00 </span><span class="s2">- </span><span class="s4">1.034745398029734e+02j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">8.883991981781929e+00 </span><span class="s2">+ </span><span class="s4">9.582087115567160e+01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">8.883991981781929e+00 </span><span class="s2">- </span><span class="s4">9.582087115567160e+01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">3.474530886568715e+00 </span><span class="s2">+ </span><span class="s4">9.111599925805801e+01j</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">3.474530886568715e+00 </span><span class="s2">- </span><span class="s4">9.111599925805801e+01j</span><span class="s2">,</span>
            <span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">1.600000000000001e+05</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandstop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">7</span><span class="s2">, [</span><span class="s4">0.45</span><span class="s2">, </span><span class="s4">0.56</span><span class="s2">], </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">+ </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">- </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">+ </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">- </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">+ </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">- </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">+ </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">- </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">+ </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">- </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">+ </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">- </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">+ </span><span class="s4">9.998728744679880e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.594474531383421e-02 </span><span class="s2">- </span><span class="s4">9.998728744679880e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">1.766850742887729e-01 </span><span class="s2">+ </span><span class="s4">9.466951258673900e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.766850742887729e-01 </span><span class="s2">- </span><span class="s4">9.466951258673900e-01j</span><span class="s2">,</span>
               <span class="s4">1.467897662432886e-01 </span><span class="s2">+ </span><span class="s4">9.515917126462422e-01j</span><span class="s2">,</span>
               <span class="s4">1.467897662432886e-01 </span><span class="s2">- </span><span class="s4">9.515917126462422e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.370083529426906e-01 </span><span class="s2">+ </span><span class="s4">8.880376681273993e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.370083529426906e-01 </span><span class="s2">- </span><span class="s4">8.880376681273993e-01j</span><span class="s2">,</span>
               <span class="s4">1.086774544701390e-01 </span><span class="s2">+ </span><span class="s4">8.915240810704319e-01j</span><span class="s2">,</span>
               <span class="s4">1.086774544701390e-01 </span><span class="s2">- </span><span class="s4">8.915240810704319e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">7.982704457700891e-02 </span><span class="s2">+ </span><span class="s4">8.506056315273435e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">7.982704457700891e-02 </span><span class="s2">- </span><span class="s4">8.506056315273435e-01j</span><span class="s2">,</span>
               <span class="s4">5.238812787110331e-02 </span><span class="s2">+ </span><span class="s4">8.524011102699969e-01j</span><span class="s2">,</span>
               <span class="s4">5.238812787110331e-02 </span><span class="s2">- </span><span class="s4">8.524011102699969e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.357545000491310e-02 </span><span class="s2">+ </span><span class="s4">8.382287744986582e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.357545000491310e-02 </span><span class="s2">- </span><span class="s4">8.382287744986582e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">4.577122512960063e-01</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, [</span><span class="s4">100</span><span class="s2">, </span><span class="s4">300</span><span class="s2">], </span><span class="s3">'bandpass'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">b2 </span><span class="s2">= [</span><span class="s4">1.6e+09</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">a2 </span><span class="s2">= [</span><span class="s4">1.000000000000000e+00</span><span class="s2">, </span><span class="s4">5.226251859505511e+02</span><span class="s2">,</span>
              <span class="s4">2.565685424949238e+05</span><span class="s2">, </span><span class="s4">6.794127417357160e+07</span><span class="s2">,</span>
              <span class="s4">1.519411254969542e+10</span><span class="s2">, </span><span class="s4">2.038238225207147e+12</span><span class="s2">,</span>
              <span class="s4">2.309116882454312e+14</span><span class="s2">, </span><span class="s4">1.411088002066486e+16</span><span class="s2">,</span>
              <span class="s4">8.099999999999991e+17</span><span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">fs </span><span class="s0">in </span><span class="s2">(</span><span class="s4">900</span><span class="s2">, </span><span class="s4">900.1</span><span class="s2">, </span><span class="s4">1234.567</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">10</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">432.12345</span><span class="s2">):</span>
                    <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'lp'</span><span class="s2">, </span><span class="s3">'hp'</span><span class="s2">):</span>
                        <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                        <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">), </span><span class="s1">btype</span><span class="s2">)</span>
                        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">((</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">), (</span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">200.2</span><span class="s2">), (</span><span class="s4">321.123</span><span class="s2">, </span><span class="s4">432.123</span><span class="s2">)):</span>
                    <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'bp'</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">):</span>
                        <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                        <span class="s0">for </span><span class="s1">seq </span><span class="s0">in </span><span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">array</span><span class="s2">):</span>
                            <span class="s1">fcnorm </span><span class="s2">= </span><span class="s1">seq</span><span class="s2">([</span><span class="s1">f</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">) </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">fc</span><span class="s2">])</span>
                            <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s1">fcnorm</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">)</span>
                            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestCheby1</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_degenerate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 0-order filter is just a passthrough</span>
        <span class="s5"># Even-order filters have DC gain of -rp dB</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

        <span class="s5"># 1-order filter is same for all types</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>

        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [-</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, [-</span><span class="s4">5.390126972799615e-01</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s4">7.695063486399808e-01</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">25</span><span class="s2">):</span>
            <span class="s1">wn </span><span class="s2">= </span><span class="s4">0.01</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">wn</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">([], </span><span class="s1">z</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) == </span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">real</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) &lt;= </span><span class="s4">0</span><span class="s2">))  </span><span class="s5"># No poles in right half of S-plane</span>

        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">25</span><span class="s2">):</span>
            <span class="s1">wn </span><span class="s2">= </span><span class="s4">0.01</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
            <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">N</span><span class="s2">), </span><span class="s1">z</span><span class="s2">)  </span><span class="s5"># All zeros exactly at DC</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) &lt;= </span><span class="s4">1</span><span class="s2">))  </span><span class="s5"># No poles outside unit circle</span>

        <span class="s5"># Same test as TestNormalize</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.048</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span>
                             <span class="s4">2.150733144728282e-11</span><span class="s2">, </span><span class="s4">1.720586515782626e-10</span><span class="s2">,</span>
                             <span class="s4">6.022052805239190e-10</span><span class="s2">, </span><span class="s4">1.204410561047838e-09</span><span class="s2">,</span>
                             <span class="s4">1.505513201309798e-09</span><span class="s2">, </span><span class="s4">1.204410561047838e-09</span><span class="s2">,</span>
                             <span class="s4">6.022052805239190e-10</span><span class="s2">, </span><span class="s4">1.720586515782626e-10</span><span class="s2">,</span>
                             <span class="s4">2.150733144728282e-11</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">14</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span>
                             <span class="s4">1.000000000000000e+00</span><span class="s2">, -</span><span class="s4">7.782402035027959e+00</span><span class="s2">,</span>
                             <span class="s4">2.654354569747454e+01</span><span class="s2">, -</span><span class="s4">5.182182531666387e+01</span><span class="s2">,</span>
                             <span class="s4">6.334127355102684e+01</span><span class="s2">, -</span><span class="s4">4.963358186631157e+01</span><span class="s2">,</span>
                             <span class="s4">2.434862182949389e+01</span><span class="s2">, -</span><span class="s4">6.836925348604676e+00</span><span class="s2">,</span>
                             <span class="s4">8.412934944449140e-01</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">14</span><span class="s2">)</span>

        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">], </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'band'</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">0.0084</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">0.0335</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.0502</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                                      <span class="s2">-</span><span class="s4">0.0335</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.0084</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.1191</span><span class="s2">, </span><span class="s4">2.862</span><span class="s2">, </span><span class="s4">2.2986</span><span class="s2">, </span><span class="s4">3.4137</span><span class="s2">,</span>
                                      <span class="s4">1.8653</span><span class="s2">, </span><span class="s4">1.8982</span><span class="s2">, </span><span class="s4">0.5676</span><span class="s2">, </span><span class="s4">0.4103</span><span class="s2">],</span>
                                  <span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

        <span class="s1">b2</span><span class="s2">, </span><span class="s1">a2 </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b2</span><span class="s2">, [</span><span class="s4">0.0626</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a2</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.5745</span><span class="s2">, </span><span class="s4">1.4150</span><span class="s2">, </span><span class="s4">0.5489</span><span class="s2">, </span><span class="s4">0.4080</span><span class="s2">,</span>
                                       <span class="s4">0.0626</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s4">1.0e-006 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span>
            <span class="s4">0.00703924326028</span><span class="s2">, </span><span class="s4">0.05631394608227</span><span class="s2">, </span><span class="s4">0.19709881128793</span><span class="s2">,</span>
            <span class="s4">0.39419762257586</span><span class="s2">, </span><span class="s4">0.49274702821983</span><span class="s2">, </span><span class="s4">0.39419762257586</span><span class="s2">,</span>
            <span class="s4">0.19709881128793</span><span class="s2">, </span><span class="s4">0.05631394608227</span><span class="s2">, </span><span class="s4">0.00703924326028</span><span class="s2">]),</span>
            <span class="s1">decimal</span><span class="s2">=</span><span class="s4">13</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span>
              <span class="s4">1.00000000000000</span><span class="s2">, -</span><span class="s4">7.44912258934158</span><span class="s2">, </span><span class="s4">24.46749067762108</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">46.27560200466141</span><span class="s2">, </span><span class="s4">55.11160187999928</span><span class="s2">, -</span><span class="s4">42.31640010161038</span><span class="s2">,</span>
              <span class="s4">20.45543300484147</span><span class="s2">, -</span><span class="s4">5.69110270561444</span><span class="s2">, </span><span class="s4">0.69770374759022</span><span class="s2">],</span>
            <span class="s1">decimal</span><span class="s2">=</span><span class="s4">13</span><span class="s2">)</span>

        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s4">1.0e-003 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span>
            <span class="s4">0.00895261138923</span><span class="s2">, </span><span class="s4">0.07162089111382</span><span class="s2">, </span><span class="s4">0.25067311889837</span><span class="s2">,</span>
            <span class="s4">0.50134623779673</span><span class="s2">, </span><span class="s4">0.62668279724591</span><span class="s2">, </span><span class="s4">0.50134623779673</span><span class="s2">,</span>
            <span class="s4">0.25067311889837</span><span class="s2">, </span><span class="s4">0.07162089111382</span><span class="s2">, </span><span class="s4">0.00895261138923</span><span class="s2">]),</span>
            <span class="s1">decimal</span><span class="s2">=</span><span class="s4">13</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1.00000000000000</span><span class="s2">, -</span><span class="s4">5.97529229188545</span><span class="s2">,</span>
                                      <span class="s4">16.58122329202101</span><span class="s2">, -</span><span class="s4">27.71423273542923</span><span class="s2">,</span>
                                      <span class="s4">30.39509758355313</span><span class="s2">, -</span><span class="s4">22.34729670426879</span><span class="s2">,</span>
                                      <span class="s4">10.74509800434910</span><span class="s2">, -</span><span class="s4">3.08924633697497</span><span class="s2">,</span>
                                      <span class="s4">0.40707685889802</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">13</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_highpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># high even order</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">24</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">24</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">6.136558509657073e-01 </span><span class="s2">+ </span><span class="s4">2.700091504942893e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.136558509657073e-01 </span><span class="s2">- </span><span class="s4">2.700091504942893e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.303348340927516e-01 </span><span class="s2">+ </span><span class="s4">6.659400861114254e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.303348340927516e-01 </span><span class="s2">- </span><span class="s4">6.659400861114254e-01j</span><span class="s2">,</span>
              <span class="s4">8.779713780557169e-03 </span><span class="s2">+ </span><span class="s4">8.223108447483040e-01j</span><span class="s2">,</span>
              <span class="s4">8.779713780557169e-03 </span><span class="s2">- </span><span class="s4">8.223108447483040e-01j</span><span class="s2">,</span>
              <span class="s4">2.742361123006911e-01 </span><span class="s2">+ </span><span class="s4">8.356666951611864e-01j</span><span class="s2">,</span>
              <span class="s4">2.742361123006911e-01 </span><span class="s2">- </span><span class="s4">8.356666951611864e-01j</span><span class="s2">,</span>
              <span class="s4">4.562984557158206e-01 </span><span class="s2">+ </span><span class="s4">7.954276912303594e-01j</span><span class="s2">,</span>
              <span class="s4">4.562984557158206e-01 </span><span class="s2">- </span><span class="s4">7.954276912303594e-01j</span><span class="s2">,</span>
              <span class="s4">5.777335494123628e-01 </span><span class="s2">+ </span><span class="s4">7.435821817961783e-01j</span><span class="s2">,</span>
              <span class="s4">5.777335494123628e-01 </span><span class="s2">- </span><span class="s4">7.435821817961783e-01j</span><span class="s2">,</span>
              <span class="s4">6.593260977749194e-01 </span><span class="s2">+ </span><span class="s4">6.955390907990932e-01j</span><span class="s2">,</span>
              <span class="s4">6.593260977749194e-01 </span><span class="s2">- </span><span class="s4">6.955390907990932e-01j</span><span class="s2">,</span>
              <span class="s4">7.149590948466562e-01 </span><span class="s2">+ </span><span class="s4">6.559437858502012e-01j</span><span class="s2">,</span>
              <span class="s4">7.149590948466562e-01 </span><span class="s2">- </span><span class="s4">6.559437858502012e-01j</span><span class="s2">,</span>
              <span class="s4">7.532432388188739e-01 </span><span class="s2">+ </span><span class="s4">6.256158042292060e-01j</span><span class="s2">,</span>
              <span class="s4">7.532432388188739e-01 </span><span class="s2">- </span><span class="s4">6.256158042292060e-01j</span><span class="s2">,</span>
              <span class="s4">7.794365244268271e-01 </span><span class="s2">+ </span><span class="s4">6.042099234813333e-01j</span><span class="s2">,</span>
              <span class="s4">7.794365244268271e-01 </span><span class="s2">- </span><span class="s4">6.042099234813333e-01j</span><span class="s2">,</span>
              <span class="s4">7.967253874772997e-01 </span><span class="s2">+ </span><span class="s4">5.911966597313203e-01j</span><span class="s2">,</span>
              <span class="s4">7.967253874772997e-01 </span><span class="s2">- </span><span class="s4">5.911966597313203e-01j</span><span class="s2">,</span>
              <span class="s4">8.069756417293870e-01 </span><span class="s2">+ </span><span class="s4">5.862214589217275e-01j</span><span class="s2">,</span>
              <span class="s4">8.069756417293870e-01 </span><span class="s2">- </span><span class="s4">5.862214589217275e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">6.190427617192018e-04</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>

        <span class="s5"># high odd order</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">23</span><span class="s2">, </span><span class="s4">0.8</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">23</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">7.676400532011010e-01</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.754621070166477e-01 </span><span class="s2">+ </span><span class="s4">3.970502605619561e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.754621070166477e-01 </span><span class="s2">- </span><span class="s4">3.970502605619561e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">4.528880018446727e-01 </span><span class="s2">+ </span><span class="s4">6.844061483786332e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">4.528880018446727e-01 </span><span class="s2">- </span><span class="s4">6.844061483786332e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.986009130216447e-01 </span><span class="s2">+ </span><span class="s4">8.382285942941594e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.986009130216447e-01 </span><span class="s2">- </span><span class="s4">8.382285942941594e-01j</span><span class="s2">,</span>
              <span class="s4">2.504673931532608e-02 </span><span class="s2">+ </span><span class="s4">8.958137635794080e-01j</span><span class="s2">,</span>
              <span class="s4">2.504673931532608e-02 </span><span class="s2">- </span><span class="s4">8.958137635794080e-01j</span><span class="s2">,</span>
              <span class="s4">2.001089429976469e-01 </span><span class="s2">+ </span><span class="s4">9.010678290791480e-01j</span><span class="s2">,</span>
              <span class="s4">2.001089429976469e-01 </span><span class="s2">- </span><span class="s4">9.010678290791480e-01j</span><span class="s2">,</span>
              <span class="s4">3.302410157191755e-01 </span><span class="s2">+ </span><span class="s4">8.835444665962544e-01j</span><span class="s2">,</span>
              <span class="s4">3.302410157191755e-01 </span><span class="s2">- </span><span class="s4">8.835444665962544e-01j</span><span class="s2">,</span>
              <span class="s4">4.246662537333661e-01 </span><span class="s2">+ </span><span class="s4">8.594054226449009e-01j</span><span class="s2">,</span>
              <span class="s4">4.246662537333661e-01 </span><span class="s2">- </span><span class="s4">8.594054226449009e-01j</span><span class="s2">,</span>
              <span class="s4">4.919620928120296e-01 </span><span class="s2">+ </span><span class="s4">8.366772762965786e-01j</span><span class="s2">,</span>
              <span class="s4">4.919620928120296e-01 </span><span class="s2">- </span><span class="s4">8.366772762965786e-01j</span><span class="s2">,</span>
              <span class="s4">5.385746917494749e-01 </span><span class="s2">+ </span><span class="s4">8.191616180796720e-01j</span><span class="s2">,</span>
              <span class="s4">5.385746917494749e-01 </span><span class="s2">- </span><span class="s4">8.191616180796720e-01j</span><span class="s2">,</span>
              <span class="s4">5.855636993537203e-01 </span><span class="s2">+ </span><span class="s4">8.060680937701062e-01j</span><span class="s2">,</span>
              <span class="s4">5.855636993537203e-01 </span><span class="s2">- </span><span class="s4">8.060680937701062e-01j</span><span class="s2">,</span>
              <span class="s4">5.688812849391721e-01 </span><span class="s2">+ </span><span class="s4">8.086497795114683e-01j</span><span class="s2">,</span>
              <span class="s4">5.688812849391721e-01 </span><span class="s2">- </span><span class="s4">8.086497795114683e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">1.941697029206324e-05</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>

        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">3.144743169501551e+03 </span><span class="s2">+ </span><span class="s4">3.511680029092744e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.144743169501551e+03 </span><span class="s2">- </span><span class="s4">3.511680029092744e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.633065604514602e+02 </span><span class="s2">+ </span><span class="s4">2.023615191183945e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.633065604514602e+02 </span><span class="s2">- </span><span class="s4">2.023615191183945e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.946412183352025e+02 </span><span class="s2">+ </span><span class="s4">1.372309454274755e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.946412183352025e+02 </span><span class="s2">- </span><span class="s4">1.372309454274755e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">7.987162953085479e+01 </span><span class="s2">+ </span><span class="s4">1.105207708045358e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">7.987162953085479e+01 </span><span class="s2">- </span><span class="s4">1.105207708045358e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.250315039031946e+01 </span><span class="s2">+ </span><span class="s4">1.001723931471477e+03j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.250315039031946e+01 </span><span class="s2">- </span><span class="s4">1.001723931471477e+03j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">8.912509381337453e-01</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">], </span><span class="s3">'bp'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [</span><span class="s4">3.077784854851463e-01 </span><span class="s2">+ </span><span class="s4">9.453307017592942e-01j</span><span class="s2">,</span>
              <span class="s4">3.077784854851463e-01 </span><span class="s2">- </span><span class="s4">9.453307017592942e-01j</span><span class="s2">,</span>
              <span class="s4">3.280567400654425e-01 </span><span class="s2">+ </span><span class="s4">9.272377218689016e-01j</span><span class="s2">,</span>
              <span class="s4">3.280567400654425e-01 </span><span class="s2">- </span><span class="s4">9.272377218689016e-01j</span><span class="s2">,</span>
              <span class="s4">3.677912763284301e-01 </span><span class="s2">+ </span><span class="s4">9.038008865279966e-01j</span><span class="s2">,</span>
              <span class="s4">3.677912763284301e-01 </span><span class="s2">- </span><span class="s4">9.038008865279966e-01j</span><span class="s2">,</span>
              <span class="s4">4.194425632520948e-01 </span><span class="s2">+ </span><span class="s4">8.769407159656157e-01j</span><span class="s2">,</span>
              <span class="s4">4.194425632520948e-01 </span><span class="s2">- </span><span class="s4">8.769407159656157e-01j</span><span class="s2">,</span>
              <span class="s4">4.740921994669189e-01 </span><span class="s2">+ </span><span class="s4">8.496508528630974e-01j</span><span class="s2">,</span>
              <span class="s4">4.740921994669189e-01 </span><span class="s2">- </span><span class="s4">8.496508528630974e-01j</span><span class="s2">,</span>
              <span class="s4">5.234866481897429e-01 </span><span class="s2">+ </span><span class="s4">8.259608422808477e-01j</span><span class="s2">,</span>
              <span class="s4">5.234866481897429e-01 </span><span class="s2">- </span><span class="s4">8.259608422808477e-01j</span><span class="s2">,</span>
              <span class="s4">5.844717632289875e-01 </span><span class="s2">+ </span><span class="s4">8.052901363500210e-01j</span><span class="s2">,</span>
              <span class="s4">5.844717632289875e-01 </span><span class="s2">- </span><span class="s4">8.052901363500210e-01j</span><span class="s2">,</span>
              <span class="s4">5.615189063336070e-01 </span><span class="s2">+ </span><span class="s4">8.100667803850766e-01j</span><span class="s2">,</span>
              <span class="s4">5.615189063336070e-01 </span><span class="s2">- </span><span class="s4">8.100667803850766e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">5.007028718074307e-09</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">z2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandstop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">+ </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">- </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">+ </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">- </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">+ </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">- </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">+ </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">- </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">+ </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">- </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">+ </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">- </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">+ </span><span class="s4">9.873775210440450e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.583844403245361e-01 </span><span class="s2">- </span><span class="s4">9.873775210440450e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">8.942974551472813e-02 </span><span class="s2">+ </span><span class="s4">3.482480481185926e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">8.942974551472813e-02 </span><span class="s2">- </span><span class="s4">3.482480481185926e-01j</span><span class="s2">,</span>
               <span class="s4">1.293775154041798e-01 </span><span class="s2">+ </span><span class="s4">8.753499858081858e-01j</span><span class="s2">,</span>
               <span class="s4">1.293775154041798e-01 </span><span class="s2">- </span><span class="s4">8.753499858081858e-01j</span><span class="s2">,</span>
               <span class="s4">3.399741945062013e-02 </span><span class="s2">+ </span><span class="s4">9.690316022705607e-01j</span><span class="s2">,</span>
               <span class="s4">3.399741945062013e-02 </span><span class="s2">- </span><span class="s4">9.690316022705607e-01j</span><span class="s2">,</span>
               <span class="s4">4.167225522796539e-04 </span><span class="s2">+ </span><span class="s4">9.927338161087488e-01j</span><span class="s2">,</span>
               <span class="s4">4.167225522796539e-04 </span><span class="s2">- </span><span class="s4">9.927338161087488e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.912966549550960e-01 </span><span class="s2">+ </span><span class="s4">8.046122859255742e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.912966549550960e-01 </span><span class="s2">- </span><span class="s4">8.046122859255742e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.307805547127368e-01 </span><span class="s2">+ </span><span class="s4">9.133455018206508e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.307805547127368e-01 </span><span class="s2">- </span><span class="s4">9.133455018206508e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.072658345097743e-01 </span><span class="s2">+ </span><span class="s4">9.443589759799366e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.072658345097743e-01 </span><span class="s2">- </span><span class="s4">9.443589759799366e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">3.619438310405028e-01</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-16</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># with transfer function conversion,  without digital conversion</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, [</span><span class="s4">210</span><span class="s2">, </span><span class="s4">310</span><span class="s2">], </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">b2 </span><span class="s2">= [</span><span class="s4">1.000000000000006e+00</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
              <span class="s4">3.255000000000020e+05</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
              <span class="s4">4.238010000000026e+10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
              <span class="s4">2.758944510000017e+15</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
              <span class="s4">8.980364380050052e+19</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
              <span class="s4">1.169243442282517e+24</span>
              <span class="s2">]</span>
        <span class="s1">a2 </span><span class="s2">= [</span><span class="s4">1.000000000000000e+00</span><span class="s2">, </span><span class="s4">4.630555945694342e+02</span><span class="s2">,</span>
              <span class="s4">4.039266454794788e+05</span><span class="s2">, </span><span class="s4">1.338060988610237e+08</span><span class="s2">,</span>
              <span class="s4">5.844333551294591e+10</span><span class="s2">, </span><span class="s4">1.357346371637638e+13</span><span class="s2">,</span>
              <span class="s4">3.804661141892782e+15</span><span class="s2">, </span><span class="s4">5.670715850340080e+17</span><span class="s2">,</span>
              <span class="s4">1.114411200988328e+20</span><span class="s2">, </span><span class="s4">8.316815934908471e+21</span><span class="s2">,</span>
              <span class="s4">1.169243442282517e+24</span>
              <span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">fs </span><span class="s0">in </span><span class="s2">(</span><span class="s4">900</span><span class="s2">, </span><span class="s4">900.1</span><span class="s2">, </span><span class="s4">1234.567</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">10</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">432.12345</span><span class="s2">):</span>
                    <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'lp'</span><span class="s2">, </span><span class="s3">'hp'</span><span class="s2">):</span>
                        <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                        <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">), </span><span class="s1">btype</span><span class="s2">)</span>
                        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">((</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">), (</span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">200.2</span><span class="s2">), (</span><span class="s4">321.123</span><span class="s2">, </span><span class="s4">432.123</span><span class="s2">)):</span>
                    <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'bp'</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">):</span>
                        <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                        <span class="s0">for </span><span class="s1">seq </span><span class="s0">in </span><span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">array</span><span class="s2">):</span>
                            <span class="s1">fcnorm </span><span class="s2">= </span><span class="s1">seq</span><span class="s2">([</span><span class="s1">f</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">) </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">fc</span><span class="s2">])</span>
                            <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">cheby1</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">fcnorm</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">)</span>
                            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestCheby2</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_degenerate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 0-order filter is just a passthrough</span>
        <span class="s5"># Stopband ripple factor doesn't matter</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">123.456</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

        <span class="s5"># 1-order filter is same for all types</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>

        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">50</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [-</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, [</span><span class="s4">9.967826460175649e-01</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s4">1.608676991217512e-03</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">25</span><span class="s2">):</span>
            <span class="s1">wn </span><span class="s2">= </span><span class="s4">0.01</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">wn</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) == </span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">real</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) &lt;= </span><span class="s4">0</span><span class="s2">))  </span><span class="s5"># No poles in right half of S-plane</span>

        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">25</span><span class="s2">):</span>
            <span class="s1">wn </span><span class="s2">= </span><span class="s4">0.01</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) &lt;= </span><span class="s4">1</span><span class="s2">))  </span><span class="s5"># No poles outside unit circle</span>

        <span class="s1">B</span><span class="s2">, </span><span class="s1">A </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">18</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">B</span><span class="s2">, [</span>
            <span class="s4">0.00167583914216</span><span class="s2">, </span><span class="s4">0.01249479541868</span><span class="s2">, </span><span class="s4">0.05282702120282</span><span class="s2">,</span>
            <span class="s4">0.15939804265706</span><span class="s2">, </span><span class="s4">0.37690207631117</span><span class="s2">, </span><span class="s4">0.73227013789108</span><span class="s2">,</span>
            <span class="s4">1.20191856962356</span><span class="s2">, </span><span class="s4">1.69522872823393</span><span class="s2">, </span><span class="s4">2.07598674519837</span><span class="s2">,</span>
            <span class="s4">2.21972389625291</span><span class="s2">, </span><span class="s4">2.07598674519838</span><span class="s2">, </span><span class="s4">1.69522872823395</span><span class="s2">,</span>
            <span class="s4">1.20191856962359</span><span class="s2">, </span><span class="s4">0.73227013789110</span><span class="s2">, </span><span class="s4">0.37690207631118</span><span class="s2">,</span>
            <span class="s4">0.15939804265707</span><span class="s2">, </span><span class="s4">0.05282702120282</span><span class="s2">, </span><span class="s4">0.01249479541868</span><span class="s2">,</span>
            <span class="s4">0.00167583914216</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">13</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">A</span><span class="s2">, [</span>
            <span class="s4">1.00000000000000</span><span class="s2">, -</span><span class="s4">0.27631970006174</span><span class="s2">, </span><span class="s4">3.19751214254060</span><span class="s2">,</span>
            <span class="s2">-</span><span class="s4">0.15685969461355</span><span class="s2">, </span><span class="s4">4.13926117356269</span><span class="s2">, </span><span class="s4">0.60689917820044</span><span class="s2">,</span>
            <span class="s4">2.95082770636540</span><span class="s2">, </span><span class="s4">0.89016501910416</span><span class="s2">, </span><span class="s4">1.32135245849798</span><span class="s2">,</span>
            <span class="s4">0.51502467236824</span><span class="s2">, </span><span class="s4">0.38906643866660</span><span class="s2">, </span><span class="s4">0.15367372690642</span><span class="s2">,</span>
            <span class="s4">0.07255803834919</span><span class="s2">, </span><span class="s4">0.02422454070134</span><span class="s2">, </span><span class="s4">0.00756108751837</span><span class="s2">,</span>
            <span class="s4">0.00179848550988</span><span class="s2">, </span><span class="s4">0.00033713574499</span><span class="s2">, </span><span class="s4">0.00004258794833</span><span class="s2">,</span>
            <span class="s4">0.00000281030149</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">13</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_highpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># high even order</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">26</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">9.981088955489852e-01 </span><span class="s2">+ </span><span class="s4">6.147058341984388e-02j</span><span class="s2">,</span>
              <span class="s4">9.981088955489852e-01 </span><span class="s2">- </span><span class="s4">6.147058341984388e-02j</span><span class="s2">,</span>
              <span class="s4">9.832702870387426e-01 </span><span class="s2">+ </span><span class="s4">1.821525257215483e-01j</span><span class="s2">,</span>
              <span class="s4">9.832702870387426e-01 </span><span class="s2">- </span><span class="s4">1.821525257215483e-01j</span><span class="s2">,</span>
              <span class="s4">9.550760158089112e-01 </span><span class="s2">+ </span><span class="s4">2.963609353922882e-01j</span><span class="s2">,</span>
              <span class="s4">9.550760158089112e-01 </span><span class="s2">- </span><span class="s4">2.963609353922882e-01j</span><span class="s2">,</span>
              <span class="s4">9.162054748821922e-01 </span><span class="s2">+ </span><span class="s4">4.007087817803773e-01j</span><span class="s2">,</span>
              <span class="s4">9.162054748821922e-01 </span><span class="s2">- </span><span class="s4">4.007087817803773e-01j</span><span class="s2">,</span>
              <span class="s4">8.700619897368064e-01 </span><span class="s2">+ </span><span class="s4">4.929423232136168e-01j</span><span class="s2">,</span>
              <span class="s4">8.700619897368064e-01 </span><span class="s2">- </span><span class="s4">4.929423232136168e-01j</span><span class="s2">,</span>
              <span class="s4">5.889791753434985e-01 </span><span class="s2">+ </span><span class="s4">8.081482110427953e-01j</span><span class="s2">,</span>
              <span class="s4">5.889791753434985e-01 </span><span class="s2">- </span><span class="s4">8.081482110427953e-01j</span><span class="s2">,</span>
              <span class="s4">5.984900456570295e-01 </span><span class="s2">+ </span><span class="s4">8.011302423760501e-01j</span><span class="s2">,</span>
              <span class="s4">5.984900456570295e-01 </span><span class="s2">- </span><span class="s4">8.011302423760501e-01j</span><span class="s2">,</span>
              <span class="s4">6.172880888914629e-01 </span><span class="s2">+ </span><span class="s4">7.867371958365343e-01j</span><span class="s2">,</span>
              <span class="s4">6.172880888914629e-01 </span><span class="s2">- </span><span class="s4">7.867371958365343e-01j</span><span class="s2">,</span>
              <span class="s4">6.448899971038180e-01 </span><span class="s2">+ </span><span class="s4">7.642754030030161e-01j</span><span class="s2">,</span>
              <span class="s4">6.448899971038180e-01 </span><span class="s2">- </span><span class="s4">7.642754030030161e-01j</span><span class="s2">,</span>
              <span class="s4">6.804845629637927e-01 </span><span class="s2">+ </span><span class="s4">7.327624168637228e-01j</span><span class="s2">,</span>
              <span class="s4">6.804845629637927e-01 </span><span class="s2">- </span><span class="s4">7.327624168637228e-01j</span><span class="s2">,</span>
              <span class="s4">8.202619107108660e-01 </span><span class="s2">+ </span><span class="s4">5.719881098737678e-01j</span><span class="s2">,</span>
              <span class="s4">8.202619107108660e-01 </span><span class="s2">- </span><span class="s4">5.719881098737678e-01j</span><span class="s2">,</span>
              <span class="s4">7.228410452536148e-01 </span><span class="s2">+ </span><span class="s4">6.910143437705678e-01j</span><span class="s2">,</span>
              <span class="s4">7.228410452536148e-01 </span><span class="s2">- </span><span class="s4">6.910143437705678e-01j</span><span class="s2">,</span>
              <span class="s4">7.702121399578629e-01 </span><span class="s2">+ </span><span class="s4">6.377877856007792e-01j</span><span class="s2">,</span>
              <span class="s4">7.702121399578629e-01 </span><span class="s2">- </span><span class="s4">6.377877856007792e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [</span><span class="s4">7.365546198286450e-01 </span><span class="s2">+ </span><span class="s4">4.842085129329526e-02j</span><span class="s2">,</span>
              <span class="s4">7.365546198286450e-01 </span><span class="s2">- </span><span class="s4">4.842085129329526e-02j</span><span class="s2">,</span>
              <span class="s4">7.292038510962885e-01 </span><span class="s2">+ </span><span class="s4">1.442201672097581e-01j</span><span class="s2">,</span>
              <span class="s4">7.292038510962885e-01 </span><span class="s2">- </span><span class="s4">1.442201672097581e-01j</span><span class="s2">,</span>
              <span class="s4">7.151293788040354e-01 </span><span class="s2">+ </span><span class="s4">2.369925800458584e-01j</span><span class="s2">,</span>
              <span class="s4">7.151293788040354e-01 </span><span class="s2">- </span><span class="s4">2.369925800458584e-01j</span><span class="s2">,</span>
              <span class="s4">6.955051820787286e-01 </span><span class="s2">+ </span><span class="s4">3.250341363856910e-01j</span><span class="s2">,</span>
              <span class="s4">6.955051820787286e-01 </span><span class="s2">- </span><span class="s4">3.250341363856910e-01j</span><span class="s2">,</span>
              <span class="s4">6.719122956045220e-01 </span><span class="s2">+ </span><span class="s4">4.070475750638047e-01j</span><span class="s2">,</span>
              <span class="s4">6.719122956045220e-01 </span><span class="s2">- </span><span class="s4">4.070475750638047e-01j</span><span class="s2">,</span>
              <span class="s4">6.461722130611300e-01 </span><span class="s2">+ </span><span class="s4">4.821965916689270e-01j</span><span class="s2">,</span>
              <span class="s4">6.461722130611300e-01 </span><span class="s2">- </span><span class="s4">4.821965916689270e-01j</span><span class="s2">,</span>
              <span class="s4">5.528045062872224e-01 </span><span class="s2">+ </span><span class="s4">8.162920513838372e-01j</span><span class="s2">,</span>
              <span class="s4">5.528045062872224e-01 </span><span class="s2">- </span><span class="s4">8.162920513838372e-01j</span><span class="s2">,</span>
              <span class="s4">5.464847782492791e-01 </span><span class="s2">+ </span><span class="s4">7.869899955967304e-01j</span><span class="s2">,</span>
              <span class="s4">5.464847782492791e-01 </span><span class="s2">- </span><span class="s4">7.869899955967304e-01j</span><span class="s2">,</span>
              <span class="s4">5.488033111260949e-01 </span><span class="s2">+ </span><span class="s4">7.520442354055579e-01j</span><span class="s2">,</span>
              <span class="s4">5.488033111260949e-01 </span><span class="s2">- </span><span class="s4">7.520442354055579e-01j</span><span class="s2">,</span>
              <span class="s4">6.201874719022955e-01 </span><span class="s2">+ </span><span class="s4">5.500894392527353e-01j</span><span class="s2">,</span>
              <span class="s4">6.201874719022955e-01 </span><span class="s2">- </span><span class="s4">5.500894392527353e-01j</span><span class="s2">,</span>
              <span class="s4">5.586478152536709e-01 </span><span class="s2">+ </span><span class="s4">7.112676877332921e-01j</span><span class="s2">,</span>
              <span class="s4">5.586478152536709e-01 </span><span class="s2">- </span><span class="s4">7.112676877332921e-01j</span><span class="s2">,</span>
              <span class="s4">5.958145844148228e-01 </span><span class="s2">+ </span><span class="s4">6.107074340842115e-01j</span><span class="s2">,</span>
              <span class="s4">5.958145844148228e-01 </span><span class="s2">- </span><span class="s4">6.107074340842115e-01j</span><span class="s2">,</span>
              <span class="s4">5.747812938519067e-01 </span><span class="s2">+ </span><span class="s4">6.643001536914696e-01j</span><span class="s2">,</span>
              <span class="s4">5.747812938519067e-01 </span><span class="s2">- </span><span class="s4">6.643001536914696e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">9.932997786497189e-02</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-12</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-11</span><span class="s2">)</span>

        <span class="s5"># high odd order</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">25</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">9.690690376586687e-01 </span><span class="s2">+ </span><span class="s4">2.467897896011971e-01j</span><span class="s2">,</span>
              <span class="s4">9.690690376586687e-01 </span><span class="s2">- </span><span class="s4">2.467897896011971e-01j</span><span class="s2">,</span>
              <span class="s4">9.999999999999492e-01</span><span class="s2">,</span>
              <span class="s4">8.835111277191199e-01 </span><span class="s2">+ </span><span class="s4">4.684101698261429e-01j</span><span class="s2">,</span>
              <span class="s4">8.835111277191199e-01 </span><span class="s2">- </span><span class="s4">4.684101698261429e-01j</span><span class="s2">,</span>
              <span class="s4">7.613142857900539e-01 </span><span class="s2">+ </span><span class="s4">6.483830335935022e-01j</span><span class="s2">,</span>
              <span class="s4">7.613142857900539e-01 </span><span class="s2">- </span><span class="s4">6.483830335935022e-01j</span><span class="s2">,</span>
              <span class="s4">6.232625173626231e-01 </span><span class="s2">+ </span><span class="s4">7.820126817709752e-01j</span><span class="s2">,</span>
              <span class="s4">6.232625173626231e-01 </span><span class="s2">- </span><span class="s4">7.820126817709752e-01j</span><span class="s2">,</span>
              <span class="s4">4.864456563413621e-01 </span><span class="s2">+ </span><span class="s4">8.737108351316745e-01j</span><span class="s2">,</span>
              <span class="s4">4.864456563413621e-01 </span><span class="s2">- </span><span class="s4">8.737108351316745e-01j</span><span class="s2">,</span>
              <span class="s4">3.618368136816749e-01 </span><span class="s2">+ </span><span class="s4">9.322414495530347e-01j</span><span class="s2">,</span>
              <span class="s4">3.618368136816749e-01 </span><span class="s2">- </span><span class="s4">9.322414495530347e-01j</span><span class="s2">,</span>
              <span class="s4">2.549486883466794e-01 </span><span class="s2">+ </span><span class="s4">9.669545833752675e-01j</span><span class="s2">,</span>
              <span class="s4">2.549486883466794e-01 </span><span class="s2">- </span><span class="s4">9.669545833752675e-01j</span><span class="s2">,</span>
              <span class="s4">1.676175432109457e-01 </span><span class="s2">+ </span><span class="s4">9.858520980390212e-01j</span><span class="s2">,</span>
              <span class="s4">1.676175432109457e-01 </span><span class="s2">- </span><span class="s4">9.858520980390212e-01j</span><span class="s2">,</span>
              <span class="s4">1.975218468277521e-03 </span><span class="s2">+ </span><span class="s4">9.999980492540941e-01j</span><span class="s2">,</span>
              <span class="s4">1.975218468277521e-03 </span><span class="s2">- </span><span class="s4">9.999980492540941e-01j</span><span class="s2">,</span>
              <span class="s4">1.786959496651858e-02 </span><span class="s2">+ </span><span class="s4">9.998403260399917e-01j</span><span class="s2">,</span>
              <span class="s4">1.786959496651858e-02 </span><span class="s2">- </span><span class="s4">9.998403260399917e-01j</span><span class="s2">,</span>
              <span class="s4">9.967933660557139e-02 </span><span class="s2">+ </span><span class="s4">9.950196127985684e-01j</span><span class="s2">,</span>
              <span class="s4">9.967933660557139e-02 </span><span class="s2">- </span><span class="s4">9.950196127985684e-01j</span><span class="s2">,</span>
              <span class="s4">5.013970951219547e-02 </span><span class="s2">+ </span><span class="s4">9.987422137518890e-01j</span><span class="s2">,</span>
              <span class="s4">5.013970951219547e-02 </span><span class="s2">- </span><span class="s4">9.987422137518890e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [</span><span class="s4">4.218866331906864e-01</span><span class="s2">,</span>
              <span class="s4">4.120110200127552e-01 </span><span class="s2">+ </span><span class="s4">1.361290593621978e-01j</span><span class="s2">,</span>
              <span class="s4">4.120110200127552e-01 </span><span class="s2">- </span><span class="s4">1.361290593621978e-01j</span><span class="s2">,</span>
              <span class="s4">3.835890113632530e-01 </span><span class="s2">+ </span><span class="s4">2.664910809911026e-01j</span><span class="s2">,</span>
              <span class="s4">3.835890113632530e-01 </span><span class="s2">- </span><span class="s4">2.664910809911026e-01j</span><span class="s2">,</span>
              <span class="s4">3.399195570456499e-01 </span><span class="s2">+ </span><span class="s4">3.863983538639875e-01j</span><span class="s2">,</span>
              <span class="s4">3.399195570456499e-01 </span><span class="s2">- </span><span class="s4">3.863983538639875e-01j</span><span class="s2">,</span>
              <span class="s4">2.855977834508353e-01 </span><span class="s2">+ </span><span class="s4">4.929444399540688e-01j</span><span class="s2">,</span>
              <span class="s4">2.855977834508353e-01 </span><span class="s2">- </span><span class="s4">4.929444399540688e-01j</span><span class="s2">,</span>
              <span class="s4">2.255765441339322e-01 </span><span class="s2">+ </span><span class="s4">5.851631870205766e-01j</span><span class="s2">,</span>
              <span class="s4">2.255765441339322e-01 </span><span class="s2">- </span><span class="s4">5.851631870205766e-01j</span><span class="s2">,</span>
              <span class="s4">1.644087535815792e-01 </span><span class="s2">+ </span><span class="s4">6.637356937277153e-01j</span><span class="s2">,</span>
              <span class="s4">1.644087535815792e-01 </span><span class="s2">- </span><span class="s4">6.637356937277153e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">7.293633845273095e-02 </span><span class="s2">+ </span><span class="s4">9.739218252516307e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">7.293633845273095e-02 </span><span class="s2">- </span><span class="s4">9.739218252516307e-01j</span><span class="s2">,</span>
              <span class="s4">1.058259206358626e-01 </span><span class="s2">+ </span><span class="s4">7.304739464862978e-01j</span><span class="s2">,</span>
              <span class="s4">1.058259206358626e-01 </span><span class="s2">- </span><span class="s4">7.304739464862978e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.703971947785402e-02 </span><span class="s2">+ </span><span class="s4">9.291057542169088e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.703971947785402e-02 </span><span class="s2">- </span><span class="s4">9.291057542169088e-01j</span><span class="s2">,</span>
              <span class="s4">5.263875132656864e-02 </span><span class="s2">+ </span><span class="s4">7.877974334424453e-01j</span><span class="s2">,</span>
              <span class="s4">5.263875132656864e-02 </span><span class="s2">- </span><span class="s4">7.877974334424453e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.007943405982616e-02 </span><span class="s2">+ </span><span class="s4">8.846331716180016e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.007943405982616e-02 </span><span class="s2">- </span><span class="s4">8.846331716180016e-01j</span><span class="s2">,</span>
              <span class="s4">6.857277464483946e-03 </span><span class="s2">+ </span><span class="s4">8.383275456264492e-01j</span><span class="s2">,</span>
              <span class="s4">6.857277464483946e-03 </span><span class="s2">- </span><span class="s4">8.383275456264492e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">6.507068761705037e-03</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-12</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-11</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">9</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, [</span><span class="s4">0.07</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">], </span><span class="s3">'pass'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [-</span><span class="s4">9.999999999999999e-01</span><span class="s2">,</span>
               <span class="s4">3.676588029658514e-01 </span><span class="s2">+ </span><span class="s4">9.299607543341383e-01j</span><span class="s2">,</span>
               <span class="s4">3.676588029658514e-01 </span><span class="s2">- </span><span class="s4">9.299607543341383e-01j</span><span class="s2">,</span>
               <span class="s4">7.009689684982283e-01 </span><span class="s2">+ </span><span class="s4">7.131917730894889e-01j</span><span class="s2">,</span>
               <span class="s4">7.009689684982283e-01 </span><span class="s2">- </span><span class="s4">7.131917730894889e-01j</span><span class="s2">,</span>
               <span class="s4">7.815697973765858e-01 </span><span class="s2">+ </span><span class="s4">6.238178033919218e-01j</span><span class="s2">,</span>
               <span class="s4">7.815697973765858e-01 </span><span class="s2">- </span><span class="s4">6.238178033919218e-01j</span><span class="s2">,</span>
               <span class="s4">8.063793628819866e-01 </span><span class="s2">+ </span><span class="s4">5.913986160941200e-01j</span><span class="s2">,</span>
               <span class="s4">8.063793628819866e-01 </span><span class="s2">- </span><span class="s4">5.913986160941200e-01j</span><span class="s2">,</span>
               <span class="s4">1.000000000000001e+00</span><span class="s2">,</span>
               <span class="s4">9.944493019920448e-01 </span><span class="s2">+ </span><span class="s4">1.052168511576739e-01j</span><span class="s2">,</span>
               <span class="s4">9.944493019920448e-01 </span><span class="s2">- </span><span class="s4">1.052168511576739e-01j</span><span class="s2">,</span>
               <span class="s4">9.854674703367308e-01 </span><span class="s2">+ </span><span class="s4">1.698642543566085e-01j</span><span class="s2">,</span>
               <span class="s4">9.854674703367308e-01 </span><span class="s2">- </span><span class="s4">1.698642543566085e-01j</span><span class="s2">,</span>
               <span class="s4">9.762751735919308e-01 </span><span class="s2">+ </span><span class="s4">2.165335665157851e-01j</span><span class="s2">,</span>
               <span class="s4">9.762751735919308e-01 </span><span class="s2">- </span><span class="s4">2.165335665157851e-01j</span><span class="s2">,</span>
               <span class="s4">9.792277171575134e-01 </span><span class="s2">+ </span><span class="s4">2.027636011479496e-01j</span><span class="s2">,</span>
               <span class="s4">9.792277171575134e-01 </span><span class="s2">- </span><span class="s4">2.027636011479496e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [</span><span class="s4">8.143803410489621e-01 </span><span class="s2">+ </span><span class="s4">5.411056063397541e-01j</span><span class="s2">,</span>
              <span class="s4">8.143803410489621e-01 </span><span class="s2">- </span><span class="s4">5.411056063397541e-01j</span><span class="s2">,</span>
              <span class="s4">7.650769827887418e-01 </span><span class="s2">+ </span><span class="s4">5.195412242095543e-01j</span><span class="s2">,</span>
              <span class="s4">7.650769827887418e-01 </span><span class="s2">- </span><span class="s4">5.195412242095543e-01j</span><span class="s2">,</span>
              <span class="s4">6.096241204063443e-01 </span><span class="s2">+ </span><span class="s4">3.568440484659796e-01j</span><span class="s2">,</span>
              <span class="s4">6.096241204063443e-01 </span><span class="s2">- </span><span class="s4">3.568440484659796e-01j</span><span class="s2">,</span>
              <span class="s4">6.918192770246239e-01 </span><span class="s2">+ </span><span class="s4">4.770463577106911e-01j</span><span class="s2">,</span>
              <span class="s4">6.918192770246239e-01 </span><span class="s2">- </span><span class="s4">4.770463577106911e-01j</span><span class="s2">,</span>
              <span class="s4">6.986241085779207e-01 </span><span class="s2">+ </span><span class="s4">1.146512226180060e-01j</span><span class="s2">,</span>
              <span class="s4">6.986241085779207e-01 </span><span class="s2">- </span><span class="s4">1.146512226180060e-01j</span><span class="s2">,</span>
              <span class="s4">8.654645923909734e-01 </span><span class="s2">+ </span><span class="s4">1.604208797063147e-01j</span><span class="s2">,</span>
              <span class="s4">8.654645923909734e-01 </span><span class="s2">- </span><span class="s4">1.604208797063147e-01j</span><span class="s2">,</span>
              <span class="s4">9.164831670444591e-01 </span><span class="s2">+ </span><span class="s4">1.969181049384918e-01j</span><span class="s2">,</span>
              <span class="s4">9.164831670444591e-01 </span><span class="s2">- </span><span class="s4">1.969181049384918e-01j</span><span class="s2">,</span>
              <span class="s4">9.630425777594550e-01 </span><span class="s2">+ </span><span class="s4">2.317513360702271e-01j</span><span class="s2">,</span>
              <span class="s4">9.630425777594550e-01 </span><span class="s2">- </span><span class="s4">2.317513360702271e-01j</span><span class="s2">,</span>
              <span class="s4">9.438104703725529e-01 </span><span class="s2">+ </span><span class="s4">2.193509900269860e-01j</span><span class="s2">,</span>
              <span class="s4">9.438104703725529e-01 </span><span class="s2">- </span><span class="s4">2.193509900269860e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">9.345352824659604e-03</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-11</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandstop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">55</span><span class="s2">, [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">], </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">6.230544895101009e-01 </span><span class="s2">+ </span><span class="s4">7.821784343111114e-01j</span><span class="s2">,</span>
              <span class="s4">6.230544895101009e-01 </span><span class="s2">- </span><span class="s4">7.821784343111114e-01j</span><span class="s2">,</span>
              <span class="s4">9.086608545660115e-01 </span><span class="s2">+ </span><span class="s4">4.175349702471991e-01j</span><span class="s2">,</span>
              <span class="s4">9.086608545660115e-01 </span><span class="s2">- </span><span class="s4">4.175349702471991e-01j</span><span class="s2">,</span>
              <span class="s4">9.478129721465802e-01 </span><span class="s2">+ </span><span class="s4">3.188268649763867e-01j</span><span class="s2">,</span>
              <span class="s4">9.478129721465802e-01 </span><span class="s2">- </span><span class="s4">3.188268649763867e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.230544895100982e-01 </span><span class="s2">+ </span><span class="s4">7.821784343111109e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.230544895100982e-01 </span><span class="s2">- </span><span class="s4">7.821784343111109e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">9.086608545660116e-01 </span><span class="s2">+ </span><span class="s4">4.175349702472088e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">9.086608545660116e-01 </span><span class="s2">- </span><span class="s4">4.175349702472088e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">9.478129721465784e-01 </span><span class="s2">+ </span><span class="s4">3.188268649763897e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">9.478129721465784e-01 </span><span class="s2">- </span><span class="s4">3.188268649763897e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">9.464094036167638e-01 </span><span class="s2">+ </span><span class="s4">1.720048695084344e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">9.464094036167638e-01 </span><span class="s2">- </span><span class="s4">1.720048695084344e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">8.715844103386737e-01 </span><span class="s2">+ </span><span class="s4">1.370665039509297e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">8.715844103386737e-01 </span><span class="s2">- </span><span class="s4">1.370665039509297e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">8.078751204586425e-01 </span><span class="s2">+ </span><span class="s4">5.729329866682983e-02j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">8.078751204586425e-01 </span><span class="s2">- </span><span class="s4">5.729329866682983e-02j</span><span class="s2">,</span>
               <span class="s4">9.464094036167665e-01 </span><span class="s2">+ </span><span class="s4">1.720048695084332e-01j</span><span class="s2">,</span>
               <span class="s4">9.464094036167665e-01 </span><span class="s2">- </span><span class="s4">1.720048695084332e-01j</span><span class="s2">,</span>
               <span class="s4">8.078751204586447e-01 </span><span class="s2">+ </span><span class="s4">5.729329866683007e-02j</span><span class="s2">,</span>
               <span class="s4">8.078751204586447e-01 </span><span class="s2">- </span><span class="s4">5.729329866683007e-02j</span><span class="s2">,</span>
               <span class="s4">8.715844103386721e-01 </span><span class="s2">+ </span><span class="s4">1.370665039509331e-01j</span><span class="s2">,</span>
               <span class="s4">8.715844103386721e-01 </span><span class="s2">- </span><span class="s4">1.370665039509331e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">2.917823332763358e-03</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-13</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-11</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># with transfer function conversion, without digital conversion</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, [</span><span class="s4">2010</span><span class="s2">, </span><span class="s4">2100</span><span class="s2">], </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">b2 </span><span class="s2">= [</span><span class="s4">1.000000000000000e+00</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 6.683253076978249e-12,</span>
              <span class="s4">2.111512500000000e+07</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 1.134325604589552e-04,</span>
              <span class="s4">1.782966433781250e+14</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 7.216787944356781e+02,</span>
              <span class="s4">7.525901316990656e+20</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 2.039829265789886e+09,</span>
              <span class="s4">1.587960565565748e+27</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 2.161236218626134e+15,</span>
              <span class="s4">1.339913493808585e+33</span><span class="s2">]</span>
        <span class="s1">a2 </span><span class="s2">= [</span><span class="s4">1.000000000000000e+00</span><span class="s2">, </span><span class="s4">1.849550755473371e+02</span><span class="s2">,</span>
              <span class="s4">2.113222918998538e+07</span><span class="s2">, </span><span class="s4">3.125114149732283e+09</span><span class="s2">,</span>
              <span class="s4">1.785133457155609e+14</span><span class="s2">, </span><span class="s4">1.979158697776348e+16</span><span class="s2">,</span>
              <span class="s4">7.535048322653831e+20</span><span class="s2">, </span><span class="s4">5.567966191263037e+22</span><span class="s2">,</span>
              <span class="s4">1.589246884221346e+27</span><span class="s2">, </span><span class="s4">5.871210648525566e+28</span><span class="s2">,</span>
              <span class="s4">1.339913493808590e+33</span><span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">fs </span><span class="s0">in </span><span class="s2">(</span><span class="s4">900</span><span class="s2">, </span><span class="s4">900.1</span><span class="s2">, </span><span class="s4">1234.567</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">10</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">432.12345</span><span class="s2">):</span>
                    <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'lp'</span><span class="s2">, </span><span class="s3">'hp'</span><span class="s2">):</span>
                        <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                        <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">), </span><span class="s1">btype</span><span class="s2">)</span>
                        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">((</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">), (</span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">200.2</span><span class="s2">), (</span><span class="s4">321.123</span><span class="s2">, </span><span class="s4">432.123</span><span class="s2">)):</span>
                    <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'bp'</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">):</span>
                        <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                        <span class="s0">for </span><span class="s1">seq </span><span class="s0">in </span><span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">array</span><span class="s2">):</span>
                            <span class="s1">fcnorm </span><span class="s2">= </span><span class="s1">seq</span><span class="s2">([</span><span class="s1">f</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">) </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">fc</span><span class="s2">])</span>
                            <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">cheby2</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s1">fcnorm</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">)</span>
                            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">TestEllip</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_degenerate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 0-order filter is just a passthrough</span>
        <span class="s5"># Even-order filters have DC gain of -rp dB</span>
        <span class="s5"># Stopband ripple factor doesn't matter</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s4">123.456</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>

        <span class="s5"># 1-order filter is same for all types</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>

        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">55</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [-</span><span class="s4">9.999999999999998e-01</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, [-</span><span class="s4">6.660721153525525e-04</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s4">5.003330360576763e-01</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-14</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">25</span><span class="s2">):</span>
            <span class="s1">wn </span><span class="s2">= </span><span class="s4">0.01</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">wn</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) == </span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">real</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) &lt;= </span><span class="s4">0</span><span class="s2">))  </span><span class="s5"># No poles in right half of S-plane</span>

        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">25</span><span class="s2">):</span>
            <span class="s1">wn </span><span class="s2">= </span><span class="s4">0.01</span>
            <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">wn</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) &lt;= </span><span class="s4">1</span><span class="s2">))  </span><span class="s5"># No poles outside unit circle</span>

        <span class="s1">b3</span><span class="s2">, </span><span class="s1">a3 </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">26</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b3</span><span class="s2">, [</span><span class="s4">0.1420</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.3764</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                                       <span class="s4">0.2409</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a3</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.5686</span><span class="s2">, </span><span class="s4">1.8061</span><span class="s2">, </span><span class="s4">0.8017</span><span class="s2">, </span><span class="s4">0.8012</span><span class="s2">,</span>
                                       <span class="s4">0.2409</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, [</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">], </span><span class="s3">'stop'</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, [</span><span class="s4">0.3310</span><span class="s2">, </span><span class="s4">0.3469</span><span class="s2">, </span><span class="s4">1.1042</span><span class="s2">, </span><span class="s4">0.7044</span><span class="s2">, </span><span class="s4">1.1042</span><span class="s2">,</span>
                                      <span class="s4">0.3469</span><span class="s2">, </span><span class="s4">0.3310</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, [</span><span class="s4">1.0000</span><span class="s2">, </span><span class="s4">0.6973</span><span class="s2">, </span><span class="s4">1.1441</span><span class="s2">, </span><span class="s4">0.5878</span><span class="s2">, </span><span class="s4">0.7323</span><span class="s2">,</span>
                                      <span class="s4">0.1131</span><span class="s2">, -</span><span class="s4">0.0060</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_highpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># high even order</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">24</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">9.761875332501075e-01 </span><span class="s2">+ </span><span class="s4">2.169283290099910e-01j</span><span class="s2">,</span>
              <span class="s4">9.761875332501075e-01 </span><span class="s2">- </span><span class="s4">2.169283290099910e-01j</span><span class="s2">,</span>
              <span class="s4">8.413503353963494e-01 </span><span class="s2">+ </span><span class="s4">5.404901600661900e-01j</span><span class="s2">,</span>
              <span class="s4">8.413503353963494e-01 </span><span class="s2">- </span><span class="s4">5.404901600661900e-01j</span><span class="s2">,</span>
              <span class="s4">7.160082576305009e-01 </span><span class="s2">+ </span><span class="s4">6.980918098681732e-01j</span><span class="s2">,</span>
              <span class="s4">7.160082576305009e-01 </span><span class="s2">- </span><span class="s4">6.980918098681732e-01j</span><span class="s2">,</span>
              <span class="s4">6.456533638965329e-01 </span><span class="s2">+ </span><span class="s4">7.636306264739803e-01j</span><span class="s2">,</span>
              <span class="s4">6.456533638965329e-01 </span><span class="s2">- </span><span class="s4">7.636306264739803e-01j</span><span class="s2">,</span>
              <span class="s4">6.127321820971366e-01 </span><span class="s2">+ </span><span class="s4">7.902906256703928e-01j</span><span class="s2">,</span>
              <span class="s4">6.127321820971366e-01 </span><span class="s2">- </span><span class="s4">7.902906256703928e-01j</span><span class="s2">,</span>
              <span class="s4">5.983607817490196e-01 </span><span class="s2">+ </span><span class="s4">8.012267936512676e-01j</span><span class="s2">,</span>
              <span class="s4">5.983607817490196e-01 </span><span class="s2">- </span><span class="s4">8.012267936512676e-01j</span><span class="s2">,</span>
              <span class="s4">5.922577552594799e-01 </span><span class="s2">+ </span><span class="s4">8.057485658286990e-01j</span><span class="s2">,</span>
              <span class="s4">5.922577552594799e-01 </span><span class="s2">- </span><span class="s4">8.057485658286990e-01j</span><span class="s2">,</span>
              <span class="s4">5.896952092563588e-01 </span><span class="s2">+ </span><span class="s4">8.076258788449631e-01j</span><span class="s2">,</span>
              <span class="s4">5.896952092563588e-01 </span><span class="s2">- </span><span class="s4">8.076258788449631e-01j</span><span class="s2">,</span>
              <span class="s4">5.886248765538837e-01 </span><span class="s2">+ </span><span class="s4">8.084063054565607e-01j</span><span class="s2">,</span>
              <span class="s4">5.886248765538837e-01 </span><span class="s2">- </span><span class="s4">8.084063054565607e-01j</span><span class="s2">,</span>
              <span class="s4">5.881802711123132e-01 </span><span class="s2">+ </span><span class="s4">8.087298490066037e-01j</span><span class="s2">,</span>
              <span class="s4">5.881802711123132e-01 </span><span class="s2">- </span><span class="s4">8.087298490066037e-01j</span><span class="s2">,</span>
              <span class="s4">5.879995719101164e-01 </span><span class="s2">+ </span><span class="s4">8.088612386766461e-01j</span><span class="s2">,</span>
              <span class="s4">5.879995719101164e-01 </span><span class="s2">- </span><span class="s4">8.088612386766461e-01j</span><span class="s2">,</span>
              <span class="s4">5.879354086709576e-01 </span><span class="s2">+ </span><span class="s4">8.089078780868164e-01j</span><span class="s2">,</span>
              <span class="s4">5.879354086709576e-01 </span><span class="s2">- </span><span class="s4">8.089078780868164e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">3.184805259081650e-01 </span><span class="s2">+ </span><span class="s4">4.206951906775851e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.184805259081650e-01 </span><span class="s2">- </span><span class="s4">4.206951906775851e-01j</span><span class="s2">,</span>
               <span class="s4">1.417279173459985e-01 </span><span class="s2">+ </span><span class="s4">7.903955262836452e-01j</span><span class="s2">,</span>
               <span class="s4">1.417279173459985e-01 </span><span class="s2">- </span><span class="s4">7.903955262836452e-01j</span><span class="s2">,</span>
               <span class="s4">4.042881216964651e-01 </span><span class="s2">+ </span><span class="s4">8.309042239116594e-01j</span><span class="s2">,</span>
               <span class="s4">4.042881216964651e-01 </span><span class="s2">- </span><span class="s4">8.309042239116594e-01j</span><span class="s2">,</span>
               <span class="s4">5.128964442789670e-01 </span><span class="s2">+ </span><span class="s4">8.229563236799665e-01j</span><span class="s2">,</span>
               <span class="s4">5.128964442789670e-01 </span><span class="s2">- </span><span class="s4">8.229563236799665e-01j</span><span class="s2">,</span>
               <span class="s4">5.569614712822724e-01 </span><span class="s2">+ </span><span class="s4">8.155957702908510e-01j</span><span class="s2">,</span>
               <span class="s4">5.569614712822724e-01 </span><span class="s2">- </span><span class="s4">8.155957702908510e-01j</span><span class="s2">,</span>
               <span class="s4">5.750478870161392e-01 </span><span class="s2">+ </span><span class="s4">8.118633973883931e-01j</span><span class="s2">,</span>
               <span class="s4">5.750478870161392e-01 </span><span class="s2">- </span><span class="s4">8.118633973883931e-01j</span><span class="s2">,</span>
               <span class="s4">5.825314018170804e-01 </span><span class="s2">+ </span><span class="s4">8.101960910679270e-01j</span><span class="s2">,</span>
               <span class="s4">5.825314018170804e-01 </span><span class="s2">- </span><span class="s4">8.101960910679270e-01j</span><span class="s2">,</span>
               <span class="s4">5.856397379751872e-01 </span><span class="s2">+ </span><span class="s4">8.094825218722543e-01j</span><span class="s2">,</span>
               <span class="s4">5.856397379751872e-01 </span><span class="s2">- </span><span class="s4">8.094825218722543e-01j</span><span class="s2">,</span>
               <span class="s4">5.869326035251949e-01 </span><span class="s2">+ </span><span class="s4">8.091827531557583e-01j</span><span class="s2">,</span>
               <span class="s4">5.869326035251949e-01 </span><span class="s2">- </span><span class="s4">8.091827531557583e-01j</span><span class="s2">,</span>
               <span class="s4">5.874697218855733e-01 </span><span class="s2">+ </span><span class="s4">8.090593298213502e-01j</span><span class="s2">,</span>
               <span class="s4">5.874697218855733e-01 </span><span class="s2">- </span><span class="s4">8.090593298213502e-01j</span><span class="s2">,</span>
               <span class="s4">5.876904783532237e-01 </span><span class="s2">+ </span><span class="s4">8.090127161018823e-01j</span><span class="s2">,</span>
               <span class="s4">5.876904783532237e-01 </span><span class="s2">- </span><span class="s4">8.090127161018823e-01j</span><span class="s2">,</span>
               <span class="s4">5.877753105317594e-01 </span><span class="s2">+ </span><span class="s4">8.090050577978136e-01j</span><span class="s2">,</span>
               <span class="s4">5.877753105317594e-01 </span><span class="s2">- </span><span class="s4">8.090050577978136e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">4.918081266957108e-02</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-3</span><span class="s2">)</span>

        <span class="s5"># high odd order</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">23</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s3">'high'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">9.999999999998661e-01</span><span class="s2">,</span>
              <span class="s4">6.603717261750994e-01 </span><span class="s2">+ </span><span class="s4">7.509388678638675e-01j</span><span class="s2">,</span>
              <span class="s4">6.603717261750994e-01 </span><span class="s2">- </span><span class="s4">7.509388678638675e-01j</span><span class="s2">,</span>
              <span class="s4">2.788635267510325e-01 </span><span class="s2">+ </span><span class="s4">9.603307416968041e-01j</span><span class="s2">,</span>
              <span class="s4">2.788635267510325e-01 </span><span class="s2">- </span><span class="s4">9.603307416968041e-01j</span><span class="s2">,</span>
              <span class="s4">1.070215532544218e-01 </span><span class="s2">+ </span><span class="s4">9.942567008268131e-01j</span><span class="s2">,</span>
              <span class="s4">1.070215532544218e-01 </span><span class="s2">- </span><span class="s4">9.942567008268131e-01j</span><span class="s2">,</span>
              <span class="s4">4.049427369978163e-02 </span><span class="s2">+ </span><span class="s4">9.991797705105507e-01j</span><span class="s2">,</span>
              <span class="s4">4.049427369978163e-02 </span><span class="s2">- </span><span class="s4">9.991797705105507e-01j</span><span class="s2">,</span>
              <span class="s4">1.531059368627931e-02 </span><span class="s2">+ </span><span class="s4">9.998827859909265e-01j</span><span class="s2">,</span>
              <span class="s4">1.531059368627931e-02 </span><span class="s2">- </span><span class="s4">9.998827859909265e-01j</span><span class="s2">,</span>
              <span class="s4">5.808061438534933e-03 </span><span class="s2">+ </span><span class="s4">9.999831330689181e-01j</span><span class="s2">,</span>
              <span class="s4">5.808061438534933e-03 </span><span class="s2">- </span><span class="s4">9.999831330689181e-01j</span><span class="s2">,</span>
              <span class="s4">2.224277847754599e-03 </span><span class="s2">+ </span><span class="s4">9.999975262909676e-01j</span><span class="s2">,</span>
              <span class="s4">2.224277847754599e-03 </span><span class="s2">- </span><span class="s4">9.999975262909676e-01j</span><span class="s2">,</span>
              <span class="s4">8.731857107534554e-04 </span><span class="s2">+ </span><span class="s4">9.999996187732845e-01j</span><span class="s2">,</span>
              <span class="s4">8.731857107534554e-04 </span><span class="s2">- </span><span class="s4">9.999996187732845e-01j</span><span class="s2">,</span>
              <span class="s4">3.649057346914968e-04 </span><span class="s2">+ </span><span class="s4">9.999999334218996e-01j</span><span class="s2">,</span>
              <span class="s4">3.649057346914968e-04 </span><span class="s2">- </span><span class="s4">9.999999334218996e-01j</span><span class="s2">,</span>
              <span class="s4">1.765538109802615e-04 </span><span class="s2">+ </span><span class="s4">9.999999844143768e-01j</span><span class="s2">,</span>
              <span class="s4">1.765538109802615e-04 </span><span class="s2">- </span><span class="s4">9.999999844143768e-01j</span><span class="s2">,</span>
              <span class="s4">1.143655290967426e-04 </span><span class="s2">+ </span><span class="s4">9.999999934602630e-01j</span><span class="s2">,</span>
              <span class="s4">1.143655290967426e-04 </span><span class="s2">- </span><span class="s4">9.999999934602630e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">6.322017026545028e-01</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">4.648423756662754e-01 </span><span class="s2">+ </span><span class="s4">5.852407464440732e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">4.648423756662754e-01 </span><span class="s2">- </span><span class="s4">5.852407464440732e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.249233374627773e-01 </span><span class="s2">+ </span><span class="s4">8.577853017985717e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.249233374627773e-01 </span><span class="s2">- </span><span class="s4">8.577853017985717e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">9.234137570557621e-02 </span><span class="s2">+ </span><span class="s4">9.506548198678851e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">9.234137570557621e-02 </span><span class="s2">- </span><span class="s4">9.506548198678851e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.585663561241373e-02 </span><span class="s2">+ </span><span class="s4">9.821494736043981e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.585663561241373e-02 </span><span class="s2">- </span><span class="s4">9.821494736043981e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.363917242312723e-02 </span><span class="s2">+ </span><span class="s4">9.933844128330656e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.363917242312723e-02 </span><span class="s2">- </span><span class="s4">9.933844128330656e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.131505238923029e-03 </span><span class="s2">+ </span><span class="s4">9.975221173308673e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.131505238923029e-03 </span><span class="s2">- </span><span class="s4">9.975221173308673e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.904937999259502e-03 </span><span class="s2">+ </span><span class="s4">9.990680819857982e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.904937999259502e-03 </span><span class="s2">- </span><span class="s4">9.990680819857982e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.859439885466834e-04 </span><span class="s2">+ </span><span class="s4">9.996492201426826e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.859439885466834e-04 </span><span class="s2">- </span><span class="s4">9.996492201426826e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.269936267937089e-04 </span><span class="s2">+ </span><span class="s4">9.998686250679161e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.269936267937089e-04 </span><span class="s2">- </span><span class="s4">9.998686250679161e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.687071588789117e-05 </span><span class="s2">+ </span><span class="s4">9.999527573294513e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.687071588789117e-05 </span><span class="s2">- </span><span class="s4">9.999527573294513e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.948417068525226e-07 </span><span class="s2">+ </span><span class="s4">9.999882737700173e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">6.948417068525226e-07 </span><span class="s2">- </span><span class="s4">9.999882737700173e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">1.220910020289434e-02</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandpass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, [</span><span class="s4">0.07</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">], </span><span class="s3">'pass'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [-</span><span class="s4">9.999999999999991e-01</span><span class="s2">,</span>
               <span class="s4">6.856610961780020e-01 </span><span class="s2">+ </span><span class="s4">7.279209168501619e-01j</span><span class="s2">,</span>
               <span class="s4">6.856610961780020e-01 </span><span class="s2">- </span><span class="s4">7.279209168501619e-01j</span><span class="s2">,</span>
               <span class="s4">7.850346167691289e-01 </span><span class="s2">+ </span><span class="s4">6.194518952058737e-01j</span><span class="s2">,</span>
               <span class="s4">7.850346167691289e-01 </span><span class="s2">- </span><span class="s4">6.194518952058737e-01j</span><span class="s2">,</span>
               <span class="s4">7.999038743173071e-01 </span><span class="s2">+ </span><span class="s4">6.001281461922627e-01j</span><span class="s2">,</span>
               <span class="s4">7.999038743173071e-01 </span><span class="s2">- </span><span class="s4">6.001281461922627e-01j</span><span class="s2">,</span>
               <span class="s4">9.999999999999999e-01</span><span class="s2">,</span>
               <span class="s4">9.862938983554124e-01 </span><span class="s2">+ </span><span class="s4">1.649980183725925e-01j</span><span class="s2">,</span>
               <span class="s4">9.862938983554124e-01 </span><span class="s2">- </span><span class="s4">1.649980183725925e-01j</span><span class="s2">,</span>
               <span class="s4">9.788558330548762e-01 </span><span class="s2">+ </span><span class="s4">2.045513580850601e-01j</span><span class="s2">,</span>
               <span class="s4">9.788558330548762e-01 </span><span class="s2">- </span><span class="s4">2.045513580850601e-01j</span><span class="s2">,</span>
               <span class="s4">9.771155231720003e-01 </span><span class="s2">+ </span><span class="s4">2.127093189691258e-01j</span><span class="s2">,</span>
               <span class="s4">9.771155231720003e-01 </span><span class="s2">- </span><span class="s4">2.127093189691258e-01j</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [</span><span class="s4">8.063992755498643e-01 </span><span class="s2">+ </span><span class="s4">5.858071374778874e-01j</span><span class="s2">,</span>
              <span class="s4">8.063992755498643e-01 </span><span class="s2">- </span><span class="s4">5.858071374778874e-01j</span><span class="s2">,</span>
              <span class="s4">8.050395347071724e-01 </span><span class="s2">+ </span><span class="s4">5.639097428109795e-01j</span><span class="s2">,</span>
              <span class="s4">8.050395347071724e-01 </span><span class="s2">- </span><span class="s4">5.639097428109795e-01j</span><span class="s2">,</span>
              <span class="s4">8.113124936559144e-01 </span><span class="s2">+ </span><span class="s4">4.855241143973142e-01j</span><span class="s2">,</span>
              <span class="s4">8.113124936559144e-01 </span><span class="s2">- </span><span class="s4">4.855241143973142e-01j</span><span class="s2">,</span>
              <span class="s4">8.665595314082394e-01 </span><span class="s2">+ </span><span class="s4">3.334049560919331e-01j</span><span class="s2">,</span>
              <span class="s4">8.665595314082394e-01 </span><span class="s2">- </span><span class="s4">3.334049560919331e-01j</span><span class="s2">,</span>
              <span class="s4">9.412369011968871e-01 </span><span class="s2">+ </span><span class="s4">2.457616651325908e-01j</span><span class="s2">,</span>
              <span class="s4">9.412369011968871e-01 </span><span class="s2">- </span><span class="s4">2.457616651325908e-01j</span><span class="s2">,</span>
              <span class="s4">9.679465190411238e-01 </span><span class="s2">+ </span><span class="s4">2.228772501848216e-01j</span><span class="s2">,</span>
              <span class="s4">9.679465190411238e-01 </span><span class="s2">- </span><span class="s4">2.228772501848216e-01j</span><span class="s2">,</span>
              <span class="s4">9.747235066273385e-01 </span><span class="s2">+ </span><span class="s4">2.178937926146544e-01j</span><span class="s2">,</span>
              <span class="s4">9.747235066273385e-01 </span><span class="s2">- </span><span class="s4">2.178937926146544e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">8.354782670263239e-03</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-3</span><span class="s2">)</span>

        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, [</span><span class="s4">90.5</span><span class="s2">, </span><span class="s4">110.5</span><span class="s2">], </span><span class="s3">'pass'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [-</span><span class="s4">5.583607317695175e-14 </span><span class="s2">+ </span><span class="s4">1.433755965989225e+02j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">5.583607317695175e-14 </span><span class="s2">- </span><span class="s4">1.433755965989225e+02j</span><span class="s2">,</span>
               <span class="s4">5.740106416459296e-14 </span><span class="s2">+ </span><span class="s4">1.261678754570291e+02j</span><span class="s2">,</span>
               <span class="s4">5.740106416459296e-14 </span><span class="s2">- </span><span class="s4">1.261678754570291e+02j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.199676239638652e-14 </span><span class="s2">+ </span><span class="s4">6.974861996895196e+01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.199676239638652e-14 </span><span class="s2">- </span><span class="s4">6.974861996895196e+01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.372595657044283e-14 </span><span class="s2">+ </span><span class="s4">7.926145989044531e+01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.372595657044283e-14 </span><span class="s2">- </span><span class="s4">7.926145989044531e+01j</span><span class="s2">,</span>
              <span class="s4">0</span><span class="s2">]</span>
        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">8.814960004852743e-01 </span><span class="s2">+ </span><span class="s4">1.104124501436066e+02j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">8.814960004852743e-01 </span><span class="s2">- </span><span class="s4">1.104124501436066e+02j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.477372459140184e+00 </span><span class="s2">+ </span><span class="s4">1.065638954516534e+02j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.477372459140184e+00 </span><span class="s2">- </span><span class="s4">1.065638954516534e+02j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.072156842945799e+00 </span><span class="s2">+ </span><span class="s4">9.995404870405324e+01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">3.072156842945799e+00 </span><span class="s2">- </span><span class="s4">9.995404870405324e+01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.180456023925693e+00 </span><span class="s2">+ </span><span class="s4">9.379206865455268e+01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">2.180456023925693e+00 </span><span class="s2">- </span><span class="s4">9.379206865455268e+01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">7.230484977485752e-01 </span><span class="s2">+ </span><span class="s4">9.056598800801140e+01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">7.230484977485752e-01 </span><span class="s2">- </span><span class="s4">9.056598800801140e+01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">3.774571622827070e-02</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bandstop</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">65</span><span class="s2">, [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">], </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= [</span><span class="s4">3.528578094286510e-01 </span><span class="s2">+ </span><span class="s4">9.356769561794296e-01j</span><span class="s2">,</span>
              <span class="s4">3.528578094286510e-01 </span><span class="s2">- </span><span class="s4">9.356769561794296e-01j</span><span class="s2">,</span>
              <span class="s4">3.769716042264783e-01 </span><span class="s2">+ </span><span class="s4">9.262248159096587e-01j</span><span class="s2">,</span>
              <span class="s4">3.769716042264783e-01 </span><span class="s2">- </span><span class="s4">9.262248159096587e-01j</span><span class="s2">,</span>
              <span class="s4">4.406101783111199e-01 </span><span class="s2">+ </span><span class="s4">8.976985411420985e-01j</span><span class="s2">,</span>
              <span class="s4">4.406101783111199e-01 </span><span class="s2">- </span><span class="s4">8.976985411420985e-01j</span><span class="s2">,</span>
              <span class="s4">5.539386470258847e-01 </span><span class="s2">+ </span><span class="s4">8.325574907062760e-01j</span><span class="s2">,</span>
              <span class="s4">5.539386470258847e-01 </span><span class="s2">- </span><span class="s4">8.325574907062760e-01j</span><span class="s2">,</span>
              <span class="s4">6.748464963023645e-01 </span><span class="s2">+ </span><span class="s4">7.379581332490555e-01j</span><span class="s2">,</span>
              <span class="s4">6.748464963023645e-01 </span><span class="s2">- </span><span class="s4">7.379581332490555e-01j</span><span class="s2">,</span>
              <span class="s4">7.489887970285254e-01 </span><span class="s2">+ </span><span class="s4">6.625826604475596e-01j</span><span class="s2">,</span>
              <span class="s4">7.489887970285254e-01 </span><span class="s2">- </span><span class="s4">6.625826604475596e-01j</span><span class="s2">,</span>
              <span class="s4">7.913118471618432e-01 </span><span class="s2">+ </span><span class="s4">6.114127579150699e-01j</span><span class="s2">,</span>
              <span class="s4">7.913118471618432e-01 </span><span class="s2">- </span><span class="s4">6.114127579150699e-01j</span><span class="s2">,</span>
              <span class="s4">7.806804740916381e-01 </span><span class="s2">+ </span><span class="s4">6.249303940216475e-01j</span><span class="s2">,</span>
              <span class="s4">7.806804740916381e-01 </span><span class="s2">- </span><span class="s4">6.249303940216475e-01j</span><span class="s2">]</span>

        <span class="s1">p2 </span><span class="s2">= [-</span><span class="s4">1.025299146693730e-01 </span><span class="s2">+ </span><span class="s4">5.662682444754943e-01j</span><span class="s2">,</span>
              <span class="s2">-</span><span class="s4">1.025299146693730e-01 </span><span class="s2">- </span><span class="s4">5.662682444754943e-01j</span><span class="s2">,</span>
               <span class="s4">1.698463595163031e-01 </span><span class="s2">+ </span><span class="s4">8.926678667070186e-01j</span><span class="s2">,</span>
               <span class="s4">1.698463595163031e-01 </span><span class="s2">- </span><span class="s4">8.926678667070186e-01j</span><span class="s2">,</span>
               <span class="s4">2.750532687820631e-01 </span><span class="s2">+ </span><span class="s4">9.351020170094005e-01j</span><span class="s2">,</span>
               <span class="s4">2.750532687820631e-01 </span><span class="s2">- </span><span class="s4">9.351020170094005e-01j</span><span class="s2">,</span>
               <span class="s4">3.070095178909486e-01 </span><span class="s2">+ </span><span class="s4">9.457373499553291e-01j</span><span class="s2">,</span>
               <span class="s4">3.070095178909486e-01 </span><span class="s2">- </span><span class="s4">9.457373499553291e-01j</span><span class="s2">,</span>
               <span class="s4">7.695332312152288e-01 </span><span class="s2">+ </span><span class="s4">2.792567212705257e-01j</span><span class="s2">,</span>
               <span class="s4">7.695332312152288e-01 </span><span class="s2">- </span><span class="s4">2.792567212705257e-01j</span><span class="s2">,</span>
               <span class="s4">8.083818999225620e-01 </span><span class="s2">+ </span><span class="s4">4.990723496863960e-01j</span><span class="s2">,</span>
               <span class="s4">8.083818999225620e-01 </span><span class="s2">- </span><span class="s4">4.990723496863960e-01j</span><span class="s2">,</span>
               <span class="s4">8.066158014414928e-01 </span><span class="s2">+ </span><span class="s4">5.649811440393374e-01j</span><span class="s2">,</span>
               <span class="s4">8.066158014414928e-01 </span><span class="s2">- </span><span class="s4">5.649811440393374e-01j</span><span class="s2">,</span>
               <span class="s4">8.062787978834571e-01 </span><span class="s2">+ </span><span class="s4">5.855780880424964e-01j</span><span class="s2">,</span>
               <span class="s4">8.062787978834571e-01 </span><span class="s2">- </span><span class="s4">5.855780880424964e-01j</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">2.068622545291259e-01</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">z2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">),</span>
                        <span class="s1">sorted</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">key</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">angle</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-5</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># with transfer function conversion,  without digital conversion</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, [</span><span class="s4">201</span><span class="s2">, </span><span class="s4">240</span><span class="s2">], </span><span class="s3">'stop'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">b2 </span><span class="s2">= [</span>
             <span class="s4">1.000000000000000e+00</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 1.743506051190569e-13,</span>
             <span class="s4">2.426561778314366e+05</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 3.459426536825722e-08,</span>
             <span class="s4">2.348218683400168e+10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 2.559179747299313e-03,</span>
             <span class="s4">1.132780692872241e+15</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 8.363229375535731e+01,</span>
             <span class="s4">2.724038554089566e+19</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,  </span><span class="s5"># Matlab: 1.018700994113120e+06,</span>
             <span class="s4">2.612380874940186e+23</span>
             <span class="s2">]</span>
        <span class="s1">a2 </span><span class="s2">= [</span>
             <span class="s4">1.000000000000000e+00</span><span class="s2">, </span><span class="s4">1.337266601804649e+02</span><span class="s2">,</span>
             <span class="s4">2.486725353510667e+05</span><span class="s2">, </span><span class="s4">2.628059713728125e+07</span><span class="s2">,</span>
             <span class="s4">2.436169536928770e+10</span><span class="s2">, </span><span class="s4">1.913554568577315e+12</span><span class="s2">,</span>
             <span class="s4">1.175208184614438e+15</span><span class="s2">, </span><span class="s4">6.115751452473410e+16</span><span class="s2">,</span>
             <span class="s4">2.791577695211466e+19</span><span class="s2">, </span><span class="s4">7.241811142725384e+20</span><span class="s2">,</span>
             <span class="s4">2.612380874940182e+23</span>
             <span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-6</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">fs </span><span class="s0">in </span><span class="s2">(</span><span class="s4">900</span><span class="s2">, </span><span class="s4">900.1</span><span class="s2">, </span><span class="s4">1234.567</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">10</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">432.12345</span><span class="s2">):</span>
                    <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'lp'</span><span class="s2">, </span><span class="s3">'hp'</span><span class="s2">):</span>
                        <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                        <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">), </span><span class="s1">btype</span><span class="s2">)</span>
                        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>
                <span class="s0">for </span><span class="s1">fc </span><span class="s0">in </span><span class="s2">((</span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">), (</span><span class="s4">100.1</span><span class="s2">, </span><span class="s4">200.2</span><span class="s2">), (</span><span class="s4">321.123</span><span class="s2">, </span><span class="s4">432.123</span><span class="s2">)):</span>
                    <span class="s0">for </span><span class="s1">btype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'bp'</span><span class="s2">, </span><span class="s3">'bs'</span><span class="s2">):</span>
                        <span class="s1">ba1 </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>
                        <span class="s0">for </span><span class="s1">seq </span><span class="s0">in </span><span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">, </span><span class="s1">array</span><span class="s2">):</span>
                            <span class="s1">fcnorm </span><span class="s2">= </span><span class="s1">seq</span><span class="s2">([</span><span class="s1">f</span><span class="s2">/(</span><span class="s1">fs</span><span class="s2">/</span><span class="s4">2</span><span class="s2">) </span><span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s1">fc</span><span class="s2">])</span>
                            <span class="s1">ba2 </span><span class="s2">= </span><span class="s1">ellip</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s1">fcnorm</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">)</span>
                            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ba1</span><span class="s2">, </span><span class="s1">ba2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">iirnotch</span><span class="s2">(</span><span class="s4">0.06</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*be none&quot;</span><span class="s2">):</span>
            <span class="s1">iirnotch</span><span class="s2">(</span><span class="s4">0.06</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_sos_consistency</span><span class="s2">():</span>
    <span class="s5"># Consistency checks of output='sos' for the specialized IIR filter</span>
    <span class="s5"># design functions.</span>
    <span class="s1">design_funcs </span><span class="s2">= [(</span><span class="s1">bessel</span><span class="s2">, (</span><span class="s4">0.1</span><span class="s2">,)),</span>
                    <span class="s2">(</span><span class="s1">butter</span><span class="s2">, (</span><span class="s4">0.1</span><span class="s2">,)),</span>
                    <span class="s2">(</span><span class="s1">cheby1</span><span class="s2">, (</span><span class="s4">45.0</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">)),</span>
                    <span class="s2">(</span><span class="s1">cheby2</span><span class="s2">, (</span><span class="s4">0.087</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">)),</span>
                    <span class="s2">(</span><span class="s1">ellip</span><span class="s2">, (</span><span class="s4">0.087</span><span class="s2">, </span><span class="s4">45</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">))]</span>
    <span class="s0">for </span><span class="s1">func</span><span class="s2">, </span><span class="s1">args </span><span class="s0">in </span><span class="s1">design_funcs</span><span class="s2">:</span>
        <span class="s1">name </span><span class="s2">= </span><span class="s1">func</span><span class="s2">.</span><span class="s1">__name__</span>

        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'ba'</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">((</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">))], </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s3">&quot;%s(2,...)&quot; </span><span class="s2">% </span><span class="s1">name</span><span class="s2">)</span>

        <span class="s1">zpk </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">zpk2sos</span><span class="s2">(*</span><span class="s1">zpk</span><span class="s2">), </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s3">&quot;%s(3,...)&quot; </span><span class="s2">% </span><span class="s1">name</span><span class="s2">)</span>

        <span class="s1">zpk </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
        <span class="s1">sos </span><span class="s2">= </span><span class="s1">func</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">zpk2sos</span><span class="s2">(*</span><span class="s1">zpk</span><span class="s2">), </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s3">&quot;%s(4,...)&quot; </span><span class="s2">% </span><span class="s1">name</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIIRNotch</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compare coefficients with Matlab ones</span>
        <span class="s5"># for the equivalent input:</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iirnotch</span><span class="s2">(</span><span class="s4">0.06</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)</span>
        <span class="s1">b2 </span><span class="s2">= [</span>
             <span class="s4">9.9686824e-01</span><span class="s2">, -</span><span class="s4">1.9584219e+00</span><span class="s2">,</span>
             <span class="s4">9.9686824e-01</span>
             <span class="s2">]</span>
        <span class="s1">a2 </span><span class="s2">= [</span>
             <span class="s4">1.0000000e+00</span><span class="s2">, -</span><span class="s4">1.9584219e+00</span><span class="s2">,</span>
             <span class="s4">9.9373647e-01</span>
             <span class="s2">]</span>

        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-8</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-8</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_frequency_response</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Get filter coefficients</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iirnotch</span><span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)</span>

        <span class="s5"># Get frequency response</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">)</span>

        <span class="s5"># Pick 5 point</span>
        <span class="s1">p </span><span class="s2">= [</span><span class="s4">200</span><span class="s2">,  </span><span class="s5"># w0 = 0.200</span>
             <span class="s4">295</span><span class="s2">,  </span><span class="s5"># w0 = 0.295</span>
             <span class="s4">300</span><span class="s2">,  </span><span class="s5"># w0 = 0.300</span>
             <span class="s4">305</span><span class="s2">,  </span><span class="s5"># w0 = 0.305</span>
             <span class="s4">400</span><span class="s2">]  </span><span class="s5"># w0 = 0.400</span>

        <span class="s5"># Get frequency response correspondent to each of those points</span>
        <span class="s1">hp </span><span class="s2">= </span><span class="s1">h</span><span class="s2">[</span><span class="s1">p</span><span class="s2">]</span>

        <span class="s5"># Check if the frequency response fulfill the specifications:</span>
        <span class="s5"># hp[0] and hp[4]  correspond to frequencies distant from</span>
        <span class="s5"># w0 = 0.3 and should be close to 1</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">4</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

        <span class="s5"># hp[1] and hp[3] correspond to frequencies approximately</span>
        <span class="s5"># on the edges of the passband and should be close to -3dB</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

        <span class="s5"># hp[2] correspond to the frequency that should be removed</span>
        <span class="s5"># the frequency response should be very close to 0</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_errors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Exception should be raised if w0 &gt; 1 or w0 &lt;0</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirnotch</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirnotch</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">=-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>

        <span class="s5"># Exception should be raised if any of the parameters</span>
        <span class="s5"># are not float (or cannot be converted to one)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirnotch</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">=</span><span class="s3">&quot;blabla&quot;</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">iirnotch</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">=-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Get filter coefficients</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iirnotch</span><span class="s2">(</span><span class="s4">1500</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">10000</span><span class="s2">)</span>

        <span class="s5"># Get frequency response</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">10000</span><span class="s2">)</span>

        <span class="s5"># Pick 5 point</span>
        <span class="s1">p </span><span class="s2">= [</span><span class="s4">200</span><span class="s2">,  </span><span class="s5"># w0 = 1000</span>
             <span class="s4">295</span><span class="s2">,  </span><span class="s5"># w0 = 1475</span>
             <span class="s4">300</span><span class="s2">,  </span><span class="s5"># w0 = 1500</span>
             <span class="s4">305</span><span class="s2">,  </span><span class="s5"># w0 = 1525</span>
             <span class="s4">400</span><span class="s2">]  </span><span class="s5"># w0 = 2000</span>

        <span class="s5"># Get frequency response correspondent to each of those points</span>
        <span class="s1">hp </span><span class="s2">= </span><span class="s1">h</span><span class="s2">[</span><span class="s1">p</span><span class="s2">]</span>

        <span class="s5"># Check if the frequency response fulfill the specifications:</span>
        <span class="s5"># hp[0] and hp[4]  correspond to frequencies distant from</span>
        <span class="s5"># w0 = 1500 and should be close to 1</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">4</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

        <span class="s5"># hp[1] and hp[3] correspond to frequencies approximately</span>
        <span class="s5"># on the edges of the passband and should be close to -3dB</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

        <span class="s5"># hp[2] correspond to the frequency that should be removed</span>
        <span class="s5"># the frequency response should be very close to 0</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIIRPeak</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Compare coefficients with Matlab ones</span>
        <span class="s5"># for the equivalent input:</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iirpeak</span><span class="s2">(</span><span class="s4">0.06</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)</span>
        <span class="s1">b2 </span><span class="s2">= [</span>
             <span class="s4">3.131764229e-03</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
             <span class="s2">-</span><span class="s4">3.131764229e-03</span>
             <span class="s2">]</span>
        <span class="s1">a2 </span><span class="s2">= [</span>
             <span class="s4">1.0000000e+00</span><span class="s2">, -</span><span class="s4">1.958421917e+00</span><span class="s2">,</span>
             <span class="s4">9.9373647e-01</span>
             <span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-8</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-8</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_frequency_response</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Get filter coefficients</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iirpeak</span><span class="s2">(</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)</span>

        <span class="s5"># Get frequency response</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">)</span>

        <span class="s5"># Pick 5 point</span>
        <span class="s1">p </span><span class="s2">= [</span><span class="s4">30</span><span class="s2">,  </span><span class="s5"># w0 = 0.030</span>
             <span class="s4">295</span><span class="s2">,  </span><span class="s5"># w0 = 0.295</span>
             <span class="s4">300</span><span class="s2">,  </span><span class="s5"># w0 = 0.300</span>
             <span class="s4">305</span><span class="s2">,  </span><span class="s5"># w0 = 0.305</span>
             <span class="s4">800</span><span class="s2">]  </span><span class="s5"># w0 = 0.800</span>

        <span class="s5"># Get frequency response correspondent to each of those points</span>
        <span class="s1">hp </span><span class="s2">= </span><span class="s1">h</span><span class="s2">[</span><span class="s1">p</span><span class="s2">]</span>

        <span class="s5"># Check if the frequency response fulfill the specifications:</span>
        <span class="s5"># hp[0] and hp[4]  correspond to frequencies distant from</span>
        <span class="s5"># w0 = 0.3 and should be close to 0</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">4</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

        <span class="s5"># hp[1] and hp[3] correspond to frequencies approximately</span>
        <span class="s5"># on the edges of the passband and should be close to 10**(-3/20)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

        <span class="s5"># hp[2] correspond to the frequency that should be retained and</span>
        <span class="s5"># the frequency response should be very close to 1</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_errors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Exception should be raised if w0 &gt; 1 or w0 &lt;0</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirpeak</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirpeak</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">=-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>

        <span class="s5"># Exception should be raised if any of the parameters</span>
        <span class="s5"># are not float (or cannot be converted to one)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirpeak</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">=</span><span class="s3">&quot;blabla&quot;</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">iirpeak</span><span class="s2">, </span><span class="s1">w0</span><span class="s2">=-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Get filter coefficients</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iirpeak</span><span class="s2">(</span><span class="s4">1200</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">8000</span><span class="s2">)</span>

        <span class="s5"># Get frequency response</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">h </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">8000</span><span class="s2">)</span>

        <span class="s5"># Pick 5 point</span>
        <span class="s1">p </span><span class="s2">= [</span><span class="s4">30</span><span class="s2">,  </span><span class="s5"># w0 = 120</span>
             <span class="s4">295</span><span class="s2">,  </span><span class="s5"># w0 = 1180</span>
             <span class="s4">300</span><span class="s2">,  </span><span class="s5"># w0 = 1200</span>
             <span class="s4">305</span><span class="s2">,  </span><span class="s5"># w0 = 1220</span>
             <span class="s4">800</span><span class="s2">]  </span><span class="s5"># w0 = 3200</span>

        <span class="s5"># Get frequency response correspondent to each of those points</span>
        <span class="s1">hp </span><span class="s2">= </span><span class="s1">h</span><span class="s2">[</span><span class="s1">p</span><span class="s2">]</span>

        <span class="s5"># Check if the frequency response fulfill the specifications:</span>
        <span class="s5"># hp[0] and hp[4]  correspond to frequencies distant from</span>
        <span class="s5"># w0 = 1200 and should be close to 0</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">4</span><span class="s2">]), </span><span class="s4">0</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

        <span class="s5"># hp[1] and hp[3] correspond to frequencies approximately</span>
        <span class="s5"># on the edges of the passband and should be close to 10**(-3/20)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s4">2</span><span class="s2">), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

        <span class="s5"># hp[2] correspond to the frequency that should be retained and</span>
        <span class="s5"># the frequency response should be very close to 1</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIIRComb</span><span class="s2">:</span>
    <span class="s5"># Test erroneous input cases</span>
    <span class="s0">def </span><span class="s1">test_invalid_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># w0 is &lt;= 0 or &gt;= fs / 2</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">[(-</span><span class="s1">fs</span><span class="s2">, </span><span class="s4">30</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">35</span><span class="s2">), (</span><span class="s1">fs </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">, </span><span class="s4">40</span><span class="s2">), (</span><span class="s1">fs</span><span class="s2">, </span><span class="s4">35</span><span class="s2">)]:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'w0 must be between '</span><span class="s2">):</span>
                <span class="s1">iircomb</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>

        <span class="s5"># fs is not divisible by w0</span>
        <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">120</span><span class="s2">, </span><span class="s4">30</span><span class="s2">), (</span><span class="s4">157</span><span class="s2">, </span><span class="s4">35</span><span class="s2">)]:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'fs must be divisible '</span><span class="s2">):</span>
                <span class="s1">iircomb</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>

        <span class="s5"># https://github.com/scipy/scipy/issues/14043#issuecomment-1107349140</span>
        <span class="s5"># Previously, fs=44100, w0=49.999 was rejected, but fs=2,</span>
        <span class="s5"># w0=49.999/int(44100/2) was accepted. Now it is rejected, too.</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'fs must be divisible '</span><span class="s2">):</span>
            <span class="s1">iircomb</span><span class="s2">(</span><span class="s1">w0</span><span class="s2">=</span><span class="s4">49.999</span><span class="s2">/</span><span class="s1">int</span><span class="s2">(</span><span class="s4">44100</span><span class="s2">/</span><span class="s4">2</span><span class="s2">), </span><span class="s1">Q</span><span class="s2">=</span><span class="s4">30</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'fs must be divisible '</span><span class="s2">):</span>
            <span class="s1">iircomb</span><span class="s2">(</span><span class="s1">w0</span><span class="s2">=</span><span class="s4">49.999</span><span class="s2">, </span><span class="s1">Q</span><span class="s2">=</span><span class="s4">30</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">44100</span><span class="s2">)</span>

        <span class="s5"># Filter type is not notch or peak</span>
        <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s3">'natch'</span><span class="s2">), (</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">35</span><span class="s2">, </span><span class="s3">'comb'</span><span class="s2">)]:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'ftype must be '</span><span class="s2">):</span>
                <span class="s1">iircomb</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>

    <span class="s5"># Verify that the filter's frequency response contains a</span>
    <span class="s5"># notch at the cutoff frequency</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'ftype'</span><span class="s2">, (</span><span class="s3">'notch'</span><span class="s2">, </span><span class="s3">'peak'</span><span class="s2">))</span>
    <span class="s0">def </span><span class="s1">test_frequency_response</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">):</span>
        <span class="s5"># Create a notching or peaking comb filter at 1000 Hz</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iircomb</span><span class="s2">(</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">=</span><span class="s1">ftype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">10000</span><span class="s2">)</span>

        <span class="s5"># Compute the frequency response</span>
        <span class="s1">freqs</span><span class="s2">, </span><span class="s1">response </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">10000</span><span class="s2">)</span>

        <span class="s5"># Find the notch using argrelextrema</span>
        <span class="s1">comb_points </span><span class="s2">= </span><span class="s1">argrelextrema</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">response</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">less</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">]</span>

        <span class="s5"># Verify that the first notch sits at 1000 Hz</span>
        <span class="s1">comb1 </span><span class="s2">= </span><span class="s1">comb_points</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">freqs</span><span class="s2">[</span><span class="s1">comb1</span><span class="s2">], </span><span class="s4">1000</span><span class="s2">)</span>

    <span class="s5"># Verify pass_zero parameter</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'ftype,pass_zero,peak,notch'</span><span class="s2">,</span>
                             <span class="s2">[(</span><span class="s3">'peak'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s4">123.45</span><span class="s2">, </span><span class="s4">61.725</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s3">'peak'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">61.725</span><span class="s2">, </span><span class="s4">123.45</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s3">'peak'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s4">61.725</span><span class="s2">, </span><span class="s4">123.45</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s3">'notch'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s4">61.725</span><span class="s2">, </span><span class="s4">123.45</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s3">'notch'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s4">123.45</span><span class="s2">, </span><span class="s4">61.725</span><span class="s2">),</span>
                              <span class="s2">(</span><span class="s3">'notch'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s4">61.725</span><span class="s2">, </span><span class="s4">123.45</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_pass_zero</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">, </span><span class="s1">pass_zero</span><span class="s2">, </span><span class="s1">peak</span><span class="s2">, </span><span class="s1">notch</span><span class="s2">):</span>
        <span class="s5"># Create a notching or peaking comb filter</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iircomb</span><span class="s2">(</span><span class="s4">123.45</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">=</span><span class="s1">ftype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">1234.5</span><span class="s2">, </span><span class="s1">pass_zero</span><span class="s2">=</span><span class="s1">pass_zero</span><span class="s2">)</span>

        <span class="s5"># Compute the frequency response</span>
        <span class="s1">freqs</span><span class="s2">, </span><span class="s1">response </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, [</span><span class="s1">peak</span><span class="s2">, </span><span class="s1">notch</span><span class="s2">], </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">1234.5</span><span class="s2">)</span>

        <span class="s5"># Verify that expected notches are notches and peaks are peaks</span>
        <span class="s0">assert </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">response</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]) &gt; </span><span class="s4">0.99</span>
        <span class="s0">assert </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">response</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]) &lt; </span><span class="s4">1e-10</span>

    <span class="s5"># All built-in IIR filters are real, so should have perfectly</span>
    <span class="s5"># symmetrical poles and zeros. Then ba representation (using</span>
    <span class="s5"># numpy.poly) will be purely real instead of having negligible</span>
    <span class="s5"># imaginary parts.</span>
    <span class="s0">def </span><span class="s1">test_iir_symmetry</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iircomb</span><span class="s2">(</span><span class="s4">400</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">24000</span><span class="s2">)</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">tf2zpk</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">()))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">()))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">real</span><span class="s2">(</span><span class="s1">k</span><span class="s2">))</span>

        <span class="s0">assert </span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">)</span>

    <span class="s5"># Verify filter coefficients with MATLAB's iircomb function</span>
    <span class="s0">def </span><span class="s1">test_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b_notch</span><span class="s2">, </span><span class="s1">a_notch </span><span class="s2">= </span><span class="s1">iircomb</span><span class="s2">(</span><span class="s4">60</span><span class="s2">, </span><span class="s4">35</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">=</span><span class="s3">'notch'</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">600</span><span class="s2">)</span>
        <span class="s1">b_notch2 </span><span class="s2">= [</span><span class="s4">0.957020174408697</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">,</span>
                    <span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, -</span><span class="s4">0.957020174408697</span><span class="s2">]</span>
        <span class="s1">a_notch2 </span><span class="s2">= [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">,</span>
                    <span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, -</span><span class="s4">0.914040348817395</span><span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b_notch</span><span class="s2">, </span><span class="s1">b_notch2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a_notch</span><span class="s2">, </span><span class="s1">a_notch2</span><span class="s2">)</span>

        <span class="s1">b_peak</span><span class="s2">, </span><span class="s1">a_peak </span><span class="s2">= </span><span class="s1">iircomb</span><span class="s2">(</span><span class="s4">60</span><span class="s2">, </span><span class="s4">35</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">=</span><span class="s3">'peak'</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">600</span><span class="s2">)</span>
        <span class="s1">b_peak2 </span><span class="s2">= [</span><span class="s4">0.0429798255913026</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">,</span>
                   <span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, -</span><span class="s4">0.0429798255913026</span><span class="s2">]</span>
        <span class="s1">a_peak2 </span><span class="s2">= [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">,</span>
                   <span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">0.914040348817395</span><span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b_peak</span><span class="s2">, </span><span class="s1">b_peak2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a_peak</span><span class="s2">, </span><span class="s1">a_peak2</span><span class="s2">)</span>

    <span class="s5"># Verify that https://github.com/scipy/scipy/issues/14043 is fixed</span>
    <span class="s0">def </span><span class="s1">test_nearest_divisor</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Create a notching comb filter</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iircomb</span><span class="s2">(</span><span class="s4">50</span><span class="s2">/</span><span class="s1">int</span><span class="s2">(</span><span class="s4">44100</span><span class="s2">/</span><span class="s4">2</span><span class="s2">), </span><span class="s4">50.0</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">=</span><span class="s3">'notch'</span><span class="s2">)</span>

        <span class="s5"># Compute the frequency response at an upper harmonic of 50</span>
        <span class="s1">freqs</span><span class="s2">, </span><span class="s1">response </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, [</span><span class="s4">22000</span><span class="s2">], </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">44100</span><span class="s2">)</span>

        <span class="s5"># Before bug fix, this would produce N = 881, so that 22 kHz was ~0 dB.</span>
        <span class="s5"># Now N = 882 correctly and 22 kHz should be a notch &lt;-220 dB</span>
        <span class="s0">assert </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">response</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]) &lt; </span><span class="s4">1e-10</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">iircomb</span><span class="s2">(</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*be none&quot;</span><span class="s2">):</span>
            <span class="s1">iircomb</span><span class="s2">(</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestIIRDesign</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_exceptions</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;the same shape&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">0.2</span><span class="s2">, [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;the same shape&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">]]),</span>
                      <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], [</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]]), </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>

        <span class="s5"># discrete filter with non-positive frequency</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, -</span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>

        <span class="s5"># analog filter with negative frequency</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, -</span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [-</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, -</span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

        <span class="s5"># discrete filter with fs=None, freq &gt; 1</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than 1&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.5</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>

        <span class="s5"># discrete filter with fs&gt;2, wp, ws &lt; fs/2 must pass</span>
        <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">500</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">200</span><span class="s2">, </span><span class="s4">400</span><span class="s2">], [</span><span class="s4">100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">], [</span><span class="s4">200</span><span class="s2">, </span><span class="s4">400</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>

        <span class="s5"># discrete filter with fs&gt;2, freq &gt; fs/2: this must raise</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">400</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">1100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">(</span><span class="s4">100</span><span class="s2">, </span><span class="s4">1100</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">400</span><span class="s2">], [</span><span class="s4">100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">1100</span><span class="s2">, </span><span class="s4">400</span><span class="s2">], [</span><span class="s4">100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">200</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">], [</span><span class="s4">100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">200</span><span class="s2">, </span><span class="s4">1100</span><span class="s2">], [</span><span class="s4">100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">200</span><span class="s2">, </span><span class="s4">400</span><span class="s2">], [</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">500</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">200</span><span class="s2">, </span><span class="s4">400</span><span class="s2">], [</span><span class="s4">1100</span><span class="s2">, </span><span class="s4">500</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">200</span><span class="s2">, </span><span class="s4">400</span><span class="s2">], [</span><span class="s4">100</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be less than fs/2&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">200</span><span class="s2">, </span><span class="s4">400</span><span class="s2">], [</span><span class="s4">100</span><span class="s2">, </span><span class="s4">1100</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">2000</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;strictly inside stopband&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">], [</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;strictly inside stopband&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;strictly inside stopband&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], [</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;strictly inside stopband&quot;</span><span class="s2">):</span>
            <span class="s1">iirdesign</span><span class="s2">([</span><span class="s4">0.4</span><span class="s2">, </span><span class="s4">0.7</span><span class="s2">], [</span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.6</span><span class="s2">], </span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">&quot;low&quot;</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestIIRFilter</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_symmetry</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># All built-in IIR filters are real, so should have perfectly</span>
        <span class="s5"># symmetrical poles and zeros. Then ba representation (using</span>
        <span class="s5"># numpy.poly) will be purely real instead of having negligible</span>
        <span class="s5"># imaginary parts.</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">26</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">ftype </span><span class="s0">in </span><span class="s2">(</span><span class="s3">'butter'</span><span class="s2">, </span><span class="s3">'bessel'</span><span class="s2">, </span><span class="s3">'cheby1'</span><span class="s2">, </span><span class="s3">'cheby2'</span><span class="s2">, </span><span class="s3">'ellip'</span><span class="s2">):</span>
                <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">iirfilter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                    <span class="s1">ftype</span><span class="s2">=</span><span class="s1">ftype</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)</span>
                <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">()))</span>
                <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">()))</span>
                <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">real</span><span class="s2">(</span><span class="s1">k</span><span class="s2">))</span>

                <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">iirfilter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">, </span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                 <span class="s1">ftype</span><span class="s2">=</span><span class="s1">ftype</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'ba'</span><span class="s2">)</span>
                <span class="s1">assert_</span><span class="s2">(</span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">))</span>
                <span class="s1">assert_</span><span class="s2">(</span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_int_inputs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Using integer frequency arguments and large N should not produce</span>
        <span class="s5"># numpy integers that wraparound to negative numbers</span>
        <span class="s1">k </span><span class="s2">= </span><span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">24</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">=</span><span class="s3">'bessel'</span><span class="s2">,</span>
                      <span class="s1">output</span><span class="s2">=</span><span class="s3">'zpk'</span><span class="s2">)[</span><span class="s4">2</span><span class="s2">]</span>
        <span class="s1">k2 </span><span class="s2">= </span><span class="s4">9.999999999999989e+47</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">k2</span><span class="s2">)</span>
        <span class="s5"># if fs is specified then the normalization of Wn to have </span>
        <span class="s5"># 0 &lt;= Wn &lt;= 1 should not cause an integer overflow</span>
        <span class="s5"># the following line should not raise an exception</span>
        <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">20</span><span class="s2">, [</span><span class="s4">1000000000</span><span class="s2">, </span><span class="s4">1100000000</span><span class="s2">], </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'bp'</span><span class="s2">, </span>
                      <span class="s1">analog</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">6250000000</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_invalid_wn_size</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># low and high have 1 Wn, band and stop have 2 Wn</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">], </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'low'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'high'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'bp'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">400</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'bs'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_invalid_wn_range</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># For digital filters, 0 &lt;= Wn &lt;= 1</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'low'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'band'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">], </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'band'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'high'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'band'</span><span class="s2">)</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">iirfilter</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, [</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">], </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'stop'</span><span class="s2">)</span>

        <span class="s5"># analog=True with non-positive critical frequencies</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">100</span><span class="s2">], </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">100</span><span class="s2">], </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, [</span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;must be greater than 0&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, [</span><span class="s4">10</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">], </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_analog_sos</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># first order Butterworth filter with Wn = 1 has tf 1/(s+1)</span>
        <span class="s1">sos </span><span class="s2">= [[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">]]</span>
        <span class="s1">sos2 </span><span class="s2">= </span><span class="s1">iirfilter</span><span class="s2">(</span><span class="s1">N</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">Wn</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">btype</span><span class="s2">=</span><span class="s3">'low'</span><span class="s2">, </span><span class="s1">analog</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">output</span><span class="s2">=</span><span class="s3">'sos'</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">sos</span><span class="s2">, </span><span class="s1">sos2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_wn1_ge_wn0</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># gh-15773: should raise error if Wn[0] &gt;= Wn[1]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s3">r&quot;Wn\[0\] must be less than Wn\[1\]&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, [</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">])</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s3">r&quot;Wn\[0\] must be less than Wn\[1\]&quot;</span><span class="s2">):</span>
            <span class="s1">iirfilter</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, [</span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestGroupDelay</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_identity_filter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">gd </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">512</span><span class="s2">) / </span><span class="s4">512</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">gd</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s4">512</span><span class="s2">))</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">gd </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">whole</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s4">2 </span><span class="s2">* </span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">512</span><span class="s2">) / </span><span class="s4">512</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">gd</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s4">512</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_fir</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Let's design linear phase FIR and check that the group delay</span>
        <span class="s5"># is constant.</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">100</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">firwin</span><span class="s2">(</span><span class="s1">N </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">gd </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s1">b</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">gd</span><span class="s2">, </span><span class="s4">0.5 </span><span class="s2">* </span><span class="s1">N</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_iir</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Let's design Butterworth filter and test the group delay at</span>
        <span class="s5"># some points against MATLAB answer.</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">gd </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">), </span><span class="s1">w</span><span class="s2">=</span><span class="s1">w</span><span class="s2">)</span>
        <span class="s1">matlab_gd </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">8.249313898506037</span><span class="s2">, </span><span class="s4">11.958947880907104</span><span class="s2">,</span>
                              <span class="s4">2.452325615326005</span><span class="s2">, </span><span class="s4">1.048918665702008</span><span class="s2">,</span>
                              <span class="s4">0.611382575635897</span><span class="s2">, </span><span class="s4">0.418293269460578</span><span class="s2">,</span>
                              <span class="s4">0.317932917836572</span><span class="s2">, </span><span class="s4">0.261371844762525</span><span class="s2">,</span>
                              <span class="s4">0.229038045801298</span><span class="s2">, </span><span class="s4">0.212185774208521</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">gd</span><span class="s2">, </span><span class="s1">matlab_gd</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_singular</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Let's create a filter with zeros and poles on the unit circle and</span>
        <span class="s5"># check if warnings are raised at those frequencies.</span>
        <span class="s1">z1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s4">1j </span><span class="s2">* </span><span class="s4">0.1 </span><span class="s2">* </span><span class="s1">pi</span><span class="s2">)</span>
        <span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s4">1j </span><span class="s2">* </span><span class="s4">0.25 </span><span class="s2">* </span><span class="s1">pi</span><span class="s2">)</span>
        <span class="s1">p1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s4">1j </span><span class="s2">* </span><span class="s4">0.5 </span><span class="s2">* </span><span class="s1">pi</span><span class="s2">)</span>
        <span class="s1">p2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s4">1j </span><span class="s2">* </span><span class="s4">0.8 </span><span class="s2">* </span><span class="s1">pi</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">convolve</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, -</span><span class="s1">z1</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, -</span><span class="s1">z2</span><span class="s2">])</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">convolve</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, -</span><span class="s1">p1</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, -</span><span class="s1">p2</span><span class="s2">])</span>
        <span class="s1">w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.1 </span><span class="s2">* </span><span class="s1">pi</span><span class="s2">, </span><span class="s4">0.25 </span><span class="s2">* </span><span class="s1">pi</span><span class="s2">, -</span><span class="s4">0.5 </span><span class="s2">* </span><span class="s1">pi</span><span class="s2">, -</span><span class="s4">0.8 </span><span class="s2">* </span><span class="s1">pi</span><span class="s2">])</span>

        <span class="s1">w</span><span class="s2">, </span><span class="s1">gd </span><span class="s2">= </span><span class="s1">assert_warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">group_delay</span><span class="s2">, (</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">), </span><span class="s1">w</span><span class="s2">=</span><span class="s1">w</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_backward_compat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># For backward compatibility, test if None act as a wrapper for default</span>
        <span class="s1">w1</span><span class="s2">, </span><span class="s1">gd1 </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
        <span class="s1">w2</span><span class="s2">, </span><span class="s1">gd2 </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">gd1</span><span class="s2">, </span><span class="s1">gd2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_param</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Let's design Butterworth filter and test the group delay at</span>
        <span class="s5"># some points against the normalized frequency answer.</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">butter</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4800</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">96000</span><span class="s2">)</span>
        <span class="s1">w </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">96000</span><span class="s2">/</span><span class="s4">2</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">w</span><span class="s2">, </span><span class="s1">gd </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">), </span><span class="s1">w</span><span class="s2">=</span><span class="s1">w</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">96000</span><span class="s2">)</span>
        <span class="s1">norm_gd </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">8.249313898506037</span><span class="s2">, </span><span class="s4">11.958947880907104</span><span class="s2">,</span>
                            <span class="s4">2.452325615326005</span><span class="s2">, </span><span class="s4">1.048918665702008</span><span class="s2">,</span>
                            <span class="s4">0.611382575635897</span><span class="s2">, </span><span class="s4">0.418293269460578</span><span class="s2">,</span>
                            <span class="s4">0.317932917836572</span><span class="s2">, </span><span class="s4">0.261371844762525</span><span class="s2">,</span>
                            <span class="s4">0.229038045801298</span><span class="s2">, </span><span class="s4">0.212185774208521</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">gd</span><span class="s2">, </span><span class="s1">norm_gd</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_w_or_N_types</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Measure at 8 equally-spaced points</span>
        <span class="s0">for </span><span class="s1">N </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s4">8</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s4">8</span><span class="s2">),</span>
                  <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s4">8</span><span class="s2">)):</span>
            <span class="s1">w</span><span class="s2">, </span><span class="s1">gd </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">N</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w</span><span class="s2">, </span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">8</span><span class="s2">) / </span><span class="s4">8</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">gd</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s4">8</span><span class="s2">))</span>

        <span class="s5"># Measure at frequency 8 rad/sec</span>
        <span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s2">(</span><span class="s4">8.0</span><span class="s2">, </span><span class="s4">8.0</span><span class="s2">+</span><span class="s4">0j</span><span class="s2">):</span>
            <span class="s1">w_out</span><span class="s2">, </span><span class="s1">gd </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">w</span><span class="s2">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">w_out</span><span class="s2">, [</span><span class="s4">8</span><span class="s2">])</span>
            <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">gd</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_complex_coef</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># gh-19586: handle complex coef TFs</span>
        <span class="s5">#</span>
        <span class="s5"># for g(z) = (alpha*z+1)/(1+conjugate(alpha)), group delay is</span>
        <span class="s5"># given by function below.</span>
        <span class="s5">#</span>
        <span class="s5"># def gd_expr(w, alpha):</span>
        <span class="s5">#     num = 1j*(abs(alpha)**2-1)*np.exp(1j*w)</span>
        <span class="s5">#     den = (alpha*np.exp(1j*w)+1)*(np.exp(1j*w)+np.conj(alpha))</span>
        <span class="s5">#     return -np.imag(num/den)</span>

        <span class="s5"># arbitrary non-real alpha</span>
        <span class="s1">alpha </span><span class="s2">= -</span><span class="s4">0.6143077933232609</span><span class="s2">+</span><span class="s4">0.3355978770229421j</span>
        <span class="s5"># 8 points from from -pi to pi</span>
        <span class="s1">wref </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s4">3.141592653589793 </span><span class="s2">,</span>
                         <span class="s2">-</span><span class="s4">2.356194490192345 </span><span class="s2">,</span>
                         <span class="s2">-</span><span class="s4">1.5707963267948966</span><span class="s2">,</span>
                         <span class="s2">-</span><span class="s4">0.7853981633974483</span><span class="s2">,</span>
                         <span class="s4">0.                </span><span class="s2">,</span>
                         <span class="s4">0.7853981633974483</span><span class="s2">,</span>
                         <span class="s4">1.5707963267948966</span><span class="s2">,</span>
                         <span class="s4">2.356194490192345 </span><span class="s2">])</span>
        <span class="s1">gdref </span><span class="s2">=  </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.18759548150354619</span><span class="s2">,</span>
                        <span class="s4">0.17999770352712252</span><span class="s2">,</span>
                        <span class="s4">0.23598047471879877</span><span class="s2">,</span>
                        <span class="s4">0.46539443069907194</span><span class="s2">,</span>
                        <span class="s4">1.9511492420564165 </span><span class="s2">,</span>
                        <span class="s4">3.478129975138865  </span><span class="s2">,</span>
                        <span class="s4">0.6228594960517333 </span><span class="s2">,</span>
                        <span class="s4">0.27067831839471224</span><span class="s2">])</span>
        <span class="s1">b </span><span class="s2">= [</span><span class="s1">alpha</span><span class="s2">,</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">a </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">conjugate</span><span class="s2">(</span><span class="s1">alpha</span><span class="s2">)]</span>
        <span class="s1">gdtest </span><span class="s2">= </span><span class="s1">group_delay</span><span class="s2">((</span><span class="s1">b</span><span class="s2">,</span><span class="s1">a</span><span class="s2">), </span><span class="s1">wref</span><span class="s2">)[</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s5"># need nulp=14 for macOS arm64 wheel builds; added 2 for some</span>
        <span class="s5"># robustness on other platforms.</span>
        <span class="s1">assert_array_almost_equal_nulp</span><span class="s2">(</span><span class="s1">gdtest</span><span class="s2">, </span><span class="s1">gdref</span><span class="s2">, </span><span class="s1">nulp</span><span class="s2">=</span><span class="s4">16</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">group_delay</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*be none&quot;</span><span class="s2">):</span>
            <span class="s1">group_delay</span><span class="s2">((</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">fs</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestGammatone</span><span class="s2">:</span>
    <span class="s5"># Test erroneous input cases.</span>
    <span class="s0">def </span><span class="s1">test_invalid_input</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Cutoff frequency is &lt;= 0 or &gt;= fs / 2.</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">16000</span>
        <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">[(-</span><span class="s1">fs</span><span class="s2">, </span><span class="s3">'iir'</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s3">'fir'</span><span class="s2">), (</span><span class="s1">fs </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">, </span><span class="s3">'iir'</span><span class="s2">), (</span><span class="s1">fs</span><span class="s2">, </span><span class="s3">'fir'</span><span class="s2">)]:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'The frequency must be '</span>
                               <span class="s3">'between '</span><span class="s2">):</span>
                <span class="s1">gammatone</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>

        <span class="s5"># Filter type is not fir or iir</span>
        <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">440</span><span class="s2">, </span><span class="s3">'fie'</span><span class="s2">), (</span><span class="s4">220</span><span class="s2">, </span><span class="s3">'it'</span><span class="s2">)]:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'ftype must be '</span><span class="s2">):</span>
                <span class="s1">gammatone</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>

        <span class="s5"># Order is &lt;= 0 or &gt; 24 for FIR filter.</span>
        <span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">440</span><span class="s2">, </span><span class="s3">'fir'</span><span class="s2">, -</span><span class="s4">50</span><span class="s2">), (</span><span class="s4">220</span><span class="s2">, </span><span class="s3">'fir'</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), (</span><span class="s4">110</span><span class="s2">, </span><span class="s3">'fir'</span><span class="s2">, </span><span class="s4">25</span><span class="s2">),</span>
                     <span class="s2">(</span><span class="s4">55</span><span class="s2">, </span><span class="s3">'fir'</span><span class="s2">, </span><span class="s4">50</span><span class="s2">)]:</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">'Invalid order: '</span><span class="s2">):</span>
                <span class="s1">gammatone</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">numtaps</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>

    <span class="s5"># Verify that the filter's frequency response is approximately</span>
    <span class="s5"># 1 at the cutoff frequency.</span>
    <span class="s0">def </span><span class="s1">test_frequency_response</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fs </span><span class="s2">= </span><span class="s4">16000</span>
        <span class="s1">ftypes </span><span class="s2">= [</span><span class="s3">'fir'</span><span class="s2">, </span><span class="s3">'iir'</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">ftype </span><span class="s0">in </span><span class="s1">ftypes</span><span class="s2">:</span>
            <span class="s5"># Create a gammatone filter centered at 1000 Hz.</span>
            <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">gammatone</span><span class="s2">(</span><span class="s4">1000</span><span class="s2">, </span><span class="s1">ftype</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">fs</span><span class="s2">)</span>

            <span class="s5"># Calculate the frequency response.</span>
            <span class="s1">freqs</span><span class="s2">, </span><span class="s1">response </span><span class="s2">= </span><span class="s1">freqz</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>

            <span class="s5"># Determine peak magnitude of the response</span>
            <span class="s5"># and corresponding frequency.</span>
            <span class="s1">response_max </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">response</span><span class="s2">))</span>
            <span class="s1">freq_hz </span><span class="s2">= </span><span class="s1">freqs</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">argmax</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">response</span><span class="s2">))] / ((</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">) / </span><span class="s1">fs</span><span class="s2">)</span>

            <span class="s5"># Check that the peak magnitude is 1 and the frequency is 1000 Hz.</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">response_max</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">freq_hz</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-2</span><span class="s2">)</span>

    <span class="s5"># All built-in IIR filters are real, so should have perfectly</span>
    <span class="s5"># symmetrical poles and zeros. Then ba representation (using</span>
    <span class="s5"># numpy.poly) will be purely real instead of having negligible</span>
    <span class="s5"># imaginary parts.</span>
    <span class="s0">def </span><span class="s1">test_iir_symmetry</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">gammatone</span><span class="s2">(</span><span class="s4">440</span><span class="s2">, </span><span class="s3">'iir'</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">24000</span><span class="s2">)</span>
        <span class="s1">z</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">tf2zpk</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">()))</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">), </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">p</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">()))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">real</span><span class="s2">(</span><span class="s1">k</span><span class="s2">))</span>

        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floating</span><span class="s2">))</span>

    <span class="s5"># Verify FIR filter coefficients with the paper's</span>
    <span class="s5"># Mathematica implementation</span>
    <span class="s0">def </span><span class="s1">test_fir_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">gammatone</span><span class="s2">(</span><span class="s4">15</span><span class="s2">, </span><span class="s3">'fir'</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">)</span>
        <span class="s1">b2 </span><span class="s2">= [</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">2.2608075649884e-04</span><span class="s2">,</span>
              <span class="s4">1.5077903981357e-03</span><span class="s2">, </span><span class="s4">4.2033687753998e-03</span><span class="s2">,</span>
              <span class="s4">8.1508962726503e-03</span><span class="s2">, </span><span class="s4">1.2890059089154e-02</span><span class="s2">,</span>
              <span class="s4">1.7833890391666e-02</span><span class="s2">, </span><span class="s4">2.2392613558564e-02</span><span class="s2">,</span>
              <span class="s4">2.6055195863104e-02</span><span class="s2">, </span><span class="s4">2.8435872863284e-02</span><span class="s2">,</span>
              <span class="s4">2.9293319149544e-02</span><span class="s2">, </span><span class="s4">2.852976858014e-02</span><span class="s2">,</span>
              <span class="s4">2.6176557156294e-02</span><span class="s2">, </span><span class="s4">2.2371510270395e-02</span><span class="s2">,</span>
              <span class="s4">1.7332485267759e-02</span><span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b2</span><span class="s2">)</span>

    <span class="s5"># Verify IIR filter coefficients with the paper's MATLAB implementation</span>
    <span class="s0">def </span><span class="s1">test_iir_ba_output</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">b</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">gammatone</span><span class="s2">(</span><span class="s4">440</span><span class="s2">, </span><span class="s3">'iir'</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s4">16000</span><span class="s2">)</span>
        <span class="s1">b2 </span><span class="s2">= [</span><span class="s4">1.31494461367464e-06</span><span class="s2">, -</span><span class="s4">5.03391196645395e-06</span><span class="s2">,</span>
              <span class="s4">7.00649426000897e-06</span><span class="s2">, -</span><span class="s4">4.18951968419854e-06</span><span class="s2">,</span>
              <span class="s4">9.02614910412011e-07</span><span class="s2">]</span>
        <span class="s1">a2 </span><span class="s2">= [</span><span class="s4">1.0</span><span class="s2">, -</span><span class="s4">7.65646235454218</span><span class="s2">,</span>
              <span class="s4">25.7584699322366</span><span class="s2">, -</span><span class="s4">49.7319214483238</span><span class="s2">,</span>
              <span class="s4">60.2667361289181</span><span class="s2">, -</span><span class="s4">46.9399590980486</span><span class="s2">,</span>
              <span class="s4">22.9474798808461</span><span class="s2">, -</span><span class="s4">6.43799381299034</span><span class="s2">,</span>
              <span class="s4">0.793651554625368</span><span class="s2">]</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">b2</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fs_validation</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Sampling.*single scalar&quot;</span><span class="s2">):</span>
            <span class="s1">gammatone</span><span class="s2">(</span><span class="s4">440</span><span class="s2">, </span><span class="s3">'iir'</span><span class="s2">, </span><span class="s1">fs</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">20</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestOrderFilter</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_doc_example</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">25</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">domain </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">identity</span><span class="s2">(</span><span class="s4">3</span><span class="s2">)</span>

        <span class="s5"># minimum of elements 1,3,9 (zero-padded) on phone pad</span>
        <span class="s5"># 7,5,3 on numpad</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">5.</span><span class="s2">, </span><span class="s4">6.</span><span class="s2">, </span><span class="s4">7.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">, </span><span class="s4">11.</span><span class="s2">, </span><span class="s4">12.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">]],</span>
        <span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">order_filter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">domain</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s5"># maximum of elements 1,3,9 (zero-padded) on phone pad</span>
        <span class="s5"># 7,5,3 on numpad</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s4">6.</span><span class="s2">, </span><span class="s4">7.</span><span class="s2">, </span><span class="s4">8.</span><span class="s2">, </span><span class="s4">9.</span><span class="s2">, </span><span class="s4">4.</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">11.</span><span class="s2">, </span><span class="s4">12.</span><span class="s2">, </span><span class="s4">13.</span><span class="s2">, </span><span class="s4">14.</span><span class="s2">, </span><span class="s4">9.</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">16.</span><span class="s2">, </span><span class="s4">17.</span><span class="s2">, </span><span class="s4">18.</span><span class="s2">, </span><span class="s4">19.</span><span class="s2">, </span><span class="s4">14.</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">21.</span><span class="s2">, </span><span class="s4">22.</span><span class="s2">, </span><span class="s4">23.</span><span class="s2">, </span><span class="s4">24.</span><span class="s2">, </span><span class="s4">19.</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">20.</span><span class="s2">, </span><span class="s4">21.</span><span class="s2">, </span><span class="s4">22.</span><span class="s2">, </span><span class="s4">23.</span><span class="s2">, </span><span class="s4">24.</span><span class="s2">]],</span>
        <span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">order_filter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">domain</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s5"># and, just to complete the set, median of zero-padded elements</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">13</span><span class="s2">, </span><span class="s4">8</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">15</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s4">18</span><span class="s2">, </span><span class="s4">13</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">15</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s4">18</span><span class="s2">]],</span>
        <span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">order_filter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">domain</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_medfilt_order_filter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">25</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>

        <span class="s5"># median of zero-padded elements 1,5,9 on phone pad</span>
        <span class="s5"># 7,5,3 on numpad</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">4</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">6</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">13</span><span class="s2">, </span><span class="s4">9</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">11</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s4">18</span><span class="s2">, </span><span class="s4">14</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s4">18</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]],</span>
        <span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">medfilt</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">assert_allclose</span><span class="s2">(</span>
            <span class="s1">order_filter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s4">4</span><span class="s2">),</span>
            <span class="s1">expected</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_order_filter_asymmetric</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">25</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">domain </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]],</span>
        <span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">13</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">15</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s4">18</span><span class="s2">]]</span>
        <span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">order_filter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">domain</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
            <span class="s2">[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">9</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">10</span><span class="s2">, </span><span class="s4">11</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">13</span><span class="s2">, </span><span class="s4">14</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">15</span><span class="s2">, </span><span class="s4">16</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s4">18</span><span class="s2">, </span><span class="s4">19</span><span class="s2">]]</span>
        <span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">order_filter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">domain</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>
</pre>
</body>
</html>