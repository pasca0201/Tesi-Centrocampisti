<html>
<head>
<title>format.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
format.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Internal module for formatting output data in csv, html, xml, 
and latex files. This module also applies to display formatting. 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">__future__ </span><span class="s2">import </span><span class="s1">annotations</span>

<span class="s2">from </span><span class="s1">collections</span><span class="s3">.</span><span class="s1">abc </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">Generator</span><span class="s3">,</span>
    <span class="s1">Hashable</span><span class="s3">,</span>
    <span class="s1">Mapping</span><span class="s3">,</span>
    <span class="s1">Sequence</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">contextlib </span><span class="s2">import </span><span class="s1">contextmanager</span>
<span class="s2">from </span><span class="s1">csv </span><span class="s2">import </span><span class="s1">QUOTE_NONE</span>
<span class="s2">from </span><span class="s1">decimal </span><span class="s2">import </span><span class="s1">Decimal</span>
<span class="s2">from </span><span class="s1">functools </span><span class="s2">import </span><span class="s1">partial</span>
<span class="s2">from </span><span class="s1">io </span><span class="s2">import </span><span class="s1">StringIO</span>
<span class="s2">import </span><span class="s1">math</span>
<span class="s2">import </span><span class="s1">re</span>
<span class="s2">from </span><span class="s1">shutil </span><span class="s2">import </span><span class="s1">get_terminal_size</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">TYPE_CHECKING</span><span class="s3">,</span>
    <span class="s1">Any</span><span class="s3">,</span>
    <span class="s1">Callable</span><span class="s3">,</span>
    <span class="s1">Final</span><span class="s3">,</span>
    <span class="s1">cast</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_config</span><span class="s3">.</span><span class="s1">config </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">get_option</span><span class="s3">,</span>
    <span class="s1">set_option</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs </span><span class="s2">import </span><span class="s1">lib</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">missing </span><span class="s2">import </span><span class="s1">NA</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">NaT</span><span class="s3">,</span>
    <span class="s1">Timedelta</span><span class="s3">,</span>
    <span class="s1">Timestamp</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs</span><span class="s3">.</span><span class="s1">nattype </span><span class="s2">import </span><span class="s1">NaTType</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">dtypes</span><span class="s3">.</span><span class="s1">common </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">is_complex_dtype</span><span class="s3">,</span>
    <span class="s1">is_float</span><span class="s3">,</span>
    <span class="s1">is_integer</span><span class="s3">,</span>
    <span class="s1">is_list_like</span><span class="s3">,</span>
    <span class="s1">is_numeric_dtype</span><span class="s3">,</span>
    <span class="s1">is_scalar</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">dtypes</span><span class="s3">.</span><span class="s1">dtypes </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">CategoricalDtype</span><span class="s3">,</span>
    <span class="s1">DatetimeTZDtype</span><span class="s3">,</span>
    <span class="s1">ExtensionDtype</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">dtypes</span><span class="s3">.</span><span class="s1">missing </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">isna</span><span class="s3">,</span>
    <span class="s1">notna</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">arrays </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">Categorical</span><span class="s3">,</span>
    <span class="s1">DatetimeArray</span><span class="s3">,</span>
    <span class="s1">ExtensionArray</span><span class="s3">,</span>
    <span class="s1">TimedeltaArray</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">arrays</span><span class="s3">.</span><span class="s1">string_ </span><span class="s2">import </span><span class="s1">StringDtype</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">base </span><span class="s2">import </span><span class="s1">PandasObject</span>
<span class="s2">import </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">common </span><span class="s2">as </span><span class="s1">com</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">indexes</span><span class="s3">.</span><span class="s1">api </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">Index</span><span class="s3">,</span>
    <span class="s1">MultiIndex</span><span class="s3">,</span>
    <span class="s1">PeriodIndex</span><span class="s3">,</span>
    <span class="s1">ensure_index</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">indexes</span><span class="s3">.</span><span class="s1">datetimes </span><span class="s2">import </span><span class="s1">DatetimeIndex</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">indexes</span><span class="s3">.</span><span class="s1">timedeltas </span><span class="s2">import </span><span class="s1">TimedeltaIndex</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">reshape</span><span class="s3">.</span><span class="s1">concat </span><span class="s2">import </span><span class="s1">concat</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">common </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">check_parent_directory</span><span class="s3">,</span>
    <span class="s1">stringify_path</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">formats </span><span class="s2">import </span><span class="s1">printing</span>

<span class="s2">if </span><span class="s1">TYPE_CHECKING</span><span class="s3">:</span>
    <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_typing </span><span class="s2">import </span><span class="s3">(</span>
        <span class="s1">ArrayLike</span><span class="s3">,</span>
        <span class="s1">Axes</span><span class="s3">,</span>
        <span class="s1">ColspaceArgType</span><span class="s3">,</span>
        <span class="s1">ColspaceType</span><span class="s3">,</span>
        <span class="s1">CompressionOptions</span><span class="s3">,</span>
        <span class="s1">FilePath</span><span class="s3">,</span>
        <span class="s1">FloatFormatType</span><span class="s3">,</span>
        <span class="s1">FormattersType</span><span class="s3">,</span>
        <span class="s1">IndexLabel</span><span class="s3">,</span>
        <span class="s1">SequenceNotStr</span><span class="s3">,</span>
        <span class="s1">StorageOptions</span><span class="s3">,</span>
        <span class="s1">WriteBuffer</span><span class="s3">,</span>
    <span class="s3">)</span>

    <span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s3">(</span>
        <span class="s1">DataFrame</span><span class="s3">,</span>
        <span class="s1">Series</span><span class="s3">,</span>
    <span class="s3">)</span>


<span class="s1">common_docstring</span><span class="s3">: </span><span class="s1">Final </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        buf : str, Path or StringIO-like, optional, default None 
            Buffer to write to. If None, the output is returned as a string. 
        columns : array-like, optional, default None 
            The subset of columns to write. Writes all columns by default. 
        col_space : %(col_space_type)s, optional 
            %(col_space)s. 
        header : %(header_type)s, optional 
            %(header)s. 
        index : bool, optional, default True 
            Whether to print index (row) labels. 
        na_rep : str, optional, default 'NaN' 
            String representation of ``NaN`` to use. 
        formatters : list, tuple or dict of one-param. functions, optional 
            Formatter functions to apply to columns' elements by position or 
            name. 
            The result of each function must be a unicode string. 
            List/tuple must be of length equal to the number of columns. 
        float_format : one-parameter function, optional, default None 
            Formatter function to apply to columns' elements if they are 
            floats. This function must return a unicode string and will be 
            applied only to the non-``NaN`` elements, with ``NaN`` being 
            handled by ``na_rep``. 
        sparsify : bool, optional, default True 
            Set to False for a DataFrame with a hierarchical index to print 
            every multiindex key at each row. 
        index_names : bool, optional, default True 
            Prints the names of the indexes. 
        justify : str, default None 
            How to justify the column labels. If None uses the option from 
            the print configuration (controlled by set_option), 'right' out 
            of the box. Valid values are 
 
            * left 
            * right 
            * center 
            * justify 
            * justify-all 
            * start 
            * end 
            * inherit 
            * match-parent 
            * initial 
            * unset. 
        max_rows : int, optional 
            Maximum number of rows to display in the console. 
        max_cols : int, optional 
            Maximum number of columns to display in the console. 
        show_dimensions : bool, default False 
            Display DataFrame dimensions (number of rows by number of columns). 
        decimal : str, default '.' 
            Character recognized as decimal separator, e.g. ',' in Europe. 
    &quot;&quot;&quot;</span>

<span class="s1">VALID_JUSTIFY_PARAMETERS </span><span class="s3">= (</span>
    <span class="s4">&quot;left&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;right&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;center&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;justify&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;justify-all&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;start&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;end&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;inherit&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;match-parent&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;initial&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;unset&quot;</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s1">return_docstring</span><span class="s3">: </span><span class="s1">Final </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
        Returns 
        ------- 
        str or None 
            If buf is None, returns the result as a string. Otherwise returns 
            None. 
    &quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">SeriesFormatter</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Implement the main logic of Series.to_string, which underlies 
    Series.__repr__. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">series</span><span class="s3">: </span><span class="s1">Series</span><span class="s3">,</span>
        <span class="s3">*,</span>
        <span class="s1">length</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s1">str </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">header</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">index</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">na_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaN&quot;</span><span class="s3">,</span>
        <span class="s1">name</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">float_format</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">dtype</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">max_rows</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">min_rows</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">series </span><span class="s3">= </span><span class="s1">series</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">buf </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep </span><span class="s3">= </span><span class="s1">na_rep</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">header </span><span class="s3">= </span><span class="s1">header</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">length </span><span class="s3">= </span><span class="s1">length</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">index </span><span class="s3">= </span><span class="s1">index</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows </span><span class="s3">= </span><span class="s1">max_rows</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">min_rows </span><span class="s3">= </span><span class="s1">min_rows</span>

        <span class="s2">if </span><span class="s1">float_format </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">float_format </span><span class="s3">= </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.float_format&quot;</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">float_format </span><span class="s3">= </span><span class="s1">float_format</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">dtype </span><span class="s3">= </span><span class="s1">dtype</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">adj </span><span class="s3">= </span><span class="s1">printing</span><span class="s3">.</span><span class="s1">get_adjustment</span><span class="s3">()</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">_chk_truncate</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">_chk_truncate</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_row_num</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None</span>

        <span class="s1">min_rows </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">min_rows</span>
        <span class="s1">max_rows </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows</span>
        <span class="s5"># truncation determined by max_rows, actual truncated number of rows</span>
        <span class="s5"># used below by min_rows</span>
        <span class="s1">is_truncated_vertically </span><span class="s3">= </span><span class="s1">max_rows </span><span class="s2">and </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">series</span><span class="s3">) &gt; </span><span class="s1">max_rows</span><span class="s3">)</span>
        <span class="s1">series </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">series</span>
        <span class="s2">if </span><span class="s1">is_truncated_vertically</span><span class="s3">:</span>
            <span class="s1">max_rows </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">int</span><span class="s3">, </span><span class="s1">max_rows</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">min_rows</span><span class="s3">:</span>
                <span class="s5"># if min_rows is set (not None or 0), set max_rows to minimum</span>
                <span class="s5"># of both</span>
                <span class="s1">max_rows </span><span class="s3">= </span><span class="s1">min</span><span class="s3">(</span><span class="s1">min_rows</span><span class="s3">, </span><span class="s1">max_rows</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">max_rows </span><span class="s3">== </span><span class="s6">1</span><span class="s3">:</span>
                <span class="s1">row_num </span><span class="s3">= </span><span class="s1">max_rows</span>
                <span class="s1">series </span><span class="s3">= </span><span class="s1">series</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[:</span><span class="s1">max_rows</span><span class="s3">]</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">row_num </span><span class="s3">= </span><span class="s1">max_rows </span><span class="s3">// </span><span class="s6">2</span>
                <span class="s1">series </span><span class="s3">= </span><span class="s1">concat</span><span class="s3">((</span><span class="s1">series</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[:</span><span class="s1">row_num</span><span class="s3">], </span><span class="s1">series</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[-</span><span class="s1">row_num</span><span class="s3">:]))</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_row_num </span><span class="s3">= </span><span class="s1">row_num</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_row_num </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_series </span><span class="s3">= </span><span class="s1">series</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">is_truncated_vertically </span><span class="s3">= </span><span class="s1">is_truncated_vertically</span>

    <span class="s2">def </span><span class="s1">_get_footer</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s1">name </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">series</span><span class="s3">.</span><span class="s1">name</span>
        <span class="s1">footer </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>

        <span class="s1">index </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">series</span><span class="s3">.</span><span class="s1">index</span>
        <span class="s2">if </span><span class="s3">(</span>
            <span class="s1">isinstance</span><span class="s3">(</span><span class="s1">index</span><span class="s3">, (</span><span class="s1">DatetimeIndex</span><span class="s3">, </span><span class="s1">PeriodIndex</span><span class="s3">, </span><span class="s1">TimedeltaIndex</span><span class="s3">))</span>
            <span class="s2">and </span><span class="s1">index</span><span class="s3">.</span><span class="s1">freq </span><span class="s2">is not None</span>
        <span class="s3">):</span>
            <span class="s1">footer </span><span class="s3">+= </span><span class="s4">f&quot;Freq: </span><span class="s2">{</span><span class="s1">index</span><span class="s3">.</span><span class="s1">freqstr</span><span class="s2">}</span><span class="s4">&quot;</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s2">is not False and </span><span class="s1">name </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">footer</span><span class="s3">:</span>
                <span class="s1">footer </span><span class="s3">+= </span><span class="s4">&quot;, &quot;</span>

            <span class="s1">series_name </span><span class="s3">= </span><span class="s1">printing</span><span class="s3">.</span><span class="s1">pprint_thing</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">escape_chars</span><span class="s3">=(</span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s2">\r</span><span class="s4">&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">))</span>
            <span class="s1">footer </span><span class="s3">+= </span><span class="s4">f&quot;Name: </span><span class="s2">{</span><span class="s1">series_name</span><span class="s2">}</span><span class="s4">&quot;</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">length </span><span class="s2">is True or </span><span class="s3">(</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">length </span><span class="s3">== </span><span class="s4">&quot;truncate&quot; </span><span class="s2">and </span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_truncated_vertically</span>
        <span class="s3">):</span>
            <span class="s2">if </span><span class="s1">footer</span><span class="s3">:</span>
                <span class="s1">footer </span><span class="s3">+= </span><span class="s4">&quot;, &quot;</span>
            <span class="s1">footer </span><span class="s3">+= </span><span class="s4">f&quot;Length: </span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">series</span><span class="s3">)</span><span class="s2">}</span><span class="s4">&quot;</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">dtype </span><span class="s2">is not False and </span><span class="s1">self</span><span class="s3">.</span><span class="s1">dtype </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">dtype_name </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_series</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s4">&quot;name&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">dtype_name</span><span class="s3">:</span>
                <span class="s2">if </span><span class="s1">footer</span><span class="s3">:</span>
                    <span class="s1">footer </span><span class="s3">+= </span><span class="s4">&quot;, &quot;</span>
                <span class="s1">footer </span><span class="s3">+= </span><span class="s4">f&quot;dtype: </span><span class="s2">{</span><span class="s1">printing</span><span class="s3">.</span><span class="s1">pprint_thing</span><span class="s3">(</span><span class="s1">dtype_name</span><span class="s3">)</span><span class="s2">}</span><span class="s4">&quot;</span>

        <span class="s5"># level infos are added to the end and in a new line, like it is done</span>
        <span class="s5"># for Categoricals</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_series</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">CategoricalDtype</span><span class="s3">):</span>
            <span class="s1">level_info </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_series</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">.</span><span class="s1">_get_repr_footer</span><span class="s3">()</span>
            <span class="s2">if </span><span class="s1">footer</span><span class="s3">:</span>
                <span class="s1">footer </span><span class="s3">+= </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span>
            <span class="s1">footer </span><span class="s3">+= </span><span class="s1">level_info</span>

        <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">footer</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_get_formatted_values</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s2">return </span><span class="s1">format_array</span><span class="s3">(</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_series</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">,</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s1">float_format</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format</span><span class="s3">,</span>
            <span class="s1">na_rep</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span><span class="s3">,</span>
            <span class="s1">leading_space</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">index</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">to_string</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s1">series </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_series</span>
        <span class="s1">footer </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_footer</span><span class="s3">()</span>

        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">series</span><span class="s3">) == </span><span class="s6">0</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">type</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">series</span><span class="s3">).</span><span class="s1">__name__</span><span class="s2">}</span><span class="s4">([], </span><span class="s2">{</span><span class="s1">footer</span><span class="s2">}</span><span class="s4">)&quot;</span>

        <span class="s1">index </span><span class="s3">= </span><span class="s1">series</span><span class="s3">.</span><span class="s1">index</span>
        <span class="s1">have_header </span><span class="s3">= </span><span class="s1">_has_names</span><span class="s3">(</span><span class="s1">index</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">index</span><span class="s3">, </span><span class="s1">MultiIndex</span><span class="s3">):</span>
            <span class="s1">fmt_index </span><span class="s3">= </span><span class="s1">index</span><span class="s3">.</span><span class="s1">_format_multi</span><span class="s3">(</span><span class="s1">include_names</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">sparsify</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
            <span class="s1">adj </span><span class="s3">= </span><span class="s1">printing</span><span class="s3">.</span><span class="s1">get_adjustment</span><span class="s3">()</span>
            <span class="s1">fmt_index </span><span class="s3">= </span><span class="s1">adj</span><span class="s3">.</span><span class="s1">adjoin</span><span class="s3">(</span><span class="s6">2</span><span class="s3">, *</span><span class="s1">fmt_index</span><span class="s3">).</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">fmt_index </span><span class="s3">= </span><span class="s1">index</span><span class="s3">.</span><span class="s1">_format_flat</span><span class="s3">(</span><span class="s1">include_name</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">fmt_values </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_formatted_values</span><span class="s3">()</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_truncated_vertically</span><span class="s3">:</span>
            <span class="s1">n_header_rows </span><span class="s3">= </span><span class="s6">0</span>
            <span class="s1">row_num </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_row_num</span>
            <span class="s1">row_num </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">int</span><span class="s3">, </span><span class="s1">row_num</span><span class="s3">)</span>
            <span class="s1">width </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">.</span><span class="s1">len</span><span class="s3">(</span><span class="s1">fmt_values</span><span class="s3">[</span><span class="s1">row_num </span><span class="s3">- </span><span class="s6">1</span><span class="s3">])</span>
            <span class="s2">if </span><span class="s1">width </span><span class="s3">&gt; </span><span class="s6">3</span><span class="s3">:</span>
                <span class="s1">dot_str </span><span class="s3">= </span><span class="s4">&quot;...&quot;</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">dot_str </span><span class="s3">= </span><span class="s4">&quot;..&quot;</span>
            <span class="s5"># Series uses mode=center because it has single value columns</span>
            <span class="s5"># DataFrame uses mode=left</span>
            <span class="s1">dot_str </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">.</span><span class="s1">justify</span><span class="s3">([</span><span class="s1">dot_str</span><span class="s3">], </span><span class="s1">width</span><span class="s3">, </span><span class="s1">mode</span><span class="s3">=</span><span class="s4">&quot;center&quot;</span><span class="s3">)[</span><span class="s6">0</span><span class="s3">]</span>
            <span class="s1">fmt_values</span><span class="s3">.</span><span class="s1">insert</span><span class="s3">(</span><span class="s1">row_num </span><span class="s3">+ </span><span class="s1">n_header_rows</span><span class="s3">, </span><span class="s1">dot_str</span><span class="s3">)</span>
            <span class="s1">fmt_index</span><span class="s3">.</span><span class="s1">insert</span><span class="s3">(</span><span class="s1">row_num </span><span class="s3">+ </span><span class="s6">1</span><span class="s3">, </span><span class="s4">&quot;&quot;</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">index</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">.</span><span class="s1">adjoin</span><span class="s3">(</span><span class="s6">3</span><span class="s3">, *[</span><span class="s1">fmt_index</span><span class="s3">[</span><span class="s6">1</span><span class="s3">:], </span><span class="s1">fmt_values</span><span class="s3">])</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">.</span><span class="s1">adjoin</span><span class="s3">(</span><span class="s6">3</span><span class="s3">, </span><span class="s1">fmt_values</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">header </span><span class="s2">and </span><span class="s1">have_header</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">fmt_index</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] + </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot; </span><span class="s3">+ </span><span class="s1">result</span>

        <span class="s2">if </span><span class="s1">footer</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">+= </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot; </span><span class="s3">+ </span><span class="s1">footer</span>

        <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">result</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">get_dataframe_repr_params</span><span class="s3">() </span><span class="s1">-&gt; dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Any</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot;Get the parameters used to repr(dataFrame) calls using DataFrame.to_string. 
 
    Supplying these parameters to DataFrame.to_string is equivalent to calling 
    ``repr(DataFrame)``. This is useful if you want to adjust the repr output. 
 
    .. versionadded:: 1.4.0 
 
    Example 
    ------- 
    &gt;&gt;&gt; import pandas as pd 
    &gt;&gt;&gt; 
    &gt;&gt;&gt; df = pd.DataFrame([[1, 2], [3, 4]]) 
    &gt;&gt;&gt; repr_params = pd.io.formats.format.get_dataframe_repr_params() 
    &gt;&gt;&gt; repr(df) == df.to_string(**repr_params) 
    True 
    &quot;&quot;&quot;</span>
    <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">formats </span><span class="s2">import </span><span class="s1">console</span>

    <span class="s2">if </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.expand_frame_repr&quot;</span><span class="s3">):</span>
        <span class="s1">line_width</span><span class="s3">, </span><span class="s1">_ </span><span class="s3">= </span><span class="s1">console</span><span class="s3">.</span><span class="s1">get_console_size</span><span class="s3">()</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">line_width </span><span class="s3">= </span><span class="s2">None</span>
    <span class="s2">return </span><span class="s3">{</span>
        <span class="s4">&quot;max_rows&quot;</span><span class="s3">: </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.max_rows&quot;</span><span class="s3">),</span>
        <span class="s4">&quot;min_rows&quot;</span><span class="s3">: </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.min_rows&quot;</span><span class="s3">),</span>
        <span class="s4">&quot;max_cols&quot;</span><span class="s3">: </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.max_columns&quot;</span><span class="s3">),</span>
        <span class="s4">&quot;max_colwidth&quot;</span><span class="s3">: </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.max_colwidth&quot;</span><span class="s3">),</span>
        <span class="s4">&quot;show_dimensions&quot;</span><span class="s3">: </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.show_dimensions&quot;</span><span class="s3">),</span>
        <span class="s4">&quot;line_width&quot;</span><span class="s3">: </span><span class="s1">line_width</span><span class="s3">,</span>
    <span class="s3">}</span>


<span class="s2">def </span><span class="s1">get_series_repr_params</span><span class="s3">() </span><span class="s1">-&gt; dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Any</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot;Get the parameters used to repr(Series) calls using Series.to_string. 
 
    Supplying these parameters to Series.to_string is equivalent to calling 
    ``repr(series)``. This is useful if you want to adjust the series repr output. 
 
    .. versionadded:: 1.4.0 
 
    Example 
    ------- 
    &gt;&gt;&gt; import pandas as pd 
    &gt;&gt;&gt; 
    &gt;&gt;&gt; ser = pd.Series([1, 2, 3, 4]) 
    &gt;&gt;&gt; repr_params = pd.io.formats.format.get_series_repr_params() 
    &gt;&gt;&gt; repr(ser) == ser.to_string(**repr_params) 
    True 
    &quot;&quot;&quot;</span>
    <span class="s1">width</span><span class="s3">, </span><span class="s1">height </span><span class="s3">= </span><span class="s1">get_terminal_size</span><span class="s3">()</span>
    <span class="s1">max_rows_opt </span><span class="s3">= </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.max_rows&quot;</span><span class="s3">)</span>
    <span class="s1">max_rows </span><span class="s3">= </span><span class="s1">height </span><span class="s2">if </span><span class="s1">max_rows_opt </span><span class="s3">== </span><span class="s6">0 </span><span class="s2">else </span><span class="s1">max_rows_opt</span>
    <span class="s1">min_rows </span><span class="s3">= </span><span class="s1">height </span><span class="s2">if </span><span class="s1">max_rows_opt </span><span class="s3">== </span><span class="s6">0 </span><span class="s2">else </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.min_rows&quot;</span><span class="s3">)</span>

    <span class="s2">return </span><span class="s3">{</span>
        <span class="s4">&quot;name&quot;</span><span class="s3">: </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s4">&quot;dtype&quot;</span><span class="s3">: </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s4">&quot;min_rows&quot;</span><span class="s3">: </span><span class="s1">min_rows</span><span class="s3">,</span>
        <span class="s4">&quot;max_rows&quot;</span><span class="s3">: </span><span class="s1">max_rows</span><span class="s3">,</span>
        <span class="s4">&quot;length&quot;</span><span class="s3">: </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.show_dimensions&quot;</span><span class="s3">),</span>
    <span class="s3">}</span>


<span class="s2">class </span><span class="s1">DataFrameFormatter</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Class for processing dataframe formatting options and data. 
 
    Used by DataFrame.to_string, which backs DataFrame.__repr__. 
    &quot;&quot;&quot;</span>

    <span class="s1">__doc__ </span><span class="s3">= </span><span class="s1">__doc__ </span><span class="s2">if </span><span class="s1">__doc__ </span><span class="s2">else </span><span class="s4">&quot;&quot;</span>
    <span class="s1">__doc__ </span><span class="s3">+= </span><span class="s1">common_docstring </span><span class="s3">+ </span><span class="s1">return_docstring</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">frame</span><span class="s3">: </span><span class="s1">DataFrame</span><span class="s3">,</span>
        <span class="s1">columns</span><span class="s3">: </span><span class="s1">Axes </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">col_space</span><span class="s3">: </span><span class="s1">ColspaceArgType </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">header</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s1">SequenceNotStr</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">index</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">na_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaN&quot;</span><span class="s3">,</span>
        <span class="s1">formatters</span><span class="s3">: </span><span class="s1">FormattersType </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">justify</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">float_format</span><span class="s3">: </span><span class="s1">FloatFormatType </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">sparsify</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">index_names</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">max_rows</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">min_rows</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">max_cols</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">show_dimensions</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s1">str </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">decimal</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;.&quot;</span><span class="s3">,</span>
        <span class="s1">bold_rows</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">escape</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">frame </span><span class="s3">= </span><span class="s1">frame</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">columns </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_initialize_columns</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">col_space </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_initialize_colspace</span><span class="s3">(</span><span class="s1">col_space</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">header </span><span class="s3">= </span><span class="s1">header</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">index </span><span class="s3">= </span><span class="s1">index</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep </span><span class="s3">= </span><span class="s1">na_rep</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">formatters </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_initialize_formatters</span><span class="s3">(</span><span class="s1">formatters</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">justify </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_initialize_justify</span><span class="s3">(</span><span class="s1">justify</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">float_format </span><span class="s3">= </span><span class="s1">float_format</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">sparsify </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_initialize_sparsify</span><span class="s3">(</span><span class="s1">sparsify</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">show_index_names </span><span class="s3">= </span><span class="s1">index_names</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">decimal </span><span class="s3">= </span><span class="s1">decimal</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">bold_rows </span><span class="s3">= </span><span class="s1">bold_rows</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">escape </span><span class="s3">= </span><span class="s1">escape</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows </span><span class="s3">= </span><span class="s1">max_rows</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">min_rows </span><span class="s3">= </span><span class="s1">min_rows</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols </span><span class="s3">= </span><span class="s1">max_cols</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">show_dimensions </span><span class="s3">= </span><span class="s1">show_dimensions</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols_fitted </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_calc_max_cols_fitted</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows_fitted </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_calc_max_rows_fitted</span><span class="s3">()</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">truncate</span><span class="s3">()</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">adj </span><span class="s3">= </span><span class="s1">printing</span><span class="s3">.</span><span class="s1">get_adjustment</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">get_strcols</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]]:</span>
        <span class="s0">&quot;&quot;&quot; 
        Render a DataFrame to a list of columns (as lists of strings). 
        &quot;&quot;&quot;</span>
        <span class="s1">strcols </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_strcols_without_index</span><span class="s3">()</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">index</span><span class="s3">:</span>
            <span class="s1">str_index </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_formatted_index</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">)</span>
            <span class="s1">strcols</span><span class="s3">.</span><span class="s1">insert</span><span class="s3">(</span><span class="s6">0</span><span class="s3">, </span><span class="s1">str_index</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">strcols</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">should_show_dimensions</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">show_dimensions </span><span class="s2">is True or </span><span class="s3">(</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">show_dimensions </span><span class="s3">== </span><span class="s4">&quot;truncate&quot; </span><span class="s2">and </span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_truncated</span>
        <span class="s3">)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">is_truncated</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">bool</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_truncated_horizontally </span><span class="s2">or </span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_truncated_vertically</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">is_truncated_horizontally</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">bool</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols_fitted </span><span class="s2">and </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">) &gt; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols_fitted</span><span class="s3">))</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">is_truncated_vertically</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">bool</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows_fitted </span><span class="s2">and </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">) &gt; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows_fitted</span><span class="s3">))</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">dimensions_info</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s4">f&quot;</span><span class="s2">\n\n</span><span class="s4">[</span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">)</span><span class="s2">} </span><span class="s4">rows x </span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">)</span><span class="s2">} </span><span class="s4">columns]&quot;</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">has_index_names</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">_has_names</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">index</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">has_column_names</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">_has_names</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">show_row_idx_names</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">all</span><span class="s3">((</span><span class="s1">self</span><span class="s3">.</span><span class="s1">has_index_names</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">index</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">show_index_names</span><span class="s3">))</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">show_col_idx_names</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">all</span><span class="s3">((</span><span class="s1">self</span><span class="s3">.</span><span class="s1">has_column_names</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">show_index_names</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">))</span>

    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">max_rows_displayed</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; int</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">min</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows </span><span class="s2">or </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">), </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">_initialize_sparsify</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">sparsify</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s2">None</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">sparsify </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.multi_sparse&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">sparsify</span>

    <span class="s2">def </span><span class="s1">_initialize_formatters</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">formatters</span><span class="s3">: </span><span class="s1">FormattersType </span><span class="s3">| </span><span class="s2">None</span>
    <span class="s3">) </span><span class="s1">-&gt; FormattersType</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">formatters </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s3">{}</span>
        <span class="s2">elif </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">) == </span><span class="s1">len</span><span class="s3">(</span><span class="s1">formatters</span><span class="s3">) </span><span class="s2">or </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">formatters</span><span class="s3">, </span><span class="s1">dict</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">formatters</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
                <span class="s4">f&quot;Formatters length(</span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">formatters</span><span class="s3">)</span><span class="s2">}</span><span class="s4">) should match &quot;</span>
                <span class="s4">f&quot;DataFrame number of columns(</span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">)</span><span class="s2">}</span><span class="s4">)&quot;</span>
            <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_initialize_justify</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">justify</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">justify </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.colheader_justify&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">justify</span>

    <span class="s2">def </span><span class="s1">_initialize_columns</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">columns</span><span class="s3">: </span><span class="s1">Axes </span><span class="s3">| </span><span class="s2">None</span><span class="s3">) </span><span class="s1">-&gt; Index</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">columns </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">cols </span><span class="s3">= </span><span class="s1">ensure_index</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">frame </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">[</span><span class="s1">cols</span><span class="s3">]</span>
            <span class="s2">return </span><span class="s1">cols</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span>

    <span class="s2">def </span><span class="s1">_initialize_colspace</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">col_space</span><span class="s3">: </span><span class="s1">ColspaceArgType </span><span class="s3">| </span><span class="s2">None</span><span class="s3">) </span><span class="s1">-&gt; ColspaceType</span><span class="s3">:</span>
        <span class="s1">result</span><span class="s3">: </span><span class="s1">ColspaceType</span>

        <span class="s2">if </span><span class="s1">col_space </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= {}</span>
        <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">col_space</span><span class="s3">, (</span><span class="s1">int</span><span class="s3">, </span><span class="s1">str</span><span class="s3">)):</span>
            <span class="s1">result </span><span class="s3">= {</span><span class="s4">&quot;&quot;</span><span class="s3">: </span><span class="s1">col_space</span><span class="s3">}</span>
            <span class="s1">result</span><span class="s3">.</span><span class="s1">update</span><span class="s3">({</span><span class="s1">column</span><span class="s3">: </span><span class="s1">col_space </span><span class="s2">for </span><span class="s1">column </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">})</span>
        <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">col_space</span><span class="s3">, </span><span class="s1">Mapping</span><span class="s3">):</span>
            <span class="s2">for </span><span class="s1">column </span><span class="s2">in </span><span class="s1">col_space</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">():</span>
                <span class="s2">if </span><span class="s1">column </span><span class="s2">not in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns </span><span class="s2">and </span><span class="s1">column </span><span class="s3">!= </span><span class="s4">&quot;&quot;</span><span class="s3">:</span>
                    <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
                        <span class="s4">f&quot;Col_space is defined for an unknown column: </span><span class="s2">{</span><span class="s1">column</span><span class="s2">}</span><span class="s4">&quot;</span>
                    <span class="s3">)</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">col_space</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">) != </span><span class="s1">len</span><span class="s3">(</span><span class="s1">col_space</span><span class="s3">):</span>
                <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
                    <span class="s4">f&quot;Col_space length(</span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">col_space</span><span class="s3">)</span><span class="s2">}</span><span class="s4">) should match &quot;</span>
                    <span class="s4">f&quot;DataFrame number of columns(</span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">)</span><span class="s2">}</span><span class="s4">)&quot;</span>
                <span class="s3">)</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">dict</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">, </span><span class="s1">col_space</span><span class="s3">))</span>
        <span class="s2">return </span><span class="s1">result</span>

    <span class="s2">def </span><span class="s1">_calc_max_cols_fitted</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; int </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Number of columns fitting the screen.&quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_is_in_terminal</span><span class="s3">():</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols</span>

        <span class="s1">width</span><span class="s3">, </span><span class="s1">_ </span><span class="s3">= </span><span class="s1">get_terminal_size</span><span class="s3">()</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_is_screen_narrow</span><span class="s3">(</span><span class="s1">width</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">width</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols</span>

    <span class="s2">def </span><span class="s1">_calc_max_rows_fitted</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; int </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Number of rows with data fitting the screen.&quot;&quot;&quot;</span>
        <span class="s1">max_rows</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_is_in_terminal</span><span class="s3">():</span>
            <span class="s1">_</span><span class="s3">, </span><span class="s1">height </span><span class="s3">= </span><span class="s1">get_terminal_size</span><span class="s3">()</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows </span><span class="s3">== </span><span class="s6">0</span><span class="s3">:</span>
                <span class="s5"># rows available to fill with actual data</span>
                <span class="s2">return </span><span class="s1">height </span><span class="s3">- </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_number_of_auxiliary_rows</span><span class="s3">()</span>

            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_is_screen_short</span><span class="s3">(</span><span class="s1">height</span><span class="s3">):</span>
                <span class="s1">max_rows </span><span class="s3">= </span><span class="s1">height</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">max_rows </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">max_rows </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows</span>

        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_adjust_max_rows</span><span class="s3">(</span><span class="s1">max_rows</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_adjust_max_rows</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">max_rows</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None</span><span class="s3">) </span><span class="s1">-&gt; int </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Adjust max_rows using display logic. 
 
        See description here: 
        https://pandas.pydata.org/docs/dev/user_guide/options.html#frequently-used-options 
 
        GH #37359 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">max_rows</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">) &gt; </span><span class="s1">max_rows</span><span class="s3">) </span><span class="s2">and </span><span class="s1">self</span><span class="s3">.</span><span class="s1">min_rows</span><span class="s3">:</span>
                <span class="s5"># if truncated, set max_rows showed to min_rows</span>
                <span class="s1">max_rows </span><span class="s3">= </span><span class="s1">min</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">min_rows</span><span class="s3">, </span><span class="s1">max_rows</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">max_rows</span>

    <span class="s2">def </span><span class="s1">_is_in_terminal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Check if the output is to be shown in terminal.&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">bool</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols </span><span class="s3">== </span><span class="s6">0 </span><span class="s2">or </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows </span><span class="s3">== </span><span class="s6">0</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_is_screen_narrow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">max_width</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">bool</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols </span><span class="s3">== </span><span class="s6">0 </span><span class="s2">and </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">) &gt; </span><span class="s1">max_width</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_is_screen_short</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">max_height</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">bool</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows </span><span class="s3">== </span><span class="s6">0 </span><span class="s2">and </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">) &gt; </span><span class="s1">max_height</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_get_number_of_auxiliary_rows</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; int</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Get number of rows occupied by prompt, dots and dimension info.&quot;&quot;&quot;</span>
        <span class="s1">dot_row </span><span class="s3">= </span><span class="s6">1</span>
        <span class="s1">prompt_row </span><span class="s3">= </span><span class="s6">1</span>
        <span class="s1">num_rows </span><span class="s3">= </span><span class="s1">dot_row </span><span class="s3">+ </span><span class="s1">prompt_row</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">show_dimensions</span><span class="s3">:</span>
            <span class="s1">num_rows </span><span class="s3">+= </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">dimensions_info</span><span class="s3">.</span><span class="s1">splitlines</span><span class="s3">())</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">:</span>
            <span class="s1">num_rows </span><span class="s3">+= </span><span class="s6">1</span>

        <span class="s2">return </span><span class="s1">num_rows</span>

    <span class="s2">def </span><span class="s1">truncate</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Check whether the frame should be truncated. If so, slice the frame up. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_truncated_horizontally</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_truncate_horizontally</span><span class="s3">()</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_truncated_vertically</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_truncate_vertically</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">_truncate_horizontally</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Remove columns, which are not to be displayed and adjust formatters. 
 
        Attributes affected: 
            - tr_frame 
            - formatters 
            - tr_col_num 
        &quot;&quot;&quot;</span>
        <span class="s2">assert </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols_fitted </span><span class="s2">is not None</span>
        <span class="s1">col_num </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols_fitted </span><span class="s3">// </span><span class="s6">2</span>
        <span class="s2">if </span><span class="s1">col_num </span><span class="s3">&gt;= </span><span class="s6">1</span><span class="s3">:</span>
            <span class="s1">left </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[:, :</span><span class="s1">col_num</span><span class="s3">]</span>
            <span class="s1">right </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[:, -</span><span class="s1">col_num</span><span class="s3">:]</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame </span><span class="s3">= </span><span class="s1">concat</span><span class="s3">((</span><span class="s1">left</span><span class="s3">, </span><span class="s1">right</span><span class="s3">), </span><span class="s1">axis</span><span class="s3">=</span><span class="s6">1</span><span class="s3">)</span>

            <span class="s5"># truncate formatter</span>
            <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatters</span><span class="s3">, (</span><span class="s1">list</span><span class="s3">, </span><span class="s1">tuple</span><span class="s3">)):</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">formatters </span><span class="s3">= [</span>
                    <span class="s3">*</span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatters</span><span class="s3">[:</span><span class="s1">col_num</span><span class="s3">],</span>
                    <span class="s3">*</span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatters</span><span class="s3">[-</span><span class="s1">col_num</span><span class="s3">:],</span>
                <span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">col_num </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">int</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_cols</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[:, :</span><span class="s1">col_num</span><span class="s3">]</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_col_num </span><span class="s3">= </span><span class="s1">col_num</span>

    <span class="s2">def </span><span class="s1">_truncate_vertically</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Remove rows, which are not to be displayed. 
 
        Attributes affected: 
            - tr_frame 
            - tr_row_num 
        &quot;&quot;&quot;</span>
        <span class="s2">assert </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows_fitted </span><span class="s2">is not None</span>
        <span class="s1">row_num </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows_fitted </span><span class="s3">// </span><span class="s6">2</span>
        <span class="s2">if </span><span class="s1">row_num </span><span class="s3">&gt;= </span><span class="s6">1</span><span class="s3">:</span>
            <span class="s1">_len </span><span class="s3">= </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">)</span>
            <span class="s1">_slice </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">hstack</span><span class="s3">([</span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">row_num</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">_len </span><span class="s3">- </span><span class="s1">row_num</span><span class="s3">, </span><span class="s1">_len</span><span class="s3">)])</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[</span><span class="s1">_slice</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">row_num </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">int</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">max_rows</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[:</span><span class="s1">row_num</span><span class="s3">, :]</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">tr_row_num </span><span class="s3">= </span><span class="s1">row_num</span>

    <span class="s2">def </span><span class="s1">_get_strcols_without_index</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]]:</span>
        <span class="s1">strcols</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]] = []</span>

        <span class="s2">if not </span><span class="s1">is_list_like</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">) </span><span class="s2">and not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">:</span>
            <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">c </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">):</span>
                <span class="s1">fmt_values </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">format_col</span><span class="s3">(</span><span class="s1">i</span><span class="s3">)</span>
                <span class="s1">fmt_values </span><span class="s3">= </span><span class="s1">_make_fixed_width</span><span class="s3">(</span>
                    <span class="s1">strings</span><span class="s3">=</span><span class="s1">fmt_values</span><span class="s3">,</span>
                    <span class="s1">justify</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">justify</span><span class="s3">,</span>
                    <span class="s1">minimum</span><span class="s3">=</span><span class="s1">int</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">col_space</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s6">0</span><span class="s3">)),</span>
                    <span class="s1">adj</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">,</span>
                <span class="s3">)</span>
                <span class="s1">strcols</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">fmt_values</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">strcols</span>

        <span class="s2">if </span><span class="s1">is_list_like</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">):</span>
            <span class="s5"># cast here since can't be bool if is_list_like</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">header </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">], </span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">) != </span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">):</span>
                <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
                    <span class="s4">f&quot;Writing </span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">)</span><span class="s2">} </span><span class="s4">cols &quot;</span>
                    <span class="s4">f&quot;but got </span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">)</span><span class="s2">} </span><span class="s4">aliases&quot;</span>
                <span class="s3">)</span>
            <span class="s1">str_columns </span><span class="s3">= [[</span><span class="s1">label</span><span class="s3">] </span><span class="s2">for </span><span class="s1">label </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">str_columns </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_formatted_column_labels</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">show_row_idx_names</span><span class="s3">:</span>
            <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">str_columns</span><span class="s3">:</span>
                <span class="s1">x</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">c </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span><span class="s3">):</span>
            <span class="s1">cheader </span><span class="s3">= </span><span class="s1">str_columns</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]</span>
            <span class="s1">header_colwidth </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span>
                <span class="s1">int</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">col_space</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s6">0</span><span class="s3">)), *(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">.</span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">cheader</span><span class="s3">)</span>
            <span class="s3">)</span>
            <span class="s1">fmt_values </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">format_col</span><span class="s3">(</span><span class="s1">i</span><span class="s3">)</span>
            <span class="s1">fmt_values </span><span class="s3">= </span><span class="s1">_make_fixed_width</span><span class="s3">(</span>
                <span class="s1">fmt_values</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">justify</span><span class="s3">, </span><span class="s1">minimum</span><span class="s3">=</span><span class="s1">header_colwidth</span><span class="s3">, </span><span class="s1">adj</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span>
            <span class="s3">)</span>

            <span class="s1">max_len </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(*(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">.</span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">fmt_values</span><span class="s3">), </span><span class="s1">header_colwidth</span><span class="s3">)</span>
            <span class="s1">cheader </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">.</span><span class="s1">justify</span><span class="s3">(</span><span class="s1">cheader</span><span class="s3">, </span><span class="s1">max_len</span><span class="s3">, </span><span class="s1">mode</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">justify</span><span class="s3">)</span>
            <span class="s1">strcols</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">cheader </span><span class="s3">+ </span><span class="s1">fmt_values</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">strcols</span>

    <span class="s2">def </span><span class="s1">format_col</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">i</span><span class="s3">: </span><span class="s1">int</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s1">frame </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">tr_frame</span>
        <span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_formatter</span><span class="s3">(</span><span class="s1">i</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">format_array</span><span class="s3">(</span>
            <span class="s1">frame</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[:, </span><span class="s1">i</span><span class="s3">].</span><span class="s1">_values</span><span class="s3">,</span>
            <span class="s1">formatter</span><span class="s3">,</span>
            <span class="s1">float_format</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format</span><span class="s3">,</span>
            <span class="s1">na_rep</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span><span class="s3">,</span>
            <span class="s1">space</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">col_space</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]),</span>
            <span class="s1">decimal</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">decimal</span><span class="s3">,</span>
            <span class="s1">leading_space</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">index</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_get_formatter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">i</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s1">int</span><span class="s3">) </span><span class="s1">-&gt; Callable </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatters</span><span class="s3">, (</span><span class="s1">list</span><span class="s3">, </span><span class="s1">tuple</span><span class="s3">)):</span>
            <span class="s2">if </span><span class="s1">is_integer</span><span class="s3">(</span><span class="s1">i</span><span class="s3">):</span>
                <span class="s1">i </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">int</span><span class="s3">, </span><span class="s1">i</span><span class="s3">)</span>
                <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatters</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">return None</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">is_integer</span><span class="s3">(</span><span class="s1">i</span><span class="s3">) </span><span class="s2">and </span><span class="s1">i </span><span class="s2">not in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">:</span>
                <span class="s1">i </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatters</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">i</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_get_formatted_column_labels</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">frame</span><span class="s3">: </span><span class="s1">DataFrame</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]]:</span>
        <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">indexes</span><span class="s3">.</span><span class="s1">multi </span><span class="s2">import </span><span class="s1">sparsify_labels</span>

        <span class="s1">columns </span><span class="s3">= </span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span>

        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">, </span><span class="s1">MultiIndex</span><span class="s3">):</span>
            <span class="s1">fmt_columns </span><span class="s3">= </span><span class="s1">columns</span><span class="s3">.</span><span class="s1">_format_multi</span><span class="s3">(</span><span class="s1">sparsify</span><span class="s3">=</span><span class="s2">False</span><span class="s3">, </span><span class="s1">include_names</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">fmt_columns </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(*</span><span class="s1">fmt_columns</span><span class="s3">))</span>
            <span class="s1">dtypes </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">dtypes</span><span class="s3">.</span><span class="s1">_values</span>

            <span class="s5"># if we have a Float level, they don't use leading space at all</span>
            <span class="s1">restrict_formatting </span><span class="s3">= </span><span class="s1">any</span><span class="s3">(</span><span class="s1">level</span><span class="s3">.</span><span class="s1">is_floating </span><span class="s2">for </span><span class="s1">level </span><span class="s2">in </span><span class="s1">columns</span><span class="s3">.</span><span class="s1">levels</span><span class="s3">)</span>
            <span class="s1">need_leadsp </span><span class="s3">= </span><span class="s1">dict</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(</span><span class="s1">fmt_columns</span><span class="s3">, </span><span class="s1">map</span><span class="s3">(</span><span class="s1">is_numeric_dtype</span><span class="s3">, </span><span class="s1">dtypes</span><span class="s3">)))</span>

            <span class="s2">def </span><span class="s1">space_format</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">):</span>
                <span class="s2">if </span><span class="s3">(</span>
                    <span class="s1">y </span><span class="s2">not in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatters</span>
                    <span class="s2">and </span><span class="s1">need_leadsp</span><span class="s3">[</span><span class="s1">x</span><span class="s3">]</span>
                    <span class="s2">and not </span><span class="s1">restrict_formatting</span>
                <span class="s3">):</span>
                    <span class="s2">return </span><span class="s4">&quot; &quot; </span><span class="s3">+ </span><span class="s1">y</span>
                <span class="s2">return </span><span class="s1">y</span>

            <span class="s1">str_columns_tuple </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span>
                <span class="s1">zip</span><span class="s3">(*([</span><span class="s1">space_format</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">) </span><span class="s2">for </span><span class="s1">y </span><span class="s2">in </span><span class="s1">x</span><span class="s3">] </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">fmt_columns</span><span class="s3">))</span>
            <span class="s3">)</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">sparsify </span><span class="s2">and </span><span class="s1">len</span><span class="s3">(</span><span class="s1">str_columns_tuple</span><span class="s3">):</span>
                <span class="s1">str_columns_tuple </span><span class="s3">= </span><span class="s1">sparsify_labels</span><span class="s3">(</span><span class="s1">str_columns_tuple</span><span class="s3">)</span>

            <span class="s1">str_columns </span><span class="s3">= [</span><span class="s1">list</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(*</span><span class="s1">str_columns_tuple</span><span class="s3">)]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">fmt_columns </span><span class="s3">= </span><span class="s1">columns</span><span class="s3">.</span><span class="s1">_format_flat</span><span class="s3">(</span><span class="s1">include_name</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">dtypes </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">dtypes</span>
            <span class="s1">need_leadsp </span><span class="s3">= </span><span class="s1">dict</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(</span><span class="s1">fmt_columns</span><span class="s3">, </span><span class="s1">map</span><span class="s3">(</span><span class="s1">is_numeric_dtype</span><span class="s3">, </span><span class="s1">dtypes</span><span class="s3">)))</span>
            <span class="s1">str_columns </span><span class="s3">= [</span>
                <span class="s3">[</span><span class="s4">&quot; &quot; </span><span class="s3">+ </span><span class="s1">x </span><span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_formatter</span><span class="s3">(</span><span class="s1">i</span><span class="s3">) </span><span class="s2">and </span><span class="s1">need_leadsp</span><span class="s3">[</span><span class="s1">x</span><span class="s3">] </span><span class="s2">else </span><span class="s1">x</span><span class="s3">]</span>
                <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">x </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">fmt_columns</span><span class="s3">)</span>
            <span class="s3">]</span>
        <span class="s5"># self.str_columns = str_columns</span>
        <span class="s2">return </span><span class="s1">str_columns</span>

    <span class="s2">def </span><span class="s1">_get_formatted_index</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">frame</span><span class="s3">: </span><span class="s1">DataFrame</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s5"># Note: this is only used by to_string() and to_latex(), not by</span>
        <span class="s5"># to_html(). so safe to cast col_space here.</span>
        <span class="s1">col_space </span><span class="s3">= {</span><span class="s1">k</span><span class="s3">: </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">int</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) </span><span class="s2">for </span><span class="s1">k</span><span class="s3">, </span><span class="s1">v </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">col_space</span><span class="s3">.</span><span class="s1">items</span><span class="s3">()}</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">frame</span><span class="s3">.</span><span class="s1">index</span>
        <span class="s1">columns </span><span class="s3">= </span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span>
        <span class="s1">fmt </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_formatter</span><span class="s3">(</span><span class="s4">&quot;__index__&quot;</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">index</span><span class="s3">, </span><span class="s1">MultiIndex</span><span class="s3">):</span>
            <span class="s1">fmt_index </span><span class="s3">= </span><span class="s1">index</span><span class="s3">.</span><span class="s1">_format_multi</span><span class="s3">(</span>
                <span class="s1">sparsify</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">sparsify</span><span class="s3">,</span>
                <span class="s1">include_names</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">show_row_idx_names</span><span class="s3">,</span>
                <span class="s1">formatter</span><span class="s3">=</span><span class="s1">fmt</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">fmt_index </span><span class="s3">= [</span>
                <span class="s1">index</span><span class="s3">.</span><span class="s1">_format_flat</span><span class="s3">(</span><span class="s1">include_name</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">show_row_idx_names</span><span class="s3">, </span><span class="s1">formatter</span><span class="s3">=</span><span class="s1">fmt</span><span class="s3">)</span>
            <span class="s3">]</span>

        <span class="s1">fmt_index </span><span class="s3">= [</span>
            <span class="s1">tuple</span><span class="s3">(</span>
                <span class="s1">_make_fixed_width</span><span class="s3">(</span>
                    <span class="s1">list</span><span class="s3">(</span><span class="s1">x</span><span class="s3">), </span><span class="s1">justify</span><span class="s3">=</span><span class="s4">&quot;left&quot;</span><span class="s3">, </span><span class="s1">minimum</span><span class="s3">=</span><span class="s1">col_space</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">, </span><span class="s6">0</span><span class="s3">), </span><span class="s1">adj</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span>
                <span class="s3">)</span>
            <span class="s3">)</span>
            <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">fmt_index</span>
        <span class="s3">]</span>

        <span class="s1">adjoined </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">adj</span><span class="s3">.</span><span class="s1">adjoin</span><span class="s3">(</span><span class="s6">1</span><span class="s3">, *</span><span class="s1">fmt_index</span><span class="s3">).</span><span class="s1">split</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">)</span>

        <span class="s5"># empty space for columns</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">show_col_idx_names</span><span class="s3">:</span>
            <span class="s1">col_header </span><span class="s3">= [</span><span class="s1">str</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_get_column_name_list</span><span class="s3">()]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">col_header </span><span class="s3">= [</span><span class="s4">&quot;&quot;</span><span class="s3">] * </span><span class="s1">columns</span><span class="s3">.</span><span class="s1">nlevels</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">header</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">col_header </span><span class="s3">+ </span><span class="s1">adjoined</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">adjoined</span>

    <span class="s2">def </span><span class="s1">_get_column_name_list</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">Hashable</span><span class="s3">]:</span>
        <span class="s1">names</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">Hashable</span><span class="s3">] = []</span>
        <span class="s1">columns </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">frame</span><span class="s3">.</span><span class="s1">columns</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">, </span><span class="s1">MultiIndex</span><span class="s3">):</span>
            <span class="s1">names</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">(</span><span class="s4">&quot;&quot; </span><span class="s2">if </span><span class="s1">name </span><span class="s2">is None else </span><span class="s1">name </span><span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">columns</span><span class="s3">.</span><span class="s1">names</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">names</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;&quot; </span><span class="s2">if </span><span class="s1">columns</span><span class="s3">.</span><span class="s1">name </span><span class="s2">is None else </span><span class="s1">columns</span><span class="s3">.</span><span class="s1">name</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">names</span>


<span class="s2">class </span><span class="s1">DataFrameRenderer</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Class for creating dataframe output in multiple formats. 
 
    Called in pandas.core.generic.NDFrame: 
        - to_csv 
        - to_latex 
 
    Called in pandas.core.frame.DataFrame: 
        - to_html 
        - to_string 
 
    Parameters 
    ---------- 
    fmt : DataFrameFormatter 
        Formatter with the formatting options. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">fmt</span><span class="s3">: </span><span class="s1">DataFrameFormatter</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fmt </span><span class="s3">= </span><span class="s1">fmt</span>

    <span class="s2">def </span><span class="s1">to_html</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">buf</span><span class="s3">: </span><span class="s1">FilePath </span><span class="s3">| </span><span class="s1">WriteBuffer</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] | </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">encoding</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">classes</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s1">list </span><span class="s3">| </span><span class="s1">tuple </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">notebook</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
        <span class="s1">border</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s1">bool </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">table_id</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">render_links</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; str </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Render a DataFrame to a html table. 
 
        Parameters 
        ---------- 
        buf : str, path object, file-like object, or None, default None 
            String, path object (implementing ``os.PathLike[str]``), or file-like 
            object implementing a string ``write()`` function. If None, the result is 
            returned as a string. 
        encoding : str, default utf-8 
            Set character encoding. 
        classes : str or list-like 
            classes to include in the `class` attribute of the opening 
            ``&lt;table&gt;`` tag, in addition to the default &quot;dataframe&quot;. 
        notebook : {True, False}, optional, default False 
            Whether the generated HTML is for IPython Notebook. 
        border : int 
            A ``border=border`` attribute is included in the opening 
            ``&lt;table&gt;`` tag. Default ``pd.options.display.html.border``. 
        table_id : str, optional 
            A css id is included in the opening `&lt;table&gt;` tag if specified. 
        render_links : bool, default False 
            Convert URLs to HTML links. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">formats</span><span class="s3">.</span><span class="s1">html </span><span class="s2">import </span><span class="s3">(</span>
            <span class="s1">HTMLFormatter</span><span class="s3">,</span>
            <span class="s1">NotebookFormatter</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s1">Klass </span><span class="s3">= </span><span class="s1">NotebookFormatter </span><span class="s2">if </span><span class="s1">notebook </span><span class="s2">else </span><span class="s1">HTMLFormatter</span>

        <span class="s1">html_formatter </span><span class="s3">= </span><span class="s1">Klass</span><span class="s3">(</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">fmt</span><span class="s3">,</span>
            <span class="s1">classes</span><span class="s3">=</span><span class="s1">classes</span><span class="s3">,</span>
            <span class="s1">border</span><span class="s3">=</span><span class="s1">border</span><span class="s3">,</span>
            <span class="s1">table_id</span><span class="s3">=</span><span class="s1">table_id</span><span class="s3">,</span>
            <span class="s1">render_links</span><span class="s3">=</span><span class="s1">render_links</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">string </span><span class="s3">= </span><span class="s1">html_formatter</span><span class="s3">.</span><span class="s1">to_string</span><span class="s3">()</span>
        <span class="s2">return </span><span class="s1">save_to_buffer</span><span class="s3">(</span><span class="s1">string</span><span class="s3">, </span><span class="s1">buf</span><span class="s3">=</span><span class="s1">buf</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s1">encoding</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">to_string</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">buf</span><span class="s3">: </span><span class="s1">FilePath </span><span class="s3">| </span><span class="s1">WriteBuffer</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] | </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">encoding</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">line_width</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; str </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Render a DataFrame to a console-friendly tabular output. 
 
        Parameters 
        ---------- 
        buf : str, path object, file-like object, or None, default None 
            String, path object (implementing ``os.PathLike[str]``), or file-like 
            object implementing a string ``write()`` function. If None, the result is 
            returned as a string. 
        encoding: str, default utf-8 
            Set character encoding. 
        line_width : int, optional 
            Width to wrap a line in characters. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">formats</span><span class="s3">.</span><span class="s1">string </span><span class="s2">import </span><span class="s1">StringFormatter</span>

        <span class="s1">string_formatter </span><span class="s3">= </span><span class="s1">StringFormatter</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">fmt</span><span class="s3">, </span><span class="s1">line_width</span><span class="s3">=</span><span class="s1">line_width</span><span class="s3">)</span>
        <span class="s1">string </span><span class="s3">= </span><span class="s1">string_formatter</span><span class="s3">.</span><span class="s1">to_string</span><span class="s3">()</span>
        <span class="s2">return </span><span class="s1">save_to_buffer</span><span class="s3">(</span><span class="s1">string</span><span class="s3">, </span><span class="s1">buf</span><span class="s3">=</span><span class="s1">buf</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s1">encoding</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">to_csv</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">path_or_buf</span><span class="s3">: </span><span class="s1">FilePath </span><span class="s3">| </span><span class="s1">WriteBuffer</span><span class="s3">[</span><span class="s1">bytes</span><span class="s3">] | </span><span class="s1">WriteBuffer</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] | </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">encoding</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">sep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;,&quot;</span><span class="s3">,</span>
        <span class="s1">columns</span><span class="s3">: </span><span class="s1">Sequence</span><span class="s3">[</span><span class="s1">Hashable</span><span class="s3">] | </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">index_label</span><span class="s3">: </span><span class="s1">IndexLabel </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">mode</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;w&quot;</span><span class="s3">,</span>
        <span class="s1">compression</span><span class="s3">: </span><span class="s1">CompressionOptions </span><span class="s3">= </span><span class="s4">&quot;infer&quot;</span><span class="s3">,</span>
        <span class="s1">quoting</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">quotechar</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">'&quot;'</span><span class="s3">,</span>
        <span class="s1">lineterminator</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">chunksize</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">date_format</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">doublequote</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">escapechar</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">errors</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;strict&quot;</span><span class="s3">,</span>
        <span class="s1">storage_options</span><span class="s3">: </span><span class="s1">StorageOptions </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; str </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Render dataframe as comma-separated file. 
        &quot;&quot;&quot;</span>
        <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">formats</span><span class="s3">.</span><span class="s1">csvs </span><span class="s2">import </span><span class="s1">CSVFormatter</span>

        <span class="s2">if </span><span class="s1">path_or_buf </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">created_buffer </span><span class="s3">= </span><span class="s2">True</span>
            <span class="s1">path_or_buf </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">()</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">created_buffer </span><span class="s3">= </span><span class="s2">False</span>

        <span class="s1">csv_formatter </span><span class="s3">= </span><span class="s1">CSVFormatter</span><span class="s3">(</span>
            <span class="s1">path_or_buf</span><span class="s3">=</span><span class="s1">path_or_buf</span><span class="s3">,</span>
            <span class="s1">lineterminator</span><span class="s3">=</span><span class="s1">lineterminator</span><span class="s3">,</span>
            <span class="s1">sep</span><span class="s3">=</span><span class="s1">sep</span><span class="s3">,</span>
            <span class="s1">encoding</span><span class="s3">=</span><span class="s1">encoding</span><span class="s3">,</span>
            <span class="s1">errors</span><span class="s3">=</span><span class="s1">errors</span><span class="s3">,</span>
            <span class="s1">compression</span><span class="s3">=</span><span class="s1">compression</span><span class="s3">,</span>
            <span class="s1">quoting</span><span class="s3">=</span><span class="s1">quoting</span><span class="s3">,</span>
            <span class="s1">cols</span><span class="s3">=</span><span class="s1">columns</span><span class="s3">,</span>
            <span class="s1">index_label</span><span class="s3">=</span><span class="s1">index_label</span><span class="s3">,</span>
            <span class="s1">mode</span><span class="s3">=</span><span class="s1">mode</span><span class="s3">,</span>
            <span class="s1">chunksize</span><span class="s3">=</span><span class="s1">chunksize</span><span class="s3">,</span>
            <span class="s1">quotechar</span><span class="s3">=</span><span class="s1">quotechar</span><span class="s3">,</span>
            <span class="s1">date_format</span><span class="s3">=</span><span class="s1">date_format</span><span class="s3">,</span>
            <span class="s1">doublequote</span><span class="s3">=</span><span class="s1">doublequote</span><span class="s3">,</span>
            <span class="s1">escapechar</span><span class="s3">=</span><span class="s1">escapechar</span><span class="s3">,</span>
            <span class="s1">storage_options</span><span class="s3">=</span><span class="s1">storage_options</span><span class="s3">,</span>
            <span class="s1">formatter</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">fmt</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">csv_formatter</span><span class="s3">.</span><span class="s1">save</span><span class="s3">()</span>

        <span class="s2">if </span><span class="s1">created_buffer</span><span class="s3">:</span>
            <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">path_or_buf</span><span class="s3">, </span><span class="s1">StringIO</span><span class="s3">)</span>
            <span class="s1">content </span><span class="s3">= </span><span class="s1">path_or_buf</span><span class="s3">.</span><span class="s1">getvalue</span><span class="s3">()</span>
            <span class="s1">path_or_buf</span><span class="s3">.</span><span class="s1">close</span><span class="s3">()</span>
            <span class="s2">return </span><span class="s1">content</span>

        <span class="s2">return None</span>


<span class="s2">def </span><span class="s1">save_to_buffer</span><span class="s3">(</span>
    <span class="s1">string</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
    <span class="s1">buf</span><span class="s3">: </span><span class="s1">FilePath </span><span class="s3">| </span><span class="s1">WriteBuffer</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] | </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">encoding</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
<span class="s3">) </span><span class="s1">-&gt; str </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Perform serialization. Write to buf or return as string if buf is None. 
    &quot;&quot;&quot;</span>
    <span class="s2">with </span><span class="s1">_get_buffer</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s1">encoding</span><span class="s3">) </span><span class="s2">as </span><span class="s1">fd</span><span class="s3">:</span>
        <span class="s1">fd</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s1">string</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">buf </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s5"># error: &quot;WriteBuffer[str]&quot; has no attribute &quot;getvalue&quot;</span>
            <span class="s2">return </span><span class="s1">fd</span><span class="s3">.</span><span class="s1">getvalue</span><span class="s3">()  </span><span class="s5"># type: ignore[attr-defined]</span>
        <span class="s2">return None</span>


<span class="s3">@</span><span class="s1">contextmanager</span>
<span class="s2">def </span><span class="s1">_get_buffer</span><span class="s3">(</span>
    <span class="s1">buf</span><span class="s3">: </span><span class="s1">FilePath </span><span class="s3">| </span><span class="s1">WriteBuffer</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] | </span><span class="s2">None</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span>
<span class="s3">) </span><span class="s1">-&gt; Generator</span><span class="s3">[</span><span class="s1">WriteBuffer</span><span class="s3">[</span><span class="s1">str</span><span class="s3">], </span><span class="s2">None</span><span class="s3">, </span><span class="s2">None</span><span class="s3">] | </span><span class="s1">Generator</span><span class="s3">[</span><span class="s1">StringIO</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s2">None</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
    Context manager to open, yield and close buffer for filenames or Path-like 
    objects, otherwise yield buf unchanged. 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">buf </span><span class="s2">is not None</span><span class="s3">:</span>
        <span class="s1">buf </span><span class="s3">= </span><span class="s1">stringify_path</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">buf </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">()</span>

    <span class="s2">if </span><span class="s1">encoding </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">encoding </span><span class="s3">= </span><span class="s4">&quot;utf-8&quot;</span>
    <span class="s2">elif not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">&quot;buf is not a file name and encoding is specified.&quot;</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">, </span><span class="s4">&quot;write&quot;</span><span class="s3">):</span>
        <span class="s5"># Incompatible types in &quot;yield&quot; (actual type &quot;Union[str, WriteBuffer[str],</span>
        <span class="s5"># StringIO]&quot;, expected type &quot;Union[WriteBuffer[str], StringIO]&quot;)</span>
        <span class="s2">yield </span><span class="s1">buf  </span><span class="s5"># type: ignore[misc]</span>
    <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">, </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s1">check_parent_directory</span><span class="s3">(</span><span class="s1">str</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">))</span>
        <span class="s2">with </span><span class="s1">open</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">, </span><span class="s4">&quot;w&quot;</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s1">encoding</span><span class="s3">, </span><span class="s1">newline</span><span class="s3">=</span><span class="s4">&quot;&quot;</span><span class="s3">) </span><span class="s2">as </span><span class="s1">f</span><span class="s3">:</span>
            <span class="s5"># GH#30034 open instead of codecs.open prevents a file leak</span>
            <span class="s5">#  if we have an invalid encoding argument.</span>
            <span class="s5"># newline=&quot;&quot; is needed to roundtrip correctly on</span>
            <span class="s5">#  windows test_to_latex_filename</span>
            <span class="s2">yield </span><span class="s1">f</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s4">&quot;buf is not a file name and it has no write method&quot;</span><span class="s3">)</span>


<span class="s5"># ----------------------------------------------------------------------</span>
<span class="s5"># Array formatters</span>


<span class="s2">def </span><span class="s1">format_array</span><span class="s3">(</span>
    <span class="s1">values</span><span class="s3">: </span><span class="s1">ArrayLike</span><span class="s3">,</span>
    <span class="s1">formatter</span><span class="s3">: </span><span class="s1">Callable </span><span class="s3">| </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">float_format</span><span class="s3">: </span><span class="s1">FloatFormatType </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">na_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaN&quot;</span><span class="s3">,</span>
    <span class="s1">digits</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">space</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">justify</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;right&quot;</span><span class="s3">,</span>
    <span class="s1">decimal</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;.&quot;</span><span class="s3">,</span>
    <span class="s1">leading_space</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
    <span class="s1">quoting</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">fallback_formatter</span><span class="s3">: </span><span class="s1">Callable </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
<span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
    Format an array for printing. 
 
    Parameters 
    ---------- 
    values : np.ndarray or ExtensionArray 
    formatter 
    float_format 
    na_rep 
    digits 
    space 
    justify 
    decimal 
    leading_space : bool, optional, default True 
        Whether the array should be formatted with a leading space. 
        When an array as a column of a Series or DataFrame, we do want 
        the leading space to pad between columns. 
 
        When formatting an Index subclass 
        (e.g. IntervalIndex._get_values_for_csv), we don't want the 
        leading space since it should be left-aligned. 
    fallback_formatter 
 
    Returns 
    ------- 
    List[str] 
    &quot;&quot;&quot;</span>
    <span class="s1">fmt_klass</span><span class="s3">: </span><span class="s1">type</span><span class="s3">[</span><span class="s1">_GenericArrayFormatter</span><span class="s3">]</span>
    <span class="s2">if </span><span class="s1">lib</span><span class="s3">.</span><span class="s1">is_np_dtype</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s4">&quot;M&quot;</span><span class="s3">):</span>
        <span class="s1">fmt_klass </span><span class="s3">= </span><span class="s1">_Datetime64Formatter</span>
        <span class="s1">values </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">DatetimeArray</span><span class="s3">, </span><span class="s1">values</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">DatetimeTZDtype</span><span class="s3">):</span>
        <span class="s1">fmt_klass </span><span class="s3">= </span><span class="s1">_Datetime64TZFormatter</span>
        <span class="s1">values </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">DatetimeArray</span><span class="s3">, </span><span class="s1">values</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">lib</span><span class="s3">.</span><span class="s1">is_np_dtype</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s4">&quot;m&quot;</span><span class="s3">):</span>
        <span class="s1">fmt_klass </span><span class="s3">= </span><span class="s1">_Timedelta64Formatter</span>
        <span class="s1">values </span><span class="s3">= </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">TimedeltaArray</span><span class="s3">, </span><span class="s1">values</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">ExtensionDtype</span><span class="s3">):</span>
        <span class="s1">fmt_klass </span><span class="s3">= </span><span class="s1">_ExtensionArrayFormatter</span>
    <span class="s2">elif </span><span class="s1">lib</span><span class="s3">.</span><span class="s1">is_np_dtype</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s4">&quot;fc&quot;</span><span class="s3">):</span>
        <span class="s1">fmt_klass </span><span class="s3">= </span><span class="s1">FloatArrayFormatter</span>
    <span class="s2">elif </span><span class="s1">lib</span><span class="s3">.</span><span class="s1">is_np_dtype</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">dtype</span><span class="s3">, </span><span class="s4">&quot;iu&quot;</span><span class="s3">):</span>
        <span class="s1">fmt_klass </span><span class="s3">= </span><span class="s1">_IntArrayFormatter</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">fmt_klass </span><span class="s3">= </span><span class="s1">_GenericArrayFormatter</span>

    <span class="s2">if </span><span class="s1">space </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">space </span><span class="s3">= </span><span class="s6">12</span>

    <span class="s2">if </span><span class="s1">float_format </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">float_format </span><span class="s3">= </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.float_format&quot;</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">digits </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">digits </span><span class="s3">= </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.precision&quot;</span><span class="s3">)</span>

    <span class="s1">fmt_obj </span><span class="s3">= </span><span class="s1">fmt_klass</span><span class="s3">(</span>
        <span class="s1">values</span><span class="s3">,</span>
        <span class="s1">digits</span><span class="s3">=</span><span class="s1">digits</span><span class="s3">,</span>
        <span class="s1">na_rep</span><span class="s3">=</span><span class="s1">na_rep</span><span class="s3">,</span>
        <span class="s1">float_format</span><span class="s3">=</span><span class="s1">float_format</span><span class="s3">,</span>
        <span class="s1">formatter</span><span class="s3">=</span><span class="s1">formatter</span><span class="s3">,</span>
        <span class="s1">space</span><span class="s3">=</span><span class="s1">space</span><span class="s3">,</span>
        <span class="s1">justify</span><span class="s3">=</span><span class="s1">justify</span><span class="s3">,</span>
        <span class="s1">decimal</span><span class="s3">=</span><span class="s1">decimal</span><span class="s3">,</span>
        <span class="s1">leading_space</span><span class="s3">=</span><span class="s1">leading_space</span><span class="s3">,</span>
        <span class="s1">quoting</span><span class="s3">=</span><span class="s1">quoting</span><span class="s3">,</span>
        <span class="s1">fallback_formatter</span><span class="s3">=</span><span class="s1">fallback_formatter</span><span class="s3">,</span>
    <span class="s3">)</span>

    <span class="s2">return </span><span class="s1">fmt_obj</span><span class="s3">.</span><span class="s1">get_result</span><span class="s3">()</span>


<span class="s2">class </span><span class="s1">_GenericArrayFormatter</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">values</span><span class="s3">: </span><span class="s1">ArrayLike</span><span class="s3">,</span>
        <span class="s1">digits</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s6">7</span><span class="s3">,</span>
        <span class="s1">formatter</span><span class="s3">: </span><span class="s1">Callable </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">na_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaN&quot;</span><span class="s3">,</span>
        <span class="s1">space</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s1">int </span><span class="s3">= </span><span class="s6">12</span><span class="s3">,</span>
        <span class="s1">float_format</span><span class="s3">: </span><span class="s1">FloatFormatType </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">justify</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;right&quot;</span><span class="s3">,</span>
        <span class="s1">decimal</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;.&quot;</span><span class="s3">,</span>
        <span class="s1">quoting</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">fixed_width</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">leading_space</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">True</span><span class="s3">,</span>
        <span class="s1">fallback_formatter</span><span class="s3">: </span><span class="s1">Callable </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">values </span><span class="s3">= </span><span class="s1">values</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">digits </span><span class="s3">= </span><span class="s1">digits</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep </span><span class="s3">= </span><span class="s1">na_rep</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">space </span><span class="s3">= </span><span class="s1">space</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s3">= </span><span class="s1">formatter</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">float_format </span><span class="s3">= </span><span class="s1">float_format</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">justify </span><span class="s3">= </span><span class="s1">justify</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">decimal </span><span class="s3">= </span><span class="s1">decimal</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">quoting </span><span class="s3">= </span><span class="s1">quoting</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fixed_width </span><span class="s3">= </span><span class="s1">fixed_width</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">leading_space </span><span class="s3">= </span><span class="s1">leading_space</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fallback_formatter </span><span class="s3">= </span><span class="s1">fallback_formatter</span>

    <span class="s2">def </span><span class="s1">get_result</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s1">fmt_values </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_format_strings</span><span class="s3">()</span>
        <span class="s2">return </span><span class="s1">_make_fixed_width</span><span class="s3">(</span><span class="s1">fmt_values</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">justify</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_format_strings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">float_format </span><span class="s3">= </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.float_format&quot;</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">float_format </span><span class="s2">is None</span><span class="s3">:</span>
                <span class="s1">precision </span><span class="s3">= </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.precision&quot;</span><span class="s3">)</span>
                <span class="s1">float_format </span><span class="s3">= </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">_trim_zeros_single_float</span><span class="s3">(</span>
                    <span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">x</span><span class="s2">: </span><span class="s4">.</span><span class="s2">{</span><span class="s1">precision</span><span class="s2">:</span><span class="s4">d</span><span class="s2">}</span><span class="s4">f</span><span class="s2">}</span><span class="s4">&quot;</span>
                <span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">float_format </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter</span>
        <span class="s2">elif </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fallback_formatter </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fallback_formatter</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">quote_strings </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quoting </span><span class="s2">is not None and </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quoting </span><span class="s3">!= </span><span class="s1">QUOTE_NONE</span>
            <span class="s1">formatter </span><span class="s3">= </span><span class="s1">partial</span><span class="s3">(</span>
                <span class="s1">printing</span><span class="s3">.</span><span class="s1">pprint_thing</span><span class="s3">,</span>
                <span class="s1">escape_chars</span><span class="s3">=(</span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s2">\r</span><span class="s4">&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">),</span>
                <span class="s1">quote_strings</span><span class="s3">=</span><span class="s1">quote_strings</span><span class="s3">,</span>
            <span class="s3">)</span>

        <span class="s2">def </span><span class="s1">_format</span><span class="s3">(</span><span class="s1">x</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep </span><span class="s2">is not None and </span><span class="s1">is_scalar</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">and </span><span class="s1">isna</span><span class="s3">(</span><span class="s1">x</span><span class="s3">):</span>
                <span class="s2">if </span><span class="s1">x </span><span class="s2">is None</span><span class="s3">:</span>
                    <span class="s2">return </span><span class="s4">&quot;None&quot;</span>
                <span class="s2">elif </span><span class="s1">x </span><span class="s2">is </span><span class="s1">NA</span><span class="s3">:</span>
                    <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">NA</span><span class="s3">)</span>
                <span class="s2">elif </span><span class="s1">lib</span><span class="s3">.</span><span class="s1">is_float</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">and </span><span class="s1">np</span><span class="s3">.</span><span class="s1">isinf</span><span class="s3">(</span><span class="s1">x</span><span class="s3">):</span>
                    <span class="s5"># TODO(3.0): this will be unreachable when use_inf_as_na</span>
                    <span class="s5">#  deprecation is enforced</span>
                    <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
                <span class="s2">elif </span><span class="s1">x </span><span class="s2">is </span><span class="s1">NaT </span><span class="s2">or </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, (</span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">)):</span>
                    <span class="s2">return </span><span class="s4">&quot;NaT&quot;</span>
                <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span>
            <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">PandasObject</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
            <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">StringDtype</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">repr</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s5"># object dtype</span>
                <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">x</span><span class="s3">))</span>

        <span class="s1">vals </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span>
        <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ndarray</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">TypeError</span><span class="s3">(</span>
                <span class="s4">&quot;ExtensionArray formatting should use _ExtensionArrayFormatter&quot;</span>
            <span class="s3">)</span>
        <span class="s1">inferred </span><span class="s3">= </span><span class="s1">lib</span><span class="s3">.</span><span class="s1">map_infer</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">, </span><span class="s1">is_float</span><span class="s3">)</span>
        <span class="s1">is_float_type </span><span class="s3">= (</span>
            <span class="s1">inferred</span>
            <span class="s5"># vals may have 2 or more dimensions</span>
            <span class="s3">&amp; </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">notna</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">), </span><span class="s1">axis</span><span class="s3">=</span><span class="s1">tuple</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s6">1</span><span class="s3">, </span><span class="s1">len</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">))))</span>
        <span class="s3">)</span>
        <span class="s1">leading_space </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">leading_space</span>
        <span class="s2">if </span><span class="s1">leading_space </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">leading_space </span><span class="s3">= </span><span class="s1">is_float_type</span><span class="s3">.</span><span class="s1">any</span><span class="s3">()</span>

        <span class="s1">fmt_values </span><span class="s3">= []</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">v </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">vals</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s2">not </span><span class="s1">is_float_type</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] </span><span class="s2">or </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s2">is not None</span><span class="s3">) </span><span class="s2">and </span><span class="s1">leading_space</span><span class="s3">:</span>
                <span class="s1">fmt_values</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">f&quot; </span><span class="s2">{</span><span class="s1">_format</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
            <span class="s2">elif </span><span class="s1">is_float_type</span><span class="s3">[</span><span class="s1">i</span><span class="s3">]:</span>
                <span class="s1">fmt_values</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">float_format</span><span class="s3">(</span><span class="s1">v</span><span class="s3">))</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">if </span><span class="s1">leading_space </span><span class="s2">is False</span><span class="s3">:</span>
                    <span class="s5"># False specifically, so that the default is</span>
                    <span class="s5"># to include a space if we get here.</span>
                    <span class="s1">tpl </span><span class="s3">= </span><span class="s4">&quot;{v}&quot;</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">tpl </span><span class="s3">= </span><span class="s4">&quot; {v}&quot;</span>
                <span class="s1">fmt_values</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">tpl</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">v</span><span class="s3">=</span><span class="s1">_format</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)))</span>

        <span class="s2">return </span><span class="s1">fmt_values</span>


<span class="s2">class </span><span class="s1">FloatArrayFormatter</span><span class="s3">(</span><span class="s1">_GenericArrayFormatter</span><span class="s3">):</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>

        <span class="s5"># float_format is expected to be a string</span>
        <span class="s5"># formatter should be used to pass a function</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format </span><span class="s2">is not None and </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s5"># GH21625, GH22270</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">fixed_width </span><span class="s3">= </span><span class="s2">False</span>
            <span class="s2">if </span><span class="s1">callable</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format</span><span class="s3">):</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">float_format </span><span class="s3">= </span><span class="s2">None</span>

    <span class="s2">def </span><span class="s1">_value_formatter</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">float_format</span><span class="s3">: </span><span class="s1">FloatFormatType </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">threshold</span><span class="s3">: </span><span class="s1">float </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; Callable</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Returns a function to be applied on each value to format it&quot;&quot;&quot;</span>
        <span class="s5"># the float_format parameter supersedes self.float_format</span>
        <span class="s2">if </span><span class="s1">float_format </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">float_format </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format</span>

        <span class="s5"># we are going to compose different functions, to first convert to</span>
        <span class="s5"># a string, then replace the decimal symbol, and finally chop according</span>
        <span class="s5"># to the threshold</span>

        <span class="s5"># when there is no float_format, we use str instead of '%g'</span>
        <span class="s5"># because str(0.0) = '0.0' while '%g' % 0.0 = '0'</span>
        <span class="s2">if </span><span class="s1">float_format</span><span class="s3">:</span>

            <span class="s2">def </span><span class="s1">base_formatter</span><span class="s3">(</span><span class="s1">v</span><span class="s3">):</span>
                <span class="s2">assert </span><span class="s1">float_format </span><span class="s2">is not None  </span><span class="s5"># for mypy</span>
                <span class="s5"># error: &quot;str&quot; not callable</span>
                <span class="s5"># error: Unexpected keyword argument &quot;value&quot; for &quot;__call__&quot; of</span>
                <span class="s5"># &quot;EngFormatter&quot;</span>
                <span class="s2">return </span><span class="s3">(</span>
                    <span class="s1">float_format</span><span class="s3">(</span><span class="s1">value</span><span class="s3">=</span><span class="s1">v</span><span class="s3">)  </span><span class="s5"># type: ignore[operator,call-arg]</span>
                    <span class="s2">if </span><span class="s1">notna</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)</span>
                    <span class="s2">else </span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span>
                <span class="s3">)</span>

        <span class="s2">else</span><span class="s3">:</span>

            <span class="s2">def </span><span class="s1">base_formatter</span><span class="s3">(</span><span class="s1">v</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">v</span><span class="s3">) </span><span class="s2">if </span><span class="s1">notna</span><span class="s3">(</span><span class="s1">v</span><span class="s3">) </span><span class="s2">else </span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">decimal </span><span class="s3">!= </span><span class="s4">&quot;.&quot;</span><span class="s3">:</span>

            <span class="s2">def </span><span class="s1">decimal_formatter</span><span class="s3">(</span><span class="s1">v</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">base_formatter</span><span class="s3">(</span><span class="s1">v</span><span class="s3">).</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;.&quot;</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">decimal</span><span class="s3">, </span><span class="s6">1</span><span class="s3">)</span>

        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">decimal_formatter </span><span class="s3">= </span><span class="s1">base_formatter</span>

        <span class="s2">if </span><span class="s1">threshold </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">decimal_formatter</span>

        <span class="s2">def </span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">value</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">notna</span><span class="s3">(</span><span class="s1">value</span><span class="s3">):</span>
                <span class="s2">if </span><span class="s1">abs</span><span class="s3">(</span><span class="s1">value</span><span class="s3">) &gt; </span><span class="s1">threshold</span><span class="s3">:</span>
                    <span class="s2">return </span><span class="s1">decimal_formatter</span><span class="s3">(</span><span class="s1">value</span><span class="s3">)</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s2">return </span><span class="s1">decimal_formatter</span><span class="s3">(</span><span class="s6">0.0</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span>

        <span class="s2">return </span><span class="s1">formatter</span>

    <span class="s2">def </span><span class="s1">get_result_as_array</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; np</span><span class="s3">.</span><span class="s1">ndarray</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Returns the float values converted into strings using 
        the parameters given at initialisation, as a numpy array 
        &quot;&quot;&quot;</span>

        <span class="s2">def </span><span class="s1">format_with_na_rep</span><span class="s3">(</span><span class="s1">values</span><span class="s3">: </span><span class="s1">ArrayLike</span><span class="s3">, </span><span class="s1">formatter</span><span class="s3">: </span><span class="s1">Callable</span><span class="s3">, </span><span class="s1">na_rep</span><span class="s3">: </span><span class="s1">str</span><span class="s3">):</span>
            <span class="s1">mask </span><span class="s3">= </span><span class="s1">isna</span><span class="s3">(</span><span class="s1">values</span><span class="s3">)</span>
            <span class="s1">formatted </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span>
                <span class="s3">[</span>
                    <span class="s1">formatter</span><span class="s3">(</span><span class="s1">val</span><span class="s3">) </span><span class="s2">if not </span><span class="s1">m </span><span class="s2">else </span><span class="s1">na_rep</span>
                    <span class="s2">for </span><span class="s1">val</span><span class="s3">, </span><span class="s1">m </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">mask</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">())</span>
                <span class="s3">]</span>
            <span class="s3">).</span><span class="s1">reshape</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">formatted</span>

        <span class="s2">def </span><span class="s1">format_complex_with_na_rep</span><span class="s3">(</span>
            <span class="s1">values</span><span class="s3">: </span><span class="s1">ArrayLike</span><span class="s3">, </span><span class="s1">formatter</span><span class="s3">: </span><span class="s1">Callable</span><span class="s3">, </span><span class="s1">na_rep</span><span class="s3">: </span><span class="s1">str</span>
        <span class="s3">):</span>
            <span class="s1">real_values </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">real</span><span class="s3">(</span><span class="s1">values</span><span class="s3">).</span><span class="s1">ravel</span><span class="s3">()  </span><span class="s5"># type: ignore[arg-type]</span>
            <span class="s1">imag_values </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">imag</span><span class="s3">(</span><span class="s1">values</span><span class="s3">).</span><span class="s1">ravel</span><span class="s3">()  </span><span class="s5"># type: ignore[arg-type]</span>
            <span class="s1">real_mask</span><span class="s3">, </span><span class="s1">imag_mask </span><span class="s3">= </span><span class="s1">isna</span><span class="s3">(</span><span class="s1">real_values</span><span class="s3">), </span><span class="s1">isna</span><span class="s3">(</span><span class="s1">imag_values</span><span class="s3">)</span>
            <span class="s1">formatted_lst </span><span class="s3">= []</span>
            <span class="s2">for </span><span class="s1">val</span><span class="s3">, </span><span class="s1">real_val</span><span class="s3">, </span><span class="s1">imag_val</span><span class="s3">, </span><span class="s1">re_isna</span><span class="s3">, </span><span class="s1">im_isna </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span>
                <span class="s1">values</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                <span class="s1">real_values</span><span class="s3">,</span>
                <span class="s1">imag_values</span><span class="s3">,</span>
                <span class="s1">real_mask</span><span class="s3">,</span>
                <span class="s1">imag_mask</span><span class="s3">,</span>
            <span class="s3">):</span>
                <span class="s2">if not </span><span class="s1">re_isna </span><span class="s2">and not </span><span class="s1">im_isna</span><span class="s3">:</span>
                    <span class="s1">formatted_lst</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">val</span><span class="s3">))</span>
                <span class="s2">elif not </span><span class="s1">re_isna</span><span class="s3">:  </span><span class="s5"># xxx+nanj</span>
                    <span class="s1">formatted_lst</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">real_val</span><span class="s3">)</span><span class="s2">}</span><span class="s4">+</span><span class="s2">{</span><span class="s1">na_rep</span><span class="s2">}</span><span class="s4">j&quot;</span><span class="s3">)</span>
                <span class="s2">elif not </span><span class="s1">im_isna</span><span class="s3">:  </span><span class="s5"># nan[+/-]xxxj</span>
                    <span class="s5"># The imaginary part may either start with a &quot;-&quot; or a space</span>
                    <span class="s1">imag_formatted </span><span class="s3">= </span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">imag_val</span><span class="s3">).</span><span class="s1">strip</span><span class="s3">()</span>
                    <span class="s2">if </span><span class="s1">imag_formatted</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;-&quot;</span><span class="s3">):</span>
                        <span class="s1">formatted_lst</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">na_rep</span><span class="s2">}{</span><span class="s1">imag_formatted</span><span class="s2">}</span><span class="s4">j&quot;</span><span class="s3">)</span>
                    <span class="s2">else</span><span class="s3">:</span>
                        <span class="s1">formatted_lst</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">na_rep</span><span class="s2">}</span><span class="s4">+</span><span class="s2">{</span><span class="s1">imag_formatted</span><span class="s2">}</span><span class="s4">j&quot;</span><span class="s3">)</span>
                <span class="s2">else</span><span class="s3">:  </span><span class="s5"># nan+nanj</span>
                    <span class="s1">formatted_lst</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">na_rep</span><span class="s2">}</span><span class="s4">+</span><span class="s2">{</span><span class="s1">na_rep</span><span class="s2">}</span><span class="s4">j&quot;</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">formatted_lst</span><span class="s3">).</span><span class="s1">reshape</span><span class="s3">(</span><span class="s1">values</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">format_with_na_rep</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fixed_width</span><span class="s3">:</span>
            <span class="s1">threshold </span><span class="s3">= </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.chop_threshold&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">threshold </span><span class="s3">= </span><span class="s2">None</span>

        <span class="s5"># if we have a fixed_width, we'll need to try different float_format</span>
        <span class="s2">def </span><span class="s1">format_values_with</span><span class="s3">(</span><span class="s1">float_format</span><span class="s3">):</span>
            <span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_value_formatter</span><span class="s3">(</span><span class="s1">float_format</span><span class="s3">, </span><span class="s1">threshold</span><span class="s3">)</span>

            <span class="s5"># default formatter leaves a space to the left when formatting</span>
            <span class="s5"># floats, must be consistent for left-justifying NaNs (GH #25061)</span>
            <span class="s1">na_rep </span><span class="s3">= </span><span class="s4">&quot; &quot; </span><span class="s3">+ </span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep </span><span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">justify </span><span class="s3">== </span><span class="s4">&quot;left&quot; </span><span class="s2">else </span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span>

            <span class="s5"># different formatting strategies for complex and non-complex data</span>
            <span class="s5"># need to distinguish complex and float NaNs (GH #53762)</span>
            <span class="s1">values </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span>
            <span class="s1">is_complex </span><span class="s3">= </span><span class="s1">is_complex_dtype</span><span class="s3">(</span><span class="s1">values</span><span class="s3">)</span>

            <span class="s5"># separate the wheat from the chaff</span>
            <span class="s2">if </span><span class="s1">is_complex</span><span class="s3">:</span>
                <span class="s1">values </span><span class="s3">= </span><span class="s1">format_complex_with_na_rep</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, </span><span class="s1">formatter</span><span class="s3">, </span><span class="s1">na_rep</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">values </span><span class="s3">= </span><span class="s1">format_with_na_rep</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, </span><span class="s1">formatter</span><span class="s3">, </span><span class="s1">na_rep</span><span class="s3">)</span>

            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fixed_width</span><span class="s3">:</span>
                <span class="s2">if </span><span class="s1">is_complex</span><span class="s3">:</span>
                    <span class="s1">result </span><span class="s3">= </span><span class="s1">_trim_zeros_complex</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">decimal</span><span class="s3">)</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">result </span><span class="s3">= </span><span class="s1">_trim_zeros_float</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">decimal</span><span class="s3">)</span>
                <span class="s2">return </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;object&quot;</span><span class="s3">)</span>

            <span class="s2">return </span><span class="s1">values</span>

        <span class="s5"># There is a special default string when we are fixed-width</span>
        <span class="s5"># The default is otherwise to use str instead of a formatting string</span>
        <span class="s1">float_format</span><span class="s3">: </span><span class="s1">FloatFormatType </span><span class="s3">| </span><span class="s2">None</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fixed_width</span><span class="s3">:</span>
                <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">leading_space </span><span class="s2">is True</span><span class="s3">:</span>
                    <span class="s1">fmt_str </span><span class="s3">= </span><span class="s4">&quot;{value: .{digits:d}f}&quot;</span>
                <span class="s2">else</span><span class="s3">:</span>
                    <span class="s1">fmt_str </span><span class="s3">= </span><span class="s4">&quot;{value:.{digits:d}f}&quot;</span>
                <span class="s1">float_format </span><span class="s3">= </span><span class="s1">partial</span><span class="s3">(</span><span class="s1">fmt_str</span><span class="s3">.</span><span class="s1">format</span><span class="s3">, </span><span class="s1">digits</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">digits</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">float_format </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">float_format </span><span class="s3">= </span><span class="s2">lambda </span><span class="s1">value</span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format </span><span class="s3">% </span><span class="s1">value</span>

        <span class="s1">formatted_values </span><span class="s3">= </span><span class="s1">format_values_with</span><span class="s3">(</span><span class="s1">float_format</span><span class="s3">)</span>

        <span class="s2">if not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fixed_width</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">formatted_values</span>

        <span class="s5"># we need do convert to engineering format if some values are too small</span>
        <span class="s5"># and would appear as 0, or if some values are too big and take too</span>
        <span class="s5"># much space</span>

        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">formatted_values</span><span class="s3">) &gt; </span><span class="s6">0</span><span class="s3">:</span>
            <span class="s1">maxlen </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">formatted_values</span><span class="s3">)</span>
            <span class="s1">too_long </span><span class="s3">= </span><span class="s1">maxlen </span><span class="s3">&gt; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">digits </span><span class="s3">+ </span><span class="s6">6</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">too_long </span><span class="s3">= </span><span class="s2">False</span>

        <span class="s1">abs_vals </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">abs</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span><span class="s3">)</span>
        <span class="s5"># this is pretty arbitrary for now</span>
        <span class="s5"># large values: more that 8 characters including decimal symbol</span>
        <span class="s5"># and first digit, hence &gt; 1e6</span>
        <span class="s1">has_large_values </span><span class="s3">= (</span><span class="s1">abs_vals </span><span class="s3">&gt; </span><span class="s6">1e6</span><span class="s3">).</span><span class="s1">any</span><span class="s3">()</span>
        <span class="s1">has_small_values </span><span class="s3">= ((</span><span class="s1">abs_vals </span><span class="s3">&lt; </span><span class="s6">10 </span><span class="s3">** (-</span><span class="s1">self</span><span class="s3">.</span><span class="s1">digits</span><span class="s3">)) &amp; (</span><span class="s1">abs_vals </span><span class="s3">&gt; </span><span class="s6">0</span><span class="s3">)).</span><span class="s1">any</span><span class="s3">()</span>

        <span class="s2">if </span><span class="s1">has_small_values </span><span class="s2">or </span><span class="s3">(</span><span class="s1">too_long </span><span class="s2">and </span><span class="s1">has_large_values</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">leading_space </span><span class="s2">is True</span><span class="s3">:</span>
                <span class="s1">fmt_str </span><span class="s3">= </span><span class="s4">&quot;{value: .{digits:d}e}&quot;</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">fmt_str </span><span class="s3">= </span><span class="s4">&quot;{value:.{digits:d}e}&quot;</span>
            <span class="s1">float_format </span><span class="s3">= </span><span class="s1">partial</span><span class="s3">(</span><span class="s1">fmt_str</span><span class="s3">.</span><span class="s1">format</span><span class="s3">, </span><span class="s1">digits</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">digits</span><span class="s3">)</span>
            <span class="s1">formatted_values </span><span class="s3">= </span><span class="s1">format_values_with</span><span class="s3">(</span><span class="s1">float_format</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">formatted_values</span>

    <span class="s2">def </span><span class="s1">_format_strings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s2">return </span><span class="s1">list</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_result_as_array</span><span class="s3">())</span>


<span class="s2">class </span><span class="s1">_IntArrayFormatter</span><span class="s3">(</span><span class="s1">_GenericArrayFormatter</span><span class="s3">):</span>
    <span class="s2">def </span><span class="s1">_format_strings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">leading_space </span><span class="s2">is False</span><span class="s3">:</span>
            <span class="s1">formatter_str </span><span class="s3">= </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">x</span><span class="s2">:</span><span class="s4">d</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">formatter_str </span><span class="s3">= </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">x</span><span class="s2">: </span><span class="s4">d</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s2">or </span><span class="s1">formatter_str</span>
        <span class="s1">fmt_values </span><span class="s3">= [</span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span><span class="s3">]</span>
        <span class="s2">return </span><span class="s1">fmt_values</span>


<span class="s2">class </span><span class="s1">_Datetime64Formatter</span><span class="s3">(</span><span class="s1">_GenericArrayFormatter</span><span class="s3">):</span>
    <span class="s1">values</span><span class="s3">: </span><span class="s1">DatetimeArray</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">values</span><span class="s3">: </span><span class="s1">DatetimeArray</span><span class="s3">,</span>
        <span class="s1">nat_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaT&quot;</span><span class="s3">,</span>
        <span class="s1">date_format</span><span class="s3">: </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s3">**</span><span class="s1">kwargs</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">nat_rep </span><span class="s3">= </span><span class="s1">nat_rep</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">date_format </span><span class="s3">= </span><span class="s1">date_format</span>

    <span class="s2">def </span><span class="s1">_format_strings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s0">&quot;&quot;&quot;we by definition have DO NOT have a TZ&quot;&quot;&quot;</span>
        <span class="s1">values </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s3">[</span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">values</span><span class="s3">]</span>

        <span class="s1">fmt_values </span><span class="s3">= </span><span class="s1">values</span><span class="s3">.</span><span class="s1">_format_native_types</span><span class="s3">(</span>
            <span class="s1">na_rep</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">nat_rep</span><span class="s3">, </span><span class="s1">date_format</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">date_format</span>
        <span class="s3">)</span>
        <span class="s2">return </span><span class="s1">fmt_values</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">()</span>


<span class="s2">class </span><span class="s1">_ExtensionArrayFormatter</span><span class="s3">(</span><span class="s1">_GenericArrayFormatter</span><span class="s3">):</span>
    <span class="s1">values</span><span class="s3">: </span><span class="s1">ExtensionArray</span>

    <span class="s2">def </span><span class="s1">_format_strings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s1">values </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span>

        <span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter</span>
        <span class="s1">fallback_formatter </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s2">if </span><span class="s1">formatter </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">fallback_formatter </span><span class="s3">= </span><span class="s1">values</span><span class="s3">.</span><span class="s1">_formatter</span><span class="s3">(</span><span class="s1">boxed</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, </span><span class="s1">Categorical</span><span class="s3">):</span>
            <span class="s5"># Categorical is special for now, so that we can preserve tzinfo</span>
            <span class="s1">array </span><span class="s3">= </span><span class="s1">values</span><span class="s3">.</span><span class="s1">_internal_get_values</span><span class="s3">()</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">array </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">)</span>

        <span class="s1">fmt_values </span><span class="s3">= </span><span class="s1">format_array</span><span class="s3">(</span>
            <span class="s1">array</span><span class="s3">,</span>
            <span class="s1">formatter</span><span class="s3">,</span>
            <span class="s1">float_format</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">float_format</span><span class="s3">,</span>
            <span class="s1">na_rep</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">na_rep</span><span class="s3">,</span>
            <span class="s1">digits</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">digits</span><span class="s3">,</span>
            <span class="s1">space</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">space</span><span class="s3">,</span>
            <span class="s1">justify</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">justify</span><span class="s3">,</span>
            <span class="s1">decimal</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">decimal</span><span class="s3">,</span>
            <span class="s1">leading_space</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">leading_space</span><span class="s3">,</span>
            <span class="s1">quoting</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">quoting</span><span class="s3">,</span>
            <span class="s1">fallback_formatter</span><span class="s3">=</span><span class="s1">fallback_formatter</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s2">return </span><span class="s1">fmt_values</span>


<span class="s2">def </span><span class="s1">format_percentiles</span><span class="s3">(</span>
    <span class="s1">percentiles</span><span class="s3">: (</span><span class="s1">np</span><span class="s3">.</span><span class="s1">ndarray </span><span class="s3">| </span><span class="s1">Sequence</span><span class="s3">[</span><span class="s1">float</span><span class="s3">]),</span>
<span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
    Outputs rounded and formatted percentiles. 
 
    Parameters 
    ---------- 
    percentiles : list-like, containing floats from interval [0,1] 
 
    Returns 
    ------- 
    formatted : list of strings 
 
    Notes 
    ----- 
    Rounding precision is chosen so that: (1) if any two elements of 
    ``percentiles`` differ, they remain different after rounding 
    (2) no entry is *rounded* to 0% or 100%. 
    Any non-integer is always rounded to at least 1 decimal place. 
 
    Examples 
    -------- 
    Keeps all entries different after rounding: 
 
    &gt;&gt;&gt; format_percentiles([0.01999, 0.02001, 0.5, 0.666666, 0.9999]) 
    ['1.999%', '2.001%', '50%', '66.667%', '99.99%'] 
 
    No element is rounded to 0% or 100% (unless already equal to it). 
    Duplicates are allowed: 
 
    &gt;&gt;&gt; format_percentiles([0, 0.5, 0.02001, 0.5, 0.666666, 0.9999]) 
    ['0%', '50%', '2.0%', '50%', '66.67%', '99.99%'] 
    &quot;&quot;&quot;</span>
    <span class="s1">percentiles </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">percentiles</span><span class="s3">)</span>

    <span class="s5"># It checks for np.nan as well</span>
    <span class="s2">if </span><span class="s3">(</span>
        <span class="s2">not </span><span class="s1">is_numeric_dtype</span><span class="s3">(</span><span class="s1">percentiles</span><span class="s3">)</span>
        <span class="s2">or not </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">percentiles </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">)</span>
        <span class="s2">or not </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">percentiles </span><span class="s3">&lt;= </span><span class="s6">1</span><span class="s3">)</span>
    <span class="s3">):</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">&quot;percentiles should all be in the interval [0,1]&quot;</span><span class="s3">)</span>

    <span class="s1">percentiles </span><span class="s3">= </span><span class="s6">100 </span><span class="s3">* </span><span class="s1">percentiles</span>
    <span class="s1">prec </span><span class="s3">= </span><span class="s1">get_precision</span><span class="s3">(</span><span class="s1">percentiles</span><span class="s3">)</span>
    <span class="s1">percentiles_round_type </span><span class="s3">= </span><span class="s1">percentiles</span><span class="s3">.</span><span class="s1">round</span><span class="s3">(</span><span class="s1">prec</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">int</span><span class="s3">)</span>

    <span class="s1">int_idx </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">isclose</span><span class="s3">(</span><span class="s1">percentiles_round_type</span><span class="s3">, </span><span class="s1">percentiles</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">int_idx</span><span class="s3">):</span>
        <span class="s1">out </span><span class="s3">= </span><span class="s1">percentiles_round_type</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s3">[</span><span class="s1">i </span><span class="s3">+ </span><span class="s4">&quot;%&quot; </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">out</span><span class="s3">]</span>

    <span class="s1">unique_pcts </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">unique</span><span class="s3">(</span><span class="s1">percentiles</span><span class="s3">)</span>
    <span class="s1">prec </span><span class="s3">= </span><span class="s1">get_precision</span><span class="s3">(</span><span class="s1">unique_pcts</span><span class="s3">)</span>
    <span class="s1">out </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">empty_like</span><span class="s3">(</span><span class="s1">percentiles</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">)</span>
    <span class="s1">out</span><span class="s3">[</span><span class="s1">int_idx</span><span class="s3">] = </span><span class="s1">percentiles</span><span class="s3">[</span><span class="s1">int_idx</span><span class="s3">].</span><span class="s1">round</span><span class="s3">().</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">int</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)</span>

    <span class="s1">out</span><span class="s3">[~</span><span class="s1">int_idx</span><span class="s3">] = </span><span class="s1">percentiles</span><span class="s3">[~</span><span class="s1">int_idx</span><span class="s3">].</span><span class="s1">round</span><span class="s3">(</span><span class="s1">prec</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s3">[</span><span class="s1">i </span><span class="s3">+ </span><span class="s4">&quot;%&quot; </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">out</span><span class="s3">]</span>


<span class="s2">def </span><span class="s1">get_precision</span><span class="s3">(</span><span class="s1">array</span><span class="s3">: </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ndarray </span><span class="s3">| </span><span class="s1">Sequence</span><span class="s3">[</span><span class="s1">float</span><span class="s3">]) </span><span class="s1">-&gt; int</span><span class="s3">:</span>
    <span class="s1">to_begin </span><span class="s3">= </span><span class="s1">array</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] </span><span class="s2">if </span><span class="s1">array</span><span class="s3">[</span><span class="s6">0</span><span class="s3">] &gt; </span><span class="s6">0 </span><span class="s2">else None</span>
    <span class="s1">to_end </span><span class="s3">= </span><span class="s6">100 </span><span class="s3">- </span><span class="s1">array</span><span class="s3">[-</span><span class="s6">1</span><span class="s3">] </span><span class="s2">if </span><span class="s1">array</span><span class="s3">[-</span><span class="s6">1</span><span class="s3">] &lt; </span><span class="s6">100 </span><span class="s2">else None</span>
    <span class="s1">diff </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ediff1d</span><span class="s3">(</span><span class="s1">array</span><span class="s3">, </span><span class="s1">to_begin</span><span class="s3">=</span><span class="s1">to_begin</span><span class="s3">, </span><span class="s1">to_end</span><span class="s3">=</span><span class="s1">to_end</span><span class="s3">)</span>
    <span class="s1">diff </span><span class="s3">= </span><span class="s1">abs</span><span class="s3">(</span><span class="s1">diff</span><span class="s3">)</span>
    <span class="s1">prec </span><span class="s3">= -</span><span class="s1">np</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">log10</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">min</span><span class="s3">(</span><span class="s1">diff</span><span class="s3">))).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">int</span><span class="s3">)</span>
    <span class="s1">prec </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span><span class="s6">1</span><span class="s3">, </span><span class="s1">prec</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">prec</span>


<span class="s2">def </span><span class="s1">_format_datetime64</span><span class="s3">(</span><span class="s1">x</span><span class="s3">: </span><span class="s1">NaTType </span><span class="s3">| </span><span class="s1">Timestamp</span><span class="s3">, </span><span class="s1">nat_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaT&quot;</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
    <span class="s2">if </span><span class="s1">x </span><span class="s2">is </span><span class="s1">NaT</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">nat_rep</span>

    <span class="s5"># Timestamp.__str__ falls back to datetime.datetime.__str__ = isoformat(sep=' ')</span>
    <span class="s5"># so it already uses string formatting rather than strftime (faster).</span>
    <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_format_datetime64_dateonly</span><span class="s3">(</span>
    <span class="s1">x</span><span class="s3">: </span><span class="s1">NaTType </span><span class="s3">| </span><span class="s1">Timestamp</span><span class="s3">,</span>
    <span class="s1">nat_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaT&quot;</span><span class="s3">,</span>
    <span class="s1">date_format</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
<span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">NaTType</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">nat_rep</span>

    <span class="s2">if </span><span class="s1">date_format</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">x</span><span class="s3">.</span><span class="s1">strftime</span><span class="s3">(</span><span class="s1">date_format</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s5"># Timestamp._date_repr relies on string formatting (faster than strftime)</span>
        <span class="s2">return </span><span class="s1">x</span><span class="s3">.</span><span class="s1">_date_repr</span>


<span class="s2">def </span><span class="s1">get_format_datetime64</span><span class="s3">(</span>
    <span class="s1">is_dates_only</span><span class="s3">: </span><span class="s1">bool</span><span class="s3">, </span><span class="s1">nat_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaT&quot;</span><span class="s3">, </span><span class="s1">date_format</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span>
<span class="s3">) </span><span class="s1">-&gt; Callable</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Return a formatter callable taking a datetime64 as input and providing 
    a string as output&quot;&quot;&quot;</span>

    <span class="s2">if </span><span class="s1">is_dates_only</span><span class="s3">:</span>
        <span class="s2">return lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">_format_datetime64_dateonly</span><span class="s3">(</span>
            <span class="s1">x</span><span class="s3">, </span><span class="s1">nat_rep</span><span class="s3">=</span><span class="s1">nat_rep</span><span class="s3">, </span><span class="s1">date_format</span><span class="s3">=</span><span class="s1">date_format</span>
        <span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">_format_datetime64</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">nat_rep</span><span class="s3">=</span><span class="s1">nat_rep</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">_Datetime64TZFormatter</span><span class="s3">(</span><span class="s1">_Datetime64Formatter</span><span class="s3">):</span>
    <span class="s1">values</span><span class="s3">: </span><span class="s1">DatetimeArray</span>

    <span class="s2">def </span><span class="s1">_format_strings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s0">&quot;&quot;&quot;we by definition have a TZ&quot;&quot;&quot;</span>
        <span class="s1">ido </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span><span class="s3">.</span><span class="s1">_is_dates_only</span>
        <span class="s1">values </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>
        <span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s2">or </span><span class="s1">get_format_datetime64</span><span class="s3">(</span>
            <span class="s1">ido</span><span class="s3">, </span><span class="s1">date_format</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">date_format</span>
        <span class="s3">)</span>
        <span class="s1">fmt_values </span><span class="s3">= [</span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">values</span><span class="s3">]</span>

        <span class="s2">return </span><span class="s1">fmt_values</span>


<span class="s2">class </span><span class="s1">_Timedelta64Formatter</span><span class="s3">(</span><span class="s1">_GenericArrayFormatter</span><span class="s3">):</span>
    <span class="s1">values</span><span class="s3">: </span><span class="s1">TimedeltaArray</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">values</span><span class="s3">: </span><span class="s1">TimedeltaArray</span><span class="s3">,</span>
        <span class="s1">nat_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;NaT&quot;</span><span class="s3">,</span>
        <span class="s3">**</span><span class="s1">kwargs</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s5"># TODO: nat_rep is never passed, na_rep is.</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">values</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">nat_rep </span><span class="s3">= </span><span class="s1">nat_rep</span>

    <span class="s2">def </span><span class="s1">_format_strings</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s1">formatter </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">formatter </span><span class="s2">or </span><span class="s1">get_format_timedelta64</span><span class="s3">(</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">values</span><span class="s3">, </span><span class="s1">nat_rep</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">nat_rep</span><span class="s3">, </span><span class="s1">box</span><span class="s3">=</span><span class="s2">False</span>
        <span class="s3">)</span>
        <span class="s2">return </span><span class="s3">[</span><span class="s1">formatter</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">values</span><span class="s3">]</span>


<span class="s2">def </span><span class="s1">get_format_timedelta64</span><span class="s3">(</span>
    <span class="s1">values</span><span class="s3">: </span><span class="s1">TimedeltaArray</span><span class="s3">,</span>
    <span class="s1">nat_rep</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s1">float </span><span class="s3">= </span><span class="s4">&quot;NaT&quot;</span><span class="s3">,</span>
    <span class="s1">box</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">,</span>
<span class="s3">) </span><span class="s1">-&gt; Callable</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Return a formatter function for a range of timedeltas. 
    These will all have the same format argument 
 
    If box, then show the return in quotes 
    &quot;&quot;&quot;</span>
    <span class="s1">even_days </span><span class="s3">= </span><span class="s1">values</span><span class="s3">.</span><span class="s1">_is_dates_only</span>

    <span class="s2">if </span><span class="s1">even_days</span><span class="s3">:</span>
        <span class="s1">format </span><span class="s3">= </span><span class="s2">None</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">format </span><span class="s3">= </span><span class="s4">&quot;long&quot;</span>

    <span class="s2">def </span><span class="s1">_formatter</span><span class="s3">(</span><span class="s1">x</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">x </span><span class="s2">is None or </span><span class="s3">(</span><span class="s1">is_scalar</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">and </span><span class="s1">isna</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)):</span>
            <span class="s2">return </span><span class="s1">nat_rep</span>

        <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">Timedelta</span><span class="s3">):</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>

        <span class="s5"># Timedelta._repr_base uses string formatting (faster than strftime)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">x</span><span class="s3">.</span><span class="s1">_repr_base</span><span class="s3">(</span><span class="s1">format</span><span class="s3">=</span><span class="s1">format</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">box</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s4">f&quot;'</span><span class="s2">{</span><span class="s1">result</span><span class="s2">}</span><span class="s4">'&quot;</span>
        <span class="s2">return </span><span class="s1">result</span>

    <span class="s2">return </span><span class="s1">_formatter</span>


<span class="s2">def </span><span class="s1">_make_fixed_width</span><span class="s3">(</span>
    <span class="s1">strings</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">],</span>
    <span class="s1">justify</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;right&quot;</span><span class="s3">,</span>
    <span class="s1">minimum</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">adj</span><span class="s3">: </span><span class="s1">printing</span><span class="s3">.</span><span class="s1">_TextAdjustment </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
<span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">strings</span><span class="s3">) == </span><span class="s6">0 </span><span class="s2">or </span><span class="s1">justify </span><span class="s3">== </span><span class="s4">&quot;all&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">strings</span>

    <span class="s2">if </span><span class="s1">adj </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">adjustment </span><span class="s3">= </span><span class="s1">printing</span><span class="s3">.</span><span class="s1">get_adjustment</span><span class="s3">()</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">adjustment </span><span class="s3">= </span><span class="s1">adj</span>

    <span class="s1">max_len </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span><span class="s1">adjustment</span><span class="s3">.</span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">strings</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">minimum </span><span class="s2">is not None</span><span class="s3">:</span>
        <span class="s1">max_len </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span><span class="s1">minimum</span><span class="s3">, </span><span class="s1">max_len</span><span class="s3">)</span>

    <span class="s1">conf_max </span><span class="s3">= </span><span class="s1">get_option</span><span class="s3">(</span><span class="s4">&quot;display.max_colwidth&quot;</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">conf_max </span><span class="s2">is not None and </span><span class="s1">max_len </span><span class="s3">&gt; </span><span class="s1">conf_max</span><span class="s3">:</span>
        <span class="s1">max_len </span><span class="s3">= </span><span class="s1">conf_max</span>

    <span class="s2">def </span><span class="s1">just</span><span class="s3">(</span><span class="s1">x</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">conf_max </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s3">(</span><span class="s1">conf_max </span><span class="s3">&gt; </span><span class="s6">3</span><span class="s3">) &amp; (</span><span class="s1">adjustment</span><span class="s3">.</span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) &gt; </span><span class="s1">max_len</span><span class="s3">):</span>
                <span class="s1">x </span><span class="s3">= </span><span class="s1">x</span><span class="s3">[: </span><span class="s1">max_len </span><span class="s3">- </span><span class="s6">3</span><span class="s3">] + </span><span class="s4">&quot;...&quot;</span>
        <span class="s2">return </span><span class="s1">x</span>

    <span class="s1">strings </span><span class="s3">= [</span><span class="s1">just</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">strings</span><span class="s3">]</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">adjustment</span><span class="s3">.</span><span class="s1">justify</span><span class="s3">(</span><span class="s1">strings</span><span class="s3">, </span><span class="s1">max_len</span><span class="s3">, </span><span class="s1">mode</span><span class="s3">=</span><span class="s1">justify</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">result</span>


<span class="s2">def </span><span class="s1">_trim_zeros_complex</span><span class="s3">(</span><span class="s1">str_complexes</span><span class="s3">: </span><span class="s1">ArrayLike</span><span class="s3">, </span><span class="s1">decimal</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;.&quot;</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
    Separates the real and imaginary parts from the complex number, and 
    executes the _trim_zeros_float method on each of those. 
    &quot;&quot;&quot;</span>
    <span class="s1">real_part</span><span class="s3">, </span><span class="s1">imag_part </span><span class="s3">= [], []</span>
    <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">str_complexes</span><span class="s3">:</span>
        <span class="s5"># Complex numbers are represented as &quot;(-)xxx(+/-)xxxj&quot;</span>
        <span class="s5"># The split will give [{&quot;&quot;, &quot;-&quot;}, &quot;xxx&quot;, &quot;+/-&quot;, &quot;xxx&quot;, &quot;j&quot;, &quot;&quot;]</span>
        <span class="s5"># Therefore, the imaginary part is the 4th and 3rd last elements,</span>
        <span class="s5"># and the real part is everything before the imaginary part</span>
        <span class="s1">trimmed </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s4">r&quot;([j+-])&quot;</span><span class="s3">, </span><span class="s1">x</span><span class="s3">)</span>
        <span class="s1">real_part</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">trimmed</span><span class="s3">[:-</span><span class="s6">4</span><span class="s3">]))</span>
        <span class="s1">imag_part</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">trimmed</span><span class="s3">[-</span><span class="s6">4</span><span class="s3">:-</span><span class="s6">2</span><span class="s3">]))</span>

    <span class="s5"># We want to align the lengths of the real and imaginary parts of each complex</span>
    <span class="s5"># number, as well as the lengths the real (resp. complex) parts of all numbers</span>
    <span class="s5"># in the array</span>
    <span class="s1">n </span><span class="s3">= </span><span class="s1">len</span><span class="s3">(</span><span class="s1">str_complexes</span><span class="s3">)</span>
    <span class="s1">padded_parts </span><span class="s3">= </span><span class="s1">_trim_zeros_float</span><span class="s3">(</span><span class="s1">real_part </span><span class="s3">+ </span><span class="s1">imag_part</span><span class="s3">, </span><span class="s1">decimal</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">padded_parts</span><span class="s3">) == </span><span class="s6">0</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s3">[]</span>
    <span class="s1">padded_length </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">part</span><span class="s3">) </span><span class="s2">for </span><span class="s1">part </span><span class="s2">in </span><span class="s1">padded_parts</span><span class="s3">) - </span><span class="s6">1</span>
    <span class="s1">padded </span><span class="s3">= [</span>
        <span class="s1">real_pt  </span><span class="s5"># real part, possibly NaN</span>
        <span class="s3">+ </span><span class="s1">imag_pt</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]  </span><span class="s5"># +/-</span>
        <span class="s3">+ </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">imag_pt</span><span class="s3">[</span><span class="s6">1</span><span class="s3">:]</span><span class="s2">:</span><span class="s4">&gt;</span><span class="s2">{</span><span class="s1">padded_length</span><span class="s2">}}</span><span class="s4">&quot;  </span><span class="s5"># complex part (no sign), possibly nan</span>
        <span class="s3">+ </span><span class="s4">&quot;j&quot;</span>
        <span class="s2">for </span><span class="s1">real_pt</span><span class="s3">, </span><span class="s1">imag_pt </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">padded_parts</span><span class="s3">[:</span><span class="s1">n</span><span class="s3">], </span><span class="s1">padded_parts</span><span class="s3">[</span><span class="s1">n</span><span class="s3">:])</span>
    <span class="s3">]</span>
    <span class="s2">return </span><span class="s1">padded</span>


<span class="s2">def </span><span class="s1">_trim_zeros_single_float</span><span class="s3">(</span><span class="s1">str_float</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Trims trailing zeros after a decimal point, 
    leaving just one if necessary. 
    &quot;&quot;&quot;</span>
    <span class="s1">str_float </span><span class="s3">= </span><span class="s1">str_float</span><span class="s3">.</span><span class="s1">rstrip</span><span class="s3">(</span><span class="s4">&quot;0&quot;</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">str_float</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s4">&quot;.&quot;</span><span class="s3">):</span>
        <span class="s1">str_float </span><span class="s3">+= </span><span class="s4">&quot;0&quot;</span>

    <span class="s2">return </span><span class="s1">str_float</span>


<span class="s2">def </span><span class="s1">_trim_zeros_float</span><span class="s3">(</span>
    <span class="s1">str_floats</span><span class="s3">: </span><span class="s1">ArrayLike </span><span class="s3">| </span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">], </span><span class="s1">decimal</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;.&quot;</span>
<span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
    Trims the maximum number of trailing zeros equally from 
    all numbers containing decimals, leaving just one if 
    necessary. 
    &quot;&quot;&quot;</span>
    <span class="s1">trimmed </span><span class="s3">= </span><span class="s1">str_floats</span>
    <span class="s1">number_regex </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">compile</span><span class="s3">(</span><span class="s4">rf&quot;^\s*[\+-]?[0-9]+\</span><span class="s2">{</span><span class="s1">decimal</span><span class="s2">}</span><span class="s4">[0-9]*$&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">is_number_with_decimal</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">re</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">number_regex</span><span class="s3">, </span><span class="s1">x</span><span class="s3">) </span><span class="s2">is not None</span>

    <span class="s2">def </span><span class="s1">should_trim</span><span class="s3">(</span><span class="s1">values</span><span class="s3">: </span><span class="s1">ArrayLike </span><span class="s3">| </span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Determine if an array of strings should be trimmed. 
 
        Returns True if all numbers containing decimals (defined by the 
        above regular expression) within the array end in a zero, otherwise 
        returns False. 
        &quot;&quot;&quot;</span>
        <span class="s1">numbers </span><span class="s3">= [</span><span class="s1">x </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">values </span><span class="s2">if </span><span class="s1">is_number_with_decimal</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)]</span>
        <span class="s2">return </span><span class="s1">len</span><span class="s3">(</span><span class="s1">numbers</span><span class="s3">) &gt; </span><span class="s6">0 </span><span class="s2">and </span><span class="s1">all</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s4">&quot;0&quot;</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">numbers</span><span class="s3">)</span>

    <span class="s2">while </span><span class="s1">should_trim</span><span class="s3">(</span><span class="s1">trimmed</span><span class="s3">):</span>
        <span class="s1">trimmed </span><span class="s3">= [</span><span class="s1">x</span><span class="s3">[:-</span><span class="s6">1</span><span class="s3">] </span><span class="s2">if </span><span class="s1">is_number_with_decimal</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">else </span><span class="s1">x </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">trimmed</span><span class="s3">]</span>

    <span class="s5"># leave one 0 after the decimal points if need be.</span>
    <span class="s1">result </span><span class="s3">= [</span>
        <span class="s1">x </span><span class="s3">+ </span><span class="s4">&quot;0&quot; </span><span class="s2">if </span><span class="s1">is_number_with_decimal</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">and </span><span class="s1">x</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s1">decimal</span><span class="s3">) </span><span class="s2">else </span><span class="s1">x</span>
        <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">trimmed</span>
    <span class="s3">]</span>
    <span class="s2">return </span><span class="s1">result</span>


<span class="s2">def </span><span class="s1">_has_names</span><span class="s3">(</span><span class="s1">index</span><span class="s3">: </span><span class="s1">Index</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">index</span><span class="s3">, </span><span class="s1">MultiIndex</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">com</span><span class="s3">.</span><span class="s1">any_not_none</span><span class="s3">(*</span><span class="s1">index</span><span class="s3">.</span><span class="s1">names</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">index</span><span class="s3">.</span><span class="s1">name </span><span class="s2">is not None</span>


<span class="s2">class </span><span class="s1">EngFormatter</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Formats float values according to engineering format. 
 
    Based on matplotlib.ticker.EngFormatter 
    &quot;&quot;&quot;</span>

    <span class="s5"># The SI engineering prefixes</span>
    <span class="s1">ENG_PREFIXES </span><span class="s3">= {</span>
        <span class="s3">-</span><span class="s6">24</span><span class="s3">: </span><span class="s4">&quot;y&quot;</span><span class="s3">,</span>
        <span class="s3">-</span><span class="s6">21</span><span class="s3">: </span><span class="s4">&quot;z&quot;</span><span class="s3">,</span>
        <span class="s3">-</span><span class="s6">18</span><span class="s3">: </span><span class="s4">&quot;a&quot;</span><span class="s3">,</span>
        <span class="s3">-</span><span class="s6">15</span><span class="s3">: </span><span class="s4">&quot;f&quot;</span><span class="s3">,</span>
        <span class="s3">-</span><span class="s6">12</span><span class="s3">: </span><span class="s4">&quot;p&quot;</span><span class="s3">,</span>
        <span class="s3">-</span><span class="s6">9</span><span class="s3">: </span><span class="s4">&quot;n&quot;</span><span class="s3">,</span>
        <span class="s3">-</span><span class="s6">6</span><span class="s3">: </span><span class="s4">&quot;u&quot;</span><span class="s3">,</span>
        <span class="s3">-</span><span class="s6">3</span><span class="s3">: </span><span class="s4">&quot;m&quot;</span><span class="s3">,</span>
        <span class="s6">0</span><span class="s3">: </span><span class="s4">&quot;&quot;</span><span class="s3">,</span>
        <span class="s6">3</span><span class="s3">: </span><span class="s4">&quot;k&quot;</span><span class="s3">,</span>
        <span class="s6">6</span><span class="s3">: </span><span class="s4">&quot;M&quot;</span><span class="s3">,</span>
        <span class="s6">9</span><span class="s3">: </span><span class="s4">&quot;G&quot;</span><span class="s3">,</span>
        <span class="s6">12</span><span class="s3">: </span><span class="s4">&quot;T&quot;</span><span class="s3">,</span>
        <span class="s6">15</span><span class="s3">: </span><span class="s4">&quot;P&quot;</span><span class="s3">,</span>
        <span class="s6">18</span><span class="s3">: </span><span class="s4">&quot;E&quot;</span><span class="s3">,</span>
        <span class="s6">21</span><span class="s3">: </span><span class="s4">&quot;Z&quot;</span><span class="s3">,</span>
        <span class="s6">24</span><span class="s3">: </span><span class="s4">&quot;Y&quot;</span><span class="s3">,</span>
    <span class="s3">}</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">accuracy</span><span class="s3">: </span><span class="s1">int </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">, </span><span class="s1">use_eng_prefix</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">accuracy </span><span class="s3">= </span><span class="s1">accuracy</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">use_eng_prefix </span><span class="s3">= </span><span class="s1">use_eng_prefix</span>

    <span class="s2">def </span><span class="s1">__call__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">num</span><span class="s3">: </span><span class="s1">float</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Formats a number in engineering notation, appending a letter 
        representing the power of 1000 of the original number. Some examples: 
        &gt;&gt;&gt; format_eng = EngFormatter(accuracy=0, use_eng_prefix=True) 
        &gt;&gt;&gt; format_eng(0) 
        ' 0' 
        &gt;&gt;&gt; format_eng = EngFormatter(accuracy=1, use_eng_prefix=True) 
        &gt;&gt;&gt; format_eng(1_000_000) 
        ' 1.0M' 
        &gt;&gt;&gt; format_eng = EngFormatter(accuracy=2, use_eng_prefix=False) 
        &gt;&gt;&gt; format_eng(&quot;-1e-6&quot;) 
        '-1.00E-06' 
 
        @param num: the value to represent 
        @type num: either a numeric value or a string that can be converted to 
                   a numeric value (as per decimal.Decimal constructor) 
 
        @return: engineering formatted string 
        &quot;&quot;&quot;</span>
        <span class="s1">dnum </span><span class="s3">= </span><span class="s1">Decimal</span><span class="s3">(</span><span class="s1">str</span><span class="s3">(</span><span class="s1">num</span><span class="s3">))</span>

        <span class="s2">if </span><span class="s1">Decimal</span><span class="s3">.</span><span class="s1">is_nan</span><span class="s3">(</span><span class="s1">dnum</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s4">&quot;NaN&quot;</span>

        <span class="s2">if </span><span class="s1">Decimal</span><span class="s3">.</span><span class="s1">is_infinite</span><span class="s3">(</span><span class="s1">dnum</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s4">&quot;inf&quot;</span>

        <span class="s1">sign </span><span class="s3">= </span><span class="s6">1</span>

        <span class="s2">if </span><span class="s1">dnum </span><span class="s3">&lt; </span><span class="s6">0</span><span class="s3">:  </span><span class="s5"># pragma: no cover</span>
            <span class="s1">sign </span><span class="s3">= -</span><span class="s6">1</span>
            <span class="s1">dnum </span><span class="s3">= -</span><span class="s1">dnum</span>

        <span class="s2">if </span><span class="s1">dnum </span><span class="s3">!= </span><span class="s6">0</span><span class="s3">:</span>
            <span class="s1">pow10 </span><span class="s3">= </span><span class="s1">Decimal</span><span class="s3">(</span><span class="s1">int</span><span class="s3">(</span><span class="s1">math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">dnum</span><span class="s3">.</span><span class="s1">log10</span><span class="s3">() / </span><span class="s6">3</span><span class="s3">) * </span><span class="s6">3</span><span class="s3">))</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">pow10 </span><span class="s3">= </span><span class="s1">Decimal</span><span class="s3">(</span><span class="s6">0</span><span class="s3">)</span>

        <span class="s1">pow10 </span><span class="s3">= </span><span class="s1">pow10</span><span class="s3">.</span><span class="s1">min</span><span class="s3">(</span><span class="s1">max</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ENG_PREFIXES</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()))</span>
        <span class="s1">pow10 </span><span class="s3">= </span><span class="s1">pow10</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">min</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ENG_PREFIXES</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()))</span>
        <span class="s1">int_pow10 </span><span class="s3">= </span><span class="s1">int</span><span class="s3">(</span><span class="s1">pow10</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">use_eng_prefix</span><span class="s3">:</span>
            <span class="s1">prefix </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ENG_PREFIXES</span><span class="s3">[</span><span class="s1">int_pow10</span><span class="s3">]</span>
        <span class="s2">elif </span><span class="s1">int_pow10 </span><span class="s3">&lt; </span><span class="s6">0</span><span class="s3">:</span>
            <span class="s1">prefix </span><span class="s3">= </span><span class="s4">f&quot;E-</span><span class="s2">{</span><span class="s3">-</span><span class="s1">int_pow10</span><span class="s2">:</span><span class="s4">02d</span><span class="s2">}</span><span class="s4">&quot;</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">prefix </span><span class="s3">= </span><span class="s4">f&quot;E+</span><span class="s2">{</span><span class="s1">int_pow10</span><span class="s2">:</span><span class="s4">02d</span><span class="s2">}</span><span class="s4">&quot;</span>

        <span class="s1">mant </span><span class="s3">= </span><span class="s1">sign </span><span class="s3">* </span><span class="s1">dnum </span><span class="s3">/ (</span><span class="s6">10</span><span class="s3">**</span><span class="s1">pow10</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">accuracy </span><span class="s2">is None</span><span class="s3">:  </span><span class="s5"># pragma: no cover</span>
            <span class="s1">format_str </span><span class="s3">= </span><span class="s4">&quot;{mant: g}{prefix}&quot;</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">format_str </span><span class="s3">= </span><span class="s4">f&quot;</span><span class="s2">{{</span><span class="s4">mant: .</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">accuracy</span><span class="s2">:</span><span class="s4">d</span><span class="s2">}</span><span class="s4">f</span><span class="s2">}}{{</span><span class="s4">prefix</span><span class="s2">}}</span><span class="s4">&quot;</span>

        <span class="s1">formatted </span><span class="s3">= </span><span class="s1">format_str</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">mant</span><span class="s3">=</span><span class="s1">mant</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">=</span><span class="s1">prefix</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">formatted</span>


<span class="s2">def </span><span class="s1">set_eng_float_format</span><span class="s3">(</span><span class="s1">accuracy</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s6">3</span><span class="s3">, </span><span class="s1">use_eng_prefix</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Format float representation in DataFrame with SI notation. 
 
    Parameters 
    ---------- 
    accuracy : int, default 3 
        Number of decimal digits after the floating point. 
    use_eng_prefix : bool, default False 
        Whether to represent a value with SI prefixes. 
 
    Returns 
    ------- 
    None 
 
    Examples 
    -------- 
    &gt;&gt;&gt; df = pd.DataFrame([1e-9, 1e-3, 1, 1e3, 1e6]) 
    &gt;&gt;&gt; df 
                  0 
    0  1.000000e-09 
    1  1.000000e-03 
    2  1.000000e+00 
    3  1.000000e+03 
    4  1.000000e+06 
 
    &gt;&gt;&gt; pd.set_eng_float_format(accuracy=1) 
    &gt;&gt;&gt; df 
             0 
    0  1.0E-09 
    1  1.0E-03 
    2  1.0E+00 
    3  1.0E+03 
    4  1.0E+06 
 
    &gt;&gt;&gt; pd.set_eng_float_format(use_eng_prefix=True) 
    &gt;&gt;&gt; df 
            0 
    0  1.000n 
    1  1.000m 
    2   1.000 
    3  1.000k 
    4  1.000M 
 
    &gt;&gt;&gt; pd.set_eng_float_format(accuracy=1, use_eng_prefix=True) 
    &gt;&gt;&gt; df 
          0 
    0  1.0n 
    1  1.0m 
    2   1.0 
    3  1.0k 
    4  1.0M 
 
    &gt;&gt;&gt; pd.set_option(&quot;display.float_format&quot;, None)  # unset option 
    &quot;&quot;&quot;</span>
    <span class="s1">set_option</span><span class="s3">(</span><span class="s4">&quot;display.float_format&quot;</span><span class="s3">, </span><span class="s1">EngFormatter</span><span class="s3">(</span><span class="s1">accuracy</span><span class="s3">, </span><span class="s1">use_eng_prefix</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">get_level_lengths</span><span class="s3">(</span>
    <span class="s1">levels</span><span class="s3">: </span><span class="s1">Any</span><span class="s3">, </span><span class="s1">sentinel</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">| </span><span class="s1">object </span><span class="s3">| </span><span class="s1">str </span><span class="s3">= </span><span class="s4">&quot;&quot;</span>
<span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">dict</span><span class="s3">[</span><span class="s1">int</span><span class="s3">, </span><span class="s1">int</span><span class="s3">]]:</span>
    <span class="s0">&quot;&quot;&quot; 
    For each index in each level the function returns lengths of indexes. 
 
    Parameters 
    ---------- 
    levels : list of lists 
        List of values on for level. 
    sentinel : string, optional 
        Value which states that no new index starts on there. 
 
    Returns 
    ------- 
    Returns list of maps. For each level returns map of indexes (key is index 
    in row and value is length of index). 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">levels</span><span class="s3">) == </span><span class="s6">0</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s3">[]</span>

    <span class="s1">control </span><span class="s3">= [</span><span class="s2">True</span><span class="s3">] * </span><span class="s1">len</span><span class="s3">(</span><span class="s1">levels</span><span class="s3">[</span><span class="s6">0</span><span class="s3">])</span>

    <span class="s1">result </span><span class="s3">= []</span>
    <span class="s2">for </span><span class="s1">level </span><span class="s2">in </span><span class="s1">levels</span><span class="s3">:</span>
        <span class="s1">last_index </span><span class="s3">= </span><span class="s6">0</span>

        <span class="s1">lengths </span><span class="s3">= {}</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">key </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">level</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">control</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] </span><span class="s2">and </span><span class="s1">key </span><span class="s3">== </span><span class="s1">sentinel</span><span class="s3">:</span>
                <span class="s2">pass</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">control</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] = </span><span class="s2">False</span>
                <span class="s1">lengths</span><span class="s3">[</span><span class="s1">last_index</span><span class="s3">] = </span><span class="s1">i </span><span class="s3">- </span><span class="s1">last_index</span>
                <span class="s1">last_index </span><span class="s3">= </span><span class="s1">i</span>

        <span class="s1">lengths</span><span class="s3">[</span><span class="s1">last_index</span><span class="s3">] = </span><span class="s1">len</span><span class="s3">(</span><span class="s1">level</span><span class="s3">) - </span><span class="s1">last_index</span>

        <span class="s1">result</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">lengths</span><span class="s3">)</span>

    <span class="s2">return </span><span class="s1">result</span>


<span class="s2">def </span><span class="s1">buffer_put_lines</span><span class="s3">(</span><span class="s1">buf</span><span class="s3">: </span><span class="s1">WriteBuffer</span><span class="s3">[</span><span class="s1">str</span><span class="s3">], </span><span class="s1">lines</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Appends lines to a buffer. 
 
    Parameters 
    ---------- 
    buf 
        The buffer to write to 
    lines 
        The lines to append. 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">any</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">str</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">lines</span><span class="s3">):</span>
        <span class="s1">lines </span><span class="s3">= [</span><span class="s1">str</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">lines</span><span class="s3">]</span>
    <span class="s1">buf</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">lines</span><span class="s3">))</span>
</pre>
</body>
</html>