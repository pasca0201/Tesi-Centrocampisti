<html>
<head>
<title>holiday.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #5f826b; font-style: italic;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
holiday.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">datetime</span><span class="s2">,</span>
    <span class="s1">timedelta</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">from </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">relativedelta </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">FR</span><span class="s2">,</span>
    <span class="s1">MO</span><span class="s2">,</span>
    <span class="s1">SA</span><span class="s2">,</span>
    <span class="s1">SU</span><span class="s2">,</span>
    <span class="s1">TH</span><span class="s2">,</span>
    <span class="s1">TU</span><span class="s2">,</span>
    <span class="s1">WE</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">errors </span><span class="s0">import </span><span class="s1">PerformanceWarning</span>

<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DateOffset</span><span class="s2">,</span>
    <span class="s1">DatetimeIndex</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
    <span class="s1">concat</span><span class="s2">,</span>
    <span class="s1">date_range</span><span class="s2">,</span>
<span class="s2">)</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">tseries</span><span class="s2">.</span><span class="s1">offsets </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">Day</span><span class="s2">,</span>
    <span class="s1">Easter</span><span class="s2">,</span>
<span class="s2">)</span>


<span class="s0">def </span><span class="s1">next_monday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    If holiday falls on Saturday, use following Monday instead; 
    if holiday falls on Sunday, use Monday instead 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">5</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">+ </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">elif </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">6</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">+ </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">next_monday_or_tuesday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    For second holiday of two adjacent ones! 
    If holiday falls on Saturday, use following Monday instead; 
    if holiday falls on Sunday or Monday, use following Tuesday instead 
    (because Monday is already taken by adjacent holiday on the day before) 
    &quot;&quot;&quot;</span>
    <span class="s1">dow </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">dow </span><span class="s0">in </span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">+ </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">dow </span><span class="s2">== </span><span class="s4">0</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">+ </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">previous_friday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    If holiday falls on Saturday or Sunday, use previous Friday instead. 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">5</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">- </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">elif </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">6</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">- </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">sunday_to_monday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    If holiday falls on Sunday, use day thereafter (Monday) instead. 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">6</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">+ </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">weekend_to_monday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    If holiday falls on Sunday or Saturday, 
    use day thereafter (Monday) instead. 
    Needed for holidays such as Christmas observation in Europe 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">6</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">+ </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">elif </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">5</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">+ </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">nearest_workday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    If holiday falls on Saturday, use day before (Friday) instead; 
    if holiday falls on Sunday, use day thereafter (Monday) instead. 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">5</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">- </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">elif </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() == </span><span class="s4">6</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">dt </span><span class="s2">+ </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">next_workday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    returns next weekday used for observances 
    &quot;&quot;&quot;</span>
    <span class="s1">dt </span><span class="s2">+= </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">while </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() &gt; </span><span class="s4">4</span><span class="s2">:</span>
        <span class="s5"># Mon-Fri are 0-4</span>
        <span class="s1">dt </span><span class="s2">+= </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">previous_workday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    returns previous weekday used for observances 
    &quot;&quot;&quot;</span>
    <span class="s1">dt </span><span class="s2">-= </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">while </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">weekday</span><span class="s2">() &gt; </span><span class="s4">4</span><span class="s2">:</span>
        <span class="s5"># Mon-Fri are 0-4</span>
        <span class="s1">dt </span><span class="s2">-= </span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">dt</span>


<span class="s0">def </span><span class="s1">before_nearest_workday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    returns previous workday after nearest workday 
    &quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">previous_workday</span><span class="s2">(</span><span class="s1">nearest_workday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">after_nearest_workday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">: </span><span class="s1">datetime</span><span class="s2">) </span><span class="s1">-&gt; datetime</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    returns next workday after nearest workday 
    needed for Boxing day or multiple holidays in a series 
    &quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">next_workday</span><span class="s2">(</span><span class="s1">nearest_workday</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">Holiday</span><span class="s2">:</span>
    <span class="s3">&quot;&quot;&quot; 
    Class that defines a holiday with start/end dates and rules 
    for observance. 
    &quot;&quot;&quot;</span>

    <span class="s1">start_date</span><span class="s2">: </span><span class="s1">Timestamp </span><span class="s2">| </span><span class="s0">None</span>
    <span class="s1">end_date</span><span class="s2">: </span><span class="s1">Timestamp </span><span class="s2">| </span><span class="s0">None</span>
    <span class="s1">days_of_week</span><span class="s2">: </span><span class="s1">tuple</span><span class="s2">[</span><span class="s1">int</span><span class="s2">, ...] | </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
        <span class="s1">year</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">month</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">day</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">offset</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">observance</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">start_date</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">end_date</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">days_of_week</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s3">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        name : str 
            Name of the holiday , defaults to class name 
        offset : array of pandas.tseries.offsets or 
                class from pandas.tseries.offsets 
            computes offset from date 
        observance: function 
            computes when holiday is given a pandas Timestamp 
        days_of_week: 
            provide a tuple of days e.g  (0,1,2,3,) for Monday Through Thursday 
            Monday=0,..,Sunday=6 
 
        Examples 
        -------- 
        &gt;&gt;&gt; from dateutil.relativedelta import MO 
 
        &gt;&gt;&gt; USMemorialDay = pd.tseries.holiday.Holiday( 
        ...     &quot;Memorial Day&quot;, month=5, day=31, offset=pd.DateOffset(weekday=MO(-1)) 
        ... ) 
        &gt;&gt;&gt; USMemorialDay 
        Holiday: Memorial Day (month=5, day=31, offset=&lt;DateOffset: weekday=MO(-1)&gt;) 
 
        &gt;&gt;&gt; USLaborDay = pd.tseries.holiday.Holiday( 
        ...     &quot;Labor Day&quot;, month=9, day=1, offset=pd.DateOffset(weekday=MO(1)) 
        ... ) 
        &gt;&gt;&gt; USLaborDay 
        Holiday: Labor Day (month=9, day=1, offset=&lt;DateOffset: weekday=MO(+1)&gt;) 
 
        &gt;&gt;&gt; July3rd = pd.tseries.holiday.Holiday(&quot;July 3rd&quot;, month=7, day=3) 
        &gt;&gt;&gt; July3rd 
        Holiday: July 3rd (month=7, day=3, ) 
 
        &gt;&gt;&gt; NewYears = pd.tseries.holiday.Holiday( 
        ...     &quot;New Years Day&quot;, month=1,  day=1, 
        ...      observance=pd.tseries.holiday.nearest_workday 
        ... ) 
        &gt;&gt;&gt; NewYears  # doctest: +SKIP 
        Holiday: New Years Day ( 
            month=1, day=1, observance=&lt;function nearest_workday at 0x66545e9bc440&gt; 
        ) 
 
        &gt;&gt;&gt; July3rd = pd.tseries.holiday.Holiday( 
        ...     &quot;July 3rd&quot;, month=7, day=3, 
        ...     days_of_week=(0, 1, 2, 3) 
        ... ) 
        &gt;&gt;&gt; July3rd 
        Holiday: July 3rd (month=7, day=3, ) 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">offset </span><span class="s0">is not None and </span><span class="s1">observance </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">NotImplementedError</span><span class="s2">(</span><span class="s6">&quot;Cannot use both offset and observance.&quot;</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">year </span><span class="s2">= </span><span class="s1">year</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">month </span><span class="s2">= </span><span class="s1">month</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">day </span><span class="s2">= </span><span class="s1">day</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">offset </span><span class="s2">= </span><span class="s1">offset</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">start_date </span><span class="s2">= (</span>
            <span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">start_date</span><span class="s2">) </span><span class="s0">if </span><span class="s1">start_date </span><span class="s0">is not None else </span><span class="s1">start_date</span>
        <span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">end_date </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">end_date</span><span class="s2">) </span><span class="s0">if </span><span class="s1">end_date </span><span class="s0">is not None else </span><span class="s1">end_date</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">observance </span><span class="s2">= </span><span class="s1">observance</span>
        <span class="s0">assert </span><span class="s1">days_of_week </span><span class="s0">is None or </span><span class="s1">type</span><span class="s2">(</span><span class="s1">days_of_week</span><span class="s2">) == </span><span class="s1">tuple</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">days_of_week </span><span class="s2">= </span><span class="s1">days_of_week</span>

    <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; str</span><span class="s2">:</span>
        <span class="s1">info </span><span class="s2">= </span><span class="s6">&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">year </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">info </span><span class="s2">+= </span><span class="s6">f&quot;year=</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">year</span><span class="s0">}</span><span class="s6">, &quot;</span>
        <span class="s1">info </span><span class="s2">+= </span><span class="s6">f&quot;month=</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">month</span><span class="s0">}</span><span class="s6">, day=</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">day</span><span class="s0">}</span><span class="s6">, &quot;</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">offset </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">info </span><span class="s2">+= </span><span class="s6">f&quot;offset=</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">offset</span><span class="s0">}</span><span class="s6">&quot;</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">observance </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">info </span><span class="s2">+= </span><span class="s6">f&quot;observance=</span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">observance</span><span class="s0">}</span><span class="s6">&quot;</span>

        <span class="s1">repr </span><span class="s2">= </span><span class="s6">f&quot;Holiday: </span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s0">} </span><span class="s6">(</span><span class="s0">{</span><span class="s1">info</span><span class="s0">}</span><span class="s6">)&quot;</span>
        <span class="s0">return </span><span class="s1">repr</span>

    <span class="s0">def </span><span class="s1">dates</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">start_date</span><span class="s2">, </span><span class="s1">end_date</span><span class="s2">, </span><span class="s1">return_name</span><span class="s2">: </span><span class="s1">bool </span><span class="s2">= </span><span class="s0">False</span>
    <span class="s2">) </span><span class="s1">-&gt; Series </span><span class="s2">| </span><span class="s1">DatetimeIndex</span><span class="s2">:</span>
        <span class="s3">&quot;&quot;&quot; 
        Calculate holidays observed between start date and end date 
 
        Parameters 
        ---------- 
        start_date : starting date, datetime-like, optional 
        end_date : ending date, datetime-like, optional 
        return_name : bool, optional, default=False 
            If True, return a series that has dates and holiday names. 
            False will only return dates. 
 
        Returns 
        ------- 
        Series or DatetimeIndex 
            Series if return_name is True 
        &quot;&quot;&quot;</span>
        <span class="s1">start_date </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">start_date</span><span class="s2">)</span>
        <span class="s1">end_date </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">end_date</span><span class="s2">)</span>

        <span class="s1">filter_start_date </span><span class="s2">= </span><span class="s1">start_date</span>
        <span class="s1">filter_end_date </span><span class="s2">= </span><span class="s1">end_date</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">year </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">dt </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">year</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">month</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">day</span><span class="s2">))</span>
            <span class="s1">dti </span><span class="s2">= </span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s1">dt</span><span class="s2">])</span>
            <span class="s0">if </span><span class="s1">return_name</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">dti</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">dti</span>

        <span class="s1">dates </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_reference_dates</span><span class="s2">(</span><span class="s1">start_date</span><span class="s2">, </span><span class="s1">end_date</span><span class="s2">)</span>
        <span class="s1">holiday_dates </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_apply_rule</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">days_of_week </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">holiday_dates </span><span class="s2">= </span><span class="s1">holiday_dates</span><span class="s2">[</span>
                <span class="s1">np</span><span class="s2">.</span><span class="s1">isin</span><span class="s2">(</span>
                    <span class="s5"># error: &quot;DatetimeIndex&quot; has no attribute &quot;dayofweek&quot;</span>
                    <span class="s1">holiday_dates</span><span class="s2">.</span><span class="s1">dayofweek</span><span class="s2">,  </span><span class="s5"># type: ignore[attr-defined]</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">days_of_week</span><span class="s2">,</span>
                <span class="s2">).</span><span class="s1">ravel</span><span class="s2">()</span>
            <span class="s2">]</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">start_date </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">filter_start_date </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">start_date</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s1">filter_start_date</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">), </span><span class="s1">filter_start_date</span>
            <span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">end_date </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">filter_end_date </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">end_date</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s1">filter_end_date</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">), </span><span class="s1">filter_end_date</span>
            <span class="s2">)</span>
        <span class="s1">holiday_dates </span><span class="s2">= </span><span class="s1">holiday_dates</span><span class="s2">[</span>
            <span class="s2">(</span><span class="s1">holiday_dates </span><span class="s2">&gt;= </span><span class="s1">filter_start_date</span><span class="s2">) &amp; (</span><span class="s1">holiday_dates </span><span class="s2">&lt;= </span><span class="s1">filter_end_date</span><span class="s2">)</span>
        <span class="s2">]</span>
        <span class="s0">if </span><span class="s1">return_name</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">holiday_dates</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">holiday_dates</span>

    <span class="s0">def </span><span class="s1">_reference_dates</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">start_date</span><span class="s2">: </span><span class="s1">Timestamp</span><span class="s2">, </span><span class="s1">end_date</span><span class="s2">: </span><span class="s1">Timestamp</span>
    <span class="s2">) </span><span class="s1">-&gt; DatetimeIndex</span><span class="s2">:</span>
        <span class="s3">&quot;&quot;&quot; 
        Get reference dates for the holiday. 
 
        Return reference dates for the holiday also returning the year 
        prior to the start_date and year following the end_date.  This ensures 
        that any offsets to be applied will yield the holidays within 
        the passed in dates. 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">start_date </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">start_date </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">start_date</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s1">start_date</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">end_date </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">end_date </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">end_date</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s1">start_date</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">)</span>

        <span class="s1">year_offset </span><span class="s2">= </span><span class="s1">DateOffset</span><span class="s2">(</span><span class="s1">years</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">reference_start_date </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span>
            <span class="s1">datetime</span><span class="s2">(</span><span class="s1">start_date</span><span class="s2">.</span><span class="s1">year </span><span class="s2">- </span><span class="s4">1</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">month</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">day</span><span class="s2">)</span>
        <span class="s2">)</span>

        <span class="s1">reference_end_date </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span>
            <span class="s1">datetime</span><span class="s2">(</span><span class="s1">end_date</span><span class="s2">.</span><span class="s1">year </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">month</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">day</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s5"># Don't process unnecessary holidays</span>
        <span class="s1">dates </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span>
            <span class="s1">start</span><span class="s2">=</span><span class="s1">reference_start_date</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">=</span><span class="s1">reference_end_date</span><span class="s2">,</span>
            <span class="s1">freq</span><span class="s2">=</span><span class="s1">year_offset</span><span class="s2">,</span>
            <span class="s1">tz</span><span class="s2">=</span><span class="s1">start_date</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">,</span>
        <span class="s2">)</span>

        <span class="s0">return </span><span class="s1">dates</span>

    <span class="s0">def </span><span class="s1">_apply_rule</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dates</span><span class="s2">: </span><span class="s1">DatetimeIndex</span><span class="s2">) </span><span class="s1">-&gt; DatetimeIndex</span><span class="s2">:</span>
        <span class="s3">&quot;&quot;&quot; 
        Apply the given offset/observance to a DatetimeIndex of dates. 
 
        Parameters 
        ---------- 
        dates : DatetimeIndex 
            Dates to apply the given offset/observance rule 
 
        Returns 
        ------- 
        Dates with rules applied 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">dates</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">dates</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">observance </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">dates</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">d</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">observance</span><span class="s2">(</span><span class="s1">d</span><span class="s2">))</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">offset </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">, </span><span class="s1">list</span><span class="s2">):</span>
                <span class="s1">offsets </span><span class="s2">= [</span><span class="s1">self</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">]</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">offsets </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">offset</span>
            <span class="s0">for </span><span class="s1">offset </span><span class="s0">in </span><span class="s1">offsets</span><span class="s2">:</span>
                <span class="s5"># if we are adding a non-vectorized value</span>
                <span class="s5"># ignore the PerformanceWarnings:</span>
                <span class="s0">with </span><span class="s1">warnings</span><span class="s2">.</span><span class="s1">catch_warnings</span><span class="s2">():</span>
                    <span class="s1">warnings</span><span class="s2">.</span><span class="s1">simplefilter</span><span class="s2">(</span><span class="s6">&quot;ignore&quot;</span><span class="s2">, </span><span class="s1">PerformanceWarning</span><span class="s2">)</span>
                    <span class="s1">dates </span><span class="s2">+= </span><span class="s1">offset</span>
        <span class="s0">return </span><span class="s1">dates</span>


<span class="s1">holiday_calendars </span><span class="s2">= {}</span>


<span class="s0">def </span><span class="s1">register</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">name </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">name</span>
    <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
        <span class="s1">name </span><span class="s2">= </span><span class="s1">cls</span><span class="s2">.</span><span class="s1">__name__</span>
    <span class="s1">holiday_calendars</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">cls</span>


<span class="s0">def </span><span class="s1">get_calendar</span><span class="s2">(</span><span class="s1">name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">):</span>
    <span class="s3">&quot;&quot;&quot; 
    Return an instance of a calendar based on its name. 
 
    Parameters 
    ---------- 
    name : str 
        Calendar name to return an instance of 
    &quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">holiday_calendars</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]()</span>


<span class="s0">class </span><span class="s1">HolidayCalendarMetaClass</span><span class="s2">(</span><span class="s1">type</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">clsname</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">bases</span><span class="s2">, </span><span class="s1">attrs</span><span class="s2">):</span>
        <span class="s1">calendar_class </span><span class="s2">= </span><span class="s1">super</span><span class="s2">().</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">clsname</span><span class="s2">, </span><span class="s1">bases</span><span class="s2">, </span><span class="s1">attrs</span><span class="s2">)</span>
        <span class="s1">register</span><span class="s2">(</span><span class="s1">calendar_class</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">calendar_class</span>


<span class="s0">class </span><span class="s1">AbstractHolidayCalendar</span><span class="s2">(</span><span class="s1">metaclass</span><span class="s2">=</span><span class="s1">HolidayCalendarMetaClass</span><span class="s2">):</span>
    <span class="s3">&quot;&quot;&quot; 
    Abstract interface to create holidays following certain rules. 
    &quot;&quot;&quot;</span>

    <span class="s1">rules</span><span class="s2">: </span><span class="s1">list</span><span class="s2">[</span><span class="s1">Holiday</span><span class="s2">] = []</span>
    <span class="s1">start_date </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1970</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
    <span class="s1">end_date </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2200</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">31</span><span class="s2">))</span>
    <span class="s1">_cache </span><span class="s2">= </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">: </span><span class="s1">str </span><span class="s2">= </span><span class="s6">&quot;&quot;</span><span class="s2">, </span><span class="s1">rules</span><span class="s2">=</span><span class="s0">None</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s3">&quot;&quot;&quot; 
        Initializes holiday object with a given set a rules.  Normally 
        classes just have the rules defined within them. 
 
        Parameters 
        ---------- 
        name : str 
            Name of the holiday calendar, defaults to class name 
        rules : array of Holiday objects 
            A set of rules used to create the holidays. 
        &quot;&quot;&quot;</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">()</span>
        <span class="s0">if not </span><span class="s1">name</span><span class="s2">:</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">).</span><span class="s1">__name__</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s1">name</span>

        <span class="s0">if </span><span class="s1">rules </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">rules </span><span class="s2">= </span><span class="s1">rules</span>

    <span class="s0">def </span><span class="s1">rule_from_name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">rule </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rules</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">rule</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s1">name</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">rule</span>

        <span class="s0">return None</span>

    <span class="s0">def </span><span class="s1">holidays</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">return_name</span><span class="s2">: </span><span class="s1">bool </span><span class="s2">= </span><span class="s0">False</span><span class="s2">):</span>
        <span class="s3">&quot;&quot;&quot; 
        Returns a curve with holidays between start_date and end_date 
 
        Parameters 
        ---------- 
        start : starting date, datetime-like, optional 
        end : ending date, datetime-like, optional 
        return_name : bool, optional 
            If True, return a series that has dates and holiday names. 
            False will only return a DatetimeIndex of dates. 
 
        Returns 
        ------- 
            DatetimeIndex of holidays 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rules </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">Exception</span><span class="s2">(</span>
                <span class="s6">f&quot;Holiday Calendar </span><span class="s0">{</span><span class="s1">self</span><span class="s2">.</span><span class="s1">name</span><span class="s0">} </span><span class="s6">does not have any rules specified&quot;</span>
            <span class="s2">)</span>

        <span class="s0">if </span><span class="s1">start </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">start </span><span class="s2">= </span><span class="s1">AbstractHolidayCalendar</span><span class="s2">.</span><span class="s1">start_date</span>

        <span class="s0">if </span><span class="s1">end </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">end </span><span class="s2">= </span><span class="s1">AbstractHolidayCalendar</span><span class="s2">.</span><span class="s1">end_date</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">start</span><span class="s2">)</span>
        <span class="s1">end </span><span class="s2">= </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s1">end</span><span class="s2">)</span>

        <span class="s5"># If we don't have a cache or the dates are outside the prior cache, we</span>
        <span class="s5"># get them again</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_cache </span><span class="s0">is None or </span><span class="s1">start </span><span class="s2">&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_cache</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] </span><span class="s0">or </span><span class="s1">end </span><span class="s2">&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_cache</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]:</span>
            <span class="s1">pre_holidays </span><span class="s2">= [</span>
                <span class="s1">rule</span><span class="s2">.</span><span class="s1">dates</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">return_name</span><span class="s2">=</span><span class="s0">True</span><span class="s2">) </span><span class="s0">for </span><span class="s1">rule </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">rules</span>
            <span class="s2">]</span>
            <span class="s0">if </span><span class="s1">pre_holidays</span><span class="s2">:</span>
                <span class="s5"># error: Argument 1 to &quot;concat&quot; has incompatible type</span>
                <span class="s5"># &quot;List[Union[Series, DatetimeIndex]]&quot;; expected</span>
                <span class="s5"># &quot;Union[Iterable[DataFrame], Mapping[&lt;nothing&gt;, DataFrame]]&quot;</span>
                <span class="s1">holidays </span><span class="s2">= </span><span class="s1">concat</span><span class="s2">(</span><span class="s1">pre_holidays</span><span class="s2">)  </span><span class="s5"># type: ignore[arg-type]</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s5"># error: Incompatible types in assignment (expression has type</span>
                <span class="s5"># &quot;Series&quot;, variable has type &quot;DataFrame&quot;)</span>
                <span class="s1">holidays </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
                    <span class="s1">index</span><span class="s2">=</span><span class="s1">DatetimeIndex</span><span class="s2">([]), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span>
                <span class="s2">)  </span><span class="s5"># type: ignore[assignment]</span>

            <span class="s1">self</span><span class="s2">.</span><span class="s1">_cache </span><span class="s2">= (</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">holidays</span><span class="s2">.</span><span class="s1">sort_index</span><span class="s2">())</span>

        <span class="s1">holidays </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_cache</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]</span>
        <span class="s1">holidays </span><span class="s2">= </span><span class="s1">holidays</span><span class="s2">[</span><span class="s1">start</span><span class="s2">:</span><span class="s1">end</span><span class="s2">]</span>

        <span class="s0">if </span><span class="s1">return_name</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">holidays</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">holidays</span><span class="s2">.</span><span class="s1">index</span>

    <span class="s2">@</span><span class="s1">staticmethod</span>
    <span class="s0">def </span><span class="s1">merge_class</span><span class="s2">(</span><span class="s1">base</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s3">&quot;&quot;&quot; 
        Merge holiday calendars together. The base calendar 
        will take precedence to other. The merge will be done 
        based on each holiday's name. 
 
        Parameters 
        ---------- 
        base : AbstractHolidayCalendar 
          instance/subclass or array of Holiday objects 
        other : AbstractHolidayCalendar 
          instance/subclass or array of Holiday objects 
        &quot;&quot;&quot;</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">other </span><span class="s2">= </span><span class="s1">other</span><span class="s2">.</span><span class="s1">rules</span>
        <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
            <span class="s0">pass</span>

        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">other</span><span class="s2">, </span><span class="s1">list</span><span class="s2">):</span>
            <span class="s1">other </span><span class="s2">= [</span><span class="s1">other</span><span class="s2">]</span>
        <span class="s1">other_holidays </span><span class="s2">= {</span><span class="s1">holiday</span><span class="s2">.</span><span class="s1">name</span><span class="s2">: </span><span class="s1">holiday </span><span class="s0">for </span><span class="s1">holiday </span><span class="s0">in </span><span class="s1">other</span><span class="s2">}</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">base </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">rules</span>
        <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
            <span class="s0">pass</span>

        <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">base</span><span class="s2">, </span><span class="s1">list</span><span class="s2">):</span>
            <span class="s1">base </span><span class="s2">= [</span><span class="s1">base</span><span class="s2">]</span>
        <span class="s1">base_holidays </span><span class="s2">= {</span><span class="s1">holiday</span><span class="s2">.</span><span class="s1">name</span><span class="s2">: </span><span class="s1">holiday </span><span class="s0">for </span><span class="s1">holiday </span><span class="s0">in </span><span class="s1">base</span><span class="s2">}</span>

        <span class="s1">other_holidays</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">base_holidays</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">list</span><span class="s2">(</span><span class="s1">other_holidays</span><span class="s2">.</span><span class="s1">values</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">merge</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, </span><span class="s1">inplace</span><span class="s2">: </span><span class="s1">bool </span><span class="s2">= </span><span class="s0">False</span><span class="s2">):</span>
        <span class="s3">&quot;&quot;&quot; 
        Merge holiday calendars together.  The caller's class 
        rules take precedence.  The merge will be done 
        based on each holiday's name. 
 
        Parameters 
        ---------- 
        other : holiday calendar 
        inplace : bool (default=False) 
            If True set rule_table to holidays, else return array of Holidays 
        &quot;&quot;&quot;</span>
        <span class="s1">holidays </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">merge_class</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">inplace</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">rules </span><span class="s2">= </span><span class="s1">holidays</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">holidays</span>


<span class="s1">USMemorialDay </span><span class="s2">= </span><span class="s1">Holiday</span><span class="s2">(</span>
    <span class="s6">&quot;Memorial Day&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">5</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">31</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">DateOffset</span><span class="s2">(</span><span class="s1">weekday</span><span class="s2">=</span><span class="s1">MO</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">))</span>
<span class="s2">)</span>
<span class="s1">USLaborDay </span><span class="s2">= </span><span class="s1">Holiday</span><span class="s2">(</span><span class="s6">&quot;Labor Day&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">9</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">DateOffset</span><span class="s2">(</span><span class="s1">weekday</span><span class="s2">=</span><span class="s1">MO</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)))</span>
<span class="s1">USColumbusDay </span><span class="s2">= </span><span class="s1">Holiday</span><span class="s2">(</span>
    <span class="s6">&quot;Columbus Day&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">DateOffset</span><span class="s2">(</span><span class="s1">weekday</span><span class="s2">=</span><span class="s1">MO</span><span class="s2">(</span><span class="s4">2</span><span class="s2">))</span>
<span class="s2">)</span>
<span class="s1">USThanksgivingDay </span><span class="s2">= </span><span class="s1">Holiday</span><span class="s2">(</span>
    <span class="s6">&quot;Thanksgiving Day&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">11</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">DateOffset</span><span class="s2">(</span><span class="s1">weekday</span><span class="s2">=</span><span class="s1">TH</span><span class="s2">(</span><span class="s4">4</span><span class="s2">))</span>
<span class="s2">)</span>
<span class="s1">USMartinLutherKingJr </span><span class="s2">= </span><span class="s1">Holiday</span><span class="s2">(</span>
    <span class="s6">&quot;Birthday of Martin Luther King, Jr.&quot;</span><span class="s2">,</span>
    <span class="s1">start_date</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1986</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),</span>
    <span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">,</span>
    <span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">,</span>
    <span class="s1">offset</span><span class="s2">=</span><span class="s1">DateOffset</span><span class="s2">(</span><span class="s1">weekday</span><span class="s2">=</span><span class="s1">MO</span><span class="s2">(</span><span class="s4">3</span><span class="s2">)),</span>
<span class="s2">)</span>
<span class="s1">USPresidentsDay </span><span class="s2">= </span><span class="s1">Holiday</span><span class="s2">(</span>
    <span class="s6">&quot;Washington's Birthday&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">DateOffset</span><span class="s2">(</span><span class="s1">weekday</span><span class="s2">=</span><span class="s1">MO</span><span class="s2">(</span><span class="s4">3</span><span class="s2">))</span>
<span class="s2">)</span>
<span class="s1">GoodFriday </span><span class="s2">= </span><span class="s1">Holiday</span><span class="s2">(</span><span class="s6">&quot;Good Friday&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=[</span><span class="s1">Easter</span><span class="s2">(), </span><span class="s1">Day</span><span class="s2">(-</span><span class="s4">2</span><span class="s2">)])</span>

<span class="s1">EasterMonday </span><span class="s2">= </span><span class="s1">Holiday</span><span class="s2">(</span><span class="s6">&quot;Easter Monday&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=[</span><span class="s1">Easter</span><span class="s2">(), </span><span class="s1">Day</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)])</span>


<span class="s0">class </span><span class="s1">USFederalHolidayCalendar</span><span class="s2">(</span><span class="s1">AbstractHolidayCalendar</span><span class="s2">):</span>
    <span class="s3">&quot;&quot;&quot; 
    US Federal Government Holiday Calendar based on rules specified by: 
    https://www.opm.gov/policy-data-oversight/pay-leave/federal-holidays/ 
    &quot;&quot;&quot;</span>

    <span class="s1">rules </span><span class="s2">= [</span>
        <span class="s1">Holiday</span><span class="s2">(</span><span class="s6">&quot;New Year's Day&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">observance</span><span class="s2">=</span><span class="s1">nearest_workday</span><span class="s2">),</span>
        <span class="s1">USMartinLutherKingJr</span><span class="s2">,</span>
        <span class="s1">USPresidentsDay</span><span class="s2">,</span>
        <span class="s1">USMemorialDay</span><span class="s2">,</span>
        <span class="s1">Holiday</span><span class="s2">(</span>
            <span class="s6">&quot;Juneteenth National Independence Day&quot;</span><span class="s2">,</span>
            <span class="s1">month</span><span class="s2">=</span><span class="s4">6</span><span class="s2">,</span>
            <span class="s1">day</span><span class="s2">=</span><span class="s4">19</span><span class="s2">,</span>
            <span class="s1">start_date</span><span class="s2">=</span><span class="s6">&quot;2021-06-18&quot;</span><span class="s2">,</span>
            <span class="s1">observance</span><span class="s2">=</span><span class="s1">nearest_workday</span><span class="s2">,</span>
        <span class="s2">),</span>
        <span class="s1">Holiday</span><span class="s2">(</span><span class="s6">&quot;Independence Day&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">7</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">observance</span><span class="s2">=</span><span class="s1">nearest_workday</span><span class="s2">),</span>
        <span class="s1">USLaborDay</span><span class="s2">,</span>
        <span class="s1">USColumbusDay</span><span class="s2">,</span>
        <span class="s1">Holiday</span><span class="s2">(</span><span class="s6">&quot;Veterans Day&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">11</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">11</span><span class="s2">, </span><span class="s1">observance</span><span class="s2">=</span><span class="s1">nearest_workday</span><span class="s2">),</span>
        <span class="s1">USThanksgivingDay</span><span class="s2">,</span>
        <span class="s1">Holiday</span><span class="s2">(</span><span class="s6">&quot;Christmas Day&quot;</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">12</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">25</span><span class="s2">, </span><span class="s1">observance</span><span class="s2">=</span><span class="s1">nearest_workday</span><span class="s2">),</span>
    <span class="s2">]</span>


<span class="s0">def </span><span class="s1">HolidayCalendarFactory</span><span class="s2">(</span><span class="s1">name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">base</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, </span><span class="s1">base_class</span><span class="s2">=</span><span class="s1">AbstractHolidayCalendar</span><span class="s2">):</span>
    <span class="s1">rules </span><span class="s2">= </span><span class="s1">AbstractHolidayCalendar</span><span class="s2">.</span><span class="s1">merge_class</span><span class="s2">(</span><span class="s1">base</span><span class="s2">, </span><span class="s1">other</span><span class="s2">)</span>
    <span class="s1">calendar_class </span><span class="s2">= </span><span class="s1">type</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, (</span><span class="s1">base_class</span><span class="s2">,), {</span><span class="s6">&quot;rules&quot;</span><span class="s2">: </span><span class="s1">rules</span><span class="s2">, </span><span class="s6">&quot;name&quot;</span><span class="s2">: </span><span class="s1">name</span><span class="s2">})</span>
    <span class="s0">return </span><span class="s1">calendar_class</span>


<span class="s1">__all__ </span><span class="s2">= [</span>
    <span class="s6">&quot;after_nearest_workday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;before_nearest_workday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;FR&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;get_calendar&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;HolidayCalendarFactory&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;MO&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;nearest_workday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;next_monday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;next_monday_or_tuesday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;next_workday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;previous_friday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;previous_workday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;register&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;SA&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;SU&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;sunday_to_monday&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;TH&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;TU&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;WE&quot;</span><span class="s2">,</span>
    <span class="s6">&quot;weekend_to_monday&quot;</span><span class="s2">,</span>
<span class="s2">]</span>
</pre>
</body>
</html>