<html>
<head>
<title>test_old_ma.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_old_ma.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">reduce</span>
<span class="s0">import </span><span class="s1">pickle</span>

<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">umath </span><span class="s0">as </span><span class="s1">umath</span>
<span class="s0">import </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">_core</span><span class="s2">.</span><span class="s1">fromnumeric </span><span class="s0">as </span><span class="s1">fromnumeric</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">assert_</span><span class="s2">, </span><span class="s1">assert_raises</span><span class="s2">, </span><span class="s1">assert_equal</span><span class="s2">,</span>
    <span class="s2">)</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">ma </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">MaskType</span><span class="s2">, </span><span class="s1">MaskedArray</span><span class="s2">, </span><span class="s1">absolute</span><span class="s2">, </span><span class="s1">add</span><span class="s2">, </span><span class="s1">all</span><span class="s2">, </span><span class="s1">allclose</span><span class="s2">, </span><span class="s1">allequal</span><span class="s2">, </span><span class="s1">alltrue</span><span class="s2">,</span>
    <span class="s1">arange</span><span class="s2">, </span><span class="s1">arccos</span><span class="s2">, </span><span class="s1">arcsin</span><span class="s2">, </span><span class="s1">arctan</span><span class="s2">, </span><span class="s1">arctan2</span><span class="s2">, </span><span class="s1">array</span><span class="s2">, </span><span class="s1">average</span><span class="s2">, </span><span class="s1">choose</span><span class="s2">,</span>
    <span class="s1">concatenate</span><span class="s2">, </span><span class="s1">conjugate</span><span class="s2">, </span><span class="s1">cos</span><span class="s2">, </span><span class="s1">cosh</span><span class="s2">, </span><span class="s1">count</span><span class="s2">, </span><span class="s1">divide</span><span class="s2">, </span><span class="s1">equal</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s1">filled</span><span class="s2">,</span>
    <span class="s1">getmask</span><span class="s2">, </span><span class="s1">greater</span><span class="s2">, </span><span class="s1">greater_equal</span><span class="s2">, </span><span class="s1">inner</span><span class="s2">, </span><span class="s1">isMaskedArray</span><span class="s2">, </span><span class="s1">less</span><span class="s2">,</span>
    <span class="s1">less_equal</span><span class="s2">, </span><span class="s1">log</span><span class="s2">, </span><span class="s1">log10</span><span class="s2">, </span><span class="s1">make_mask</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">, </span><span class="s1">masked_array</span><span class="s2">, </span><span class="s1">masked_equal</span><span class="s2">,</span>
    <span class="s1">masked_greater</span><span class="s2">, </span><span class="s1">masked_greater_equal</span><span class="s2">, </span><span class="s1">masked_inside</span><span class="s2">, </span><span class="s1">masked_less</span><span class="s2">,</span>
    <span class="s1">masked_less_equal</span><span class="s2">, </span><span class="s1">masked_not_equal</span><span class="s2">, </span><span class="s1">masked_outside</span><span class="s2">,</span>
    <span class="s1">masked_print_option</span><span class="s2">, </span><span class="s1">masked_values</span><span class="s2">, </span><span class="s1">masked_where</span><span class="s2">, </span><span class="s1">maximum</span><span class="s2">, </span><span class="s1">minimum</span><span class="s2">,</span>
    <span class="s1">multiply</span><span class="s2">, </span><span class="s1">nomask</span><span class="s2">, </span><span class="s1">nonzero</span><span class="s2">, </span><span class="s1">not_equal</span><span class="s2">, </span><span class="s1">ones</span><span class="s2">, </span><span class="s1">outer</span><span class="s2">, </span><span class="s1">product</span><span class="s2">, </span><span class="s1">put</span><span class="s2">, </span><span class="s1">ravel</span><span class="s2">,</span>
    <span class="s1">repeat</span><span class="s2">, </span><span class="s1">resize</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">sin</span><span class="s2">, </span><span class="s1">sinh</span><span class="s2">, </span><span class="s1">sometrue</span><span class="s2">, </span><span class="s1">sort</span><span class="s2">, </span><span class="s1">sqrt</span><span class="s2">, </span><span class="s1">subtract</span><span class="s2">, </span><span class="s1">sum</span><span class="s2">,</span>
    <span class="s1">take</span><span class="s2">, </span><span class="s1">tan</span><span class="s2">, </span><span class="s1">tanh</span><span class="s2">, </span><span class="s1">transpose</span><span class="s2">, </span><span class="s1">where</span><span class="s2">, </span><span class="s1">zeros</span><span class="s2">,</span>
    <span class="s2">)</span>

<span class="s1">pi </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>


<span class="s0">def </span><span class="s1">eq</span><span class="s2">(</span><span class="s1">v</span><span class="s2">, </span><span class="s1">w</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">=</span><span class="s3">''</span><span class="s2">):</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">v</span><span class="s2">, </span><span class="s1">w</span><span class="s2">)</span>
    <span class="s0">if not </span><span class="s1">result</span><span class="s2">:</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s3">f'Not eq:</span><span class="s0">{</span><span class="s1">msg</span><span class="s0">}\n{</span><span class="s1">v</span><span class="s0">}\n</span><span class="s3">----</span><span class="s0">{</span><span class="s1">w</span><span class="s0">}</span><span class="s3">'</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">result</span>


<span class="s0">class </span><span class="s1">TestMa</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">2.</span><span class="s2">, </span><span class="s1">pi</span><span class="s2">/</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">4.</span><span class="s2">, </span><span class="s4">5.</span><span class="s2">, -</span><span class="s4">10.</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">5.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, -</span><span class="s4">1.</span><span class="s2">, -</span><span class="s4">4.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">10.</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">])</span>
        <span class="s1">a10 </span><span class="s2">= </span><span class="s4">10.</span>
        <span class="s1">m1 </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">m2 </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">xm </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m1</span><span class="s2">)</span>
        <span class="s1">ym </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m2</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.8</span><span class="s2">])</span>
        <span class="s1">zm </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">xf </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">where</span><span class="s2">(</span><span class="s1">m1</span><span class="s2">, </span><span class="s4">1e+20</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span>
        <span class="s1">xm</span><span class="s2">.</span><span class="s1">set_fill_value</span><span class="s2">(</span><span class="s4">1e+20</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">d </span><span class="s2">= (</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">, </span><span class="s1">s</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_testBasic1d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of basic array creation and properties in 1 dimension.</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">, </span><span class="s1">s</span><span class="s2">) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">isMaskedArray</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isMaskedArray</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">), </span><span class="s1">s</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">s</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">.</span><span class="s1">size</span><span class="s2">, </span><span class="s1">reduce</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">:</span><span class="s1">x </span><span class="s2">* </span><span class="s1">y</span><span class="s2">, </span><span class="s1">s</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">), </span><span class="s1">len</span><span class="s2">(</span><span class="s1">m1</span><span class="s2">) - </span><span class="s1">reduce</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">:</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">y</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s4">1.e20</span><span class="s2">), </span><span class="s1">xf</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;s&quot;</span><span class="s2">, [(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), (</span><span class="s4">6</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_testBasic2d</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">s</span><span class="s2">):</span>
        <span class="s5"># Test of basic array creation and properties in 2 dimensions.</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">, </span><span class="s1">s</span><span class="s2">) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">x</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">= </span><span class="s1">s</span>
        <span class="s1">y</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">= </span><span class="s1">s</span>
        <span class="s1">xm</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">= </span><span class="s1">s</span>
        <span class="s1">ym</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">= </span><span class="s1">s</span>
        <span class="s1">xf</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">= </span><span class="s1">s</span>

        <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">isMaskedArray</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isMaskedArray</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">), </span><span class="s1">s</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">s</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">.</span><span class="s1">size</span><span class="s2">, </span><span class="s1">reduce</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">: </span><span class="s1">x </span><span class="s2">* </span><span class="s1">y</span><span class="s2">, </span><span class="s1">s</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">), </span><span class="s1">len</span><span class="s2">(</span><span class="s1">m1</span><span class="s2">) - </span><span class="s1">reduce</span><span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">: </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">y</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s4">1.e20</span><span class="s2">), </span><span class="s1">xf</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_testArithmetic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of basic arithmetic.</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">, </span><span class="s1">s</span><span class="s2">) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">a2d </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]])</span>
        <span class="s1">a2dm </span><span class="s2">= </span><span class="s1">masked_array</span><span class="s2">(</span><span class="s1">a2d</span><span class="s2">, [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a2d </span><span class="s2">* </span><span class="s1">a2d</span><span class="s2">, </span><span class="s1">a2d </span><span class="s2">* </span><span class="s1">a2dm</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a2d </span><span class="s2">+ </span><span class="s1">a2d</span><span class="s2">, </span><span class="s1">a2d </span><span class="s2">+ </span><span class="s1">a2dm</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a2d </span><span class="s2">- </span><span class="s1">a2d</span><span class="s2">, </span><span class="s1">a2d </span><span class="s2">- </span><span class="s1">a2dm</span><span class="s2">))</span>
        <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">12</span><span class="s2">,), (</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">6</span><span class="s2">)]:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">y</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
            <span class="s1">xm </span><span class="s2">= </span><span class="s1">xm</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
            <span class="s1">ym </span><span class="s2">= </span><span class="s1">ym</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
            <span class="s1">xf </span><span class="s2">= </span><span class="s1">xf</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">, -</span><span class="s1">xm</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">+ </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">- </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">- </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">* </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">* </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">, </span><span class="s1">invalid</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">):</span>
                <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">/ </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">/ </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a10 </span><span class="s2">+ </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10 </span><span class="s2">+ </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a10 </span><span class="s2">- </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10 </span><span class="s2">- </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a10 </span><span class="s2">* </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10 </span><span class="s2">* </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">, </span><span class="s1">invalid</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">):</span>
                <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a10 </span><span class="s2">/ </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10 </span><span class="s2">/ </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">+ </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">+ </span><span class="s1">a10</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">- </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">- </span><span class="s1">a10</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">* </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">* </span><span class="s1">a10</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">/ </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">/ </span><span class="s1">a10</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">** </span><span class="s4">2</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">** </span><span class="s4">2</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) ** </span><span class="s4">2.5</span><span class="s2">, </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">) ** </span><span class="s4">2.5</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x </span><span class="s2">** </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xm </span><span class="s2">** </span><span class="s1">ym</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">add</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">subtract</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">subtract</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">multiply</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">multiply</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
            <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">, </span><span class="s1">invalid</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">):</span>
                <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">divide</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">divide</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_testMixedArithmetic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">na </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">ma </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">na </span><span class="s2">+ </span><span class="s1">ma</span><span class="s2">, </span><span class="s1">MaskedArray</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">ma </span><span class="s2">+ </span><span class="s1">na</span><span class="s2">, </span><span class="s1">MaskedArray</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_testUfuncs1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test various functions such as sin, cos.</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">, </span><span class="s1">s</span><span class="s2">) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">cos</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">cosh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">cosh</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">sin</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sinh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">sinh</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">tan</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">tan</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">tanh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">tanh</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">, </span><span class="s1">invalid</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">):</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)), </span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)), </span><span class="s1">log</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)), </span><span class="s1">log10</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">exp</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arcsin</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">arcsin</span><span class="s2">(</span><span class="s1">zm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arccos</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">arccos</span><span class="s2">(</span><span class="s1">zm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arctan</span><span class="s2">(</span><span class="s1">z</span><span class="s2">), </span><span class="s1">arctan</span><span class="s2">(</span><span class="s1">zm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arctan2</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">arctan2</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">absolute</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">absolute</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">not_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">not_equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">less</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">less</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">greater</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">greater</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">less_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">less_equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">greater_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">greater_equal</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">conjugate</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">conjugate</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)), </span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">))))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)), </span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)), </span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)), </span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">x</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">x</span><span class="s2">))))</span>

    <span class="s0">def </span><span class="s1">test_xtestCount</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test count</span>
        <span class="s1">ott </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">).</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s1">count</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">count</span><span class="s2">(</span><span class="s4">1</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">array</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">])))</span>
        <span class="s1">ott </span><span class="s2">= </span><span class="s1">ott</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">((</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">).</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">).</span><span class="s1">dtype</span><span class="s2">.</span><span class="s1">type </span><span class="s0">is </span><span class="s1">np</span><span class="s2">.</span><span class="s1">intp</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s1">count</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">getmask</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)) </span><span class="s0">is </span><span class="s1">nomask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s1">count</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_testMinMax</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test minimum and maximum.</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">, </span><span class="s1">s</span><span class="s2">) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">xr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)  </span><span class="s5"># max doesn't work if shaped</span>
        <span class="s1">xmr </span><span class="s2">= </span><span class="s1">ravel</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">)</span>

        <span class="s5"># true because of careful selection of data</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">max</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">), </span><span class="s1">maximum</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">xmr</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">min</span><span class="s2">(</span><span class="s1">xr</span><span class="s2">), </span><span class="s1">minimum</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">xmr</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_testAddSumProd</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test add, sum, product.</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">, </span><span class="s1">s</span><span class="s2">) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">add</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">add</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">add</span><span class="s2">.</span><span class="s1">accumulate</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">add</span><span class="s2">.</span><span class="s1">accumulate</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s4">4</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s4">4</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">prod</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s1">product</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">prod</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">product</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">prod</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">),</span>
                           <span class="s1">product</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">s</span><span class="s2">) &gt; </span><span class="s4">1</span><span class="s2">:</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">((</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s4">1</span><span class="s2">),</span>
                               <span class="s1">concatenate</span><span class="s2">((</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">), </span><span class="s4">1</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">add</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">add</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">prod</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">product</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_testCI</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of conversions and indexing</span>
        <span class="s1">x1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
        <span class="s1">x2 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">x3 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">x4 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">)</span>
        <span class="s5"># test conversion to strings</span>
        <span class="s1">str</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">)  </span><span class="s5"># raises?</span>
        <span class="s1">repr</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">)  </span><span class="s5"># raises?</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">), </span><span class="s1">sort</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s1">fill_value</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s5"># tests of indexing</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]) </span><span class="s0">is </span><span class="s1">type</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] == </span><span class="s1">x2</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">x2</span><span class="s2">[</span><span class="s4">2</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">[</span><span class="s4">2</span><span class="s2">:</span><span class="s4">5</span><span class="s2">], </span><span class="s1">x2</span><span class="s2">[</span><span class="s4">2</span><span class="s2">:</span><span class="s4">5</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">[:], </span><span class="s1">x2</span><span class="s2">[:]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">[</span><span class="s4">1</span><span class="s2">:], </span><span class="s1">x3</span><span class="s2">[</span><span class="s4">1</span><span class="s2">:]))</span>
        <span class="s1">x1</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s4">9</span>
        <span class="s1">x2</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s4">9</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">))</span>
        <span class="s1">x1</span><span class="s2">[</span><span class="s4">1</span><span class="s2">:</span><span class="s4">3</span><span class="s2">] = </span><span class="s4">99</span>
        <span class="s1">x2</span><span class="s2">[</span><span class="s4">1</span><span class="s2">:</span><span class="s4">3</span><span class="s2">] = </span><span class="s4">99</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">))</span>
        <span class="s1">x2</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">))</span>
        <span class="s1">x2</span><span class="s2">[</span><span class="s4">1</span><span class="s2">:</span><span class="s4">3</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">))</span>
        <span class="s1">x2</span><span class="s2">[:] = </span><span class="s1">x1</span>
        <span class="s1">x2</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allequal</span><span class="s2">(</span><span class="s1">getmask</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">), </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])))</span>
        <span class="s1">x3</span><span class="s2">[:] = </span><span class="s1">masked_array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allequal</span><span class="s2">(</span><span class="s1">getmask</span><span class="s2">(</span><span class="s1">x3</span><span class="s2">), </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])))</span>
        <span class="s1">x4</span><span class="s2">[:] = </span><span class="s1">masked_array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allequal</span><span class="s2">(</span><span class="s1">getmask</span><span class="s2">(</span><span class="s1">x4</span><span class="s2">), </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allequal</span><span class="s2">(</span><span class="s1">x4</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">])))</span>
        <span class="s1">x1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">5</span><span class="s2">) * </span><span class="s4">1.0</span>
        <span class="s1">x2 </span><span class="s2">= </span><span class="s1">masked_values</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allequal</span><span class="s2">(</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">MaskType</span><span class="s2">), </span><span class="s1">x2</span><span class="s2">.</span><span class="s1">mask</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s4">3.0</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">.</span><span class="s1">fill_value</span><span class="s2">))</span>
        <span class="s1">x1 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s3">'hello'</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">object</span><span class="s2">)</span>
        <span class="s1">x2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s3">'hello'</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">object</span><span class="s2">)</span>
        <span class="s1">s1 </span><span class="s2">= </span><span class="s1">x1</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">s2 </span><span class="s2">= </span><span class="s1">x2</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">s2</span><span class="s2">), </span><span class="s1">str</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">s1</span><span class="s2">), </span><span class="s1">str</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">s1</span><span class="s2">, </span><span class="s1">s2</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">[</span><span class="s4">1</span><span class="s2">:</span><span class="s4">1</span><span class="s2">].</span><span class="s1">shape </span><span class="s2">== (</span><span class="s4">0</span><span class="s2">,))</span>

    <span class="s0">def </span><span class="s1">test_testCopySize</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Tests of some subtle points of copying and sizing.</span>
        <span class="s1">n </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">m </span><span class="s2">= </span><span class="s1">make_mask</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">m2 </span><span class="s2">= </span><span class="s1">make_mask</span><span class="s2">(</span><span class="s1">m</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">m </span><span class="s0">is </span><span class="s1">m2</span><span class="s2">)</span>
        <span class="s1">m3 </span><span class="s2">= </span><span class="s1">make_mask</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">m </span><span class="s0">is not </span><span class="s1">m3</span><span class="s2">)</span>

        <span class="s1">x1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">y1 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">.</span><span class="s1">_data </span><span class="s0">is not </span><span class="s1">x1</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allequal</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">.</span><span class="s1">_mask </span><span class="s0">is </span><span class="s1">m</span><span class="s2">)</span>

        <span class="s1">y1a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s5"># For copy=False, one might expect that the array would just</span>
        <span class="s5"># passed on, i.e., that it would be &quot;is&quot; instead of &quot;==&quot;.</span>
        <span class="s5"># See gh-4043 for discussion.</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y1a</span><span class="s2">.</span><span class="s1">_mask</span><span class="s2">.</span><span class="s1">__array_interface__ </span><span class="s2">==</span>
                <span class="s1">y1</span><span class="s2">.</span><span class="s1">_mask</span><span class="s2">.</span><span class="s1">__array_interface__</span><span class="s2">)</span>

        <span class="s1">y2 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m3</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y2</span><span class="s2">.</span><span class="s1">_mask </span><span class="s0">is </span><span class="s1">m3</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y2</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">y2</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s4">9</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y2</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y2</span><span class="s2">.</span><span class="s1">_mask </span><span class="s0">is </span><span class="s1">m3</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allequal</span><span class="s2">(</span><span class="s1">y2</span><span class="s2">.</span><span class="s1">mask</span><span class="s2">, </span><span class="s4">0</span><span class="s2">))</span>

        <span class="s1">y2a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y2a</span><span class="s2">.</span><span class="s1">_mask </span><span class="s0">is not </span><span class="s1">m</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y2a</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">y2a</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s4">9</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y2a</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y2a</span><span class="s2">.</span><span class="s1">_mask </span><span class="s0">is not </span><span class="s1">m</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allequal</span><span class="s2">(</span><span class="s1">y2a</span><span class="s2">.</span><span class="s1">mask</span><span class="s2">, </span><span class="s4">0</span><span class="s2">))</span>

        <span class="s1">y3 </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">x1 </span><span class="s2">* </span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">(</span><span class="s1">y3</span><span class="s2">).</span><span class="s1">dtype </span><span class="s0">is </span><span class="s2">(</span><span class="s1">x1 </span><span class="s2">* </span><span class="s4">1.0</span><span class="s2">).</span><span class="s1">dtype</span><span class="s2">)</span>

        <span class="s1">x4 </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">x4</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">y4 </span><span class="s2">= </span><span class="s1">resize</span><span class="s2">(</span><span class="s1">x4</span><span class="s2">, (</span><span class="s4">8</span><span class="s2">,))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">x4</span><span class="s2">, </span><span class="s1">x4</span><span class="s2">]), </span><span class="s1">y4</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">getmask</span><span class="s2">(</span><span class="s1">y4</span><span class="s2">), [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]))</span>
        <span class="s1">y5 </span><span class="s2">= </span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">x4</span><span class="s2">, (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">y5</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]))</span>
        <span class="s1">y6 </span><span class="s2">= </span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">x4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">y5</span><span class="s2">, </span><span class="s1">y6</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_testPut</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of put</span>
        <span class="s1">d </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">n </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">m </span><span class="s2">= </span><span class="s1">make_mask</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">m2 </span><span class="s2">= </span><span class="s1">m</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">4</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]] = [</span><span class="s4">10</span><span class="s2">, </span><span class="s4">40</span><span class="s2">]</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">_mask </span><span class="s0">is </span><span class="s1">m</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">4</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s4">40</span><span class="s2">]))</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m2</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">.</span><span class="s1">put</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">_mask </span><span class="s0">is not </span><span class="s1">m2</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">4</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, [-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">200</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_testPut2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of put</span>
        <span class="s1">d </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">40</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s4">2</span><span class="s2">:</span><span class="s4">4</span><span class="s2">] = </span><span class="s1">z</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]))</span>

        <span class="s1">d </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">x</span><span class="s2">[</span><span class="s4">2</span><span class="s2">:</span><span class="s4">4</span><span class="s2">]</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">10</span><span class="s2">, </span><span class="s4">40</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">y</span><span class="s2">[:] = </span><span class="s1">z</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s4">10</span><span class="s2">, </span><span class="s4">40</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_testMaPut</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">a10</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ym</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">, </span><span class="s1">xf</span><span class="s2">, </span><span class="s1">s</span><span class="s2">) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">m </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">i </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nonzero</span><span class="s2">(</span><span class="s1">m</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">put</span><span class="s2">(</span><span class="s1">ym</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">all</span><span class="s2">(</span><span class="s1">take</span><span class="s2">(</span><span class="s1">ym</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">) == </span><span class="s1">zm</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_testOddFeatures</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of other odd features</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">20</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s4">5</span><span class="s2">] = </span><span class="s4">12</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] == </span><span class="s4">12</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s4">10j </span><span class="s2">* </span><span class="s1">x</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">real</span><span class="s2">, </span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">, </span><span class="s4">10 </span><span class="s2">* </span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">((</span><span class="s1">z </span><span class="s2">* </span><span class="s1">conjugate</span><span class="s2">(</span><span class="s1">z</span><span class="s2">)).</span><span class="s1">real</span><span class="s2">, </span><span class="s4">101 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">* </span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">z</span><span class="s2">.</span><span class="s1">imag</span><span class="s2">[...] = </span><span class="s4">0.0</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">]) == </span><span class="s1">str</span><span class="s2">(</span><span class="s1">masked</span><span class="s2">))</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">x </span><span class="s2">&gt;= </span><span class="s4">8</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">)) == </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">(</span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">)) == </span><span class="s1">c</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">dtype </span><span class="s0">is </span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">4</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">7</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">8</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">9</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">z</span><span class="s2">))</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">dtype </span><span class="s0">is </span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">4</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">7</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">8</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">9</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">.</span><span class="s1">dtype </span><span class="s0">is </span><span class="s1">x</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">4</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">7</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">8</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">9</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">z</span><span class="s2">))</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">, </span><span class="s4">4.</span><span class="s2">, </span><span class="s4">5.</span><span class="s2">])</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, -</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">4.</span><span class="s2">, -</span><span class="s4">5</span><span class="s2">]))</span>
        <span class="s1">c</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, -</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">4.</span><span class="s2">, -</span><span class="s4">5</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">greater</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">x</span><span class="s2">), </span><span class="s1">masked_greater</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">greater_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">x</span><span class="s2">),</span>
                   <span class="s1">masked_greater_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">less</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">x</span><span class="s2">), </span><span class="s1">masked_less</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">less_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">x</span><span class="s2">), </span><span class="s1">masked_less_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">not_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">x</span><span class="s2">), </span><span class="s1">masked_not_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">x</span><span class="s2">), </span><span class="s1">masked_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">not_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">x</span><span class="s2">), </span><span class="s1">masked_not_equal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_inside</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)), </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">199</span><span class="s2">, </span><span class="s4">199</span><span class="s2">, </span><span class="s4">199</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_outside</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)), </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), [</span><span class="s4">199</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">199</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_inside</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)),</span>
                                       <span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">,</span>
                   <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_outside</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)),</span>
                                        <span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]), </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">,</span>
                   <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_equal</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)),</span>
                                      <span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]), </span><span class="s4">2</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">,</span>
                   <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_not_equal</span><span class="s2">(</span><span class="s1">array</span><span class="s2">([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">],</span>
                                          <span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]), </span><span class="s4">2</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">,</span>
                   <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">masked_where</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">]),</span>
                   <span class="s2">[</span><span class="s4">99</span><span class="s2">, </span><span class="s4">99</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">]))</span>
        <span class="s1">atest </span><span class="s2">= </span><span class="s1">ones</span><span class="s2">((</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)</span>
        <span class="s1">btest </span><span class="s2">= </span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">atest</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">MaskType</span><span class="s2">)</span>
        <span class="s1">ctest </span><span class="s2">= </span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">btest</span><span class="s2">, </span><span class="s1">atest</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">atest</span><span class="s2">, </span><span class="s1">ctest</span><span class="s2">))</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">choose</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, (-</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">, -</span><span class="s4">4.</span><span class="s2">, -</span><span class="s4">5</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">is not </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">z</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s4">5</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">) * </span><span class="s4">10</span>
        <span class="s1">y</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">cm </span><span class="s2">= </span><span class="s1">c</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
        <span class="s1">zm </span><span class="s2">= </span><span class="s1">where</span><span class="s2">(</span><span class="s1">cm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">zm</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">getmask</span><span class="s2">(</span><span class="s1">zm</span><span class="s2">) </span><span class="s0">is </span><span class="s1">nomask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">zm</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">40</span><span class="s2">, </span><span class="s4">50</span><span class="s2">]))</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [</span><span class="s4">99</span><span class="s2">, </span><span class="s4">99</span><span class="s2">, </span><span class="s4">99</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">where</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, [</span><span class="s4">99</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">99</span><span class="s2">, </span><span class="s4">99</span><span class="s2">, </span><span class="s4">99</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_testMinMax2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of minimum, maximum.</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">minimum</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">9</span><span class="s2">]), [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">maximum</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">9</span><span class="s2">]), [</span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">9</span><span class="s2">]))</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">5</span><span class="s2">) - </span><span class="s4">2</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">y</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">minimum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">where</span><span class="s2">(</span><span class="s1">less</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">maximum</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">where</span><span class="s2">(</span><span class="s1">greater</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">minimum</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) == </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">maximum</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) == </span><span class="s4">4</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_testTakeTransposeInnerOuter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of take, transpose, inner, outer products</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">24</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">24</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s4">5</span><span class="s2">:</span><span class="s4">6</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">y</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">transpose</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)), </span><span class="s1">transpose</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">take</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s4">1</span><span class="s2">), </span><span class="s1">take</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s4">1</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inner</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">filled</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)),</span>
                   <span class="s1">inner</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">outer</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">filled</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)),</span>
                   <span class="s1">outer</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s3">'abc'</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s3">'def'</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">object</span><span class="s2">)</span>
        <span class="s1">y</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">t </span><span class="s2">= </span><span class="s1">take</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">t</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] == </span><span class="s3">'abc'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">t</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] == </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">t</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] == </span><span class="s4">3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_testInplace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of inplace operations and rich comparisons</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">xm </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">xm</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">x </span><span class="s2">+= </span><span class="s4">1</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">))</span>
        <span class="s1">xm </span><span class="s2">+= </span><span class="s4">1</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">))</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">xm </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">xm</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">x </span><span class="s2">-= </span><span class="s4">1</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">- </span><span class="s4">1</span><span class="s2">))</span>
        <span class="s1">xm </span><span class="s2">-= </span><span class="s4">1</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">y </span><span class="s2">- </span><span class="s4">1</span><span class="s2">))</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">) * </span><span class="s4">1.0</span>
        <span class="s1">xm </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">) * </span><span class="s4">1.0</span>
        <span class="s1">xm</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">x </span><span class="s2">*= </span><span class="s4">2.0</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">* </span><span class="s4">2</span><span class="s2">))</span>
        <span class="s1">xm </span><span class="s2">*= </span><span class="s4">2.0</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">y </span><span class="s2">* </span><span class="s4">2</span><span class="s2">))</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">) * </span><span class="s4">2</span>
        <span class="s1">xm </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">xm</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">x </span><span class="s2">//= </span><span class="s4">2</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>
        <span class="s1">xm </span><span class="s2">//= </span><span class="s4">2</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">) * </span><span class="s4">1.0</span>
        <span class="s1">xm </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">) * </span><span class="s4">1.0</span>
        <span class="s1">xm</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">x </span><span class="s2">/= </span><span class="s4">2.0</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">/ </span><span class="s4">2.0</span><span class="s2">))</span>
        <span class="s1">xm </span><span class="s2">/= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">ones</span><span class="s2">((</span><span class="s4">10</span><span class="s2">,))))</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">)</span>
        <span class="s1">xm </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">xm</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">x </span><span class="s2">+= </span><span class="s4">1.</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s4">1.</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_testPickle</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of pickling</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">12</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">[</span><span class="s4">4</span><span class="s2">:</span><span class="s4">10</span><span class="s2">:</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">proto </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">pickle</span><span class="s2">.</span><span class="s1">HIGHEST_PROTOCOL </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">):</span>
            <span class="s1">s </span><span class="s2">= </span><span class="s1">pickle</span><span class="s2">.</span><span class="s1">dumps</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">protocol</span><span class="s2">=</span><span class="s1">proto</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">pickle</span><span class="s2">.</span><span class="s1">loads</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_testMasked</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of masked element</span>
        <span class="s1">xx </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">xx</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">masked</span><span class="s2">) == </span><span class="s3">'--'</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">xx</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">(</span><span class="s1">xx</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s4">0</span><span class="s2">), </span><span class="s4">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_testAverage1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test of average.</span>
        <span class="s1">ott </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">average</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">average</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s1">weights</span><span class="s2">=[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">])))</span>
        <span class="s1">result</span><span class="s2">, </span><span class="s1">wts </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s1">weights</span><span class="s2">=[</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">], </span><span class="s1">returned</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s4">2.0</span><span class="s2">, </span><span class="s1">result</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">wts </span><span class="s2">== </span><span class="s4">4.0</span><span class="s2">)</span>
        <span class="s1">ott</span><span class="s2">[:] = </span><span class="s1">masked</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">) </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">ott </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">ott </span><span class="s2">= </span><span class="s1">ott</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s1">ott</span><span class="s2">[:, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">masked</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), [</span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">([</span><span class="s4">2.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">], </span><span class="s1">average</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">result</span><span class="s2">, </span><span class="s1">wts </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">ott</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">returned</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">wts</span><span class="s2">, [</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">0.</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_testAverage2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># More tests of average.</span>
        <span class="s1">w1 </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">w2 </span><span class="s2">= [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]]</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s4">2.5</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">weights</span><span class="s2">=</span><span class="s1">w1</span><span class="s2">), </span><span class="s4">2.5</span><span class="s2">))</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">), </span><span class="s4">2.0 </span><span class="s2">* </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
                                 <span class="s1">np</span><span class="s2">.</span><span class="s1">add</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)) * </span><span class="s4">3. </span><span class="s2">/ </span><span class="s4">12.</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">) * </span><span class="s4">3. </span><span class="s2">/ </span><span class="s4">2.</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">),</span>
                                 <span class="s2">[</span><span class="s1">average</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s1">average</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)*</span><span class="s4">2.0</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">weights</span><span class="s2">=</span><span class="s1">w2</span><span class="s2">), </span><span class="s4">20. </span><span class="s2">/ </span><span class="s4">6.</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">weights</span><span class="s2">=</span><span class="s1">w2</span><span class="s2">),</span>
                                 <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">, </span><span class="s4">4.</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">),</span>
                                 <span class="s2">[</span><span class="s1">average</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s1">average</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)*</span><span class="s4">2.0</span><span class="s2">]))</span>
        <span class="s1">m1 </span><span class="s2">= </span><span class="s1">zeros</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">m2 </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">m3 </span><span class="s2">= [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]]</span>
        <span class="s1">m4 </span><span class="s2">= </span><span class="s1">ones</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">m5 </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">masked_array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">m1</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s4">2.5</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">masked_array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s4">2.5</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">masked_array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">m4</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">) </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">masked_array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">m5</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s4">0.0</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">count</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">masked_array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">m4</span><span class="s2">), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)), </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">masked_array</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">m3</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s0">None</span><span class="s2">), </span><span class="s4">20. </span><span class="s2">/ </span><span class="s4">6.</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">),</span>
                                 <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">99.</span><span class="s2">, </span><span class="s4">99.</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">, </span><span class="s4">7.5</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">), [</span><span class="s4">2.5</span><span class="s2">, </span><span class="s4">5.0</span><span class="s2">]))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">average</span><span class="s2">(</span><span class="s1">z</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">weights</span><span class="s2">=</span><span class="s1">w2</span><span class="s2">),</span>
                                 <span class="s2">[</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">, </span><span class="s4">99.</span><span class="s2">, </span><span class="s4">99.</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">, </span><span class="s4">10.0</span><span class="s2">]))</span>

        <span class="s1">a </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">6</span><span class="s2">) * </span><span class="s4">3</span>
        <span class="s1">r1</span><span class="s2">, </span><span class="s1">w1 </span><span class="s2">= </span><span class="s1">average</span><span class="s2">([[</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">], [</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">]], </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">returned</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">(</span><span class="s1">r1</span><span class="s2">), </span><span class="s1">shape</span><span class="s2">(</span><span class="s1">w1</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">r1</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">w1</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">)</span>
        <span class="s1">r2</span><span class="s2">, </span><span class="s1">w2 </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">ones</span><span class="s2">((</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">weights</span><span class="s2">=[</span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">returned</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">(</span><span class="s1">w2</span><span class="s2">), </span><span class="s1">shape</span><span class="s2">(</span><span class="s1">r2</span><span class="s2">))</span>
        <span class="s1">r2</span><span class="s2">, </span><span class="s1">w2 </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">ones</span><span class="s2">((</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s1">returned</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">(</span><span class="s1">w2</span><span class="s2">), </span><span class="s1">shape</span><span class="s2">(</span><span class="s1">r2</span><span class="s2">))</span>
        <span class="s1">r2</span><span class="s2">, </span><span class="s1">w2 </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">ones</span><span class="s2">((</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s1">weights</span><span class="s2">=</span><span class="s1">ones</span><span class="s2">((</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)), </span><span class="s1">returned</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">(</span><span class="s1">w2</span><span class="s2">) == </span><span class="s1">shape</span><span class="s2">(</span><span class="s1">r2</span><span class="s2">))</span>
        <span class="s1">a2d </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]], </span><span class="s1">float</span><span class="s2">)</span>
        <span class="s1">a2dm </span><span class="s2">= </span><span class="s1">masked_array</span><span class="s2">(</span><span class="s1">a2d</span><span class="s2">, [[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]])</span>
        <span class="s1">a2da </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">a2d</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a2da</span><span class="s2">, [</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">]))</span>
        <span class="s1">a2dma </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">a2dm</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a2dma</span><span class="s2">, [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">]))</span>
        <span class="s1">a2dma </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">a2dm</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a2dma</span><span class="s2">, </span><span class="s4">7. </span><span class="s2">/ </span><span class="s4">3.</span><span class="s2">))</span>
        <span class="s1">a2dma </span><span class="s2">= </span><span class="s1">average</span><span class="s2">(</span><span class="s1">a2dm</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a2dma</span><span class="s2">, [</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_testToPython</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">int</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">float</span><span class="s2">(</span><span class="s1">array</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">int</span><span class="s2">(</span><span class="s1">array</span><span class="s2">([[[</span><span class="s4">1</span><span class="s2">]]])))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">float</span><span class="s2">(</span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">]])))</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">float</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">bool</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">bool</span><span class="s2">, </span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]))</span>

    <span class="s0">def </span><span class="s1">test_testScalarArithmetic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">xm </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
        <span class="s5">#TODO FIXME: Find out what the following raises a warning in r8247</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">):</span>
            <span class="s1">assert_</span><span class="s2">((</span><span class="s4">1 </span><span class="s2">/ </span><span class="s1">array</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)).</span><span class="s1">mask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">((</span><span class="s4">1 </span><span class="s2">+ </span><span class="s1">xm</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">((-</span><span class="s1">xm</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">((-</span><span class="s1">xm</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">maximum</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">minimum</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">, </span><span class="s1">xm</span><span class="s2">).</span><span class="s1">mask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">().</span><span class="s1">dtype </span><span class="s0">is </span><span class="s1">xm</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">() == </span><span class="s1">x</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">xm</span><span class="s2">), </span><span class="s1">str</span><span class="s2">(</span><span class="s1">masked_print_option</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_testArrayMethods</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">any</span><span class="s2">(), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">any</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">all</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">argmax</span><span class="s2">(), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">argmax</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">argmin</span><span class="s2">(), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">argmin</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">choose</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">),</span>
                           <span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">choose</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">compress</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">compress</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">(), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">conj</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">conjugate</span><span class="s2">(), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">conjugate</span><span class="s2">()))</span>
        <span class="s1">m </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]])</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">m</span><span class="s2">.</span><span class="s1">diagonal</span><span class="s2">(), </span><span class="s1">m</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">diagonal</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">(), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">take</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">take</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">m</span><span class="s2">.</span><span class="s1">transpose</span><span class="s2">(), </span><span class="s1">m</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">transpose</span><span class="s2">()))</span>

    <span class="s0">def </span><span class="s1">test_testArrayAttributes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">ndim</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_testAPI</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s2">[</span><span class="s1">m </span><span class="s0">for </span><span class="s1">m </span><span class="s0">in </span><span class="s1">dir</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndarray</span><span class="s2">)</span>
                     <span class="s0">if </span><span class="s1">m </span><span class="s0">not in </span><span class="s1">dir</span><span class="s2">(</span><span class="s1">MaskedArray</span><span class="s2">) </span><span class="s0">and</span>
                     <span class="s0">not </span><span class="s1">m</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">'_'</span><span class="s2">)])</span>

    <span class="s0">def </span><span class="s1">test_testSingleElementSubscript</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">shape</span><span class="s2">, ())</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">shape</span><span class="s2">, ())</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">shape</span><span class="s2">, ())</span>

    <span class="s0">def </span><span class="s1">test_assignment_by_condition</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># Test for gh-18951</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">a </span><span class="s2">&gt;= </span><span class="s4">3</span>
        <span class="s1">a</span><span class="s2">[</span><span class="s1">c</span><span class="s2">] = </span><span class="s4">5</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] </span><span class="s0">is </span><span class="s1">masked</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_assignment_by_condition_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># gh-19721</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">masked_array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
        <span class="s1">b </span><span class="s2">= </span><span class="s1">masked_array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
        <span class="s1">mask </span><span class="s2">= </span><span class="s1">a </span><span class="s2">&lt; </span><span class="s4">1</span>
        <span class="s1">b</span><span class="s2">[</span><span class="s1">mask</span><span class="s2">] = </span><span class="s1">a</span><span class="s2">[</span><span class="s1">mask</span><span class="s2">]</span>
        <span class="s1">expected_mask </span><span class="s2">= [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">]</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">mask</span><span class="s2">, </span><span class="s1">expected_mask</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestUfuncs</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">d </span><span class="s2">= (</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pi </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">] * </span><span class="s4">2</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] + [</span><span class="s4">0</span><span class="s2">] * </span><span class="s4">6</span><span class="s2">),</span>
                  <span class="s1">array</span><span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pi </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">] * </span><span class="s4">2</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] + [</span><span class="s4">0</span><span class="s2">] * </span><span class="s4">6</span><span class="s2">),)</span>

    <span class="s0">def </span><span class="s1">test_testUfuncRegression</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">f_invalid_ignore </span><span class="s2">= [</span>
            <span class="s3">'sqrt'</span><span class="s2">, </span><span class="s3">'arctanh'</span><span class="s2">, </span><span class="s3">'arcsin'</span><span class="s2">, </span><span class="s3">'arccos'</span><span class="s2">,</span>
            <span class="s3">'arccosh'</span><span class="s2">, </span><span class="s3">'arctanh'</span><span class="s2">, </span><span class="s3">'log'</span><span class="s2">, </span><span class="s3">'log10'</span><span class="s2">, </span><span class="s3">'divide'</span><span class="s2">,</span>
            <span class="s3">'true_divide'</span><span class="s2">, </span><span class="s3">'floor_divide'</span><span class="s2">, </span><span class="s3">'remainder'</span><span class="s2">, </span><span class="s3">'fmod'</span><span class="s2">]</span>
        <span class="s0">for </span><span class="s1">f </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'sqrt'</span><span class="s2">, </span><span class="s3">'log'</span><span class="s2">, </span><span class="s3">'log10'</span><span class="s2">, </span><span class="s3">'exp'</span><span class="s2">, </span><span class="s3">'conjugate'</span><span class="s2">,</span>
                  <span class="s3">'sin'</span><span class="s2">, </span><span class="s3">'cos'</span><span class="s2">, </span><span class="s3">'tan'</span><span class="s2">,</span>
                  <span class="s3">'arcsin'</span><span class="s2">, </span><span class="s3">'arccos'</span><span class="s2">, </span><span class="s3">'arctan'</span><span class="s2">,</span>
                  <span class="s3">'sinh'</span><span class="s2">, </span><span class="s3">'cosh'</span><span class="s2">, </span><span class="s3">'tanh'</span><span class="s2">,</span>
                  <span class="s3">'arcsinh'</span><span class="s2">,</span>
                  <span class="s3">'arccosh'</span><span class="s2">,</span>
                  <span class="s3">'arctanh'</span><span class="s2">,</span>
                  <span class="s3">'absolute'</span><span class="s2">, </span><span class="s3">'fabs'</span><span class="s2">, </span><span class="s3">'negative'</span><span class="s2">,</span>
                  <span class="s3">'floor'</span><span class="s2">, </span><span class="s3">'ceil'</span><span class="s2">,</span>
                  <span class="s3">'logical_not'</span><span class="s2">,</span>
                  <span class="s3">'add'</span><span class="s2">, </span><span class="s3">'subtract'</span><span class="s2">, </span><span class="s3">'multiply'</span><span class="s2">,</span>
                  <span class="s3">'divide'</span><span class="s2">, </span><span class="s3">'true_divide'</span><span class="s2">, </span><span class="s3">'floor_divide'</span><span class="s2">,</span>
                  <span class="s3">'remainder'</span><span class="s2">, </span><span class="s3">'fmod'</span><span class="s2">, </span><span class="s3">'hypot'</span><span class="s2">, </span><span class="s3">'arctan2'</span><span class="s2">,</span>
                  <span class="s3">'equal'</span><span class="s2">, </span><span class="s3">'not_equal'</span><span class="s2">, </span><span class="s3">'less_equal'</span><span class="s2">, </span><span class="s3">'greater_equal'</span><span class="s2">,</span>
                  <span class="s3">'less'</span><span class="s2">, </span><span class="s3">'greater'</span><span class="s2">,</span>
                  <span class="s3">'logical_and'</span><span class="s2">, </span><span class="s3">'logical_or'</span><span class="s2">, </span><span class="s3">'logical_xor'</span><span class="s2">]:</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">uf </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">umath</span><span class="s2">, </span><span class="s1">f</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
                <span class="s1">uf </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">fromnumeric</span><span class="s2">, </span><span class="s1">f</span><span class="s2">)</span>
            <span class="s1">mf </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">, </span><span class="s1">f</span><span class="s2">)</span>
            <span class="s1">args </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span><span class="s2">[:</span><span class="s1">uf</span><span class="s2">.</span><span class="s1">nin</span><span class="s2">]</span>
            <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">():</span>
                <span class="s0">if </span><span class="s1">f </span><span class="s0">in </span><span class="s1">f_invalid_ignore</span><span class="s2">:</span>
                    <span class="s1">np</span><span class="s2">.</span><span class="s1">seterr</span><span class="s2">(</span><span class="s1">invalid</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">f </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'arctanh'</span><span class="s2">, </span><span class="s3">'log'</span><span class="s2">, </span><span class="s3">'log10'</span><span class="s2">]:</span>
                    <span class="s1">np</span><span class="s2">.</span><span class="s1">seterr</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">)</span>
                <span class="s1">ur </span><span class="s2">= </span><span class="s1">uf</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
                <span class="s1">mr </span><span class="s2">= </span><span class="s1">mf</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">ur</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">(</span><span class="s4">0</span><span class="s2">), </span><span class="s1">mr</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">(</span><span class="s4">0</span><span class="s2">), </span><span class="s1">f</span><span class="s2">))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eqmask</span><span class="s2">(</span><span class="s1">ur</span><span class="s2">.</span><span class="s1">mask</span><span class="s2">, </span><span class="s1">mr</span><span class="s2">.</span><span class="s1">mask</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_reduce</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">alltrue</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">sometrue</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">))</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[:</span><span class="s4">3</span><span class="s2">], </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">product</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s4">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_minmax</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">arange</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">13</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)</span>
        <span class="s1">amask </span><span class="s2">= </span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">a </span><span class="s2">&lt; </span><span class="s4">5</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">amask</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(), </span><span class="s1">a</span><span class="s2">.</span><span class="s1">max</span><span class="s2">())</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">amask</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(), </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">((</span><span class="s1">amask</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s4">0</span><span class="s2">) == </span><span class="s1">a</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)).</span><span class="s1">all</span><span class="s2">())</span>
        <span class="s1">assert_</span><span class="s2">((</span><span class="s1">amask</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s4">0</span><span class="s2">) == [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">8</span><span class="s2">]).</span><span class="s1">all</span><span class="s2">())</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">amask</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">mask</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">amask</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">mask</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_nonzero</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s3">&quot;?bhilqpBHILQPfdgFDGO&quot;</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">nonzero</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), [</span><span class="s4">0</span><span class="s2">]))</span>


<span class="s0">class </span><span class="s1">TestArrayMethods</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">setup_method</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">8.375</span><span class="s2">, </span><span class="s4">7.545</span><span class="s2">, </span><span class="s4">8.828</span><span class="s2">, </span><span class="s4">8.5</span><span class="s2">, </span><span class="s4">1.757</span><span class="s2">, </span><span class="s4">5.928</span><span class="s2">,</span>
                      <span class="s4">8.43</span><span class="s2">, </span><span class="s4">7.78</span><span class="s2">, </span><span class="s4">9.865</span><span class="s2">, </span><span class="s4">5.878</span><span class="s2">, </span><span class="s4">8.979</span><span class="s2">, </span><span class="s4">4.732</span><span class="s2">,</span>
                      <span class="s4">3.012</span><span class="s2">, </span><span class="s4">6.022</span><span class="s2">, </span><span class="s4">5.095</span><span class="s2">, </span><span class="s4">3.116</span><span class="s2">, </span><span class="s4">5.238</span><span class="s2">, </span><span class="s4">3.957</span><span class="s2">,</span>
                      <span class="s4">6.04</span><span class="s2">, </span><span class="s4">9.63</span><span class="s2">, </span><span class="s4">7.712</span><span class="s2">, </span><span class="s4">3.382</span><span class="s2">, </span><span class="s4">4.489</span><span class="s2">, </span><span class="s4">6.479</span><span class="s2">,</span>
                      <span class="s4">7.189</span><span class="s2">, </span><span class="s4">9.645</span><span class="s2">, </span><span class="s4">5.395</span><span class="s2">, </span><span class="s4">4.961</span><span class="s2">, </span><span class="s4">9.894</span><span class="s2">, </span><span class="s4">2.893</span><span class="s2">,</span>
                      <span class="s4">7.357</span><span class="s2">, </span><span class="s4">9.828</span><span class="s2">, </span><span class="s4">6.272</span><span class="s2">, </span><span class="s4">3.758</span><span class="s2">, </span><span class="s4">6.693</span><span class="s2">, </span><span class="s4">0.993</span><span class="s2">])</span>
        <span class="s1">X </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">XX </span><span class="s2">= </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>

        <span class="s1">m </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                      <span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">,</span>
                      <span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">,</span>
                      <span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">,</span>
                      <span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                      <span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">mx </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)</span>
        <span class="s1">mX </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=</span><span class="s1">X</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">))</span>
        <span class="s1">mXX </span><span class="s2">= </span><span class="s1">array</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=</span><span class="s1">XX</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">m</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">XX</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">))</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">d </span><span class="s2">= (</span><span class="s1">x</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">, </span><span class="s1">mXX</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_trace</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">, </span><span class="s1">mXX</span><span class="s2">,) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">mXdiag </span><span class="s2">= </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">diagonal</span><span class="s2">()</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">(), </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">diagonal</span><span class="s2">().</span><span class="s1">compressed</span><span class="s2">().</span><span class="s1">sum</span><span class="s2">())</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">(),</span>
                           <span class="s1">X</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">() - </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">mXdiag</span><span class="s2">.</span><span class="s1">mask </span><span class="s2">* </span><span class="s1">X</span><span class="s2">.</span><span class="s1">diagonal</span><span class="s2">(),</span>
                                           <span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_clip</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">, </span><span class="s1">mXX</span><span class="s2">,) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">clipped </span><span class="s2">= </span><span class="s1">mx</span><span class="s2">.</span><span class="s1">clip</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">8</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">clipped</span><span class="s2">.</span><span class="s1">mask</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">.</span><span class="s1">mask</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">clipped</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">x</span><span class="s2">.</span><span class="s1">clip</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">8</span><span class="s2">)))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">clipped</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">.</span><span class="s1">clip</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">8</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_ptp</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">, </span><span class="s1">mXX</span><span class="s2">,) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">m</span><span class="s2">) = </span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span>
        <span class="s5"># print(type(mx), mx.compressed())</span>
        <span class="s5"># raise Exception()</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">mx</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(</span><span class="s1">mx</span><span class="s2">.</span><span class="s1">compressed</span><span class="s2">()))</span>
        <span class="s1">rows </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">cols </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">m</span><span class="s2">):</span>
            <span class="s1">cols</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">[:, </span><span class="s1">k</span><span class="s2">].</span><span class="s1">compressed</span><span class="s2">())</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
            <span class="s1">rows</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">[</span><span class="s1">k</span><span class="s2">].</span><span class="s1">compressed</span><span class="s2">())</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(</span><span class="s4">0</span><span class="s2">), </span><span class="s1">cols</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(</span><span class="s4">1</span><span class="s2">), </span><span class="s1">rows</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_swapaxes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">, </span><span class="s1">mXX</span><span class="s2">,) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">mXswapped </span><span class="s2">= </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">swapaxes</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mXswapped</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">mX</span><span class="s2">[:, -</span><span class="s4">1</span><span class="s2">]))</span>
        <span class="s1">mXXswapped </span><span class="s2">= </span><span class="s1">mXX</span><span class="s2">.</span><span class="s1">swapaxes</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">mXXswapped</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_cumprod</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">, </span><span class="s1">mXX</span><span class="s2">,) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">mXcp </span><span class="s2">= </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">cumprod</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mXcp</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">(</span><span class="s4">1</span><span class="s2">).</span><span class="s1">cumprod</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">mXcp </span><span class="s2">= </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">cumprod</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mXcp</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">(</span><span class="s4">1</span><span class="s2">).</span><span class="s1">cumprod</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_cumsum</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">, </span><span class="s1">mXX</span><span class="s2">,) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">mXcp </span><span class="s2">= </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">cumsum</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mXcp</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">(</span><span class="s4">0</span><span class="s2">).</span><span class="s1">cumsum</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)))</span>
        <span class="s1">mXcp </span><span class="s2">= </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">cumsum</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mXcp</span><span class="s2">.</span><span class="s1">_data</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">filled</span><span class="s2">(</span><span class="s4">0</span><span class="s2">).</span><span class="s1">cumsum</span><span class="s2">(</span><span class="s4">1</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">test_varstd</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">mx</span><span class="s2">, </span><span class="s1">mX</span><span class="s2">, </span><span class="s1">mXX</span><span class="s2">,) = </span><span class="s1">self</span><span class="s2">.</span><span class="s1">d</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">.</span><span class="s1">var</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s0">None</span><span class="s2">), </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">compressed</span><span class="s2">().</span><span class="s1">var</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">.</span><span class="s1">std</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s0">None</span><span class="s2">), </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">compressed</span><span class="s2">().</span><span class="s1">std</span><span class="s2">()))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mXX</span><span class="s2">.</span><span class="s1">var</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">3</span><span class="s2">).</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">XX</span><span class="s2">.</span><span class="s1">var</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">3</span><span class="s2">).</span><span class="s1">shape</span><span class="s2">))</span>
        <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mX</span><span class="s2">.</span><span class="s1">var</span><span class="s2">().</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">X</span><span class="s2">.</span><span class="s1">var</span><span class="s2">().</span><span class="s1">shape</span><span class="s2">))</span>
        <span class="s2">(</span><span class="s1">mXvar0</span><span class="s2">, </span><span class="s1">mXvar1</span><span class="s2">) = (</span><span class="s1">mX</span><span class="s2">.</span><span class="s1">var</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">0</span><span class="s2">), </span><span class="s1">mX</span><span class="s2">.</span><span class="s1">var</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">))</span>
        <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">6</span><span class="s2">):</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mXvar1</span><span class="s2">[</span><span class="s1">k</span><span class="s2">], </span><span class="s1">mX</span><span class="s2">[</span><span class="s1">k</span><span class="s2">].</span><span class="s1">compressed</span><span class="s2">().</span><span class="s1">var</span><span class="s2">()))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">mXvar0</span><span class="s2">[</span><span class="s1">k</span><span class="s2">], </span><span class="s1">mX</span><span class="s2">[:, </span><span class="s1">k</span><span class="s2">].</span><span class="s1">compressed</span><span class="s2">().</span><span class="s1">var</span><span class="s2">()))</span>
            <span class="s1">assert_</span><span class="s2">(</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">mXvar0</span><span class="s2">[</span><span class="s1">k</span><span class="s2">]),</span>
                               <span class="s1">mX</span><span class="s2">[:, </span><span class="s1">k</span><span class="s2">].</span><span class="s1">compressed</span><span class="s2">().</span><span class="s1">std</span><span class="s2">()))</span>


<span class="s0">def </span><span class="s1">eqmask</span><span class="s2">(</span><span class="s1">m1</span><span class="s2">, </span><span class="s1">m2</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">m1 </span><span class="s0">is </span><span class="s1">nomask</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">m2 </span><span class="s0">is </span><span class="s1">nomask</span>
    <span class="s0">if </span><span class="s1">m2 </span><span class="s0">is </span><span class="s1">nomask</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">m1 </span><span class="s0">is </span><span class="s1">nomask</span>
    <span class="s0">return </span><span class="s2">(</span><span class="s1">m1 </span><span class="s2">== </span><span class="s1">m2</span><span class="s2">).</span><span class="s1">all</span><span class="s2">()</span>
</pre>
</body>
</html>