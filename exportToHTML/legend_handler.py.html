<html>
<head>
<title>legend_handler.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
legend_handler.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Default legend handlers. 
 
.. important:: 
 
    This is a low-level legend API, which most end users do not need. 
 
    We recommend that you are familiar with the :ref:`legend guide 
    &lt;legend_guide&gt;` before reading this documentation. 
 
Legend handlers are expected to be a callable object with a following 
signature:: 
 
    legend_handler(legend, orig_handle, fontsize, handlebox) 
 
Where *legend* is the legend itself, *orig_handle* is the original 
plot, *fontsize* is the fontsize in pixels, and *handlebox* is an 
`.OffsetBox` instance. Within the call, you should create relevant 
artists (using relevant properties from the *legend* and/or 
*orig_handle*) and add them into the *handlebox*. The artists need to 
be scaled according to the *fontsize* (note that the size is in pixels, 
i.e., this is dpi-scaled value). 
 
This module includes definition of several legend handler classes 
derived from the base class (HandlerBase) with the following method:: 
 
    def legend_artist(self, legend, orig_handle, fontsize, handlebox) 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">itertools </span><span class="s2">import </span><span class="s1">cycle</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>

<span class="s2">from </span><span class="s1">matplotlib </span><span class="s2">import </span><span class="s1">cbook</span>
<span class="s2">from </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">lines </span><span class="s2">import </span><span class="s1">Line2D</span>
<span class="s2">from </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">patches </span><span class="s2">import </span><span class="s1">Rectangle</span>
<span class="s2">import </span><span class="s1">matplotlib</span><span class="s3">.</span><span class="s1">collections </span><span class="s2">as </span><span class="s1">mcoll</span>


<span class="s2">def </span><span class="s1">update_from_first_child</span><span class="s3">(</span><span class="s1">tgt</span><span class="s3">, </span><span class="s1">src</span><span class="s3">):</span>
    <span class="s1">first_child </span><span class="s3">= </span><span class="s1">next</span><span class="s3">(</span><span class="s1">iter</span><span class="s3">(</span><span class="s1">src</span><span class="s3">.</span><span class="s1">get_children</span><span class="s3">()), </span><span class="s2">None</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">first_child </span><span class="s2">is not None</span><span class="s3">:</span>
        <span class="s1">tgt</span><span class="s3">.</span><span class="s1">update_from</span><span class="s3">(</span><span class="s1">first_child</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">HandlerBase</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    A base class for default legend handlers. 
 
    The derived classes are meant to override *create_artists* method, which 
    has the following signature:: 
 
      def create_artists(self, legend, orig_handle, 
                         xdescent, ydescent, width, height, fontsize, 
                         trans): 
 
    The overridden method needs to create artists of the given 
    transform that fits in the given dimension (xdescent, ydescent, 
    width, height) that are scaled by fontsize if necessary. 
 
    &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">xpad</span><span class="s3">=</span><span class="s4">0.</span><span class="s3">, </span><span class="s1">ypad</span><span class="s3">=</span><span class="s4">0.</span><span class="s3">, </span><span class="s1">update_func</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        xpad : float, optional 
            Padding in x-direction. 
        ypad : float, optional 
            Padding in y-direction. 
        update_func : callable, optional 
            Function for updating the legend handler properties from another 
            legend handler, used by `~HandlerBase.update_prop`. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_xpad</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_ypad </span><span class="s3">= </span><span class="s1">xpad</span><span class="s3">, </span><span class="s1">ypad</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_update_prop_func </span><span class="s3">= </span><span class="s1">update_func</span>

    <span class="s2">def </span><span class="s1">_update_prop</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_update_prop_func </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_default_update_prop</span><span class="s3">(</span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_update_prop_func</span><span class="s3">(</span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">_default_update_prop</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">):</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">update_from</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">):</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">_update_prop</span><span class="s3">(</span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">)</span>

        <span class="s1">legend</span><span class="s3">.</span><span class="s1">_set_artist_props</span><span class="s3">(</span><span class="s1">legend_handle</span><span class="s3">)</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_clip_box</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_clip_path</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">adjust_drawing_area</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                            <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">,</span>
                            <span class="s3">):</span>
        <span class="s1">xdescent </span><span class="s3">= </span><span class="s1">xdescent </span><span class="s3">- </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_xpad </span><span class="s3">* </span><span class="s1">fontsize</span>
        <span class="s1">ydescent </span><span class="s3">= </span><span class="s1">ydescent </span><span class="s3">- </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_ypad </span><span class="s3">* </span><span class="s1">fontsize</span>
        <span class="s1">width </span><span class="s3">= </span><span class="s1">width </span><span class="s3">- </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_xpad </span><span class="s3">* </span><span class="s1">fontsize</span>
        <span class="s1">height </span><span class="s3">= </span><span class="s1">height </span><span class="s3">- </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_ypad </span><span class="s3">* </span><span class="s1">fontsize</span>
        <span class="s2">return </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span>

    <span class="s2">def </span><span class="s1">legend_artist</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                      <span class="s1">fontsize</span><span class="s3">, </span><span class="s1">handlebox</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Return the artist that this HandlerBase generates for the given 
        original artist/handle. 
 
        Parameters 
        ---------- 
        legend : `~matplotlib.legend.Legend` 
            The legend for which these legend artists are being created. 
        orig_handle : :class:`matplotlib.artist.Artist` or similar 
            The object for which these legend artists are being created. 
        fontsize : int 
            The fontsize in pixels. The artists being created should 
            be scaled according to the given fontsize. 
        handlebox : `~matplotlib.offsetbox.OffsetBox` 
            The box which has been created to hold this legend entry's 
            artists. Artists created in the `legend_artist` method must 
            be added to this handlebox inside this method. 
 
        &quot;&quot;&quot;</span>
        <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">adjust_drawing_area</span><span class="s3">(</span>
                 <span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                 <span class="s1">handlebox</span><span class="s3">.</span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">handlebox</span><span class="s3">.</span><span class="s1">ydescent</span><span class="s3">,</span>
                 <span class="s1">handlebox</span><span class="s3">.</span><span class="s1">width</span><span class="s3">, </span><span class="s1">handlebox</span><span class="s3">.</span><span class="s1">height</span><span class="s3">,</span>
                 <span class="s1">fontsize</span><span class="s3">)</span>
        <span class="s1">artists </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                                      <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">,</span>
                                      <span class="s1">fontsize</span><span class="s3">, </span><span class="s1">handlebox</span><span class="s3">.</span><span class="s1">get_transform</span><span class="s3">())</span>

        <span class="s5"># create_artists will return a list of artists.</span>
        <span class="s2">for </span><span class="s1">a </span><span class="s2">in </span><span class="s1">artists</span><span class="s3">:</span>
            <span class="s1">handlebox</span><span class="s3">.</span><span class="s1">add_artist</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>

        <span class="s5"># we only return the first artist</span>
        <span class="s2">return </span><span class="s1">artists</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">,</span>
                       <span class="s1">trans</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Return the legend artists generated. 
 
        Parameters 
        ---------- 
        legend : `~matplotlib.legend.Legend` 
            The legend for which these legend artists are being created. 
        orig_handle : `~matplotlib.artist.Artist` or similar 
            The object for which these legend artists are being created. 
        xdescent, ydescent, width, height : int 
            The rectangle (*xdescent*, *ydescent*, *width*, *height*) that the 
            legend artists being created should fit within. 
        fontsize : int 
            The fontsize in pixels. The legend artists being created should 
            be scaled according to the given fontsize. 
        trans : `~matplotlib.transforms.Transform` 
            The transform that is applied to the legend artists being created. 
            Typically from unit coordinates in the handler box to screen 
            coordinates. 
        &quot;&quot;&quot;</span>
        <span class="s2">raise </span><span class="s1">NotImplementedError</span><span class="s3">(</span><span class="s6">'Derived must override'</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">HandlerNpoints</span><span class="s3">(</span><span class="s1">HandlerBase</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    A legend handler that shows *numpoints* points in the legend entry. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">marker_pad</span><span class="s3">=</span><span class="s4">0.3</span><span class="s3">, </span><span class="s1">numpoints</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        marker_pad : float 
            Padding between points in legend entry. 
        numpoints : int 
            Number of points to show in legend entry. 
        **kwargs 
            Keyword arguments forwarded to `.HandlerBase`. 
        &quot;&quot;&quot;</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(**</span><span class="s1">kwargs</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">_numpoints </span><span class="s3">= </span><span class="s1">numpoints</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_marker_pad </span><span class="s3">= </span><span class="s1">marker_pad</span>

    <span class="s2">def </span><span class="s1">get_numpoints</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_numpoints </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">numpoints</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_numpoints</span>

    <span class="s2">def </span><span class="s1">get_xdata</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">):</span>
        <span class="s1">numpoints </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_numpoints</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">numpoints </span><span class="s3">&gt; </span><span class="s4">1</span><span class="s3">:</span>
            <span class="s5"># we put some pad here to compensate the size of the marker</span>
            <span class="s1">pad </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_marker_pad </span><span class="s3">* </span><span class="s1">fontsize</span>
            <span class="s1">xdata </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s1">xdescent </span><span class="s3">+ </span><span class="s1">pad</span><span class="s3">,</span>
                                <span class="s3">-</span><span class="s1">xdescent </span><span class="s3">+ </span><span class="s1">width </span><span class="s3">- </span><span class="s1">pad</span><span class="s3">,</span>
                                <span class="s1">numpoints</span><span class="s3">)</span>
            <span class="s1">xdata_marker </span><span class="s3">= </span><span class="s1">xdata</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">xdata </span><span class="s3">= [-</span><span class="s1">xdescent</span><span class="s3">, -</span><span class="s1">xdescent </span><span class="s3">+ </span><span class="s1">width</span><span class="s3">]</span>
            <span class="s1">xdata_marker </span><span class="s3">= [-</span><span class="s1">xdescent </span><span class="s3">+ </span><span class="s4">0.5 </span><span class="s3">* </span><span class="s1">width</span><span class="s3">]</span>
        <span class="s2">return </span><span class="s1">xdata</span><span class="s3">, </span><span class="s1">xdata_marker</span>


<span class="s2">class </span><span class="s1">HandlerNpointsYoffsets</span><span class="s3">(</span><span class="s1">HandlerNpoints</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    A legend handler that shows *numpoints* in the legend, and allows them to 
    be individually offset in the y-direction. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">numpoints</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">yoffsets</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        numpoints : int 
            Number of points to show in legend entry. 
        yoffsets : array of floats 
            Length *numpoints* list of y offsets for each point in 
            legend entry. 
        **kwargs 
            Keyword arguments forwarded to `.HandlerNpoints`. 
        &quot;&quot;&quot;</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">numpoints</span><span class="s3">=</span><span class="s1">numpoints</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_yoffsets </span><span class="s3">= </span><span class="s1">yoffsets</span>

    <span class="s2">def </span><span class="s1">get_ydata</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_yoffsets </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">ydata </span><span class="s3">= </span><span class="s1">height </span><span class="s3">* </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">_scatteryoffsets</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">ydata </span><span class="s3">= </span><span class="s1">height </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_yoffsets</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">ydata</span>


<span class="s2">class </span><span class="s1">HandlerLine2DCompound</span><span class="s3">(</span><span class="s1">HandlerNpoints</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Original handler for `.Line2D` instances, that relies on combining 
    a line-only with a marker-only artist.  May be deprecated in the future. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">,</span>
                       <span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">xdata</span><span class="s3">, </span><span class="s1">xdata_marker </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_xdata</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                                             <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s1">ydata </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">full_like</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">, ((</span><span class="s1">height </span><span class="s3">- </span><span class="s1">ydescent</span><span class="s3">) / </span><span class="s4">2</span><span class="s3">))</span>
        <span class="s1">legline </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">, </span><span class="s1">ydata</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">legline</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>
        <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_drawstyle</span><span class="s3">(</span><span class="s6">'default'</span><span class="s3">)</span>
        <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s6">&quot;&quot;</span><span class="s3">)</span>

        <span class="s1">legline_marker </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata</span><span class="s3">[:</span><span class="s1">len</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">)])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">legline_marker</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>
        <span class="s1">legline_marker</span><span class="s3">.</span><span class="s1">set_linestyle</span><span class="s3">(</span><span class="s6">'None'</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">markerscale </span><span class="s3">!= </span><span class="s4">1</span><span class="s3">:</span>
            <span class="s1">newsz </span><span class="s3">= </span><span class="s1">legline_marker</span><span class="s3">.</span><span class="s1">get_markersize</span><span class="s3">() * </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">markerscale</span>
            <span class="s1">legline_marker</span><span class="s3">.</span><span class="s1">set_markersize</span><span class="s3">(</span><span class="s1">newsz</span><span class="s3">)</span>
        <span class="s5"># we don't want to add this to the return list because</span>
        <span class="s5"># the texts and handles are assumed to be in one-to-one</span>
        <span class="s5"># correspondence.</span>
        <span class="s1">legline</span><span class="s3">.</span><span class="s1">_legmarker </span><span class="s3">= </span><span class="s1">legline_marker</span>

        <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>
        <span class="s1">legline_marker</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s3">[</span><span class="s1">legline</span><span class="s3">, </span><span class="s1">legline_marker</span><span class="s3">]</span>


<span class="s2">class </span><span class="s1">HandlerLine2D</span><span class="s3">(</span><span class="s1">HandlerNpoints</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Handler for `.Line2D` instances. 
 
    See Also 
    -------- 
    HandlerLine2DCompound : An earlier handler implementation, which used one 
                            artist for the line and another for the marker(s). 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">,</span>
                       <span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">xdata</span><span class="s3">, </span><span class="s1">xdata_marker </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_xdata</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                                             <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s1">markevery </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_numpoints</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">) == </span><span class="s4">1</span><span class="s3">:</span>
            <span class="s5"># Special case: one wants a single marker in the center</span>
            <span class="s5"># and a line that extends on both sides. One will use a</span>
            <span class="s5"># 3 points line, but only mark the #1 (i.e. middle) point.</span>
            <span class="s1">xdata </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">xdata</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">], </span><span class="s4">3</span><span class="s3">)</span>
            <span class="s1">markevery </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">]</span>

        <span class="s1">ydata </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">full_like</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">, (</span><span class="s1">height </span><span class="s3">- </span><span class="s1">ydescent</span><span class="s3">) / </span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">legline </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">, </span><span class="s1">ydata</span><span class="s3">, </span><span class="s1">markevery</span><span class="s3">=</span><span class="s1">markevery</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">legline</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">markerscale </span><span class="s3">!= </span><span class="s4">1</span><span class="s3">:</span>
            <span class="s1">newsz </span><span class="s3">= </span><span class="s1">legline</span><span class="s3">.</span><span class="s1">get_markersize</span><span class="s3">() * </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">markerscale</span>
            <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_markersize</span><span class="s3">(</span><span class="s1">newsz</span><span class="s3">)</span>

        <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s3">[</span><span class="s1">legline</span><span class="s3">]</span>


<span class="s2">class </span><span class="s1">HandlerPatch</span><span class="s3">(</span><span class="s1">HandlerBase</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Handler for `.Patch` instances. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">patch_func</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        patch_func : callable, optional 
            The function that creates the legend key artist. 
            *patch_func* should have the signature:: 
 
                def patch_func(legend=legend, orig_handle=orig_handle, 
                               xdescent=xdescent, ydescent=ydescent, 
                               width=width, height=height, fontsize=fontsize) 
 
            Subsequently, the created artist will have its ``update_prop`` 
            method called and the appropriate transform will be applied. 
 
        **kwargs 
            Keyword arguments forwarded to `.HandlerBase`. 
        &quot;&quot;&quot;</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(**</span><span class="s1">kwargs</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_patch_func </span><span class="s3">= </span><span class="s1">patch_func</span>

    <span class="s2">def </span><span class="s1">_create_patch</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                      <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_patch_func </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">p </span><span class="s3">= </span><span class="s1">Rectangle</span><span class="s3">(</span><span class="s1">xy</span><span class="s3">=(-</span><span class="s1">xdescent</span><span class="s3">, -</span><span class="s1">ydescent</span><span class="s3">),</span>
                          <span class="s1">width</span><span class="s3">=</span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s1">height</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">p </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_patch_func</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">=</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">=</span><span class="s1">orig_handle</span><span class="s3">,</span>
                                 <span class="s1">xdescent</span><span class="s3">=</span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">=</span><span class="s1">ydescent</span><span class="s3">,</span>
                                 <span class="s1">width</span><span class="s3">=</span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">=</span><span class="s1">fontsize</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">p</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">, </span><span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">p </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create_patch</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                               <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s3">[</span><span class="s1">p</span><span class="s3">]</span>


<span class="s2">class </span><span class="s1">HandlerStepPatch</span><span class="s3">(</span><span class="s1">HandlerBase</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Handler for `~.matplotlib.patches.StepPatch` instances. 
    &quot;&quot;&quot;</span>

    <span class="s3">@</span><span class="s1">staticmethod</span>
    <span class="s2">def </span><span class="s1">_create_patch</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">Rectangle</span><span class="s3">(</span><span class="s1">xy</span><span class="s3">=(-</span><span class="s1">xdescent</span><span class="s3">, -</span><span class="s1">ydescent</span><span class="s3">), </span><span class="s1">width</span><span class="s3">=</span><span class="s1">width</span><span class="s3">,</span>
                         <span class="s1">height</span><span class="s3">=</span><span class="s1">height</span><span class="s3">, </span><span class="s1">color</span><span class="s3">=</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_facecolor</span><span class="s3">())</span>

    <span class="s3">@</span><span class="s1">staticmethod</span>
    <span class="s2">def </span><span class="s1">_create_line</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">):</span>
        <span class="s5"># Unfilled StepPatch should show as a line</span>
        <span class="s1">legline </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s1">width</span><span class="s3">], [</span><span class="s1">height</span><span class="s3">/</span><span class="s4">2</span><span class="s3">, </span><span class="s1">height</span><span class="s3">/</span><span class="s4">2</span><span class="s3">],</span>
                         <span class="s1">color</span><span class="s3">=</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_edgecolor</span><span class="s3">(),</span>
                         <span class="s1">linestyle</span><span class="s3">=</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_linestyle</span><span class="s3">(),</span>
                         <span class="s1">linewidth</span><span class="s3">=</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_linewidth</span><span class="s3">(),</span>
                         <span class="s3">)</span>

        <span class="s5"># Overwrite manually because patch and line properties don't mix</span>
        <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_drawstyle</span><span class="s3">(</span><span class="s6">'default'</span><span class="s3">)</span>
        <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s6">&quot;&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">legline</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">, </span><span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s2">if </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_fill</span><span class="s3">() </span><span class="s2">or </span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_hatch</span><span class="s3">() </span><span class="s2">is not None</span><span class="s3">):</span>
            <span class="s1">p </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create_patch</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">,</span>
                                   <span class="s1">height</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">p </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_create_line</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s3">[</span><span class="s1">p</span><span class="s3">]</span>


<span class="s2">class </span><span class="s1">HandlerLineCollection</span><span class="s3">(</span><span class="s1">HandlerLine2D</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Handler for `.LineCollection` instances. 
    &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">get_numpoints</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_numpoints </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">scatterpoints</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_numpoints</span>

    <span class="s2">def </span><span class="s1">_default_update_prop</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">):</span>
        <span class="s1">lw </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_linewidths</span><span class="s3">()[</span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">dashes </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">_us_linestyles</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">color </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_colors</span><span class="s3">()[</span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_color</span><span class="s3">(</span><span class="s1">color</span><span class="s3">)</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_linestyle</span><span class="s3">(</span><span class="s1">dashes</span><span class="s3">)</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_linewidth</span><span class="s3">(</span><span class="s1">lw</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">, </span><span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">xdata</span><span class="s3">, </span><span class="s1">xdata_marker </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_xdata</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                                             <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>
        <span class="s1">ydata </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">full_like</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">, (</span><span class="s1">height </span><span class="s3">- </span><span class="s1">ydescent</span><span class="s3">) / </span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">legline </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">, </span><span class="s1">ydata</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">legline</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>
        <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s3">[</span><span class="s1">legline</span><span class="s3">]</span>


<span class="s2">class </span><span class="s1">HandlerRegularPolyCollection</span><span class="s3">(</span><span class="s1">HandlerNpointsYoffsets</span><span class="s3">):</span>
    <span class="s0">r&quot;&quot;&quot;Handler for `.RegularPolyCollection`\s.&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">yoffsets</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">sizes</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">yoffsets</span><span class="s3">=</span><span class="s1">yoffsets</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">_sizes </span><span class="s3">= </span><span class="s1">sizes</span>

    <span class="s2">def </span><span class="s1">get_numpoints</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_numpoints </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">scatterpoints</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_numpoints</span>

    <span class="s2">def </span><span class="s1">get_sizes</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                  <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_sizes </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">handle_sizes </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_sizes</span><span class="s3">()</span>
            <span class="s2">if not </span><span class="s1">len</span><span class="s3">(</span><span class="s1">handle_sizes</span><span class="s3">):</span>
                <span class="s1">handle_sizes </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">]</span>
            <span class="s1">size_max </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span><span class="s1">handle_sizes</span><span class="s3">) * </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">markerscale </span><span class="s3">** </span><span class="s4">2</span>
            <span class="s1">size_min </span><span class="s3">= </span><span class="s1">min</span><span class="s3">(</span><span class="s1">handle_sizes</span><span class="s3">) * </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">markerscale </span><span class="s3">** </span><span class="s4">2</span>

            <span class="s1">numpoints </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_numpoints</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">numpoints </span><span class="s3">&lt; </span><span class="s4">4</span><span class="s3">:</span>
                <span class="s1">sizes </span><span class="s3">= [</span><span class="s4">.5 </span><span class="s3">* (</span><span class="s1">size_max </span><span class="s3">+ </span><span class="s1">size_min</span><span class="s3">), </span><span class="s1">size_max</span><span class="s3">,</span>
                         <span class="s1">size_min</span><span class="s3">][:</span><span class="s1">numpoints</span><span class="s3">]</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">rng </span><span class="s3">= (</span><span class="s1">size_max </span><span class="s3">- </span><span class="s1">size_min</span><span class="s3">)</span>
                <span class="s1">sizes </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">numpoints</span><span class="s3">) + </span><span class="s1">size_min</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">sizes </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_sizes</span>

        <span class="s2">return </span><span class="s1">sizes</span>

    <span class="s2">def </span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">):</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">_update_prop</span><span class="s3">(</span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">)</span>

        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_figure</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">.</span><span class="s1">figure</span><span class="s3">)</span>
        <span class="s5"># legend._set_artist_props(legend_handle)</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_clip_box</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_clip_path</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">create_collection</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">sizes</span><span class="s3">, </span><span class="s1">offsets</span><span class="s3">, </span><span class="s1">offset_transform</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">type</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">)(</span>
            <span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_numsides</span><span class="s3">(),</span>
            <span class="s1">rotation</span><span class="s3">=</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_rotation</span><span class="s3">(), </span><span class="s1">sizes</span><span class="s3">=</span><span class="s1">sizes</span><span class="s3">,</span>
            <span class="s1">offsets</span><span class="s3">=</span><span class="s1">offsets</span><span class="s3">, </span><span class="s1">offset_transform</span><span class="s3">=</span><span class="s1">offset_transform</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">,</span>
                       <span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">xdata</span><span class="s3">, </span><span class="s1">xdata_marker </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_xdata</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                                             <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s1">ydata </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_ydata</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                               <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s1">sizes </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_sizes</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                               <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s1">p </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">create_collection</span><span class="s3">(</span>
            <span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">sizes</span><span class="s3">,</span>
            <span class="s1">offsets</span><span class="s3">=</span><span class="s1">list</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata</span><span class="s3">)), </span><span class="s1">offset_transform</span><span class="s3">=</span><span class="s1">trans</span><span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">set_offset_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s3">[</span><span class="s1">p</span><span class="s3">]</span>


<span class="s2">class </span><span class="s1">HandlerPathCollection</span><span class="s3">(</span><span class="s1">HandlerRegularPolyCollection</span><span class="s3">):</span>
    <span class="s0">r&quot;&quot;&quot;Handler for `.PathCollection`\s, which are used by `~.Axes.scatter`.&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">create_collection</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">sizes</span><span class="s3">, </span><span class="s1">offsets</span><span class="s3">, </span><span class="s1">offset_transform</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">type</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">)(</span>
            <span class="s3">[</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_paths</span><span class="s3">()[</span><span class="s4">0</span><span class="s3">]], </span><span class="s1">sizes</span><span class="s3">=</span><span class="s1">sizes</span><span class="s3">,</span>
            <span class="s1">offsets</span><span class="s3">=</span><span class="s1">offsets</span><span class="s3">, </span><span class="s1">offset_transform</span><span class="s3">=</span><span class="s1">offset_transform</span><span class="s3">,</span>
        <span class="s3">)</span>


<span class="s2">class </span><span class="s1">HandlerCircleCollection</span><span class="s3">(</span><span class="s1">HandlerRegularPolyCollection</span><span class="s3">):</span>
    <span class="s0">r&quot;&quot;&quot;Handler for `.CircleCollection`\s.&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">create_collection</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">sizes</span><span class="s3">, </span><span class="s1">offsets</span><span class="s3">, </span><span class="s1">offset_transform</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">type</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">)(</span>
            <span class="s1">sizes</span><span class="s3">, </span><span class="s1">offsets</span><span class="s3">=</span><span class="s1">offsets</span><span class="s3">, </span><span class="s1">offset_transform</span><span class="s3">=</span><span class="s1">offset_transform</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">HandlerErrorbar</span><span class="s3">(</span><span class="s1">HandlerLine2D</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Handler for Errorbars.&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">xerr_size</span><span class="s3">=</span><span class="s4">0.5</span><span class="s3">, </span><span class="s1">yerr_size</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
                 <span class="s1">marker_pad</span><span class="s3">=</span><span class="s4">0.3</span><span class="s3">, </span><span class="s1">numpoints</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">_xerr_size </span><span class="s3">= </span><span class="s1">xerr_size</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_yerr_size </span><span class="s3">= </span><span class="s1">yerr_size</span>

        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">marker_pad</span><span class="s3">=</span><span class="s1">marker_pad</span><span class="s3">, </span><span class="s1">numpoints</span><span class="s3">=</span><span class="s1">numpoints</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">get_err_size</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                     <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">):</span>
        <span class="s1">xerr_size </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_xerr_size </span><span class="s3">* </span><span class="s1">fontsize</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_yerr_size </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">yerr_size </span><span class="s3">= </span><span class="s1">xerr_size</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">yerr_size </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_yerr_size </span><span class="s3">* </span><span class="s1">fontsize</span>

        <span class="s2">return </span><span class="s1">xerr_size</span><span class="s3">, </span><span class="s1">yerr_size</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">,</span>
                       <span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">plotlines</span><span class="s3">, </span><span class="s1">caplines</span><span class="s3">, </span><span class="s1">barlinecols </span><span class="s3">= </span><span class="s1">orig_handle</span>

        <span class="s1">xdata</span><span class="s3">, </span><span class="s1">xdata_marker </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_xdata</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                                             <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s1">ydata </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">full_like</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">, (</span><span class="s1">height </span><span class="s3">- </span><span class="s1">ydescent</span><span class="s3">) / </span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">legline </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">, </span><span class="s1">ydata</span><span class="s3">)</span>

        <span class="s1">xdata_marker </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">)</span>
        <span class="s1">ydata_marker </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">ydata</span><span class="s3">[:</span><span class="s1">len</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">)])</span>

        <span class="s1">xerr_size</span><span class="s3">, </span><span class="s1">yerr_size </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_err_size</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                                                 <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s1">legline_marker </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata_marker</span><span class="s3">)</span>

        <span class="s5"># when plotlines are None (only errorbars are drawn), we just</span>
        <span class="s5"># make legline invisible.</span>
        <span class="s2">if </span><span class="s1">plotlines </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">legline_marker</span><span class="s3">.</span><span class="s1">set_visible</span><span class="s3">(</span><span class="s2">False</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">legline</span><span class="s3">, </span><span class="s1">plotlines</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>

            <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_drawstyle</span><span class="s3">(</span><span class="s6">'default'</span><span class="s3">)</span>
            <span class="s1">legline</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s6">'none'</span><span class="s3">)</span>

            <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">legline_marker</span><span class="s3">, </span><span class="s1">plotlines</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>
            <span class="s1">legline_marker</span><span class="s3">.</span><span class="s1">set_linestyle</span><span class="s3">(</span><span class="s6">'None'</span><span class="s3">)</span>

            <span class="s2">if </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">markerscale </span><span class="s3">!= </span><span class="s4">1</span><span class="s3">:</span>
                <span class="s1">newsz </span><span class="s3">= </span><span class="s1">legline_marker</span><span class="s3">.</span><span class="s1">get_markersize</span><span class="s3">() * </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">markerscale</span>
                <span class="s1">legline_marker</span><span class="s3">.</span><span class="s1">set_markersize</span><span class="s3">(</span><span class="s1">newsz</span><span class="s3">)</span>

        <span class="s1">handle_barlinecols </span><span class="s3">= []</span>
        <span class="s1">handle_caplines </span><span class="s3">= []</span>

        <span class="s2">if </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">has_xerr</span><span class="s3">:</span>
            <span class="s1">verts </span><span class="s3">= [((</span><span class="s1">x </span><span class="s3">- </span><span class="s1">xerr_size</span><span class="s3">, </span><span class="s1">y</span><span class="s3">), (</span><span class="s1">x </span><span class="s3">+ </span><span class="s1">xerr_size</span><span class="s3">, </span><span class="s1">y</span><span class="s3">))</span>
                     <span class="s2">for </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata_marker</span><span class="s3">)]</span>
            <span class="s1">coll </span><span class="s3">= </span><span class="s1">mcoll</span><span class="s3">.</span><span class="s1">LineCollection</span><span class="s3">(</span><span class="s1">verts</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">coll</span><span class="s3">, </span><span class="s1">barlinecols</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">legend</span><span class="s3">)</span>
            <span class="s1">handle_barlinecols</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">coll</span><span class="s3">)</span>

            <span class="s2">if </span><span class="s1">caplines</span><span class="s3">:</span>
                <span class="s1">capline_left </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata_marker </span><span class="s3">- </span><span class="s1">xerr_size</span><span class="s3">, </span><span class="s1">ydata_marker</span><span class="s3">)</span>
                <span class="s1">capline_right </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata_marker </span><span class="s3">+ </span><span class="s1">xerr_size</span><span class="s3">, </span><span class="s1">ydata_marker</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">capline_left</span><span class="s3">, </span><span class="s1">caplines</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">legend</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">capline_right</span><span class="s3">, </span><span class="s1">caplines</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">legend</span><span class="s3">)</span>
                <span class="s1">capline_left</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s6">&quot;|&quot;</span><span class="s3">)</span>
                <span class="s1">capline_right</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s6">&quot;|&quot;</span><span class="s3">)</span>

                <span class="s1">handle_caplines</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">capline_left</span><span class="s3">)</span>
                <span class="s1">handle_caplines</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">capline_right</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">has_yerr</span><span class="s3">:</span>
            <span class="s1">verts </span><span class="s3">= [((</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s3">- </span><span class="s1">yerr_size</span><span class="s3">), (</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s3">+ </span><span class="s1">yerr_size</span><span class="s3">))</span>
                     <span class="s2">for </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata_marker</span><span class="s3">)]</span>
            <span class="s1">coll </span><span class="s3">= </span><span class="s1">mcoll</span><span class="s3">.</span><span class="s1">LineCollection</span><span class="s3">(</span><span class="s1">verts</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">coll</span><span class="s3">, </span><span class="s1">barlinecols</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">legend</span><span class="s3">)</span>
            <span class="s1">handle_barlinecols</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">coll</span><span class="s3">)</span>

            <span class="s2">if </span><span class="s1">caplines</span><span class="s3">:</span>
                <span class="s1">capline_left </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata_marker </span><span class="s3">- </span><span class="s1">yerr_size</span><span class="s3">)</span>
                <span class="s1">capline_right </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata_marker </span><span class="s3">+ </span><span class="s1">yerr_size</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">capline_left</span><span class="s3">, </span><span class="s1">caplines</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">legend</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">capline_right</span><span class="s3">, </span><span class="s1">caplines</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">legend</span><span class="s3">)</span>
                <span class="s1">capline_left</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s6">&quot;_&quot;</span><span class="s3">)</span>
                <span class="s1">capline_right</span><span class="s3">.</span><span class="s1">set_marker</span><span class="s3">(</span><span class="s6">&quot;_&quot;</span><span class="s3">)</span>

                <span class="s1">handle_caplines</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">capline_left</span><span class="s3">)</span>
                <span class="s1">handle_caplines</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">capline_right</span><span class="s3">)</span>

        <span class="s1">artists </span><span class="s3">= [</span>
            <span class="s3">*</span><span class="s1">handle_barlinecols</span><span class="s3">, *</span><span class="s1">handle_caplines</span><span class="s3">, </span><span class="s1">legline</span><span class="s3">, </span><span class="s1">legline_marker</span><span class="s3">,</span>
        <span class="s3">]</span>
        <span class="s2">for </span><span class="s1">artist </span><span class="s2">in </span><span class="s1">artists</span><span class="s3">:</span>
            <span class="s1">artist</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">artists</span>


<span class="s2">class </span><span class="s1">HandlerStem</span><span class="s3">(</span><span class="s1">HandlerNpointsYoffsets</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Handler for plots produced by `~.Axes.stem`. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">marker_pad</span><span class="s3">=</span><span class="s4">0.3</span><span class="s3">, </span><span class="s1">numpoints</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
                 <span class="s1">bottom</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">yoffsets</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        marker_pad : float, default: 0.3 
            Padding between points in legend entry. 
        numpoints : int, optional 
            Number of points to show in legend entry. 
        bottom : float, optional 
 
        yoffsets : array of floats, optional 
            Length *numpoints* list of y offsets for each point in 
            legend entry. 
        **kwargs 
            Keyword arguments forwarded to `.HandlerNpointsYoffsets`. 
        &quot;&quot;&quot;</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">marker_pad</span><span class="s3">=</span><span class="s1">marker_pad</span><span class="s3">, </span><span class="s1">numpoints</span><span class="s3">=</span><span class="s1">numpoints</span><span class="s3">,</span>
                         <span class="s1">yoffsets</span><span class="s3">=</span><span class="s1">yoffsets</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_bottom </span><span class="s3">= </span><span class="s1">bottom</span>

    <span class="s2">def </span><span class="s1">get_ydata</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_yoffsets </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">ydata </span><span class="s3">= </span><span class="s1">height </span><span class="s3">* (</span><span class="s4">0.5 </span><span class="s3">* </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">_scatteryoffsets </span><span class="s3">+ </span><span class="s4">0.5</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">ydata </span><span class="s3">= </span><span class="s1">height </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_yoffsets</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">ydata</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">,</span>
                       <span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">markerline</span><span class="s3">, </span><span class="s1">stemlines</span><span class="s3">, </span><span class="s1">baseline </span><span class="s3">= </span><span class="s1">orig_handle</span>
        <span class="s5"># Check to see if the stemcontainer is storing lines as a list or a</span>
        <span class="s5"># LineCollection. Eventually using a list will be removed, and this</span>
        <span class="s5"># logic can also be removed.</span>
        <span class="s1">using_linecoll </span><span class="s3">= </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">stemlines</span><span class="s3">, </span><span class="s1">mcoll</span><span class="s3">.</span><span class="s1">LineCollection</span><span class="s3">)</span>

        <span class="s1">xdata</span><span class="s3">, </span><span class="s1">xdata_marker </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_xdata</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                                             <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s1">ydata </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">get_ydata</span><span class="s3">(</span><span class="s1">legend</span><span class="s3">, </span><span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">,</span>
                               <span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_bottom </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">bottom </span><span class="s3">= </span><span class="s4">0.</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">bottom </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_bottom</span>

        <span class="s1">leg_markerline </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata</span><span class="s3">[:</span><span class="s1">len</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">)])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">leg_markerline</span><span class="s3">, </span><span class="s1">markerline</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>

        <span class="s1">leg_stemlines </span><span class="s3">= [</span><span class="s1">Line2D</span><span class="s3">([</span><span class="s1">x</span><span class="s3">, </span><span class="s1">x</span><span class="s3">], [</span><span class="s1">bottom</span><span class="s3">, </span><span class="s1">y</span><span class="s3">])</span>
                         <span class="s2">for </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">xdata_marker</span><span class="s3">, </span><span class="s1">ydata</span><span class="s3">)]</span>

        <span class="s2">if </span><span class="s1">using_linecoll</span><span class="s3">:</span>
            <span class="s5"># change the function used by update_prop() from the default</span>
            <span class="s5"># to one that handles LineCollection</span>
            <span class="s2">with </span><span class="s1">cbook</span><span class="s3">.</span><span class="s1">_setattr_cm</span><span class="s3">(</span>
                    <span class="s1">self</span><span class="s3">, </span><span class="s1">_update_prop_func</span><span class="s3">=</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_copy_collection_props</span><span class="s3">):</span>
                <span class="s2">for </span><span class="s1">line </span><span class="s2">in </span><span class="s1">leg_stemlines</span><span class="s3">:</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">line</span><span class="s3">, </span><span class="s1">stemlines</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>

        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">for </span><span class="s1">lm</span><span class="s3">, </span><span class="s1">m </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">leg_stemlines</span><span class="s3">, </span><span class="s1">stemlines</span><span class="s3">):</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">lm</span><span class="s3">, </span><span class="s1">m</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>

        <span class="s1">leg_baseline </span><span class="s3">= </span><span class="s1">Line2D</span><span class="s3">([</span><span class="s1">np</span><span class="s3">.</span><span class="s1">min</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">xdata</span><span class="s3">)],</span>
                              <span class="s3">[</span><span class="s1">bottom</span><span class="s3">, </span><span class="s1">bottom</span><span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">leg_baseline</span><span class="s3">, </span><span class="s1">baseline</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>

        <span class="s1">artists </span><span class="s3">= [*</span><span class="s1">leg_stemlines</span><span class="s3">, </span><span class="s1">leg_baseline</span><span class="s3">, </span><span class="s1">leg_markerline</span><span class="s3">]</span>
        <span class="s2">for </span><span class="s1">artist </span><span class="s2">in </span><span class="s1">artists</span><span class="s3">:</span>
            <span class="s1">artist</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">artists</span>

    <span class="s2">def </span><span class="s1">_copy_collection_props</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Copy properties from the `.LineCollection` *orig_handle* to the 
        `.Line2D` *legend_handle*. 
        &quot;&quot;&quot;</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_color</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_color</span><span class="s3">()[</span><span class="s4">0</span><span class="s3">])</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_linestyle</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_linestyle</span><span class="s3">()[</span><span class="s4">0</span><span class="s3">])</span>


<span class="s2">class </span><span class="s1">HandlerTuple</span><span class="s3">(</span><span class="s1">HandlerBase</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Handler for Tuple. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">ndivide</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">pad</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        ndivide : int or None, default: 1 
            The number of sections to divide the legend area into.  If None, 
            use the length of the input tuple. 
        pad : float, default: :rc:`legend.borderpad` 
            Padding in units of fraction of font size. 
        **kwargs 
            Keyword arguments forwarded to `.HandlerBase`. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_ndivide </span><span class="s3">= </span><span class="s1">ndivide</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_pad </span><span class="s3">= </span><span class="s1">pad</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(**</span><span class="s1">kwargs</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">,</span>
                       <span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">handler_map </span><span class="s3">= </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">get_legend_handler_map</span><span class="s3">()</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_ndivide </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">ndivide </span><span class="s3">= </span><span class="s1">len</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">ndivide </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_ndivide</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pad </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">pad </span><span class="s3">= </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">borderpad </span><span class="s3">* </span><span class="s1">fontsize</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">pad </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_pad </span><span class="s3">* </span><span class="s1">fontsize</span>

        <span class="s2">if </span><span class="s1">ndivide </span><span class="s3">&gt; </span><span class="s4">1</span><span class="s3">:</span>
            <span class="s1">width </span><span class="s3">= (</span><span class="s1">width </span><span class="s3">- </span><span class="s1">pad </span><span class="s3">* (</span><span class="s1">ndivide </span><span class="s3">- </span><span class="s4">1</span><span class="s3">)) / </span><span class="s1">ndivide</span>

        <span class="s1">xds_cycle </span><span class="s3">= </span><span class="s1">cycle</span><span class="s3">(</span><span class="s1">xdescent </span><span class="s3">- (</span><span class="s1">width </span><span class="s3">+ </span><span class="s1">pad</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">ndivide</span><span class="s3">))</span>

        <span class="s1">a_list </span><span class="s3">= []</span>
        <span class="s2">for </span><span class="s1">handle1 </span><span class="s2">in </span><span class="s1">orig_handle</span><span class="s3">:</span>
            <span class="s1">handler </span><span class="s3">= </span><span class="s1">legend</span><span class="s3">.</span><span class="s1">get_legend_handler</span><span class="s3">(</span><span class="s1">handler_map</span><span class="s3">, </span><span class="s1">handle1</span><span class="s3">)</span>
            <span class="s1">_a_list </span><span class="s3">= </span><span class="s1">handler</span><span class="s3">.</span><span class="s1">create_artists</span><span class="s3">(</span>
                <span class="s1">legend</span><span class="s3">, </span><span class="s1">handle1</span><span class="s3">,</span>
                <span class="s1">next</span><span class="s3">(</span><span class="s1">xds_cycle</span><span class="s3">), </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">, </span><span class="s1">trans</span><span class="s3">)</span>
            <span class="s1">a_list</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">(</span><span class="s1">_a_list</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">a_list</span>


<span class="s2">class </span><span class="s1">HandlerPolyCollection</span><span class="s3">(</span><span class="s1">HandlerBase</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Handler for `.PolyCollection` used in `~.Axes.fill_between` and 
    `~.Axes.stackplot`. 
    &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">_update_prop</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend_handle</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">first_color</span><span class="s3">(</span><span class="s1">colors</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">colors</span><span class="s3">.</span><span class="s1">size </span><span class="s3">== </span><span class="s4">0</span><span class="s3">:</span>
                <span class="s2">return </span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">tuple</span><span class="s3">(</span><span class="s1">colors</span><span class="s3">[</span><span class="s4">0</span><span class="s3">])</span>

        <span class="s2">def </span><span class="s1">get_first</span><span class="s3">(</span><span class="s1">prop_array</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">prop_array</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s1">prop_array</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">return None</span>

        <span class="s5"># orig_handle is a PolyCollection and legend_handle is a Patch.</span>
        <span class="s5"># Directly set Patch color attributes (must be RGBA tuples).</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">_facecolor </span><span class="s3">= </span><span class="s1">first_color</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_facecolor</span><span class="s3">())</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">_edgecolor </span><span class="s3">= </span><span class="s1">first_color</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_edgecolor</span><span class="s3">())</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">_original_facecolor </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">_original_facecolor</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">_original_edgecolor </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">_original_edgecolor</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">_fill </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_fill</span><span class="s3">()</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">_hatch </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_hatch</span><span class="s3">()</span>
        <span class="s5"># Hatch color is anomalous in having no getters and setters.</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">_hatch_color </span><span class="s3">= </span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">_hatch_color</span>
        <span class="s5"># Setters are fine for the remaining attributes.</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_linewidth</span><span class="s3">(</span><span class="s1">get_first</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_linewidths</span><span class="s3">()))</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_linestyle</span><span class="s3">(</span><span class="s1">get_first</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_linestyles</span><span class="s3">()))</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">get_first</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_transforms</span><span class="s3">()))</span>
        <span class="s1">legend_handle</span><span class="s3">.</span><span class="s1">set_figure</span><span class="s3">(</span><span class="s1">orig_handle</span><span class="s3">.</span><span class="s1">get_figure</span><span class="s3">())</span>
        <span class="s5"># Alpha is already taken into account by the color attributes.</span>

    <span class="s2">def </span><span class="s1">create_artists</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">,</span>
                       <span class="s1">xdescent</span><span class="s3">, </span><span class="s1">ydescent</span><span class="s3">, </span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">, </span><span class="s1">fontsize</span><span class="s3">, </span><span class="s1">trans</span><span class="s3">):</span>
        <span class="s5"># docstring inherited</span>
        <span class="s1">p </span><span class="s3">= </span><span class="s1">Rectangle</span><span class="s3">(</span><span class="s1">xy</span><span class="s3">=(-</span><span class="s1">xdescent</span><span class="s3">, -</span><span class="s1">ydescent</span><span class="s3">),</span>
                      <span class="s1">width</span><span class="s3">=</span><span class="s1">width</span><span class="s3">, </span><span class="s1">height</span><span class="s3">=</span><span class="s1">height</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">update_prop</span><span class="s3">(</span><span class="s1">p</span><span class="s3">, </span><span class="s1">orig_handle</span><span class="s3">, </span><span class="s1">legend</span><span class="s3">)</span>
        <span class="s1">p</span><span class="s3">.</span><span class="s1">set_transform</span><span class="s3">(</span><span class="s1">trans</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s3">[</span><span class="s1">p</span><span class="s3">]</span>
</pre>
</body>
</html>