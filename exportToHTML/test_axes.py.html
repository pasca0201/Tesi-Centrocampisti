<html>
<head>
<title>test_axes.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
.s7 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_axes.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">contextlib</span>
<span class="s0">from </span><span class="s1">collections </span><span class="s0">import </span><span class="s1">namedtuple</span>
<span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">from </span><span class="s1">decimal </span><span class="s0">import </span><span class="s1">Decimal</span>
<span class="s0">from </span><span class="s1">functools </span><span class="s0">import </span><span class="s1">partial</span>
<span class="s0">import </span><span class="s1">inspect</span>
<span class="s0">import </span><span class="s1">io</span>
<span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">product</span>
<span class="s0">import </span><span class="s1">platform</span>
<span class="s0">from </span><span class="s1">types </span><span class="s0">import </span><span class="s1">SimpleNamespace</span>

<span class="s0">import </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy </span><span class="s0">import </span><span class="s1">ma</span>
<span class="s0">from </span><span class="s1">cycler </span><span class="s0">import </span><span class="s1">cycler</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">rc_context</span><span class="s2">, </span><span class="s1">patheffects</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">dates </span><span class="s0">as </span><span class="s1">mdates</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">figure </span><span class="s0">import </span><span class="s1">Figure</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">axes </span><span class="s0">import </span><span class="s1">Axes</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">font_manager </span><span class="s0">as </span><span class="s1">mfont_manager</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">markers </span><span class="s0">as </span><span class="s1">mmarkers</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">path </span><span class="s0">as </span><span class="s1">mpath</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">projections</span><span class="s2">.</span><span class="s1">geo </span><span class="s0">import </span><span class="s1">HammerAxes</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">projections</span><span class="s2">.</span><span class="s1">polar </span><span class="s0">import </span><span class="s1">PolarAxes</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">text </span><span class="s0">as </span><span class="s1">mtext</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">ticker </span><span class="s0">as </span><span class="s1">mticker</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">import </span><span class="s1">mpl_toolkits</span><span class="s2">.</span><span class="s1">axisartist </span><span class="s0">as </span><span class="s1">AA  </span><span class="s3"># type: ignore</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">assert_allclose</span><span class="s2">, </span><span class="s1">assert_array_equal</span><span class="s2">, </span><span class="s1">assert_array_almost_equal</span><span class="s2">)</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">image_comparison</span><span class="s2">, </span><span class="s1">check_figures_equal</span><span class="s2">, </span><span class="s1">remove_ticks_and_titles</span><span class="s2">)</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">_markers </span><span class="s0">import </span><span class="s1">needs_usetex</span>

<span class="s3"># Note: Some test cases are run twice: once normally and once with labeled data</span>
<span class="s3">#       These two must be defined in the same test function or need to have</span>
<span class="s3">#       different baseline images to prevent race conditions when pytest runs</span>
<span class="s3">#       the tests with multiple threads.</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_invisible_axes</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_labels</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'x label'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'y label'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlabel</span><span class="s2">() == </span><span class="s4">'x label'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylabel</span><span class="s2">() == </span><span class="s4">'y label'</span>


<span class="s0">def </span><span class="s1">test_repr</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s4">'label'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'x'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'y'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">) == (</span>
        <span class="s4">&quot;&lt;Axes: &quot;</span>
        <span class="s4">&quot;label='label', title={'center': 'title'}, xlabel='x', ylabel='y'&gt;&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_label_loc_vertical</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">sc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'scatter'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'Y Label'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'top'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'X Label'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sc</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s4">&quot;Z Label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'top'</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">sc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'scatter'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'Y Label'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'X Label'</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sc</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s4">&quot;Z Label&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_label_loc_horizontal</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">sc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'scatter'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'Y Label'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'bottom'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'X Label'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sc</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s4">&quot;Z Label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">sc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'scatter'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'Y Label'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'X Label'</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sc</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s4">&quot;Z Label&quot;</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_label_loc_rc</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">&quot;xaxis.labellocation&quot;</span><span class="s2">: </span><span class="s4">&quot;right&quot;</span><span class="s2">,</span>
                                <span class="s4">&quot;yaxis.labellocation&quot;</span><span class="s2">: </span><span class="s4">&quot;top&quot;</span><span class="s2">}):</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">sc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'scatter'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'Y Label'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'X Label'</span><span class="s2">)</span>
        <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sc</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">)</span>
        <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s4">&quot;Z Label&quot;</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">sc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'scatter'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'Y Label'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'X Label'</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">sc</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">set_label</span><span class="s2">(</span><span class="s4">&quot;Z Label&quot;</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_label_shift</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s3"># Test label re-centering on x-axis</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;Test label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">&quot;left&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;Test label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">&quot;center&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">().</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">&quot;center&quot;</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;Test label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">&quot;right&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">().</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">&quot;right&quot;</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;Test label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">&quot;center&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">().</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">&quot;center&quot;</span>

    <span class="s3"># Test label re-centering on y-axis</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">&quot;Test label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">&quot;top&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">&quot;Test label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">&quot;center&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">().</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">&quot;center&quot;</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">&quot;Test label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">&quot;bottom&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">().</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">&quot;left&quot;</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">&quot;Test label&quot;</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">&quot;center&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">().</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">&quot;center&quot;</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_acorr</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">Nx </span><span class="s2">= </span><span class="s5">512</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">Nx</span><span class="s2">).</span><span class="s1">cumsum</span><span class="s2">()</span>
    <span class="s1">maxlags </span><span class="s2">= </span><span class="s1">Nx</span><span class="s2">-</span><span class="s5">1</span>

    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">acorr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">maxlags</span><span class="s2">=</span><span class="s1">maxlags</span><span class="s2">)</span>

    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># Normalized autocorrelation</span>
    <span class="s1">norm_auto_corr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">correlate</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s4">&quot;full&quot;</span><span class="s2">)/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">lags </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s1">maxlags</span><span class="s2">, </span><span class="s1">maxlags</span><span class="s2">+</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">norm_auto_corr </span><span class="s2">= </span><span class="s1">norm_auto_corr</span><span class="s2">[</span><span class="s1">Nx</span><span class="s2">-</span><span class="s5">1</span><span class="s2">-</span><span class="s1">maxlags</span><span class="s2">:</span><span class="s1">Nx</span><span class="s2">+</span><span class="s1">maxlags</span><span class="s2">]</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">lags</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">], </span><span class="s1">norm_auto_corr</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">xmin</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_acorr_integers</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">Nx </span><span class="s2">= </span><span class="s5">51</span>
    <span class="s1">x </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">Nx</span><span class="s2">) * </span><span class="s5">10</span><span class="s2">).</span><span class="s1">cumsum</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>
    <span class="s1">maxlags </span><span class="s2">= </span><span class="s1">Nx</span><span class="s2">-</span><span class="s5">1</span>

    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">acorr</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">maxlags</span><span class="s2">=</span><span class="s1">maxlags</span><span class="s2">)</span>

    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s3"># Normalized autocorrelation</span>
    <span class="s1">norm_auto_corr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">correlate</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s4">&quot;full&quot;</span><span class="s2">)/</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">lags </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s1">maxlags</span><span class="s2">, </span><span class="s1">maxlags</span><span class="s2">+</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">norm_auto_corr </span><span class="s2">= </span><span class="s1">norm_auto_corr</span><span class="s2">[</span><span class="s1">Nx</span><span class="s2">-</span><span class="s5">1</span><span class="s2">-</span><span class="s1">maxlags</span><span class="s2">:</span><span class="s1">Nx</span><span class="s2">+</span><span class="s1">maxlags</span><span class="s2">]</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">lags</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">], </span><span class="s1">norm_auto_corr</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">xmin</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_spy</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">32 </span><span class="s2">* </span><span class="s5">32</span><span class="s2">)</span>
    <span class="s1">a</span><span class="s2">[:</span><span class="s5">16 </span><span class="s2">* </span><span class="s5">32</span><span class="s2">] = </span><span class="s5">0</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">shuffle</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">a</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">32</span><span class="s2">, </span><span class="s5">32</span><span class="s2">))</span>

    <span class="s1">axs_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">axs_test</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">spy</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
    <span class="s1">axs_test</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">spy</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">&quot;.&quot;</span><span class="s2">, </span><span class="s1">origin</span><span class="s2">=</span><span class="s4">&quot;lower&quot;</span><span class="s2">)</span>

    <span class="s1">axs_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s4">&quot;gray_r&quot;</span><span class="s2">, </span><span class="s1">interpolation</span><span class="s2">=</span><span class="s4">&quot;nearest&quot;</span><span class="s2">)</span>
    <span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">tick_top</span><span class="s2">()</span>
    <span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nonzero</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)[::-</span><span class="s5">1</span><span class="s2">], </span><span class="s4">&quot;.&quot;</span><span class="s2">, </span><span class="s1">markersize</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set</span><span class="s2">(</span>
        <span class="s1">aspect</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">xlim</span><span class="s2">=</span><span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">ylim</span><span class="s2">=</span><span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">()[::-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs_ref</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticks_position</span><span class="s2">(</span><span class="s4">&quot;both&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_spy_invalid_kwargs</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">unsupported_kw </span><span class="s0">in </span><span class="s2">[{</span><span class="s4">'interpolation'</span><span class="s2">: </span><span class="s4">'nearest'</span><span class="s2">},</span>
                           <span class="s2">{</span><span class="s4">'marker'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">, </span><span class="s4">'linestyle'</span><span class="s2">: </span><span class="s4">'solid'</span><span class="s2">}]:</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">spy</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">eye</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), **</span><span class="s1">unsupported_kw</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_matshow</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">use</span><span class="s2">(</span><span class="s4">&quot;mpl20&quot;</span><span class="s2">)</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s5">32</span><span class="s2">, </span><span class="s5">32</span><span class="s2">)</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">().</span><span class="s1">matshow</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">tick_top</span><span class="s2">()</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticks_position</span><span class="s2">(</span><span class="s4">'both'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'formatter_ticker_001'</span><span class="s2">,</span>
                   <span class="s4">'formatter_ticker_002'</span><span class="s2">,</span>
                   <span class="s4">'formatter_ticker_003'</span><span class="s2">,</span>
                   <span class="s4">'formatter_ticker_004'</span><span class="s2">,</span>
                   <span class="s4">'formatter_ticker_005'</span><span class="s2">,</span>
                   <span class="s2">],</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.031 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_formatter_ticker</span><span class="s2">():</span>
    <span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units</span><span class="s2">.</span><span class="s1">register</span><span class="s2">()</span>

    <span class="s3"># This should affect the tick size.  (Tests issue #543)</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'lines.markeredgewidth'</span><span class="s2">] = </span><span class="s5">30</span>

    <span class="s3"># This essentially test to see if user specified labels get overwritten</span>
    <span class="s3"># by the auto labeler functionality of the axes.</span>
    <span class="s1">xdata </span><span class="s2">= [</span><span class="s1">x</span><span class="s2">*</span><span class="s1">units</span><span class="s2">.</span><span class="s1">sec </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)]</span>
    <span class="s1">ydata1 </span><span class="s2">= [(</span><span class="s5">1.5</span><span class="s2">*</span><span class="s1">y </span><span class="s2">- </span><span class="s5">0.5</span><span class="s2">)*</span><span class="s1">units</span><span class="s2">.</span><span class="s1">km </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)]</span>
    <span class="s1">ydata2 </span><span class="s2">= [(</span><span class="s5">1.75</span><span class="s2">*</span><span class="s1">y </span><span class="s2">- </span><span class="s5">1.0</span><span class="s2">)*</span><span class="s1">units</span><span class="s2">.</span><span class="s1">km </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)]</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;x-label 001&quot;</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;x-label 001&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">, </span><span class="s1">xunits</span><span class="s2">=</span><span class="s4">&quot;sec&quot;</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;x-label 001&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">, </span><span class="s1">xunits</span><span class="s2">=</span><span class="s4">&quot;sec&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;x-label 003&quot;</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">, </span><span class="s1">xunits</span><span class="s2">=</span><span class="s4">&quot;sec&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata2</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">xunits</span><span class="s2">=</span><span class="s4">&quot;hour&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;x-label 004&quot;</span><span class="s2">)</span>

    <span class="s3"># See SF bug 2846058</span>
    <span class="s3"># https://sourceforge.net/tracker/?func=detail&amp;aid=2846058&amp;group_id=80706&amp;atid=560720</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">, </span><span class="s1">xunits</span><span class="s2">=</span><span class="s4">&quot;sec&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">xdata</span><span class="s2">, </span><span class="s1">ydata2</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">xunits</span><span class="s2">=</span><span class="s4">&quot;hour&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">&quot;x-label 005&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale_view</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_funcformatter_auto_formatter</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">_formfunc</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s4">''</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">isDefault_minfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">isDefault_minfmt</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">_formfunc</span><span class="s2">)</span>

    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">isDefault_minfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">isDefault_minfmt</span>

    <span class="s1">targ_funcformatter </span><span class="s2">= </span><span class="s1">mticker</span><span class="s2">.</span><span class="s1">FuncFormatter</span><span class="s2">(</span><span class="s1">_formfunc</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_major_formatter</span><span class="s2">(),</span>
                      <span class="s1">mticker</span><span class="s2">.</span><span class="s1">FuncFormatter</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_major_formatter</span><span class="s2">().</span><span class="s1">func </span><span class="s2">== </span><span class="s1">targ_funcformatter</span><span class="s2">.</span><span class="s1">func</span>


<span class="s0">def </span><span class="s1">test_strmethodformatter_auto_formatter</span><span class="s2">():</span>
    <span class="s1">formstr </span><span class="s2">= </span><span class="s4">'{x}_{pos}'</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">isDefault_minfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">isDefault_minfmt</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_minor_formatter</span><span class="s2">(</span><span class="s1">formstr</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">isDefault_majfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">isDefault_minfmt</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">isDefault_majfmt</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">isDefault_minfmt</span>

    <span class="s1">targ_strformatter </span><span class="s2">= </span><span class="s1">mticker</span><span class="s2">.</span><span class="s1">StrMethodFormatter</span><span class="s2">(</span><span class="s1">formstr</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minor_formatter</span><span class="s2">(),</span>
                      <span class="s1">mticker</span><span class="s2">.</span><span class="s1">StrMethodFormatter</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_minor_formatter</span><span class="s2">().</span><span class="s1">fmt </span><span class="s2">== </span><span class="s1">targ_strformatter</span><span class="s2">.</span><span class="s1">fmt</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;twin_axis_locators_formatters&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_twin_axis_locators_formatters</span><span class="s2">():</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">num</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">locs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">vals </span><span class="s2">/ </span><span class="s5">2.0</span><span class="s2">)</span>

    <span class="s1">majl </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">FixedLocator</span><span class="s2">(</span><span class="s1">locs</span><span class="s2">)</span>
    <span class="s1">minl </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">FixedLocator</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">])</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">100</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">majl</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_minor_locator</span><span class="s2">(</span><span class="s1">minl</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">FormatStrFormatter</span><span class="s2">(</span><span class="s4">'%08.2lf'</span><span class="s2">))</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_minor_formatter</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">FixedFormatter</span><span class="s2">([</span><span class="s4">'tricks'</span><span class="s2">, </span><span class="s4">'mind'</span><span class="s2">,</span>
                                                      <span class="s4">'jedi'</span><span class="s2">]))</span>

    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">LinearLocator</span><span class="s2">())</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_minor_locator</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">FixedLocator</span><span class="s2">([</span><span class="s5">15</span><span class="s2">, </span><span class="s5">35</span><span class="s2">, </span><span class="s5">55</span><span class="s2">, </span><span class="s5">75</span><span class="s2">]))</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">FormatStrFormatter</span><span class="s2">(</span><span class="s4">'%05.2lf'</span><span class="s2">))</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_minor_formatter</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">FixedFormatter</span><span class="s2">([</span><span class="s4">'c'</span><span class="s2">, </span><span class="s4">'3'</span><span class="s2">, </span><span class="s4">'p'</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">]))</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">twiny</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_twinx_cla</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s1">ax3 </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">twiny</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">cla</span><span class="s2">()</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">cla</span><span class="s2">()</span>

    <span class="s0">assert not </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'twin'</span><span class="s2">, (</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_twin_units</span><span class="s2">(</span><span class="s1">twin</span><span class="s2">):</span>
    <span class="s1">axis_name </span><span class="s2">= </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">twin</span><span class="s0">}</span><span class="s4">axis'</span>
    <span class="s1">twin_func </span><span class="s2">= </span><span class="s4">f'twin</span><span class="s0">{</span><span class="s1">twin</span><span class="s0">}</span><span class="s4">'</span>

    <span class="s1">a </span><span class="s2">= [</span><span class="s4">'0'</span><span class="s2">, </span><span class="s4">'1'</span><span class="s2">]</span>
    <span class="s1">b </span><span class="s2">= [</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">]</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">Figure</span><span class="s2">()</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">axis_name</span><span class="s2">).</span><span class="s1">units </span><span class="s0">is not None</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">twin_func</span><span class="s2">)()</span>
    <span class="s0">assert </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">axis_name</span><span class="s2">).</span><span class="s1">units </span><span class="s0">is not None</span>
    <span class="s0">assert </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">axis_name</span><span class="s2">).</span><span class="s1">units </span><span class="s0">is </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">axis_name</span><span class="s2">).</span><span class="s1">units</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'twin'</span><span class="s2">, (</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">))</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.19</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_twin_logscale</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">twin</span><span class="s2">):</span>
    <span class="s1">twin_func </span><span class="s2">= </span><span class="s4">f'twin</span><span class="s0">{</span><span class="s1">twin</span><span class="s0">}</span><span class="s4">'  </span><span class="s3"># test twinx or twiny</span>
    <span class="s1">set_scale </span><span class="s2">= </span><span class="s4">f'set_</span><span class="s0">{</span><span class="s1">twin</span><span class="s0">}</span><span class="s4">scale'</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)</span>

    <span class="s3"># Change scale after twinning.</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax_twin </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax_test</span><span class="s2">, </span><span class="s1">twin_func</span><span class="s2">)()</span>
    <span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax_test</span><span class="s2">, </span><span class="s1">set_scale</span><span class="s2">)(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s1">ax_twin</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>

    <span class="s3"># Twin after changing scale.</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax_test</span><span class="s2">, </span><span class="s1">set_scale</span><span class="s2">)(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s1">ax_twin </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax_test</span><span class="s2">, </span><span class="s1">twin_func</span><span class="s2">)()</span>
    <span class="s1">ax_twin</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]:</span>
        <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">)</span>
        <span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax_ref</span><span class="s2">, </span><span class="s1">set_scale</span><span class="s2">)(</span><span class="s4">'log'</span><span class="s2">)</span>
        <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>

        <span class="s3"># This is a hack because twinned Axes double-draw the frame.</span>
        <span class="s3"># Remove this when that is fixed.</span>
        <span class="s1">Path </span><span class="s2">= </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">Path</span>
        <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span>
            <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">.</span><span class="s1">PathPatch</span><span class="s2">(</span>
                <span class="s1">Path</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                      <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                      <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                      <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]],</span>
                     <span class="s2">[</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">MOVETO</span><span class="s2">, </span><span class="s1">Path</span><span class="s2">.</span><span class="s1">LINETO</span><span class="s2">] * </span><span class="s5">4</span><span class="s2">),</span>
                <span class="s1">transform</span><span class="s2">=</span><span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">,</span>
                <span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">,</span>
                <span class="s1">edgecolor</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.edgecolor'</span><span class="s2">],</span>
                <span class="s1">linewidth</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.linewidth'</span><span class="s2">],</span>
                <span class="s1">capstyle</span><span class="s2">=</span><span class="s4">'projecting'</span><span class="s2">))</span>

    <span class="s1">remove_ticks_and_titles</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">)</span>
    <span class="s1">remove_ticks_and_titles</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'twin_autoscale.png'</span><span class="s2">],</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.009 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_twinx_axis_scales</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s5">0.5 </span><span class="s2">* </span><span class="s1">x</span>
    <span class="s1">x2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">x2</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">autoscalex_on</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">autoscaley_on</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>

    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s4">'r--'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_twin_inherit_autoscale_setting</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_x_on </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_autoscalex_on</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">ax_x_off </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax_x_on</span><span class="s2">.</span><span class="s1">get_autoscalex_on</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax_x_off</span><span class="s2">.</span><span class="s1">get_autoscalex_on</span><span class="s2">()</span>

    <span class="s1">ax_y_on </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twiny</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_autoscaley_on</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">ax_y_off </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twiny</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax_y_on</span><span class="s2">.</span><span class="s1">get_autoscaley_on</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax_y_off</span><span class="s2">.</span><span class="s1">get_autoscaley_on</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_inverted_cla</span><span class="s2">():</span>
    <span class="s3"># GitHub PR #5450. Setting autoscale should reset</span>
    <span class="s3"># axes to be non-inverted.</span>
    <span class="s3"># plotting an image, then 1d graph, axis is now down</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s3"># 1. test that a new axis is not inverted per default</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis_inverted</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis_inverted</span><span class="s2">()</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">((</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">img</span><span class="s2">)</span>
    <span class="s3"># 2. test that a image axis is inverted</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis_inverted</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis_inverted</span><span class="s2">()</span>
    <span class="s3"># 3. test that clearing and plotting a line, axes are</span>
    <span class="s3"># not inverted</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">cla</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis_inverted</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis_inverted</span><span class="s2">()</span>

    <span class="s3"># 4. autoscaling should not bring back axes to normal</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">cla</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">img</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis_inverted</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis_inverted</span><span class="s2">()</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s3"># 5. two shared axes. Inverting the leader axis should invert the shared</span>
    <span class="s3"># axes; clearing the leader axis should bring axes in shared</span>
    <span class="s3"># axes back to normal.</span>
    <span class="s1">ax0 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">211</span><span class="s2">)</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">212</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s1">ax0</span><span class="s2">)</span>
    <span class="s1">ax0</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_inverted</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis_inverted</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
    <span class="s1">ax0</span><span class="s2">.</span><span class="s1">cla</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis_inverted</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">cla</span><span class="s2">()</span>
    <span class="s3"># 6. clearing the follower should not touch limits</span>
    <span class="s1">ax0</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">img</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">cla</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis_inverted</span><span class="s2">()</span>

    <span class="s3"># clean up</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_subclass_clear_cla</span><span class="s2">():</span>
    <span class="s3"># Ensure that subclasses of Axes call cla/clear correctly.</span>
    <span class="s3"># Note, we cannot use mocking here as we want to be sure that the</span>
    <span class="s3"># superclass fallback does not recurse.</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">PendingDeprecationWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s4">'Overriding `Axes.cla`'</span><span class="s2">):</span>
        <span class="s0">class </span><span class="s1">ClaAxes</span><span class="s2">(</span><span class="s1">Axes</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">cla</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s0">nonlocal </span><span class="s1">called</span>
                <span class="s1">called </span><span class="s2">= </span><span class="s0">True</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">PendingDeprecationWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s4">'Overriding `Axes.cla`'</span><span class="s2">):</span>
        <span class="s0">class </span><span class="s1">ClaSuperAxes</span><span class="s2">(</span><span class="s1">Axes</span><span class="s2">):</span>
            <span class="s0">def </span><span class="s1">cla</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
                <span class="s0">nonlocal </span><span class="s1">called</span>
                <span class="s1">called </span><span class="s2">= </span><span class="s0">True</span>
                <span class="s1">super</span><span class="s2">().</span><span class="s1">cla</span><span class="s2">()</span>

    <span class="s0">class </span><span class="s1">SubClaAxes</span><span class="s2">(</span><span class="s1">ClaAxes</span><span class="s2">):</span>
        <span class="s0">pass</span>

    <span class="s0">class </span><span class="s1">ClearAxes</span><span class="s2">(</span><span class="s1">Axes</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">clear</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s0">nonlocal </span><span class="s1">called</span>
            <span class="s1">called </span><span class="s2">= </span><span class="s0">True</span>

    <span class="s0">class </span><span class="s1">ClearSuperAxes</span><span class="s2">(</span><span class="s1">Axes</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">clear</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s0">nonlocal </span><span class="s1">called</span>
            <span class="s1">called </span><span class="s2">= </span><span class="s0">True</span>
            <span class="s1">super</span><span class="s2">().</span><span class="s1">clear</span><span class="s2">()</span>

    <span class="s0">class </span><span class="s1">SubClearAxes</span><span class="s2">(</span><span class="s1">ClearAxes</span><span class="s2">):</span>
        <span class="s0">pass</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">Figure</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">axes_class </span><span class="s0">in </span><span class="s2">[</span><span class="s1">ClaAxes</span><span class="s2">, </span><span class="s1">ClaSuperAxes</span><span class="s2">, </span><span class="s1">SubClaAxes</span><span class="s2">,</span>
                       <span class="s1">ClearAxes</span><span class="s2">, </span><span class="s1">ClearSuperAxes</span><span class="s2">, </span><span class="s1">SubClearAxes</span><span class="s2">]:</span>
        <span class="s1">called </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">axes_class</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
        <span class="s3"># Axes.__init__ has already called clear (which aliases to cla or is in</span>
        <span class="s3"># the subclass).</span>
        <span class="s0">assert </span><span class="s1">called</span>

        <span class="s1">called </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">cla</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">called</span>


<span class="s0">def </span><span class="s1">test_cla_not_redefined_internally</span><span class="s2">():</span>
    <span class="s0">for </span><span class="s1">klass </span><span class="s0">in </span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">__subclasses__</span><span class="s2">():</span>
        <span class="s3"># Check that cla does not get redefined in our Axes subclasses, except</span>
        <span class="s3"># for in the above test function.</span>
        <span class="s0">if </span><span class="s4">'test_subclass_clear_cla' </span><span class="s0">not in </span><span class="s1">klass</span><span class="s2">.</span><span class="s1">__qualname__</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s4">'cla' </span><span class="s0">not in </span><span class="s1">klass</span><span class="s2">.</span><span class="s1">__dict__</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_minorticks_on_rcParams_both</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">&quot;xtick.minor.visible&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
                                <span class="s4">&quot;ytick.minor.visible&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}):</span>
        <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">minorticks_on</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;autoscale_tiny_range&quot;</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_autoscale_tiny_range</span><span class="s2">():</span>
    <span class="s3"># github pull #904</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">):</span>
        <span class="s1">y1 </span><span class="s2">= </span><span class="s5">10</span><span class="s2">**(-</span><span class="s5">11 </span><span class="s2">- </span><span class="s1">i</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1 </span><span class="s2">+ </span><span class="s1">y1</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_autoscale_tight</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">(</span><span class="s1">enable</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">, </span><span class="s1">tight</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">(</span><span class="s1">enable</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'y'</span><span class="s2">, </span><span class="s1">tight</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), (-</span><span class="s5">0.15</span><span class="s2">, </span><span class="s5">3.15</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">))</span>

    <span class="s3"># Check that autoscale is on</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_autoscalex_on</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_autoscaley_on</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_autoscale_on</span><span class="s2">()</span>
    <span class="s3"># Set enable to None</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">(</span><span class="s1">enable</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s3"># Same limits</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), (-</span><span class="s5">0.15</span><span class="s2">, </span><span class="s5">3.15</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">))</span>
    <span class="s3"># autoscale still on</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_autoscalex_on</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_autoscaley_on</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_autoscale_on</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_autoscale_log_shared</span><span class="s2">():</span>
    <span class="s3"># related to github #7587</span>
    <span class="s3"># array starts at zero to trigger _minpos handling</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">float</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">semilogx</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">(</span><span class="s1">tight</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">(</span><span class="s1">tight</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">lims </span><span class="s2">= (</span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">lims</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), </span><span class="s1">lims</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">lims</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (</span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_use_sticky_edges</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]], </span><span class="s1">origin</span><span class="s2">=</span><span class="s4">'lower'</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">use_sticky_edges </span><span class="s2">= </span><span class="s0">False</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">()</span>
    <span class="s1">xlim </span><span class="s2">= (-</span><span class="s5">0.5 </span><span class="s2">- </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_xmargin</span><span class="s2">, </span><span class="s5">1.5 </span><span class="s2">+ </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_xmargin</span><span class="s2">)</span>
    <span class="s1">ylim </span><span class="s2">= (-</span><span class="s5">0.5 </span><span class="s2">- </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_ymargin</span><span class="s2">, </span><span class="s5">1.5 </span><span class="s2">+ </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_ymargin</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">xlim</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), </span><span class="s1">ylim</span><span class="s2">)</span>
    <span class="s3"># Make sure it is reversible:</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">use_sticky_edges </span><span class="s2">= </span><span class="s0">True</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">()</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_sticky_shared_axes</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># Check that sticky edges work whether they are set in an Axes that is a</span>
    <span class="s3"># &quot;leader&quot; in a share, or an Axes that is a &quot;follower&quot;.</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">15</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">ax0 </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">211</span><span class="s2">)</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">212</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s1">ax0</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">)</span>

    <span class="s1">ax0 </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">212</span><span class="s2">)</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">211</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s1">ax0</span><span class="s2">)</span>
    <span class="s1">ax0</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'sticky_tolerance.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;mpl20&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_sticky_tolerance</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">width </span><span class="s2">= </span><span class="s5">.1</span>

    <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">width</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">20000.6</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">width</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">20000.1</span><span class="s2">)</span>

    <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=-</span><span class="s1">width</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">20000.6</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=-</span><span class="s1">width</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">20000.1</span><span class="s2">)</span>

    <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=-</span><span class="s1">width</span><span class="s2">, </span><span class="s1">left</span><span class="s2">=-</span><span class="s5">20000.6</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=-</span><span class="s1">width</span><span class="s2">, </span><span class="s1">left</span><span class="s2">=-</span><span class="s5">20000.1</span><span class="s2">)</span>

    <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s1">width</span><span class="s2">, </span><span class="s1">left</span><span class="s2">=-</span><span class="s5">20000.6</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">y</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s1">width</span><span class="s2">, </span><span class="s1">left</span><span class="s2">=-</span><span class="s5">20000.1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'sticky_tolerance_cf.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;mpl20&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_sticky_tolerance_contourf</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">y </span><span class="s2">= [</span><span class="s5">14496.71</span><span class="s2">, </span><span class="s5">14496.75</span><span class="s2">]</span>
    <span class="s1">data </span><span class="s2">= [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_nargs_stem</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'0 were given'</span><span class="s2">):</span>
        <span class="s3"># stem() takes 1-3 arguments.</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_nargs_legend</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'3 were given'</span><span class="s2">):</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
        <span class="s3"># legend() takes 0-2 arguments.</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s4">'First'</span><span class="s2">], [</span><span class="s4">'Second'</span><span class="s2">], </span><span class="s5">3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_nargs_pcolorfast</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'2 were given'</span><span class="s2">):</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
        <span class="s3"># pcolorfast() takes 1 or 3 arguments,</span>
        <span class="s3"># not passing any arguments fails at C = args[-1]</span>
        <span class="s3"># before nargs_err is raised.</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolorfast</span><span class="s2">([(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)], [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'offset_points'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_basic_annotate</span><span class="s2">():</span>
    <span class="s3"># Setup some data</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">)</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s5">2.0</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">t</span><span class="s2">)</span>

    <span class="s3"># Offset Points</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">autoscale_on</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(-</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
    <span class="s1">line</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'purple'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s4">'local max'</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s4">'data'</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s4">'offset points'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'arrow_simple.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_arrow_simple</span><span class="s2">():</span>
    <span class="s3"># Simple image test for ax.arrow</span>
    <span class="s3"># kwargs that take discrete values</span>
    <span class="s1">length_includes_head </span><span class="s2">= (</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">shape </span><span class="s2">= (</span><span class="s4">'full'</span><span class="s2">, </span><span class="s4">'left'</span><span class="s2">, </span><span class="s4">'right'</span><span class="s2">)</span>
    <span class="s1">head_starts_at_zero </span><span class="s2">= (</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
    <span class="s3"># Create outer product of values</span>
    <span class="s1">kwargs </span><span class="s2">= </span><span class="s1">product</span><span class="s2">(</span><span class="s1">length_includes_head</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">head_starts_at_zero</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, (</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">kwarg</span><span class="s2">) </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s3"># Unpack kwargs</span>
        <span class="s2">(</span><span class="s1">length_includes_head</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">head_starts_at_zero</span><span class="s2">) = </span><span class="s1">kwarg</span>
        <span class="s1">theta </span><span class="s2">= </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">i </span><span class="s2">/ </span><span class="s5">12</span>
        <span class="s3"># Draw arrow</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">arrow</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">),</span>
                 <span class="s1">width</span><span class="s2">=</span><span class="s1">theta</span><span class="s2">/</span><span class="s5">100</span><span class="s2">,</span>
                 <span class="s1">length_includes_head</span><span class="s2">=</span><span class="s1">length_includes_head</span><span class="s2">,</span>
                 <span class="s1">shape</span><span class="s2">=</span><span class="s1">shape</span><span class="s2">,</span>
                 <span class="s1">head_starts_at_zero</span><span class="s2">=</span><span class="s1">head_starts_at_zero</span><span class="s2">,</span>
                 <span class="s1">head_width</span><span class="s2">=</span><span class="s1">theta </span><span class="s2">/ </span><span class="s5">10</span><span class="s2">,</span>
                 <span class="s1">head_length</span><span class="s2">=</span><span class="s1">theta </span><span class="s2">/ </span><span class="s5">10</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_arrow_empty</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># Create an empty FancyArrow</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">arrow</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">head_length</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_arrow_in_view</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">arrow</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">0.8</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">0.8</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_annotate_default_arrow</span><span class="s2">():</span>
    <span class="s3"># Check that we can make an annotation arrow with only default properties.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ann </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s4">&quot;foo&quot;</span><span class="s2">, (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">arrow_patch </span><span class="s0">is None</span>
    <span class="s1">ann </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s4">&quot;foo&quot;</span><span class="s2">, (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">arrowprops</span><span class="s2">={})</span>
    <span class="s0">assert </span><span class="s1">ann</span><span class="s2">.</span><span class="s1">arrow_patch </span><span class="s0">is not None</span>


<span class="s0">def </span><span class="s1">test_annotate_signature</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Check that the signature of Axes.annotate() matches Annotation.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">annotate_params </span><span class="s2">= </span><span class="s1">inspect</span><span class="s2">.</span><span class="s1">signature</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">).</span><span class="s1">parameters</span>
    <span class="s1">annotation_params </span><span class="s2">= </span><span class="s1">inspect</span><span class="s2">.</span><span class="s1">signature</span><span class="s2">(</span><span class="s1">mtext</span><span class="s2">.</span><span class="s1">Annotation</span><span class="s2">).</span><span class="s1">parameters</span>
    <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">annotate_params</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">()) == </span><span class="s1">list</span><span class="s2">(</span><span class="s1">annotation_params</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">())</span>
    <span class="s0">for </span><span class="s1">p1</span><span class="s2">, </span><span class="s1">p2 </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">annotate_params</span><span class="s2">.</span><span class="s1">values</span><span class="s2">(), </span><span class="s1">annotation_params</span><span class="s2">.</span><span class="s1">values</span><span class="s2">()):</span>
        <span class="s0">assert </span><span class="s1">p1 </span><span class="s2">== </span><span class="s1">p2</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'fill_units.png'</span><span class="s2">], </span><span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">60</span><span class="s2">})</span>
<span class="s0">def </span><span class="s1">test_fill_units</span><span class="s2">():</span>
    <span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units</span><span class="s2">.</span><span class="s1">register</span><span class="s2">()</span>

    <span class="s3"># generate some data</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">units</span><span class="s2">.</span><span class="s1">Epoch</span><span class="s2">(</span><span class="s4">&quot;ET&quot;</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2009</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">27</span><span class="s2">))</span>
    <span class="s1">value </span><span class="s2">= </span><span class="s5">10.0 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span>
    <span class="s1">day </span><span class="s2">= </span><span class="s1">units</span><span class="s2">.</span><span class="s1">Duration</span><span class="s2">(</span><span class="s4">&quot;ET&quot;</span><span class="s2">, </span><span class="s5">24.0 </span><span class="s2">* </span><span class="s5">60.0 </span><span class="s2">* </span><span class="s5">60.0</span><span class="s2">)</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">'2009-04-27'</span><span class="s2">, </span><span class="s4">'2009-04-29'</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'datetime64[D]'</span><span class="s2">)</span>
    <span class="s1">dtn </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, ((</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">), (</span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">)) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">t</span><span class="s2">], [</span><span class="s1">value</span><span class="s2">], </span><span class="s1">yunits</span><span class="s2">=</span><span class="s4">'deg'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">)</span>
    <span class="s1">ind </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">fill</span><span class="s2">(</span><span class="s1">dtn</span><span class="s2">[</span><span class="s1">ind</span><span class="s2">], [</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">90.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">], </span><span class="s4">'b'</span><span class="s2">)</span>

    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">t</span><span class="s2">], [</span><span class="s1">value</span><span class="s2">], </span><span class="s1">yunits</span><span class="s2">=</span><span class="s4">'deg'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">fill</span><span class="s2">([</span><span class="s1">t</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">t </span><span class="s2">+ </span><span class="s1">day</span><span class="s2">, </span><span class="s1">t </span><span class="s2">+ </span><span class="s1">day</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">90.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">], </span><span class="s4">'b'</span><span class="s2">)</span>

    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">t</span><span class="s2">], [</span><span class="s1">value</span><span class="s2">], </span><span class="s1">yunits</span><span class="s2">=</span><span class="s4">'deg'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">)</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">fill</span><span class="s2">(</span><span class="s1">dtn</span><span class="s2">[</span><span class="s1">ind</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s5">0 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span><span class="s2">, </span><span class="s5">0 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span><span class="s2">, </span><span class="s5">90 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span><span class="s2">, </span><span class="s5">0 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span><span class="s2">],</span>
             <span class="s4">'b'</span><span class="s2">)</span>

    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">t</span><span class="s2">], [</span><span class="s1">value</span><span class="s2">], </span><span class="s1">yunits</span><span class="s2">=</span><span class="s4">'deg'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">)</span>
    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">fill</span><span class="s2">([</span><span class="s1">t</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">t </span><span class="s2">+ </span><span class="s1">day</span><span class="s2">, </span><span class="s1">t </span><span class="s2">+ </span><span class="s1">day</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s5">0 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span><span class="s2">, </span><span class="s5">0 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span><span class="s2">, </span><span class="s5">90 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span><span class="s2">, </span><span class="s5">0 </span><span class="s2">* </span><span class="s1">units</span><span class="s2">.</span><span class="s1">deg</span><span class="s2">],</span>
             <span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;blue&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">autofmt_xdate</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_plot_format_kwarg_redundant</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;marker .* redundantly defined&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;linestyle .* redundantly defined&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], </span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;color .* redundantly defined&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], </span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">)</span>
    <span class="s3"># smoke-test: should not warn</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_dashes</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>

    <span class="s1">line</span><span class="s2">, *</span><span class="s1">_ </span><span class="s2">= </span><span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">))</span>
    <span class="s1">line</span><span class="s2">.</span><span class="s1">set_dashes</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>

    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">dashes</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_errorbar_mapview_kwarg</span><span class="s2">():</span>
    <span class="s1">D </span><span class="s2">= {</span><span class="s1">ii</span><span class="s2">: </span><span class="s1">ii </span><span class="s0">for </span><span class="s1">ii </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s1">D</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(), </span><span class="s1">y</span><span class="s2">=</span><span class="s1">D</span><span class="s2">.</span><span class="s1">values</span><span class="s2">(), </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">D</span><span class="s2">.</span><span class="s1">values</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'single_point'</span><span class="s2">, </span><span class="s4">'single_point'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_single_point</span><span class="s2">():</span>
    <span class="s3"># Issue #1796: don't let lines.marker affect the grid</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'lines.marker'</span><span class="s2">] = </span><span class="s4">'o'</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.grid'</span><span class="s2">] = </span><span class="s0">True</span>

    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], </span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">], </span><span class="s4">'o'</span><span class="s2">)</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">'a'</span><span class="s2">: [</span><span class="s5">0</span><span class="s2">], </span><span class="s4">'b'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">]}</span>

    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'single_date.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_single_date</span><span class="s2">():</span>

    <span class="s3"># use former defaults to match existing baseline image</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.formatter.limits'</span><span class="s2">] = -</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'0000-12-31'</span><span class="s2">))</span>

    <span class="s1">time1 </span><span class="s2">= [</span><span class="s5">721964.0</span><span class="s2">]</span>
    <span class="s1">data1 </span><span class="s2">= [-</span><span class="s5">65.54</span><span class="s2">]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot_date</span><span class="s2">(</span><span class="s1">time1 </span><span class="s2">+ </span><span class="s1">dt</span><span class="s2">, </span><span class="s1">data1</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">time1</span><span class="s2">, </span><span class="s1">data1</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_shaped_data</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">row </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">col </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">10</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>

    <span class="s1">axs </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">row</span><span class="s2">)  </span><span class="s3"># Actually plots nothing (columns are single points).</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">col</span><span class="s2">)  </span><span class="s3"># Same as plotting 1d.</span>

    <span class="s1">axs </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s3"># xlim from the implicit &quot;x=0&quot;, ylim from the row datalim.</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s5">.06</span><span class="s2">, </span><span class="s5">.06</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">9</span><span class="s2">))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">col</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">())</span>


<span class="s0">def </span><span class="s1">test_structured_data</span><span class="s2">():</span>
    <span class="s3"># support for structured data</span>
    <span class="s1">pts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)], </span><span class="s1">dtype</span><span class="s2">=[(</span><span class="s4">&quot;ones&quot;</span><span class="s2">, </span><span class="s1">float</span><span class="s2">), (</span><span class="s4">&quot;twos&quot;</span><span class="s2">, </span><span class="s1">float</span><span class="s2">)])</span>

    <span class="s3"># this should not read second name as a format and raise ValueError</span>
    <span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">&quot;ones&quot;</span><span class="s2">, </span><span class="s4">&quot;twos&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">pts</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">&quot;ones&quot;</span><span class="s2">, </span><span class="s4">&quot;twos&quot;</span><span class="s2">, </span><span class="s4">&quot;r&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">pts</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'aitoff_proj'</span><span class="s2">], </span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_aitoff_proj</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Test aitoff projection ref.: 
    https://github.com/matplotlib/matplotlib/pull/14451 
    &quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s5">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s5">2</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">8</span><span class="s2">, </span><span class="s5">4.2</span><span class="s2">),</span>
                           <span class="s1">subplot_kw</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">projection</span><span class="s2">=</span><span class="s4">&quot;aitoff&quot;</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">markersize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'axvspan_epoch'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_axvspan_epoch</span><span class="s2">():</span>
    <span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units</span><span class="s2">.</span><span class="s1">register</span><span class="s2">()</span>

    <span class="s3"># generate some data</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">units</span><span class="s2">.</span><span class="s1">Epoch</span><span class="s2">(</span><span class="s4">&quot;ET&quot;</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2009</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">21</span><span class="s2">))</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">units</span><span class="s2">.</span><span class="s1">Epoch</span><span class="s2">(</span><span class="s4">&quot;ET&quot;</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2009</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">22</span><span class="s2">))</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">units</span><span class="s2">.</span><span class="s1">Duration</span><span class="s2">(</span><span class="s4">&quot;ET&quot;</span><span class="s2">, </span><span class="s1">units</span><span class="s2">.</span><span class="s1">day</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;sec&quot;</span><span class="s2">))</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvspan</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">tf</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;blue&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.25</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">t0 </span><span class="s2">- </span><span class="s5">5.0</span><span class="s2">*</span><span class="s1">dt</span><span class="s2">, </span><span class="s1">tf </span><span class="s2">+ </span><span class="s5">5.0</span><span class="s2">*</span><span class="s1">dt</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'axhspan_epoch'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.02</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_axhspan_epoch</span><span class="s2">():</span>
    <span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units</span><span class="s2">.</span><span class="s1">register</span><span class="s2">()</span>

    <span class="s3"># generate some data</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">units</span><span class="s2">.</span><span class="s1">Epoch</span><span class="s2">(</span><span class="s4">&quot;ET&quot;</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2009</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">21</span><span class="s2">))</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">units</span><span class="s2">.</span><span class="s1">Epoch</span><span class="s2">(</span><span class="s4">&quot;ET&quot;</span><span class="s2">, </span><span class="s1">dt</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2009</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">22</span><span class="s2">))</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">units</span><span class="s2">.</span><span class="s1">Duration</span><span class="s2">(</span><span class="s4">&quot;ET&quot;</span><span class="s2">, </span><span class="s1">units</span><span class="s2">.</span><span class="s1">day</span><span class="s2">.</span><span class="s1">convert</span><span class="s2">(</span><span class="s4">&quot;sec&quot;</span><span class="s2">))</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhspan</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">tf</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;blue&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.25</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">t0 </span><span class="s2">- </span><span class="s5">5.0</span><span class="s2">*</span><span class="s1">dt</span><span class="s2">, </span><span class="s1">tf </span><span class="s2">+ </span><span class="s5">5.0</span><span class="s2">*</span><span class="s1">dt</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hexbin_extent.png'</span><span class="s2">, </span><span class="s4">'hexbin_extent.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hexbin_extent</span><span class="s2">():</span>
    <span class="s3"># this test exposes sf bug 2856228</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2000</span><span class="s2">) / </span><span class="s5">2000</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">))</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">data</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">extent</span><span class="s2">=[</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">, </span><span class="s5">.7</span><span class="s2">])</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;x&quot;</span><span class="s2">: </span><span class="s1">x</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">: </span><span class="s1">y</span><span class="s2">}</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">extent</span><span class="s2">=[</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">, </span><span class="s5">.7</span><span class="s2">], </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hexbin_bad_extents</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">20</span><span class="s2">) / </span><span class="s5">20</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">data</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;In extent, xmax must be greater than xmin&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">extent</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;In extent, ymax must be greater than ymin&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">extent</span><span class="s2">=(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hexbin_empty.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hexbin_empty</span><span class="s2">():</span>
    <span class="s3"># From #3886: creating hexbin from empty dataset raises ValueError</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">([], [])</span>
    <span class="s3"># From #23922: creating hexbin with log scaling from empty</span>
    <span class="s3"># dataset raises ValueError</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">([], [], </span><span class="s1">bins</span><span class="s2">=</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s3"># From #27103: np.max errors when handed empty data</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">([], [], </span><span class="s1">C</span><span class="s2">=[], </span><span class="s1">reduce_C_function</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">)</span>
    <span class="s3"># No string-comparison warning from NumPy.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">([], [], </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_hexbin_pickable</span><span class="s2">():</span>
    <span class="s3"># From #1973: Test that picking a hexbin collection works</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">200</span><span class="s2">) / </span><span class="s5">200</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">100</span><span class="s2">))</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">data</span>
    <span class="s1">hb </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">extent</span><span class="s2">=[</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">, </span><span class="s5">.7</span><span class="s2">], </span><span class="s1">picker</span><span class="s2">=-</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">mouse_event </span><span class="s2">= </span><span class="s1">SimpleNamespace</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s5">400</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s5">300</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">hb</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s1">mouse_event</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hexbin_log.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hexbin_log</span><span class="s2">():</span>
    <span class="s3"># Issue #1636 (and also test log scaled colorbar)</span>

    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s5">100000</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s5">2.0 </span><span class="s2">+ </span><span class="s5">3.0 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">4.0 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">power</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s1">y </span><span class="s2">* </span><span class="s5">0.5</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yscale</span><span class="s2">=</span><span class="s4">'log'</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s4">'log'</span><span class="s2">,</span>
                  <span class="s1">marginals</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">reduce_C_function</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;hexbin_linear.png&quot;</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;mpl20&quot;</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hexbin_linear</span><span class="s2">():</span>
    <span class="s3"># Issue #21165</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s5">100000</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s5">2.0 </span><span class="s2">+ </span><span class="s5">3.0 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">4.0 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">gridsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s1">marginals</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
              <span class="s1">reduce_C_function</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hexbin_log_clim</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">200</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">100</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s4">'log'</span><span class="s2">, </span><span class="s1">vmin</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s5">100</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_clim</span><span class="s2">() == (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hexbin_mincnt_behavior_upon_C_parameter</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># see: gh:12926</span>
    <span class="s1">datapoints </span><span class="s2">= [</span>
        <span class="s3"># list of (x, y)</span>
        <span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">0</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">6</span><span class="s2">),</span>
    <span class="s2">]</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">zip</span><span class="s2">(*</span><span class="s1">datapoints</span><span class="s2">)</span>
    <span class="s1">C </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">] * </span><span class="s1">len</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">extent </span><span class="s2">= [-</span><span class="s5">10.</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, -</span><span class="s5">10.</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">gridsize </span><span class="s2">= (</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">)</span>

    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s3"># without C parameter</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span>
        <span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">,</span>
        <span class="s1">extent</span><span class="s2">=</span><span class="s1">extent</span><span class="s2">,</span>
        <span class="s1">gridsize</span><span class="s2">=</span><span class="s1">gridsize</span><span class="s2">,</span>
        <span class="s1">mincnt</span><span class="s2">=</span><span class="s5">1</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">set_facecolor</span><span class="s2">(</span><span class="s4">&quot;green&quot;</span><span class="s2">)  </span><span class="s3"># for contrast of background</span>

    <span class="s3"># with C parameter</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span>
        <span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">,</span>
        <span class="s1">C</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">] * </span><span class="s1">len</span><span class="s2">(</span><span class="s1">X</span><span class="s2">),</span>
        <span class="s1">reduce_C_function</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">v</span><span class="s2">: </span><span class="s1">sum</span><span class="s2">(</span><span class="s1">v</span><span class="s2">),</span>
        <span class="s1">mincnt</span><span class="s2">=</span><span class="s5">1</span><span class="s2">,</span>
        <span class="s1">extent</span><span class="s2">=</span><span class="s1">extent</span><span class="s2">,</span>
        <span class="s1">gridsize</span><span class="s2">=</span><span class="s1">gridsize</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">set_facecolor</span><span class="s2">(</span><span class="s4">&quot;green&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_inverted_limits</span><span class="s2">():</span>
    <span class="s3"># Test gh:1553</span>
    <span class="s3"># Calling invert_xaxis prior to plotting should not disable autoscaling</span>
    <span class="s3"># while still maintaining the inverted direction</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_xaxis</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s5">5</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">4</span><span class="s2">, -</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (-</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s5">5</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (-</span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">5</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">)</span>

    <span class="s3"># Test inverting nonlinear axes.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">10</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'nonfinite_limits'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_nonfinite_limits</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">e</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">)</span>
    <span class="s3"># silence divide by zero warning from log(0)</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x</span><span class="s2">[</span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)//</span><span class="s5">2</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'plot_fun'</span><span class="s2">,</span>
                         <span class="s2">[</span><span class="s4">'scatter'</span><span class="s2">, </span><span class="s4">'plot'</span><span class="s2">, </span><span class="s4">'fill_between'</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_limits_empty_data</span><span class="s2">(</span><span class="s1">plot_fun</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># Check that plotting empty data doesn't change autoscaling of dates</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">&quot;2010-01-01&quot;</span><span class="s2">, </span><span class="s4">&quot;2011-01-01&quot;</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;datetime64[D]&quot;</span><span class="s2">)</span>

    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax_test</span><span class="s2">, </span><span class="s1">plot_fun</span><span class="s2">)([], [])</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s2">[</span><span class="s1">ax_test</span><span class="s2">, </span><span class="s1">ax_ref</span><span class="s2">]:</span>
        <span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">plot_fun</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)), </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C0'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'imshow'</span><span class="s2">, </span><span class="s4">'imshow'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_imshow</span><span class="s2">():</span>
    <span class="s3"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'image.interpolation'</span><span class="s2">] = </span><span class="s4">'nearest'</span>
    <span class="s3"># Create a NxN image</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s5">100</span>
    <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">) = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">indices</span><span class="s2">((</span><span class="s1">N</span><span class="s2">, </span><span class="s1">N</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">-= </span><span class="s1">N</span><span class="s2">//</span><span class="s5">2</span>
    <span class="s1">y </span><span class="s2">-= </span><span class="s1">N</span><span class="s2">//</span><span class="s5">2</span>
    <span class="s1">r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">x</span><span class="s2">**</span><span class="s5">2</span><span class="s2">+</span><span class="s1">y</span><span class="s2">**</span><span class="s5">2</span><span class="s2">-</span><span class="s1">x</span><span class="s2">*</span><span class="s1">y</span><span class="s2">)</span>

    <span class="s3"># Create a contour plot at N/4 and extract both the clip path and transform</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">r</span><span class="s2">)</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;r&quot;</span><span class="s2">: </span><span class="s1">r</span><span class="s2">}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s4">&quot;r&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span>
    <span class="s2">[</span><span class="s4">'imshow_clip'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">,</span>
    <span class="s1">tol</span><span class="s2">=</span><span class="s5">1.24 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() </span><span class="s0">in </span><span class="s2">(</span><span class="s4">'aarch64'</span><span class="s2">, </span><span class="s4">'ppc64le'</span><span class="s2">, </span><span class="s4">'s390x'</span><span class="s2">) </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_imshow_clip</span><span class="s2">():</span>
    <span class="s3"># As originally reported by Gellule Xg &lt;gellule.xg@free.fr&gt;</span>
    <span class="s3"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'image.interpolation'</span><span class="s2">] = </span><span class="s4">'nearest'</span>

    <span class="s3"># Create a NxN image</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s5">100</span>
    <span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">) = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">indices</span><span class="s2">((</span><span class="s1">N</span><span class="s2">, </span><span class="s1">N</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">-= </span><span class="s1">N</span><span class="s2">//</span><span class="s5">2</span>
    <span class="s1">y </span><span class="s2">-= </span><span class="s1">N</span><span class="s2">//</span><span class="s5">2</span>
    <span class="s1">r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">x</span><span class="s2">**</span><span class="s5">2</span><span class="s2">+</span><span class="s1">y</span><span class="s2">**</span><span class="s5">2</span><span class="s2">-</span><span class="s1">x</span><span class="s2">*</span><span class="s1">y</span><span class="s2">)</span>

    <span class="s3"># Create a contour plot at N/4 and extract both the clip path and transform</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">c </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, [</span><span class="s1">N</span><span class="s2">/</span><span class="s5">4</span><span class="s2">])</span>
    <span class="s1">clip_path </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">TransformedPath</span><span class="s2">(</span><span class="s1">c</span><span class="s2">.</span><span class="s1">get_paths</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">c</span><span class="s2">.</span><span class="s1">get_transform</span><span class="s2">())</span>

    <span class="s3"># Plot the image clipped by the contour</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s1">clip_path</span><span class="s2">=</span><span class="s1">clip_path</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_imshow_norm_vminvmax</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Parameters vmin, vmax should error if norm is given.&quot;&quot;&quot;</span>
    <span class="s1">a </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]]</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Passing a Normalize instance simultaneously &quot;</span>
                             <span class="s4">&quot;with vmin/vmax is not supported.&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">Normalize</span><span class="s2">(-</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">), </span><span class="s1">vmin</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'polycollection_joinstyle'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_polycollection_joinstyle</span><span class="s2">():</span>
    <span class="s3"># Bug #2890979 reported by Matthew West</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">verts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">collections</span><span class="s2">.</span><span class="s1">PolyCollection</span><span class="s2">([</span><span class="s1">verts</span><span class="s2">], </span><span class="s1">linewidths</span><span class="s2">=</span><span class="s5">40</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">c</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xbound</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ybound</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">'x, y1, y2'</span><span class="s2">, [</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)), </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)), </span><span class="s5">3</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">), </span><span class="s5">3</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)))</span>
    <span class="s2">], </span><span class="s1">ids</span><span class="s2">=[</span>
        <span class="s4">'2d_x_input'</span><span class="s2">,</span>
        <span class="s4">'2d_y1_input'</span><span class="s2">,</span>
        <span class="s4">'2d_y2_input'</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_fill_between_input</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">'y, x1, x2'</span><span class="s2">, [</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)), </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)), </span><span class="s5">3</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">), </span><span class="s5">3</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)))</span>
    <span class="s2">], </span><span class="s1">ids</span><span class="s2">=[</span>
        <span class="s4">'2d_y_input'</span><span class="s2">,</span>
        <span class="s4">'2d_x1_input'</span><span class="s2">,</span>
        <span class="s4">'2d_x2_input'</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_fill_betweenx_input</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_betweenx</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'fill_between_interpolate'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.012 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_fill_between_interpolate</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">)</span>
    <span class="s1">y1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s5">1.2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">4</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">*</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">y2 </span><span class="s2">&gt;= </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'white'</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s4">'/'</span><span class="s2">,</span>
                     <span class="s1">interpolate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">y2 </span><span class="s2">&lt;= </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">,</span>
                     <span class="s1">interpolate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s3"># Test support for masked arrays.</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_greater</span><span class="s2">(</span><span class="s1">y2</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">)</span>
    <span class="s3"># Test that plotting works for masked arrays with the first element masked</span>
    <span class="s1">y2</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">y2 </span><span class="s2">&gt;= </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">,</span>
                     <span class="s1">interpolate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">y2 </span><span class="s2">&lt;= </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">,</span>
                     <span class="s1">interpolate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'fill_between_interpolate_decreasing'</span><span class="s2">],</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_fill_between_interpolate_decreasing</span><span class="s2">():</span>
    <span class="s1">p </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">724.3</span><span class="s2">, </span><span class="s5">700</span><span class="s2">, </span><span class="s5">655</span><span class="s2">])</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">9.4</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">])</span>
    <span class="s1">prof </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">7.9</span><span class="s2">, </span><span class="s5">6.6</span><span class="s2">, </span><span class="s5">3.8</span><span class="s2">])</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">9</span><span class="s2">, </span><span class="s5">9</span><span class="s2">))</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s4">'tab:red'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">prof</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s4">'k'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_betweenx</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">prof</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">prof </span><span class="s2">&lt; </span><span class="s1">t</span><span class="s2">,</span>
                     <span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">, </span><span class="s1">interpolate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_betweenx</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">prof</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">prof </span><span class="s2">&gt; </span><span class="s1">t</span><span class="s2">,</span>
                     <span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">, </span><span class="s1">interpolate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">30</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">800</span><span class="s2">, </span><span class="s5">600</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'fill_between_interpolate_nan'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_fill_between_interpolate_nan</span><span class="s2">():</span>
    <span class="s3"># Tests fix for issue #18986.</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">([</span><span class="s5">8</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">24</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">18</span><span class="s2">])</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">([</span><span class="s5">18</span><span class="s2">, </span><span class="s5">11</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">11</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">26</span><span class="s2">, </span><span class="s5">32</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">y2 </span><span class="s2">&gt;= </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;green&quot;</span><span class="s2">,</span>
                    <span class="s1">interpolate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">y1 </span><span class="s2">&gt;= </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;red&quot;</span><span class="s2">,</span>
                    <span class="s1">interpolate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>


<span class="s3"># test_symlog and test_symlog2 used to have baseline images in all three</span>
<span class="s3"># formats, but the png and svg baselines got invalidated by the removal of</span>
<span class="s3"># minor tick overstriking.</span>
<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'symlog.pdf'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_symlog</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s5">24</span><span class="s2">])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1000000</span><span class="s2">, </span><span class="s5">500000</span><span class="s2">, </span><span class="s5">100000</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">'symlog'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'linear'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10000000</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'symlog2.pdf'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_symlog2</span><span class="s2">():</span>
    <span class="s3"># Numbers from -50 to 50, with 0.1 as step</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s5">50</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">0.001</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">linthresh </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">, [</span><span class="s5">20.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">]):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'symlog'</span><span class="s2">, </span><span class="s1">linthresh</span><span class="s2">=</span><span class="s1">linthresh</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pcolorargs_5205</span><span class="s2">():</span>
    <span class="s3"># Smoketest to catch issue found in gh:5205</span>
    <span class="s1">x </span><span class="s2">= [-</span><span class="s5">1.5</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [-</span><span class="s5">1.5</span><span class="s2">, -</span><span class="s5">1.25</span><span class="s2">, -</span><span class="s5">1.0</span><span class="s2">, -</span><span class="s5">0.75</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">, -</span><span class="s5">0.25</span><span class="s2">, </span><span class="s5">0</span><span class="s2">,</span>
         <span class="s5">0.25</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.75</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.25</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">]</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hypot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">))</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">list</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pcolormesh'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pcolormesh</span><span class="s2">():</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">n </span><span class="s2">= </span><span class="s5">12</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">n</span><span class="s2">*</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Qx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">Y</span><span class="s2">) - </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">Qz </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">Y</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">Qx </span><span class="s2">= (</span><span class="s1">Qx </span><span class="s2">+ </span><span class="s5">1.1</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hypot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">) / </span><span class="s5">5</span>
    <span class="s1">Z </span><span class="s2">= (</span><span class="s1">Z </span><span class="s2">- </span><span class="s1">Z</span><span class="s2">.</span><span class="s1">min</span><span class="s2">()) / </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">)</span>

    <span class="s3"># The color array can include masked values:</span>
    <span class="s1">Zm </span><span class="s2">= </span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">Qz</span><span class="s2">) &lt; </span><span class="s5">0.5 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">Qz</span><span class="s2">), </span><span class="s1">Z</span><span class="s2">)</span>

    <span class="s1">_</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qz</span><span class="s2">, </span><span class="s1">Zm</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qz</span><span class="s2">, </span><span class="s1">Zm</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=[</span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'w'</span><span class="s2">])</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qz</span><span class="s2">, </span><span class="s1">Zm</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">&quot;gouraud&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pcolormesh_small'</span><span class="s2">], </span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;eps&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_pcolormesh_small</span><span class="s2">():</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s5">3</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">n</span><span class="s2">*</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Qx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">Y</span><span class="s2">) - </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">Qz </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">Y</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">Qx </span><span class="s2">= (</span><span class="s1">Qx </span><span class="s2">+ </span><span class="s5">1.1</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hypot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">) / </span><span class="s5">5</span>
    <span class="s1">Z </span><span class="s2">= (</span><span class="s1">Z </span><span class="s2">- </span><span class="s1">Z</span><span class="s2">.</span><span class="s1">min</span><span class="s2">()) / </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">)</span>
    <span class="s1">Zm </span><span class="s2">= </span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">Qz</span><span class="s2">) &lt; </span><span class="s5">0.5 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">Qz</span><span class="s2">), </span><span class="s1">Z</span><span class="s2">)</span>
    <span class="s1">Zm2 </span><span class="s2">= </span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_where</span><span class="s2">(</span><span class="s1">Qz </span><span class="s2">&lt; -</span><span class="s5">0.5 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">Qz</span><span class="s2">), </span><span class="s1">Z</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, ((</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">), (</span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">)) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qz</span><span class="s2">, </span><span class="s1">Zm</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qz</span><span class="s2">, </span><span class="s1">Zm</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=[</span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'w'</span><span class="s2">])</span>
    <span class="s3"># gouraud with Zm yields a blank plot; there are no unmasked triangles.</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qz</span><span class="s2">, </span><span class="s1">Zm</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">&quot;gouraud&quot;</span><span class="s2">)</span>
    <span class="s3"># Reduce the masking to get a plot.</span>
    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qz</span><span class="s2">, </span><span class="s1">Zm2</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">&quot;gouraud&quot;</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_axis_off</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pcolormesh_alpha'</span><span class="s2">], </span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">, </span><span class="s4">&quot;pdf&quot;</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pcolormesh_alpha</span><span class="s2">():</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">n </span><span class="s2">= </span><span class="s5">12</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">n</span><span class="s2">),</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">n</span><span class="s2">*</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s2">)</span>
    <span class="s1">Qx </span><span class="s2">= </span><span class="s1">X</span>
    <span class="s1">Qy </span><span class="s2">= </span><span class="s1">Y </span><span class="s2">+ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hypot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">) / </span><span class="s5">5</span>
    <span class="s1">Z </span><span class="s2">= (</span><span class="s1">Z </span><span class="s2">- </span><span class="s1">Z</span><span class="s2">.</span><span class="s1">min</span><span class="s2">()) / </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ptp</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">)</span>
    <span class="s1">vir </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">&quot;viridis&quot;</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s5">16</span><span class="s2">)</span>
    <span class="s3"># make another colormap with varying alpha</span>
    <span class="s1">colors </span><span class="s2">= </span><span class="s1">vir</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">16</span><span class="s2">))</span>
    <span class="s1">colors</span><span class="s2">[:, </span><span class="s5">3</span><span class="s2">] = </span><span class="s5">0.5 </span><span class="s2">+ </span><span class="s5">0.5</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">16</span><span class="s2">))</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">ListedColormap</span><span class="s2">(</span><span class="s1">colors</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, ((</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">), (</span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">)) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">(</span>
            <span class="s2">(</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1.5</span><span class="s2">), </span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=[</span><span class="s5">.7</span><span class="s2">, </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">], </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">0</span>
        <span class="s2">))</span>
    <span class="s3"># ax1, ax2: constant alpha</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qy</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">vir</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">,</span>
                   <span class="s1">shading</span><span class="s2">=</span><span class="s4">'flat'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qy</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">vir</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'gouraud'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s3"># ax3, ax4: alpha from colormap</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qy</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'flat'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">Qx</span><span class="s2">, </span><span class="s1">Qy</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'gouraud'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;dims,alpha&quot;</span><span class="s2">, [(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)])</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_pcolormesh_rgba</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">dims</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s1">dims</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">float</span><span class="s2">) / </span><span class="s5">2</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">c</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">c</span><span class="s2">[..., </span><span class="s5">0</span><span class="s2">], </span><span class="s1">cmap</span><span class="s2">=</span><span class="s4">&quot;gray&quot;</span><span class="s2">, </span><span class="s1">vmin</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s1">alpha</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pcolormesh_datetime_axis.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pcolormesh_datetime_axis</span><span class="s2">():</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">hspace</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s5">0.98</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">.15</span><span class="s2">)</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2013</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">base </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s1">d</span><span class="s2">) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">21</span><span class="s2">)])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">21</span><span class="s2">)</span>
    <span class="s1">z1</span><span class="s2">, </span><span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">20</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">20</span><span class="s2">))</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">z1 </span><span class="s2">* </span><span class="s1">z2</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">221</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">222</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">], </span><span class="s5">21</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[:, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">], </span><span class="s5">21</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">223</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">224</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">get_axes</span><span class="s2">():</span>
        <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">():</span>
            <span class="s1">label</span><span class="s2">.</span><span class="s1">set_ha</span><span class="s2">(</span><span class="s4">'right'</span><span class="s2">)</span>
            <span class="s1">label</span><span class="s2">.</span><span class="s1">set_rotation</span><span class="s2">(</span><span class="s5">30</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pcolor_datetime_axis.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pcolor_datetime_axis</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">hspace</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s5">0.98</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">.15</span><span class="s2">)</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2013</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">base </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s1">d</span><span class="s2">) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">21</span><span class="s2">)])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">21</span><span class="s2">)</span>
    <span class="s1">z1</span><span class="s2">, </span><span class="s1">z2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">20</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">20</span><span class="s2">))</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">z1 </span><span class="s2">* </span><span class="s1">z2</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">221</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">222</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">], </span><span class="s5">21</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[:, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">], </span><span class="s5">21</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">223</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">224</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">get_axes</span><span class="s2">():</span>
        <span class="s0">for </span><span class="s1">label </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">():</span>
            <span class="s1">label</span><span class="s2">.</span><span class="s1">set_ha</span><span class="s2">(</span><span class="s4">'right'</span><span class="s2">)</span>
            <span class="s1">label</span><span class="s2">.</span><span class="s1">set_rotation</span><span class="s2">(</span><span class="s5">30</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pcolorargs</span><span class="s2">():</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s5">12</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">n</span><span class="s2">*</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hypot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">) / </span><span class="s5">5</span>

    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">.</span><span class="s1">T</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">&quot;gouraud&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">&quot;gouraud&quot;</span><span class="s2">)</span>
    <span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">invalid</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=(</span><span class="s1">x </span><span class="s2">&lt; </span><span class="s5">0</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s3"># Expect a warning with non-increasing coordinates</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">359</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [-</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s4">'are not monotonically increasing or decreasing'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pcolormesh_underflow_error</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Test that underflow errors don't crop up in pcolormesh.  Probably 
    a numpy bug (https://github.com/numpy/numpy/issues/25810). 
    &quot;&quot;&quot;</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">under</span><span class="s2">=</span><span class="s4">&quot;raise&quot;</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pcolorargs_with_read_only</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">6</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">xmask </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">broadcast_to</span><span class="s2">([</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">], </span><span class="s1">x</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">)  </span><span class="s3"># read-only array</span>
    <span class="s0">assert </span><span class="s1">xmask</span><span class="s2">.</span><span class="s1">flags</span><span class="s2">.</span><span class="s1">writeable </span><span class="s0">is False</span>
    <span class="s1">masked_x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">xmask</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">masked_x</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">X</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">Y</span><span class="s2">)</span>
    <span class="s1">mask </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">)</span>
    <span class="s1">mask</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] = </span><span class="s0">True</span>
    <span class="s1">mask </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">broadcast_to</span><span class="s2">(</span><span class="s1">mask</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mask</span><span class="s2">.</span><span class="s1">flags</span><span class="s2">.</span><span class="s1">writeable </span><span class="s0">is False</span>
    <span class="s1">masked_Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">Z</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">mask</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">masked_Z</span><span class="s2">)</span>

    <span class="s1">masked_X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">mask</span><span class="s2">)</span>
    <span class="s1">masked_Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">Y</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">mask</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">masked_X</span><span class="s2">, </span><span class="s1">masked_Y</span><span class="s2">, </span><span class="s1">masked_Z</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_pcolornearest</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">9</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'flat'</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># specify the centers</span>
    <span class="s1">x2 </span><span class="s2">= </span><span class="s1">x</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) / </span><span class="s5">2</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s1">y</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) / </span><span class="s5">2</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'nearest'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_pcolornearestunits</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">fromtimestamp</span><span class="s2">(</span><span class="s1">x </span><span class="s2">* </span><span class="s5">3600</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)]</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">9</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'flat'</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># specify the centers</span>
    <span class="s1">x2 </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">fromtimestamp</span><span class="s2">((</span><span class="s1">x </span><span class="s2">+ </span><span class="s5">0.5</span><span class="s2">) * </span><span class="s5">3600</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">9</span><span class="s2">)]</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s1">y</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) / </span><span class="s5">2</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'nearest'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pcolorflaterror</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">9</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">9</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'Dimensions of C'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'flat'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_samesizepcolorflaterror</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">y</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;.*one smaller than X&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">shading</span><span class="s2">=</span><span class="s4">'flat'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'snap'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_pcolorauto</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">snap</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">Z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">9</span><span class="s2">)</span>
    <span class="s3"># this is the same as flat; note that auto is default</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">snap</span><span class="s2">=</span><span class="s1">snap</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># specify the centers</span>
    <span class="s1">x2 </span><span class="s2">= </span><span class="s1">x</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) / </span><span class="s5">2</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s1">y</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) / </span><span class="s5">2</span>
    <span class="s3"># this is same as nearest:</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">Z</span><span class="s2">, </span><span class="s1">snap</span><span class="s2">=</span><span class="s1">snap</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'canonical'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.02 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_canonical</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'arc_angles.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_arc_angles</span><span class="s2">():</span>
    <span class="s3"># Ellipse parameters</span>
    <span class="s1">w </span><span class="s2">= </span><span class="s5">2</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s5">1</span>
    <span class="s1">centre </span><span class="s2">= (</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">scale </span><span class="s2">= </span><span class="s5">2</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">):</span>
        <span class="s1">theta2 </span><span class="s2">= </span><span class="s1">i </span><span class="s2">* </span><span class="s5">360 </span><span class="s2">/ </span><span class="s5">9</span>
        <span class="s1">theta1 </span><span class="s2">= </span><span class="s1">theta2 </span><span class="s2">- </span><span class="s5">45</span>

        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span><span class="s1">centre</span><span class="s2">, </span><span class="s1">w</span><span class="s2">, </span><span class="s1">h</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.3</span><span class="s2">))</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Arc</span><span class="s2">(</span><span class="s1">centre</span><span class="s2">, </span><span class="s1">w</span><span class="s2">, </span><span class="s1">h</span><span class="s2">, </span><span class="s1">theta1</span><span class="s2">=</span><span class="s1">theta1</span><span class="s2">, </span><span class="s1">theta2</span><span class="s2">=</span><span class="s1">theta2</span><span class="s2">))</span>
        <span class="s3"># Straight lines intersecting start and end of arc</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">scale </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">deg2rad</span><span class="s2">(</span><span class="s1">theta1</span><span class="s2">)) + </span><span class="s1">centre</span><span class="s2">[</span><span class="s5">0</span><span class="s2">],</span>
                 <span class="s1">centre</span><span class="s2">[</span><span class="s5">0</span><span class="s2">],</span>
                 <span class="s1">scale </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">deg2rad</span><span class="s2">(</span><span class="s1">theta2</span><span class="s2">)) + </span><span class="s1">centre</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]],</span>
                <span class="s2">[</span><span class="s1">scale </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">deg2rad</span><span class="s2">(</span><span class="s1">theta1</span><span class="s2">)) + </span><span class="s1">centre</span><span class="s2">[</span><span class="s5">1</span><span class="s2">],</span>
                 <span class="s1">centre</span><span class="s2">[</span><span class="s5">1</span><span class="s2">],</span>
                 <span class="s1">scale </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">deg2rad</span><span class="s2">(</span><span class="s1">theta2</span><span class="s2">)) + </span><span class="s1">centre</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]])</span>

        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">)</span>

        <span class="s3"># This looks the same, but it triggers a different code path when it</span>
        <span class="s3"># gets large enough.</span>
        <span class="s1">w </span><span class="s2">*= </span><span class="s5">10</span>
        <span class="s1">h </span><span class="s2">*= </span><span class="s5">10</span>
        <span class="s1">centre </span><span class="s2">= (</span><span class="s1">centre</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] * </span><span class="s5">10</span><span class="s2">, </span><span class="s1">centre</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] * </span><span class="s5">10</span><span class="s2">)</span>
        <span class="s1">scale </span><span class="s2">*= </span><span class="s5">10</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'arc_ellipse'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_arc_ellipse</span><span class="s2">():</span>
    <span class="s1">xcenter</span><span class="s2">, </span><span class="s1">ycenter </span><span class="s2">= </span><span class="s5">0.38</span><span class="s2">, </span><span class="s5">0.52</span>
    <span class="s1">width</span><span class="s2">, </span><span class="s1">height </span><span class="s2">= </span><span class="s5">1e-1</span><span class="s2">, </span><span class="s5">3e-1</span>
    <span class="s1">angle </span><span class="s2">= -</span><span class="s5">30</span>

    <span class="s1">theta </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">deg2rad</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">360</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">width </span><span class="s2">/ </span><span class="s5">2. </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">height </span><span class="s2">/ </span><span class="s5">2. </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">)</span>

    <span class="s1">rtheta </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">deg2rad</span><span class="s2">(</span><span class="s1">angle</span><span class="s2">)</span>
    <span class="s1">R </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span>
        <span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">rtheta</span><span class="s2">), -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">rtheta</span><span class="s2">)],</span>
        <span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">rtheta</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">rtheta</span><span class="s2">)]])</span>

    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dot</span><span class="s2">(</span><span class="s1">R</span><span class="s2">, [</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">])</span>
    <span class="s1">x </span><span class="s2">+= </span><span class="s1">xcenter</span>
    <span class="s1">y </span><span class="s2">+= </span><span class="s1">ycenter</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">211</span><span class="s2">, </span><span class="s1">aspect</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'yellow'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'yellow'</span><span class="s2">,</span>
            <span class="s1">linewidth</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>

    <span class="s1">e1 </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Arc</span><span class="s2">((</span><span class="s1">xcenter</span><span class="s2">, </span><span class="s1">ycenter</span><span class="s2">), </span><span class="s1">width</span><span class="s2">, </span><span class="s1">height</span><span class="s2">,</span>
                      <span class="s1">angle</span><span class="s2">=</span><span class="s1">angle</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">e1</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">212</span><span class="s2">, </span><span class="s1">aspect</span><span class="s2">=</span><span class="s4">'equal'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">e2 </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Arc</span><span class="s2">((</span><span class="s1">xcenter</span><span class="s2">, </span><span class="s1">ycenter</span><span class="s2">), </span><span class="s1">width</span><span class="s2">, </span><span class="s1">height</span><span class="s2">,</span>
                      <span class="s1">angle</span><span class="s2">=</span><span class="s1">angle</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">e2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_marker_as_markerstyle</span><span class="s2">():</span>
    <span class="s1">fix</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">mmarkers</span><span class="s2">.</span><span class="s1">MarkerStyle</span><span class="s2">(</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s1">m</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'markevery'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_markevery</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">x</span><span class="s2">/</span><span class="s5">10 </span><span class="s2">+ </span><span class="s5">0.5</span><span class="s2">)</span>

    <span class="s3"># check marker only plot</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'d'</span><span class="s2">, </span><span class="s1">markevery</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'mark all'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s1">markevery</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'mark every 10'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'+'</span><span class="s2">, </span><span class="s1">markevery</span><span class="s2">=(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">20</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'mark every 5 starting at 10'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'markevery_line'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.005</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_markevery_line</span><span class="s2">():</span>
    <span class="s3"># TODO: a slight change in rendering between Inkscape versions may explain</span>
    <span class="s3"># why one had to introduce a small non-zero tolerance for the SVG test</span>
    <span class="s3"># to pass. One may try to remove this hack once Travis' Inkscape version</span>
    <span class="s3"># is modern enough. FWIW, no failure with 0.92.3 on my computer (#11358).</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">x</span><span class="s2">/</span><span class="s5">10 </span><span class="s2">+ </span><span class="s5">0.5</span><span class="s2">)</span>

    <span class="s3"># check line/marker combos</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'-o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'-d'</span><span class="s2">, </span><span class="s1">markevery</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'mark all'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'-s'</span><span class="s2">, </span><span class="s1">markevery</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'mark every 10'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'-+'</span><span class="s2">, </span><span class="s1">markevery</span><span class="s2">=(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">20</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'mark every 5 starting at 10'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'markevery_linear_scales'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.001</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_markevery_linear_scales</span><span class="s2">():</span>
    <span class="s1">cases </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">,</span>
             <span class="s5">8</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">30</span><span class="s2">, </span><span class="s5">8</span><span class="s2">),</span>
             <span class="s2">[</span><span class="s5">16</span><span class="s2">, </span><span class="s5">24</span><span class="s2">, </span><span class="s5">30</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],</span>
             <span class="s1">slice</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
             <span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">), (</span><span class="s5">0.45</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)]</span>

    <span class="s1">cols </span><span class="s2">= </span><span class="s5">3</span>
    <span class="s1">gs </span><span class="s2">= </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">gridspec</span><span class="s2">.</span><span class="s1">GridSpec</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">) // </span><span class="s1">cols </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">cols</span><span class="s2">)</span>

    <span class="s1">delta </span><span class="s2">= </span><span class="s5">0.11</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10 </span><span class="s2">- </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">delta</span><span class="s2">, </span><span class="s5">200</span><span class="s2">) + </span><span class="s1">delta</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) + </span><span class="s5">1.0 </span><span class="s2">+ </span><span class="s1">delta</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">):</span>
        <span class="s1">row </span><span class="s2">= (</span><span class="s1">i </span><span class="s2">// </span><span class="s1">cols</span><span class="s2">)</span>
        <span class="s1">col </span><span class="s2">= </span><span class="s1">i </span><span class="s2">% </span><span class="s1">cols</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, </span><span class="s1">col</span><span class="s2">])</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'markevery=%s' </span><span class="s2">% </span><span class="s1">str</span><span class="s2">(</span><span class="s1">case</span><span class="s2">))</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">4</span><span class="s2">,  </span><span class="s1">markevery</span><span class="s2">=</span><span class="s1">case</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'markevery_linear_scales_zoomed'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_markevery_linear_scales_zoomed</span><span class="s2">():</span>
    <span class="s1">cases </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">,</span>
             <span class="s5">8</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">30</span><span class="s2">, </span><span class="s5">8</span><span class="s2">),</span>
             <span class="s2">[</span><span class="s5">16</span><span class="s2">, </span><span class="s5">24</span><span class="s2">, </span><span class="s5">30</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],</span>
             <span class="s1">slice</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
             <span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">), (</span><span class="s5">0.45</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)]</span>

    <span class="s1">cols </span><span class="s2">= </span><span class="s5">3</span>
    <span class="s1">gs </span><span class="s2">= </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">gridspec</span><span class="s2">.</span><span class="s1">GridSpec</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">) // </span><span class="s1">cols </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">cols</span><span class="s2">)</span>

    <span class="s1">delta </span><span class="s2">= </span><span class="s5">0.11</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10 </span><span class="s2">- </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">delta</span><span class="s2">, </span><span class="s5">200</span><span class="s2">) + </span><span class="s1">delta</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) + </span><span class="s5">1.0 </span><span class="s2">+ </span><span class="s1">delta</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">):</span>
        <span class="s1">row </span><span class="s2">= (</span><span class="s1">i </span><span class="s2">// </span><span class="s1">cols</span><span class="s2">)</span>
        <span class="s1">col </span><span class="s2">= </span><span class="s1">i </span><span class="s2">% </span><span class="s1">cols</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, </span><span class="s1">col</span><span class="s2">])</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'markevery=%s' </span><span class="s2">% </span><span class="s1">str</span><span class="s2">(</span><span class="s1">case</span><span class="s2">))</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">4</span><span class="s2">,  </span><span class="s1">markevery</span><span class="s2">=</span><span class="s1">case</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlim</span><span class="s2">((</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6.7</span><span class="s2">))</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylim</span><span class="s2">((</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">1.7</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'markevery_log_scales'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_markevery_log_scales</span><span class="s2">():</span>
    <span class="s1">cases </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">,</span>
             <span class="s5">8</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">30</span><span class="s2">, </span><span class="s5">8</span><span class="s2">),</span>
             <span class="s2">[</span><span class="s5">16</span><span class="s2">, </span><span class="s5">24</span><span class="s2">, </span><span class="s5">30</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],</span>
             <span class="s1">slice</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
             <span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">), (</span><span class="s5">0.45</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)]</span>

    <span class="s1">cols </span><span class="s2">= </span><span class="s5">3</span>
    <span class="s1">gs </span><span class="s2">= </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">gridspec</span><span class="s2">.</span><span class="s1">GridSpec</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">) // </span><span class="s1">cols </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">cols</span><span class="s2">)</span>

    <span class="s1">delta </span><span class="s2">= </span><span class="s5">0.11</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10 </span><span class="s2">- </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">delta</span><span class="s2">, </span><span class="s5">200</span><span class="s2">) + </span><span class="s1">delta</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) + </span><span class="s5">1.0 </span><span class="s2">+ </span><span class="s1">delta</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">):</span>
        <span class="s1">row </span><span class="s2">= (</span><span class="s1">i </span><span class="s2">// </span><span class="s1">cols</span><span class="s2">)</span>
        <span class="s1">col </span><span class="s2">= </span><span class="s1">i </span><span class="s2">% </span><span class="s1">cols</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, </span><span class="s1">col</span><span class="s2">])</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'markevery=%s' </span><span class="s2">% </span><span class="s1">str</span><span class="s2">(</span><span class="s1">case</span><span class="s2">))</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">yscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">4</span><span class="s2">,  </span><span class="s1">markevery</span><span class="s2">=</span><span class="s1">case</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'markevery_polar'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_markevery_polar</span><span class="s2">():</span>
    <span class="s1">cases </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">,</span>
             <span class="s5">8</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">30</span><span class="s2">, </span><span class="s5">8</span><span class="s2">),</span>
             <span class="s2">[</span><span class="s5">16</span><span class="s2">, </span><span class="s5">24</span><span class="s2">, </span><span class="s5">30</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],</span>
             <span class="s1">slice</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
             <span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">), (</span><span class="s5">0.45</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)]</span>

    <span class="s1">cols </span><span class="s2">= </span><span class="s5">3</span>
    <span class="s1">gs </span><span class="s2">= </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">gridspec</span><span class="s2">.</span><span class="s1">GridSpec</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">) // </span><span class="s1">cols </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">cols</span><span class="s2">)</span>

    <span class="s1">r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">200</span><span class="s2">)</span>
    <span class="s1">theta </span><span class="s2">= </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">r</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">):</span>
        <span class="s1">row </span><span class="s2">= (</span><span class="s1">i </span><span class="s2">// </span><span class="s1">cols</span><span class="s2">)</span>
        <span class="s1">col </span><span class="s2">= </span><span class="s1">i </span><span class="s2">% </span><span class="s1">cols</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, </span><span class="s1">col</span><span class="s2">], </span><span class="s1">polar</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'markevery=%s' </span><span class="s2">% </span><span class="s1">str</span><span class="s2">(</span><span class="s1">case</span><span class="s2">))</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">4</span><span class="s2">,  </span><span class="s1">markevery</span><span class="s2">=</span><span class="s1">case</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'markevery_linear_scales_nans'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_markevery_linear_scales_nans</span><span class="s2">():</span>
    <span class="s1">cases </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">,</span>
             <span class="s5">8</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">30</span><span class="s2">, </span><span class="s5">8</span><span class="s2">),</span>
             <span class="s2">[</span><span class="s5">16</span><span class="s2">, </span><span class="s5">24</span><span class="s2">, </span><span class="s5">30</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],</span>
             <span class="s1">slice</span><span class="s2">(</span><span class="s5">100</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
             <span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">,</span>
             <span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">), (</span><span class="s5">0.45</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)]</span>

    <span class="s1">cols </span><span class="s2">= </span><span class="s5">3</span>
    <span class="s1">gs </span><span class="s2">= </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">gridspec</span><span class="s2">.</span><span class="s1">GridSpec</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">) // </span><span class="s1">cols </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">cols</span><span class="s2">)</span>

    <span class="s1">delta </span><span class="s2">= </span><span class="s5">0.11</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10 </span><span class="s2">- </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">delta</span><span class="s2">, </span><span class="s5">200</span><span class="s2">) + </span><span class="s1">delta</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) + </span><span class="s5">1.0 </span><span class="s2">+ </span><span class="s1">delta</span>
    <span class="s1">y</span><span class="s2">[:</span><span class="s5">10</span><span class="s2">] = </span><span class="s1">y</span><span class="s2">[-</span><span class="s5">20</span><span class="s2">:] = </span><span class="s1">y</span><span class="s2">[</span><span class="s5">50</span><span class="s2">:</span><span class="s5">70</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">case </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">cases</span><span class="s2">):</span>
        <span class="s1">row </span><span class="s2">= (</span><span class="s1">i </span><span class="s2">// </span><span class="s1">cols</span><span class="s2">)</span>
        <span class="s1">col </span><span class="s2">= </span><span class="s1">i </span><span class="s2">% </span><span class="s1">cols</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s1">gs</span><span class="s2">[</span><span class="s1">row</span><span class="s2">, </span><span class="s1">col</span><span class="s2">])</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'markevery=%s' </span><span class="s2">% </span><span class="s1">str</span><span class="s2">(</span><span class="s1">case</span><span class="s2">))</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">4</span><span class="s2">,  </span><span class="s1">markevery</span><span class="s2">=</span><span class="s1">case</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'marker_edges'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_marker_edges</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s4">'y.'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">30.0</span><span class="s2">, </span><span class="s1">mew</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">mec</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">+</span><span class="s5">0.1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s4">'y.'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">30.0</span><span class="s2">, </span><span class="s1">mew</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">mec</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">+</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s4">'y.'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">30.0</span><span class="s2">, </span><span class="s1">mew</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">mec</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bar_tick_label_single.png'</span><span class="s2">, </span><span class="s4">'bar_tick_label_single.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bar_tick_label_single</span><span class="s2">():</span>
    <span class="s3"># From 2516: plot bar with array of string labels for x axis</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'edge'</span><span class="s2">, </span><span class="s1">tick_label</span><span class="s2">=</span><span class="s4">'0'</span><span class="s2">)</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;a&quot;</span><span class="s2">: </span><span class="s5">0</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">: </span><span class="s5">1</span><span class="s2">}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'edge'</span><span class="s2">, </span><span class="s1">tick_label</span><span class="s2">=</span><span class="s4">'0'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_nan_bar_values</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">4</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_bar_ticklabel_fail</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([], [])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bar_tick_label_multiple.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bar_tick_label_multiple</span><span class="s2">():</span>
    <span class="s3"># From 2516: plot bar with array of string labels for x axis</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">width</span><span class="s2">=[</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s1">tick_label</span><span class="s2">=[</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
           <span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bar_tick_label_multiple_old_label_alignment.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bar_tick_label_multiple_old_alignment</span><span class="s2">():</span>
    <span class="s3"># Test that the alignment for class is backward compatible</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">&quot;ytick.alignment&quot;</span><span class="s2">] = </span><span class="s4">&quot;center&quot;</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">width</span><span class="s2">=[</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s1">tick_label</span><span class="s2">=[</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
           <span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bar_decimal_center</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x0 </span><span class="s2">= [</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">8.4</span><span class="s2">, </span><span class="s5">5.3</span><span class="s2">, </span><span class="s5">4.2</span><span class="s2">]</span>
    <span class="s1">y0 </span><span class="s2">= [</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s5">3.3</span><span class="s2">, </span><span class="s5">4.4</span><span class="s2">]</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">x0</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">y0</span><span class="s2">]</span>
    <span class="s3"># Test image - vertical, align-center bar chart with Decimal() input</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>
    <span class="s3"># Reference image</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_barh_decimal_center</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x0 </span><span class="s2">= [</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">8.4</span><span class="s2">, </span><span class="s5">5.3</span><span class="s2">, </span><span class="s5">4.2</span><span class="s2">]</span>
    <span class="s1">y0 </span><span class="s2">= [</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s5">3.3</span><span class="s2">, </span><span class="s5">4.4</span><span class="s2">]</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">x0</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) </span><span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">y0</span><span class="s2">]</span>
    <span class="s3"># Test image - horizontal, align-center bar chart with Decimal() input</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>
    <span class="s3"># Reference image</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bar_decimal_width</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">8.4</span><span class="s2">, </span><span class="s5">5.3</span><span class="s2">, </span><span class="s5">4.2</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s5">3.3</span><span class="s2">, </span><span class="s5">4.4</span><span class="s2">]</span>
    <span class="s1">w0 </span><span class="s2">= [</span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">1.45</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">w </span><span class="s2">= [</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">w0</span><span class="s2">]</span>
    <span class="s3"># Test image - vertical bar chart with Decimal() width</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s1">w</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>
    <span class="s3"># Reference image</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s1">w0</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_barh_decimal_height</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">8.4</span><span class="s2">, </span><span class="s5">5.3</span><span class="s2">, </span><span class="s5">4.2</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s5">3.3</span><span class="s2">, </span><span class="s5">4.4</span><span class="s2">]</span>
    <span class="s1">h0 </span><span class="s2">= [</span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">1.45</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">h </span><span class="s2">= [</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">h0</span><span class="s2">]</span>
    <span class="s3"># Test image - horizontal bar chart with Decimal() height</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">h</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>
    <span class="s3"># Reference image</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">h0</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_bar_color_none_alpha</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">rect </span><span class="s0">in </span><span class="s1">rects</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">rect</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">() == (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rect</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">() == (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_bar_edgecolor_none_alpha</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">rect </span><span class="s0">in </span><span class="s1">rects</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">rect</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">() == (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">rect</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">() == (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'barh_tick_label.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_barh_tick_label</span><span class="s2">():</span>
    <span class="s3"># From 2516: plot barh with array of string labels for y axis</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">height</span><span class="s2">=[</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s1">tick_label</span><span class="s2">=[</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
            <span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_bar_timedelta</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Smoketest that bar can handle width and height in delta units.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s5">1.</span><span class="s2">,</span>
           <span class="s1">width</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">3</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s5">1.</span><span class="s2">,</span>
           <span class="s1">xerr</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">2</span><span class="s2">),</span>
           <span class="s1">width</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">3</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s5">1</span><span class="s2">,</span>
            <span class="s1">height</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">3</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s5">1</span><span class="s2">,</span>
            <span class="s1">height</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">3</span><span class="s2">),</span>
            <span class="s1">yerr</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">2</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)],</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">]),</span>
            <span class="s1">height</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">3</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)],</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">]),</span>
            <span class="s1">height</span><span class="s2">=[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s1">t</span><span class="s2">) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">broken_barh</span><span class="s2">([(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">),</span>
                     <span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">1</span><span class="s2">))],</span>
                   <span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_bar_datetime_start</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;test that tickers are correct for datetimes&quot;&quot;&quot;</span>
    <span class="s1">start </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2012-01-01'</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2012-02-01'</span><span class="s2">),</span>
                      <span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2012-01-15'</span><span class="s2">)])</span>
    <span class="s1">stop </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2012-02-07'</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2012-02-13'</span><span class="s2">),</span>
                     <span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2012-02-12'</span><span class="s2">)])</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">height</span><span class="s2">=</span><span class="s1">stop</span><span class="s2">-</span><span class="s1">start</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s1">start</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_formatter</span><span class="s2">(), </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateFormatter</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">width</span><span class="s2">=</span><span class="s1">stop</span><span class="s2">-</span><span class="s1">start</span><span class="s2">, </span><span class="s1">left</span><span class="s2">=</span><span class="s1">start</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_major_formatter</span><span class="s2">(), </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateFormatter</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_boxplot_dates_pandas</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s3"># smoke test for boxplot and dates in pandas</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">years </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">'1/1/2000'</span><span class="s2">,</span>
                          <span class="s1">periods</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DateOffset</span><span class="s2">(</span><span class="s1">years</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)).</span><span class="s1">year</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">years</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_boxplot_capwidths</span><span class="s2">():</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">9</span><span class="s2">)</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">capwidths</span><span class="s2">=[</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">], </span><span class="s1">widths</span><span class="s2">=[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">])</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">capwidths</span><span class="s2">=[</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">], </span><span class="s1">widths</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">capwidths</span><span class="s2">=[</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">])</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">capwidths</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">=[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">])</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">capwidths</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">5</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">capwidths</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">6</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">=[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">])</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">7</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">8</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pcolor_regression</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">plotting </span><span class="s0">import </span><span class="s2">(</span>
        <span class="s1">register_matplotlib_converters</span><span class="s2">,</span>
        <span class="s1">deregister_matplotlib_converters</span><span class="s2">,</span>
    <span class="s2">)</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">111</span><span class="s2">)</span>

    <span class="s1">times </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2021</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)]</span>
    <span class="s0">while </span><span class="s1">len</span><span class="s2">(</span><span class="s1">times</span><span class="s2">) &lt; </span><span class="s5">7</span><span class="s2">:</span>
        <span class="s1">times</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">times</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] + </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s5">120</span><span class="s2">))</span>

    <span class="s1">y_vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">time_axis</span><span class="s2">, </span><span class="s1">y_axis </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">times</span><span class="s2">, </span><span class="s1">y_vals</span><span class="s2">)</span>
    <span class="s1">shape </span><span class="s2">= (</span><span class="s1">len</span><span class="s2">(</span><span class="s1">y_vals</span><span class="s2">) - </span><span class="s5">1</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">times</span><span class="s2">) - </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">z_data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] * </span><span class="s1">shape</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>

    <span class="s1">z_data</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">= </span><span class="s1">shape</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">register_matplotlib_converters</span><span class="s2">()</span>

        <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">time_axis</span><span class="s2">, </span><span class="s1">y_axis</span><span class="s2">, </span><span class="s1">z_data</span><span class="s2">)</span>
        <span class="s3"># make sure this does not raise!</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">finally</span><span class="s2">:</span>
        <span class="s1">deregister_matplotlib_converters</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_bar_pandas</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s3"># Smoke test for pandas</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span><span class="s4">'year'</span><span class="s2">: [</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">2018</span><span class="s2">, </span><span class="s5">2018</span><span class="s2">],</span>
         <span class="s4">'month'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
         <span class="s4">'day'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
         <span class="s4">'value'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]})</span>
    <span class="s1">df</span><span class="s2">[</span><span class="s4">'date'</span><span class="s2">] = </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">to_datetime</span><span class="s2">(</span><span class="s1">df</span><span class="s2">[[</span><span class="s4">'year'</span><span class="s2">, </span><span class="s4">'month'</span><span class="s2">, </span><span class="s4">'day'</span><span class="s2">]])</span>

    <span class="s1">monthly </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[[</span><span class="s4">'date'</span><span class="s2">, </span><span class="s4">'value'</span><span class="s2">]].</span><span class="s1">groupby</span><span class="s2">([</span><span class="s4">'date'</span><span class="s2">]).</span><span class="s1">sum</span><span class="s2">()</span>
    <span class="s1">dates </span><span class="s2">= </span><span class="s1">monthly</span><span class="s2">.</span><span class="s1">index</span>
    <span class="s1">forecast </span><span class="s2">= </span><span class="s1">monthly</span><span class="s2">[</span><span class="s4">'value'</span><span class="s2">]</span>
    <span class="s1">baseline </span><span class="s2">= </span><span class="s1">monthly</span><span class="s2">[</span><span class="s4">'value'</span><span class="s2">]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">forecast</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'orange'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_bar_pandas_indexed</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s3"># Smoke test for indexed pandas</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">&quot;x&quot;</span><span class="s2">: [</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">], </span><span class="s4">&quot;width&quot;</span><span class="s2">: [</span><span class="s5">.2</span><span class="s2">, </span><span class="s5">.4</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">]},</span>
                      <span class="s1">index</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">df</span><span class="s2">.</span><span class="s1">x</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s1">df</span><span class="s2">.</span><span class="s1">width</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_bar_hatches</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">hatches </span><span class="s2">= [</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">2</span><span class="s2">):</span>
        <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C0'</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s1">hatches</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>

    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s1">hatches</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;width&quot;</span><span class="s2">, </span><span class="s4">&quot;label&quot;</span><span class="s2">, </span><span class="s4">&quot;expected_labels&quot;</span><span class="s2">, </span><span class="s4">&quot;container_label&quot;</span><span class="s2">),</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s4">&quot;x&quot;</span><span class="s2">, [</span><span class="s4">&quot;_nolegend_&quot;</span><span class="s2">], </span><span class="s4">&quot;x&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">], [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">15</span><span class="s2">], [</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s4">&quot;A&quot;</span><span class="s2">, </span><span class="s4">&quot;B&quot;</span><span class="s2">, </span><span class="s4">&quot;C&quot;</span><span class="s2">], </span><span class="s4">&quot;_nolegend_&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">], [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">15</span><span class="s2">], [</span><span class="s4">&quot;R&quot;</span><span class="s2">, </span><span class="s4">&quot;Y&quot;</span><span class="s2">, </span><span class="s4">&quot;_nolegend_&quot;</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s4">&quot;R&quot;</span><span class="s2">, </span><span class="s4">&quot;Y&quot;</span><span class="s2">, </span><span class="s4">&quot;_nolegend_&quot;</span><span class="s2">], </span><span class="s4">&quot;_nolegend_&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">], [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">15</span><span class="s2">], </span><span class="s4">&quot;bars&quot;</span><span class="s2">,</span>
         <span class="s2">[</span><span class="s4">&quot;_nolegend_&quot;</span><span class="s2">, </span><span class="s4">&quot;_nolegend_&quot;</span><span class="s2">, </span><span class="s4">&quot;_nolegend_&quot;</span><span class="s2">], </span><span class="s4">&quot;bars&quot;</span><span class="s2">),</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bar_labels</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">width</span><span class="s2">, </span><span class="s1">label</span><span class="s2">, </span><span class="s1">expected_labels</span><span class="s2">, </span><span class="s1">container_label</span><span class="s2">):</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">bar_container </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">width</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">label</span><span class="s2">)</span>
    <span class="s1">bar_labels </span><span class="s2">= [</span><span class="s1">bar</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">() </span><span class="s0">for </span><span class="s1">bar </span><span class="s0">in </span><span class="s1">bar_container</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">expected_labels </span><span class="s2">== </span><span class="s1">bar_labels</span>
    <span class="s0">assert </span><span class="s1">bar_container</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">() == </span><span class="s1">container_label</span>


<span class="s0">def </span><span class="s1">test_bar_labels_length</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=[</span><span class="s4">&quot;X&quot;</span><span class="s2">, </span><span class="s4">&quot;Y&quot;</span><span class="s2">, </span><span class="s4">&quot;Z&quot;</span><span class="s2">])</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=[</span><span class="s4">&quot;X&quot;</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_pandas_minimal_plot</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s3"># smoke test that series and index objects do not warn</span>
    <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s2">[</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;float64&quot;</span><span class="s2">),</span>
              <span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">&quot;Float64&quot;</span><span class="s2">)]:</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">index</span><span class="s2">)</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">'col'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]})</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">df</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">df</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_log'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hist_log</span><span class="s2">():</span>
    <span class="s1">data0 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">200</span><span class="s2">)**</span><span class="s5">3</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s5">1 </span><span class="s2">- </span><span class="s1">data0</span><span class="s2">, </span><span class="s5">1 </span><span class="s2">+ </span><span class="s1">data0</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">log</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_log_2</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">axs_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">axs_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">histtype </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">([</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s4">&quot;step&quot;</span><span class="s2">, </span><span class="s4">&quot;stepfilled&quot;</span><span class="s2">]):</span>
        <span class="s3"># Set log scale, then call hist().</span>
        <span class="s1">axs_test</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>
        <span class="s1">axs_test</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">hist</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s1">histtype</span><span class="s2">)</span>
        <span class="s3"># Call hist(), then set log scale.</span>
        <span class="s1">axs_test</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">hist</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s1">histtype</span><span class="s2">)</span>
        <span class="s1">axs_test</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>
        <span class="s3"># Use hist(..., log=True).</span>
        <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs_ref</span><span class="s2">[:, </span><span class="s1">i</span><span class="s2">]:</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">log</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s1">histtype</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_log_barstacked</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">hist</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]], </span><span class="s5">2</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;barstacked&quot;</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">hist</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s5">2</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;barstacked&quot;</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_bar_empty.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hist_bar_empty</span><span class="s2">():</span>
    <span class="s3"># From #3886: creating hist from empty dataset raises ValueError</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([], </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">'bar'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_float16</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">values </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">clip</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s5">1000</span><span class="s2">), </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float16</span><span class="s2">)</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">bc </span><span class="s2">= </span><span class="s1">h</span><span class="s2">[</span><span class="s5">2</span><span class="s2">]</span>
    <span class="s3"># Check that there are no overlapping rectangles</span>
    <span class="s0">for </span><span class="s1">r </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">bc</span><span class="s2">)):</span>
        <span class="s1">rleft </span><span class="s2">= </span><span class="s1">bc</span><span class="s2">[</span><span class="s1">r</span><span class="s2">-</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_corners</span><span class="s2">()</span>
        <span class="s1">rright </span><span class="s2">= </span><span class="s1">bc</span><span class="s2">[</span><span class="s1">r</span><span class="s2">].</span><span class="s1">get_corners</span><span class="s2">()</span>
        <span class="s3"># right hand position of left rectangle &lt;=</span>
        <span class="s3"># left hand position of right rectangle</span>
        <span class="s0">assert </span><span class="s1">rleft</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">0</span><span class="s2">] &lt;= </span><span class="s1">rright</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_step_empty.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hist_step_empty</span><span class="s2">():</span>
    <span class="s3"># From #3886: creating hist from empty dataset raises ValueError</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([], </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">'step'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_step_filled.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hist_step_filled</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">1000</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">n_bins </span><span class="s2">= </span><span class="s5">10</span>

    <span class="s1">kwargs </span><span class="s2">= [{</span><span class="s4">'fill'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}, {</span><span class="s4">'fill'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}, {</span><span class="s4">'fill'</span><span class="s2">: </span><span class="s0">None</span><span class="s2">}, {}]*</span><span class="s5">2</span>
    <span class="s1">types </span><span class="s2">= [</span><span class="s4">'step'</span><span class="s2">]*</span><span class="s5">4</span><span class="s2">+[</span><span class="s4">'stepfilled'</span><span class="s2">]*</span><span class="s5">4</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">kg</span><span class="s2">, </span><span class="s1">_type</span><span class="s2">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">types</span><span class="s2">, </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n_bins</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s1">_type</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, **</span><span class="s1">kg</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">f'</span><span class="s0">{</span><span class="s1">kg</span><span class="s0">}</span><span class="s4">/</span><span class="s0">{</span><span class="s1">_type</span><span class="s0">}</span><span class="s4">'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">bottom</span><span class="s2">=-</span><span class="s5">50</span><span class="s2">)</span>

    <span class="s1">patches </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">patches</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">p</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">() == </span><span class="s1">p</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">() </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">patches</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_density.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_density</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s5">2000</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_unequal_bins_density</span><span class="s2">():</span>
    <span class="s3"># Test correct behavior of normalized histogram with unequal bins</span>
    <span class="s3"># https://github.com/matplotlib/matplotlib/issues/9557</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s5">57483</span><span class="s2">)</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">bins </span><span class="s2">= [-</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]</span>
    <span class="s1">mpl_heights</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">np_heights</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">histogram</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">mpl_heights</span><span class="s2">, </span><span class="s1">np_heights</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_datetime_datasets</span><span class="s2">():</span>
    <span class="s1">data </span><span class="s2">= [[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2017</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2017</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)],</span>
            <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2017</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2017</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)]]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;bins_preprocess&quot;</span><span class="s2">,</span>
                         <span class="s2">[</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">dates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">,</span>
                          <span class="s0">lambda </span><span class="s1">bins</span><span class="s2">: </span><span class="s1">bins</span><span class="s2">,</span>
                          <span class="s0">lambda </span><span class="s1">bins</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">bins</span><span class="s2">, </span><span class="s4">'datetime64'</span><span class="s2">)],</span>
                         <span class="s1">ids</span><span class="s2">=[</span><span class="s4">'date2num'</span><span class="s2">, </span><span class="s4">'datetime.datetime'</span><span class="s2">,</span>
                              <span class="s4">'np.datetime64'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_datetime_datasets_bins</span><span class="s2">(</span><span class="s1">bins_preprocess</span><span class="s2">):</span>
    <span class="s1">data </span><span class="s2">= [[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">11</span><span class="s2">),</span>
             <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)],</span>
            <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">11</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">),</span>
             <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">18</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)]]</span>

    <span class="s1">date_edges </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">),</span>
                  <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2019</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">bins_preprocess</span><span class="s2">(</span><span class="s1">date_edges</span><span class="s2">), </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">dates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">date_edges</span><span class="s2">))</span>

    <span class="s1">_</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">bins_preprocess</span><span class="s2">(</span><span class="s1">date_edges</span><span class="s2">), </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">dates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">date_edges</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'data, expected_number_of_hists'</span><span class="s2">,</span>
                         <span class="s2">[([], </span><span class="s5">1</span><span class="s2">),</span>
                          <span class="s2">([[]], </span><span class="s5">1</span><span class="s2">),</span>
                          <span class="s2">([[], []], </span><span class="s5">2</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_hist_with_empty_input</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">expected_number_of_hists</span><span class="s2">):</span>
    <span class="s1">hists</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">hists </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">hists</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">hists</span><span class="s2">.</span><span class="s1">ndim </span><span class="s2">== </span><span class="s5">1</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s5">1 </span><span class="s2">== </span><span class="s1">expected_number_of_hists</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">hists</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s1">expected_number_of_hists</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;histtype, zorder&quot;</span><span class="s2">,</span>
                         <span class="s2">[(</span><span class="s4">&quot;bar&quot;</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">.</span><span class="s1">Patch</span><span class="s2">.</span><span class="s1">zorder</span><span class="s2">),</span>
                          <span class="s2">(</span><span class="s4">&quot;step&quot;</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">.</span><span class="s1">zorder</span><span class="s2">),</span>
                          <span class="s2">(</span><span class="s4">&quot;stepfilled&quot;</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">.</span><span class="s1">Patch</span><span class="s2">.</span><span class="s1">zorder</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_hist_zorder</span><span class="s2">(</span><span class="s1">histtype</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">histtype</span><span class="s2">=</span><span class="s1">histtype</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">patches</span>
    <span class="s0">for </span><span class="s1">patch </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">patch</span><span class="s2">.</span><span class="s1">get_zorder</span><span class="s2">() == </span><span class="s1">zorder</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_stairs</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">lines </span><span class="s0">as </span><span class="s1">mlines</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">6</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">32</span><span class="s2">, </span><span class="s5">37</span><span class="s2">, </span><span class="s5">48</span><span class="s2">, </span><span class="s5">32</span><span class="s2">, </span><span class="s5">21</span><span class="s2">,  </span><span class="s5">4</span><span class="s2">])  </span><span class="s3"># hist</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">, </span><span class="s5">4.</span><span class="s2">, </span><span class="s5">5.</span><span class="s2">, </span><span class="s5">6.</span><span class="s2">, </span><span class="s5">7.</span><span class="s2">, </span><span class="s5">8.</span><span class="s2">, </span><span class="s5">9.</span><span class="s2">])  </span><span class="s3"># bins</span>

    <span class="s1">test_axes </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">).</span><span class="s1">flatten</span><span class="s2">()</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">semilogy</span><span class="s2">()</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">5</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">5</span><span class="s2">].</span><span class="s1">semilogx</span><span class="s2">()</span>

    <span class="s3"># defaults of `PathPatch` to be used for all following Line2D</span>
    <span class="s1">style </span><span class="s2">= {</span><span class="s4">'solid_joinstyle'</span><span class="s2">: </span><span class="s4">'miter'</span><span class="s2">, </span><span class="s4">'solid_capstyle'</span><span class="s2">: </span><span class="s4">'butt'</span><span class="s2">}</span>

    <span class="s1">ref_axes </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">).</span><span class="s1">flatten</span><span class="s2">()</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]), </span><span class="s1">drawstyle</span><span class="s2">=</span><span class="s4">'steps-post'</span><span class="s2">, **</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">), </span><span class="s1">x</span><span class="s2">, </span><span class="s1">drawstyle</span><span class="s2">=</span><span class="s4">'steps-post'</span><span class="s2">, **</span><span class="s1">style</span><span class="s2">)</span>

    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]), </span><span class="s1">drawstyle</span><span class="s2">=</span><span class="s4">'steps-post'</span><span class="s2">, **</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">add_line</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]], [</span><span class="s5">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]], **</span><span class="s1">style</span><span class="s2">))</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">add_line</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]], [</span><span class="s5">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]], **</span><span class="s1">style</span><span class="s2">))</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">), </span><span class="s1">x</span><span class="s2">, </span><span class="s1">drawstyle</span><span class="s2">=</span><span class="s4">'steps-post'</span><span class="s2">, **</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">add_line</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]], [</span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]], **</span><span class="s1">style</span><span class="s2">))</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">add_line</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]], [</span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]], **</span><span class="s1">style</span><span class="s2">))</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]), </span><span class="s1">drawstyle</span><span class="s2">=</span><span class="s4">'steps-post'</span><span class="s2">, **</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">add_line</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]], [</span><span class="s5">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]], **</span><span class="s1">style</span><span class="s2">))</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">add_line</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]], [</span><span class="s5">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]], **</span><span class="s1">style</span><span class="s2">))</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">semilogy</span><span class="s2">()</span>

    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">5</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">), </span><span class="s1">x</span><span class="s2">, </span><span class="s1">drawstyle</span><span class="s2">=</span><span class="s4">'steps-post'</span><span class="s2">, **</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">5</span><span class="s2">].</span><span class="s1">add_line</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]], [</span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]], **</span><span class="s1">style</span><span class="s2">))</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">5</span><span class="s2">].</span><span class="s1">add_line</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]], [</span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]], **</span><span class="s1">style</span><span class="s2">))</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">5</span><span class="s2">].</span><span class="s1">semilogx</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_stairs_fill</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">h</span><span class="s2">, </span><span class="s1">bins </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]</span>
    <span class="s1">bs </span><span class="s2">= -</span><span class="s5">2</span>
    <span class="s3"># Test</span>
    <span class="s1">test_axes </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">).</span><span class="s1">flatten</span><span class="s2">()</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s1">bs</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">test_axes</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s1">bs</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">,</span>
                        <span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s3"># # Ref</span>
    <span class="s1">ref_axes </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">).</span><span class="s1">flatten</span><span class="s2">()</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">h</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]), </span><span class="s1">step</span><span class="s2">=</span><span class="s4">'post'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">fill_betweenx</span><span class="s2">(</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">h</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]), </span><span class="s1">step</span><span class="s2">=</span><span class="s4">'post'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">h</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]),</span>
                             <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)+</span><span class="s5">1</span><span class="s2">)*</span><span class="s1">bs</span><span class="s2">, </span><span class="s1">step</span><span class="s2">=</span><span class="s4">'post'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">bs</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">fill_betweenx</span><span class="s2">(</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">h</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]),</span>
                              <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">h</span><span class="s2">)+</span><span class="s5">1</span><span class="s2">)*</span><span class="s1">bs</span><span class="s2">, </span><span class="s1">step</span><span class="s2">=</span><span class="s4">'post'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ref_axes</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">bs</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_stairs_update</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># fixed ylim because stairs() does autoscale, but updating data does not</span>
    <span class="s1">ylim </span><span class="s2">= -</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span>
    <span class="s3"># Test</span>
    <span class="s1">test_ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">test_ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">test_ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">ylim</span><span class="s2">)</span>
    <span class="s1">h</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">h</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">(</span><span class="s1">edges</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)+</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">h</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)/</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">h</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">h</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_data</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_data</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">))</span>
    <span class="s1">h</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">(</span><span class="s1">baseline</span><span class="s2">=-</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_data</span><span class="s2">().</span><span class="s1">baseline </span><span class="s2">== -</span><span class="s5">2</span>

    <span class="s3"># Ref</span>
    <span class="s1">ref_ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">ref_ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">baseline</span><span class="s2">=-</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ref_ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">ylim</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_stairs_baseline_0</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># Test</span>
    <span class="s1">test_ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">test_ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">], </span><span class="s1">baseline</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>

    <span class="s3"># Ref</span>
    <span class="s1">ref_ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">style </span><span class="s2">= {</span><span class="s4">'solid_joinstyle'</span><span class="s2">: </span><span class="s4">'miter'</span><span class="s2">, </span><span class="s4">'solid_capstyle'</span><span class="s2">: </span><span class="s4">'butt'</span><span class="s2">}</span>
    <span class="s1">ref_ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">], </span><span class="s1">drawstyle</span><span class="s2">=</span><span class="s4">'steps-post'</span><span class="s2">, **</span><span class="s1">style</span><span class="s2">)</span>
    <span class="s1">ref_ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_stairs_empty</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([], [</span><span class="s5">42</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">39</span><span class="s2">, </span><span class="s5">45</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (-</span><span class="s5">0.06</span><span class="s2">, </span><span class="s5">0.06</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_stairs_invalid_nan</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'Nan values in &quot;edges&quot;'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_stairs_invalid_mismatch</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'Size mismatch'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_stairs_invalid_update</span><span class="s2">():</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'Nan values in &quot;edges&quot;'</span><span class="s2">):</span>
        <span class="s1">h</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">(</span><span class="s1">edges</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_stairs_invalid_update2</span><span class="s2">():</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'Size mismatch'</span><span class="s2">):</span>
        <span class="s1">h</span><span class="s2">.</span><span class="s1">set_data</span><span class="s2">(</span><span class="s1">edges</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'test_stairs_options.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_stairs_options</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">]).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">float</span><span class="s2">)</span>
    <span class="s1">yn </span><span class="s2">= </span><span class="s1">y</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s1">yn</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">*</span><span class="s5">3</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;A&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">*</span><span class="s5">3</span><span class="s2">-</span><span class="s5">3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
              <span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;B&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">yn</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'orange'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;C&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">yn</span><span class="s2">/</span><span class="s5">3</span><span class="s2">, </span><span class="s1">x</span><span class="s2">*</span><span class="s5">3</span><span class="s2">-</span><span class="s5">2</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">,</span>
              <span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;D&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[::-</span><span class="s5">1</span><span class="s2">]*</span><span class="s5">3</span><span class="s2">+</span><span class="s5">13</span><span class="s2">, </span><span class="s1">x</span><span class="s2">-</span><span class="s5">1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
              <span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;E&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[::-</span><span class="s5">1</span><span class="s2">]*</span><span class="s5">3</span><span class="s2">+</span><span class="s5">14</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s5">26</span><span class="s2">,</span>
              <span class="s1">color</span><span class="s2">=</span><span class="s4">'purple'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;F&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">yn</span><span class="s2">[::-</span><span class="s5">1</span><span class="s2">]*</span><span class="s5">3</span><span class="s2">+</span><span class="s5">15</span><span class="s2">, </span><span class="s1">x</span><span class="s2">+</span><span class="s5">1</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">27</span><span class="s2">, </span><span class="s5">25</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)),</span>
              <span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;G&quot;</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">][::-</span><span class="s5">1</span><span class="s2">]*</span><span class="s5">2</span><span class="s2">+</span><span class="s5">11</span><span class="s2">, </span><span class="s1">x</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">]+</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">,</span>
              <span class="s1">baseline</span><span class="s2">=</span><span class="s5">12</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s4">'//'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">&quot;H&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'test_stairs_datetime.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_stairs_datetime</span><span class="s2">():</span>
    <span class="s1">f</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">constrained_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">36</span><span class="s2">),</span>
              <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2001-12-27'</span><span class="s2">),</span>
                        <span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2002-02-02'</span><span class="s2">)))</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">xticks</span><span class="s2">(</span><span class="s1">rotation</span><span class="s2">=</span><span class="s5">30</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_stairs_edge_handling</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># Test</span>
    <span class="s1">test_ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">test_ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s3"># Ref</span>
    <span class="s1">ref_ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">st </span><span class="s2">= </span><span class="s1">ref_ax</span><span class="s2">.</span><span class="s1">stairs</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">st</span><span class="s2">.</span><span class="s1">set_color</span><span class="s2">(</span><span class="s4">'red'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">contour_dat</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">150</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">120</span><span class="s2">)</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[:, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">newaxis</span><span class="s2">])</span>
    <span class="s0">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'contour_hatching'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_hatching</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z </span><span class="s2">= </span><span class="s1">contour_dat</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s1">hatches</span><span class="s2">=[</span><span class="s4">'/'</span><span class="s2">, </span><span class="s4">'</span><span class="s0">\\</span><span class="s4">'</span><span class="s2">, </span><span class="s4">'//'</span><span class="s2">, </span><span class="s4">'-'</span><span class="s2">],</span>
                <span class="s1">cmap</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">'gray'</span><span class="s2">],</span>
                <span class="s1">extend</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span>
    <span class="s2">[</span><span class="s4">'contour_colorbar'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">,</span>
    <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.54 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() </span><span class="s0">in </span><span class="s2">(</span><span class="s4">'aarch64'</span><span class="s2">, </span><span class="s4">'ppc64le'</span><span class="s2">, </span><span class="s4">'s390x'</span><span class="s2">) </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_contour_colorbar</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z </span><span class="s2">= </span><span class="s1">contour_dat</span><span class="s2">()</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">cs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contourf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s5">1.8</span><span class="s2">, </span><span class="s5">1.801</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">),</span>
                     <span class="s1">cmap</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">'RdBu'</span><span class="s2">],</span>
                     <span class="s1">vmin</span><span class="s2">=-</span><span class="s5">0.6</span><span class="s2">,</span>
                     <span class="s1">vmax</span><span class="s2">=</span><span class="s5">0.6</span><span class="s2">,</span>
                     <span class="s1">extend</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">)</span>
    <span class="s1">cs1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s5">2.2</span><span class="s2">, -</span><span class="s5">0.599</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">),</span>
                     <span class="s1">colors</span><span class="s2">=[</span><span class="s4">'y'</span><span class="s2">],</span>
                     <span class="s1">linestyles</span><span class="s2">=</span><span class="s4">'solid'</span><span class="s2">,</span>
                     <span class="s1">linewidths</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">cs2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.6</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">),</span>
                     <span class="s1">colors</span><span class="s2">=[</span><span class="s4">'c'</span><span class="s2">],</span>
                     <span class="s1">linewidths</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">cbar </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">(</span><span class="s1">cs</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">add_lines</span><span class="s2">(</span><span class="s1">cs1</span><span class="s2">)</span>
    <span class="s1">cbar</span><span class="s2">.</span><span class="s1">add_lines</span><span class="s2">(</span><span class="s1">cs2</span><span class="s2">, </span><span class="s1">erase</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist2d'</span><span class="s2">, </span><span class="s4">'hist2d'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hist2d</span><span class="s2">():</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s3"># make it not symmetric in case we switch x and y axis</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">100</span><span class="s2">)*</span><span class="s5">2</span><span class="s2">+</span><span class="s5">5</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">100</span><span class="s2">)-</span><span class="s5">2</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist2d</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">rasterized</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;x&quot;</span><span class="s2">: </span><span class="s1">x</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">: </span><span class="s1">y</span><span class="s2">}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist2d</span><span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">, </span><span class="s1">rasterized</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist2d_transpose'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hist2d_transpose</span><span class="s2">():</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'pcolormesh.snap'</span><span class="s2">] = </span><span class="s0">False</span>

    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s3"># make sure the output from np.histogram is transposed before</span>
    <span class="s3"># passing to pcolorfast</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">5</span><span class="s2">]*</span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s5">100</span><span class="s2">)-</span><span class="s5">2</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist2d</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">rasterized</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist2d_density</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">100</span><span class="s2">))</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">obj </span><span class="s0">in </span><span class="s2">[</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">plt</span><span class="s2">]:</span>
        <span class="s1">obj</span><span class="s2">.</span><span class="s1">hist2d</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestScatter</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'scatter'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_scatter_plot</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;x&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]), </span><span class="s4">&quot;y&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]),</span>
                <span class="s4">&quot;c&quot;</span><span class="s2">: [</span><span class="s4">'r'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'lime'</span><span class="s2">], </span><span class="s4">&quot;s&quot;</span><span class="s2">: [</span><span class="s5">24</span><span class="s2">, </span><span class="s5">15</span><span class="s2">, </span><span class="s5">19</span><span class="s2">, </span><span class="s5">29</span><span class="s2">],</span>
                <span class="s4">&quot;c2&quot;</span><span class="s2">: [</span><span class="s4">'0.5'</span><span class="s2">, </span><span class="s4">'0.6'</span><span class="s2">, </span><span class="s4">'0.7'</span><span class="s2">, </span><span class="s4">'0.8'</span><span class="s2">]}</span>

        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s4">&quot;x&quot;</span><span class="s2">] - </span><span class="s5">1.</span><span class="s2">, </span><span class="s1">data</span><span class="s2">[</span><span class="s4">&quot;y&quot;</span><span class="s2">] - </span><span class="s5">1.</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">data</span><span class="s2">[</span><span class="s4">&quot;c&quot;</span><span class="s2">], </span><span class="s1">s</span><span class="s2">=</span><span class="s1">data</span><span class="s2">[</span><span class="s4">&quot;s&quot;</span><span class="s2">])</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s4">&quot;x&quot;</span><span class="s2">] + </span><span class="s5">1.</span><span class="s2">, </span><span class="s1">data</span><span class="s2">[</span><span class="s4">&quot;y&quot;</span><span class="s2">] + </span><span class="s5">1.</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">data</span><span class="s2">[</span><span class="s4">&quot;c2&quot;</span><span class="s2">], </span><span class="s1">s</span><span class="s2">=</span><span class="s1">data</span><span class="s2">[</span><span class="s4">&quot;s&quot;</span><span class="s2">])</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s4">&quot;s&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'scatter_marker.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_scatter_marker</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax0</span><span class="s2">, </span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">ncols</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">ax0</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
                    <span class="s1">c</span><span class="s2">=[(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'lime'</span><span class="s2">],</span>
                    <span class="s1">s</span><span class="s2">=[</span><span class="s5">60</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">40</span><span class="s2">, </span><span class="s5">30</span><span class="s2">],</span>
                    <span class="s1">edgecolors</span><span class="s2">=[</span><span class="s4">'k'</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s4">'g'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
                    <span class="s1">marker</span><span class="s2">=</span><span class="s4">'s'</span><span class="s2">)</span>
        <span class="s1">ax1</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
                    <span class="s1">c</span><span class="s2">=[(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'lime'</span><span class="s2">],</span>
                    <span class="s1">s</span><span class="s2">=[</span><span class="s5">60</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">40</span><span class="s2">, </span><span class="s5">30</span><span class="s2">],</span>
                    <span class="s1">edgecolors</span><span class="s2">=[</span><span class="s4">'k'</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s4">'g'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
                    <span class="s1">marker</span><span class="s2">=</span><span class="s1">mmarkers</span><span class="s2">.</span><span class="s1">MarkerStyle</span><span class="s2">(</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">fillstyle</span><span class="s2">=</span><span class="s4">'top'</span><span class="s2">))</span>
        <span class="s3"># unit area ellipse</span>
        <span class="s1">rx</span><span class="s2">, </span><span class="s1">ry </span><span class="s2">= </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span>
        <span class="s1">area </span><span class="s2">= </span><span class="s1">rx </span><span class="s2">* </span><span class="s1">ry </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>
        <span class="s1">theta </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s5">21</span><span class="s2">)</span>
        <span class="s1">verts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">column_stack</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">) * </span><span class="s1">rx </span><span class="s2">/ </span><span class="s1">area</span><span class="s2">,</span>
                                 <span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">) * </span><span class="s1">ry </span><span class="s2">/ </span><span class="s1">area</span><span class="s2">])</span>
        <span class="s1">ax2</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
                    <span class="s1">c</span><span class="s2">=[(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'lime'</span><span class="s2">],</span>
                    <span class="s1">s</span><span class="s2">=[</span><span class="s5">60</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">40</span><span class="s2">, </span><span class="s5">30</span><span class="s2">],</span>
                    <span class="s1">edgecolors</span><span class="s2">=[</span><span class="s4">'k'</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s4">'g'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
                    <span class="s1">marker</span><span class="s2">=</span><span class="s1">verts</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'scatter_2D'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_2D</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
        <span class="s1">z </span><span class="s2">= </span><span class="s1">x </span><span class="s2">+ </span><span class="s1">y</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">z</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s5">200</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">'face'</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_decimal</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
        <span class="s1">x0 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">8.4</span><span class="s2">, </span><span class="s5">5.3</span><span class="s2">, </span><span class="s5">4.2</span><span class="s2">])</span>
        <span class="s1">y0 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s5">3.3</span><span class="s2">, </span><span class="s5">4.4</span><span class="s2">])</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">x0</span><span class="s2">])</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">y0</span><span class="s2">])</span>
        <span class="s1">c </span><span class="s2">= [</span><span class="s4">'r'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'lime'</span><span class="s2">]</span>
        <span class="s1">s </span><span class="s2">= [</span><span class="s5">24</span><span class="s2">, </span><span class="s5">15</span><span class="s2">, </span><span class="s5">19</span><span class="s2">, </span><span class="s5">29</span><span class="s2">]</span>
        <span class="s3"># Test image - scatter plot with Decimal() input</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">c</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s1">s</span><span class="s2">)</span>
        <span class="s3"># Reference image</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">c</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s1">s</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_scatter_color</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Try to catch cases where 'c' kwarg should have been used.</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">])</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'kwargs'</span><span class="s2">,</span>
                                <span class="s2">[</span>
                                    <span class="s2">{</span><span class="s4">'cmap'</span><span class="s2">: </span><span class="s4">'gray'</span><span class="s2">},</span>
                                    <span class="s2">{</span><span class="s4">'norm'</span><span class="s2">: </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">Normalize</span><span class="s2">()},</span>
                                    <span class="s2">{</span><span class="s4">'vmin'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">},</span>
                                    <span class="s2">{</span><span class="s4">'vmax'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">}</span>
                                <span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_color_warning</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">warn_match </span><span class="s2">= </span><span class="s4">&quot;No data for colormapping provided &quot;</span>
        <span class="s3"># Warn for cases where 'cmap', 'norm', 'vmin', 'vmax'</span>
        <span class="s3"># kwargs are being overridden</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">Warning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">warn_match</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([], [], **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">Warning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">warn_match</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[], **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s3"># Do not warn for cases where 'c' matches 'x' and 'y'</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([], [], </span><span class="s1">c</span><span class="s2">=[], **</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_scatter_unfilled</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">coll </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s4">'0.1'</span><span class="s2">, </span><span class="s4">'0.3'</span><span class="s2">, </span><span class="s4">'0.5'</span><span class="s2">],</span>
                           <span class="s1">marker</span><span class="s2">=</span><span class="s1">mmarkers</span><span class="s2">.</span><span class="s1">MarkerStyle</span><span class="s2">(</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">fillstyle</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">),</span>
                           <span class="s1">linewidths</span><span class="s2">=[</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">1.2</span><span class="s2">, </span><span class="s5">1.3</span><span class="s2">])</span>
        <span class="s0">assert </span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_facecolors</span><span class="s2">().</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)  </span><span class="s3"># no facecolors</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_edgecolors</span><span class="s2">(), [[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                                                   <span class="s2">[</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                                                   <span class="s2">[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_linewidths</span><span class="s2">(), [</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">1.2</span><span class="s2">, </span><span class="s5">1.3</span><span class="s2">])</span>

    <span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_scatter_unfillable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">coll </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s4">'0.1'</span><span class="s2">, </span><span class="s4">'0.3'</span><span class="s2">, </span><span class="s4">'0.5'</span><span class="s2">],</span>
                           <span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">,</span>
                           <span class="s1">linewidths</span><span class="s2">=[</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">1.2</span><span class="s2">, </span><span class="s5">1.3</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_facecolors</span><span class="s2">(), </span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_edgecolors</span><span class="s2">())</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_edgecolors</span><span class="s2">(), [[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                                                   <span class="s2">[</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                                                   <span class="s2">[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_linewidths</span><span class="s2">(), [</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">1.2</span><span class="s2">, </span><span class="s5">1.3</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_scatter_size_arg_size</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'same size as x and y'</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:])</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'same size as x and y'</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:], </span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:], </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'float array-like'</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s4">'foo'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_scatter_edgecolor_RGB</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># GitHub issue 19066</span>
        <span class="s1">coll </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">],</span>
                            <span class="s1">edgecolor</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))</span>
        <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">(), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))</span>
        <span class="s1">coll </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                            <span class="s1">edgecolor</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
        <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">(), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>

    <span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_invalid_color</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">&quot;viridis&quot;</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s5">16</span><span class="s2">)</span>
        <span class="s1">cmap</span><span class="s2">.</span><span class="s1">set_bad</span><span class="s2">(</span><span class="s4">&quot;k&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s3"># Set a nonuniform size to prevent the last call to `scatter` (plotting</span>
        <span class="s3"># the invalid points separately in fig_ref) from using the marker</span>
        <span class="s3"># stamping fast path, which would result in slightly offset markers.</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">),</span>
                   <span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">s</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">],</span>
                   <span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">plotnonfinite</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">&quot;viridis&quot;</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s5">16</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">s</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">s</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">&quot;k&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_no_invalid_color</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
        <span class="s3"># With plotnonfinite=False we plot only 2 points.</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">&quot;viridis&quot;</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s5">16</span><span class="s2">)</span>
        <span class="s1">cmap</span><span class="s2">.</span><span class="s1">set_bad</span><span class="s2">(</span><span class="s4">&quot;k&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">),</span>
                   <span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">s</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">],</span>
                   <span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">plotnonfinite</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">s</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_scatter_norm_vminvmax</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot;Parameters vmin, vmax should error if norm is given.&quot;&quot;&quot;</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Passing a Normalize instance simultaneously &quot;</span>
                                 <span class="s4">&quot;with vmin/vmax is not supported.&quot;</span><span class="s2">):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">Normalize</span><span class="s2">(-</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">),</span>
                       <span class="s1">vmin</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">vmax</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_single_point</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">])</span>

    <span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_different_shapes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s1">c</span><span class="s2">=</span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s1">x</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">x</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>

    <span class="s3"># Parameters for *test_scatter_c*. NB: assuming that the</span>
    <span class="s3"># scatter plot will have 4 elements. The tuple scheme is:</span>
    <span class="s3"># (*c* parameter case, exception regexp key or None if no exception)</span>
    <span class="s1">params_test_scatter_c </span><span class="s2">= [</span>
        <span class="s3"># single string:</span>
        <span class="s2">(</span><span class="s4">'0.5'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s3"># Single letter-sequences</span>
        <span class="s2">([</span><span class="s4">&quot;rgby&quot;</span><span class="s2">], </span><span class="s4">&quot;conversion&quot;</span><span class="s2">),</span>
        <span class="s3"># Special cases</span>
        <span class="s2">(</span><span class="s4">&quot;red&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">&quot;none&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">&quot;r&quot;</span><span class="s2">, </span><span class="s4">&quot;g&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;none&quot;</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s3"># Non-valid color spec (FWIW, 'jaune' means yellow in French)</span>
        <span class="s2">(</span><span class="s4">&quot;jaune&quot;</span><span class="s2">, </span><span class="s4">&quot;conversion&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">&quot;jaune&quot;</span><span class="s2">], </span><span class="s4">&quot;conversion&quot;</span><span class="s2">),  </span><span class="s3"># wrong type before wrong size</span>
        <span class="s2">([</span><span class="s4">&quot;jaune&quot;</span><span class="s2">]*</span><span class="s5">4</span><span class="s2">, </span><span class="s4">&quot;conversion&quot;</span><span class="s2">),</span>
        <span class="s3"># Value-mapping like</span>
        <span class="s2">([</span><span class="s5">0.5</span><span class="s2">]*</span><span class="s5">3</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),  </span><span class="s3"># should emit a warning for user's eyes though</span>
        <span class="s2">([</span><span class="s5">0.5</span><span class="s2">]*</span><span class="s5">4</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),  </span><span class="s3"># NB: no warning as matching size allows mapping</span>
        <span class="s2">([</span><span class="s5">0.5</span><span class="s2">]*</span><span class="s5">5</span><span class="s2">, </span><span class="s4">&quot;shape&quot;</span><span class="s2">),</span>
        <span class="s3"># list of strings:</span>
        <span class="s2">([</span><span class="s4">'0.5'</span><span class="s2">, </span><span class="s4">'0.4'</span><span class="s2">, </span><span class="s4">'0.6'</span><span class="s2">, </span><span class="s4">'0.7'</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">'0.5'</span><span class="s2">, </span><span class="s4">'red'</span><span class="s2">, </span><span class="s4">'0.6'</span><span class="s2">, </span><span class="s4">'C5'</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">'0.5'</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s4">'0.6'</span><span class="s2">, </span><span class="s4">'C5'</span><span class="s2">], </span><span class="s4">&quot;conversion&quot;</span><span class="s2">),</span>
        <span class="s3"># RGB values</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]*</span><span class="s5">3</span><span class="s2">, </span><span class="s4">&quot;shape&quot;</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]*</span><span class="s5">4</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]*</span><span class="s5">5</span><span class="s2">, </span><span class="s4">&quot;shape&quot;</span><span class="s2">),</span>
        <span class="s3"># RGBA values</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">]], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">]]*</span><span class="s5">3</span><span class="s2">, </span><span class="s4">&quot;shape&quot;</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">]]*</span><span class="s5">4</span><span class="s2">, </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">]]*</span><span class="s5">5</span><span class="s2">, </span><span class="s4">&quot;shape&quot;</span><span class="s2">),</span>
        <span class="s3"># Mix of valid color specs</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">]]*</span><span class="s5">3 </span><span class="s2">+ [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s4">&quot;red&quot;</span><span class="s2">, </span><span class="s4">&quot;0.0&quot;</span><span class="s2">], </span><span class="s4">&quot;shape&quot;</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s4">&quot;red&quot;</span><span class="s2">, </span><span class="s4">&quot;0.0&quot;</span><span class="s2">, </span><span class="s4">&quot;C5&quot;</span><span class="s2">], </span><span class="s0">None</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s4">&quot;red&quot;</span><span class="s2">, </span><span class="s4">&quot;0.0&quot;</span><span class="s2">, </span><span class="s4">&quot;C5&quot;</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]], </span><span class="s4">&quot;shape&quot;</span><span class="s2">),</span>
        <span class="s3"># Mix of valid and non valid color specs</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s4">&quot;red&quot;</span><span class="s2">, </span><span class="s4">&quot;jaune&quot;</span><span class="s2">], </span><span class="s4">&quot;conversion&quot;</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s4">&quot;red&quot;</span><span class="s2">, </span><span class="s4">&quot;0.0&quot;</span><span class="s2">, </span><span class="s4">&quot;jaune&quot;</span><span class="s2">], </span><span class="s4">&quot;conversion&quot;</span><span class="s2">),</span>
        <span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], </span><span class="s4">&quot;red&quot;</span><span class="s2">, </span><span class="s4">&quot;0.0&quot;</span><span class="s2">, </span><span class="s4">&quot;C5&quot;</span><span class="s2">, </span><span class="s4">&quot;jaune&quot;</span><span class="s2">], </span><span class="s4">&quot;conversion&quot;</span><span class="s2">),</span>
    <span class="s2">]</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'c_case, re_key'</span><span class="s2">, </span><span class="s1">params_test_scatter_c</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_scatter_c</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">c_case</span><span class="s2">, </span><span class="s1">re_key</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">get_next_color</span><span class="s2">():</span>
            <span class="s0">return </span><span class="s4">'blue'  </span><span class="s3"># currently unused</span>

        <span class="s1">xsize </span><span class="s2">= </span><span class="s5">4</span>
        <span class="s3"># Additional checking of *c* (introduced in #11383).</span>
        <span class="s1">REGEXP </span><span class="s2">= {</span>
            <span class="s4">&quot;shape&quot;</span><span class="s2">: </span><span class="s4">&quot;^'c' argument has [0-9]+ elements&quot;</span><span class="s2">,  </span><span class="s3"># shape mismatch</span>
            <span class="s4">&quot;conversion&quot;</span><span class="s2">: </span><span class="s4">&quot;^'c' argument must be a color&quot;</span><span class="s2">,  </span><span class="s3"># bad vals</span>
            <span class="s2">}</span>

        <span class="s1">assert_context </span><span class="s2">= (</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">REGEXP</span><span class="s2">[</span><span class="s1">re_key</span><span class="s2">])</span>
            <span class="s0">if </span><span class="s1">re_key </span><span class="s0">is not None</span>
            <span class="s0">else </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;argument looks like a single numeric RGB&quot;</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">c_case</span><span class="s2">, </span><span class="s1">list</span><span class="s2">) </span><span class="s0">and </span><span class="s1">len</span><span class="s2">(</span><span class="s1">c_case</span><span class="s2">) == </span><span class="s5">3</span>
            <span class="s0">else </span><span class="s1">contextlib</span><span class="s2">.</span><span class="s1">nullcontext</span><span class="s2">()</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">assert_context</span><span class="s2">:</span>
            <span class="s1">mpl</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">.</span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">_parse_scatter_color_args</span><span class="s2">(</span>
                <span class="s1">c</span><span class="s2">=</span><span class="s1">c_case</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">&quot;black&quot;</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">={}, </span><span class="s1">xsize</span><span class="s2">=</span><span class="s1">xsize</span><span class="s2">,</span>
                <span class="s1">get_next_color_func</span><span class="s2">=</span><span class="s1">get_next_color</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_scatter_single_color_c</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
        <span class="s1">rgb </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.05</span><span class="s2">]]</span>
        <span class="s1">rgba </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.05</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">]]</span>

        <span class="s3"># set via color kwarg</span>
        <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s1">rgb</span><span class="s2">)</span>
        <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)*</span><span class="s5">2</span><span class="s2">, </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s1">rgba</span><span class="s2">)</span>

        <span class="s3"># set via broadcasting via c</span>
        <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">c</span><span class="s2">=</span><span class="s1">rgb</span><span class="s2">)</span>
        <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)*</span><span class="s5">2</span><span class="s2">, </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">c</span><span class="s2">=</span><span class="s1">rgba</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_scatter_linewidths</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>

        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">):</span>
            <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s1">i</span><span class="s2">), </span><span class="s1">c</span><span class="s2">=</span><span class="s4">f'C</span><span class="s0">{</span><span class="s1">i</span><span class="s0">}</span><span class="s4">'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s5">100</span><span class="s2">,</span>
                            <span class="s1">linewidths</span><span class="s2">=</span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">pc</span><span class="s2">.</span><span class="s1">get_linewidths</span><span class="s2">() == </span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span>

        <span class="s1">pc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'C3'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s5">100</span><span class="s2">,</span>
                        <span class="s1">linewidths</span><span class="s2">=[*</span><span class="s1">range</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s0">None</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">.</span><span class="s1">get_linewidths</span><span class="s2">(),</span>
                           <span class="s2">[*</span><span class="s1">range</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'lines.linewidth'</span><span class="s2">]])</span>

    <span class="s0">def </span><span class="s1">test_scatter_singular_plural_arguments</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Got both 'linewidth' and 'linewidths',</span><span class="s0">\ 
 </span><span class="s4">which are aliases of one another&quot;</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">linewidths</span><span class="s2">=[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">], </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Got both 'edgecolor' and 'edgecolors',</span><span class="s0">\ 
 </span><span class="s4">which are aliases of one another&quot;</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
                        <span class="s1">edgecolors</span><span class="s2">=[</span><span class="s4">&quot;#ffffff&quot;</span><span class="s2">, </span><span class="s4">&quot;#000000&quot;</span><span class="s2">, </span><span class="s4">&quot;#f0f0f0&quot;</span><span class="s2">],</span>
                          <span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">&quot;#ffffff&quot;</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">,</span>
                           <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Got both 'facecolors' and 'facecolor',</span><span class="s0">\ 
 </span><span class="s4">which are aliases of one another&quot;</span><span class="s2">):</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
                        <span class="s1">facecolors</span><span class="s2">=[</span><span class="s4">&quot;#ffffff&quot;</span><span class="s2">, </span><span class="s4">&quot;#000000&quot;</span><span class="s2">, </span><span class="s4">&quot;#f0f0f0&quot;</span><span class="s2">],</span>
                            <span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;#ffffff&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">_params</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">xsize</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, *, </span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">, </span><span class="s1">kwargs </span><span class="s0">if </span><span class="s1">kwargs </span><span class="s0">is not None else </span><span class="s2">{}, </span><span class="s1">xsize</span><span class="s2">)</span>
<span class="s1">_result </span><span class="s2">= </span><span class="s1">namedtuple</span><span class="s2">(</span><span class="s4">'_result'</span><span class="s2">, </span><span class="s4">'c, colors'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">'params, expected_result'</span><span class="s2">,</span>
    <span class="s2">[(</span><span class="s1">_params</span><span class="s2">(),</span>
      <span class="s1">_result</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]))),</span>
     <span class="s2">(</span><span class="s1">_params</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">),</span>
      <span class="s1">_result</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]))),</span>
     <span class="s2">(</span><span class="s1">_params</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">),</span>
      <span class="s1">_result</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]))),</span>
     <span class="s3"># color</span>
     <span class="s2">(</span><span class="s1">_params</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">),</span>
      <span class="s1">_result</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]))),</span>
     <span class="s2">(</span><span class="s1">_params</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=[</span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'g'</span><span class="s2">]),</span>
      <span class="s1">_result</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=[</span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'g'</span><span class="s2">], </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]))),</span>
     <span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_parse_scatter_color_args</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">get_next_color</span><span class="s2">():</span>
        <span class="s0">return </span><span class="s4">'blue'  </span><span class="s3"># currently unused</span>

    <span class="s1">c</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">, </span><span class="s1">_edgecolors </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">.</span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">_parse_scatter_color_args</span><span class="s2">(</span>
        <span class="s2">*</span><span class="s1">params</span><span class="s2">, </span><span class="s1">get_next_color_func</span><span class="s2">=</span><span class="s1">get_next_color</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">c </span><span class="s2">== </span><span class="s1">expected_result</span><span class="s2">.</span><span class="s1">c</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">colors</span><span class="s2">, </span><span class="s1">expected_result</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">)</span>

<span class="s0">del </span><span class="s1">_params</span>
<span class="s0">del </span><span class="s1">_result</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">'kwargs, expected_edgecolors'</span><span class="s2">,</span>
    <span class="s2">[(</span><span class="s1">dict</span><span class="s2">(), </span><span class="s0">None</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">), </span><span class="s0">None</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">), </span><span class="s4">'r'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">edgecolors</span><span class="s2">=[</span><span class="s4">'r'</span><span class="s2">, </span><span class="s4">'g'</span><span class="s2">]), [</span><span class="s4">'r'</span><span class="s2">, </span><span class="s4">'g'</span><span class="s2">]),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">), </span><span class="s4">'r'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">'face'</span><span class="s2">), </span><span class="s4">'face'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">), </span><span class="s4">'none'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">), </span><span class="s4">'r'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">c</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">), </span><span class="s4">'r'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">), </span><span class="s4">'r'</span><span class="s2">),</span>
     <span class="s2">(</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">), </span><span class="s4">'g'</span><span class="s2">),</span>
     <span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_parse_scatter_color_args_edgecolors</span><span class="s2">(</span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">expected_edgecolors</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">get_next_color</span><span class="s2">():</span>
        <span class="s0">return </span><span class="s4">'blue'  </span><span class="s3"># currently unused</span>

    <span class="s1">c </span><span class="s2">= </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s4">'c'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">edgecolors </span><span class="s2">= </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s4">'edgecolors'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">result_edgecolors </span><span class="s2">= </span><span class="s1">\</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">.</span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">_parse_scatter_color_args</span><span class="s2">(</span>
            <span class="s1">c</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">xsize</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">get_next_color_func</span><span class="s2">=</span><span class="s1">get_next_color</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result_edgecolors </span><span class="s2">== </span><span class="s1">expected_edgecolors</span>


<span class="s0">def </span><span class="s1">test_parse_scatter_color_args_error</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">get_next_color</span><span class="s2">():</span>
        <span class="s0">return </span><span class="s4">'blue'  </span><span class="s3"># currently unused</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;RGBA values should be within 0-1 range&quot;</span><span class="s2">):</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">], [</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">1.4</span><span class="s2">]])  </span><span class="s3"># value &gt; 1</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">.</span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">_parse_scatter_color_args</span><span class="s2">(</span>
            <span class="s1">c</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">={}, </span><span class="s1">xsize</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">get_next_color_func</span><span class="s2">=</span><span class="s1">get_next_color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_as_mpl_axes_api</span><span class="s2">():</span>
    <span class="s3"># tests the _as_mpl_axes api</span>
    <span class="s0">class </span><span class="s1">Polar</span><span class="s2">:</span>
        <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">theta_offset </span><span class="s2">= </span><span class="s5">0</span>

        <span class="s0">def </span><span class="s1">_as_mpl_axes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s3"># implement the matplotlib axes interface</span>
            <span class="s0">return </span><span class="s1">PolarAxes</span><span class="s2">, {</span><span class="s4">'theta_offset'</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">theta_offset</span><span class="s2">}</span>

    <span class="s1">prj </span><span class="s2">= </span><span class="s1">Polar</span><span class="s2">()</span>
    <span class="s1">prj2 </span><span class="s2">= </span><span class="s1">Polar</span><span class="s2">()</span>
    <span class="s1">prj2</span><span class="s2">.</span><span class="s1">theta_offset </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span>

    <span class="s3"># testing axes creation with plt.axes</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">projection</span><span class="s2">=</span><span class="s1">prj</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">) </span><span class="s0">is </span><span class="s1">PolarAxes</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># testing axes creation with subplot</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">121</span><span class="s2">, </span><span class="s1">projection</span><span class="s2">=</span><span class="s1">prj</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">) </span><span class="s0">is </span><span class="s1">PolarAxes</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_pyplot_axes</span><span class="s2">():</span>
    <span class="s3"># test focusing of Axes in other Figure</span>
    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">sca</span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax1 </span><span class="s0">is </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">fig1 </span><span class="s0">is </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gcf</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">(</span><span class="s1">fig1</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">(</span><span class="s1">fig2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_log_scales</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">, </span><span class="s1">base</span><span class="s2">=</span><span class="s5">5.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">, </span><span class="s1">base</span><span class="s2">=</span><span class="s5">9.0</span><span class="s2">)</span>
    <span class="s1">xticks</span><span class="s2">, </span><span class="s1">yticks </span><span class="s2">= [</span>
        <span class="s2">[(</span><span class="s1">t</span><span class="s2">.</span><span class="s1">get_loc</span><span class="s2">(), </span><span class="s1">t</span><span class="s2">.</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">()) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">_update_ticks</span><span class="s2">()]</span>
        <span class="s0">for </span><span class="s1">axis </span><span class="s0">in </span><span class="s2">[</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">]</span>
    <span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">xticks </span><span class="s2">== [</span>
        <span class="s2">(</span><span class="s5">1.0</span><span class="s2">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{9^{0}}$'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">9.0</span><span class="s2">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{9^{1}}$'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">81.0</span><span class="s2">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{9^{2}}$'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">2.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">3.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">4.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">5.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">6.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">7.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">8.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">18.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">27.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">36.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">45.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">54.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">63.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">72.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
    <span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">yticks </span><span class="s2">== [</span>
        <span class="s2">(</span><span class="s5">0.18181818181818182</span><span class="s2">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{5.5^{-1}}$'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">1.0</span><span class="s2">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{5.5^{0}}$'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">5.5</span><span class="s2">, </span><span class="s4">'$</span><span class="s0">\\</span><span class="s4">mathdefault{5.5^{1}}$'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">0.36363636363636365</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">0.5454545454545454</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">0.7272727272727273</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">0.9090909090909092</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">2.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">3.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">4.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s5">5.0</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
    <span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_log_scales_no_data</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xscale</span><span class="s2">=</span><span class="s4">&quot;log&quot;</span><span class="s2">, </span><span class="s1">yscale</span><span class="s2">=</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">mticker</span><span class="s2">.</span><span class="s1">MultipleLocator</span><span class="s2">(</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_log_scales_invalid</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'Attempt to set non-positive'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'Attempt to set non-positive'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'stackplot_test_image'</span><span class="s2">, </span><span class="s4">'stackplot_test_image'</span><span class="s2">],</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.031 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_stackplot</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y1 </span><span class="s2">= </span><span class="s5">1.0 </span><span class="s2">* </span><span class="s1">x</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s5">2.0 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">1</span>
    <span class="s1">y3 </span><span class="s2">= </span><span class="s5">3.0 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">2</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stackplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">y3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">70</span><span class="s2">))</span>

    <span class="s3"># Reuse testcase from above for a test with labeled data and with colours</span>
    <span class="s3"># from the Axes property cycle.</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;x&quot;</span><span class="s2">: </span><span class="s1">x</span><span class="s2">, </span><span class="s4">&quot;y1&quot;</span><span class="s2">: </span><span class="s1">y1</span><span class="s2">, </span><span class="s4">&quot;y2&quot;</span><span class="s2">: </span><span class="s1">y2</span><span class="s2">, </span><span class="s4">&quot;y3&quot;</span><span class="s2">: </span><span class="s1">y3</span><span class="s2">}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stackplot</span><span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y1&quot;</span><span class="s2">, </span><span class="s4">&quot;y2&quot;</span><span class="s2">, </span><span class="s4">&quot;y3&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=[</span><span class="s4">&quot;C0&quot;</span><span class="s2">, </span><span class="s4">&quot;C1&quot;</span><span class="s2">, </span><span class="s4">&quot;C2&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">70</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'stackplot_test_baseline'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_stackplot_baseline</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">layers</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">m</span><span class="s2">):</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s1">m</span><span class="s2">, </span><span class="s1">n</span><span class="s2">))</span>
        <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">):</span>
                <span class="s1">x </span><span class="s2">= </span><span class="s5">1 </span><span class="s2">/ (</span><span class="s5">.1 </span><span class="s2">+ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">())</span>
                <span class="s1">y </span><span class="s2">= </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">() - </span><span class="s5">.5</span>
                <span class="s1">z </span><span class="s2">= </span><span class="s5">10 </span><span class="s2">/ (</span><span class="s5">.1 </span><span class="s2">+ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">())</span>
                <span class="s1">a</span><span class="s2">[:, </span><span class="s1">i</span><span class="s2">] += </span><span class="s1">x </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">m</span><span class="s2">) / </span><span class="s1">m </span><span class="s2">- </span><span class="s1">y</span><span class="s2">) * </span><span class="s1">z</span><span class="s2">) ** </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">a</span>

    <span class="s1">d </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">d</span><span class="s2">[</span><span class="s5">50</span><span class="s2">, :] = </span><span class="s5">0  </span><span class="s3"># test for fixed weighted wiggle (issue #6313)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">stackplot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">100</span><span class="s2">), </span><span class="s1">d</span><span class="s2">.</span><span class="s1">T</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s4">'zero'</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">stackplot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">100</span><span class="s2">), </span><span class="s1">d</span><span class="s2">.</span><span class="s1">T</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s4">'sym'</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">stackplot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">100</span><span class="s2">), </span><span class="s1">d</span><span class="s2">.</span><span class="s1">T</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s4">'wiggle'</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">stackplot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">100</span><span class="s2">), </span><span class="s1">d</span><span class="s2">.</span><span class="s1">T</span><span class="s2">, </span><span class="s1">baseline</span><span class="s2">=</span><span class="s4">'weighted_wiggle'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_stackplot_hatching</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y1 </span><span class="s2">= </span><span class="s5">1.0 </span><span class="s2">* </span><span class="s1">x</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s5">2.0 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">1</span>
    <span class="s1">y3 </span><span class="s2">= </span><span class="s5">3.0 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">2</span>
    <span class="s3"># stackplot with different hatching styles (issue #27146)</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">stackplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">y3</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=[</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;//&quot;</span><span class="s2">, </span><span class="s4">&quot;</span><span class="s0">\\\\</span><span class="s4">&quot;</span><span class="s2">], </span><span class="s1">colors</span><span class="s2">=[</span><span class="s4">&quot;white&quot;</span><span class="s2">])</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">70</span><span class="s2">))</span>
    <span class="s3"># compare with result from hatching each layer individually</span>
    <span class="s1">stack_baseline </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">stack_baseline</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;white&quot;</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">+</span><span class="s1">y2</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s4">&quot;//&quot;</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;white&quot;</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">+</span><span class="s1">y2</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">+</span><span class="s1">y2</span><span class="s2">+</span><span class="s1">y3</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s4">&quot;</span><span class="s0">\\\\</span><span class="s4">&quot;</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;white&quot;</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">70</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">_bxp_test_helper</span><span class="s2">(</span>
        <span class="s1">stats_kwargs</span><span class="s2">={}, </span><span class="s1">transform_stats</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">s</span><span class="s2">: </span><span class="s1">s</span><span class="s2">, </span><span class="s1">bxp_kwargs</span><span class="s2">={}):</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">937</span><span class="s2">)</span>
    <span class="s1">logstats </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">cbook</span><span class="s2">.</span><span class="s1">boxplot_stats</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">lognormal</span><span class="s2">(</span><span class="s1">mean</span><span class="s2">=</span><span class="s5">1.25</span><span class="s2">, </span><span class="s1">sigma</span><span class="s2">=</span><span class="s5">1.</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s5">37</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)), **</span><span class="s1">stats_kwargs</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">bxp_kwargs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'vert'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s3"># Work around baseline images generate back when bxp did not respect the</span>
    <span class="s3"># boxplot.boxprops.linewidth rcParam when patch_artist is False.</span>
    <span class="s0">if not </span><span class="s1">bxp_kwargs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'patch_artist'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'boxplot.boxprops.linewidth'</span><span class="s2">] = </span><span class="s1">\</span>
            <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'lines.linewidth'</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bxp</span><span class="s2">(</span><span class="s1">transform_stats</span><span class="s2">(</span><span class="s1">logstats</span><span class="s2">), **</span><span class="s1">bxp_kwargs</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_baseline.png'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_baseline</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_rangewhis.png'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_rangewhis</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">stats_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">whis</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">100</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_percentilewhis.png'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_percentilewhis</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">stats_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">whis</span><span class="s2">=[</span><span class="s5">5</span><span class="s2">, </span><span class="s5">95</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_with_xlabels.png'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_with_xlabels</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">s</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">list</span><span class="s2">(</span><span class="s4">'ABCD'</span><span class="s2">)):</span>
            <span class="s1">s</span><span class="s2">[</span><span class="s4">'label'</span><span class="s2">] = </span><span class="s1">label</span>
        <span class="s0">return </span><span class="s1">stats</span>

    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">transform_stats</span><span class="s2">=</span><span class="s1">transform</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_horizontal.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.1</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_horizontal</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_with_ylabels.png'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.1</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_with_ylabels</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">s</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">list</span><span class="s2">(</span><span class="s4">'ABCD'</span><span class="s2">)):</span>
            <span class="s1">s</span><span class="s2">[</span><span class="s4">'label'</span><span class="s2">] = </span><span class="s1">label</span>
        <span class="s0">return </span><span class="s1">stats</span>

    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">transform_stats</span><span class="s2">=</span><span class="s1">transform</span><span class="s2">, </span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_patchartist.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_patchartist</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">patch_artist</span><span class="s2">=</span><span class="s0">True</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_custompatchartist.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">100</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custompatchartist</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span>
        <span class="s1">patch_artist</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
        <span class="s1">boxprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'yellow'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">':'</span><span class="s2">)))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_customoutlier.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_customoutlier</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span>
        <span class="s1">flierprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'d'</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">)))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_withmean_custompoint.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_showcustommean</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span>
        <span class="s1">showmeans</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
        <span class="s1">meanprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'d'</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">),</span>
    <span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_custombox.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custombox</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span>
        <span class="s1">boxprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_custommedian.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custommedian</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span>
        <span class="s1">medianprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_customcap.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_customcap</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span>
        <span class="s1">capprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_customwhisker.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_customwhisker</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span>
        <span class="s1">whiskerprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'m'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)))</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_boxplot_median_bound_by_box</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">medianprops_test </span><span class="s2">= {</span><span class="s4">&quot;linewidth&quot;</span><span class="s2">: </span><span class="s5">12</span><span class="s2">}</span>
    <span class="s1">medianprops_ref </span><span class="s2">= {**</span><span class="s1">medianprops_test</span><span class="s2">, </span><span class="s4">&quot;solid_capstyle&quot;</span><span class="s2">: </span><span class="s4">&quot;butt&quot;</span><span class="s2">}</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">,  </span><span class="s1">medianprops</span><span class="s2">=</span><span class="s1">medianprops_test</span><span class="s2">)</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">medianprops</span><span class="s2">=</span><span class="s1">medianprops_ref</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_withnotch.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_shownotches</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">shownotches</span><span class="s2">=</span><span class="s0">True</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_nocaps.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_nocaps</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">showcaps</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_nobox.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_nobox</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">showbox</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_no_flier_stats.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_no_flier_stats</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">s </span><span class="s0">in </span><span class="s1">stats</span><span class="s2">:</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s4">'fliers'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">stats</span>

    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">transform_stats</span><span class="s2">=</span><span class="s1">transform</span><span class="s2">,</span>
                     <span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">showfliers</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_withmean_point.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_showmean</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">meanline</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_withmean_line.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_showmeanasline</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">meanline</span><span class="s2">=</span><span class="s0">True</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_scalarwidth.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_scalarwidth</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">widths</span><span class="s2">=</span><span class="s5">.25</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_customwidths.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_customwidths</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">widths</span><span class="s2">=[</span><span class="s5">0.10</span><span class="s2">, </span><span class="s5">0.25</span><span class="s2">, </span><span class="s5">0.65</span><span class="s2">, </span><span class="s5">0.85</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_custompositions.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custompositions</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">positions</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]))</span>


<span class="s0">def </span><span class="s1">test_bxp_bad_widths</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">widths</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">]))</span>


<span class="s0">def </span><span class="s1">test_bxp_bad_positions</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">positions</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_custom_capwidths.png'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custom_capwidths</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">capwidths</span><span class="s2">=[</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'bxp_custom_capwidth.png'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bxp_custom_capwidth</span><span class="s2">():</span>
    <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">capwidths</span><span class="s2">=</span><span class="s5">0.6</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_bxp_bad_capwidths</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">_bxp_test_helper</span><span class="s2">(</span><span class="s1">bxp_kwargs</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">capwidths</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">]))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot'</span><span class="s2">, </span><span class="s4">'boxplot'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">1.28</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot</span><span class="s2">():</span>
    <span class="s3"># Randomness used for bootstrapping.</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">937</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([-</span><span class="s5">25</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">25</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">bootstrap</span><span class="s2">=</span><span class="s5">10000</span><span class="s2">, </span><span class="s1">notch</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">))</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;x&quot;</span><span class="s2">: [</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">]}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">bootstrap</span><span class="s2">=</span><span class="s5">10000</span><span class="s2">, </span><span class="s1">notch</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_boxplot_masked</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># Check that masked values are ignored when plotting a boxplot</span>
    <span class="s1">x_orig </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">200</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">x_orig</span><span class="s2">[</span><span class="s1">x_orig </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_less</span><span class="s2">(</span><span class="s1">x_orig</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot_custom_capwidths.png'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">}, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_custom_capwidths</span><span class="s2">():</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([-</span><span class="s5">25</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">25</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">notch</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">capwidths</span><span class="s2">=[</span><span class="s5">0.01</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot_sym2.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_sym2</span><span class="s2">():</span>
    <span class="s3"># Randomness used for bootstrapping.</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">937</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([-</span><span class="s5">25</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">25</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, [</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">] = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">bootstrap</span><span class="s2">=</span><span class="s5">10000</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">=</span><span class="s4">'^'</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">))</span>

    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">bootstrap</span><span class="s2">=</span><span class="s5">10000</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot_sym.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">},</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_sym</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([-</span><span class="s5">25</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">25</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">sym</span><span class="s2">=</span><span class="s4">'gs'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot_autorange_false_whiskers.png'</span><span class="s2">,</span>
                   <span class="s4">'boxplot_autorange_true_whiskers.png'</span><span class="s2">],</span>
                  <span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_autorange_whiskers</span><span class="s2">():</span>
    <span class="s3"># Randomness used for bootstrapping.</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">937</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>

    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">bootstrap</span><span class="s2">=</span><span class="s5">10000</span><span class="s2">, </span><span class="s1">notch</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>

    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">bootstrap</span><span class="s2">=</span><span class="s5">10000</span><span class="s2">, </span><span class="s1">notch</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">autorange</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">_rc_test_bxp_helper</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">rc_dict</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([-</span><span class="s5">25</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">25</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc_dict</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">])</span>
    <span class="s0">return </span><span class="s1">ax</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot_rc_parameters'</span><span class="s2">],</span>
                  <span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">100</span><span class="s2">}, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_rc_parameters</span><span class="s2">():</span>
    <span class="s3"># Randomness used for bootstrapping.</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">937</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)</span>

    <span class="s1">rc_axis0 </span><span class="s2">= {</span>
        <span class="s4">'boxplot.notch'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">'boxplot.whiskers'</span><span class="s2">: [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">95</span><span class="s2">],</span>
        <span class="s4">'boxplot.bootstrap'</span><span class="s2">: </span><span class="s5">10000</span><span class="s2">,</span>

        <span class="s4">'boxplot.flierprops.color'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
        <span class="s4">'boxplot.flierprops.marker'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
        <span class="s4">'boxplot.flierprops.markerfacecolor'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
        <span class="s4">'boxplot.flierprops.markeredgecolor'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
        <span class="s4">'boxplot.flierprops.markersize'</span><span class="s2">: </span><span class="s5">5</span><span class="s2">,</span>
        <span class="s4">'boxplot.flierprops.linestyle'</span><span class="s2">: </span><span class="s4">'--'</span><span class="s2">,</span>
        <span class="s4">'boxplot.flierprops.linewidth'</span><span class="s2">: </span><span class="s5">2.0</span><span class="s2">,</span>

        <span class="s4">'boxplot.boxprops.color'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
        <span class="s4">'boxplot.boxprops.linewidth'</span><span class="s2">: </span><span class="s5">2.0</span><span class="s2">,</span>
        <span class="s4">'boxplot.boxprops.linestyle'</span><span class="s2">: </span><span class="s4">'--'</span><span class="s2">,</span>

        <span class="s4">'boxplot.capprops.color'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
        <span class="s4">'boxplot.capprops.linewidth'</span><span class="s2">: </span><span class="s5">2.0</span><span class="s2">,</span>
        <span class="s4">'boxplot.capprops.linestyle'</span><span class="s2">: </span><span class="s4">'--'</span><span class="s2">,</span>

        <span class="s4">'boxplot.medianprops.color'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
        <span class="s4">'boxplot.medianprops.linewidth'</span><span class="s2">: </span><span class="s5">2.0</span><span class="s2">,</span>
        <span class="s4">'boxplot.medianprops.linestyle'</span><span class="s2">: </span><span class="s4">'--'</span><span class="s2">,</span>
    <span class="s2">}</span>

    <span class="s1">rc_axis1 </span><span class="s2">= {</span>
        <span class="s4">'boxplot.vertical'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">'boxplot.whiskers'</span><span class="s2">: [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">100</span><span class="s2">],</span>
        <span class="s4">'boxplot.patchartist'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
    <span class="s2">}</span>

    <span class="s1">rc_axis2 </span><span class="s2">= {</span>
        <span class="s4">'boxplot.whiskers'</span><span class="s2">: </span><span class="s5">2.0</span><span class="s2">,</span>
        <span class="s4">'boxplot.showcaps'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">'boxplot.showbox'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">'boxplot.showfliers'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">'boxplot.showmeans'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">'boxplot.meanline'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>

        <span class="s4">'boxplot.meanprops.color'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
        <span class="s4">'boxplot.meanprops.linewidth'</span><span class="s2">: </span><span class="s5">2.0</span><span class="s2">,</span>
        <span class="s4">'boxplot.meanprops.linestyle'</span><span class="s2">: </span><span class="s4">'--'</span><span class="s2">,</span>

        <span class="s4">'boxplot.whiskerprops.color'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
        <span class="s4">'boxplot.whiskerprops.linewidth'</span><span class="s2">: </span><span class="s5">2.0</span><span class="s2">,</span>
        <span class="s4">'boxplot.whiskerprops.linestyle'</span><span class="s2">: </span><span class="s4">'-.'</span><span class="s2">,</span>
    <span class="s2">}</span>
    <span class="s1">dict_list </span><span class="s2">= [</span><span class="s1">rc_axis0</span><span class="s2">, </span><span class="s1">rc_axis1</span><span class="s2">, </span><span class="s1">rc_axis2</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">axis</span><span class="s2">, </span><span class="s1">rc_axis </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">dict_list</span><span class="s2">):</span>
        <span class="s1">_rc_test_bxp_helper</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">, </span><span class="s1">rc_axis</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s2">(</span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">.</span><span class="s1">PathPatch </span><span class="s0">in</span>
            <span class="s2">[</span><span class="s1">type</span><span class="s2">(</span><span class="s1">t</span><span class="s2">) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_children</span><span class="s2">()])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot_with_CIarray.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">}, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_with_CIarray</span><span class="s2">():</span>
    <span class="s3"># Randomness used for bootstrapping.</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">937</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([-</span><span class="s5">25</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">25</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">CIs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[-</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">], [-</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">]])</span>

    <span class="s3"># show a boxplot with Matplotlib medians and confidence intervals, and</span>
    <span class="s3"># another with manual values</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">bootstrap</span><span class="s2">=</span><span class="s5">10000</span><span class="s2">, </span><span class="s1">usermedians</span><span class="s2">=[</span><span class="s0">None</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">],</span>
               <span class="s1">conf_intervals</span><span class="s2">=</span><span class="s1">CIs</span><span class="s2">, </span><span class="s1">notch</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot_no_inverted_whisker.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">}, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_no_weird_whisker</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">9000</span><span class="s2">, </span><span class="s5">150</span><span class="s2">, </span><span class="s5">88</span><span class="s2">, </span><span class="s5">350</span><span class="s2">, </span><span class="s5">200000</span><span class="s2">, </span><span class="s5">1400</span><span class="s2">, </span><span class="s5">960</span><span class="s2">],</span>
                 <span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_boxplot_bad_medians</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([-</span><span class="s5">25</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">25</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">usermedians</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">usermedians</span><span class="s2">=[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]])</span>


<span class="s0">def </span><span class="s1">test_boxplot_bad_ci</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">140</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([-</span><span class="s5">25</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s5">25</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">conf_intervals</span><span class="s2">=[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">], </span><span class="s1">conf_intervals</span><span class="s2">=[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]])</span>


<span class="s0">def </span><span class="s1">test_boxplot_zorder</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">fix</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)[</span><span class="s4">'boxes'</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_zorder</span><span class="s2">() == </span><span class="s5">2</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)[</span><span class="s4">'boxes'</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_zorder</span><span class="s2">() == </span><span class="s5">10</span>


<span class="s0">def </span><span class="s1">test_boxplot_marker_behavior</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'lines.marker'</span><span class="s2">] = </span><span class="s4">'s'</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'boxplot.flierprops.marker'</span><span class="s2">] = </span><span class="s4">'o'</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'boxplot.meanprops.marker'</span><span class="s2">] = </span><span class="s4">'^'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">test_data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">test_data</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] = </span><span class="s5">150  </span><span class="s3"># a flier point</span>
    <span class="s1">bxp_handle </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">test_data</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">bxp_lines </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'whiskers'</span><span class="s2">, </span><span class="s4">'caps'</span><span class="s2">, </span><span class="s4">'boxes'</span><span class="s2">, </span><span class="s4">'medians'</span><span class="s2">]:</span>
        <span class="s0">for </span><span class="s1">each_line </span><span class="s0">in </span><span class="s1">bxp_handle</span><span class="s2">[</span><span class="s1">bxp_lines</span><span class="s2">]:</span>
            <span class="s3"># Ensure that the rcParams['lines.marker'] is overridden by ''</span>
            <span class="s0">assert </span><span class="s1">each_line</span><span class="s2">.</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s4">''</span>

    <span class="s3"># Ensure that markers for fliers and means aren't overridden with ''</span>
    <span class="s0">assert </span><span class="s1">bxp_handle</span><span class="s2">[</span><span class="s4">'fliers'</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s4">'o'</span>
    <span class="s0">assert </span><span class="s1">bxp_handle</span><span class="s2">[</span><span class="s4">'means'</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s4">'^'</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'boxplot_mod_artists_after_plotting.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">}, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_boxplot_mod_artist_after_plotting</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">0.15</span><span class="s2">, </span><span class="s5">0.11</span><span class="s2">, </span><span class="s5">0.06</span><span class="s2">, </span><span class="s5">0.06</span><span class="s2">, </span><span class="s5">0.12</span><span class="s2">, </span><span class="s5">0.56</span><span class="s2">, -</span><span class="s5">0.56</span><span class="s2">]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">bp </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">sym</span><span class="s2">=</span><span class="s4">&quot;o&quot;</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">bp</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">obj </span><span class="s0">in </span><span class="s1">bp</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]:</span>
            <span class="s1">obj</span><span class="s2">.</span><span class="s1">set_color</span><span class="s2">(</span><span class="s4">'green'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_vert_baseline.png'</span><span class="s2">,</span>
                   <span class="s4">'violinplot_vert_baseline.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_baseline</span><span class="s2">():</span>
    <span class="s3"># First 9 digits of frac(sqrt(2))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">414213562</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;d&quot;</span><span class="s2">: </span><span class="s1">data</span><span class="s2">}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_vert_showmeans.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_showmeans</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(3))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">732050807</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_vert_showextrema.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_showextrema</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(5))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">236067977</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showextrema</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_vert_showmedians.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_showmedians</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(7))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">645751311</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showmedians</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_vert_showall.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_showall</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(11))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">316624790</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">showextrema</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">showmedians</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">quantiles</span><span class="s2">=[[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">], [</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.8</span><span class="s2">], [</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">], [</span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">]])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_vert_custompoints_10.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_custompoints_10</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(13))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">605551275</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">points</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_vert_custompoints_200.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_vert_violinplot_custompoints_200</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(17))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">123105625</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">points</span><span class="s2">=</span><span class="s5">200</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_horiz_baseline.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_baseline</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(19))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">358898943</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_horiz_showmedians.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_showmedians</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(23))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">795831523</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_horiz_showmeans.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_showmeans</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(29))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">385164807</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_horiz_showextrema.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_showextrema</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(31))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">567764362</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_horiz_showall.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_showall</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(37))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">82762530</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">quantiles</span><span class="s2">=[[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">], [</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.8</span><span class="s2">], [</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">], [</span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">]])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_horiz_custompoints_10.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_custompoints_10</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(41))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">403124237</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">points</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_horiz_custompoints_200.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_horiz_violinplot_custompoints_200</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(43))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">557438524</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                  <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">points</span><span class="s2">=</span><span class="s5">200</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'violinplot_sides.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_violinplot_sides</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">)]</span>
    <span class="s3"># Check horizontal violinplot</span>
    <span class="s0">for </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">side </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], [</span><span class="s4">'both'</span><span class="s2">, </span><span class="s4">'low'</span><span class="s2">, </span><span class="s4">'high'</span><span class="s2">]):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=[</span><span class="s1">pos</span><span class="s2">], </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                      <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">side</span><span class="s2">=</span><span class="s1">side</span><span class="s2">)</span>
    <span class="s3"># Check vertical violinplot</span>
    <span class="s0">for </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">side </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">([</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">, </span><span class="s5">4.5</span><span class="s2">], [</span><span class="s4">'both'</span><span class="s2">, </span><span class="s4">'low'</span><span class="s2">, </span><span class="s4">'high'</span><span class="s2">]):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=[</span><span class="s1">pos</span><span class="s2">], </span><span class="s1">vert</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">showmeans</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                      <span class="s1">showextrema</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">showmedians</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">side</span><span class="s2">=</span><span class="s1">side</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_violinplot_bad_positions</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(47))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">855654600</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_violinplot_bad_widths</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(53))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">280109889</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">positions</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">widths</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_violinplot_bad_quantiles</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(73))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">544003745</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">)]</span>

    <span class="s3"># Different size quantile list and plots</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">quantiles</span><span class="s2">=[[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">], [</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">]])</span>


<span class="s0">def </span><span class="s1">test_violinplot_outofrange_quantiles</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s3"># First 9 digits of frac(sqrt(79))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">888194417</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">)]</span>

    <span class="s3"># Quantile value above 100</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">quantiles</span><span class="s2">=[[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">1.05</span><span class="s2">]])</span>

    <span class="s3"># Quantile value below 0</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">quantiles</span><span class="s2">=[[-</span><span class="s5">0.05</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.75</span><span class="s2">]])</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_violinplot_single_list_quantiles</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># Ensures quantile list for 1D can be passed in as single list</span>
    <span class="s3"># First 9 digits of frac(sqrt(83))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">110433579</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">100</span><span class="s2">)]</span>

    <span class="s3"># Test image</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">quantiles</span><span class="s2">=[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">])</span>

    <span class="s3"># Reference image</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">quantiles</span><span class="s2">=[[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">]])</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_violinplot_pandas_series</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">110433579</span><span class="s2">)</span>
    <span class="s1">s1 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">7</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=[</span><span class="s5">9</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">s2 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">9</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">list</span><span class="s2">(</span><span class="s4">'ABCDEFGHI'</span><span class="s2">))</span>
    <span class="s1">s3 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">11</span><span class="s2">))</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">violinplot</span><span class="s2">([</span><span class="s1">s1</span><span class="s2">, </span><span class="s1">s2</span><span class="s2">, </span><span class="s1">s3</span><span class="s2">])</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">violinplot</span><span class="s2">([</span><span class="s1">s1</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">s2</span><span class="s2">.</span><span class="s1">values</span><span class="s2">, </span><span class="s1">s3</span><span class="s2">.</span><span class="s1">values</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_manage_xticks</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">old_xlim </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">y1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">([</span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">], </span><span class="s1">positions</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">manage_ticks</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">new_xlim </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">old_xlim</span><span class="s2">, </span><span class="s1">new_xlim</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_boxplot_not_single</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s5">100</span><span class="s2">), </span><span class="s1">positions</span><span class="s2">=[</span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s5">100</span><span class="s2">), </span><span class="s1">positions</span><span class="s2">=[</span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">2.5</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticks</span><span class="s2">()) == [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">t</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()] == [</span><span class="s4">&quot;3&quot;</span><span class="s2">, </span><span class="s4">&quot;5&quot;</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_tick_space_size_0</span><span class="s2">():</span>
    <span class="s3"># allow font size to be zero, which affects ticks when there is</span>
    <span class="s3"># no other text in the figure.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">.</span><span class="s1">update</span><span class="s2">({</span><span class="s4">'font.size'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">})</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">dpi</span><span class="s2">=</span><span class="s5">80</span><span class="s2">, </span><span class="s1">format</span><span class="s2">=</span><span class="s4">'raw'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'errorbar_basic'</span><span class="s2">, </span><span class="s4">'errorbar_mixed'</span><span class="s2">, </span><span class="s4">'errorbar_basic'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_errorbar</span><span class="s2">():</span>
    <span class="s3"># longdouble due to floating point rounding issues with certain</span>
    <span class="s3"># computer chipsets</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">longdouble</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">yerr </span><span class="s2">= </span><span class="s5">0.1 </span><span class="s2">+ </span><span class="s5">0.2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">xerr </span><span class="s2">= </span><span class="s5">0.1 </span><span class="s2">+ </span><span class="s1">yerr</span>

    <span class="s3"># First illustrate basic pyplot interface, using defaults where possible.</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">&quot;Simplest errorbars, 0.2 in x, 0.4 in y&quot;</span><span class="s2">)</span>

    <span class="s3"># Now switch to a more OO interface to exercise more features.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Vert. symmetric'</span><span class="s2">)</span>

    <span class="s3"># With 4 subplots, reduce the number of axis ticks to avoid crowding.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">locator_params</span><span class="s2">(</span><span class="s1">nbins</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Hor. symmetric w/ alpha'</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=[</span><span class="s1">yerr</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">yerr</span><span class="s2">], </span><span class="s1">xerr</span><span class="s2">=[</span><span class="s1">xerr</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">xerr</span><span class="s2">], </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'--o'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'H, V asymmetric'</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s3"># Here we have to be careful to keep all y values positive:</span>
    <span class="s1">ylower </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">maximum</span><span class="s2">(</span><span class="s5">1e-2</span><span class="s2">, </span><span class="s1">y </span><span class="s2">- </span><span class="s1">yerr</span><span class="s2">)</span>
    <span class="s1">yerr_lower </span><span class="s2">= </span><span class="s1">y </span><span class="s2">- </span><span class="s1">ylower</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=[</span><span class="s1">yerr_lower</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">yerr</span><span class="s2">], </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">,</span>
                <span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ecolor</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">capthick</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Mixed sym., log y'</span><span class="s2">)</span>
    <span class="s3"># Force limits due to floating point slop potentially expanding the range</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">1e-2</span><span class="s2">, </span><span class="s5">1e1</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s4">'Variable errorbars'</span><span class="s2">)</span>

    <span class="s3"># Reuse the first testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;x&quot;</span><span class="s2">: </span><span class="s1">x</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">: </span><span class="s1">y</span><span class="s2">}</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.4</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">&quot;Simplest errorbars, 0.2 in x, 0.4 in y&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'mixed_errorbar_polar_caps'</span><span class="s2">], </span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_mixed_errorbar_polar_caps</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Mix several polar errorbar use cases in a single test figure. 
 
    It is advisable to position individual points off the grid. If there are 
    problems with reproducibility of this test, consider removing grid. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">111</span><span class="s2">, </span><span class="s1">projection</span><span class="s2">=</span><span class="s4">'polar'</span><span class="s2">)</span>

    <span class="s3"># symmetric errorbars</span>
    <span class="s1">th_sym </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">r_sym </span><span class="s2">= [</span><span class="s5">0.9</span><span class="s2">]*</span><span class="s5">3</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">th_sym</span><span class="s2">, </span><span class="s1">r_sym</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s5">0.35</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">&quot;o&quot;</span><span class="s2">)</span>

    <span class="s3"># long errorbars</span>
    <span class="s1">th_long </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">/</span><span class="s5">2 </span><span class="s2">+ </span><span class="s5">.1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">+ </span><span class="s5">.1</span><span class="s2">]</span>
    <span class="s1">r_long </span><span class="s2">= [</span><span class="s5">1.8</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">th_long</span><span class="s2">, </span><span class="s1">r_long</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s5">0.8 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.15</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">&quot;o&quot;</span><span class="s2">)</span>

    <span class="s3"># asymmetric errorbars</span>
    <span class="s1">th_asym </span><span class="s2">= [</span><span class="s5">4</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">/</span><span class="s5">3 </span><span class="s2">+ </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">/</span><span class="s5">3 </span><span class="s2">+ </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">-</span><span class="s5">0.1</span><span class="s2">]</span>
    <span class="s1">r_asym </span><span class="s2">= [</span><span class="s5">1.1</span><span class="s2">]*</span><span class="s5">3</span>
    <span class="s1">xerr </span><span class="s2">= [[</span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.2</span><span class="s2">], [</span><span class="s5">.2</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">]]</span>
    <span class="s1">yerr </span><span class="s2">= [[</span><span class="s5">.35</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">], [</span><span class="s5">.5</span><span class="s2">, </span><span class="s5">.35</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">]]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">th_asym</span><span class="s2">, </span><span class="s1">r_asym</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">&quot;o&quot;</span><span class="s2">)</span>

    <span class="s3"># overlapping errorbar</span>
    <span class="s1">th_over </span><span class="s2">= [</span><span class="s5">2.1</span><span class="s2">]</span>
    <span class="s1">r_over </span><span class="s2">= [</span><span class="s5">3.1</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">th_over</span><span class="s2">, </span><span class="s1">r_over</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">.2</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">&quot;o&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_errorbar_colorcycle</span><span class="s2">():</span>

    <span class="s1">f</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s5">2</span><span class="s2">*</span><span class="s1">x</span>

    <span class="s1">e1</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">e2</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">ln1</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s5">4</span><span class="s2">*</span><span class="s1">y</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s1">e1</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">()) == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">'C0'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s1">e2</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">()) == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">'C1'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s1">ln1</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">()) == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">'C2'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_errorbar_cycle_ecolor</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">+</span><span class="s1">n</span><span class="s2">) </span><span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)]</span>

    <span class="s1">axt </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">axr </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s0">for </span><span class="s1">yi</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s4">'C0'</span><span class="s2">, </span><span class="s4">'C1'</span><span class="s2">, </span><span class="s4">'C2'</span><span class="s2">, </span><span class="s4">'C3'</span><span class="s2">]):</span>
        <span class="s1">axt</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">yi</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=(</span><span class="s1">yi </span><span class="s2">* </span><span class="s5">0.25</span><span class="s2">), </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">,</span>
                     <span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ecolor</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">)</span>
        <span class="s1">axr</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">yi</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=(</span><span class="s1">yi </span><span class="s2">* </span><span class="s5">0.25</span><span class="s2">), </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">,</span>
                     <span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">, </span><span class="s1">ecolor</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_errorbar_shape</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">yerr1 </span><span class="s2">= </span><span class="s5">0.1 </span><span class="s2">+ </span><span class="s5">0.2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">yerr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">vstack</span><span class="s2">((</span><span class="s1">yerr1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">yerr1</span><span class="s2">)).</span><span class="s1">T</span>
    <span class="s1">xerr </span><span class="s2">= </span><span class="s5">0.1 </span><span class="s2">+ </span><span class="s1">yerr</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'errorbar_limits'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_limits</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">xerr </span><span class="s2">= </span><span class="s5">0.1</span>
    <span class="s1">yerr </span><span class="s2">= </span><span class="s5">0.2</span>
    <span class="s1">ls </span><span class="s2">= </span><span class="s4">'dotted'</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s3"># standard error bars</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">)</span>

    <span class="s3"># including upper limits</span>
    <span class="s1">uplims </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">uplims</span><span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">9</span><span class="s2">]] = </span><span class="s0">True</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">+</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">uplims</span><span class="s2">=</span><span class="s1">uplims</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">,</span>
                <span class="s1">color</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">)</span>

    <span class="s3"># including lower limits</span>
    <span class="s1">lolims </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">lolims</span><span class="s2">[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">]] = </span><span class="s0">True</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">+</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">lolims</span><span class="s2">=</span><span class="s1">lolims</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">,</span>
                <span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">)</span>

    <span class="s3"># including upper and lower limits</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">+</span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">8</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">,</span>
                <span class="s1">lolims</span><span class="s2">=</span><span class="s1">lolims</span><span class="s2">, </span><span class="s1">uplims</span><span class="s2">=</span><span class="s1">uplims</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'magenta'</span><span class="s2">)</span>

    <span class="s3"># including xlower and xupper limits</span>
    <span class="s1">xerr </span><span class="s2">= </span><span class="s5">0.2</span>
    <span class="s1">yerr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">)</span>
    <span class="s1">yerr</span><span class="s2">[[</span><span class="s5">3</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]] = </span><span class="s5">0.3</span>
    <span class="s1">xlolims </span><span class="s2">= </span><span class="s1">lolims</span>
    <span class="s1">xuplims </span><span class="s2">= </span><span class="s1">uplims</span>
    <span class="s1">lolims </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">uplims </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">lolims</span><span class="s2">[[</span><span class="s5">6</span><span class="s2">]] = </span><span class="s0">True</span>
    <span class="s1">uplims</span><span class="s2">[[</span><span class="s5">3</span><span class="s2">]] = </span><span class="s0">True</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">+</span><span class="s5">2.1</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s5">8</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s1">xerr</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">,</span>
                <span class="s1">xlolims</span><span class="s2">=</span><span class="s1">xlolims</span><span class="s2">, </span><span class="s1">xuplims</span><span class="s2">=</span><span class="s1">xuplims</span><span class="s2">, </span><span class="s1">uplims</span><span class="s2">=</span><span class="s1">uplims</span><span class="s2">,</span>
                <span class="s1">lolims</span><span class="s2">=</span><span class="s1">lolims</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">mec</span><span class="s2">=</span><span class="s4">'blue'</span><span class="s2">, </span><span class="s1">capsize</span><span class="s2">=</span><span class="s5">0</span><span class="s2">,</span>
                <span class="s1">color</span><span class="s2">=</span><span class="s4">'cyan'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5.5</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Errorbar upper and lower limits'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_errorbar_nonefmt</span><span class="s2">():</span>
    <span class="s3"># Check that passing 'none' as a format still plots errorbars</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">plotline</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">barlines </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">plotline </span><span class="s0">is None</span>
    <span class="s0">for </span><span class="s1">errbar </span><span class="s0">in </span><span class="s1">barlines</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">errbar</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">'C0'</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_errorbar_line_specific_kwargs</span><span class="s2">():</span>
    <span class="s3"># Check that passing line-specific keyword arguments will not result in</span>
    <span class="s3"># errors.</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">plotline</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'None'</span><span class="s2">,</span>
                                  <span class="s1">marker</span><span class="s2">=</span><span class="s4">'s'</span><span class="s2">, </span><span class="s1">fillstyle</span><span class="s2">=</span><span class="s4">'full'</span><span class="s2">,</span>
                                  <span class="s1">drawstyle</span><span class="s2">=</span><span class="s4">'steps-mid'</span><span class="s2">,</span>
                                  <span class="s1">dash_capstyle</span><span class="s2">=</span><span class="s4">'round'</span><span class="s2">,</span>
                                  <span class="s1">dash_joinstyle</span><span class="s2">=</span><span class="s4">'miter'</span><span class="s2">,</span>
                                  <span class="s1">solid_capstyle</span><span class="s2">=</span><span class="s4">'butt'</span><span class="s2">,</span>
                                  <span class="s1">solid_joinstyle</span><span class="s2">=</span><span class="s4">'bevel'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">plotline</span><span class="s2">.</span><span class="s1">get_fillstyle</span><span class="s2">() == </span><span class="s4">'full'</span>
    <span class="s0">assert </span><span class="s1">plotline</span><span class="s2">.</span><span class="s1">get_drawstyle</span><span class="s2">() == </span><span class="s4">'steps-mid'</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_with_prop_cycle</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">,</span>
                <span class="s1">ls</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'s'</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'tab:green'</span><span class="s2">,</span>
                <span class="s1">ls</span><span class="s2">=</span><span class="s4">':'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'s'</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">'y'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'tab:blue'</span><span class="s2">,</span>
                <span class="s1">ls</span><span class="s2">=</span><span class="s4">'-.'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">'c'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">11</span><span class="s2">)</span>

    <span class="s1">_cycle </span><span class="s2">= </span><span class="s1">cycler</span><span class="s2">(</span><span class="s1">ls</span><span class="s2">=[</span><span class="s4">'--'</span><span class="s2">, </span><span class="s4">':'</span><span class="s2">, </span><span class="s4">'-.'</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=[</span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">],</span>
                    <span class="s1">mfc</span><span class="s2">=[</span><span class="s4">'k'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'c'</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=[</span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'g'</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rc</span><span class="s2">(</span><span class="s4">&quot;axes&quot;</span><span class="s2">, </span><span class="s1">prop_cycle</span><span class="s2">=</span><span class="s1">_cycle</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'tab:green'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'tab:blue'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">11</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_errorbar_every_invalid</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">15</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">x </span><span class="s2">* (</span><span class="s5">1</span><span class="s2">-</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">yerr </span><span class="s2">= </span><span class="s1">y</span><span class="s2">/</span><span class="s5">6</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'not a tuple of two integers'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">errorevery</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'not a tuple of two integers'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">errorevery</span><span class="s2">=(</span><span class="s5">1.3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'not a valid NumPy fancy index'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">errorevery</span><span class="s2">=[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'not a recognized value'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">errorevery</span><span class="s2">=</span><span class="s4">'foobar'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_xerr_yerr_not_negative</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'xerr' must not contain negative values&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">xerr</span><span class="s2">=[[-</span><span class="s5">0.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]], </span><span class="s1">yerr</span><span class="s2">=[[-</span><span class="s5">0.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'xerr' must not contain negative values&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">xerr</span><span class="s2">=[[-</span><span class="s5">0.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'yerr' must not contain negative values&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=[[-</span><span class="s5">0.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'yerr' must not contain negative values&quot;</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2021</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s1">i </span><span class="s2">* </span><span class="s5">2 </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">x</span><span class="s2">]</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s1">x</span><span class="s2">,</span>
                    <span class="s1">y</span><span class="s2">=</span><span class="s1">y</span><span class="s2">,</span>
                    <span class="s1">yerr</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=-</span><span class="s5">10</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_xerr_yerr_not_none</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'xerr' must not contain None&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">xerr</span><span class="s2">=[[</span><span class="s0">None</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]], </span><span class="s1">yerr</span><span class="s2">=[[</span><span class="s0">None</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'xerr' must not contain None&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">xerr</span><span class="s2">=[[</span><span class="s0">None</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'yerr' must not contain None&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">y</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=[[</span><span class="s0">None</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]])</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_errorbar_every</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">15</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">x </span><span class="s2">* (</span><span class="s5">1</span><span class="s2">-</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">yerr </span><span class="s2">= </span><span class="s1">y</span><span class="s2">/</span><span class="s5">6</span>

    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s0">for </span><span class="s1">color</span><span class="s2">, </span><span class="s1">shift </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s4">'rgbk'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]):</span>
        <span class="s1">y </span><span class="s2">+= </span><span class="s5">.02</span>

        <span class="s3"># Check errorevery using an explicit offset and step.</span>
        <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">errorevery</span><span class="s2">=(</span><span class="s1">shift</span><span class="s2">, </span><span class="s5">4</span><span class="s2">),</span>
                         <span class="s1">capsize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">)</span>

        <span class="s3"># Using manual errorbars</span>
        <span class="s3"># n.b. errorbar draws the main plot at z=2.1 by default</span>
        <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">2.1</span><span class="s2">)</span>
        <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s1">shift</span><span class="s2">::</span><span class="s5">4</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[</span><span class="s1">shift</span><span class="s2">::</span><span class="s5">4</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">[</span><span class="s1">shift</span><span class="s2">::</span><span class="s5">4</span><span class="s2">],</span>
                        <span class="s1">capsize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">)</span>

    <span class="s3"># Check that markevery is propagated to line, without affecting errorbars.</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s5">0.1</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">markevery</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">), </span><span class="s1">capsize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">::</span><span class="s5">4</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[</span><span class="s5">1</span><span class="s2">::</span><span class="s5">4</span><span class="s2">] + </span><span class="s5">0.1</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">2.1</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s5">0.1</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">capsize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">)</span>

    <span class="s3"># Check that passing a slice to markevery/errorevery works.</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">errorevery</span><span class="s2">=</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
                     <span class="s1">markevery</span><span class="s2">=</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s5">3</span><span class="s2">),</span>
                     <span class="s1">capsize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'C0'</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s5">2</span><span class="s2">::</span><span class="s5">3</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[</span><span class="s5">2</span><span class="s2">::</span><span class="s5">3</span><span class="s2">] + </span><span class="s5">0.2</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'C0'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">2.1</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s5">2</span><span class="s2">::</span><span class="s5">3</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[</span><span class="s5">2</span><span class="s2">::</span><span class="s5">3</span><span class="s2">] + </span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">[</span><span class="s5">2</span><span class="s2">::</span><span class="s5">3</span><span class="s2">],</span>
                    <span class="s1">capsize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'C0'</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">)</span>

    <span class="s3"># Check that passing an iterable to markevery/errorevery works.</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">errorevery</span><span class="s2">=[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">] * </span><span class="s5">5</span><span class="s2">,</span>
                     <span class="s1">markevery</span><span class="s2">=[</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">] * </span><span class="s5">5</span><span class="s2">,</span>
                     <span class="s1">capsize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">::</span><span class="s5">3</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[</span><span class="s5">1</span><span class="s2">::</span><span class="s5">3</span><span class="s2">] + </span><span class="s5">0.2</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">2.1</span><span class="s2">)</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s5">1</span><span class="s2">::</span><span class="s5">3</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[</span><span class="s5">1</span><span class="s2">::</span><span class="s5">3</span><span class="s2">] + </span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">[</span><span class="s5">1</span><span class="s2">::</span><span class="s5">3</span><span class="s2">],</span>
                    <span class="s1">capsize</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'elinewidth'</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">],</span>
                                        <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]),</span>
                                        <span class="s5">1</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_linewidth_type</span><span class="s2">(</span><span class="s1">elinewidth</span><span class="s2">):</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">elinewidth</span><span class="s2">=</span><span class="s1">elinewidth</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_errorbar_nan</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">xs </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">ys </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">es </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">6</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">, </span><span class="s1">ys</span><span class="s2">, </span><span class="s1">es</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">([</span><span class="s5">4</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">], [</span><span class="s5">6</span><span class="s2">], </span><span class="s1">fmt</span><span class="s2">=</span><span class="s4">&quot;C0&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_stacked_stepfilled'</span><span class="s2">, </span><span class="s4">'hist_stacked_stepfilled'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_stepfilled</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">((</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">), </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;stepfilled&quot;</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;x&quot;</span><span class="s2">: (</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">)}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;stepfilled&quot;</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_offset'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_offset</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">d2</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">15</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_step.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hist_step</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;step&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_step_horiz.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_step_horiz</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">((</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">), </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;step&quot;</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s4">&quot;horizontal&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_stacked_weights'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_weighted</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">w1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0.01</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>
    <span class="s1">w2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0.05</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">((</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">), </span><span class="s1">weights</span><span class="s2">=(</span><span class="s1">w1</span><span class="s2">, </span><span class="s1">w2</span><span class="s2">), </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;stepfilled&quot;</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'stem.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_stem</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># Label is a single space to force a legend to be drawn, but to avoid any</span>
    <span class="s3"># text being drawn</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
            <span class="s1">linefmt</span><span class="s2">=</span><span class="s4">'C2-.'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'k+'</span><span class="s2">, </span><span class="s1">basefmt</span><span class="s2">=</span><span class="s4">'C1-.'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">' '</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_stem_args</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test that stem() correctly identifies x and y values.&quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">stem_container</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">map</span><span class="s2">(</span><span class="s1">list</span><span class="s2">, </span><span class="s1">stem_container</span><span class="s2">.</span><span class="s1">markerline</span><span class="s2">.</span><span class="s1">get_data</span><span class="s2">())</span>
        <span class="s0">assert </span><span class="s1">x </span><span class="s2">== </span><span class="s1">expected</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">y </span><span class="s2">== </span><span class="s1">expected</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s5">9</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>

    <span class="s3"># Test the call signatures</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">=([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">y</span><span class="s2">))</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">=(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">linefmt</span><span class="s2">=</span><span class="s4">'r--'</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">=(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'r--'</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">=(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">linefmt</span><span class="s2">=</span><span class="s4">'r--'</span><span class="s2">, </span><span class="s1">basefmt</span><span class="s2">=</span><span class="s4">'b--'</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">=(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">))</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">linefmt</span><span class="s2">=</span><span class="s4">'r--'</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">=([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">y</span><span class="s2">))</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s4">'r--'</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">=([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">y</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_stem_markerfmt</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test that stem(..., markerfmt=...) produces the intended markers.&quot;&quot;&quot;</span>
    <span class="s0">def </span><span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">stem_container</span><span class="s2">, </span><span class="s1">linecolor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
                      <span class="s1">marker</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot; 
        Check that the given StemContainer has the properties listed as 
        keyword-arguments. 
        &quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">linecolor </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span>
                <span class="s1">stem_container</span><span class="s2">.</span><span class="s1">stemlines</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(),</span>
                <span class="s1">linecolor</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">markercolor </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span>
                <span class="s1">stem_container</span><span class="s2">.</span><span class="s1">markerline</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(),</span>
                <span class="s1">markercolor</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">marker </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">stem_container</span><span class="s2">.</span><span class="s1">markerline</span><span class="s2">.</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s1">marker</span>
        <span class="s0">assert </span><span class="s1">stem_container</span><span class="s2">.</span><span class="s1">markerline</span><span class="s2">.</span><span class="s1">get_linestyle</span><span class="s2">() == </span><span class="s4">'None'</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s5">9</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>

    <span class="s3"># no linefmt</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">), </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'C0'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">), </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'C0'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'rx'</span><span class="s2">), </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">)</span>

    <span class="s3"># positional linefmt</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">),  </span><span class="s3"># marker color follows linefmt if not given</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'rx'</span><span class="s2">),  </span><span class="s3"># the marker is currently not taken from linefmt</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">),  </span><span class="s3"># only marker type specified</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">),  </span><span class="s3"># only marker color specified</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'gx'</span><span class="s2">),  </span><span class="s3"># marker type and color specified</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">' '</span><span class="s2">),  </span><span class="s3"># markerfmt=' ' for no marker</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'None'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">''</span><span class="s2">),  </span><span class="s3"># markerfmt='' for no marker</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'None'</span><span class="s2">)</span>

    <span class="s3"># with linefmt kwarg</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">linefmt</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">),</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">linefmt</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">),</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">)</span>
    <span class="s1">_assert_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">linefmt</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'gx'</span><span class="s2">),</span>
        <span class="s1">linecolor</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">markercolor</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_stem_dates</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">xs </span><span class="s2">= [</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s4">&quot;2013-9-28 11:00:00&quot;</span><span class="s2">),</span>
          <span class="s1">dateutil</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s4">&quot;2013-9-28 12:00:00&quot;</span><span class="s2">)]</span>
    <span class="s1">ys </span><span class="s2">= [</span><span class="s5">100</span><span class="s2">, </span><span class="s5">200</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">, </span><span class="s1">ys</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'stem_orientation.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_stem_orientation</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stem</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">),</span>
            <span class="s1">linefmt</span><span class="s2">=</span><span class="s4">'C2-.'</span><span class="s2">, </span><span class="s1">markerfmt</span><span class="s2">=</span><span class="s4">'kx'</span><span class="s2">, </span><span class="s1">basefmt</span><span class="s2">=</span><span class="s4">'C1-.'</span><span class="s2">,</span>
            <span class="s1">orientation</span><span class="s2">=</span><span class="s4">'horizontal'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_stacked_stepfilled_alpha'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_stepfilled_alpha</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">((</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">), </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;stepfilled&quot;</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_stacked_step'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_step</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">((</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">), </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;step&quot;</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_stacked_normed'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_density</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">50</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">((</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">), </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_step_bottom.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hist_step_bottom</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;stepfilled&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_step_geometry</span><span class="s2">():</span>
    <span class="s1">bins </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">top </span><span class="s2">= [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]</span>
    <span class="s1">bottom </span><span class="s2">= [[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]</span>

    <span class="s0">for </span><span class="s1">histtype</span><span class="s2">, </span><span class="s1">xy </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">'step'</span><span class="s2">, </span><span class="s1">top</span><span class="s2">), (</span><span class="s4">'stepfilled'</span><span class="s2">, </span><span class="s1">top </span><span class="s2">+ </span><span class="s1">bottom</span><span class="s2">)]:</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, (</span><span class="s1">polygon</span><span class="s2">, ) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s1">histtype</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">polygon</span><span class="s2">.</span><span class="s1">get_xy</span><span class="s2">(), </span><span class="s1">xy</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_step_bottom_geometry</span><span class="s2">():</span>
    <span class="s1">bins </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">top </span><span class="s2">= [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">]]</span>
    <span class="s1">bottom </span><span class="s2">= [[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]</span>

    <span class="s0">for </span><span class="s1">histtype</span><span class="s2">, </span><span class="s1">xy </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">'step'</span><span class="s2">, </span><span class="s1">top</span><span class="s2">), (</span><span class="s4">'stepfilled'</span><span class="s2">, </span><span class="s1">top </span><span class="s2">+ </span><span class="s1">bottom</span><span class="s2">)]:</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, (</span><span class="s1">polygon</span><span class="s2">, ) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">],</span>
                                     <span class="s1">histtype</span><span class="s2">=</span><span class="s1">histtype</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">polygon</span><span class="s2">.</span><span class="s1">get_xy</span><span class="s2">(), </span><span class="s1">xy</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_stacked_step_geometry</span><span class="s2">():</span>
    <span class="s1">bins </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">data_1 </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">data_2 </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">tops </span><span class="s2">= [</span>
        <span class="s2">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]],</span>
        <span class="s2">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]],</span>
    <span class="s2">]</span>
    <span class="s1">bottoms </span><span class="s2">= [</span>
        <span class="s2">[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]],</span>
        <span class="s2">[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]],</span>
    <span class="s2">]</span>
    <span class="s1">combined </span><span class="s2">= [</span><span class="s1">t </span><span class="s2">+ </span><span class="s1">b </span><span class="s0">for </span><span class="s1">t</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">tops</span><span class="s2">, </span><span class="s1">bottoms</span><span class="s2">)]</span>

    <span class="s0">for </span><span class="s1">histtype</span><span class="s2">, </span><span class="s1">xy </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">'step'</span><span class="s2">, </span><span class="s1">tops</span><span class="s2">), (</span><span class="s4">'stepfilled'</span><span class="s2">, </span><span class="s1">combined</span><span class="s2">)]:</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">patches </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s1">data_1</span><span class="s2">, </span><span class="s1">data_2</span><span class="s2">], </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                 <span class="s1">histtype</span><span class="s2">=</span><span class="s1">histtype</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">patches</span><span class="s2">) == </span><span class="s5">2</span>
        <span class="s1">polygon</span><span class="s2">, = </span><span class="s1">patches</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">polygon</span><span class="s2">.</span><span class="s1">get_xy</span><span class="s2">(), </span><span class="s1">xy</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
        <span class="s1">polygon</span><span class="s2">, = </span><span class="s1">patches</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">polygon</span><span class="s2">.</span><span class="s1">get_xy</span><span class="s2">(), </span><span class="s1">xy</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_hist_stacked_step_bottom_geometry</span><span class="s2">():</span>
    <span class="s1">bins </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">data_1 </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">data_2 </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">tops </span><span class="s2">= [</span>
        <span class="s2">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">]],</span>
        <span class="s2">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">]],</span>
    <span class="s2">]</span>
    <span class="s1">bottoms </span><span class="s2">= [</span>
        <span class="s2">[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]],</span>
        <span class="s2">[[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]],</span>
    <span class="s2">]</span>
    <span class="s1">combined </span><span class="s2">= [</span><span class="s1">t </span><span class="s2">+ </span><span class="s1">b </span><span class="s0">for </span><span class="s1">t</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">tops</span><span class="s2">, </span><span class="s1">bottoms</span><span class="s2">)]</span>

    <span class="s0">for </span><span class="s1">histtype</span><span class="s2">, </span><span class="s1">xy </span><span class="s0">in </span><span class="s2">[(</span><span class="s4">'step'</span><span class="s2">, </span><span class="s1">tops</span><span class="s2">), (</span><span class="s4">'stepfilled'</span><span class="s2">, </span><span class="s1">combined</span><span class="s2">)]:</span>
        <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">patches </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s1">data_1</span><span class="s2">, </span><span class="s1">data_2</span><span class="s2">], </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">stacked</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                                 <span class="s1">bottom</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">], </span><span class="s1">histtype</span><span class="s2">=</span><span class="s1">histtype</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">patches</span><span class="s2">) == </span><span class="s5">2</span>
        <span class="s1">polygon</span><span class="s2">, = </span><span class="s1">patches</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">polygon</span><span class="s2">.</span><span class="s1">get_xy</span><span class="s2">(), </span><span class="s1">xy</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
        <span class="s1">polygon</span><span class="s2">, = </span><span class="s1">patches</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">polygon</span><span class="s2">.</span><span class="s1">get_xy</span><span class="s2">(), </span><span class="s1">xy</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hist_stacked_bar'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hist_stacked_bar</span><span class="s2">():</span>
    <span class="s3"># make some data</span>
    <span class="s1">d </span><span class="s2">= [[</span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">320</span><span class="s2">, </span><span class="s5">450</span><span class="s2">, </span><span class="s5">80</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">600</span><span class="s2">, </span><span class="s5">310</span><span class="s2">, </span><span class="s5">800</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s5">20</span><span class="s2">, </span><span class="s5">23</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s5">11</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">420</span><span class="s2">], [</span><span class="s5">120</span><span class="s2">, </span><span class="s5">120</span><span class="s2">, </span><span class="s5">120</span><span class="s2">, </span><span class="s5">140</span><span class="s2">, </span><span class="s5">140</span><span class="s2">, </span><span class="s5">150</span><span class="s2">, </span><span class="s5">180</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s5">60</span><span class="s2">, </span><span class="s5">60</span><span class="s2">, </span><span class="s5">60</span><span class="s2">, </span><span class="s5">60</span><span class="s2">, </span><span class="s5">300</span><span class="s2">, </span><span class="s5">300</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">300</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s5">555</span><span class="s2">, </span><span class="s5">555</span><span class="s2">, </span><span class="s5">555</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">400</span><span class="s2">, </span><span class="s5">400</span><span class="s2">, </span><span class="s5">400</span><span class="s2">, </span><span class="s5">400</span><span class="s2">, </span><span class="s5">400</span><span class="s2">, </span><span class="s5">400</span><span class="s2">, </span><span class="s5">400</span><span class="s2">, </span><span class="s5">400</span><span class="s2">]]</span>
    <span class="s1">colors </span><span class="s2">= [(</span><span class="s5">0.5759849696758961</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">), (</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.350624650815206</span><span class="s2">),</span>
              <span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">0.6549834156005998</span><span class="s2">), (</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.6569064625276622</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">),</span>
              <span class="s2">(</span><span class="s5">0.28302699607823545</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">), (</span><span class="s5">0.6849123462299822</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">)]</span>
    <span class="s1">labels </span><span class="s2">= [</span><span class="s4">'green'</span><span class="s2">, </span><span class="s4">'orange'</span><span class="s2">, </span><span class="s4">' yellow'</span><span class="s2">, </span><span class="s4">'magenta'</span><span class="s2">, </span><span class="s4">'black'</span><span class="s2">]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">'barstacked'</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s4">'mid'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">label</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'upper right'</span><span class="s2">, </span><span class="s1">bbox_to_anchor</span><span class="s2">=(</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">), </span><span class="s1">ncols</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_barstacked_bottom_unchanged</span><span class="s2">():</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]], </span><span class="s5">2</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;barstacked&quot;</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s1">b</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">b</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() == [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_hist_emptydata</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([[], </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)], </span><span class="s1">histtype</span><span class="s2">=</span><span class="s4">&quot;step&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_labels</span><span class="s2">():</span>
    <span class="s3"># test singleton labels OK</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">bars</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_label</span><span class="s2">() == </span><span class="s4">'0'</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">bars</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_label</span><span class="s2">() == </span><span class="s4">'0'</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">bars</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_label</span><span class="s2">() == </span><span class="s4">'_nolegend_'</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'0'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">bars</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_label</span><span class="s2">() == </span><span class="s4">'0'</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'00'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">bars</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_label</span><span class="s2">() == </span><span class="s4">'00'</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'transparent_markers'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_transparent_markers</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s5">50</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">markersize</span><span class="s2">=</span><span class="s5">100</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'rgba_markers'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_rgba_markers</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">ncols</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">rcolors </span><span class="s2">= [(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)]</span>
    <span class="s1">bcolors </span><span class="s2">= [(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)]</span>
    <span class="s1">alphas </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">]</span>
    <span class="s1">kw </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">ms</span><span class="s2">=</span><span class="s5">100</span><span class="s2">, </span><span class="s1">mew</span><span class="s2">=</span><span class="s5">20</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">alpha </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">alphas</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">rcolor </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">rcolors</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">k</span><span class="s2">, </span><span class="s1">bcolor </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">bcolors</span><span class="s2">):</span>
                <span class="s1">axs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">j</span><span class="s2">+</span><span class="s5">1</span><span class="s2">, </span><span class="s1">k</span><span class="s2">+</span><span class="s5">1</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s1">bcolor</span><span class="s2">, </span><span class="s1">mec</span><span class="s2">=</span><span class="s1">rcolor</span><span class="s2">,</span>
                            <span class="s1">alpha</span><span class="s2">=</span><span class="s1">alpha</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
                <span class="s1">axs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">j</span><span class="s2">+</span><span class="s5">1</span><span class="s2">, </span><span class="s1">k</span><span class="s2">+</span><span class="s5">3</span><span class="s2">, </span><span class="s4">'x'</span><span class="s2">, </span><span class="s1">mec</span><span class="s2">=</span><span class="s1">rcolor</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s1">alpha</span><span class="s2">, **</span><span class="s1">kw</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'mollweide_grid'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_mollweide_grid</span><span class="s2">():</span>
    <span class="s3"># test that both horizontal and vertical gridlines appear on the Mollweide</span>
    <span class="s3"># projection</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">projection</span><span class="s2">=</span><span class="s4">'mollweide'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_mollweide_forward_inverse_closure</span><span class="s2">():</span>
    <span class="s3"># test that the round-trip Mollweide forward-&gt;inverse transformation is an</span>
    <span class="s3"># approximate identity</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">projection</span><span class="s2">=</span><span class="s4">'mollweide'</span><span class="s2">)</span>

    <span class="s3"># set up 1-degree grid in longitude, latitude</span>
    <span class="s1">lon </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s5">360</span><span class="s2">)</span>
    <span class="s3"># The poles are degenerate and thus sensitive to floating point precision errors</span>
    <span class="s1">lat </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s5">2.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">180</span><span class="s2">)[</span><span class="s5">1</span><span class="s2">:-</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">lon</span><span class="s2">, </span><span class="s1">lat </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">lon</span><span class="s2">, </span><span class="s1">lat</span><span class="s2">)</span>
    <span class="s1">ll </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">vstack</span><span class="s2">((</span><span class="s1">lon</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">(), </span><span class="s1">lat</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">())).</span><span class="s1">T</span>

    <span class="s3"># perform forward transform</span>
    <span class="s1">xy </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transProjection</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">ll</span><span class="s2">)</span>

    <span class="s3"># perform inverse transform</span>
    <span class="s1">ll2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transProjection</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">().</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">xy</span><span class="s2">)</span>

    <span class="s3"># compare</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">ll</span><span class="s2">, </span><span class="s1">ll2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_mollweide_inverse_forward_closure</span><span class="s2">():</span>
    <span class="s3"># test that the round-trip Mollweide inverse-&gt;forward transformation is an</span>
    <span class="s3"># approximate identity</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">projection</span><span class="s2">=</span><span class="s4">'mollweide'</span><span class="s2">)</span>

    <span class="s3"># set up grid in x, y</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">500</span><span class="s2">)</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">xy </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">vstack</span><span class="s2">((</span><span class="s1">x</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">(), </span><span class="s1">y</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">())).</span><span class="s1">T</span>

    <span class="s3"># perform inverse transform</span>
    <span class="s1">ll </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transProjection</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">().</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">xy</span><span class="s2">)</span>

    <span class="s3"># perform forward transform</span>
    <span class="s1">xy2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transProjection</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">ll</span><span class="s2">)</span>

    <span class="s3"># compare</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">xy</span><span class="s2">, </span><span class="s1">xy2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'test_alpha'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_alpha</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s5">50</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s3"># alpha=.5 markers, solid line</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s4">'-D'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s1">mfc</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">],</span>
            <span class="s1">markersize</span><span class="s2">=</span><span class="s5">20</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>

    <span class="s3"># everything solid by kwarg</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">, </span><span class="s4">'-D'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">], </span><span class="s1">mfc</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">],</span>
            <span class="s1">markersize</span><span class="s2">=</span><span class="s5">20</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">,</span>
            <span class="s1">alpha</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>

    <span class="s3"># everything alpha=.5 by kwarg</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data </span><span class="s2">+ </span><span class="s5">4</span><span class="s2">, </span><span class="s4">'-D'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s1">mfc</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
            <span class="s1">markersize</span><span class="s2">=</span><span class="s5">20</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">,</span>
            <span class="s1">alpha</span><span class="s2">=</span><span class="s5">.5</span><span class="s2">)</span>

    <span class="s3"># everything alpha=.5 by colors</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data </span><span class="s2">+ </span><span class="s5">6</span><span class="s2">, </span><span class="s4">'-D'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">], </span><span class="s1">mfc</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">],</span>
            <span class="s1">markersize</span><span class="s2">=</span><span class="s5">20</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>

    <span class="s3"># alpha=.5 line, solid markers</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data </span><span class="s2">+ </span><span class="s5">8</span><span class="s2">, </span><span class="s4">'-D'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">], </span><span class="s1">mfc</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
            <span class="s1">markersize</span><span class="s2">=</span><span class="s5">20</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'eventplot'</span><span class="s2">, </span><span class="s4">'eventplot'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_eventplot</span><span class="s2">():</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>

    <span class="s1">data1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">([</span><span class="s5">32</span><span class="s2">, </span><span class="s5">20</span><span class="s2">]).</span><span class="s1">tolist</span><span class="s2">()</span>
    <span class="s1">data2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">([</span><span class="s5">6</span><span class="s2">, </span><span class="s5">20</span><span class="s2">]).</span><span class="s1">tolist</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">data1 </span><span class="s2">+ </span><span class="s1">data2</span>
    <span class="s1">num_datasets </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>

    <span class="s1">colors1 </span><span class="s2">= [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">.7</span><span class="s2">]] * </span><span class="s1">len</span><span class="s2">(</span><span class="s1">data1</span><span class="s2">)</span>
    <span class="s1">colors2 </span><span class="s2">= [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">.75</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
               <span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]]</span>
    <span class="s1">colors </span><span class="s2">= </span><span class="s1">colors1 </span><span class="s2">+ </span><span class="s1">colors2</span>

    <span class="s1">lineoffsets1 </span><span class="s2">= </span><span class="s5">12 </span><span class="s2">+ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">data1</span><span class="s2">)) * </span><span class="s5">.33</span>
    <span class="s1">lineoffsets2 </span><span class="s2">= [-</span><span class="s5">15</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">lineoffsets </span><span class="s2">= </span><span class="s1">lineoffsets1</span><span class="s2">.</span><span class="s1">tolist</span><span class="s2">() + </span><span class="s1">lineoffsets2</span>

    <span class="s1">linelengths1 </span><span class="s2">= [</span><span class="s5">.33</span><span class="s2">] * </span><span class="s1">len</span><span class="s2">(</span><span class="s1">data1</span><span class="s2">)</span>
    <span class="s1">linelengths2 </span><span class="s2">= [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">]</span>
    <span class="s1">linelengths </span><span class="s2">= </span><span class="s1">linelengths1 </span><span class="s2">+ </span><span class="s1">linelengths2</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">axobj </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">colls </span><span class="s2">= </span><span class="s1">axobj</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">, </span><span class="s1">lineoffsets</span><span class="s2">=</span><span class="s1">lineoffsets</span><span class="s2">,</span>
                            <span class="s1">linelengths</span><span class="s2">=</span><span class="s1">linelengths</span><span class="s2">)</span>

    <span class="s1">num_collections </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">colls</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">num_collections </span><span class="s2">== </span><span class="s1">num_datasets</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;pos&quot;</span><span class="s2">: </span><span class="s1">data</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">: </span><span class="s1">colors</span><span class="s2">, </span><span class="s4">&quot;lo&quot;</span><span class="s2">: </span><span class="s1">lineoffsets</span><span class="s2">, </span><span class="s4">&quot;ll&quot;</span><span class="s2">: </span><span class="s1">linelengths</span><span class="s2">}</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">axobj </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">colls </span><span class="s2">= </span><span class="s1">axobj</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(</span><span class="s4">&quot;pos&quot;</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s1">lineoffsets</span><span class="s2">=</span><span class="s4">&quot;lo&quot;</span><span class="s2">,</span>
                            <span class="s1">linelengths</span><span class="s2">=</span><span class="s4">&quot;ll&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">num_collections </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">colls</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">num_collections </span><span class="s2">== </span><span class="s1">num_datasets</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'test_eventplot_defaults.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_eventplot_defaults</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    test that eventplot produces the correct output given the default params 
    (see bug #3728) 
    &quot;&quot;&quot;</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>

    <span class="s1">data1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">([</span><span class="s5">32</span><span class="s2">, </span><span class="s5">20</span><span class="s2">]).</span><span class="s1">tolist</span><span class="s2">()</span>
    <span class="s1">data2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">([</span><span class="s5">6</span><span class="s2">, </span><span class="s5">20</span><span class="s2">]).</span><span class="s1">tolist</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">data1 </span><span class="s2">+ </span><span class="s1">data2</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">axobj </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">axobj</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">((</span><span class="s4">'colors'</span><span class="s2">), [</span>
    <span class="s2">(</span><span class="s4">'0.5'</span><span class="s2">,),  </span><span class="s3"># string color with multiple characters: not OK before #8193 fix</span>
    <span class="s2">(</span><span class="s4">'tab:orange'</span><span class="s2">, </span><span class="s4">'tab:pink'</span><span class="s2">, </span><span class="s4">'tab:cyan'</span><span class="s2">, </span><span class="s4">'bLacK'</span><span class="s2">),  </span><span class="s3"># case-insensitive</span>
    <span class="s2">(</span><span class="s4">'red'</span><span class="s2">, (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s0">None</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)),  </span><span class="s3"># a tricky case mixing types</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_eventplot_colors</span><span class="s2">(</span><span class="s1">colors</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Test the *colors* parameter of eventplot. Inspired by issue #8193.&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= [[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">]]  </span><span class="s3"># 4 successive events of different nature</span>

    <span class="s3"># Build the list of the expected colors</span>
    <span class="s1">expected </span><span class="s2">= [</span><span class="s1">c </span><span class="s0">if </span><span class="s1">c </span><span class="s0">is not None else </span><span class="s4">'C0' </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">colors</span><span class="s2">]</span>
    <span class="s3"># Convert the list into an array of RGBA values</span>
    <span class="s3"># NB: ['rgbk'] is not a valid argument for to_rgba_array, while 'rgbk' is.</span>
    <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">) == </span><span class="s5">1</span><span class="s2">:</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">broadcast_to</span><span class="s2">(</span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba_array</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">), (</span><span class="s1">len</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s5">4</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">colors</span><span class="s2">) == </span><span class="s5">1</span><span class="s2">:  </span><span class="s3"># tuple with a single string (like '0.5' or 'rgbk')</span>
        <span class="s1">colors </span><span class="s2">= </span><span class="s1">colors</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">collections </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">coll</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">collections</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">coll</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_eventplot_alpha</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s3"># one alpha for all</span>
    <span class="s1">collections </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]], </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.7</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">collections</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s5">0.7</span>
    <span class="s0">assert </span><span class="s1">collections</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s5">0.7</span>

    <span class="s3"># one alpha per collection</span>
    <span class="s1">collections </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]], </span><span class="s1">alpha</span><span class="s2">=[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">collections</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s5">0.5</span>
    <span class="s0">assert </span><span class="s1">collections</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s5">0.7</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;alpha and positions are unequal&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]], </span><span class="s1">alpha</span><span class="s2">=[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;alpha and positions are unequal&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">alpha</span><span class="s2">=[</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'test_eventplot_problem_kwargs.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_eventplot_problem_kwargs</span><span class="s2">(</span><span class="s1">recwarn</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot; 
    test that 'singular' versions of LineCollection props raise an 
    MatplotlibDeprecationWarning rather than overriding the 'plural' versions 
    (e.g., to prevent 'color' from overriding 'colors', see issue #4297) 
    &quot;&quot;&quot;</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>

    <span class="s1">data1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">([</span><span class="s5">20</span><span class="s2">]).</span><span class="s1">tolist</span><span class="s2">()</span>
    <span class="s1">data2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">([</span><span class="s5">10</span><span class="s2">]).</span><span class="s1">tolist</span><span class="s2">()</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s1">data1</span><span class="s2">, </span><span class="s1">data2</span><span class="s2">]</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">axobj </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>

    <span class="s1">axobj</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">,</span>
                    <span class="s1">colors</span><span class="s2">=[</span><span class="s4">'r'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
                    <span class="s1">color</span><span class="s2">=[</span><span class="s4">'c'</span><span class="s2">, </span><span class="s4">'m'</span><span class="s2">],</span>
                    <span class="s1">linewidths</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                    <span class="s1">linewidth</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">],</span>
                    <span class="s1">linestyles</span><span class="s2">=[</span><span class="s4">'solid'</span><span class="s2">, </span><span class="s4">'dashed'</span><span class="s2">],</span>
                    <span class="s1">linestyle</span><span class="s2">=[</span><span class="s4">'dashdot'</span><span class="s2">, </span><span class="s4">'dotted'</span><span class="s2">])</span>

    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">recwarn</span><span class="s2">) == </span><span class="s5">3</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">wi</span><span class="s2">.</span><span class="s1">category</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">)</span>
               <span class="s0">for </span><span class="s1">wi </span><span class="s0">in </span><span class="s1">recwarn</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_empty_eventplot</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">([[]], </span><span class="s1">colors</span><span class="s2">=[(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">)])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'data'</span><span class="s2">, [[[]], [[], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]], [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], []]])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'orientation'</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s4">'vertical'</span><span class="s2">, </span><span class="s4">'horizontal'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_eventplot_orientation</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Introduced when fixing issue #6412.&quot;&quot;&quot;</span>
    <span class="s1">opts </span><span class="s2">= {} </span><span class="s0">if </span><span class="s1">orientation </span><span class="s0">is None else </span><span class="s2">{</span><span class="s4">'orientation'</span><span class="s2">: </span><span class="s1">orientation</span><span class="s2">}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, **</span><span class="s1">opts</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_eventplot_units_list</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># test that list of lists converted properly:</span>
    <span class="s1">ts_1 </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2021</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2021</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">),</span>
            <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2021</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)]</span>
    <span class="s1">ts_2 </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2021</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">15</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2021</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">16</span><span class="s2">)]</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(</span><span class="s1">ts_1</span><span class="s2">, </span><span class="s1">lineoffsets</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(</span><span class="s1">ts_2</span><span class="s2">, </span><span class="s1">lineoffsets</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">([</span><span class="s1">ts_1</span><span class="s2">, </span><span class="s1">ts_2</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'marker_styles.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_marker_styles</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># Since generation of the test image, None was removed but 'none' was</span>
    <span class="s3"># added. By moving 'none' to the front (=former sorted place of None)</span>
    <span class="s3"># we can avoid regenerating the test image. This can be removed if the</span>
    <span class="s3"># test image has to be regenerated for other reasons.</span>
    <span class="s1">markers </span><span class="s2">= </span><span class="s1">sorted</span><span class="s2">(</span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">markers</span><span class="s2">.</span><span class="s1">MarkerStyle</span><span class="s2">.</span><span class="s1">markers</span><span class="s2">,</span>
                     <span class="s1">key</span><span class="s2">=</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">str</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))+</span><span class="s1">str</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
    <span class="s1">markers</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s4">'none'</span><span class="s2">)</span>
    <span class="s1">markers </span><span class="s2">= [</span><span class="s4">'none'</span><span class="s2">, *</span><span class="s1">markers</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">y</span><span class="s2">, </span><span class="s1">marker </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">markers</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">((</span><span class="s1">y </span><span class="s2">% </span><span class="s5">2</span><span class="s2">)*</span><span class="s5">5 </span><span class="s2">+ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)*</span><span class="s5">10</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)*</span><span class="s5">10</span><span class="s2">*</span><span class="s1">y</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">''</span><span class="s2">,</span>
                <span class="s1">marker</span><span class="s2">=</span><span class="s1">marker</span><span class="s2">, </span><span class="s1">markersize</span><span class="s2">=</span><span class="s5">10</span><span class="s2">+</span><span class="s1">y</span><span class="s2">/</span><span class="s5">5</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">marker</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'rc_markerfill.png'</span><span class="s2">],</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.037 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_markers_fillstyle_rcparams</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">7</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">idx</span><span class="s2">, (</span><span class="s1">style</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">) </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span>
            <span class="s2">[(</span><span class="s4">'top'</span><span class="s2">, </span><span class="s4">'s'</span><span class="s2">), (</span><span class="s4">'bottom'</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">), (</span><span class="s4">'none'</span><span class="s2">, </span><span class="s4">'^'</span><span class="s2">)]):</span>
        <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'markers.fillstyle'</span><span class="s2">] = </span><span class="s1">style</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">+</span><span class="s1">idx</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s1">marker</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'vertex_markers.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_vertex_markers</span><span class="s2">():</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">marker_as_tuple </span><span class="s2">= ((-</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">marker_as_list </span><span class="s2">= [(-</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">''</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s1">marker_as_tuple</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[::-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">''</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s1">marker_as_list</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'vline_hline_zorder'</span><span class="s2">, </span><span class="s4">'errorbar_zorder'</span><span class="s2">],</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'x86_64' </span><span class="s0">else </span><span class="s5">0.026</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_eb_line_zorder</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>

    <span class="s3"># First illustrate basic pyplot interface, using defaults where possible.</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'m'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">7</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">&quot;axvline and axhline zorder test&quot;</span><span class="s2">)</span>

    <span class="s3"># Now switch to a more OO interface to exercise more features.</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">yerr </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">yerr</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">j</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s1">j</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(-</span><span class="s1">j</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s1">j</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">&quot;errorbar zorder test&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_axline_loglog</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s5">1e-3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">([</span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">], [</span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">], </span><span class="s4">&quot;.-&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1e-3</span><span class="s2">), (</span><span class="s5">10</span><span class="s2">, </span><span class="s5">1e-2</span><span class="s2">), </span><span class="s1">c</span><span class="s2">=</span><span class="s4">&quot;k&quot;</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s5">1e-3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">([</span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">], [</span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">], </span><span class="s4">&quot;.-&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], [</span><span class="s5">1e-3</span><span class="s2">, </span><span class="s5">1e-2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=</span><span class="s4">&quot;k&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_axline</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C2'</span><span class="s2">)</span>
    <span class="s3"># slopes</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((-</span><span class="s5">0.7</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C3'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C4'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s1">float</span><span class="s2">(</span><span class="s4">'inf'</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C5'</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C2'</span><span class="s2">)</span>
    <span class="s3"># slopes</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C3'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0.5</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C4'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C5'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_axline_transaxes</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C2'</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), (</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C3'</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C2'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C3'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_axline_transaxes_panzoom</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># test that it is robust against pan/zoom and</span>
    <span class="s3"># figure resize after plotting</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C2'</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">set_size_inches</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">set_size_inches</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], [</span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C2'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_axline_args</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Exactly one of *xy2* and *slope* must be specified.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))  </span><span class="s3"># missing second parameter</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)  </span><span class="s3"># redundant parameters</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'linear'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s1">slope</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">'linear'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">axline</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))  </span><span class="s3"># two identical points are not allowed</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'vlines_basic'</span><span class="s2">, </span><span class="s4">'vlines_with_nan'</span><span class="s2">, </span><span class="s4">'vlines_masked'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_vlines</span><span class="s2">():</span>
    <span class="s3"># normal</span>
    <span class="s1">x1 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>
    <span class="s1">y1 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s3"># GH #7406</span>
    <span class="s1">x2 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>
    <span class="s1">y2 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">fig2</span><span class="s2">, (</span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">))</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">x3 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>
    <span class="s1">y3 </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">x3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">y3</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">)</span>

    <span class="s1">x4 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>
    <span class="s1">y4 </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]</span>
    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">x4</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">y4</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s3"># tweak the x-axis so we can see the lines better</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s2">[</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">]:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>

    <span class="s3"># check that the y-lims are all automatically the same</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">ax4</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()</span>

    <span class="s1">fig3</span><span class="s2">, </span><span class="s1">ax5 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x5 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_equal</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">12</span><span class="s2">], </span><span class="s5">8</span><span class="s2">)</span>
    <span class="s1">ymin5 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_equal</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ymax5 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_equal</span><span class="s2">([</span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">15</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">17</span><span class="s2">, </span><span class="s5">18</span><span class="s2">], </span><span class="s5">18</span><span class="s2">)</span>
    <span class="s1">ax5</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">x5</span><span class="s2">, </span><span class="s1">ymin5</span><span class="s2">, </span><span class="s1">ymax5</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax5</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">15</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_vlines_default</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">'lines.color'</span><span class="s2">: </span><span class="s4">'red'</span><span class="s2">}):</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s4">'red'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'hlines_basic'</span><span class="s2">, </span><span class="s4">'hlines_with_nan'</span><span class="s2">, </span><span class="s4">'hlines_masked'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_hlines</span><span class="s2">():</span>
    <span class="s3"># normal</span>
    <span class="s1">y1 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>
    <span class="s1">x1 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">x1</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s3"># GH #7406</span>
    <span class="s1">y2 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>
    <span class="s1">x2 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">fig2</span><span class="s2">, (</span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">))</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">(</span><span class="s1">y2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">x2</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'g'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">y3 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>
    <span class="s1">x3 </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">(</span><span class="s1">y3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">x3</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">)</span>

    <span class="s1">y4 </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">]</span>
    <span class="s1">x4 </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, -</span><span class="s5">6</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]</span>
    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">(</span><span class="s1">y4</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">x4</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s3"># tweak the y-axis so we can see the lines better</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s2">[</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">, </span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">]:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>

    <span class="s3"># check that the x-lims are all automatically the same</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">ax4</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>

    <span class="s1">fig3</span><span class="s2">, </span><span class="s1">ax5 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">y5 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_equal</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">12</span><span class="s2">], </span><span class="s5">8</span><span class="s2">)</span>
    <span class="s1">xmin5 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_equal</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">xmax5 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_equal</span><span class="s2">([</span><span class="s5">13</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">15</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">17</span><span class="s2">, </span><span class="s5">18</span><span class="s2">], </span><span class="s5">18</span><span class="s2">)</span>
    <span class="s1">ax5</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">(</span><span class="s1">y5</span><span class="s2">, </span><span class="s1">xmin5</span><span class="s2">, </span><span class="s1">xmax5</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax5</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">15</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hlines_default</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">'lines.color'</span><span class="s2">: </span><span class="s4">'red'</span><span class="s2">}):</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s4">'red'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'data'</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">5</span><span class="s2">],</span>
                                  <span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_equal</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], </span><span class="s5">4</span><span class="s2">)])</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_lines_with_colors</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">data</span><span class="s2">):</span>
    <span class="s1">test_colors </span><span class="s2">= [</span><span class="s4">'red'</span><span class="s2">, </span><span class="s4">'green'</span><span class="s2">, </span><span class="s4">'blue'</span><span class="s2">, </span><span class="s4">'purple'</span><span class="s2">, </span><span class="s4">'orange'</span><span class="s2">]</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">).</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                                         <span class="s1">colors</span><span class="s2">=</span><span class="s1">test_colors</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">).</span><span class="s1">hlines</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                                         <span class="s1">colors</span><span class="s2">=</span><span class="s1">test_colors</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>

    <span class="s1">expect_xy </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">]</span>
    <span class="s1">expect_color </span><span class="s2">= [</span><span class="s4">'red'</span><span class="s2">, </span><span class="s4">'green'</span><span class="s2">, </span><span class="s4">'blue'</span><span class="s2">, </span><span class="s4">'orange'</span><span class="s2">]</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">).</span><span class="s1">vlines</span><span class="s2">(</span><span class="s1">expect_xy</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                                        <span class="s1">colors</span><span class="s2">=</span><span class="s1">expect_color</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">).</span><span class="s1">hlines</span><span class="s2">(</span><span class="s1">expect_xy</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">,</span>
                                        <span class="s1">colors</span><span class="s2">=</span><span class="s1">expect_color</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'vlines_hlines_blended_transform'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_vlines_hlines_blended_transform</span><span class="s2">():</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5.0</span><span class="s2">, </span><span class="s5">10.0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">t</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">t</span><span class="s2">) + </span><span class="s5">10</span>
    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">hax</span><span class="s2">, </span><span class="s1">vax</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
    <span class="s1">hax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s4">'^'</span><span class="s2">)</span>
    <span class="s1">hax</span><span class="s2">.</span><span class="s1">hlines</span><span class="s2">([</span><span class="s5">10</span><span class="s2">, </span><span class="s5">9</span><span class="s2">], </span><span class="s1">xmin</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">,</span>
               <span class="s1">transform</span><span class="s2">=</span><span class="s1">hax</span><span class="s2">.</span><span class="s1">get_yaxis_transform</span><span class="s2">(), </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>
    <span class="s1">vax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s4">'^'</span><span class="s2">)</span>
    <span class="s1">vax</span><span class="s2">.</span><span class="s1">vlines</span><span class="s2">([</span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">], </span><span class="s1">ymin</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">=</span><span class="s5">0.15</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">vax</span><span class="s2">.</span><span class="s1">get_xaxis_transform</span><span class="s2">(),</span>
               <span class="s1">colors</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'step_linestyle'</span><span class="s2">, </span><span class="s4">'step_linestyle'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.2</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_step_linestyle</span><span class="s2">():</span>
    <span class="s3"># Tolerance caused by reordering of floating-point operations</span>
    <span class="s3"># Remove when regenerating the images</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>

    <span class="s3"># First illustrate basic pyplot interface, using defaults where possible.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax_lst </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax_lst </span><span class="s2">= </span><span class="s1">ax_lst</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">()</span>

    <span class="s1">ln_styles </span><span class="s2">= [</span><span class="s4">'-'</span><span class="s2">, </span><span class="s4">'--'</span><span class="s2">, </span><span class="s4">'-.'</span><span class="s2">, </span><span class="s4">':'</span><span class="s2">]</span>

    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">ls </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">ax_lst</span><span class="s2">, </span><span class="s1">ln_styles</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">step</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s4">'pre'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">step</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s4">'mid'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">step</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s4">'post'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">7</span><span class="s2">])</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;X&quot;</span><span class="s2">: </span><span class="s1">x</span><span class="s2">, </span><span class="s4">&quot;Y0&quot;</span><span class="s2">: </span><span class="s1">y</span><span class="s2">, </span><span class="s4">&quot;Y1&quot;</span><span class="s2">: </span><span class="s1">y</span><span class="s2">+</span><span class="s5">1</span><span class="s2">, </span><span class="s4">&quot;Y2&quot;</span><span class="s2">: </span><span class="s1">y</span><span class="s2">+</span><span class="s5">2</span><span class="s2">}</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax_lst </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax_lst </span><span class="s2">= </span><span class="s1">ax_lst</span><span class="s2">.</span><span class="s1">flatten</span><span class="s2">()</span>
    <span class="s1">ln_styles </span><span class="s2">= [</span><span class="s4">'-'</span><span class="s2">, </span><span class="s4">'--'</span><span class="s2">, </span><span class="s4">'-.'</span><span class="s2">, </span><span class="s4">':'</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">ls </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">ax_lst</span><span class="s2">, </span><span class="s1">ln_styles</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">step</span><span class="s2">(</span><span class="s4">&quot;X&quot;</span><span class="s2">, </span><span class="s4">&quot;Y0&quot;</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s4">'pre'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">step</span><span class="s2">(</span><span class="s4">&quot;X&quot;</span><span class="s2">, </span><span class="s4">&quot;Y1&quot;</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s4">'mid'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">step</span><span class="s2">(</span><span class="s4">&quot;X&quot;</span><span class="s2">, </span><span class="s4">&quot;Y2&quot;</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s1">ls</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s4">'post'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">7</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'mixed_collection'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_mixed_collection</span><span class="s2">():</span>
    <span class="s3"># First illustrate basic pyplot interface, using defaults where possible.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">c </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Circle</span><span class="s2">((</span><span class="s5">8</span><span class="s2">, </span><span class="s5">8</span><span class="s2">), </span><span class="s1">radius</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">)</span>

    <span class="s3"># PDF can optimize this one</span>
    <span class="s1">p1 </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">collections</span><span class="s2">.</span><span class="s1">PatchCollection</span><span class="s2">([</span><span class="s1">c</span><span class="s2">], </span><span class="s1">match_original</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">p1</span><span class="s2">.</span><span class="s1">set_offsets</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">24</span><span class="s2">, </span><span class="s5">24</span><span class="s2">]])</span>
    <span class="s1">p1</span><span class="s2">.</span><span class="s1">set_linewidths</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>

    <span class="s3"># PDF can't optimize this one, because the alpha of the edge changes</span>
    <span class="s1">p2 </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">collections</span><span class="s2">.</span><span class="s1">PatchCollection</span><span class="s2">([</span><span class="s1">c</span><span class="s2">], </span><span class="s1">match_original</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">p2</span><span class="s2">.</span><span class="s1">set_offsets</span><span class="s2">([[</span><span class="s5">48</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [-</span><span class="s5">32</span><span class="s2">, -</span><span class="s5">16</span><span class="s2">]])</span>
    <span class="s1">p2</span><span class="s2">.</span><span class="s1">set_linewidths</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">p2</span><span class="s2">.</span><span class="s1">set_edgecolors</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">]])</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">.</span><span class="s1">set_color</span><span class="s2">(</span><span class="s4">'0.5'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">p1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">16</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">16</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_subplot_key_hash</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">(</span><span class="s5">1</span><span class="s2">), </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_subplotspec</span><span class="s2">().</span><span class="s1">get_geometry</span><span class="s2">() == (</span><span class="s5">5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span>
    <span class="s2">[</span><span class="s4">&quot;specgram_freqs.png&quot;</span><span class="s2">, </span><span class="s4">&quot;specgram_freqs_linear.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;specgram_noise.png&quot;</span><span class="s2">, </span><span class="s4">&quot;specgram_noise_linear.png&quot;</span><span class="s2">],</span>
    <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.07</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;default&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_specgram</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test axes.specgram in default (psd) mode.&quot;&quot;&quot;</span>

    <span class="s3"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'image.interpolation'</span><span class="s2">] = </span><span class="s4">'nearest'</span>

    <span class="s1">n </span><span class="s2">= </span><span class="s5">1000</span>
    <span class="s1">Fs </span><span class="s2">= </span><span class="s5">10.</span>

    <span class="s1">fstims </span><span class="s2">= [[</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11</span><span class="s2">], [</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4.7</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5.6</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11.9</span><span class="s2">]]</span>
    <span class="s1">NFFT_freqs </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">10 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">fstims</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s5">1</span><span class="s2">/</span><span class="s1">Fs</span><span class="s2">)</span>
    <span class="s1">y_freqs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">multiply</span><span class="s2">.</span><span class="s1">outer</span><span class="s2">(</span><span class="s1">fstims</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)).</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">))</span>

    <span class="s1">NFFT_noise </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">10 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s5">11</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">y_noise </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)])</span>

    <span class="s1">all_sides </span><span class="s2">= [</span><span class="s4">&quot;default&quot;</span><span class="s2">, </span><span class="s4">&quot;onesided&quot;</span><span class="s2">, </span><span class="s4">&quot;twosided&quot;</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT </span><span class="s0">in </span><span class="s2">[(</span><span class="s1">y_freqs</span><span class="s2">, </span><span class="s1">NFFT_freqs</span><span class="s2">), (</span><span class="s1">y_noise</span><span class="s2">, </span><span class="s1">NFFT_noise</span><span class="s2">)]:</span>
        <span class="s1">noverlap </span><span class="s2">= </span><span class="s1">NFFT </span><span class="s2">// </span><span class="s5">2</span>
        <span class="s1">pad_to </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">** </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log2</span><span class="s2">(</span><span class="s1">NFFT</span><span class="s2">)))</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT</span><span class="s2">=</span><span class="s1">NFFT</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">=</span><span class="s1">Fs</span><span class="s2">, </span><span class="s1">noverlap</span><span class="s2">=</span><span class="s1">noverlap</span><span class="s2">,</span>
                        <span class="s1">pad_to</span><span class="s2">=</span><span class="s1">pad_to</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT</span><span class="s2">=</span><span class="s1">NFFT</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">=</span><span class="s1">Fs</span><span class="s2">, </span><span class="s1">noverlap</span><span class="s2">=</span><span class="s1">noverlap</span><span class="s2">,</span>
                        <span class="s1">pad_to</span><span class="s2">=</span><span class="s1">pad_to</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">,</span>
                        <span class="s1">scale</span><span class="s2">=</span><span class="s4">&quot;linear&quot;</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">LogNorm</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span>
    <span class="s2">[</span><span class="s4">&quot;specgram_magnitude_freqs.png&quot;</span><span class="s2">, </span><span class="s4">&quot;specgram_magnitude_freqs_linear.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;specgram_magnitude_noise.png&quot;</span><span class="s2">, </span><span class="s4">&quot;specgram_magnitude_noise_linear.png&quot;</span><span class="s2">],</span>
    <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.07</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;default&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_specgram_magnitude</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test axes.specgram in magnitude mode.&quot;&quot;&quot;</span>

    <span class="s3"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'image.interpolation'</span><span class="s2">] = </span><span class="s4">'nearest'</span>

    <span class="s1">n </span><span class="s2">= </span><span class="s5">1000</span>
    <span class="s1">Fs </span><span class="s2">= </span><span class="s5">10.</span>

    <span class="s1">fstims </span><span class="s2">= [[</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11</span><span class="s2">], [</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4.7</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5.6</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11.9</span><span class="s2">]]</span>
    <span class="s1">NFFT_freqs </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">100 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">fstims</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s5">1</span><span class="s2">/</span><span class="s1">Fs</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">multiply</span><span class="s2">.</span><span class="s1">outer</span><span class="s2">(</span><span class="s1">fstims</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)).</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">y</span><span class="s2">[:, -</span><span class="s5">1</span><span class="s2">] = </span><span class="s5">1</span>
    <span class="s1">y_freqs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">NFFT_noise </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">10 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s5">11</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">y_noise </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)])</span>

    <span class="s1">all_sides </span><span class="s2">= [</span><span class="s4">&quot;default&quot;</span><span class="s2">, </span><span class="s4">&quot;onesided&quot;</span><span class="s2">, </span><span class="s4">&quot;twosided&quot;</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT </span><span class="s0">in </span><span class="s2">[(</span><span class="s1">y_freqs</span><span class="s2">, </span><span class="s1">NFFT_freqs</span><span class="s2">), (</span><span class="s1">y_noise</span><span class="s2">, </span><span class="s1">NFFT_noise</span><span class="s2">)]:</span>
        <span class="s1">noverlap </span><span class="s2">= </span><span class="s1">NFFT </span><span class="s2">// </span><span class="s5">2</span>
        <span class="s1">pad_to </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">** </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log2</span><span class="s2">(</span><span class="s1">NFFT</span><span class="s2">)))</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT</span><span class="s2">=</span><span class="s1">NFFT</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">=</span><span class="s1">Fs</span><span class="s2">, </span><span class="s1">noverlap</span><span class="s2">=</span><span class="s1">noverlap</span><span class="s2">,</span>
                        <span class="s1">pad_to</span><span class="s2">=</span><span class="s1">pad_to</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s4">&quot;magnitude&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT</span><span class="s2">=</span><span class="s1">NFFT</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">=</span><span class="s1">Fs</span><span class="s2">, </span><span class="s1">noverlap</span><span class="s2">=</span><span class="s1">noverlap</span><span class="s2">,</span>
                        <span class="s1">pad_to</span><span class="s2">=</span><span class="s1">pad_to</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s4">&quot;magnitude&quot;</span><span class="s2">,</span>
                        <span class="s1">scale</span><span class="s2">=</span><span class="s4">&quot;linear&quot;</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">LogNorm</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span>
    <span class="s2">[</span><span class="s4">&quot;specgram_angle_freqs.png&quot;</span><span class="s2">, </span><span class="s4">&quot;specgram_phase_freqs.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;specgram_angle_noise.png&quot;</span><span class="s2">, </span><span class="s4">&quot;specgram_phase_noise.png&quot;</span><span class="s2">],</span>
    <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.07</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;default&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_specgram_angle</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test axes.specgram in angle and phase modes.&quot;&quot;&quot;</span>

    <span class="s3"># use former defaults to match existing baseline image</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'image.interpolation'</span><span class="s2">] = </span><span class="s4">'nearest'</span>

    <span class="s1">n </span><span class="s2">= </span><span class="s5">1000</span>
    <span class="s1">Fs </span><span class="s2">= </span><span class="s5">10.</span>

    <span class="s1">fstims </span><span class="s2">= [[</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11</span><span class="s2">], [</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4.7</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5.6</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11.9</span><span class="s2">]]</span>
    <span class="s1">NFFT_freqs </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">10 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">fstims</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s5">1</span><span class="s2">/</span><span class="s1">Fs</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">multiply</span><span class="s2">.</span><span class="s1">outer</span><span class="s2">(</span><span class="s1">fstims</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)).</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">y</span><span class="s2">[:, -</span><span class="s5">1</span><span class="s2">] = </span><span class="s5">1</span>
    <span class="s1">y_freqs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">(</span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">NFFT_noise </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">10 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s5">11</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">y_noise </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)])</span>

    <span class="s1">all_sides </span><span class="s2">= [</span><span class="s4">&quot;default&quot;</span><span class="s2">, </span><span class="s4">&quot;onesided&quot;</span><span class="s2">, </span><span class="s4">&quot;twosided&quot;</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT </span><span class="s0">in </span><span class="s2">[(</span><span class="s1">y_freqs</span><span class="s2">, </span><span class="s1">NFFT_freqs</span><span class="s2">), (</span><span class="s1">y_noise</span><span class="s2">, </span><span class="s1">NFFT_noise</span><span class="s2">)]:</span>
        <span class="s1">noverlap </span><span class="s2">= </span><span class="s1">NFFT </span><span class="s2">// </span><span class="s5">2</span>
        <span class="s1">pad_to </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">** </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log2</span><span class="s2">(</span><span class="s1">NFFT</span><span class="s2">)))</span>
        <span class="s0">for </span><span class="s1">mode </span><span class="s0">in </span><span class="s2">[</span><span class="s4">&quot;angle&quot;</span><span class="s2">, </span><span class="s4">&quot;phase&quot;</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
                <span class="s1">ax</span><span class="s2">.</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT</span><span class="s2">=</span><span class="s1">NFFT</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">=</span><span class="s1">Fs</span><span class="s2">, </span><span class="s1">noverlap</span><span class="s2">=</span><span class="s1">noverlap</span><span class="s2">,</span>
                            <span class="s1">pad_to</span><span class="s2">=</span><span class="s1">pad_to</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s1">mode</span><span class="s2">)</span>
                <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
                    <span class="s1">ax</span><span class="s2">.</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">NFFT</span><span class="s2">=</span><span class="s1">NFFT</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">=</span><span class="s1">Fs</span><span class="s2">, </span><span class="s1">noverlap</span><span class="s2">=</span><span class="s1">noverlap</span><span class="s2">,</span>
                                <span class="s1">pad_to</span><span class="s2">=</span><span class="s1">pad_to</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s1">mode</span><span class="s2">,</span>
                                <span class="s1">scale</span><span class="s2">=</span><span class="s4">&quot;dB&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_specgram_fs_none</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test axes.specgram when Fs is None, should not throw error.&quot;&quot;&quot;</span>
    <span class="s1">spec</span><span class="s2">, </span><span class="s1">freqs</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">im </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">300</span><span class="s2">), </span><span class="s1">Fs</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s4">'linear'</span><span class="s2">)</span>
    <span class="s1">xmin</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">, </span><span class="s1">freq0</span><span class="s2">, </span><span class="s1">freq1 </span><span class="s2">= </span><span class="s1">im</span><span class="s2">.</span><span class="s1">get_extent</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">xmin </span><span class="s2">== </span><span class="s5">32 </span><span class="s0">and </span><span class="s1">xmax </span><span class="s2">== </span><span class="s5">96</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_specgram_origin_rcparam</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Test specgram ignores image.origin rcParam and uses origin 'upper'.&quot;&quot;&quot;</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">500</span><span class="s2">)</span>
    <span class="s1">signal </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">t</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">&quot;image.origin&quot;</span><span class="s2">] = </span><span class="s4">'upper'</span>

    <span class="s3"># Reference: First graph using default origin in imshow (upper),</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">signal</span><span class="s2">)</span>

    <span class="s3"># Try to overwrite the setting trying to flip the specgram</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">&quot;image.origin&quot;</span><span class="s2">] = </span><span class="s4">'lower'</span>

    <span class="s3"># Test: origin='lower' should be ignored</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">signal</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_specgram_origin_kwarg</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Ensure passing origin as a kwarg raises a TypeError.&quot;&quot;&quot;</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">500</span><span class="s2">)</span>
    <span class="s1">signal </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">t</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">specgram</span><span class="s2">(</span><span class="s1">signal</span><span class="s2">, </span><span class="s1">origin</span><span class="s2">=</span><span class="s4">'lower'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span>
    <span class="s2">[</span><span class="s4">&quot;psd_freqs.png&quot;</span><span class="s2">, </span><span class="s4">&quot;csd_freqs.png&quot;</span><span class="s2">, </span><span class="s4">&quot;psd_noise.png&quot;</span><span class="s2">, </span><span class="s4">&quot;csd_noise.png&quot;</span><span class="s2">],</span>
    <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.002</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_psd_csd</span><span class="s2">():</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s5">10000</span>
    <span class="s1">Fs </span><span class="s2">= </span><span class="s5">100.</span>

    <span class="s1">fstims </span><span class="s2">= [[</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11</span><span class="s2">], [</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4.7</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5.6</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11.9</span><span class="s2">]]</span>
    <span class="s1">NFFT_freqs </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">1000 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">fstims</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s5">1</span><span class="s2">/</span><span class="s1">Fs</span><span class="s2">)</span>
    <span class="s1">ys_freqs </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">multiply</span><span class="s2">.</span><span class="s1">outer</span><span class="s2">(</span><span class="s1">fstims</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)).</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>

    <span class="s1">NFFT_noise </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">1000 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s5">11</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ys_noise </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)]</span>

    <span class="s1">all_kwargs </span><span class="s2">= [{</span><span class="s4">&quot;sides&quot;</span><span class="s2">: </span><span class="s4">&quot;default&quot;</span><span class="s2">},</span>
                  <span class="s2">{</span><span class="s4">&quot;sides&quot;</span><span class="s2">: </span><span class="s4">&quot;onesided&quot;</span><span class="s2">, </span><span class="s4">&quot;return_line&quot;</span><span class="s2">: </span><span class="s0">False</span><span class="s2">},</span>
                  <span class="s2">{</span><span class="s4">&quot;sides&quot;</span><span class="s2">: </span><span class="s4">&quot;twosided&quot;</span><span class="s2">, </span><span class="s4">&quot;return_line&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}]</span>
    <span class="s0">for </span><span class="s1">ys</span><span class="s2">, </span><span class="s1">NFFT </span><span class="s0">in </span><span class="s2">[(</span><span class="s1">ys_freqs</span><span class="s2">, </span><span class="s1">NFFT_freqs</span><span class="s2">), (</span><span class="s1">ys_noise</span><span class="s2">, </span><span class="s1">NFFT_noise</span><span class="s2">)]:</span>
        <span class="s1">noverlap </span><span class="s2">= </span><span class="s1">NFFT </span><span class="s2">// </span><span class="s5">2</span>
        <span class="s1">pad_to </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">** </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log2</span><span class="s2">(</span><span class="s1">NFFT</span><span class="s2">)))</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">kwargs </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_kwargs</span><span class="s2">):</span>
            <span class="s1">ret </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">psd</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">(</span><span class="s1">ys</span><span class="s2">), </span><span class="s1">NFFT</span><span class="s2">=</span><span class="s1">NFFT</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">=</span><span class="s1">Fs</span><span class="s2">,</span>
                         <span class="s1">noverlap</span><span class="s2">=</span><span class="s1">noverlap</span><span class="s2">, </span><span class="s1">pad_to</span><span class="s2">=</span><span class="s1">pad_to</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">ret</span><span class="s2">) == </span><span class="s5">2 </span><span class="s2">+ </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">&quot;return_line&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">ylabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">kwargs </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_kwargs</span><span class="s2">):</span>
            <span class="s1">ret </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">csd</span><span class="s2">(*</span><span class="s1">ys</span><span class="s2">, </span><span class="s1">NFFT</span><span class="s2">=</span><span class="s1">NFFT</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">=</span><span class="s1">Fs</span><span class="s2">,</span>
                         <span class="s1">noverlap</span><span class="s2">=</span><span class="s1">noverlap</span><span class="s2">, </span><span class="s1">pad_to</span><span class="s2">=</span><span class="s1">pad_to</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">ret</span><span class="s2">) == </span><span class="s5">2 </span><span class="s2">+ </span><span class="s1">kwargs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">&quot;return_line&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">ylabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">(</span>
    <span class="s2">[</span><span class="s4">&quot;magnitude_spectrum_freqs_linear.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;magnitude_spectrum_freqs_dB.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;angle_spectrum_freqs.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;phase_spectrum_freqs.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;magnitude_spectrum_noise_linear.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;magnitude_spectrum_noise_dB.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;angle_spectrum_noise.png&quot;</span><span class="s2">,</span>
     <span class="s4">&quot;phase_spectrum_noise.png&quot;</span><span class="s2">],</span>
    <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_spectrum</span><span class="s2">():</span>
    <span class="s1">n </span><span class="s2">= </span><span class="s5">10000</span>
    <span class="s1">Fs </span><span class="s2">= </span><span class="s5">100.</span>

    <span class="s1">fstims1 </span><span class="s2">= [</span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">4</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">5</span><span class="s2">, </span><span class="s1">Fs</span><span class="s2">/</span><span class="s5">11</span><span class="s2">]</span>
    <span class="s1">NFFT </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">1000 </span><span class="s2">* </span><span class="s1">Fs </span><span class="s2">/ </span><span class="s1">min</span><span class="s2">(</span><span class="s1">fstims1</span><span class="s2">))</span>
    <span class="s1">pad_to </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">** </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log2</span><span class="s2">(</span><span class="s1">NFFT</span><span class="s2">)))</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s5">1</span><span class="s2">/</span><span class="s1">Fs</span><span class="s2">)</span>
    <span class="s1">y_freqs </span><span class="s2">= ((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">outer</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">fstims1</span><span class="s2">)) * </span><span class="s5">10</span><span class="s2">**</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>
               <span class="s2">.</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">y_noise </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">n</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)]) - </span><span class="s5">.5</span>

    <span class="s1">all_sides </span><span class="s2">= [</span><span class="s4">&quot;default&quot;</span><span class="s2">, </span><span class="s4">&quot;onesided&quot;</span><span class="s2">, </span><span class="s4">&quot;twosided&quot;</span><span class="s2">]</span>
    <span class="s1">kwargs </span><span class="s2">= {</span><span class="s4">&quot;Fs&quot;</span><span class="s2">: </span><span class="s1">Fs</span><span class="s2">, </span><span class="s4">&quot;pad_to&quot;</span><span class="s2">: </span><span class="s1">pad_to</span><span class="s2">}</span>
    <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s2">[</span><span class="s1">y_freqs</span><span class="s2">, </span><span class="s1">y_noise</span><span class="s2">]:</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
            <span class="s1">spec</span><span class="s2">, </span><span class="s1">freqs</span><span class="s2">, </span><span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">magnitude_spectrum</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">ylabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
            <span class="s1">spec</span><span class="s2">, </span><span class="s1">freqs</span><span class="s2">, </span><span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">magnitude_spectrum</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">,</span>
                                                      <span class="s1">scale</span><span class="s2">=</span><span class="s4">&quot;dB&quot;</span><span class="s2">)</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">ylabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
            <span class="s1">spec</span><span class="s2">, </span><span class="s1">freqs</span><span class="s2">, </span><span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">angle_spectrum</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">ylabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">sides </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">all_sides</span><span class="s2">):</span>
            <span class="s1">spec</span><span class="s2">, </span><span class="s1">freqs</span><span class="s2">, </span><span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">phase_spectrum</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">sides</span><span class="s2">=</span><span class="s1">sides</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">ylabel</span><span class="s2">=</span><span class="s4">&quot;&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_psd_csd_edge_cases</span><span class="s2">():</span>
    <span class="s3"># Inverted yaxis or fully zero inputs used to throw exceptions.</span>
    <span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">inverted</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s4">&quot;ignore&quot;</span><span class="s2">):</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">psd</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">csd</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_twin_remove</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax_twinx </span><span class="s2">= </span><span class="s1">ax_test</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s1">ax_twiny </span><span class="s2">= </span><span class="s1">ax_test</span><span class="s2">.</span><span class="s1">twiny</span><span class="s2">()</span>
    <span class="s1">ax_twinx</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s1">ax_twiny</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>

    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s3"># Ideally we also undo tick changes when calling ``remove()``, but for now</span>
    <span class="s3"># manually set the ticks of the reference image to match the test image</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">tick_bottom</span><span class="s2">()</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">tick_left</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'twin_spines.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.022 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_twin_spines</span><span class="s2">():</span>

    <span class="s0">def </span><span class="s1">make_patch_spines_invisible</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_frame_on</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">[:].</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">right</span><span class="s2">=</span><span class="s5">0.75</span><span class="s2">)</span>

    <span class="s1">host </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">par1 </span><span class="s2">= </span><span class="s1">host</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s1">par2 </span><span class="s2">= </span><span class="s1">host</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>

    <span class="s3"># Offset the right spine of par2.  The ticks and label have already been</span>
    <span class="s3"># placed on the right by twinx above.</span>
    <span class="s1">par2</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">.</span><span class="s1">right</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">((</span><span class="s4">&quot;axes&quot;</span><span class="s2">, </span><span class="s5">1.2</span><span class="s2">))</span>
    <span class="s3"># Having been created by twinx, par2 has its frame off, so the line of</span>
    <span class="s3"># its detached spine is invisible.  First, activate the frame but make</span>
    <span class="s3"># the patch and spines invisible.</span>
    <span class="s1">make_patch_spines_invisible</span><span class="s2">(</span><span class="s1">par2</span><span class="s2">)</span>
    <span class="s3"># Second, show the right spine.</span>
    <span class="s1">par2</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">.</span><span class="s1">right</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">p1</span><span class="s2">, = </span><span class="s1">host</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s4">&quot;b-&quot;</span><span class="s2">)</span>
    <span class="s1">p2</span><span class="s2">, = </span><span class="s1">par1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s4">&quot;r-&quot;</span><span class="s2">)</span>
    <span class="s1">p3</span><span class="s2">, = </span><span class="s1">par2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">50</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">15</span><span class="s2">], </span><span class="s4">&quot;g-&quot;</span><span class="s2">)</span>

    <span class="s1">host</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">host</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">par1</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">par2</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">65</span><span class="s2">)</span>

    <span class="s1">host</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">set_color</span><span class="s2">(</span><span class="s1">p1</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">())</span>
    <span class="s1">par1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">set_color</span><span class="s2">(</span><span class="s1">p2</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">())</span>
    <span class="s1">par2</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">set_color</span><span class="s2">(</span><span class="s1">p3</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">())</span>

    <span class="s1">tkw </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">4</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s5">1.5</span><span class="s2">)</span>
    <span class="s1">host</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'y'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">p1</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), **</span><span class="s1">tkw</span><span class="s2">)</span>
    <span class="s1">par1</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'y'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">p2</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), **</span><span class="s1">tkw</span><span class="s2">)</span>
    <span class="s1">par2</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'y'</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">p3</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), **</span><span class="s1">tkw</span><span class="s2">)</span>
    <span class="s1">host</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">, **</span><span class="s1">tkw</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'twin_spines_on_top.png'</span><span class="s2">, </span><span class="s4">'twin_spines_on_top.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_twin_spines_on_top</span><span class="s2">():</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.linewidth'</span><span class="s2">] = </span><span class="s5">48.0</span>
    <span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'lines.linewidth'</span><span class="s2">] = </span><span class="s5">48.0</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>

    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1000</span><span class="s2">, </span><span class="s5">1100</span><span class="s2">, </span><span class="s5">1200</span><span class="s2">, </span><span class="s5">1250</span><span class="s2">],</span>
                     <span class="s2">[</span><span class="s5">310</span><span class="s2">, </span><span class="s5">301</span><span class="s2">, </span><span class="s5">360</span><span class="s2">, </span><span class="s5">400</span><span class="s2">]])</span>

    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>

    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">data</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]/</span><span class="s5">1E3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'#BEAED4'</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">data</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]/</span><span class="s5">1E3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'#BEAED4'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.8</span><span class="s2">)</span>

    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">data</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]/</span><span class="s5">1E3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'#7FC97F'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">data</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]/</span><span class="s5">1E3</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'#7FC97F'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.5</span><span class="s2">)</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;i&quot;</span><span class="s2">: </span><span class="s1">data</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s4">&quot;j&quot;</span><span class="s2">: </span><span class="s1">data</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]/</span><span class="s5">1E3</span><span class="s2">}</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;j&quot;</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'#BEAED4'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;j&quot;</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'#BEAED4'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.8</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;j&quot;</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'#7FC97F'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s4">&quot;i&quot;</span><span class="s2">, </span><span class="s4">&quot;j&quot;</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'#7FC97F'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.5</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;grid_which, major_visible, minor_visible&quot;</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s4">&quot;both&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;major&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;minor&quot;</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_rcparam_grid_minor</span><span class="s2">(</span><span class="s1">grid_which</span><span class="s2">, </span><span class="s1">major_visible</span><span class="s2">, </span><span class="s1">minor_visible</span><span class="s2">):</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">.</span><span class="s1">update</span><span class="s2">({</span><span class="s4">&quot;axes.grid&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">, </span><span class="s4">&quot;axes.grid.which&quot;</span><span class="s2">: </span><span class="s1">grid_which</span><span class="s2">})</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">tick</span><span class="s2">.</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() == </span><span class="s1">major_visible</span>
               <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">tick</span><span class="s2">.</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() == </span><span class="s1">minor_visible</span>
               <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">minorTicks</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_grid</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s1">visible</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s1">visible</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_reset_grid</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">reset</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'major'</span><span class="s2">, </span><span class="s1">labelsize</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">)  </span><span class="s3"># enables grid</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>

    <span class="s0">with </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">'axes.grid'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">reset</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'major'</span><span class="s2">, </span><span class="s1">labelsize</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_reset_ticks</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s0">for </span><span class="s1">fig </span><span class="s0">in </span><span class="s2">[</span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">]:</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span>
            <span class="s1">direction</span><span class="s2">=</span><span class="s4">'in'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'C0'</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=</span><span class="s5">12</span><span class="s2">,</span>
            <span class="s1">labelsize</span><span class="s2">=</span><span class="s5">14</span><span class="s2">, </span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s4">'C1'</span><span class="s2">, </span><span class="s1">labelrotation</span><span class="s2">=</span><span class="s5">45</span><span class="s2">,</span>
            <span class="s1">grid_color</span><span class="s2">=</span><span class="s4">'C2'</span><span class="s2">, </span><span class="s1">grid_alpha</span><span class="s2">=</span><span class="s5">0.8</span><span class="s2">, </span><span class="s1">grid_linewidth</span><span class="s2">=</span><span class="s5">3</span><span class="s2">,</span>
            <span class="s1">grid_linestyle</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>

    <span class="s3"># After we've changed any setting on ticks, reset_ticks will mean</span>
    <span class="s3"># re-creating them from scratch. This *should* appear the same as not</span>
    <span class="s3"># resetting them.</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">reset_ticks</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">reset_ticks</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_context_ticks</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">({</span>
            <span class="s4">'xtick.direction'</span><span class="s2">: </span><span class="s4">'in'</span><span class="s2">, </span><span class="s4">'xtick.major.size'</span><span class="s2">: </span><span class="s5">30</span><span class="s2">, </span><span class="s4">'xtick.major.width'</span><span class="s2">: </span><span class="s5">5</span><span class="s2">,</span>
            <span class="s4">'xtick.color'</span><span class="s2">: </span><span class="s4">'C0'</span><span class="s2">, </span><span class="s4">'xtick.major.pad'</span><span class="s2">: </span><span class="s5">12</span><span class="s2">,</span>
            <span class="s4">'xtick.bottom'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">, </span><span class="s4">'xtick.top'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
            <span class="s4">'xtick.labelsize'</span><span class="s2">: </span><span class="s5">14</span><span class="s2">, </span><span class="s4">'xtick.labelcolor'</span><span class="s2">: </span><span class="s4">'C1'</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># Draw outside the context so that all-but-first tick are generated with the normal</span>
    <span class="s3"># mpl20 style in place.</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>

    <span class="s1">first_tick </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:]:</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">_size </span><span class="s2">== </span><span class="s1">first_tick</span><span class="s2">.</span><span class="s1">_size</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">_width </span><span class="s2">== </span><span class="s1">first_tick</span><span class="s2">.</span><span class="s1">_width</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">_base_pad </span><span class="s2">== </span><span class="s1">first_tick</span><span class="s2">.</span><span class="s1">_base_pad</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">_labelrotation </span><span class="s2">== </span><span class="s1">first_tick</span><span class="s2">.</span><span class="s1">_labelrotation</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">_zorder </span><span class="s2">== </span><span class="s1">first_tick</span><span class="s2">.</span><span class="s1">_zorder</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">_tickdir </span><span class="s2">== </span><span class="s1">first_tick</span><span class="s2">.</span><span class="s1">_tickdir</span>


<span class="s0">def </span><span class="s1">test_vline_limit</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">])</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (-</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.2</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'fv, fh, args'</span><span class="s2">, [[</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">, </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">,)],</span>
                                          <span class="s2">[</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axvspan</span><span class="s2">, </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axhspan</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)]])</span>
<span class="s0">def </span><span class="s1">test_axline_minmax</span><span class="s2">(</span><span class="s1">fv</span><span class="s2">, </span><span class="s1">fh</span><span class="s2">, </span><span class="s1">args</span><span class="s2">):</span>
    <span class="s1">bad_lim </span><span class="s2">= </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">dates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s3"># Check vertical functions</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'ymin must be a single scalar value'</span><span class="s2">):</span>
        <span class="s1">fv</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">ymin</span><span class="s2">=</span><span class="s1">bad_lim</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'ymax must be a single scalar value'</span><span class="s2">):</span>
        <span class="s1">fv</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">ymin</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">=</span><span class="s1">bad_lim</span><span class="s2">)</span>
    <span class="s3"># Check horizontal functions</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'xmin must be a single scalar value'</span><span class="s2">):</span>
        <span class="s1">fh</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">xmin</span><span class="s2">=</span><span class="s1">bad_lim</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'xmax must be a single scalar value'</span><span class="s2">):</span>
        <span class="s1">fh</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">xmin</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">=</span><span class="s1">bad_lim</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_empty_shared_subplots</span><span class="s2">():</span>
    <span class="s3"># empty plots with shared axes inherit limits from populated plots</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">])</span>
    <span class="s1">x0</span><span class="s2">, </span><span class="s1">x1 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s1">y0</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">x0 </span><span class="s2">&lt;= </span><span class="s5">1</span>
    <span class="s0">assert </span><span class="s1">x1 </span><span class="s2">&gt;= </span><span class="s5">3</span>
    <span class="s0">assert </span><span class="s1">y0 </span><span class="s2">&lt;= </span><span class="s5">2</span>
    <span class="s0">assert </span><span class="s1">y1 </span><span class="s2">&gt;= </span><span class="s5">6</span>


<span class="s0">def </span><span class="s1">test_shared_with_aspect_1</span><span class="s2">():</span>
    <span class="s3"># allow sharing one axis</span>
    <span class="s0">for </span><span class="s1">adjustable </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'box'</span><span class="s2">, </span><span class="s4">'datalim'</span><span class="s2">]:</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s1">adjustable</span><span class="s2">=</span><span class="s1">adjustable</span><span class="s2">, </span><span class="s1">share</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_aspect</span><span class="s2">() == </span><span class="s5">2</span>
        <span class="s0">assert </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_adjustable</span><span class="s2">() == </span><span class="s1">adjustable</span>

        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s1">adjustable</span><span class="s2">=</span><span class="s1">adjustable</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_aspect</span><span class="s2">() == </span><span class="s4">'auto'</span>


<span class="s0">def </span><span class="s1">test_shared_with_aspect_2</span><span class="s2">():</span>
    <span class="s3"># Share 2 axes only with 'box':</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s1">share</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">])</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()  </span><span class="s3"># Trigger apply_aspect().</span>
    <span class="s0">assert </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_shared_with_aspect_3</span><span class="s2">():</span>
    <span class="s3"># Different aspect ratios:</span>
    <span class="s0">for </span><span class="s1">adjustable </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'box'</span><span class="s2">, </span><span class="s4">'datalim'</span><span class="s2">]:</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s1">adjustable</span><span class="s2">=</span><span class="s1">adjustable</span><span class="s2">)</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">adjustable</span><span class="s2">=</span><span class="s1">adjustable</span><span class="s2">)</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">])</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()  </span><span class="s3"># Trigger apply_aspect().</span>
        <span class="s0">assert </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">() != </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">()</span>
        <span class="s1">fig_aspect </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">bbox_inches</span><span class="s2">.</span><span class="s1">height </span><span class="s2">/ </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">bbox_inches</span><span class="s2">.</span><span class="s1">width</span>
        <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">:</span>
            <span class="s1">p </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
            <span class="s1">box_aspect </span><span class="s2">= </span><span class="s1">p</span><span class="s2">.</span><span class="s1">height </span><span class="s2">/ </span><span class="s1">p</span><span class="s2">.</span><span class="s1">width</span>
            <span class="s1">lim_aspect </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">viewLim</span><span class="s2">.</span><span class="s1">height </span><span class="s2">/ </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">viewLim</span><span class="s2">.</span><span class="s1">width</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">fig_aspect </span><span class="s2">* </span><span class="s1">box_aspect </span><span class="s2">/ </span><span class="s1">lim_aspect</span>
            <span class="s0">assert </span><span class="s1">round</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s5">4</span><span class="s2">) == </span><span class="s1">round</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_aspect</span><span class="s2">(), </span><span class="s5">4</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_shared_aspect_error</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">&quot;equal&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">RuntimeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;set_aspect\(..., adjustable=&quot;</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'err, args, kwargs, match'</span><span class="s2">,</span>
                         <span class="s2">((</span><span class="s1">TypeError</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), {},</span>
                           <span class="s4">r&quot;axis\(\) takes from 0 to 1 positional arguments &quot;</span>
                           <span class="s4">&quot;but 2 were given&quot;</span><span class="s2">),</span>
                          <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, (</span><span class="s4">'foo'</span><span class="s2">, ), {},</span>
                           <span class="s4">&quot;Unrecognized string 'foo' to axis; try 'on' or &quot;</span>
                           <span class="s4">&quot;'off'&quot;</span><span class="s2">),</span>
                          <span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, ([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], ), {},</span>
                           <span class="s4">&quot;The first argument to axis*&quot;</span><span class="s2">),</span>
                          <span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">(), {</span><span class="s4">'foo'</span><span class="s2">: </span><span class="s0">None</span><span class="s2">},</span>
                           <span class="s4">r&quot;axis\(\) got an unexpected keyword argument &quot;</span>
                           <span class="s4">&quot;'foo'&quot;</span><span class="s2">),</span>
                          <span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_axis_errors</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">match</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">match</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_axis_method_errors</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;unknown value for which: 'foo'&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xaxis_transform</span><span class="s2">(</span><span class="s4">'foo'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;unknown value for which: 'foo'&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yaxis_transform</span><span class="s2">(</span><span class="s4">'foo'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Cannot supply both positional and&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_prop_cycle</span><span class="s2">(</span><span class="s4">'foo'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'bar'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;argument must be among&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_anchor</span><span class="s2">(</span><span class="s4">'foo'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;scilimits must be a sequence&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">ticklabel_format</span><span class="s2">(</span><span class="s1">scilimits</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Specifying 'loc' is disallowed&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'foo'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">, </span><span class="s1">x</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Specifying 'loc' is disallowed&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'foo'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'top'</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Cannot pass both 'left'&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">xmin</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Cannot pass both 'right'&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">right</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Cannot pass both 'bottom'&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">bottom</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">ymin</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Cannot pass both 'top'&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">top</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'twin'</span><span class="s2">, (</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_twin_with_aspect</span><span class="s2">(</span><span class="s1">twin</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># test twinx or twiny</span>
    <span class="s1">ax_twin </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s4">f'twin</span><span class="s0">{</span><span class="s1">twin</span><span class="s0">}</span><span class="s4">'</span><span class="s2">)()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">ax_twin</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">,</span>
                       <span class="s1">ax_twin</span><span class="s2">.</span><span class="s1">bbox</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_relim_visible_only</span><span class="s2">():</span>
    <span class="s1">x1 </span><span class="s2">= (</span><span class="s5">0.</span><span class="s2">, </span><span class="s5">10.</span><span class="s2">)</span>
    <span class="s1">y1 </span><span class="s2">= (</span><span class="s5">0.</span><span class="s2">, </span><span class="s5">10.</span><span class="s2">)</span>
    <span class="s1">x2 </span><span class="s2">= (-</span><span class="s5">10.</span><span class="s2">, </span><span class="s5">20.</span><span class="s2">)</span>
    <span class="s1">y2 </span><span class="s2">= (-</span><span class="s5">10.</span><span class="s2">, </span><span class="s5">30.</span><span class="s2">)</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">.</span><span class="s1">Figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">x1</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">y1</span>
    <span class="s1">line</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x2</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">x2</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">y2</span>
    <span class="s1">line</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">x2</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">y2</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">relim</span><span class="s2">(</span><span class="s1">visible_only</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale_view</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">x1</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">y1</span>


<span class="s0">def </span><span class="s1">test_text_labelsize</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    tests for issue #1172 
    &quot;&quot;&quot;</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">labelsize</span><span class="s2">=</span><span class="s4">'large'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">direction</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">)</span>


<span class="s3"># Note: The `pie` image tests were affected by Numpy 2.0 changing promotions</span>
<span class="s3"># (NEP 50). While the changes were only marginal, tolerances were introduced.</span>
<span class="s3"># These tolerances could likely go away when numpy 2.0 is the minimum supported</span>
<span class="s3"># numpy and the images are regenerated.</span>

<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_default.png'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.01</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_default</span><span class="s2">():</span>
    <span class="s3"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s4">'Frogs'</span><span class="s2">, </span><span class="s4">'Hogs'</span><span class="s2">, </span><span class="s4">'Dogs'</span><span class="s2">, </span><span class="s4">'Logs'</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)  </span><span class="s3"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>
    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">8</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_linewidth_0'</span><span class="s2">, </span><span class="s4">'pie_linewidth_0'</span><span class="s2">, </span><span class="s4">'pie_linewidth_0'</span><span class="s2">],</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.01</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_linewidth_0</span><span class="s2">():</span>
    <span class="s3"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s4">'Frogs'</span><span class="s2">, </span><span class="s4">'Hogs'</span><span class="s2">, </span><span class="s4">'Dogs'</span><span class="s2">, </span><span class="s4">'Logs'</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)  </span><span class="s3"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">})</span>
    <span class="s3"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>

    <span class="s3"># Reuse testcase from above for a labeled data test</span>
    <span class="s1">data </span><span class="s2">= {</span><span class="s4">&quot;l&quot;</span><span class="s2">: </span><span class="s1">labels</span><span class="s2">, </span><span class="s4">&quot;s&quot;</span><span class="s2">: </span><span class="s1">sizes</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">: </span><span class="s1">colors</span><span class="s2">, </span><span class="s4">&quot;ex&quot;</span><span class="s2">: </span><span class="s1">explode</span><span class="s2">}</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s4">&quot;ex&quot;</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s4">&quot;l&quot;</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">&quot;c&quot;</span><span class="s2">,</span>
           <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
           <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">}, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>

    <span class="s3"># And again to test the pyplot functions which should also be able to be</span>
    <span class="s3"># called with a data kwarg</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s4">&quot;s&quot;</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s4">&quot;ex&quot;</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s4">&quot;l&quot;</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s4">&quot;c&quot;</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">}, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_center_radius.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.01</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_center_radius</span><span class="s2">():</span>
    <span class="s3"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s4">'Frogs'</span><span class="s2">, </span><span class="s4">'Hogs'</span><span class="s2">, </span><span class="s4">'Dogs'</span><span class="s2">, </span><span class="s4">'Logs'</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)  </span><span class="s3"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">}, </span><span class="s1">center</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s1">radius</span><span class="s2">=</span><span class="s5">1.5</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s4">&quot;Center point&quot;</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1.3</span><span class="s2">),</span>
                 <span class="s1">arrowprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">arrowstyle</span><span class="s2">=</span><span class="s4">&quot;-&gt;&quot;</span><span class="s2">,</span>
                                 <span class="s1">connectionstyle</span><span class="s2">=</span><span class="s4">&quot;arc3&quot;</span><span class="s2">),</span>
                 <span class="s1">bbox</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">boxstyle</span><span class="s2">=</span><span class="s4">&quot;square&quot;</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;lightgrey&quot;</span><span class="s2">))</span>
    <span class="s3"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_linewidth_2.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.01</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_linewidth_2</span><span class="s2">():</span>
    <span class="s3"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s4">'Frogs'</span><span class="s2">, </span><span class="s4">'Hogs'</span><span class="s2">, </span><span class="s4">'Dogs'</span><span class="s2">, </span><span class="s4">'Logs'</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)  </span><span class="s3"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">2</span><span class="s2">})</span>
    <span class="s3"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_ccw_true.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.01</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_ccw_true</span><span class="s2">():</span>
    <span class="s3"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s4">'Frogs'</span><span class="s2">, </span><span class="s4">'Hogs'</span><span class="s2">, </span><span class="s4">'Dogs'</span><span class="s2">, </span><span class="s4">'Logs'</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)  </span><span class="s3"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">counterclock</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s3"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_frame_grid.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.002</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_frame_grid</span><span class="s2">():</span>
    <span class="s3"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s4">'Frogs'</span><span class="s2">, </span><span class="s4">'Hogs'</span><span class="s2">, </span><span class="s4">'Dogs'</span><span class="s2">, </span><span class="s4">'Logs'</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s3"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">},</span>
            <span class="s1">frame</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">[::-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">},</span>
            <span class="s1">frame</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">[::-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">},</span>
            <span class="s1">frame</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">center</span><span class="s2">=(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
    <span class="s3"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_rotatelabels_true.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.009</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_rotatelabels_true</span><span class="s2">():</span>
    <span class="s3"># The slices will be ordered and plotted counter-clockwise.</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s4">'Hogwarts'</span><span class="s2">, </span><span class="s4">'Frogs'</span><span class="s2">, </span><span class="s4">'Dogs'</span><span class="s2">, </span><span class="s4">'Logs'</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)  </span><span class="s3"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
            <span class="s1">rotatelabels</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s3"># Set aspect ratio to be equal so that pie is drawn as a circle.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_no_label.png'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.01</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_nolabel_but_legend</span><span class="s2">():</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s4">'Frogs'</span><span class="s2">, </span><span class="s4">'Hogs'</span><span class="s2">, </span><span class="s4">'Dogs'</span><span class="s2">, </span><span class="s4">'Logs'</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)  </span><span class="s3"># only &quot;explode&quot; the 2nd slice (i.e. 'Hogs')</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
            <span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%1.1f%%'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">, </span><span class="s1">labeldistance</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
            <span class="s1">rotatelabels</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylim</span><span class="s2">(-</span><span class="s5">1.2</span><span class="s2">, </span><span class="s5">1.2</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'pie_shadow.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.002</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pie_shadow</span><span class="s2">():</span>
    <span class="s3"># Also acts as a test for the shade argument of Shadow</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s5">15</span><span class="s2">, </span><span class="s5">30</span><span class="s2">, </span><span class="s5">45</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s4">'yellowgreen'</span><span class="s2">, </span><span class="s4">'gold'</span><span class="s2">, </span><span class="s4">'lightskyblue'</span><span class="s2">, </span><span class="s4">'lightcoral'</span><span class="s2">]</span>
    <span class="s1">explode </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)  </span><span class="s3"># only &quot;explode&quot; the 2nd slice</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">axes </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
                   <span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
                   <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">})</span>

    <span class="s1">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">].</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
                   <span class="s1">shadow</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
                   <span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">})</span>

    <span class="s1">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
                   <span class="s1">shadow</span><span class="s2">={</span><span class="s4">'ox'</span><span class="s2">: -</span><span class="s5">0.05</span><span class="s2">, </span><span class="s4">'oy'</span><span class="s2">: -</span><span class="s5">0.05</span><span class="s2">, </span><span class="s4">'shade'</span><span class="s2">: </span><span class="s5">0.9</span><span class="s2">, </span><span class="s4">'edgecolor'</span><span class="s2">: </span><span class="s4">'none'</span><span class="s2">},</span>
                   <span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">, </span><span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">})</span>

    <span class="s1">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">][</span><span class="s5">1</span><span class="s2">].</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">explode</span><span class="s2">=</span><span class="s1">explode</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">,</span>
                   <span class="s1">shadow</span><span class="s2">={</span><span class="s4">'ox'</span><span class="s2">: </span><span class="s5">0.05</span><span class="s2">, </span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">2</span><span class="s2">, </span><span class="s4">'shade'</span><span class="s2">: </span><span class="s5">0.2</span><span class="s2">},</span>
                   <span class="s1">startangle</span><span class="s2">=</span><span class="s5">90</span><span class="s2">, </span><span class="s1">wedgeprops</span><span class="s2">={</span><span class="s4">'linewidth'</span><span class="s2">: </span><span class="s5">0</span><span class="s2">})</span>


<span class="s0">def </span><span class="s1">test_pie_textprops</span><span class="s2">():</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s5">23</span><span class="s2">, </span><span class="s5">34</span><span class="s2">, </span><span class="s5">45</span><span class="s2">]</span>
    <span class="s1">labels </span><span class="s2">= [</span><span class="s4">&quot;Long name 1&quot;</span><span class="s2">, </span><span class="s4">&quot;Long name 2&quot;</span><span class="s2">, </span><span class="s4">&quot;Long name 3&quot;</span><span class="s2">]</span>

    <span class="s1">textprops </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">horizontalalignment</span><span class="s2">=</span><span class="s4">&quot;center&quot;</span><span class="s2">,</span>
                     <span class="s1">verticalalignment</span><span class="s2">=</span><span class="s4">&quot;top&quot;</span><span class="s2">,</span>
                     <span class="s1">rotation</span><span class="s2">=</span><span class="s5">90</span><span class="s2">,</span>
                     <span class="s1">rotation_mode</span><span class="s2">=</span><span class="s4">&quot;anchor&quot;</span><span class="s2">,</span>
                     <span class="s1">size</span><span class="s2">=</span><span class="s5">12</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">&quot;red&quot;</span><span class="s2">)</span>

    <span class="s1">_</span><span class="s2">, </span><span class="s1">texts</span><span class="s2">, </span><span class="s1">autopct </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">().</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">autopct</span><span class="s2">=</span><span class="s4">'%.2f'</span><span class="s2">,</span>
                                      <span class="s1">textprops</span><span class="s2">=</span><span class="s1">textprops</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">labels </span><span class="s0">in </span><span class="s2">[</span><span class="s1">texts</span><span class="s2">, </span><span class="s1">autopct</span><span class="s2">]:</span>
        <span class="s0">for </span><span class="s1">tx </span><span class="s0">in </span><span class="s1">labels</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">tx</span><span class="s2">.</span><span class="s1">get_ha</span><span class="s2">() == </span><span class="s1">textprops</span><span class="s2">[</span><span class="s4">&quot;horizontalalignment&quot;</span><span class="s2">]</span>
            <span class="s0">assert </span><span class="s1">tx</span><span class="s2">.</span><span class="s1">get_va</span><span class="s2">() == </span><span class="s1">textprops</span><span class="s2">[</span><span class="s4">&quot;verticalalignment&quot;</span><span class="s2">]</span>
            <span class="s0">assert </span><span class="s1">tx</span><span class="s2">.</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s1">textprops</span><span class="s2">[</span><span class="s4">&quot;rotation&quot;</span><span class="s2">]</span>
            <span class="s0">assert </span><span class="s1">tx</span><span class="s2">.</span><span class="s1">get_rotation_mode</span><span class="s2">() == </span><span class="s1">textprops</span><span class="s2">[</span><span class="s4">&quot;rotation_mode&quot;</span><span class="s2">]</span>
            <span class="s0">assert </span><span class="s1">tx</span><span class="s2">.</span><span class="s1">get_size</span><span class="s2">() == </span><span class="s1">textprops</span><span class="s2">[</span><span class="s4">&quot;size&quot;</span><span class="s2">]</span>
            <span class="s0">assert </span><span class="s1">tx</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s1">textprops</span><span class="s2">[</span><span class="s4">&quot;color&quot;</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_pie_get_negative_values</span><span class="s2">():</span>
    <span class="s3"># Test the ValueError raised when feeding negative values into axes.pie</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">([</span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">], </span><span class="s1">explode</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.2</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_normalize_kwarg_pie</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">]</span>
    <span class="s1">t1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">normalize</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">t1</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][-</span><span class="s5">1</span><span class="s2">].</span><span class="s1">theta2 </span><span class="s2">- </span><span class="s5">360.</span><span class="s2">) &lt; </span><span class="s5">1e-3</span>
    <span class="s1">t2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">normalize</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">t2</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][-</span><span class="s5">1</span><span class="s2">].</span><span class="s1">theta2 </span><span class="s2">- </span><span class="s5">360.</span><span class="s2">) &gt; </span><span class="s5">1e-3</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_pie_hatch_single</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">]</span>
    <span class="s1">hatch </span><span class="s2">= </span><span class="s4">'+'</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s1">hatch</span><span class="s2">)</span>
    <span class="s1">wedges</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s2">[</span><span class="s1">w</span><span class="s2">.</span><span class="s1">set_hatch</span><span class="s2">(</span><span class="s1">hatch</span><span class="s2">) </span><span class="s0">for </span><span class="s1">w </span><span class="s0">in </span><span class="s1">wedges</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_pie_hatch_multi</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">]</span>
    <span class="s1">hatch </span><span class="s2">= [</span><span class="s4">'/'</span><span class="s2">, </span><span class="s4">'+'</span><span class="s2">, </span><span class="s4">'.'</span><span class="s2">]</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s1">hatch</span><span class="s2">)</span>
    <span class="s1">wedges</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s2">[</span><span class="s1">w</span><span class="s2">.</span><span class="s1">set_hatch</span><span class="s2">(</span><span class="s1">hp</span><span class="s2">) </span><span class="s0">for </span><span class="s1">w</span><span class="s2">, </span><span class="s1">hp </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">wedges</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">)]</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'set_get_ticklabels.png'</span><span class="s2">],</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.025 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_set_get_ticklabels</span><span class="s2">():</span>
    <span class="s3"># test issue 2246</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ha </span><span class="s2">= [</span><span class="s4">'normal'</span><span class="s2">, </span><span class="s4">'set_x/yticklabels'</span><span class="s2">]</span>

    <span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_title</span><span class="s2">(</span><span class="s1">ha</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>

    <span class="s1">ax</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_title</span><span class="s2">(</span><span class="s1">ha</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>

    <span class="s3"># set ticklabel to 1 plot in normal way</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_xticks</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_yticks</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_xticklabels</span><span class="s2">([</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'c'</span><span class="s2">, </span><span class="s4">'d'</span><span class="s2">] + </span><span class="s5">6 </span><span class="s2">* [</span><span class="s4">''</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_yticklabels</span><span class="s2">([</span><span class="s4">'11'</span><span class="s2">, </span><span class="s4">'12'</span><span class="s2">, </span><span class="s4">'13'</span><span class="s2">, </span><span class="s4">'14'</span><span class="s2">] + </span><span class="s5">6 </span><span class="s2">* [</span><span class="s4">''</span><span class="s2">])</span>

    <span class="s3"># set ticklabel to the other plot, expect the 2 plots have same label</span>
    <span class="s3"># setting pass get_ticklabels return value as ticklabels argument</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_xticks</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_xticks</span><span class="s2">())</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_yticks</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_yticks</span><span class="s2">())</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_xticklabels</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_xticklabels</span><span class="s2">())</span>
    <span class="s1">ax</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_yticklabels</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_yticklabels</span><span class="s2">())</span>


<span class="s0">def </span><span class="s1">test_set_ticks_kwargs_raise_error_without_labels</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    When labels=None and any kwarg is passed, axis.set_ticks() raises a 
    ValueError. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ticks </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Incorrect use of keyword argument 'alpha'&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">(</span><span class="s1">ticks</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_set_ticks_with_labels</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot; 
    Test that these two are identical:: 
 
        set_xticks(ticks); set_xticklabels(labels, **kwargs) 
        set_xticks(ticks, labels, **kwargs) 
 
    &quot;&quot;&quot;</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticklabels</span><span class="s2">([</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'c'</span><span class="s2">, </span><span class="s4">'d'</span><span class="s2">], </span><span class="s1">fontweight</span><span class="s2">=</span><span class="s4">'bold'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">minor</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticklabels</span><span class="s2">([</span><span class="s4">'A'</span><span class="s2">, </span><span class="s4">'B'</span><span class="s2">], </span><span class="s1">minor</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], [</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'c'</span><span class="s2">, </span><span class="s4">'d'</span><span class="s2">], </span><span class="s1">fontweight</span><span class="s2">=</span><span class="s4">'bold'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yticks</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s4">'A'</span><span class="s2">, </span><span class="s4">'B'</span><span class="s2">], </span><span class="s1">minor</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_xticks_bad_args</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'must be a sequence'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">9</span><span class="s2">], </span><span class="s5">3.1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'must be 1D'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xticks</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'must be 1D'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xticks</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'must be 1D'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xticks</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)), </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'must be 1D'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xticks</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)), </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_subsampled_ticklabels</span><span class="s2">():</span>
    <span class="s3"># test issue 11937</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">) + </span><span class="s5">0.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">locator_params</span><span class="s2">(</span><span class="s1">nbins</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticklabels</span><span class="s2">([</span><span class="s1">c </span><span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s4">&quot;bcdefghijk&quot;</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">labels </span><span class="s2">= [</span><span class="s1">t</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_ticklabels</span><span class="s2">()]</span>
    <span class="s0">assert </span><span class="s1">labels </span><span class="s2">== [</span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'d'</span><span class="s2">, </span><span class="s4">'f'</span><span class="s2">, </span><span class="s4">'h'</span><span class="s2">, </span><span class="s4">'j'</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_mismatched_ticklabels</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticks</span><span class="s2">([</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticklabels</span><span class="s2">([</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'c'</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_empty_ticks_fixed_loc</span><span class="s2">():</span>
    <span class="s3"># Smoke test that [] can be used to unset all tick labels</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticklabels</span><span class="s2">([])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'retain_tick_visibility.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_retain_tick_visibility</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">4</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">setp</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">(), </span><span class="s1">visible</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">&quot;y&quot;</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">&quot;both&quot;</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_warn_too_few_labels</span><span class="s2">():</span>
    <span class="s3"># note that the axis is still using an AutoLocator:</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span>
           <span class="s1">UserWarning</span><span class="s2">,</span>
           <span class="s1">match</span><span class="s2">=</span><span class="s4">r'set_ticklabels\(\) should only be used with a fixed number'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticklabels</span><span class="s2">([</span><span class="s4">'0'</span><span class="s2">, </span><span class="s4">'0.1'</span><span class="s2">])</span>
    <span class="s3"># note that the axis is still using a FixedLocator:</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s4">'The number of FixedLocator locations'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticklabels</span><span class="s2">([</span><span class="s4">'0'</span><span class="s2">, </span><span class="s4">'0.1'</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_tick_label_update</span><span class="s2">():</span>
    <span class="s3"># test issue 9397</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s3"># Set up a dummy formatter</span>
    <span class="s0">def </span><span class="s1">formatter_func</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s4">&quot;unit value&quot; </span><span class="s0">if </span><span class="s1">x </span><span class="s2">== </span><span class="s5">1 </span><span class="s0">else </span><span class="s4">&quot;&quot;</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">FuncFormatter</span><span class="s2">(</span><span class="s1">formatter_func</span><span class="s2">))</span>

    <span class="s3"># Force some of the x-axis ticks to be outside of the drawn range</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">tick_texts </span><span class="s2">= [</span><span class="s1">tick</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_ticklabels</span><span class="s2">()]</span>
    <span class="s0">assert </span><span class="s1">tick_texts </span><span class="s2">== [</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s4">&quot;unit value&quot;</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'o_marker_path_snap.png'</span><span class="s2">], </span><span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">72</span><span class="s2">})</span>
<span class="s0">def </span><span class="s1">test_o_marker_path_snap</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">.1</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ms </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">15</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, ], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">2</span><span class="s2">) + </span><span class="s1">ms</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s1">ms</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">ms </span><span class="s0">in </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">25</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, ], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">2</span><span class="s2">) + </span><span class="s1">ms</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">, </span><span class="s1">ms</span><span class="s2">=</span><span class="s1">ms</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_margins</span><span class="s2">():</span>
    <span class="s3"># test all ways margins can be called</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]</span>
    <span class="s1">xmin </span><span class="s2">= </span><span class="s5">0.0</span>
    <span class="s1">xmax </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) - </span><span class="s5">1.0</span>
    <span class="s1">ymin </span><span class="s2">= </span><span class="s1">min</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ymax </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>

    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">() == (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s1">xmin </span><span class="s2">- (</span><span class="s1">xmax </span><span class="s2">- </span><span class="s1">xmin</span><span class="s2">) * </span><span class="s5">1</span><span class="s2">,</span>
                              <span class="s1">xmax </span><span class="s2">+ (</span><span class="s1">xmax </span><span class="s2">- </span><span class="s1">xmin</span><span class="s2">) * </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s1">ymin </span><span class="s2">- (</span><span class="s1">ymax </span><span class="s2">- </span><span class="s1">ymin</span><span class="s2">) * </span><span class="s5">1</span><span class="s2">,</span>
                              <span class="s1">ymax </span><span class="s2">+ (</span><span class="s1">ymax </span><span class="s2">- </span><span class="s1">ymin</span><span class="s2">) * </span><span class="s5">1</span><span class="s2">)</span>

    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">() == (</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s1">xmin </span><span class="s2">- (</span><span class="s1">xmax </span><span class="s2">- </span><span class="s1">xmin</span><span class="s2">) * </span><span class="s5">0.5</span><span class="s2">,</span>
                              <span class="s1">xmax </span><span class="s2">+ (</span><span class="s1">xmax </span><span class="s2">- </span><span class="s1">xmin</span><span class="s2">) * </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s1">ymin </span><span class="s2">- (</span><span class="s1">ymax </span><span class="s2">- </span><span class="s1">ymin</span><span class="s2">) * </span><span class="s5">2</span><span class="s2">,</span>
                              <span class="s1">ymax </span><span class="s2">+ (</span><span class="s1">ymax </span><span class="s2">- </span><span class="s1">ymin</span><span class="s2">) * </span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">fig3</span><span class="s2">, </span><span class="s1">ax3 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=-</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">() == (-</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s1">xmin </span><span class="s2">- (</span><span class="s1">xmax </span><span class="s2">- </span><span class="s1">xmin</span><span class="s2">) * -</span><span class="s5">0.2</span><span class="s2">,</span>
                              <span class="s1">xmax </span><span class="s2">+ (</span><span class="s1">xmax </span><span class="s2">- </span><span class="s1">xmin</span><span class="s2">) * -</span><span class="s5">0.2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax3</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s1">ymin </span><span class="s2">- (</span><span class="s1">ymax </span><span class="s2">- </span><span class="s1">ymin</span><span class="s2">) * </span><span class="s5">0.5</span><span class="s2">,</span>
                              <span class="s1">ymax </span><span class="s2">+ (</span><span class="s1">ymax </span><span class="s2">- </span><span class="s1">ymin</span><span class="s2">) * </span><span class="s5">0.5</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_margin_getters</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xmargin</span><span class="s2">() == </span><span class="s5">0.2</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ymargin</span><span class="s2">() == </span><span class="s5">0.3</span>


<span class="s0">def </span><span class="s1">test_set_margin_updates_limits</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">use</span><span class="s2">(</span><span class="s4">&quot;default&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xscale</span><span class="s2">=</span><span class="s4">&quot;log&quot;</span><span class="s2">, </span><span class="s1">xmargin</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'err, args, kwargs, match'</span><span class="s2">, (</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, (-</span><span class="s5">1</span><span class="s2">,), {}, </span><span class="s4">r'margin must be greater than -0\.5'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">), {}, </span><span class="s4">r'margin must be greater than -0\.5'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">(), {</span><span class="s4">'x'</span><span class="s2">: -</span><span class="s5">1</span><span class="s2">}, </span><span class="s4">r'margin must be greater than -0\.5'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">(), {</span><span class="s4">'y'</span><span class="s2">: -</span><span class="s5">1</span><span class="s2">}, </span><span class="s4">r'margin must be greater than -0\.5'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, ), {</span><span class="s4">'x'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">},</span>
         <span class="s4">'Cannot pass both positional and keyword arguments for x and/or y'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, ), {</span><span class="s4">'x'</span><span class="s2">: </span><span class="s5">1</span><span class="s2">},</span>
         <span class="s4">'Cannot pass both positional and keyword arguments for x and/or y'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), {}, </span><span class="s4">'Must pass a single positional argument'</span><span class="s2">),</span>
<span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_margins_errors</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">match</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">match</span><span class="s2">):</span>
        <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_length_one_hist</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s5">1</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_set_xy_bound</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xbound</span><span class="s2">(</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">() == (</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xbound</span><span class="s2">(</span><span class="s1">upper</span><span class="s2">=</span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">() == (</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xbound</span><span class="s2">(</span><span class="s1">lower</span><span class="s2">=</span><span class="s5">3.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">() == (</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ybound</span><span class="s2">(</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">() == (</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ybound</span><span class="s2">(</span><span class="s1">upper</span><span class="s2">=</span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">() == (</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ybound</span><span class="s2">(</span><span class="s1">lower</span><span class="s2">=</span><span class="s5">3.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">() == (</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pathological_hexbin</span><span class="s2">():</span>
    <span class="s3"># issue #2863</span>
    <span class="s1">mylist </span><span class="s2">= [</span><span class="s5">10</span><span class="s2">] * </span><span class="s5">100</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hexbin</span><span class="s2">(</span><span class="s1">mylist</span><span class="s2">, </span><span class="s1">mylist</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">())  </span><span class="s3"># Check that no warning is emitted.</span>


<span class="s0">def </span><span class="s1">test_color_None</span><span class="s2">():</span>
    <span class="s3"># issue 3855</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_color_alias</span><span class="s2">():</span>
    <span class="s3"># issues 4157 and 4162</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'lime'</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s4">'lime' </span><span class="s2">== </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_numerical_hist_label</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s1">range</span><span class="s2">(</span><span class="s5">15</span><span class="s2">)] * </span><span class="s5">5</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_unicode_hist_label</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">a </span><span class="s2">= (</span><span class="s7">b'</span><span class="s0">\xe5\xbe\x88\xe6\xbc\x82\xe4\xba\xae</span><span class="s7">, ' </span><span class="s2">+</span>
         <span class="s7">b'r</span><span class="s0">\xc3\xb6</span><span class="s7">m</span><span class="s0">\xc3\xa4</span><span class="s7">n ch</span><span class="s0">\xc3\xa4</span><span class="s7">r</span><span class="s0">\xc3\xa1</span><span class="s7">ct</span><span class="s0">\xc3\xa8</span><span class="s7">rs'</span><span class="s2">)</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s7">b'</span><span class="s0">\xd7\xa9\xd7\x9c\xd7\x95\xd7\x9d</span><span class="s7">'</span>
    <span class="s1">labels </span><span class="s2">= [</span><span class="s1">a</span><span class="s2">.</span><span class="s1">decode</span><span class="s2">(</span><span class="s4">'utf-8'</span><span class="s2">),</span>
              <span class="s4">'hi aardvark'</span><span class="s2">,</span>
              <span class="s1">b</span><span class="s2">.</span><span class="s1">decode</span><span class="s2">(</span><span class="s4">'utf-8'</span><span class="s2">),</span>
              <span class="s2">]</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s1">range</span><span class="s2">(</span><span class="s5">15</span><span class="s2">)] * </span><span class="s5">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_move_offsetlabel</span><span class="s2">():</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s5">10</span><span class="s2">) * </span><span class="s5">1e-22</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">before </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'left'</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">tick_right</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">after </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">after</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] &gt; </span><span class="s1">before</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">and </span><span class="s1">after</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] == </span><span class="s1">before</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'right'</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">before </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'top'</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">tick_top</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">after </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">after</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s1">before</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">and </span><span class="s1">after</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] &gt; </span><span class="s1">before</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'bottom'</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'rc_spines.png'</span><span class="s2">], </span><span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">})</span>
<span class="s0">def </span><span class="s1">test_rc_spines</span><span class="s2">():</span>
    <span class="s1">rc_dict </span><span class="s2">= {</span>
        <span class="s4">'axes.spines.left'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">'axes.spines.right'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">'axes.spines.top'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">'axes.spines.bottom'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}</span>
    <span class="s0">with </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc_dict</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()  </span><span class="s3"># create a figure and axes with the spine properties</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'rc_grid.png'</span><span class="s2">], </span><span class="s1">savefig_kwarg</span><span class="s2">={</span><span class="s4">'dpi'</span><span class="s2">: </span><span class="s5">40</span><span class="s2">})</span>
<span class="s0">def </span><span class="s1">test_rc_grid</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">rc_dict0 </span><span class="s2">= {</span>
        <span class="s4">'axes.grid'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">'axes.grid.axis'</span><span class="s2">: </span><span class="s4">'both'</span>
    <span class="s2">}</span>
    <span class="s1">rc_dict1 </span><span class="s2">= {</span>
        <span class="s4">'axes.grid'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">'axes.grid.axis'</span><span class="s2">: </span><span class="s4">'x'</span>
    <span class="s2">}</span>
    <span class="s1">rc_dict2 </span><span class="s2">= {</span>
        <span class="s4">'axes.grid'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">'axes.grid.axis'</span><span class="s2">: </span><span class="s4">'y'</span>
    <span class="s2">}</span>
    <span class="s1">dict_list </span><span class="s2">= [</span><span class="s1">rc_dict0</span><span class="s2">, </span><span class="s1">rc_dict1</span><span class="s2">, </span><span class="s1">rc_dict2</span><span class="s2">]</span>

    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">rc_dict </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">dict_list</span><span class="s2">, </span><span class="s5">1</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc_dict</span><span class="s2">):</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_rc_tick</span><span class="s2">():</span>
    <span class="s1">d </span><span class="s2">= {</span><span class="s4">'xtick.bottom'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">, </span><span class="s4">'xtick.top'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
         <span class="s4">'ytick.left'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">, </span><span class="s4">'ytick.right'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}</span>
    <span class="s0">with </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">=</span><span class="s1">d</span><span class="s2">):</span>
        <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
        <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">xax </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">xaxis</span>
        <span class="s1">yax </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis</span>
        <span class="s3"># tick1On bottom/left</span>
        <span class="s0">assert not </span><span class="s1">xax</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">[</span><span class="s4">'tick1On'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">xax</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">[</span><span class="s4">'tick2On'</span><span class="s2">]</span>
        <span class="s0">assert not </span><span class="s1">xax</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">[</span><span class="s4">'tick1On'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">xax</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">[</span><span class="s4">'tick2On'</span><span class="s2">]</span>

        <span class="s0">assert </span><span class="s1">yax</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">[</span><span class="s4">'tick1On'</span><span class="s2">]</span>
        <span class="s0">assert not </span><span class="s1">yax</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">[</span><span class="s4">'tick2On'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">yax</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">[</span><span class="s4">'tick1On'</span><span class="s2">]</span>
        <span class="s0">assert not </span><span class="s1">yax</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">[</span><span class="s4">'tick2On'</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_rc_major_minor_tick</span><span class="s2">():</span>
    <span class="s1">d </span><span class="s2">= {</span><span class="s4">'xtick.top'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">, </span><span class="s4">'ytick.right'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,  </span><span class="s3"># Enable all ticks</span>
         <span class="s4">'xtick.bottom'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">, </span><span class="s4">'ytick.left'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
         <span class="s3"># Selectively disable</span>
         <span class="s4">'xtick.minor.bottom'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">, </span><span class="s4">'xtick.major.bottom'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
         <span class="s4">'ytick.major.left'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">, </span><span class="s4">'ytick.minor.left'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}</span>
    <span class="s0">with </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">=</span><span class="s1">d</span><span class="s2">):</span>
        <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
        <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">xax </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">xaxis</span>
        <span class="s1">yax </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">yaxis</span>
        <span class="s3"># tick1On bottom/left</span>
        <span class="s0">assert not </span><span class="s1">xax</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">[</span><span class="s4">'tick1On'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">xax</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">[</span><span class="s4">'tick2On'</span><span class="s2">]</span>
        <span class="s0">assert not </span><span class="s1">xax</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">[</span><span class="s4">'tick1On'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">xax</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">[</span><span class="s4">'tick2On'</span><span class="s2">]</span>

        <span class="s0">assert not </span><span class="s1">yax</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">[</span><span class="s4">'tick1On'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">yax</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">[</span><span class="s4">'tick2On'</span><span class="s2">]</span>
        <span class="s0">assert not </span><span class="s1">yax</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">[</span><span class="s4">'tick1On'</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">yax</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">[</span><span class="s4">'tick2On'</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_square_plot</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">, </span><span class="s5">5.</span><span class="s2">, </span><span class="s5">7.</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s4">'mo'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'square'</span><span class="s2">)</span>
    <span class="s1">xlim</span><span class="s2">, </span><span class="s1">ylim </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">) == </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">ylim</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_aspect</span><span class="s2">() == </span><span class="s5">1</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">original</span><span class="s2">=</span><span class="s0">True</span><span class="s2">).</span><span class="s1">extents</span><span class="s2">, (</span><span class="s5">0.125</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">))</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">(</span><span class="s1">original</span><span class="s2">=</span><span class="s0">False</span><span class="s2">).</span><span class="s1">extents</span><span class="s2">, (</span><span class="s5">0.2125</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.8125</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_bad_plot_args</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;xy, cls&quot;</span><span class="s2">, [</span>
        <span class="s2">((), </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">image</span><span class="s2">.</span><span class="s1">AxesImage</span><span class="s2">),  </span><span class="s3"># (0, N)</span>
        <span class="s2">(((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">7</span><span class="s2">), (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">6</span><span class="s2">)), </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">image</span><span class="s2">.</span><span class="s1">AxesImage</span><span class="s2">),  </span><span class="s3"># (xmin, xmax)</span>
        <span class="s2">((</span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">)), </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">image</span><span class="s2">.</span><span class="s1">AxesImage</span><span class="s2">),  </span><span class="s3"># regular grid</span>
        <span class="s2">(([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">16</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]),  </span><span class="s3"># irregular grid</span>
         <span class="s1">mpl</span><span class="s2">.</span><span class="s1">image</span><span class="s2">.</span><span class="s1">PcolorImage</span><span class="s2">),</span>
        <span class="s2">((</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))),  </span><span class="s3"># 2D coords</span>
         <span class="s1">mpl</span><span class="s2">.</span><span class="s1">collections</span><span class="s2">.</span><span class="s1">QuadMesh</span><span class="s2">),</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">&quot;data&quot;</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">12</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_pcolorfast</span><span class="s2">(</span><span class="s1">xy</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">cls</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">type</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolorfast</span><span class="s2">(*</span><span class="s1">xy</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)) == </span><span class="s1">cls</span>


<span class="s0">def </span><span class="s1">test_pcolorfast_bad_dims</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s4">&quot;the given X was 1D and the given Y was 2D&quot;</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolorfast</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">(</span><span class="s5">6</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s5">4</span><span class="s2">, </span><span class="s5">7</span><span class="s2">)), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s5">8</span><span class="s2">, </span><span class="s5">8</span><span class="s2">)))</span>


<span class="s0">def </span><span class="s1">test_shared_scale</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yscale</span><span class="s2">() == </span><span class="s4">'log'</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xscale</span><span class="s2">() == </span><span class="s4">'log'</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">&quot;linear&quot;</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">&quot;linear&quot;</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yscale</span><span class="s2">() == </span><span class="s4">'linear'</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xscale</span><span class="s2">() == </span><span class="s4">'linear'</span>


<span class="s0">def </span><span class="s1">test_shared_bool</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_violin_point_mass</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Violin plot should handle point mass pdf gracefully.&quot;&quot;&quot;</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">violinplot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]))</span>


<span class="s0">def </span><span class="s1">generate_errorbar_inputs</span><span class="s2">():</span>
    <span class="s1">base_xy </span><span class="s2">= </span><span class="s1">cycler</span><span class="s2">(</span><span class="s4">'x'</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)]) + </span><span class="s1">cycler</span><span class="s2">(</span><span class="s4">'y'</span><span class="s2">, [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)])</span>
    <span class="s1">err_cycler </span><span class="s2">= </span><span class="s1">cycler</span><span class="s2">(</span><span class="s4">'err'</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">,</span>
                                <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                                <span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">],</span>
                                 <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]],</span>
                                <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">5</span><span class="s2">),</span>
                                <span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)),</span>
                                <span class="s0">None</span>
                                <span class="s2">])</span>
    <span class="s1">xerr_cy </span><span class="s2">= </span><span class="s1">cycler</span><span class="s2">(</span><span class="s4">'xerr'</span><span class="s2">, </span><span class="s1">err_cycler</span><span class="s2">)</span>
    <span class="s1">yerr_cy </span><span class="s2">= </span><span class="s1">cycler</span><span class="s2">(</span><span class="s4">'yerr'</span><span class="s2">, </span><span class="s1">err_cycler</span><span class="s2">)</span>

    <span class="s1">empty </span><span class="s2">= ((</span><span class="s1">cycler</span><span class="s2">(</span><span class="s4">'x'</span><span class="s2">, [[]]) + </span><span class="s1">cycler</span><span class="s2">(</span><span class="s4">'y'</span><span class="s2">, [[]])) *</span>
             <span class="s1">cycler</span><span class="s2">(</span><span class="s4">'xerr'</span><span class="s2">, [[], </span><span class="s0">None</span><span class="s2">]) * </span><span class="s1">cycler</span><span class="s2">(</span><span class="s4">'yerr'</span><span class="s2">, [[], </span><span class="s0">None</span><span class="s2">]))</span>
    <span class="s1">xerr_only </span><span class="s2">= </span><span class="s1">base_xy </span><span class="s2">* </span><span class="s1">xerr_cy</span>
    <span class="s1">yerr_only </span><span class="s2">= </span><span class="s1">base_xy </span><span class="s2">* </span><span class="s1">yerr_cy</span>
    <span class="s1">both_err </span><span class="s2">= </span><span class="s1">base_xy </span><span class="s2">* </span><span class="s1">yerr_cy </span><span class="s2">* </span><span class="s1">xerr_cy</span>

    <span class="s0">return </span><span class="s2">[*</span><span class="s1">xerr_only</span><span class="s2">, *</span><span class="s1">yerr_only</span><span class="s2">, *</span><span class="s1">both_err</span><span class="s2">, *</span><span class="s1">empty</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'kwargs'</span><span class="s2">, </span><span class="s1">generate_errorbar_inputs</span><span class="s2">())</span>
<span class="s0">def </span><span class="s1">test_errorbar_inputs_shotgun</span><span class="s2">(</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">eb </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s1">eb</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;dash_offset&quot;</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_dash_offset</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">100</span><span class="s2">, </span><span class="s5">2</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">j</span><span class="s2">*</span><span class="s1">y</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=(</span><span class="s1">j</span><span class="s2">, (</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)), </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_title_pad</span><span class="s2">():</span>
    <span class="s3"># check that title padding puts the title in the right</span>
    <span class="s3"># place...</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'aardvark'</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=</span><span class="s5">30.</span><span class="s2">)</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">titleOffsetTrans</span><span class="s2">.</span><span class="s1">get_matrix</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">m</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">] == (</span><span class="s5">30. </span><span class="s2">/ </span><span class="s5">72. </span><span class="s2">* </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">dpi</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'aardvark'</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=</span><span class="s5">0.</span><span class="s2">)</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">titleOffsetTrans</span><span class="s2">.</span><span class="s1">get_matrix</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">m</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">] == </span><span class="s5">0.</span>
    <span class="s3"># check that it is reverted...</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'aardvark'</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">titleOffsetTrans</span><span class="s2">.</span><span class="s1">get_matrix</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">m</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">] == (</span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.titlepad'</span><span class="s2">] / </span><span class="s5">72. </span><span class="s2">* </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">dpi</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_title_location_roundtrip</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># set default title location</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.titlelocation'</span><span class="s2">] = </span><span class="s4">'center'</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'aardvark'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'left'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'right'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s4">'left' </span><span class="s2">== </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s4">'right' </span><span class="s2">== </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'right'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s4">'aardvark' </span><span class="s2">== </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'foo'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'fail'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'foo'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'sharex'</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_title_location_shared</span><span class="s2">(</span><span class="s1">sharex</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s1">sharex</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'A'</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=-</span><span class="s5">40</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'B'</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=-</span><span class="s5">40</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y2 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">y1 </span><span class="s2">== </span><span class="s1">y2 </span><span class="s2">== </span><span class="s5">1.0</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;loglog.png&quot;</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">0.02</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_loglog</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">11</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">**</span><span class="s5">3</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">length</span><span class="s2">=</span><span class="s5">25</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">length</span><span class="s2">=</span><span class="s5">15</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;test_loglog_nonpos.png&quot;</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.029 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_loglog_nonpos</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">11</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">x</span><span class="s2">**</span><span class="s5">3</span>
    <span class="s1">y</span><span class="s2">[</span><span class="s5">7</span><span class="s2">] = -</span><span class="s5">3.</span>
    <span class="s1">x</span><span class="s2">[</span><span class="s5">4</span><span class="s2">] = -</span><span class="s5">10</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s1">mcy</span><span class="s2">, </span><span class="s1">mcx</span><span class="s2">), </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">product</span><span class="s2">([</span><span class="s4">'mask'</span><span class="s2">, </span><span class="s4">'clip'</span><span class="s2">, </span><span class="s4">''</span><span class="s2">], </span><span class="s1">repeat</span><span class="s2">=</span><span class="s5">2</span><span class="s2">),</span>
                              <span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">mcx </span><span class="s2">== </span><span class="s1">mcy</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">mcx</span><span class="s2">:</span>
                <span class="s1">ax</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">**</span><span class="s5">3</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">nonpositive</span><span class="s2">=</span><span class="s1">mcx</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">ax</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">**</span><span class="s5">3</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">**</span><span class="s5">3</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">mcx</span><span class="s2">:</span>
                <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">, </span><span class="s1">nonpositive</span><span class="s2">=</span><span class="s1">mcx</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">mcy</span><span class="s2">:</span>
                <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">, </span><span class="s1">nonpositive</span><span class="s2">=</span><span class="s1">mcy</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_axes_margins</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">] != </span><span class="s5">0</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">] == </span><span class="s5">0</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">] == </span><span class="s5">0</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)))</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">() == (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">() == (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolorfast</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)))</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">() == (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">() == (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">] == </span><span class="s5">0</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)))</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xbound</span><span class="s2">() == (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">9.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ybound</span><span class="s2">() == (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">9.5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">params</span><span class="s2">=[</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">shared_axis_remover</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">_helper_x</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
        <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
        <span class="s1">ax2</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">15</span><span class="s2">)</span>
        <span class="s1">r </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_major_locator</span><span class="s2">()()</span>
        <span class="s0">assert </span><span class="s1">r</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] &gt; </span><span class="s5">14</span>

    <span class="s0">def </span><span class="s1">_helper_y</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">):</span>
        <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twiny</span><span class="s2">()</span>
        <span class="s1">ax2</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">15</span><span class="s2">)</span>
        <span class="s1">r </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_locator</span><span class="s2">()()</span>
        <span class="s0">assert </span><span class="s1">r</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] &gt; </span><span class="s5">14</span>

    <span class="s0">return </span><span class="s2">{</span><span class="s4">&quot;x&quot;</span><span class="s2">: </span><span class="s1">_helper_x</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">: </span><span class="s1">_helper_y</span><span class="s2">}[</span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">params</span><span class="s2">=[</span><span class="s4">'gca'</span><span class="s2">, </span><span class="s4">'subplots'</span><span class="s2">, </span><span class="s4">'subplots_shared'</span><span class="s2">, </span><span class="s4">'add_axes'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">shared_axes_generator</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s3"># test all of the ways to get fig/ax sets</span>
    <span class="s0">if </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param </span><span class="s2">== </span><span class="s4">'gca'</span><span class="s2">:</span>
        <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s0">elif </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param </span><span class="s2">== </span><span class="s4">'subplots'</span><span class="s2">:</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">elif </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param </span><span class="s2">== </span><span class="s4">'subplots_shared'</span><span class="s2">:</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax_lst </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s4">'all'</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s4">'all'</span><span class="s2">)</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">ax_lst</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s0">elif </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param </span><span class="s2">== </span><span class="s4">'add_axes'</span><span class="s2">:</span>
        <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.8</span><span class="s2">, </span><span class="s5">.8</span><span class="s2">])</span>
    <span class="s0">return </span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span>


<span class="s0">def </span><span class="s1">test_remove_shared_axes</span><span class="s2">(</span><span class="s1">shared_axes_generator</span><span class="s2">, </span><span class="s1">shared_axis_remover</span><span class="s2">):</span>
    <span class="s3"># test all of the ways to get fig/ax sets</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">shared_axes_generator</span>
    <span class="s1">shared_axis_remover</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_remove_shared_axes_relim</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax_lst </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s4">'all'</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s4">'all'</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">ax_lst</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">orig_xlim </span><span class="s2">= </span><span class="s1">ax_lst</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">ax_lst</span><span class="s2">[</span><span class="s5">0</span><span class="s2">][</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">orig_xlim</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_shared_axes_autoscale</span><span class="s2">():</span>
    <span class="s1">l </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s5">80</span><span class="s2">, </span><span class="s5">90</span><span class="s2">, </span><span class="s5">40</span><span class="s2">)</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random_sample</span><span class="s2">((</span><span class="s1">l</span><span class="s2">.</span><span class="s1">size</span><span class="s2">, </span><span class="s1">l</span><span class="s2">.</span><span class="s1">size</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s5">1000</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s5">1000</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s1">l</span><span class="s2">, </span><span class="s1">t</span><span class="s2">)</span>

    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">contour</span><span class="s2">(</span><span class="s1">l</span><span class="s2">, </span><span class="s1">l</span><span class="s2">, </span><span class="s1">t</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_autoscalex_on</span><span class="s2">() </span><span class="s0">and not </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_autoscalex_on</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_autoscaley_on</span><span class="s2">() </span><span class="s0">and not </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_autoscaley_on</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (-</span><span class="s5">1000</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (-</span><span class="s5">1000</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_adjust_numtick_aspect</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_locator</span><span class="s2">().</span><span class="s1">set_params</span><span class="s2">(</span><span class="s1">nbins</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s4">'equal'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_locator</span><span class="s2">()()) == </span><span class="s5">2</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1000</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_locator</span><span class="s2">()()) &gt; </span><span class="s5">2</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">&quot;default&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_auto_numticks</span><span class="s2">():</span>
    <span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:  </span><span class="s3"># Tiny, empty subplots have only 3 ticks.</span>
        <span class="s0">assert </span><span class="s2">[*</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticks</span><span class="s2">()] == [*</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticks</span><span class="s2">()] == [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">&quot;default&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_auto_numticks_log</span><span class="s2">():</span>
    <span class="s3"># Verify that there are not too many ticks with a large log range.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.autolimit_mode'</span><span class="s2">] = </span><span class="s4">'round_numbers'</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">loglog</span><span class="s2">([</span><span class="s5">1e-20</span><span class="s2">, </span><span class="s5">1e5</span><span class="s2">], [</span><span class="s5">1e-16</span><span class="s2">, </span><span class="s5">10</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticks</span><span class="s2">()) == </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s5">26</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)).</span><span class="s1">all</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log10</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticks</span><span class="s2">()) == </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s5">20</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)).</span><span class="s1">all</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_broken_barh_empty</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">broken_barh</span><span class="s2">([], (</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_broken_barh_timedelta</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Check that timedelta works as x, dx pair for this method.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">d0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2018</span><span class="s2">, </span><span class="s5">11</span><span class="s2">, </span><span class="s5">9</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">pp </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">broken_barh</span><span class="s2">([(</span><span class="s1">d0</span><span class="s2">, </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s5">1</span><span class="s2">))], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">pp</span><span class="s2">.</span><span class="s1">get_paths</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">vertices</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">] == </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">d0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">pp</span><span class="s2">.</span><span class="s1">get_paths</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">vertices</span><span class="s2">[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">] == </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">d0</span><span class="s2">) + </span><span class="s5">1 </span><span class="s2">/ </span><span class="s5">24</span>


<span class="s0">def </span><span class="s1">test_pandas_pcolormesh</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s1">time </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s4">'2000-01-01'</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">depth </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">20</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s5">19</span><span class="s2">, </span><span class="s5">9</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s1">depth</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pandas_indexing_dates</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s1">dates </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">'2005-02'</span><span class="s2">, </span><span class="s4">'2005-03'</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s4">'datetime64[D]'</span><span class="s2">)</span>
    <span class="s1">values </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">)))</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">'dates'</span><span class="s2">: </span><span class="s1">dates</span><span class="s2">, </span><span class="s4">'values'</span><span class="s2">: </span><span class="s1">values</span><span class="s2">})</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>

    <span class="s1">without_zero_index </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">df</span><span class="s2">.</span><span class="s1">index</span><span class="s2">) % </span><span class="s5">2 </span><span class="s2">== </span><span class="s5">1</span><span class="s2">].</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">'dates'</span><span class="s2">, </span><span class="s4">'values'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">without_zero_index</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pandas_errorbar_indexing</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=(</span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)),</span>
                      <span class="s1">columns</span><span class="s2">=[</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">, </span><span class="s4">'xe'</span><span class="s2">, </span><span class="s4">'ye'</span><span class="s2">],</span>
                      <span class="s1">index</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">, </span><span class="s1">xerr</span><span class="s2">=</span><span class="s4">'xe'</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s4">'ye'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">df</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pandas_index_shape</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">&quot;XX&quot;</span><span class="s2">: [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">], </span><span class="s4">&quot;YY&quot;</span><span class="s2">: [</span><span class="s5">7</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]})</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">df</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">df</span><span class="s2">[</span><span class="s4">'YY'</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_pandas_indexing_hist</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s1">ser_1 </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">ser_2 </span><span class="s2">= </span><span class="s1">ser_1</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s5">1</span><span class="s2">:]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">ser_2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_pandas_bar_align_center</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s3"># Tests fix for issue 8767</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s4">'a'</span><span class="s2">: </span><span class="s1">range</span><span class="s2">(</span><span class="s5">2</span><span class="s2">), </span><span class="s4">'b'</span><span class="s2">: </span><span class="s1">range</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)})</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">df</span><span class="s2">[</span><span class="s4">'a'</span><span class="s2">] == </span><span class="s5">1</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
           <span class="s1">df</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">df</span><span class="s2">[</span><span class="s4">'a'</span><span class="s2">] == </span><span class="s5">1</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">],</span>
           <span class="s1">align</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_axis_get_tick_params</span><span class="s2">():</span>
    <span class="s1">axis </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">().</span><span class="s1">yaxis</span>
    <span class="s1">initial_major_style_translated </span><span class="s2">= {**</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">get_tick_params</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'major'</span><span class="s2">)}</span>
    <span class="s1">initial_minor_style_translated </span><span class="s2">= {**</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">get_tick_params</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">)}</span>

    <span class="s1">translated_major_kw </span><span class="s2">= </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">_translate_tick_params</span><span class="s2">(</span>
        <span class="s1">axis</span><span class="s2">.</span><span class="s1">_major_tick_kw</span><span class="s2">, </span><span class="s1">reverse</span><span class="s2">=</span><span class="s0">True</span>
    <span class="s2">)</span>
    <span class="s1">translated_minor_kw </span><span class="s2">= </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">_translate_tick_params</span><span class="s2">(</span>
        <span class="s1">axis</span><span class="s2">.</span><span class="s1">_minor_tick_kw</span><span class="s2">, </span><span class="s1">reverse</span><span class="s2">=</span><span class="s0">True</span>
    <span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">translated_major_kw </span><span class="s2">== </span><span class="s1">initial_major_style_translated</span>
    <span class="s0">assert </span><span class="s1">translated_minor_kw </span><span class="s2">== </span><span class="s1">initial_minor_style_translated</span>
    <span class="s1">axis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">labelsize</span><span class="s2">=</span><span class="s5">30</span><span class="s2">, </span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">,</span>
                         <span class="s1">direction</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">)</span>

    <span class="s1">new_major_style_translated </span><span class="s2">= {**</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">get_tick_params</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'major'</span><span class="s2">)}</span>
    <span class="s1">new_minor_style_translated </span><span class="s2">= {**</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">get_tick_params</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">)}</span>
    <span class="s1">new_major_style </span><span class="s2">= </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">_translate_tick_params</span><span class="s2">(</span><span class="s1">new_major_style_translated</span><span class="s2">)</span>
    <span class="s1">new_minor_style </span><span class="s2">= </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">_translate_tick_params</span><span class="s2">(</span><span class="s1">new_minor_style_translated</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">initial_major_style_translated </span><span class="s2">!= </span><span class="s1">new_major_style_translated</span>
    <span class="s0">assert </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">_major_tick_kw </span><span class="s2">== </span><span class="s1">new_major_style</span>
    <span class="s0">assert </span><span class="s1">initial_minor_style_translated </span><span class="s2">!= </span><span class="s1">new_minor_style_translated</span>
    <span class="s0">assert </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">_minor_tick_kw </span><span class="s2">== </span><span class="s1">new_minor_style</span>


<span class="s0">def </span><span class="s1">test_axis_set_tick_params_labelsize_labelcolor</span><span class="s2">():</span>
    <span class="s3"># Tests fix for issue 4346</span>
    <span class="s1">axis_1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
    <span class="s1">axis_1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">labelsize</span><span class="s2">=</span><span class="s5">30</span><span class="s2">, </span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">,</span>
                                 <span class="s1">direction</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">)</span>

    <span class="s3"># Expected values after setting the ticks</span>
    <span class="s0">assert </span><span class="s1">axis_1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">_size </span><span class="s2">== </span><span class="s5">4.0</span>
    <span class="s0">assert </span><span class="s1">axis_1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">tick1line</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'k'</span>
    <span class="s0">assert </span><span class="s1">axis_1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_size</span><span class="s2">() == </span><span class="s5">30.0</span>
    <span class="s0">assert </span><span class="s1">axis_1</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'red'</span>


<span class="s0">def </span><span class="s1">test_axes_tick_params_gridlines</span><span class="s2">():</span>
    <span class="s3"># Now treating grid params like other Tick params</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">grid_color</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">, </span><span class="s1">grid_linewidth</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">grid_alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">,</span>
                   <span class="s1">grid_linestyle</span><span class="s2">=</span><span class="s4">'dashdot'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'b'</span>
        <span class="s0">assert </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_linewidth</span><span class="s2">() == </span><span class="s5">5</span>
        <span class="s0">assert </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s5">0.5</span>
        <span class="s0">assert </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">gridline</span><span class="s2">.</span><span class="s1">get_linestyle</span><span class="s2">() == </span><span class="s4">'-.'</span>


<span class="s0">def </span><span class="s1">test_axes_tick_params_ylabelside</span><span class="s2">():</span>
    <span class="s3"># Tests fix for issue 10267</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">labelleft</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">labelright</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                   <span class="s1">which</span><span class="s2">=</span><span class="s4">'major'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">labelleft</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">labelright</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                   <span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">)</span>
    <span class="s3"># expects left false, right true</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label2</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">minorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">minorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label2</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() </span><span class="s0">is True</span>


<span class="s0">def </span><span class="s1">test_axes_tick_params_xlabelside</span><span class="s2">():</span>
    <span class="s3"># Tests fix for issue 10267</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">labeltop</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">labelbottom</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                   <span class="s1">which</span><span class="s2">=</span><span class="s4">'major'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">labeltop</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">labelbottom</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                   <span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">)</span>
    <span class="s3"># expects top True, bottom False</span>
    <span class="s3"># label1.get_visible() mapped to labelbottom</span>
    <span class="s3"># label2.get_visible() mapped to labeltop</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">majorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label2</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() </span><span class="s0">is True</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">minorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() </span><span class="s0">is False</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">minorTicks</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">label2</span><span class="s2">.</span><span class="s1">get_visible</span><span class="s2">() </span><span class="s0">is True</span>


<span class="s0">def </span><span class="s1">test_none_kwargs</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ln</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">32</span><span class="s2">), </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">get_linestyle</span><span class="s2">() == </span><span class="s4">'-'</span>


<span class="s0">def </span><span class="s1">test_bar_uint8</span><span class="s2">():</span>
    <span class="s1">xs </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">), [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], </span><span class="s1">align</span><span class="s2">=</span><span class="s4">&quot;edge&quot;</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s2">(</span><span class="s1">patch</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">, </span><span class="s1">xs</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">patch</span><span class="s2">.</span><span class="s1">xy</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s1">x</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'date_timezone_x.png'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">1.0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_date_timezone_x</span><span class="s2">():</span>
    <span class="s3"># Tests issue 5575</span>
    <span class="s1">time_index </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2016</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">22</span><span class="s2">, </span><span class="s1">hour</span><span class="s2">=</span><span class="s1">x</span><span class="s2">,</span>
                                    <span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">(</span><span class="s4">'Canada/Eastern'</span><span class="s2">))</span>
                  <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)]</span>

    <span class="s3"># Same Timezone</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">20</span><span class="s2">, </span><span class="s5">12</span><span class="s2">))</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot_date</span><span class="s2">(</span><span class="s1">time_index</span><span class="s2">, [</span><span class="s5">3</span><span class="s2">] * </span><span class="s5">3</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">'Canada/Eastern'</span><span class="s2">)</span>

    <span class="s3"># Different Timezone</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot_date</span><span class="s2">(</span><span class="s1">time_index</span><span class="s2">, [</span><span class="s5">3</span><span class="s2">] * </span><span class="s5">3</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">'UTC'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'date_timezone_y.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date_timezone_y</span><span class="s2">():</span>
    <span class="s3"># Tests issue 5575</span>
    <span class="s1">time_index </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2016</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">22</span><span class="s2">, </span><span class="s1">hour</span><span class="s2">=</span><span class="s1">x</span><span class="s2">,</span>
                                    <span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">(</span><span class="s4">'Canada/Eastern'</span><span class="s2">))</span>
                  <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)]</span>

    <span class="s3"># Same Timezone</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">20</span><span class="s2">, </span><span class="s5">12</span><span class="s2">))</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot_date</span><span class="s2">([</span><span class="s5">3</span><span class="s2">] * </span><span class="s5">3</span><span class="s2">, </span><span class="s1">time_index</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">'Canada/Eastern'</span><span class="s2">, </span><span class="s1">xdate</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">ydate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s3"># Different Timezone</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot_date</span><span class="s2">([</span><span class="s5">3</span><span class="s2">] * </span><span class="s5">3</span><span class="s2">, </span><span class="s1">time_index</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">'UTC'</span><span class="s2">, </span><span class="s1">xdate</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">ydate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'date_timezone_x_and_y.png'</span><span class="s2">], </span><span class="s1">tol</span><span class="s2">=</span><span class="s5">1.0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_date_timezone_x_and_y</span><span class="s2">():</span>
    <span class="s3"># Tests issue 5575</span>
    <span class="s1">UTC </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">.</span><span class="s1">utc</span>
    <span class="s1">time_index </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2016</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">22</span><span class="s2">, </span><span class="s1">hour</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">UTC</span><span class="s2">)</span>
                  <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)]</span>

    <span class="s3"># Same Timezone</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">20</span><span class="s2">, </span><span class="s5">12</span><span class="s2">))</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot_date</span><span class="s2">(</span><span class="s1">time_index</span><span class="s2">, </span><span class="s1">time_index</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">'UTC'</span><span class="s2">, </span><span class="s1">ydate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s3"># Different Timezone</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot_date</span><span class="s2">(</span><span class="s1">time_index</span><span class="s2">, </span><span class="s1">time_index</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s4">'US/Eastern'</span><span class="s2">, </span><span class="s1">ydate</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'axisbelow.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_axisbelow</span><span class="s2">():</span>
    <span class="s3"># Test 'line' setting added in 6287.</span>
    <span class="s3"># Show only grids, not frame or ticks, to make this test</span>
    <span class="s3"># independent of future change to drawing order of those elements.</span>
    <span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">ncols</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">settings </span><span class="s2">= (</span><span class="s0">False</span><span class="s2">, </span><span class="s4">'line'</span><span class="s2">, </span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">setting </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">, </span><span class="s1">settings</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">), (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">), </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">10</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'m'</span><span class="s2">)</span>
        <span class="s1">circ </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Circle</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">circ</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s4">'c'</span><span class="s2">, </span><span class="s1">linestyle</span><span class="s2">=</span><span class="s4">'-'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">top</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                       <span class="s1">left</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">right</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">[:].</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_axisbelow</span><span class="s2">(</span><span class="s1">setting</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_axisbelow</span><span class="s2">() == </span><span class="s1">setting</span>


<span class="s0">def </span><span class="s1">test_titletwiny</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">use</span><span class="s2">(</span><span class="s4">'mpl20'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s5">72</span><span class="s2">)</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twiny</span><span class="s2">()</span>
    <span class="s1">xlabel2 </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'Xlabel2'</span><span class="s2">)</span>
    <span class="s1">title </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Title'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()</span>
    <span class="s3"># ------- Test that title is put above Xlabel2 (Xlabel2 at top) ----------</span>
    <span class="s1">bbox_y0_title </span><span class="s2">= </span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">).</span><span class="s1">y0  </span><span class="s3"># bottom of title</span>
    <span class="s1">bbox_y1_xlabel2 </span><span class="s2">= </span><span class="s1">xlabel2</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">).</span><span class="s1">y1  </span><span class="s3"># top of xlabel2</span>
    <span class="s1">y_diff </span><span class="s2">= </span><span class="s1">bbox_y0_title </span><span class="s2">- </span><span class="s1">bbox_y1_xlabel2</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isclose</span><span class="s2">(</span><span class="s1">y_diff</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_titlesetpos</span><span class="s2">():</span>
    <span class="s3"># Test that title stays put if we set it manually</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">top</span><span class="s2">=</span><span class="s5">0.8</span><span class="s2">)</span>
    <span class="s1">ax2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twiny</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'Xlabel'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'Xlabel2'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Title'</span><span class="s2">)</span>
    <span class="s1">pos </span><span class="s2">= (</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.11</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">title</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">(</span><span class="s1">pos</span><span class="s2">)</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">_update_title_position</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">() == </span><span class="s1">pos</span>


<span class="s0">def </span><span class="s1">test_title_xticks_top</span><span class="s2">():</span>
    <span class="s3"># Test that title moves if xticks on top of axes.</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.titley'</span><span class="s2">] = </span><span class="s0">None</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_ticks_position</span><span class="s2">(</span><span class="s4">'top'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'xlabel top'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">] &gt; </span><span class="s5">1.04</span>


<span class="s0">def </span><span class="s1">test_title_xticks_top_both</span><span class="s2">():</span>
    <span class="s3"># Test that title moves if xticks on top of axes.</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.titley'</span><span class="s2">] = </span><span class="s0">None</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">,</span>
                   <span class="s1">bottom</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">labelbottom</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">labeltop</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'xlabel top'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">] &gt; </span><span class="s5">1.04</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s4">'left, center'</span><span class="s2">, [</span>
        <span class="s2">(</span><span class="s4">'left'</span><span class="s2">, </span><span class="s4">''</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">''</span><span class="s2">, </span><span class="s4">'center'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">'left'</span><span class="s2">, </span><span class="s4">'center'</span><span class="s2">)</span>
    <span class="s2">], </span><span class="s1">ids</span><span class="s2">=[</span>
        <span class="s4">'left title moved'</span><span class="s2">,</span>
        <span class="s4">'center title kept'</span><span class="s2">,</span>
        <span class="s4">'both titles aligned'</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_title_above_offset</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">center</span><span class="s2">):</span>
    <span class="s3"># Test that title moves if overlaps with yaxis offset text.</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.titley'</span><span class="s2">] = </span><span class="s0">None</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s5">1e11</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">'left'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s1">center</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">left </span><span class="s0">and not </span><span class="s1">center</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_left_title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">] &gt; </span><span class="s5">1.0</span>
    <span class="s0">elif not </span><span class="s1">left </span><span class="s0">and </span><span class="s1">center</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">] == </span><span class="s5">1.0</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">yleft </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_left_title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s1">ycenter </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">title</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s0">assert </span><span class="s1">yleft </span><span class="s2">&gt; </span><span class="s5">1.0</span>
        <span class="s0">assert </span><span class="s1">ycenter </span><span class="s2">== </span><span class="s1">yleft</span>


<span class="s0">def </span><span class="s1">test_title_no_move_off_page</span><span class="s2">():</span>
    <span class="s3"># If an Axes is off the figure (ie. if it is cropped during a save)</span>
    <span class="s3"># make sure that the automatic title repositioning does not get done.</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.titley'</span><span class="s2">] = </span><span class="s0">None</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.8</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">&quot;x&quot;</span><span class="s2">,</span>
                   <span class="s1">bottom</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">labelbottom</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">labeltop</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">tt </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Boo'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">tt</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">] == </span><span class="s5">1.0</span>


<span class="s0">def </span><span class="s1">test_offset_label_color</span><span class="s2">():</span>
    <span class="s3"># Tests issue 6440</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1.01e9</span><span class="s2">, </span><span class="s5">1.02e9</span><span class="s2">, </span><span class="s5">1.03e9</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s4">'red'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_offset_text</span><span class="s2">().</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'red'</span>


<span class="s0">def </span><span class="s1">test_offset_text_visible</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1.01e9</span><span class="s2">, </span><span class="s5">1.02e9</span><span class="s2">, </span><span class="s5">1.03e9</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">label1On</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">label2On</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_offset_text</span><span class="s2">().</span><span class="s1">get_visible</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">label2On</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_offset_text</span><span class="s2">().</span><span class="s1">get_visible</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_large_offset</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">((</span><span class="s5">1 </span><span class="s2">+ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.e-12</span><span class="s2">])) * </span><span class="s5">1.e27</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_barb_units</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">dates </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2017</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">15</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">60</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)]</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">))</span>
    <span class="s1">u </span><span class="s2">= </span><span class="s1">v </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barbs</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_quiver_units</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">dates </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s5">2017</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">15</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">60</span><span class="s2">, </span><span class="s5">10</span><span class="s2">)]</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">))</span>
    <span class="s1">u </span><span class="s2">= </span><span class="s1">v </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">50</span><span class="s2">, </span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_bar_color_cycle</span><span class="s2">():</span>
    <span class="s1">to_rgb </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgb</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">):</span>
        <span class="s1">ln</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>
        <span class="s1">brs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>
        <span class="s0">for </span><span class="s1">br </span><span class="s0">in </span><span class="s1">brs</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">to_rgb</span><span class="s2">(</span><span class="s1">ln</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">()) == </span><span class="s1">to_rgb</span><span class="s2">(</span><span class="s1">br</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">())</span>


<span class="s0">def </span><span class="s1">test_tick_param_label_rotation</span><span class="s2">():</span>
    <span class="s1">fix</span><span class="s2">, (</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s5">75</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_tick_params</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s5">90</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s5">75</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s5">90</span>

    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'x'</span><span class="s2">, </span><span class="s1">labelrotation</span><span class="s2">=</span><span class="s5">53</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'y'</span><span class="s2">, </span><span class="s1">rotation</span><span class="s2">=</span><span class="s5">35</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'major'</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s5">53</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'major'</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_rotation</span><span class="s2">() == </span><span class="s5">35</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_fillbetween_cycle</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">):</span>
        <span class="s1">cc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>
        <span class="s1">target </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">f'C</span><span class="s0">{</span><span class="s1">j</span><span class="s0">}</span><span class="s4">'</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">.</span><span class="s1">get_facecolors</span><span class="s2">().</span><span class="s1">squeeze</span><span class="s2">()) == </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">target</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">6</span><span class="s2">):</span>
        <span class="s1">cc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_betweenx</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">))</span>
        <span class="s1">target </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">f'C</span><span class="s0">{</span><span class="s1">j</span><span class="s0">}</span><span class="s4">'</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">.</span><span class="s1">get_facecolors</span><span class="s2">().</span><span class="s1">squeeze</span><span class="s2">()) == </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">target</span><span class="s2">)</span>

    <span class="s1">target </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">'k'</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">al </span><span class="s0">in </span><span class="s2">[</span><span class="s4">'facecolor'</span><span class="s2">, </span><span class="s4">'facecolors'</span><span class="s2">, </span><span class="s4">'color'</span><span class="s2">]:</span>
        <span class="s1">cc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), **{</span><span class="s1">al</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">})</span>
        <span class="s0">assert </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">.</span><span class="s1">get_facecolors</span><span class="s2">().</span><span class="s1">squeeze</span><span class="s2">()) == </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">target</span><span class="s2">)</span>

    <span class="s1">edge_target </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">'k'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">j</span><span class="s2">, </span><span class="s1">el </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">([</span><span class="s4">'edgecolor'</span><span class="s2">, </span><span class="s4">'edgecolors'</span><span class="s2">], </span><span class="s1">start</span><span class="s2">=</span><span class="s5">6</span><span class="s2">):</span>
        <span class="s1">cc </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), **{</span><span class="s1">el</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">})</span>
        <span class="s1">face_target </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">f'C</span><span class="s0">{</span><span class="s1">j</span><span class="s0">}</span><span class="s4">'</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">.</span><span class="s1">get_facecolors</span><span class="s2">().</span><span class="s1">squeeze</span><span class="s2">()) == </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">face_target</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">cc</span><span class="s2">.</span><span class="s1">get_edgecolors</span><span class="s2">().</span><span class="s1">squeeze</span><span class="s2">()) == </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">edge_target</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_log_margins</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.autolimit_mode'</span><span class="s2">] = </span><span class="s4">'data'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">margin </span><span class="s2">= </span><span class="s5">0.05</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xmargin</span><span class="s2">(</span><span class="s1">margin</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">semilogx</span><span class="s2">([</span><span class="s5">10</span><span class="s2">, </span><span class="s5">100</span><span class="s2">], [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">100</span><span class="s2">])</span>
    <span class="s1">xlim0</span><span class="s2">, </span><span class="s1">xlim1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s1">transform </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_transform</span><span class="s2">()</span>
    <span class="s1">xlim0t</span><span class="s2">, </span><span class="s1">xlim1t </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">([</span><span class="s1">xlim0</span><span class="s2">, </span><span class="s1">xlim1</span><span class="s2">])</span>
    <span class="s1">x0t</span><span class="s2">, </span><span class="s1">x1t </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">([</span><span class="s5">10</span><span class="s2">, </span><span class="s5">100</span><span class="s2">])</span>
    <span class="s1">delta </span><span class="s2">= (</span><span class="s1">x1t </span><span class="s2">- </span><span class="s1">x0t</span><span class="s2">) * </span><span class="s1">margin</span>
    <span class="s1">assert_allclose</span><span class="s2">([</span><span class="s1">xlim0t </span><span class="s2">+ </span><span class="s1">delta</span><span class="s2">, </span><span class="s1">xlim1t </span><span class="s2">- </span><span class="s1">delta</span><span class="s2">], [</span><span class="s1">x0t</span><span class="s2">, </span><span class="s1">x1t</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_color_length_mismatch</span><span class="s2">():</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s5">5</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">N</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s1">colors </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">N</span><span class="s2">+</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;argument looks like a single numeric RGB&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=[(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)] * </span><span class="s1">N</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_eventplot_legend</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">([</span><span class="s5">1.0</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'Label'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'err, args, kwargs, match'</span><span class="s2">, (</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'lineoffsets'</span><span class="s2">: []}, </span><span class="s4">'lineoffsets cannot be empty'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'linelengths'</span><span class="s2">: []}, </span><span class="s4">'linelengths cannot be empty'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'linewidths'</span><span class="s2">: []}, </span><span class="s4">'linewidths cannot be empty'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'linestyles'</span><span class="s2">: []}, </span><span class="s4">'linestyles cannot be empty'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'alpha'</span><span class="s2">: []}, </span><span class="s4">'alpha cannot be empty'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">], {}, </span><span class="s4">'positions must be one-dimensional'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'lineoffsets'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]},</span>
         <span class="s4">'lineoffsets and positions are unequal sized sequences'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'linelengths'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]},</span>
         <span class="s4">'linelengths and positions are unequal sized sequences'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'linewidths'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]},</span>
         <span class="s4">'linewidths and positions are unequal sized sequences'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'linestyles'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]},</span>
         <span class="s4">'linestyles and positions are unequal sized sequences'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'alpha'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]},</span>
         <span class="s4">'alpha and positions are unequal sized sequences'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, [[</span><span class="s5">1</span><span class="s2">]], {</span><span class="s4">'colors'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]},</span>
         <span class="s4">'colors and positions are unequal sized sequences'</span><span class="s2">),</span>
<span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_eventplot_errors</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">match</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">err</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">match</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">eventplot</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_bar_broadcast_args</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># Check that a bar chart with a single height for all bars works.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s3"># Check that a horizontal chart with one width works.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">left</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">4</span><span class="s2">), </span><span class="s1">height</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s3"># Check that edgecolor gets broadcast.</span>
    <span class="s1">rect1</span><span class="s2">, </span><span class="s1">rect2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">edgecolor</span><span class="s2">=(</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.2</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.4</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">rect1</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">() == </span><span class="s1">rect2</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">() == (</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.2</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.4</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_invalid_axis_limits</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlim</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">xlim</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylim</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">ylim</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">)</span>


<span class="s3"># Test all 4 combinations of logs/symlogs for minorticks_on()</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'xscale'</span><span class="s2">, [</span><span class="s4">'symlog'</span><span class="s2">, </span><span class="s4">'log'</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'yscale'</span><span class="s2">, [</span><span class="s4">'symlog'</span><span class="s2">, </span><span class="s4">'log'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_minorticks_on</span><span class="s2">(</span><span class="s1">xscale</span><span class="s2">, </span><span class="s1">yscale</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s1">xscale</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_yscale</span><span class="s2">(</span><span class="s1">yscale</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">minorticks_on</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_twinx_knows_limits</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvspan</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">xtwin </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s1">xtwin</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s3"># control axis</span>
    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">axvspan</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>

    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">xtwin</span><span class="s2">.</span><span class="s1">viewLim</span><span class="s2">.</span><span class="s1">intervalx</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">viewLim</span><span class="s2">.</span><span class="s1">intervalx</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_zero_linewidth</span><span class="s2">():</span>
    <span class="s3"># Check that setting a zero linewidth doesn't error</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">'--'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_empty_errorbar_legend</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">([], [], </span><span class="s1">xerr</span><span class="s2">=[], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'empty y'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">([], [], </span><span class="s1">yerr</span><span class="s2">=[], </span><span class="s1">label</span><span class="s2">=</span><span class="s4">'empty x'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_plot_decimal</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x0 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(-</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">)</span>
    <span class="s1">y0 </span><span class="s2">= [</span><span class="s5">5.2 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">** </span><span class="s5">3 </span><span class="s2">- </span><span class="s5">2.1 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">** </span><span class="s5">2 </span><span class="s2">+ </span><span class="s5">7.34 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s5">4.5 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">x0</span><span class="s2">]</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">x0</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">y0</span><span class="s2">]</span>
    <span class="s3"># Test image - line plot with Decimal input</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s3"># Reference image</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">y0</span><span class="s2">)</span>


<span class="s3"># pdf and svg tests fail using travis' old versions of gs and inkscape.</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_markerfacecolor_none_alpha</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">plot</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">&quot;o&quot;</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">&quot;none&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.5</span><span class="s2">)</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">().</span><span class="s1">plot</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s4">&quot;o&quot;</span><span class="s2">, </span><span class="s1">mfc</span><span class="s2">=</span><span class="s4">&quot;w&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.5</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_tick_padding_tightbbox</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test that tick padding gets turned off if axis is off&quot;&quot;&quot;</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">&quot;xtick.direction&quot;</span><span class="s2">] = </span><span class="s4">&quot;out&quot;</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">&quot;ytick.direction&quot;</span><span class="s2">] = </span><span class="s4">&quot;out&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">bb </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_tightbbox</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">())</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">'off'</span><span class="s2">)</span>
    <span class="s1">bb2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_tightbbox</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">())</span>
    <span class="s0">assert </span><span class="s1">bb</span><span class="s2">.</span><span class="s1">x0 </span><span class="s2">&lt; </span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">x0</span>
    <span class="s0">assert </span><span class="s1">bb</span><span class="s2">.</span><span class="s1">y0 </span><span class="s2">&lt; </span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">y0</span>


<span class="s0">def </span><span class="s1">test_inset</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Ensure that inset_ax argument is indeed optional 
    &quot;&quot;&quot;</span>
    <span class="s1">dx</span><span class="s2">, </span><span class="s1">dy </span><span class="s2">= </span><span class="s5">0.05</span><span class="s2">, </span><span class="s5">0.05</span>
    <span class="s3"># generate 2 2d grids for the x &amp; y bounds</span>
    <span class="s1">y</span><span class="s2">, </span><span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mgrid</span><span class="s2">[</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5 </span><span class="s2">+ </span><span class="s1">dy</span><span class="s2">, </span><span class="s1">dy</span><span class="s2">),</span>
                    <span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5 </span><span class="s2">+ </span><span class="s1">dx</span><span class="s2">, </span><span class="s1">dx</span><span class="s2">)]</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) ** </span><span class="s5">10 </span><span class="s2">+ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s5">10 </span><span class="s2">+ </span><span class="s1">y </span><span class="s2">* </span><span class="s1">x</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">apply_aspect</span><span class="s2">()</span>
    <span class="s3"># we need to apply_aspect to make the drawing below work.</span>

    <span class="s1">xlim </span><span class="s2">= [</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">2.15</span><span class="s2">]</span>
    <span class="s1">ylim </span><span class="s2">= [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">]</span>

    <span class="s1">rect </span><span class="s2">= [</span><span class="s1">xlim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">ylim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">xlim</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">xlim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">ylim</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">ylim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]]</span>

    <span class="s1">rec</span><span class="s2">, </span><span class="s1">connectors </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">indicate_inset</span><span class="s2">(</span><span class="s1">bounds</span><span class="s2">=</span><span class="s1">rect</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">connectors </span><span class="s0">is None</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">xx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">2.15</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">]])</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">rec</span><span class="s2">.</span><span class="s1">get_bbox</span><span class="s2">().</span><span class="s1">get_points</span><span class="s2">() == </span><span class="s1">xx</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_zoom_inset</span><span class="s2">():</span>
    <span class="s1">dx</span><span class="s2">, </span><span class="s1">dy </span><span class="s2">= </span><span class="s5">0.05</span><span class="s2">, </span><span class="s5">0.05</span>
    <span class="s3"># generate 2 2d grids for the x &amp; y bounds</span>
    <span class="s1">y</span><span class="s2">, </span><span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mgrid</span><span class="s2">[</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5 </span><span class="s2">+ </span><span class="s1">dy</span><span class="s2">, </span><span class="s1">dy</span><span class="s2">),</span>
                    <span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5 </span><span class="s2">+ </span><span class="s1">dx</span><span class="s2">, </span><span class="s1">dx</span><span class="s2">)]</span>
    <span class="s1">z </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)**</span><span class="s5">10 </span><span class="s2">+ </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s5">10 </span><span class="s2">+ </span><span class="s1">y</span><span class="s2">*</span><span class="s1">x</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">apply_aspect</span><span class="s2">()</span>
    <span class="s3"># we need to apply_aspect to make the drawing below work.</span>

    <span class="s3"># Make the inset_axes...  Position axes coordinates...</span>
    <span class="s1">axin1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">0.35</span><span class="s2">, </span><span class="s5">0.35</span><span class="s2">])</span>
    <span class="s3"># redraw the data in the inset axes...</span>
    <span class="s1">axin1</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">z</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">, :-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">axin1</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">([</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">2.15</span><span class="s2">])</span>
    <span class="s1">axin1</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">])</span>
    <span class="s1">axin1</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_aspect</span><span class="s2">())</span>

    <span class="s1">rec</span><span class="s2">, </span><span class="s1">connectors </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">indicate_inset_zoom</span><span class="s2">(</span><span class="s1">axin1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">connectors</span><span class="s2">) == </span><span class="s5">4</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">xx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.5</span><span class="s2">,  </span><span class="s5">2.</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">2.15</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">]])</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">rec</span><span class="s2">.</span><span class="s1">get_bbox</span><span class="s2">().</span><span class="s1">get_points</span><span class="s2">() == </span><span class="s1">xx</span><span class="s2">)</span>
    <span class="s1">xx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0.6325</span><span class="s2">, </span><span class="s5">0.692308</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">0.8425</span><span class="s2">, </span><span class="s5">0.907692</span><span class="s2">]])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
        <span class="s1">axin1</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">get_points</span><span class="s2">(), </span><span class="s1">xx</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s5">1e-4</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'inset_polar.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_inset_polar</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">axins </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.45</span><span class="s2">, </span><span class="s5">0.45</span><span class="s2">], </span><span class="s1">polar</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">axins</span><span class="s2">, </span><span class="s1">PolarAxes</span><span class="s2">)</span>

    <span class="s1">r </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">)</span>
    <span class="s1">theta </span><span class="s2">= </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">* </span><span class="s1">r</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>
    <span class="s1">axins</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">theta</span><span class="s2">, </span><span class="s1">r</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_inset_projection</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">axins </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">], </span><span class="s1">projection</span><span class="s2">=</span><span class="s4">&quot;hammer&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">axins</span><span class="s2">, </span><span class="s1">HammerAxes</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_inset_subclass</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">axins </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">], </span><span class="s1">axes_class</span><span class="s2">=</span><span class="s1">AA</span><span class="s2">.</span><span class="s1">Axes</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">axins</span><span class="s2">, </span><span class="s1">AA</span><span class="s2">.</span><span class="s1">Axes</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'x_inverted'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'y_inverted'</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_indicate_inset_inverted</span><span class="s2">(</span><span class="s1">x_inverted</span><span class="s2">, </span><span class="s1">y_inverted</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot; 
    Test that the inset lines are correctly located with inverted data axes. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s4">'o'</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">x_inverted</span><span class="s2">:</span>
        <span class="s1">ax1</span><span class="s2">.</span><span class="s1">invert_xaxis</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">y_inverted</span><span class="s2">:</span>
        <span class="s1">ax1</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>

    <span class="s1">rect</span><span class="s2">, </span><span class="s1">bounds </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">indicate_inset</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">ax2</span><span class="s2">)</span>
    <span class="s1">lower_left</span><span class="s2">, </span><span class="s1">upper_left</span><span class="s2">, </span><span class="s1">lower_right</span><span class="s2">, </span><span class="s1">upper_right </span><span class="s2">= </span><span class="s1">bounds</span>

    <span class="s1">sign_x </span><span class="s2">= -</span><span class="s5">1 </span><span class="s0">if </span><span class="s1">x_inverted </span><span class="s0">else </span><span class="s5">1</span>
    <span class="s1">sign_y </span><span class="s2">= -</span><span class="s5">1 </span><span class="s0">if </span><span class="s1">y_inverted </span><span class="s0">else </span><span class="s5">1</span>
    <span class="s0">assert </span><span class="s1">sign_x </span><span class="s2">* (</span><span class="s1">lower_right</span><span class="s2">.</span><span class="s1">xy2</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] - </span><span class="s1">lower_left</span><span class="s2">.</span><span class="s1">xy2</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) &gt; </span><span class="s5">0</span>
    <span class="s0">assert </span><span class="s1">sign_x </span><span class="s2">* (</span><span class="s1">upper_right</span><span class="s2">.</span><span class="s1">xy2</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] - </span><span class="s1">upper_left</span><span class="s2">.</span><span class="s1">xy2</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) &gt; </span><span class="s5">0</span>
    <span class="s0">assert </span><span class="s1">sign_y </span><span class="s2">* (</span><span class="s1">upper_left</span><span class="s2">.</span><span class="s1">xy2</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">lower_left</span><span class="s2">.</span><span class="s1">xy2</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]) &gt; </span><span class="s5">0</span>
    <span class="s0">assert </span><span class="s1">sign_y </span><span class="s2">* (</span><span class="s1">upper_right</span><span class="s2">.</span><span class="s1">xy2</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">lower_right</span><span class="s2">.</span><span class="s1">xy2</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]) &gt; </span><span class="s5">0</span>


<span class="s0">def </span><span class="s1">test_set_position</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">3.</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">], </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">width</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">2.</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">], </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'original'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">width</span><span class="s2">, </span><span class="s5">0.15</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">3.</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">], </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'active'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">width</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_spines_properbbox_after_zoom</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">bb </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">.</span><span class="s1">bottom</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">())</span>
    <span class="s3"># this is what zoom calls:</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">_set_view_from_bbox</span><span class="s2">((</span><span class="s5">320</span><span class="s2">, </span><span class="s5">320</span><span class="s2">, </span><span class="s5">500</span><span class="s2">, </span><span class="s5">500</span><span class="s2">), </span><span class="s4">'in'</span><span class="s2">,</span>
                           <span class="s0">None</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">bb2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">.</span><span class="s1">bottom</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">())</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">(), </span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">(), </span><span class="s1">rtol</span><span class="s2">=</span><span class="s5">1e-6</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_limits_after_scroll_zoom</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3">#</span>
    <span class="s1">xlim </span><span class="s2">= (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">ylim </span><span class="s2">= (-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">ymin</span><span class="s2">=</span><span class="s1">ylim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">ymax</span><span class="s2">=</span><span class="s1">ylim</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s3"># This is what scroll zoom calls:</span>
    <span class="s3"># Zoom with factor 1, small numerical change</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">_set_view_from_bbox</span><span class="s2">((</span><span class="s5">200</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-16</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ylim</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-16</span><span class="s2">)</span>

    <span class="s3"># Zoom in</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">_set_view_from_bbox</span><span class="s2">((</span><span class="s5">200</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">))</span>
    <span class="s3"># Hard-coded values</span>
    <span class="s1">new_xlim </span><span class="s2">= (-</span><span class="s5">0.3790322580645161</span><span class="s2">, </span><span class="s5">0.12096774193548387</span><span class="s2">)</span>
    <span class="s1">new_ylim </span><span class="s2">= (-</span><span class="s5">0.40625</span><span class="s2">, </span><span class="s5">1.09375</span><span class="s2">)</span>

    <span class="s1">res_xlim </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s1">res_ylim </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res_xlim</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">res_xlim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res_ylim</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">res_ylim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s5">1.5</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">new_xlim</span><span class="s2">, </span><span class="s1">res_xlim</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-16</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">new_ylim</span><span class="s2">, </span><span class="s1">res_ylim</span><span class="s2">)</span>

    <span class="s3"># Zoom out, should be same as before, except for numerical issues</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">_set_view_from_bbox</span><span class="s2">((</span><span class="s5">200</span><span class="s2">, </span><span class="s5">200</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">))</span>
    <span class="s1">res_xlim </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s1">res_ylim </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res_xlim</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">res_xlim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res_ylim</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s1">res_ylim</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">, </span><span class="s1">res_xlim</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-16</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ylim</span><span class="s2">, </span><span class="s1">res_ylim</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-16</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_gettightbbox_ignore_nan</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">remove_ticks_and_titles</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s4">'Boo'</span><span class="s2">)</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_tightbbox</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">).</span><span class="s1">width</span><span class="s2">, </span><span class="s5">496</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_scatter_series_non_zero_index</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s3"># create non-zero index</span>
    <span class="s1">ids </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">18</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">8</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">ids</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s5">8</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">ids</span><span class="s2">)</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">ids</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_scatter_empty_data</span><span class="s2">():</span>
    <span class="s3"># making sure this does not raise an exception</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([], [])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([], [], </span><span class="s1">s</span><span class="s2">=[], </span><span class="s1">c</span><span class="s2">=[])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'annotate_across_transforms.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.025 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_annotate_across_transforms</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">200</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(-</span><span class="s1">x</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">3.39</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">axins </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">])</span>
    <span class="s1">axins</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">0.2</span><span class="s2">)</span>
    <span class="s1">axins</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">axins</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">xy</span><span class="s2">=(</span><span class="s1">x</span><span class="s2">[</span><span class="s5">150</span><span class="s2">], </span><span class="s1">y</span><span class="s2">[</span><span class="s5">150</span><span class="s2">]), </span><span class="s1">xycoords</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">,</span>
                <span class="s1">xytext</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s1">textcoords</span><span class="s2">=</span><span class="s1">axins</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">,</span>
                <span class="s1">arrowprops</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">arrowstyle</span><span class="s2">=</span><span class="s4">&quot;-&gt;&quot;</span><span class="s2">))</span>


<span class="s0">class </span><span class="s1">_Translation</span><span class="s2">(</span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Transform</span><span class="s2">):</span>
    <span class="s1">input_dims </span><span class="s2">= </span><span class="s5">1</span>
    <span class="s1">output_dims </span><span class="s2">= </span><span class="s5">1</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dx</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">dx </span><span class="s2">= </span><span class="s1">dx</span>

    <span class="s0">def </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">values</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">values </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">dx</span>

    <span class="s0">def </span><span class="s1">inverted</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">_Translation</span><span class="s2">(-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dx</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'secondary_xy.png'</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.027 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">'arm64' </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_secondary_xy</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">5</span><span class="s2">), </span><span class="s1">constrained_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">invert</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s5">1 </span><span class="s2">/ </span><span class="s1">x</span>

    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">))</span>
        <span class="s0">if </span><span class="s1">nn </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s1">secax </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">secax </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_yaxis</span>

        <span class="s1">secax</span><span class="s2">(</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">=(</span><span class="s1">invert</span><span class="s2">, </span><span class="s1">invert</span><span class="s2">))</span>
        <span class="s1">secax</span><span class="s2">(</span><span class="s5">0.4</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">=(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">x</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x </span><span class="s2">/ </span><span class="s5">2</span><span class="s2">))</span>
        <span class="s1">secax</span><span class="s2">(</span><span class="s5">0.6</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">=(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span><span class="s2">**</span><span class="s5">2</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span><span class="s2">**(</span><span class="s5">1</span><span class="s2">/</span><span class="s5">2</span><span class="s2">)))</span>
        <span class="s1">secax</span><span class="s2">(</span><span class="s5">0.8</span><span class="s2">)</span>
        <span class="s1">secax</span><span class="s2">(</span><span class="s4">&quot;top&quot; </span><span class="s0">if </span><span class="s1">nn </span><span class="s2">== </span><span class="s5">0 </span><span class="s0">else </span><span class="s4">&quot;right&quot;</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">=</span><span class="s1">_Translation</span><span class="s2">(</span><span class="s5">2</span><span class="s2">))</span>
        <span class="s1">secax</span><span class="s2">(</span><span class="s5">6.25</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_secondary_fail</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span><span class="s2">(</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">=(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s5">1 </span><span class="s2">/ </span><span class="s1">x</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span><span class="s2">(</span><span class="s4">'right'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_yaxis</span><span class="s2">(</span><span class="s4">'bottom'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span><span class="s2">(</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s4">'error'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_secondary_resize</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">invert</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s5">1 </span><span class="s2">/ </span><span class="s1">x</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span><span class="s2">(</span><span class="s4">'top'</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">=(</span><span class="s1">invert</span><span class="s2">, </span><span class="s1">invert</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">set_size_inches</span><span class="s2">((</span><span class="s5">7</span><span class="s2">, </span><span class="s5">4</span><span class="s2">))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">extents</span><span class="s2">, [</span><span class="s5">0.125</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_secondary_minorloc</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">11</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">invert</span><span class="s2">(</span><span class="s1">x</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">divide</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s5">1 </span><span class="s2">/ </span><span class="s1">x</span>

    <span class="s1">secax </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span><span class="s2">(</span><span class="s4">'top'</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">=(</span><span class="s1">invert</span><span class="s2">, </span><span class="s1">invert</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">secax</span><span class="s2">.</span><span class="s1">_axis</span><span class="s2">.</span><span class="s1">get_minor_locator</span><span class="s2">(),</span>
                      <span class="s1">mticker</span><span class="s2">.</span><span class="s1">NullLocator</span><span class="s2">)</span>
    <span class="s1">secax</span><span class="s2">.</span><span class="s1">minorticks_on</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">secax</span><span class="s2">.</span><span class="s1">_axis</span><span class="s2">.</span><span class="s1">get_minor_locator</span><span class="s2">(),</span>
                      <span class="s1">mticker</span><span class="s2">.</span><span class="s1">AutoMinorLocator</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">secax</span><span class="s2">.</span><span class="s1">_axis</span><span class="s2">.</span><span class="s1">get_minor_locator</span><span class="s2">(),</span>
                      <span class="s1">mticker</span><span class="s2">.</span><span class="s1">LogLocator</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'linear'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">secax</span><span class="s2">.</span><span class="s1">_axis</span><span class="s2">.</span><span class="s1">get_minor_locator</span><span class="s2">(),</span>
                      <span class="s1">mticker</span><span class="s2">.</span><span class="s1">NullLocator</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_secondary_formatter</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">&quot;log&quot;</span><span class="s2">)</span>
    <span class="s1">secax </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span><span class="s2">(</span><span class="s4">&quot;top&quot;</span><span class="s2">)</span>
    <span class="s1">secax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">mticker</span><span class="s2">.</span><span class="s1">ScalarFormatter</span><span class="s2">())</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span>
        <span class="s1">secax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_major_formatter</span><span class="s2">(), </span><span class="s1">mticker</span><span class="s2">.</span><span class="s1">ScalarFormatter</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_secondary_repr</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">secax </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span><span class="s2">(</span><span class="s4">&quot;top&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">repr</span><span class="s2">(</span><span class="s1">secax</span><span class="s2">) == </span><span class="s4">'&lt;SecondaryAxis: &gt;'</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'axis_options.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_axis_options</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">option </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">((</span><span class="s4">'scaled'</span><span class="s2">, </span><span class="s4">'tight'</span><span class="s2">, </span><span class="s4">'image'</span><span class="s2">)):</span>
        <span class="s3"># Draw a line and a circle fitting within the boundaries of the line</span>
        <span class="s3"># The circle should look like a circle for 'scaled' and 'image'</span>
        <span class="s3"># High/narrow aspect ratio</span>
        <span class="s1">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3.2</span><span class="s2">))</span>
        <span class="s1">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">axis</span><span class="s2">(</span><span class="s1">option</span><span class="s2">)</span>
        <span class="s1">axes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Circle</span><span class="s2">((</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">), </span><span class="s1">radius</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">,</span>
                                              <span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">))</span>
        <span class="s3"># Low/wide aspect ratio</span>
        <span class="s1">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.25</span><span class="s2">), (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1.75</span><span class="s2">))</span>
        <span class="s1">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">axis</span><span class="s2">(</span><span class="s1">option</span><span class="s2">)</span>
        <span class="s1">axes</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s1">i</span><span class="s2">].</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Circle</span><span class="s2">((</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">1.25</span><span class="s2">), </span><span class="s1">radius</span><span class="s2">=</span><span class="s5">0.25</span><span class="s2">,</span>
                                              <span class="s1">facecolor</span><span class="s2">=</span><span class="s4">'none'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">color_boxes</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot; 
    Helper for the tests below that test the extents of various Axes elements 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()</span>
    <span class="s1">bbaxis </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">axx </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">([</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">]):</span>
        <span class="s1">bb </span><span class="s2">= </span><span class="s1">axx</span><span class="s2">.</span><span class="s1">get_tightbbox</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">bb</span><span class="s2">:</span>
            <span class="s1">axisr </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">(</span>
                <span class="s2">(</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">bb</span><span class="s2">.</span><span class="s1">y0</span><span class="s2">), </span><span class="s1">width</span><span class="s2">=</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">height</span><span class="s2">,</span>
                <span class="s1">linewidth</span><span class="s2">=</span><span class="s5">0.7</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">'y'</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;none&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
                <span class="s1">zorder</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">axisr</span><span class="s2">)</span>
        <span class="s1">bbaxis </span><span class="s2">+= [</span><span class="s1">bb</span><span class="s2">]</span>

    <span class="s1">bbspines </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">a </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">([</span><span class="s4">'bottom'</span><span class="s2">, </span><span class="s4">'top'</span><span class="s2">, </span><span class="s4">'left'</span><span class="s2">, </span><span class="s4">'right'</span><span class="s2">]):</span>
        <span class="s1">bb </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">[</span><span class="s1">a</span><span class="s2">].</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>
        <span class="s1">spiner </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">(</span>
            <span class="s2">(</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">bb</span><span class="s2">.</span><span class="s1">y0</span><span class="s2">), </span><span class="s1">width</span><span class="s2">=</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">height</span><span class="s2">,</span>
            <span class="s1">linewidth</span><span class="s2">=</span><span class="s5">0.7</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">&quot;green&quot;</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;none&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
            <span class="s1">zorder</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">spiner</span><span class="s2">)</span>
        <span class="s1">bbspines </span><span class="s2">+= [</span><span class="s1">bb</span><span class="s2">]</span>

    <span class="s1">bb </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>
    <span class="s1">rect2 </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">(</span>
        <span class="s2">(</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">bb</span><span class="s2">.</span><span class="s1">y0</span><span class="s2">), </span><span class="s1">width</span><span class="s2">=</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">height</span><span class="s2">,</span>
        <span class="s1">linewidth</span><span class="s2">=</span><span class="s5">1.5</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">&quot;magenta&quot;</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;none&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">zorder</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">rect2</span><span class="s2">)</span>
    <span class="s1">bbax </span><span class="s2">= </span><span class="s1">bb</span>

    <span class="s1">bb2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_tightbbox</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>
    <span class="s1">rect2 </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">(</span>
        <span class="s2">(</span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">x0</span><span class="s2">, </span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">y0</span><span class="s2">), </span><span class="s1">width</span><span class="s2">=</span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">height</span><span class="s2">,</span>
        <span class="s1">linewidth</span><span class="s2">=</span><span class="s5">3</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">&quot;red&quot;</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;none&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">rect2</span><span class="s2">)</span>
    <span class="s1">bbtb </span><span class="s2">= </span><span class="s1">bb2</span>
    <span class="s0">return </span><span class="s1">bbaxis</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">, </span><span class="s1">bbax</span><span class="s2">, </span><span class="s1">bbtb</span>


<span class="s0">def </span><span class="s1">test_normal_axes</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s5">200</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">)</span>
        <span class="s1">bbaxis</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">, </span><span class="s1">bbax</span><span class="s2">, </span><span class="s1">bbtb </span><span class="s2">= </span><span class="s1">color_boxes</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">)</span>

    <span class="s3"># test the axis bboxes</span>
    <span class="s1">target </span><span class="s2">= [</span>
        <span class="s2">[</span><span class="s5">123.375</span><span class="s2">, </span><span class="s5">75.88888888888886</span><span class="s2">, </span><span class="s5">983.25</span><span class="s2">, </span><span class="s5">33.0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">85.51388888888889</span><span class="s2">, </span><span class="s5">99.99999999999997</span><span class="s2">, </span><span class="s5">53.375</span><span class="s2">, </span><span class="s5">993.0</span><span class="s2">]</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">bbaxis</span><span class="s2">):</span>
        <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">[</span><span class="s1">nn</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">target </span><span class="s2">= [</span>
        <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">119.999</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">1080.0</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">119.9999</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">1068.8888</span><span class="s2">, </span><span class="s5">119.9999</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">bbspines</span><span class="s2">):</span>
        <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">[</span><span class="s1">nn</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">target </span><span class="s2">= [</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">119.99999999999997</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]</span>
    <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">bbax</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">target </span><span class="s2">= [</span><span class="s5">85.5138</span><span class="s2">, </span><span class="s5">75.88888</span><span class="s2">, </span><span class="s5">1021.11</span><span class="s2">, </span><span class="s5">1017.11</span><span class="s2">]</span>
    <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">bbtb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s3"># test that get_position roundtrips to get_window_extent</span>
    <span class="s1">axbb </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">transFigure</span><span class="s2">).</span><span class="s1">bounds</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">axbb</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_nodecorator</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s5">200</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xticklabels</span><span class="s2">=[], </span><span class="s1">yticklabels</span><span class="s2">=[])</span>
        <span class="s1">bbaxis</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">, </span><span class="s1">bbax</span><span class="s2">, </span><span class="s1">bbtb </span><span class="s2">= </span><span class="s1">color_boxes</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">)</span>

    <span class="s3"># test the axis bboxes</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">bbaxis</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">b </span><span class="s0">is None</span>

    <span class="s1">target </span><span class="s2">= [</span>
        <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">119.999</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">1080.0</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">119.9999</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">1068.8888</span><span class="s2">, </span><span class="s5">119.9999</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">b </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">bbspines</span><span class="s2">):</span>
        <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">[</span><span class="s1">nn</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>

    <span class="s1">target </span><span class="s2">= [</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">119.99999999999997</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]</span>
    <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bbax</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>

    <span class="s1">target </span><span class="s2">= [</span><span class="s5">150.</span><span class="s2">, </span><span class="s5">120.</span><span class="s2">, </span><span class="s5">930.</span><span class="s2">, </span><span class="s5">960.</span><span class="s2">]</span>
    <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bbtb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_displaced_spine</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s5">200</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xticklabels</span><span class="s2">=[], </span><span class="s1">yticklabels</span><span class="s2">=[])</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">.</span><span class="s1">bottom</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">((</span><span class="s4">'axes'</span><span class="s2">, -</span><span class="s5">0.1</span><span class="s2">))</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">bbaxis</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">, </span><span class="s1">bbax</span><span class="s2">, </span><span class="s1">bbtb </span><span class="s2">= </span><span class="s1">color_boxes</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">)</span>

    <span class="s1">targets </span><span class="s2">= [</span>
        <span class="s2">[</span><span class="s5">150.</span><span class="s2">, </span><span class="s5">24.</span><span class="s2">, </span><span class="s5">930.</span><span class="s2">, </span><span class="s5">11.111111</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">1080.0</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">0.0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">119.9999</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">1068.8888</span><span class="s2">, </span><span class="s5">119.9999</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s1">target</span><span class="s2">, </span><span class="s1">bbspine </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">targets</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">):</span>
        <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bbspine</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>

    <span class="s1">target </span><span class="s2">= [</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">119.99999999999997</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]</span>
    <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bbax</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>

    <span class="s1">target </span><span class="s2">= [</span><span class="s5">150.</span><span class="s2">, </span><span class="s5">24.</span><span class="s2">, </span><span class="s5">930.</span><span class="s2">, </span><span class="s5">1056.</span><span class="s2">]</span>
    <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">target</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bbtb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_tickdirs</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Switch the tickdirs and make sure the bboxes switch with them 
    &quot;&quot;&quot;</span>
    <span class="s1">targets </span><span class="s2">= [[[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">120.0</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">11.1111</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">120.0</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]],</span>
               <span class="s2">[[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">108.8889</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">11.111111111111114</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s5">138.889</span><span class="s2">, </span><span class="s5">120</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]],</span>
               <span class="s2">[[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">114.44444444444441</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">11.111111111111114</span><span class="s2">],</span>
                <span class="s2">[</span><span class="s5">144.44444444444446</span><span class="s2">, </span><span class="s5">119.999</span><span class="s2">, </span><span class="s5">11.111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]]]</span>
    <span class="s0">for </span><span class="s1">dnum</span><span class="s2">, </span><span class="s1">dirs </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">([</span><span class="s4">'in'</span><span class="s2">, </span><span class="s4">'out'</span><span class="s2">, </span><span class="s4">'inout'</span><span class="s2">]):</span>
        <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
            <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s5">200</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">direction</span><span class="s2">=</span><span class="s1">dirs</span><span class="s2">)</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
            <span class="s1">bbaxis</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">, </span><span class="s1">bbax</span><span class="s2">, </span><span class="s1">bbtb </span><span class="s2">= </span><span class="s1">color_boxes</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">num </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]):</span>
                <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">targets</span><span class="s2">[</span><span class="s1">dnum</span><span class="s2">][</span><span class="s1">nn</span><span class="s2">])</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span>
                    <span class="s1">bbspines</span><span class="s2">[</span><span class="s1">num</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_minor_accountedfor</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s4">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s5">200</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">)</span>

        <span class="s1">bbaxis</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">, </span><span class="s1">bbax</span><span class="s2">, </span><span class="s1">bbtb </span><span class="s2">= </span><span class="s1">color_boxes</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">)</span>
        <span class="s1">bbaxis</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">, </span><span class="s1">bbax</span><span class="s2">, </span><span class="s1">bbtb </span><span class="s2">= </span><span class="s1">color_boxes</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">)</span>
        <span class="s1">targets </span><span class="s2">= [[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">108.88888888888886</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">11.111111111111114</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">138.8889</span><span class="s2">, </span><span class="s5">119.9999</span><span class="s2">, </span><span class="s5">11.1111</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]]</span>
        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">2</span><span class="s2">):</span>
            <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">targets</span><span class="s2">[</span><span class="s1">n</span><span class="s2">])</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span>
                <span class="s1">bbspines</span><span class="s2">[</span><span class="s1">n </span><span class="s2">* </span><span class="s5">2</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>

        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s5">200</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">))</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">, </span><span class="s1">direction</span><span class="s2">=</span><span class="s4">'out'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">minorticks_on</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">'both'</span><span class="s2">, </span><span class="s1">which</span><span class="s2">=</span><span class="s4">'minor'</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s5">30</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">bbaxis</span><span class="s2">, </span><span class="s1">bbspines</span><span class="s2">, </span><span class="s1">bbax</span><span class="s2">, </span><span class="s1">bbtb </span><span class="s2">= </span><span class="s1">color_boxes</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">)</span>
        <span class="s1">targets </span><span class="s2">= [[</span><span class="s5">150.0</span><span class="s2">, </span><span class="s5">36.66666666666663</span><span class="s2">, </span><span class="s5">930.0</span><span class="s2">, </span><span class="s5">83.33333333333334</span><span class="s2">],</span>
                   <span class="s2">[</span><span class="s5">66.6667</span><span class="s2">, </span><span class="s5">120.0</span><span class="s2">, </span><span class="s5">83.3333</span><span class="s2">, </span><span class="s5">960.0</span><span class="s2">]]</span>

        <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">2</span><span class="s2">):</span>
            <span class="s1">targetbb </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Bbox</span><span class="s2">.</span><span class="s1">from_bounds</span><span class="s2">(*</span><span class="s1">targets</span><span class="s2">[</span><span class="s1">n</span><span class="s2">])</span>
            <span class="s1">assert_allclose</span><span class="s2">(</span>
                <span class="s1">bbspines</span><span class="s2">[</span><span class="s1">n </span><span class="s2">* </span><span class="s5">2</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">targetbb</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">1e-2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_axis_bool_arguments</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># Test if False and &quot;off&quot; give the same</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">211</span><span class="s2">).</span><span class="s1">axis</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">211</span><span class="s2">).</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">&quot;off&quot;</span><span class="s2">)</span>
    <span class="s3"># Test if True after False gives the same as &quot;on&quot;</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">212</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">212</span><span class="s2">).</span><span class="s1">axis</span><span class="s2">(</span><span class="s4">&quot;on&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_axis_extent_arg</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">xmin </span><span class="s2">= </span><span class="s5">5</span>
    <span class="s1">xmax </span><span class="s2">= </span><span class="s5">10</span>
    <span class="s1">ymin </span><span class="s2">= </span><span class="s5">15</span>
    <span class="s1">ymax </span><span class="s2">= </span><span class="s5">20</span>
    <span class="s1">extent </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">([</span><span class="s1">xmin</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">, </span><span class="s1">ymin</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">])</span>

    <span class="s3"># test that the docstring is correct</span>
    <span class="s0">assert </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">extent</span><span class="s2">) == (</span><span class="s1">xmin</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">, </span><span class="s1">ymin</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">)</span>

    <span class="s3"># test that limits were set per the docstring</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">xmin</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">) == </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">ymin</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">) == </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_axis_extent_arg2</span><span class="s2">():</span>
    <span class="s3"># Same as test_axis_extent_arg, but with keyword arguments</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">xmin </span><span class="s2">= </span><span class="s5">5</span>
    <span class="s1">xmax </span><span class="s2">= </span><span class="s5">10</span>
    <span class="s1">ymin </span><span class="s2">= </span><span class="s5">15</span>
    <span class="s1">ymax </span><span class="s2">= </span><span class="s5">20</span>
    <span class="s1">extent </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">(</span><span class="s1">xmin</span><span class="s2">=</span><span class="s1">xmin</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">=</span><span class="s1">xmax</span><span class="s2">, </span><span class="s1">ymin</span><span class="s2">=</span><span class="s1">ymin</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">=</span><span class="s1">ymax</span><span class="s2">)</span>

    <span class="s3"># test that the docstring is correct</span>
    <span class="s0">assert </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">extent</span><span class="s2">) == (</span><span class="s1">xmin</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">, </span><span class="s1">ymin</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">)</span>

    <span class="s3"># test that limits were set per the docstring</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">xmin</span><span class="s2">, </span><span class="s1">xmax</span><span class="s2">) == </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">ymin</span><span class="s2">, </span><span class="s1">ymax</span><span class="s2">) == </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_hist_auto_bins</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">]], </span><span class="s1">bins</span><span class="s2">=</span><span class="s4">'auto'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">bins</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] &lt;= </span><span class="s5">1</span>
    <span class="s0">assert </span><span class="s1">bins</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] &gt;= </span><span class="s5">6</span>


<span class="s0">def </span><span class="s1">test_hist_nan_data</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>

    <span class="s1">data </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">nan_data </span><span class="s2">= </span><span class="s1">data </span><span class="s2">+ [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]</span>

    <span class="s1">bins</span><span class="s2">, </span><span class="s1">edges</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">invalid</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
        <span class="s1">nanbins</span><span class="s2">, </span><span class="s1">nanedges</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">nan_data</span><span class="s2">)</span>

    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">bins</span><span class="s2">, </span><span class="s1">nanbins</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">edges</span><span class="s2">, </span><span class="s1">nanedges</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_hist_range_and_density</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">bins</span><span class="s2">, </span><span class="s1">_ </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s4">&quot;auto&quot;</span><span class="s2">,</span>
                          <span class="s1">range</span><span class="s2">=(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">density</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">bins</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s5">0</span>
    <span class="s0">assert </span><span class="s1">bins</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] == </span><span class="s5">1</span>


<span class="s0">def </span><span class="s1">test_bar_errbar_zorder</span><span class="s2">():</span>
    <span class="s3"># Check that the zorder of errorbars is always greater than the bar they</span>
    <span class="s3"># are plotted on</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s1">barcont </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">capsize</span><span class="s2">=</span><span class="s5">5</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">3</span><span class="s2">)</span>

    <span class="s1">data_line</span><span class="s2">, </span><span class="s1">caplines</span><span class="s2">, </span><span class="s1">barlinecols </span><span class="s2">= </span><span class="s1">barcont</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">.</span><span class="s1">lines</span>
    <span class="s0">for </span><span class="s1">bar </span><span class="s0">in </span><span class="s1">barcont</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">capline </span><span class="s0">in </span><span class="s1">caplines</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">capline</span><span class="s2">.</span><span class="s1">zorder </span><span class="s2">&gt; </span><span class="s1">bar</span><span class="s2">.</span><span class="s1">zorder</span>
        <span class="s0">for </span><span class="s1">barlinecol </span><span class="s0">in </span><span class="s1">barlinecols</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">barlinecol</span><span class="s2">.</span><span class="s1">zorder </span><span class="s2">&gt; </span><span class="s1">bar</span><span class="s2">.</span><span class="s1">zorder</span>


<span class="s0">def </span><span class="s1">test_set_ticks_inverted</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_xaxis</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([</span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.7</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xticks</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_aspect_nonlinear_adjustable_box</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))  </span><span class="s3"># Square.</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">.4</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">], [</span><span class="s5">.4</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">])  </span><span class="s3"># Set minpos to keep logit happy.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xscale</span><span class="s2">=</span><span class="s4">&quot;log&quot;</span><span class="s2">, </span><span class="s1">xlim</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">),</span>
           <span class="s1">yscale</span><span class="s2">=</span><span class="s4">&quot;logit&quot;</span><span class="s2">, </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">/</span><span class="s5">11</span><span class="s2">, </span><span class="s5">1</span><span class="s2">/</span><span class="s5">1001</span><span class="s2">),</span>
           <span class="s1">aspect</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">adjustable</span><span class="s2">=</span><span class="s4">&quot;box&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">pos </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">transFigure</span><span class="s2">.</span><span class="s1">transform_bbox</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">())</span>
    <span class="s0">assert </span><span class="s1">pos</span><span class="s2">.</span><span class="s1">height </span><span class="s2">/ </span><span class="s1">pos</span><span class="s2">.</span><span class="s1">width </span><span class="s2">== </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">approx</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_aspect_nonlinear_adjustable_datalim</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">10</span><span class="s2">))  </span><span class="s3"># Square.</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.8</span><span class="s2">, </span><span class="s5">.8</span><span class="s2">])  </span><span class="s3"># Square.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">.4</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">], [</span><span class="s5">.4</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">])  </span><span class="s3"># Set minpos to keep logit happy.</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xscale</span><span class="s2">=</span><span class="s4">&quot;log&quot;</span><span class="s2">, </span><span class="s1">xlim</span><span class="s2">=(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">100</span><span class="s2">),</span>
           <span class="s1">yscale</span><span class="s2">=</span><span class="s4">&quot;logit&quot;</span><span class="s2">, </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s5">1 </span><span class="s2">/ </span><span class="s5">101</span><span class="s2">, </span><span class="s5">1 </span><span class="s2">/ </span><span class="s5">11</span><span class="s2">),</span>
           <span class="s1">aspect</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">adjustable</span><span class="s2">=</span><span class="s4">&quot;datalim&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">apply_aspect</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">approx</span><span class="s2">([</span><span class="s5">1</span><span class="s2">*</span><span class="s5">10</span><span class="s2">**(</span><span class="s5">1</span><span class="s2">/</span><span class="s5">2</span><span class="s2">), </span><span class="s5">100</span><span class="s2">/</span><span class="s5">10</span><span class="s2">**(</span><span class="s5">1</span><span class="s2">/</span><span class="s5">2</span><span class="s2">)])</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">1 </span><span class="s2">/ </span><span class="s5">101</span><span class="s2">, </span><span class="s5">1 </span><span class="s2">/ </span><span class="s5">11</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_box_aspect</span><span class="s2">():</span>
    <span class="s3"># Test if axes with box_aspect=1 has same dimensions</span>
    <span class="s3"># as axes with aspect equal and adjustable=&quot;box&quot;</span>

    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">axtwin </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s1">axtwin</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">12</span><span class="s2">, </span><span class="s5">344</span><span class="s2">])</span>

    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_box_aspect</span><span class="s2">(</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_box_aspect</span><span class="s2">() == </span><span class="s5">1.0</span>

    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">6</span><span class="s2">, </span><span class="s5">8</span><span class="s2">])</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s4">&quot;equal&quot;</span><span class="s2">, </span><span class="s1">adjustable</span><span class="s2">=</span><span class="s4">&quot;box&quot;</span><span class="s2">)</span>

    <span class="s1">fig1</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">fig2</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s1">bb1 </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">bbt </span><span class="s2">= </span><span class="s1">axtwin</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">bb2 </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>

    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">bb1</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, </span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">bbt</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, </span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_box_aspect_custom_position</span><span class="s2">():</span>
    <span class="s3"># Test if axes with custom position and box_aspect</span>
    <span class="s3"># behaves the same independent of the order of setting those.</span>

    <span class="s1">fig1</span><span class="s2">, </span><span class="s1">ax1 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">])</span>
    <span class="s1">fig1</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_box_aspect</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)</span>

    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_box_aspect</span><span class="s2">(</span><span class="s5">1.</span><span class="s2">)</span>
    <span class="s1">fig2</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">set_position</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">])</span>

    <span class="s1">fig1</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">fig2</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s1">bb1 </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">bb2 </span><span class="s2">= </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>

    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">bb1</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">, </span><span class="s1">bb2</span><span class="s2">.</span><span class="s1">extents</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_bbox_aspect_axes_init</span><span class="s2">():</span>
    <span class="s3"># Test that box_aspect can be given to axes init and produces</span>
    <span class="s3"># all equal square axes.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s1">subplot_kw</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">box_aspect</span><span class="s2">=</span><span class="s5">1</span><span class="s2">),</span>
                            <span class="s1">constrained_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()</span>
    <span class="s1">sizes </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:</span>
        <span class="s1">bb </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">)</span>
        <span class="s1">sizes</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">([</span><span class="s1">bb</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">bb</span><span class="s2">.</span><span class="s1">height</span><span class="s2">])</span>

    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">sizes</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_set_aspect_negative</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;must be finite and positive&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;must be finite and positive&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;must be finite and positive&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;must be finite and positive&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_aspect</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_redraw_in_frame</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">redraw_in_frame</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_invisible_axes_events</span><span class="s2">():</span>
    <span class="s3"># invisible axes should not respond to events...</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">inaxes</span><span class="s2">((</span><span class="s5">200</span><span class="s2">, </span><span class="s5">200</span><span class="s2">)) </span><span class="s0">is not None</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_visible</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">inaxes</span><span class="s2">((</span><span class="s5">200</span><span class="s2">, </span><span class="s5">200</span><span class="s2">)) </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_xtickcolor_is_not_markercolor</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'lines.markeredgecolor'</span><span class="s2">] = </span><span class="s4">'white'</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">ticks </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_major_ticks</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ticks</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">tick1line</span><span class="s2">.</span><span class="s1">get_markeredgecolor</span><span class="s2">() != </span><span class="s4">'white'</span>


<span class="s0">def </span><span class="s1">test_ytickcolor_is_not_markercolor</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'lines.markeredgecolor'</span><span class="s2">] = </span><span class="s4">'white'</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">ticks </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_ticks</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ticks</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">tick1line</span><span class="s2">.</span><span class="s1">get_markeredgecolor</span><span class="s2">() != </span><span class="s4">'white'</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'axis'</span><span class="s2">, (</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">))</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'auto'</span><span class="s2">, (</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">None</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_unautoscale</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">, </span><span class="s1">auto</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">100</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">get_autoscale_on </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s4">f'get_autoscale</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s4">_on'</span><span class="s2">)</span>
    <span class="s1">set_lim </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s4">f'set_</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s4">lim'</span><span class="s2">)</span>
    <span class="s1">get_lim </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s4">f'get_</span><span class="s0">{</span><span class="s1">axis</span><span class="s0">}</span><span class="s4">lim'</span><span class="s2">)</span>

    <span class="s1">post_auto </span><span class="s2">= </span><span class="s1">get_autoscale_on</span><span class="s2">() </span><span class="s0">if </span><span class="s1">auto </span><span class="s0">is None else </span><span class="s1">auto</span>

    <span class="s1">set_lim</span><span class="s2">((-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">auto</span><span class="s2">=</span><span class="s1">auto</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">post_auto </span><span class="s2">== </span><span class="s1">get_autoscale_on</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">get_lim</span><span class="s2">(), (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_polar_interpolation_steps_variable_r</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">l</span><span class="s2">, = </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">projection</span><span class="s2">=</span><span class="s4">&quot;polar&quot;</span><span class="s2">).</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">/</span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">get_path</span><span class="s2">().</span><span class="s1">_interpolation_steps </span><span class="s2">= </span><span class="s5">100</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">projection</span><span class="s2">=</span><span class="s4">&quot;polar&quot;</span><span class="s2">).</span><span class="s1">plot</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">/</span><span class="s5">2</span><span class="s2">, </span><span class="s5">101</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">101</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_autoscale_tiny_sticky</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1e-9</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1.05e-9</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_xtickcolor_is_not_xticklabelcolor</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'xtick.color'</span><span class="s2">] = </span><span class="s4">'yellow'</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'xtick.labelcolor'</span><span class="s2">] = </span><span class="s4">'blue'</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">ticks </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_major_ticks</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ticks</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">tick1line</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'yellow'</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'blue'</span>


<span class="s0">def </span><span class="s1">test_ytickcolor_is_not_yticklabelcolor</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'ytick.color'</span><span class="s2">] = </span><span class="s4">'yellow'</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'ytick.labelcolor'</span><span class="s2">] = </span><span class="s4">'blue'</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">ticks </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_major_ticks</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">ticks</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">tick1line</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'yellow'</span>
        <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'blue'</span>


<span class="s0">def </span><span class="s1">test_xaxis_offsetText_color</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'xtick.labelcolor'</span><span class="s2">] = </span><span class="s4">'blue'</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'blue'</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'xtick.color'</span><span class="s2">] = </span><span class="s4">'yellow'</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'xtick.labelcolor'</span><span class="s2">] = </span><span class="s4">'inherit'</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'yellow'</span>


<span class="s0">def </span><span class="s1">test_yaxis_offsetText_color</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'ytick.labelcolor'</span><span class="s2">] = </span><span class="s4">'green'</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'green'</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'ytick.color'</span><span class="s2">] = </span><span class="s4">'red'</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'ytick.labelcolor'</span><span class="s2">] = </span><span class="s4">'inherit'</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">offsetText</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'red'</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'size'</span><span class="s2">, [</span><span class="s1">size </span><span class="s0">for </span><span class="s1">size </span><span class="s0">in </span><span class="s1">mfont_manager</span><span class="s2">.</span><span class="s1">font_scalings</span>
                                  <span class="s0">if </span><span class="s1">size </span><span class="s0">is not None</span><span class="s2">] + [</span><span class="s5">8</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">12</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_relative_ticklabel_sizes</span><span class="s2">(</span><span class="s1">size</span><span class="s2">):</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'xtick.labelsize'</span><span class="s2">] = </span><span class="s1">size</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'ytick.labelsize'</span><span class="s2">] = </span><span class="s1">size</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s0">for </span><span class="s1">name</span><span class="s2">, </span><span class="s1">axis </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">([</span><span class="s4">'x'</span><span class="s2">, </span><span class="s4">'y'</span><span class="s2">], [</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">]):</span>
        <span class="s0">for </span><span class="s1">tick </span><span class="s0">in </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">get_major_ticks</span><span class="s2">():</span>
            <span class="s0">assert </span><span class="s1">tick</span><span class="s2">.</span><span class="s1">label1</span><span class="s2">.</span><span class="s1">get_size</span><span class="s2">() == </span><span class="s1">axis</span><span class="s2">.</span><span class="s1">_get_tick_label_size</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_multiplot_autoscale</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s4">'all'</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">18000</span><span class="s2">, </span><span class="s5">18250</span><span class="s2">, </span><span class="s5">18500</span><span class="s2">, </span><span class="s5">18750</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">axhspan</span><span class="s2">(-</span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">xlim </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">, [</span><span class="s5">18000</span><span class="s2">, </span><span class="s5">18800</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_sharing_does_not_link_positions</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax0 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s5">221</span><span class="s2">)</span>
    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s5">.6</span><span class="s2">, </span><span class="s5">.6</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">], </span><span class="s1">sharex</span><span class="s2">=</span><span class="s1">ax0</span><span class="s2">)</span>
    <span class="s1">init_pos </span><span class="s2">= </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">get_position</span><span class="s2">().</span><span class="s1">get_points</span><span class="s2">() == </span><span class="s1">init_pos</span><span class="s2">.</span><span class="s1">get_points</span><span class="s2">()).</span><span class="s1">all</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;pdf&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_2dcolor_plot</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">color </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">])</span>
    <span class="s3"># plot with 1D-color:</span>
    <span class="s1">axs </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;argument looks like a single numeric RGB&quot;</span><span class="s2">):</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">step</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">))</span>
    <span class="s3"># plot with 2D-color:</span>
    <span class="s1">axs </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">2</span><span class="s2">].</span><span class="s1">step</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">3</span><span class="s2">].</span><span class="s1">hist</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">4</span><span class="s2">].</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s1">color</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">((</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">)))</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_shared_axes_clear</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">axs </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>

    <span class="s1">axs </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_shared_axes_retick</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s4">'all'</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s4">'all'</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s4">'o-'</span><span class="s2">)</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_xticks</span><span class="s2">([-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">])  </span><span class="s3"># should affect all axes xlims</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_xlim</span><span class="s2">()</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_yticks</span><span class="s2">([-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">])  </span><span class="s3"># should affect all axes ylims</span>
    <span class="s0">for </span><span class="s1">ax </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">() == </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_ylim</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'ha'</span><span class="s2">, [</span><span class="s4">'left'</span><span class="s2">, </span><span class="s4">'center'</span><span class="s2">, </span><span class="s4">'right'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_ylabel_ha_with_position</span><span class="s2">(</span><span class="s1">ha</span><span class="s2">):</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">Figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">&quot;test&quot;</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ha</span><span class="s2">=</span><span class="s1">ha</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_label_position</span><span class="s2">(</span><span class="s4">&quot;right&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">().</span><span class="s1">get_ha</span><span class="s2">() == </span><span class="s1">ha</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_vertical</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">xs</span><span class="s2">, </span><span class="s1">heights </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">, </span><span class="s1">heights</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">xs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">heights</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'bottom'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">xs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">heights</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'top'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_vertical_yinverted</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s1">xs</span><span class="s2">, </span><span class="s1">heights </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">, </span><span class="s1">heights</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">xs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">heights</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'top'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">xs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">heights</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'bottom'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_horizontal</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ys</span><span class="s2">, </span><span class="s1">widths </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">ys</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">widths</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">ys</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'left'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">widths</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">ys</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'right'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_horizontal_yinverted</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s1">ys</span><span class="s2">, </span><span class="s1">widths </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">ys</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">widths</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">ys</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'left'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">widths</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">ys</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'right'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_horizontal_xinverted</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_xaxis</span><span class="s2">()</span>
    <span class="s1">ys</span><span class="s2">, </span><span class="s1">widths </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">ys</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">widths</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">ys</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'right'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">widths</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">ys</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'left'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_horizontal_xyinverted</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_xaxis</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s1">ys</span><span class="s2">, </span><span class="s1">widths </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">ys</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">widths</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">ys</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'right'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">widths</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">ys</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'left'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_center</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ys</span><span class="s2">, </span><span class="s1">widths </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">ys</span><span class="s2">, </span><span class="s1">widths</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">, </span><span class="s1">label_type</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'test_centered_bar_label_nonlinear.svg'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_centered_bar_label_nonlinear</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">bar_container </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">([</span><span class="s4">'c'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'a'</span><span class="s2">], [</span><span class="s5">1_000</span><span class="s2">, </span><span class="s5">5_000</span><span class="s2">, </span><span class="s5">7_000</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xscale</span><span class="s2">(</span><span class="s4">'log'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">bar_container</span><span class="s2">, </span><span class="s1">label_type</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_axis_off</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_centered_bar_label_label_beyond_limits</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">last </span><span class="s2">= </span><span class="s5">0</span>
    <span class="s0">for </span><span class="s1">label</span><span class="s2">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">([</span><span class="s4">'a'</span><span class="s2">, </span><span class="s4">'b'</span><span class="s2">, </span><span class="s4">'c'</span><span class="s2">], [</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">50</span><span class="s2">]):</span>
        <span class="s1">bar_container </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s4">'col'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">label</span><span class="s2">, </span><span class="s1">left</span><span class="s2">=</span><span class="s1">last</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">bar_container</span><span class="s2">, </span><span class="s1">label_type</span><span class="s2">=</span><span class="s4">'center'</span><span class="s2">)</span>
        <span class="s1">last </span><span class="s2">+= </span><span class="s1">value</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s5">20</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_bar_label_location_errorbars</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">xs</span><span class="s2">, </span><span class="s1">heights </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">]</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">, </span><span class="s1">heights</span><span class="s2">, </span><span class="s1">yerr</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">xs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">heights</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] + </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'bottom'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s1">xs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">heights</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] - </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_horizontalalignment</span><span class="s2">() == </span><span class="s4">'center'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'top'</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'fmt'</span><span class="s2">, [</span>
    <span class="s4">'%.2f'</span><span class="s2">, </span><span class="s4">'{:.2f}'</span><span class="s2">, </span><span class="s4">'{:.2f}'</span><span class="s2">.</span><span class="s1">format</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bar_label_fmt</span><span class="s2">(</span><span class="s1">fmt</span><span class="s2">):</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">])</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s1">fmt</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'3.00'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'-4.00'</span>


<span class="s0">def </span><span class="s1">test_bar_label_fmt_error</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'str or callable'</span><span class="s2">):</span>
        <span class="s1">_ </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">=</span><span class="s5">10</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_bar_label_labels</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">rects </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">])</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">rects</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s4">'A'</span><span class="s2">, </span><span class="s4">'B'</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'A'</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'B'</span>


<span class="s0">def </span><span class="s1">test_bar_label_nan_ydata</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels</span><span class="s2">] == [</span><span class="s4">''</span><span class="s2">, </span><span class="s4">'1'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'bottom'</span>


<span class="s0">def </span><span class="s1">test_bar_label_nan_ydata_inverted</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis_inverted</span><span class="s2">()</span>
    <span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels</span><span class="s2">] == [</span><span class="s4">''</span><span class="s2">, </span><span class="s4">'1'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">xy </span><span class="s2">== (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">labels</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_verticalalignment</span><span class="s2">() == </span><span class="s4">'bottom'</span>


<span class="s0">def </span><span class="s1">test_nan_barlabels</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=[</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">])</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels</span><span class="s2">] == [</span><span class="s4">''</span><span class="s2">, </span><span class="s4">'1'</span><span class="s2">, </span><span class="s4">'2'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=[</span><span class="s5">0.2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">])</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels</span><span class="s2">] == [</span><span class="s4">'0'</span><span class="s2">, </span><span class="s4">'1'</span><span class="s2">, </span><span class="s4">'2'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">yerr</span><span class="s2">=[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">])</span>
    <span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar_label</span><span class="s2">(</span><span class="s1">bars</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">labels</span><span class="s2">] == [</span><span class="s4">''</span><span class="s2">, </span><span class="s4">'1'</span><span class="s2">, </span><span class="s4">'2'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">(), (</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">3.0</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_patch_bounds</span><span class="s2">():  </span><span class="s3"># PR 19078</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Wedge</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">), </span><span class="s5">1.05</span><span class="s2">, </span><span class="s5">60</span><span class="s2">, </span><span class="s5">120</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s5">0.1</span><span class="s2">))</span>
    <span class="s1">bot </span><span class="s2">= </span><span class="s5">1.9</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s5">15</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">/</span><span class="s5">180</span><span class="s2">)**</span><span class="s5">2</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_almost_equal_nulp</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">((-</span><span class="s5">0.525</span><span class="s2">, -(</span><span class="s1">bot</span><span class="s2">+</span><span class="s5">0.05</span><span class="s2">), </span><span class="s5">1.05</span><span class="s2">, </span><span class="s1">bot</span><span class="s2">+</span><span class="s5">0.1</span><span class="s2">)), </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">dataLim</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, </span><span class="s5">16</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_warn_ignored_scatter_kwargs</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;You passed a edgecolor/edgecolors&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s4">&quot;+&quot;</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s5">500</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;r&quot;</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">&quot;b&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_artist_sublists</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">lines </span><span class="s2">= [</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">i </span><span class="s2">+ </span><span class="s5">5</span><span class="s2">))[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">6</span><span class="s2">)]</span>
    <span class="s1">col </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">5</span><span class="s2">))</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">)))</span>
    <span class="s1">patch </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">), </span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">))</span>
    <span class="s1">text </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s4">'foo'</span><span class="s2">)</span>

    <span class="s3"># Get items, which should not be mixed.</span>
    <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">collections</span><span class="s2">) == [</span><span class="s1">col</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">images</span><span class="s2">) == [</span><span class="s1">im</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">) == </span><span class="s1">lines</span>
    <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">) == [</span><span class="s1">patch</span><span class="s2">]</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">tables</span>
    <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">texts</span><span class="s2">) == [</span><span class="s1">text</span><span class="s2">]</span>

    <span class="s3"># Get items should work like lists/tuple.</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s0">is </span><span class="s1">lines</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] </span><span class="s0">is </span><span class="s1">lines</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">'out of range'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">[</span><span class="s1">len</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">) + </span><span class="s5">1</span><span class="s2">]</span>

    <span class="s3"># Adding to other lists should produce a regular list.</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines </span><span class="s2">+ [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">] == [*</span><span class="s1">lines</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">] + </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines </span><span class="s2">== [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, *</span><span class="s1">lines</span><span class="s2">]</span>

    <span class="s3"># Adding to other tuples should produce a regular tuples.</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines </span><span class="s2">+ (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">) == (*</span><span class="s1">lines</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">) + </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines </span><span class="s2">== (</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, *</span><span class="s1">lines</span><span class="s2">)</span>

    <span class="s3"># Lists should be empty after removing items.</span>
    <span class="s1">col</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">collections</span>
    <span class="s1">im</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">images</span>
    <span class="s1">patch</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">patches</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">tables</span>
    <span class="s1">text</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">texts</span>

    <span class="s0">for </span><span class="s1">ln </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">:</span>
        <span class="s1">ln</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">) == </span><span class="s5">0</span>


<span class="s0">def </span><span class="s1">test_empty_line_plots</span><span class="s2">():</span>
    <span class="s3"># Incompatible nr columns, plot &quot;nothing&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">10</span><span class="s2">, </span><span class="s5">0</span><span class="s2">))</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">line</span><span class="s2">) == </span><span class="s5">0</span>

    <span class="s3"># Ensure plot([],[]) creates line</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([], [])</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">line</span><span class="s2">) == </span><span class="s5">1</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">'fmt, match'</span><span class="s2">, (</span>
    <span class="s2">(</span><span class="s4">&quot;f&quot;</span><span class="s2">, </span><span class="s4">r&quot;'f' is not a valid format string \(unrecognized character 'f'\)&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;o+&quot;</span><span class="s2">, </span><span class="s4">r&quot;'o\+' is not a valid format string \(two marker symbols\)&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;:-&quot;</span><span class="s2">, </span><span class="s4">r&quot;':-' is not a valid format string \(two linestyle symbols\)&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;rk&quot;</span><span class="s2">, </span><span class="s4">r&quot;'rk' is not a valid format string \(two color symbols\)&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;:o-r&quot;</span><span class="s2">, </span><span class="s4">r&quot;':o-r' is not a valid format string \(two linestyle symbols\)&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;C&quot;</span><span class="s2">, </span><span class="s4">r&quot;'C' is not a valid format string \('C' must be followed by a number\)&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s4">&quot;.C&quot;</span><span class="s2">, </span><span class="s4">r&quot;'.C' is not a valid format string \('C' must be followed by a number\)&quot;</span><span class="s2">),</span>
<span class="s2">))</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;data&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, {</span><span class="s4">&quot;string&quot;</span><span class="s2">: </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)}])</span>
<span class="s0">def </span><span class="s1">test_plot_format_errors</span><span class="s2">(</span><span class="s1">fmt</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">data</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">if </span><span class="s1">data </span><span class="s0">is not None</span><span class="s2">:</span>
        <span class="s1">match </span><span class="s2">= </span><span class="s1">match</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">&quot;not&quot;</span><span class="s2">, </span><span class="s4">&quot;neither a data key nor&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;\A&quot; </span><span class="s2">+ </span><span class="s1">match </span><span class="s2">+ </span><span class="s4">r&quot;\Z&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">&quot;string&quot;</span><span class="s2">, </span><span class="s1">fmt</span><span class="s2">, </span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_plot_format</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s4">'1.0'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_color</span><span class="s2">() == (</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s4">'None'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s4">'1'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s4">'1'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s4">'1.0'</span><span class="s2">, </span><span class="s4">&quot;1&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_color</span><span class="s2">() == (</span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'1'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s4">'1'</span><span class="s2">, </span><span class="s4">&quot;1.0&quot;</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s4">'1'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'1.0'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s4">'k3'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s4">'3'</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'k'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s4">'.C12:'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s4">'.'</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">to_rgba</span><span class="s2">(</span><span class="s4">'C12'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_linestyle</span><span class="s2">() == </span><span class="s4">':'</span>


<span class="s0">def </span><span class="s1">test_automatic_legend</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">={</span><span class="s4">&quot;d&quot;</span><span class="s2">: </span><span class="s5">2</span><span class="s2">})</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'a'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'a'</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">={</span><span class="s4">&quot;d&quot;</span><span class="s2">: </span><span class="s5">2</span><span class="s2">})</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'b'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'a'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">'b'</span>


<span class="s0">def </span><span class="s1">test_plot_errors</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;plot\(\) got an unexpected keyword&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">x</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;plot\(\) with multiple groups&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=[</span><span class="s4">'1'</span><span class="s2">, </span><span class="s4">'2'</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;x and y must have same first&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;x and y can be no greater than&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;Using arbitrary long args with&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">&quot;a&quot;</span><span class="s2">, </span><span class="s4">&quot;b&quot;</span><span class="s2">, </span><span class="s4">&quot;c&quot;</span><span class="s2">, </span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">={</span><span class="s4">&quot;a&quot;</span><span class="s2">: </span><span class="s5">2</span><span class="s2">})</span>


<span class="s0">def </span><span class="s1">test_clim</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">add_subplot</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">plot_method </span><span class="s0">in </span><span class="s2">[</span>
            <span class="s1">partial</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">, </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">), </span><span class="s1">c</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)),</span>
            <span class="s1">partial</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">, [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]),</span>
            <span class="s1">partial</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolor</span><span class="s2">,  [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]),</span>
            <span class="s1">partial</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">, [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]),</span>
            <span class="s1">partial</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolorfast</span><span class="s2">, [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]]),</span>
    <span class="s2">]:</span>
        <span class="s1">clim </span><span class="s2">= (</span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">)</span>
        <span class="s1">norm </span><span class="s2">= </span><span class="s1">plot_method</span><span class="s2">(</span><span class="s1">clim</span><span class="s2">=</span><span class="s1">clim</span><span class="s2">).</span><span class="s1">norm</span>
        <span class="s0">assert </span><span class="s2">(</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">vmin</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">.</span><span class="s1">vmax</span><span class="s2">) == </span><span class="s1">clim</span>


<span class="s0">def </span><span class="s1">test_bezier_autoscale</span><span class="s2">():</span>
    <span class="s3"># Check that bezier curves autoscale to their curves, and not their</span>
    <span class="s3"># control points</span>
    <span class="s1">verts </span><span class="s2">= [[-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]]</span>
    <span class="s1">codes </span><span class="s2">= [</span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">MOVETO</span><span class="s2">,</span>
             <span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">CURVE3</span><span class="s2">,</span>
             <span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">CURVE3</span><span class="s2">,</span>
             <span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">CLOSEPOLY</span><span class="s2">]</span>
    <span class="s1">p </span><span class="s2">= </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">(</span><span class="s1">verts</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">PathPatch</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">()</span>
    <span class="s3"># Bottom ylim should be at the edge of the curve (-0.5), and not include</span>
    <span class="s3"># the control point (at -1)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">] == -</span><span class="s5">0.5</span>


<span class="s0">def </span><span class="s1">test_small_autoscale</span><span class="s2">():</span>
    <span class="s3"># Check that paths with small values autoscale correctly #24097.</span>
    <span class="s1">verts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span>
        <span class="s2">[-</span><span class="s5">5.45</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">5.45</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">5.29</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">5.29</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">5.13</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">5.13</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.97</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.97</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">4.81</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.81</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.65</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.65</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">4.49</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.49</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.33</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.33</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">4.17</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.17</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.01</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">4.01</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">3.85</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">3.85</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">3.69</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">3.69</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">3.53</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">3.53</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">3.37</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">3.37</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">3.21</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [-</span><span class="s5">3.21</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">], [-</span><span class="s5">3.05</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">], [-</span><span class="s5">3.05</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">2.89</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">], [-</span><span class="s5">2.89</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">], [-</span><span class="s5">2.73</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">], [-</span><span class="s5">2.73</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">2.57</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">], [-</span><span class="s5">2.57</span><span class="s2">, </span><span class="s5">0.04</span><span class="s2">], [-</span><span class="s5">2.41</span><span class="s2">, </span><span class="s5">0.04</span><span class="s2">], [-</span><span class="s5">2.41</span><span class="s2">, </span><span class="s5">0.04</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">2.25</span><span class="s2">, </span><span class="s5">0.04</span><span class="s2">], [-</span><span class="s5">2.25</span><span class="s2">, </span><span class="s5">0.06</span><span class="s2">], [-</span><span class="s5">2.09</span><span class="s2">, </span><span class="s5">0.06</span><span class="s2">], [-</span><span class="s5">2.09</span><span class="s2">, </span><span class="s5">0.08</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">1.93</span><span class="s2">, </span><span class="s5">0.08</span><span class="s2">], [-</span><span class="s5">1.93</span><span class="s2">, </span><span class="s5">0.10</span><span class="s2">], [-</span><span class="s5">1.77</span><span class="s2">, </span><span class="s5">0.10</span><span class="s2">], [-</span><span class="s5">1.77</span><span class="s2">, </span><span class="s5">0.12</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">1.61</span><span class="s2">, </span><span class="s5">0.12</span><span class="s2">], [-</span><span class="s5">1.61</span><span class="s2">, </span><span class="s5">0.14</span><span class="s2">], [-</span><span class="s5">1.45</span><span class="s2">, </span><span class="s5">0.14</span><span class="s2">], [-</span><span class="s5">1.45</span><span class="s2">, </span><span class="s5">0.17</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">1.30</span><span class="s2">, </span><span class="s5">0.17</span><span class="s2">], [-</span><span class="s5">1.30</span><span class="s2">, </span><span class="s5">0.19</span><span class="s2">], [-</span><span class="s5">1.14</span><span class="s2">, </span><span class="s5">0.19</span><span class="s2">], [-</span><span class="s5">1.14</span><span class="s2">, </span><span class="s5">0.22</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">0.98</span><span class="s2">, </span><span class="s5">0.22</span><span class="s2">], [-</span><span class="s5">0.98</span><span class="s2">, </span><span class="s5">0.25</span><span class="s2">], [-</span><span class="s5">0.82</span><span class="s2">, </span><span class="s5">0.25</span><span class="s2">], [-</span><span class="s5">0.82</span><span class="s2">, </span><span class="s5">0.27</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">0.66</span><span class="s2">, </span><span class="s5">0.27</span><span class="s2">], [-</span><span class="s5">0.66</span><span class="s2">, </span><span class="s5">0.29</span><span class="s2">], [-</span><span class="s5">0.50</span><span class="s2">, </span><span class="s5">0.29</span><span class="s2">], [-</span><span class="s5">0.50</span><span class="s2">, </span><span class="s5">0.30</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">0.34</span><span class="s2">, </span><span class="s5">0.30</span><span class="s2">], [-</span><span class="s5">0.34</span><span class="s2">, </span><span class="s5">0.32</span><span class="s2">], [-</span><span class="s5">0.18</span><span class="s2">, </span><span class="s5">0.32</span><span class="s2">], [-</span><span class="s5">0.18</span><span class="s2">, </span><span class="s5">0.33</span><span class="s2">],</span>
        <span class="s2">[-</span><span class="s5">0.02</span><span class="s2">, </span><span class="s5">0.33</span><span class="s2">], [-</span><span class="s5">0.02</span><span class="s2">, </span><span class="s5">0.32</span><span class="s2">], [</span><span class="s5">0.13</span><span class="s2">, </span><span class="s5">0.32</span><span class="s2">], [</span><span class="s5">0.13</span><span class="s2">, </span><span class="s5">0.33</span><span class="s2">], [</span><span class="s5">0.29</span><span class="s2">, </span><span class="s5">0.33</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">0.29</span><span class="s2">, </span><span class="s5">0.31</span><span class="s2">], [</span><span class="s5">0.45</span><span class="s2">, </span><span class="s5">0.31</span><span class="s2">], [</span><span class="s5">0.45</span><span class="s2">, </span><span class="s5">0.30</span><span class="s2">], [</span><span class="s5">0.61</span><span class="s2">, </span><span class="s5">0.30</span><span class="s2">], [</span><span class="s5">0.61</span><span class="s2">, </span><span class="s5">0.28</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">0.77</span><span class="s2">, </span><span class="s5">0.28</span><span class="s2">], [</span><span class="s5">0.77</span><span class="s2">, </span><span class="s5">0.25</span><span class="s2">], [</span><span class="s5">0.93</span><span class="s2">, </span><span class="s5">0.25</span><span class="s2">], [</span><span class="s5">0.93</span><span class="s2">, </span><span class="s5">0.22</span><span class="s2">], [</span><span class="s5">1.09</span><span class="s2">, </span><span class="s5">0.22</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">1.09</span><span class="s2">, </span><span class="s5">0.19</span><span class="s2">], [</span><span class="s5">1.25</span><span class="s2">, </span><span class="s5">0.19</span><span class="s2">], [</span><span class="s5">1.25</span><span class="s2">, </span><span class="s5">0.17</span><span class="s2">], [</span><span class="s5">1.41</span><span class="s2">, </span><span class="s5">0.17</span><span class="s2">], [</span><span class="s5">1.41</span><span class="s2">, </span><span class="s5">0.15</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">1.57</span><span class="s2">, </span><span class="s5">0.15</span><span class="s2">], [</span><span class="s5">1.57</span><span class="s2">, </span><span class="s5">0.12</span><span class="s2">], [</span><span class="s5">1.73</span><span class="s2">, </span><span class="s5">0.12</span><span class="s2">], [</span><span class="s5">1.73</span><span class="s2">, </span><span class="s5">0.10</span><span class="s2">], [</span><span class="s5">1.89</span><span class="s2">, </span><span class="s5">0.10</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">1.89</span><span class="s2">, </span><span class="s5">0.08</span><span class="s2">], [</span><span class="s5">2.05</span><span class="s2">, </span><span class="s5">0.08</span><span class="s2">], [</span><span class="s5">2.05</span><span class="s2">, </span><span class="s5">0.07</span><span class="s2">], [</span><span class="s5">2.21</span><span class="s2">, </span><span class="s5">0.07</span><span class="s2">], [</span><span class="s5">2.21</span><span class="s2">, </span><span class="s5">0.05</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">2.37</span><span class="s2">, </span><span class="s5">0.05</span><span class="s2">], [</span><span class="s5">2.37</span><span class="s2">, </span><span class="s5">0.04</span><span class="s2">], [</span><span class="s5">2.53</span><span class="s2">, </span><span class="s5">0.04</span><span class="s2">], [</span><span class="s5">2.53</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">], [</span><span class="s5">2.69</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">2.69</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">], [</span><span class="s5">2.85</span><span class="s2">, </span><span class="s5">0.02</span><span class="s2">], [</span><span class="s5">2.85</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">], [</span><span class="s5">3.01</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">], [</span><span class="s5">3.01</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">3.17</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">], [</span><span class="s5">3.17</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">3.33</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">3.33</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">3.49</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">3.49</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">3.65</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">3.65</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">3.81</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">3.81</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">3.97</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">3.97</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.13</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.13</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.29</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">4.29</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.45</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.45</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.61</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.61</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s5">4.77</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.77</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.93</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">], [</span><span class="s5">4.93</span><span class="s2">, </span><span class="s5">0.00</span><span class="s2">],</span>
    <span class="s2">])</span>

    <span class="s1">minx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">verts</span><span class="s2">[:, </span><span class="s5">0</span><span class="s2">])</span>
    <span class="s1">miny </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">verts</span><span class="s2">[:, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">maxx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">verts</span><span class="s2">[:, </span><span class="s5">0</span><span class="s2">])</span>
    <span class="s1">maxy </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">verts</span><span class="s2">[:, </span><span class="s5">1</span><span class="s2">])</span>

    <span class="s1">p </span><span class="s2">= </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">(</span><span class="s1">verts</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">PathPatch</span><span class="s2">(</span><span class="s1">p</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">] &lt;= </span><span class="s1">minx</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">] &gt;= </span><span class="s1">maxx</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">] &lt;= </span><span class="s1">miny</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()[</span><span class="s5">1</span><span class="s2">] &gt;= </span><span class="s1">maxy</span>


<span class="s0">def </span><span class="s1">test_get_xticklabel</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">10</span><span class="s2">))</span>
    <span class="s0">for </span><span class="s1">ind </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s1">ind</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">ind</span><span class="s0">}</span><span class="s4">'</span>
        <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()[</span><span class="s1">ind</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s4">f'</span><span class="s0">{</span><span class="s1">ind</span><span class="s0">}</span><span class="s4">'</span>


<span class="s0">def </span><span class="s1">test_bar_leading_nan</span><span class="s2">():</span>

    <span class="s1">barx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">3</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">float</span><span class="s2">)</span>
    <span class="s1">barheights </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">])</span>
    <span class="s1">barstarts </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.77</span><span class="s2">]*</span><span class="s5">3</span><span class="s2">)</span>

    <span class="s1">barx</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">bars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">barx</span><span class="s2">, </span><span class="s1">barheights</span><span class="s2">, </span><span class="s1">bottom</span><span class="s2">=</span><span class="s1">barstarts</span><span class="s2">)</span>

    <span class="s1">hbars </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barh</span><span class="s2">(</span><span class="s1">barx</span><span class="s2">, </span><span class="s1">barheights</span><span class="s2">, </span><span class="s1">left</span><span class="s2">=</span><span class="s1">barstarts</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">bar_set </span><span class="s0">in </span><span class="s2">(</span><span class="s1">bars</span><span class="s2">, </span><span class="s1">hbars</span><span class="s2">):</span>
        <span class="s3"># the first bar should have a nan in the location</span>
        <span class="s1">nanful</span><span class="s2">, *</span><span class="s1">rest </span><span class="s2">= </span><span class="s1">bar_set</span>
        <span class="s0">assert </span><span class="s2">(~</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">nanful</span><span class="s2">.</span><span class="s1">xy</span><span class="s2">)).</span><span class="s1">any</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">nanful</span><span class="s2">.</span><span class="s1">get_width</span><span class="s2">())</span>
        <span class="s0">for </span><span class="s1">b </span><span class="s0">in </span><span class="s1">rest</span><span class="s2">:</span>
            <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">xy</span><span class="s2">).</span><span class="s1">all</span><span class="s2">()</span>
            <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">b</span><span class="s2">.</span><span class="s1">get_width</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_bar_all_nan</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">use</span><span class="s2">(</span><span class="s4">&quot;mpl20&quot;</span><span class="s2">)</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">])</span>

    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">]).</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;extent_units.png&quot;</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;mpl20&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_extent_units</span><span class="s2">():</span>
    <span class="s1">_</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">date_first </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2020-01-01'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)</span>
    <span class="s1">date_last </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s4">'2020-01-11'</span><span class="s2">, </span><span class="s4">'D'</span><span class="s2">)</span>
    <span class="s1">arr </span><span class="s2">= [[</span><span class="s1">i</span><span class="s2">+</span><span class="s1">j </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)] </span><span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">10</span><span class="s2">)]</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Date extents on y axis'</span><span class="s2">)</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">origin</span><span class="s2">=</span><span class="s4">'lower'</span><span class="s2">,</span>
                          <span class="s1">extent</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">11</span><span class="s2">, </span><span class="s1">date_first</span><span class="s2">, </span><span class="s1">date_last</span><span class="s2">],</span>
                          <span class="s1">cmap</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">&quot;plasma&quot;</span><span class="s2">])</span>

    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">set_title</span><span class="s2">(</span><span class="s4">'Date extents on x axis (Day of Jan 2020)'</span><span class="s2">)</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">origin</span><span class="s2">=</span><span class="s4">'lower'</span><span class="s2">,</span>
                          <span class="s1">extent</span><span class="s2">=[</span><span class="s1">date_first</span><span class="s2">, </span><span class="s1">date_last</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">11</span><span class="s2">],</span>
                          <span class="s1">cmap</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">&quot;plasma&quot;</span><span class="s2">])</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">DateFormatter</span><span class="s2">(</span><span class="s4">'%d'</span><span class="s2">))</span>

    <span class="s1">im </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">origin</span><span class="s2">=</span><span class="s4">'lower'</span><span class="s2">,</span>
                          <span class="s1">extent</span><span class="s2">=[</span><span class="s1">date_first</span><span class="s2">, </span><span class="s1">date_last</span><span class="s2">,</span>
                                  <span class="s1">date_first</span><span class="s2">, </span><span class="s1">date_last</span><span class="s2">],</span>
                          <span class="s1">cmap</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">&quot;plasma&quot;</span><span class="s2">])</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">DateFormatter</span><span class="s2">(</span><span class="s4">'%d'</span><span class="s2">))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">].</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlabel</span><span class="s2">=</span><span class="s4">'Day of Jan 2020'</span><span class="s2">)</span>

    <span class="s1">im </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">origin</span><span class="s2">=</span><span class="s4">'lower'</span><span class="s2">,</span>
                          <span class="s1">cmap</span><span class="s2">=</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s4">&quot;plasma&quot;</span><span class="s2">])</span>
    <span class="s1">im</span><span class="s2">.</span><span class="s1">set_extent</span><span class="s2">([</span><span class="s1">date_last</span><span class="s2">, </span><span class="s1">date_first</span><span class="s2">, </span><span class="s1">date_last</span><span class="s2">, </span><span class="s1">date_first</span><span class="s2">])</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">DateFormatter</span><span class="s2">(</span><span class="s4">'%d'</span><span class="s2">))</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">].</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlabel</span><span class="s2">=</span><span class="s4">'Day of Jan 2020'</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">r&quot;set_extent\(\) got an unexpected&quot;</span><span class="s2">):</span>
        <span class="s1">im</span><span class="s2">.</span><span class="s1">set_extent</span><span class="s2">([</span><span class="s5">2</span><span class="s2">, </span><span class="s5">12</span><span class="s2">, </span><span class="s1">date_first</span><span class="s2">, </span><span class="s1">date_last</span><span class="s2">], </span><span class="s1">clip</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_cla_clears_children_axes_and_fig</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([], [], [], [])</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s0">for </span><span class="s1">art </span><span class="s0">in </span><span class="s1">lines </span><span class="s2">+ [</span><span class="s1">img</span><span class="s2">]:</span>
        <span class="s0">assert </span><span class="s1">art</span><span class="s2">.</span><span class="s1">axes </span><span class="s0">is </span><span class="s1">ax</span>
        <span class="s0">assert </span><span class="s1">art</span><span class="s2">.</span><span class="s1">figure </span><span class="s0">is </span><span class="s1">fig</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">art </span><span class="s0">in </span><span class="s1">lines </span><span class="s2">+ [</span><span class="s1">img</span><span class="s2">]:</span>
        <span class="s0">assert </span><span class="s1">art</span><span class="s2">.</span><span class="s1">axes </span><span class="s0">is None</span>
        <span class="s0">assert </span><span class="s1">art</span><span class="s2">.</span><span class="s1">figure </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_child_axes_removal</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">marginal </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">inset_axes</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s1">sharey</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">marginal_twin </span><span class="s2">= </span><span class="s1">marginal</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>
    <span class="s1">marginal</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s5">10</span><span class="s2">, </span><span class="s5">20</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_scatter_color_repr_error</span><span class="s2">():</span>

    <span class="s0">def </span><span class="s1">get_next_color</span><span class="s2">():</span>
        <span class="s0">return </span><span class="s4">'blue'  </span><span class="s3"># pragma: no cover</span>
    <span class="s1">msg </span><span class="s2">= (</span>
            <span class="s4">r&quot;'c' argument must be a color, a sequence of colors&quot;</span>
            <span class="s4">r&quot;, or a sequence of numbers, not 'red\\n'&quot;</span>
        <span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">c </span><span class="s2">= </span><span class="s4">'red</span><span class="s0">\n</span><span class="s4">'</span>
        <span class="s1">mpl</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">.</span><span class="s1">Axes</span><span class="s2">.</span><span class="s1">_parse_scatter_color_args</span><span class="s2">(</span>
            <span class="s1">c</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">={}, </span><span class="s1">xsize</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">get_next_color_func</span><span class="s2">=</span><span class="s1">get_next_color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_zorder_and_explicit_rasterization</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_rasterization_zorder</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)</span>
    <span class="s1">ln</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">rasterized</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">zorder</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">() </span><span class="s0">as </span><span class="s1">b</span><span class="s2">:</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">format</span><span class="s2">=</span><span class="s4">'pdf'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;preset_clip_paths.png&quot;</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;mpl20&quot;</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s5">0.027 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s4">&quot;arm64&quot; </span><span class="s0">else </span><span class="s5">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_preset_clip_paths</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">poly </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">.</span><span class="s1">Polygon</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">]], </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;#ddffdd&quot;</span><span class="s2">,</span>
        <span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">&quot;#00ff00&quot;</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">poly</span><span class="s2">)</span>

    <span class="s1">line </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">((-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">clip_path</span><span class="s2">=</span><span class="s1">poly</span><span class="s2">)</span>
    <span class="s1">line</span><span class="s2">.</span><span class="s1">set_path_effects</span><span class="s2">([</span><span class="s1">patheffects</span><span class="s2">.</span><span class="s1">withTickedStroke</span><span class="s2">()])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">line</span><span class="s2">)</span>

    <span class="s1">line </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">((-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), (-</span><span class="s5">0.5</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">), </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                            <span class="s1">clip_path</span><span class="s2">=</span><span class="s1">poly</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">line</span><span class="s2">)</span>

    <span class="s1">poly2 </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">.</span><span class="s1">Polygon</span><span class="s2">(</span>
        <span class="s2">[[-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">0.25</span><span class="s2">]], </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;#beefc0&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.3</span><span class="s2">,</span>
        <span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">&quot;#faded0&quot;</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">clip_path</span><span class="s2">=</span><span class="s1">poly</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">poly2</span><span class="s2">)</span>

    <span class="s3"># When text clipping works, the &quot;Annotation&quot; text should be clipped</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">annotate</span><span class="s2">(</span><span class="s4">'Annotation'</span><span class="s2">, (-</span><span class="s5">0.75</span><span class="s2">, -</span><span class="s5">0.75</span><span class="s2">), </span><span class="s1">xytext</span><span class="s2">=(</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.75</span><span class="s2">),</span>
                <span class="s1">arrowprops</span><span class="s2">={</span><span class="s4">'color'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">}, </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">clip_path</span><span class="s2">=</span><span class="s1">poly</span><span class="s2">)</span>

    <span class="s1">poly3 </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">.</span><span class="s1">Polygon</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], [</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">], [</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]], </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s4">&quot;g&quot;</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s4">&quot;y&quot;</span><span class="s2">,</span>
        <span class="s1">linewidth</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.3</span><span class="s2">, </span><span class="s1">clip_on</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">clip_path</span><span class="s2">=</span><span class="s1">poly</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">poly3</span><span class="s2">, </span><span class="s1">clip</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">context</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_rc_axes_label_formatting</span><span class="s2">():</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.labelcolor'</span><span class="s2">] = </span><span class="s4">'red'</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.labelsize'</span><span class="s2">] = </span><span class="s5">20</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s4">'axes.labelweight'</span><span class="s2">] = </span><span class="s4">'bold'</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">() == </span><span class="s4">'red'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">get_fontsize</span><span class="s2">() == </span><span class="s5">20</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">get_fontweight</span><span class="s2">() == </span><span class="s4">'bold'</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_ecdf</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">])</span>
    <span class="s1">weights </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">data</span><span class="s2">))</span>
    <span class="s1">axs_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">orientation </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs_test</span><span class="s2">, [</span><span class="s4">&quot;vertical&quot;</span><span class="s2">, </span><span class="s4">&quot;horizontal&quot;</span><span class="s2">]):</span>
        <span class="s1">l0 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">ecdf</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">orientation</span><span class="s2">=</span><span class="s1">orientation</span><span class="s2">)</span>
        <span class="s1">l1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">ecdf</span><span class="s2">(</span><span class="s4">&quot;d&quot;</span><span class="s2">, </span><span class="s4">&quot;w&quot;</span><span class="s2">, </span><span class="s1">data</span><span class="s2">={</span><span class="s4">&quot;d&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s4">&quot;w&quot;</span><span class="s2">: </span><span class="s1">weights</span><span class="s2">},</span>
                     <span class="s1">orientation</span><span class="s2">=</span><span class="s1">orientation</span><span class="s2">,</span>
                     <span class="s1">complementary</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">compress</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">&quot;:&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">l0</span><span class="s2">.</span><span class="s1">get_xdata</span><span class="s2">()) == (~</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)).</span><span class="s1">sum</span><span class="s2">() + </span><span class="s5">1</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">l1</span><span class="s2">.</span><span class="s1">get_xdata</span><span class="s2">()) == </span><span class="s1">len</span><span class="s2">({*</span><span class="s1">data</span><span class="s2">[~</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)]}) + </span><span class="s5">1</span>
    <span class="s1">axs_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">],</span>
                    <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">8</span><span class="s2">) / </span><span class="s5">7</span><span class="s2">, </span><span class="s1">ds</span><span class="s2">=</span><span class="s4">&quot;steps-post&quot;</span><span class="s2">)</span>
    <span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">([-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">],</span>
                    <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">21</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]) / </span><span class="s5">21</span><span class="s2">,</span>
                    <span class="s1">ds</span><span class="s2">=</span><span class="s4">&quot;steps-pre&quot;</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">&quot;:&quot;</span><span class="s2">)</span>
    <span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">8</span><span class="s2">) / </span><span class="s5">7</span><span class="s2">,</span>
                    <span class="s2">[-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">],</span>
                    <span class="s1">ds</span><span class="s2">=</span><span class="s4">&quot;steps-pre&quot;</span><span class="s2">)</span>
    <span class="s1">axs_ref</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">21</span><span class="s2">, </span><span class="s5">20</span><span class="s2">, </span><span class="s5">18</span><span class="s2">, </span><span class="s5">14</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]) / </span><span class="s5">21</span><span class="s2">,</span>
                    <span class="s2">[-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">],</span>
                    <span class="s1">ds</span><span class="s2">=</span><span class="s4">&quot;steps-post&quot;</span><span class="s2">, </span><span class="s1">ls</span><span class="s2">=</span><span class="s4">&quot;:&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_ecdf_invalid</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">ecdf</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">ecdf</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]))</span>


<span class="s0">def </span><span class="s1">test_fill_between_axes_limits</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">4 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s5">0.01</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s5">0.1</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">threshold </span><span class="s2">= </span><span class="s5">0.075</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">)</span>

    <span class="s1">original_lims </span><span class="s2">= (</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">())</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">threshold</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.7</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s1">where</span><span class="s2">=</span><span class="s1">y </span><span class="s2">&gt; </span><span class="s1">threshold</span><span class="s2">,</span>
                    <span class="s1">color</span><span class="s2">=</span><span class="s4">'green'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xaxis_transform</span><span class="s2">())</span>

    <span class="s0">assert </span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()) == </span><span class="s1">original_lims</span>


<span class="s0">def </span><span class="s1">test_tick_param_labelfont</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlabel</span><span class="s2">(</span><span class="s4">'X label in Impact font'</span><span class="s2">, </span><span class="s1">fontname</span><span class="s2">=</span><span class="s4">'Impact'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylabel</span><span class="s2">(</span><span class="s4">'Y label in xkcd script'</span><span class="s2">, </span><span class="s1">fontname</span><span class="s2">=</span><span class="s4">'xkcd script'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">color</span><span class="s2">=</span><span class="s4">'r'</span><span class="s2">, </span><span class="s1">labelfontfamily</span><span class="s2">=</span><span class="s4">'monospace'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">title</span><span class="s2">(</span><span class="s4">'Title in sans-serif'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">():</span>
        <span class="s0">assert </span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_fontfamily</span><span class="s2">()[</span><span class="s5">0</span><span class="s2">] == </span><span class="s4">'monospace'</span>


<span class="s0">def </span><span class="s1">test_set_secondary_axis_color</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">sax </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">secondary_xaxis</span><span class="s2">(</span><span class="s4">&quot;top&quot;</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">&quot;red&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">sax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">[</span><span class="s4">&quot;bottom&quot;</span><span class="s2">].</span><span class="s1">get_edgecolor</span><span class="s2">(), </span><span class="s4">&quot;red&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">sax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">[</span><span class="s4">&quot;top&quot;</span><span class="s2">].</span><span class="s1">get_edgecolor</span><span class="s2">(), </span><span class="s4">&quot;red&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">sax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_tick_params</span><span class="s2">()[</span><span class="s4">&quot;color&quot;</span><span class="s2">], </span><span class="s4">&quot;red&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">sax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_tick_params</span><span class="s2">()[</span><span class="s4">&quot;labelcolor&quot;</span><span class="s2">], </span><span class="s4">&quot;red&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">sax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">label</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s4">&quot;red&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_xylim_changed_shared</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">events </span><span class="s2">= []</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">callbacks</span><span class="s2">.</span><span class="s1">connect</span><span class="s2">(</span><span class="s4">&quot;xlim_changed&quot;</span><span class="s2">, </span><span class="s1">events</span><span class="s2">.</span><span class="s1">append</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">callbacks</span><span class="s2">.</span><span class="s1">connect</span><span class="s2">(</span><span class="s4">&quot;ylim_changed&quot;</span><span class="s2">, </span><span class="s1">events</span><span class="s2">.</span><span class="s1">append</span><span class="s2">)</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">ylim</span><span class="s2">=[</span><span class="s5">2</span><span class="s2">, </span><span class="s5">4</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">events </span><span class="s2">== [</span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]]</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">&quot;axhvlinespan_interpolation.png&quot;</span><span class="s2">], </span><span class="s1">style</span><span class="s2">=</span><span class="s4">&quot;default&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_axhvlinespan_interpolation</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">projection</span><span class="s2">=</span><span class="s4">&quot;polar&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_axis_off</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s5">.1</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">&quot;C0&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvspan</span><span class="s2">(</span><span class="s5">.2</span><span class="s2">, </span><span class="s5">.3</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s4">&quot;C1&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvspan</span><span class="s2">(</span><span class="s5">.4</span><span class="s2">, </span><span class="s5">.5</span><span class="s2">, </span><span class="s5">.1</span><span class="s2">, </span><span class="s5">.2</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s4">&quot;C2&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">&quot;C0&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhspan</span><span class="s2">(</span><span class="s5">.8</span><span class="s2">, </span><span class="s5">.9</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s4">&quot;C1&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhspan</span><span class="s2">(</span><span class="s5">.6</span><span class="s2">, </span><span class="s5">.7</span><span class="s2">, </span><span class="s5">.8</span><span class="s2">, </span><span class="s5">.9</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s4">&quot;C2&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s5">.5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s4">&quot;png&quot;</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s4">&quot;which&quot;</span><span class="s2">, (</span><span class="s4">&quot;x&quot;</span><span class="s2">, </span><span class="s4">&quot;y&quot;</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_axes_clear_behavior</span><span class="s2">(</span><span class="s1">fig_ref</span><span class="s2">, </span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">which</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Test that the given tick params are not reset by ax.clear().&quot;&quot;&quot;</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s3"># the following tick params values are chosen to each create a visual difference</span>
    <span class="s3"># from their defaults</span>
    <span class="s1">target </span><span class="s2">= {</span>
        <span class="s4">&quot;direction&quot;</span><span class="s2">: </span><span class="s4">&quot;in&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;length&quot;</span><span class="s2">: </span><span class="s5">10</span><span class="s2">,</span>
        <span class="s4">&quot;width&quot;</span><span class="s2">: </span><span class="s5">10</span><span class="s2">,</span>
        <span class="s4">&quot;color&quot;</span><span class="s2">: </span><span class="s4">&quot;xkcd:wine red&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;pad&quot;</span><span class="s2">: </span><span class="s5">0</span><span class="s2">,</span>
        <span class="s4">&quot;labelfontfamily&quot;</span><span class="s2">: </span><span class="s4">&quot;serif&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;zorder&quot;</span><span class="s2">: </span><span class="s5">7</span><span class="s2">,</span>
        <span class="s4">&quot;labelrotation&quot;</span><span class="s2">: </span><span class="s5">45</span><span class="s2">,</span>
        <span class="s4">&quot;labelcolor&quot;</span><span class="s2">: </span><span class="s4">&quot;xkcd:shocking pink&quot;</span><span class="s2">,</span>
        <span class="s3"># this overrides color + labelcolor, skip</span>
        <span class="s3"># colors: ,</span>
        <span class="s4">&quot;grid_color&quot;</span><span class="s2">: </span><span class="s4">&quot;xkcd:fluorescent green&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;grid_alpha&quot;</span><span class="s2">: </span><span class="s5">0.5</span><span class="s2">,</span>
        <span class="s4">&quot;grid_linewidth&quot;</span><span class="s2">: </span><span class="s5">3</span><span class="s2">,</span>
        <span class="s4">&quot;grid_linestyle&quot;</span><span class="s2">: </span><span class="s4">&quot;:&quot;</span><span class="s2">,</span>
        <span class="s4">&quot;bottom&quot;</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">&quot;top&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">&quot;left&quot;</span><span class="s2">: </span><span class="s0">False</span><span class="s2">,</span>
        <span class="s4">&quot;right&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">&quot;labelbottom&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">&quot;labeltop&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">&quot;labelleft&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s4">&quot;labelright&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
    <span class="s2">}</span>

    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s1">which</span><span class="s2">, **</span><span class="s1">target</span><span class="s2">)</span>

    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">tick_params</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s1">which</span><span class="s2">, **</span><span class="s1">target</span><span class="s2">)</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">()</span>

    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_boxplot_tick_labels</span><span class="s2">():</span>
    <span class="s3"># Test the renamed `tick_labels` parameter.</span>
    <span class="s3"># Test for deprecation of old name `labels`.</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">19680801</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">((</span><span class="s5">10</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s3"># Should get deprecation warning for `labels`</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s4">'has been renamed </span><span class="s0">\'</span><span class="s4">tick_labels</span><span class="s0">\'</span><span class="s4">'</span><span class="s2">):</span>
        <span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s4">'A'</span><span class="s2">, </span><span class="s4">'B'</span><span class="s2">, </span><span class="s4">'C'</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">get_xticklabels</span><span class="s2">()] == [</span><span class="s4">'A'</span><span class="s2">, </span><span class="s4">'B'</span><span class="s2">, </span><span class="s4">'C'</span><span class="s2">]</span>

    <span class="s3"># Test the new tick_labels parameter</span>
    <span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">tick_labels</span><span class="s2">=[</span><span class="s4">'A'</span><span class="s2">, </span><span class="s4">'B'</span><span class="s2">, </span><span class="s4">'C'</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">l</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">axs</span><span class="s2">[</span><span class="s5">1</span><span class="s2">].</span><span class="s1">get_xticklabels</span><span class="s2">()] == [</span><span class="s4">'A'</span><span class="s2">, </span><span class="s4">'B'</span><span class="s2">, </span><span class="s4">'C'</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">needs_usetex</span>
<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_latex_pie_percent</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>

    <span class="s1">data </span><span class="s2">= [</span><span class="s5">20</span><span class="s2">, </span><span class="s5">10</span><span class="s2">, </span><span class="s5">70</span><span class="s2">]</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">autopct</span><span class="s2">=</span><span class="s4">&quot;%1.0f%%&quot;</span><span class="s2">, </span><span class="s1">textprops</span><span class="s2">={</span><span class="s4">'usetex'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">})</span>

    <span class="s1">ax1 </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">pie</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">autopct</span><span class="s2">=</span><span class="s4">r&quot;%1.0f\%%&quot;</span><span class="s2">, </span><span class="s1">textprops</span><span class="s2">={</span><span class="s4">'usetex'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">})</span>
</pre>
</body>
</html>