<html>
<head>
<title>test_artist.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_artist.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">io</span>
<span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">chain</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>

<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">colors </span><span class="s0">as </span><span class="s1">mcolors</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">lines </span><span class="s0">as </span><span class="s1">mlines</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">path </span><span class="s0">as </span><span class="s1">mpath</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">collections </span><span class="s0">as </span><span class="s1">mcollections</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">artist </span><span class="s0">as </span><span class="s1">martist</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">backend_bases </span><span class="s0">as </span><span class="s1">mbackend_bases</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s2">, </span><span class="s1">image_comparison</span>


<span class="s0">def </span><span class="s1">test_patch_transform_of_none</span><span class="s2">():</span>
    <span class="s3"># tests the behaviour of patches added to an Axes with various transform</span>
    <span class="s3"># specifications</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>

    <span class="s3"># Draw an ellipse over data coord (2, 2) by specifying device coords.</span>
    <span class="s1">xy_data </span><span class="s2">= (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">xy_pix </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">xy_data</span><span class="s2">)</span>

    <span class="s3"># Not providing a transform of None puts the ellipse in data coordinates .</span>
    <span class="s1">e </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span><span class="s1">xy_data</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s5">'yellow'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">e</span><span class="s2">.</span><span class="s1">_transform </span><span class="s2">== </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span>

    <span class="s3"># Providing a transform of None puts the ellipse in device coordinates.</span>
    <span class="s1">e </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span><span class="s1">xy_pix</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s4">120</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s4">120</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s5">'coral'</span><span class="s2">,</span>
                         <span class="s1">transform</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">e</span><span class="s2">.</span><span class="s1">is_transform_set</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">_transform</span><span class="s2">, </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">IdentityTransform</span><span class="s2">)</span>

    <span class="s3"># Providing an IdentityTransform puts the ellipse in device coordinates.</span>
    <span class="s1">e </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span><span class="s1">xy_pix</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s4">100</span><span class="s2">,</span>
                         <span class="s1">transform</span><span class="s2">=</span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">IdentityTransform</span><span class="s2">(), </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">_transform</span><span class="s2">, </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">IdentityTransform</span><span class="s2">)</span>

    <span class="s3"># Not providing a transform, and then subsequently &quot;get_transform&quot; should</span>
    <span class="s3"># not mean that &quot;is_transform_set&quot;.</span>
    <span class="s1">e </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span><span class="s1">xy_pix</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s4">120</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s4">120</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s5">'coral'</span><span class="s2">,</span>
                         <span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s1">intermediate_transform </span><span class="s2">= </span><span class="s1">e</span><span class="s2">.</span><span class="s1">get_transform</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">e</span><span class="s2">.</span><span class="s1">is_transform_set</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">e</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">e</span><span class="s2">.</span><span class="s1">get_transform</span><span class="s2">() != </span><span class="s1">intermediate_transform</span>
    <span class="s0">assert </span><span class="s1">e</span><span class="s2">.</span><span class="s1">is_transform_set</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">e</span><span class="s2">.</span><span class="s1">_transform </span><span class="s2">== </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span>


<span class="s0">def </span><span class="s1">test_collection_transform_of_none</span><span class="s2">():</span>
    <span class="s3"># tests the behaviour of collections added to an Axes with various</span>
    <span class="s3"># transform specifications</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>

    <span class="s3"># draw an ellipse over data coord (2, 2) by specifying device coords</span>
    <span class="s1">xy_data </span><span class="s2">= (</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">xy_pix </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">.</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">xy_data</span><span class="s2">)</span>

    <span class="s3"># not providing a transform of None puts the ellipse in data coordinates</span>
    <span class="s1">e </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span><span class="s1">xy_data</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">PatchCollection</span><span class="s2">([</span><span class="s1">e</span><span class="s2">], </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'yellow'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">c</span><span class="s2">)</span>
    <span class="s3"># the collection should be in data coordinates</span>
    <span class="s0">assert </span><span class="s1">c</span><span class="s2">.</span><span class="s1">get_offset_transform</span><span class="s2">() + </span><span class="s1">c</span><span class="s2">.</span><span class="s1">get_transform</span><span class="s2">() == </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span>

    <span class="s3"># providing a transform of None puts the ellipse in device coordinates</span>
    <span class="s1">e </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span><span class="s1">xy_pix</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s4">120</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s4">120</span><span class="s2">)</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">PatchCollection</span><span class="s2">([</span><span class="s1">e</span><span class="s2">], </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'coral'</span><span class="s2">,</span>
                                     <span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s1">c</span><span class="s2">.</span><span class="s1">set_transform</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">c</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">c</span><span class="s2">.</span><span class="s1">get_transform</span><span class="s2">(), </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">IdentityTransform</span><span class="s2">)</span>

    <span class="s3"># providing an IdentityTransform puts the ellipse in device coordinates</span>
    <span class="s1">e </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span><span class="s1">xy_pix</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">PatchCollection</span><span class="s2">([</span><span class="s1">e</span><span class="s2">],</span>
                                     <span class="s1">transform</span><span class="s2">=</span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">IdentityTransform</span><span class="s2">(),</span>
                                     <span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">c</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">c</span><span class="s2">.</span><span class="s1">get_offset_transform</span><span class="s2">(), </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">IdentityTransform</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">&quot;clip_path_clipping&quot;</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_clipping</span><span class="s2">():</span>
    <span class="s1">exterior </span><span class="s2">= </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">unit_rectangle</span><span class="s2">().</span><span class="s1">deepcopy</span><span class="s2">()</span>
    <span class="s1">exterior</span><span class="s2">.</span><span class="s1">vertices </span><span class="s2">*= </span><span class="s4">4</span>
    <span class="s1">exterior</span><span class="s2">.</span><span class="s1">vertices </span><span class="s2">-= </span><span class="s4">2</span>
    <span class="s1">interior </span><span class="s2">= </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">unit_circle</span><span class="s2">().</span><span class="s1">deepcopy</span><span class="s2">()</span>
    <span class="s1">interior</span><span class="s2">.</span><span class="s1">vertices </span><span class="s2">= </span><span class="s1">interior</span><span class="s2">.</span><span class="s1">vertices</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">]</span>
    <span class="s1">clip_path </span><span class="s2">= </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">make_compound_path</span><span class="s2">(</span><span class="s1">exterior</span><span class="s2">, </span><span class="s1">interior</span><span class="s2">)</span>

    <span class="s1">star </span><span class="s2">= </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">unit_regular_star</span><span class="s2">(</span><span class="s4">6</span><span class="s2">).</span><span class="s1">deepcopy</span><span class="s2">()</span>
    <span class="s1">star</span><span class="s2">.</span><span class="s1">vertices </span><span class="s2">*= </span><span class="s4">2.6</span>

    <span class="s1">fig</span><span class="s2">, (</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">) = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">sharex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">sharey</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">col </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">PathCollection</span><span class="s2">([</span><span class="s1">star</span><span class="s2">], </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">5</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'blue'</span><span class="s2">,</span>
                                      <span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'red'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.7</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s5">'*'</span><span class="s2">)</span>
    <span class="s1">col</span><span class="s2">.</span><span class="s1">set_clip_path</span><span class="s2">(</span><span class="s1">clip_path</span><span class="s2">, </span><span class="s1">ax1</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">)</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">col</span><span class="s2">)</span>

    <span class="s1">patch </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">PathPatch</span><span class="s2">(</span><span class="s1">star</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">5</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'blue'</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'red'</span><span class="s2">,</span>
                               <span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.7</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s5">'*'</span><span class="s2">)</span>
    <span class="s1">patch</span><span class="s2">.</span><span class="s1">set_clip_path</span><span class="s2">(</span><span class="s1">clip_path</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">patch</span><span class="s2">)</span>

    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">([-</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">([-</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s5">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_clipping_zoom</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># This test places the Axes and sets its limits such that the clip path is</span>
    <span class="s3"># outside the figure entirely. This should not break the clip path.</span>
    <span class="s1">ax_test </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">l</span><span class="s2">, = </span><span class="s1">ax_test</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [-</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
    <span class="s3"># Explicit Path instead of a Rectangle uses clip path processing, instead</span>
    <span class="s3"># of a clip box optimization.</span>
    <span class="s1">p </span><span class="s2">= </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]])</span>
    <span class="s1">p </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">PathPatch</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax_test</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">)</span>
    <span class="s1">l</span><span class="s2">.</span><span class="s1">set_clip_path</span><span class="s2">(</span><span class="s1">p</span><span class="s2">)</span>

    <span class="s1">ax_ref </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">add_axes</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([-</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [-</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>

    <span class="s1">ax_ref</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">))</span>
    <span class="s1">ax_test</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.75</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_cull_markers</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s4">20000</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s4">20000</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s5">'k.'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)</span>

    <span class="s1">pdf </span><span class="s2">= </span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">pdf</span><span class="s2">, </span><span class="s1">format</span><span class="s2">=</span><span class="s5">&quot;pdf&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">pdf</span><span class="s2">.</span><span class="s1">getvalue</span><span class="s2">()) &lt; </span><span class="s4">8000</span>

    <span class="s1">svg </span><span class="s2">= </span><span class="s1">io</span><span class="s2">.</span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">savefig</span><span class="s2">(</span><span class="s1">svg</span><span class="s2">, </span><span class="s1">format</span><span class="s2">=</span><span class="s5">&quot;svg&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">svg</span><span class="s2">.</span><span class="s1">getvalue</span><span class="s2">()) &lt; </span><span class="s4">20000</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'hatching'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hatching</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s3"># Default hatch color.</span>
    <span class="s1">rect1 </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s5">'/'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">rect1</span><span class="s2">)</span>

    <span class="s1">rect2 </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">RegularPolyCollection</span><span class="s2">(</span>
        <span class="s4">4</span><span class="s2">, </span><span class="s1">sizes</span><span class="s2">=[</span><span class="s4">16000</span><span class="s2">], </span><span class="s1">offsets</span><span class="s2">=[(</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">6.5</span><span class="s2">)], </span><span class="s1">offset_transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">,</span>
        <span class="s1">hatch</span><span class="s2">=</span><span class="s5">'/'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">rect2</span><span class="s2">)</span>

    <span class="s3"># Ensure edge color is not applied to hatching.</span>
    <span class="s1">rect3 </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s5">'/'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'C1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">rect3</span><span class="s2">)</span>

    <span class="s1">rect4 </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">RegularPolyCollection</span><span class="s2">(</span>
        <span class="s4">4</span><span class="s2">, </span><span class="s1">sizes</span><span class="s2">=[</span><span class="s4">16000</span><span class="s2">], </span><span class="s1">offsets</span><span class="s2">=[(</span><span class="s4">5.5</span><span class="s2">, </span><span class="s4">6.5</span><span class="s2">)], </span><span class="s1">offset_transform</span><span class="s2">=</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">,</span>
        <span class="s1">hatch</span><span class="s2">=</span><span class="s5">'/'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'C1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">rect4</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">7</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">9</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_remove</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">im </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">36</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">6</span><span class="s2">))</span>
    <span class="s1">ln</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">))</span>

    <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stale</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert not </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert not </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">stale</span>

    <span class="s0">assert </span><span class="s1">im </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_mouseover_set</span>
    <span class="s0">assert </span><span class="s1">ln </span><span class="s0">not in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_mouseover_set</span>
    <span class="s0">assert </span><span class="s1">im</span><span class="s2">.</span><span class="s1">axes </span><span class="s0">is </span><span class="s1">ax</span>

    <span class="s1">im</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s1">ln</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>

    <span class="s0">for </span><span class="s1">art </span><span class="s0">in </span><span class="s2">[</span><span class="s1">im</span><span class="s2">, </span><span class="s1">ln</span><span class="s2">]:</span>
        <span class="s0">assert </span><span class="s1">art</span><span class="s2">.</span><span class="s1">axes </span><span class="s0">is None</span>
        <span class="s0">assert </span><span class="s1">art</span><span class="s2">.</span><span class="s1">figure </span><span class="s0">is None</span>

    <span class="s0">assert </span><span class="s1">im </span><span class="s0">not in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">_mouseover_set</span>
    <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">stale</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">stale</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">&quot;default_edges.png&quot;</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_default_edges</span><span class="s2">():</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'text.kerning_factor'</span><span class="s2">] = </span><span class="s4">6</span>

    <span class="s1">fig</span><span class="s2">, [[</span><span class="s1">ax1</span><span class="s2">, </span><span class="s1">ax2</span><span class="s2">], [</span><span class="s1">ax3</span><span class="s2">, </span><span class="s1">ax4</span><span class="s2">]] = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>

    <span class="s1">ax1</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s5">'x'</span><span class="s2">,</span>
             <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">) + </span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s5">'o'</span><span class="s2">)</span>
    <span class="s1">ax2</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">align</span><span class="s2">=</span><span class="s5">'edge'</span><span class="s2">)</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s5">&quot;BOX&quot;</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">24</span><span class="s2">, </span><span class="s1">bbox</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">boxstyle</span><span class="s2">=</span><span class="s5">'sawtooth'</span><span class="s2">))</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">((-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
    <span class="s1">ax3</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
    <span class="s1">pp1 </span><span class="s2">= </span><span class="s1">mpatches</span><span class="s2">.</span><span class="s1">PathPatch</span><span class="s2">(</span>
        <span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">([(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)],</span>
                   <span class="s2">[</span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">MOVETO</span><span class="s2">, </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">CURVE3</span><span class="s2">,</span>
                    <span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">CURVE3</span><span class="s2">, </span><span class="s1">mpath</span><span class="s2">.</span><span class="s1">Path</span><span class="s2">.</span><span class="s1">CLOSEPOLY</span><span class="s2">]),</span>
        <span class="s1">fc</span><span class="s2">=</span><span class="s5">&quot;none&quot;</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">ax4</span><span class="s2">.</span><span class="s1">transData</span><span class="s2">)</span>
    <span class="s1">ax4</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">pp1</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_properties</span><span class="s2">():</span>
    <span class="s1">ln </span><span class="s2">= </span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([], [])</span>
    <span class="s1">ln</span><span class="s2">.</span><span class="s1">properties</span><span class="s2">()  </span><span class="s3"># Check that no warning is emitted.</span>


<span class="s0">def </span><span class="s1">test_setp</span><span class="s2">():</span>
    <span class="s3"># Check empty list</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">setp</span><span class="s2">([])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">setp</span><span class="s2">([[]])</span>

    <span class="s3"># Check arbitrary iterables</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">lines1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">3</span><span class="s2">))</span>
    <span class="s1">lines2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">3</span><span class="s2">))</span>
    <span class="s1">martist</span><span class="s2">.</span><span class="s1">setp</span><span class="s2">(</span><span class="s1">chain</span><span class="s2">(</span><span class="s1">lines1</span><span class="s2">, </span><span class="s1">lines2</span><span class="s2">), </span><span class="s5">'lw'</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">setp</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">spines</span><span class="s2">.</span><span class="s1">values</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'green'</span><span class="s2">)</span>

    <span class="s3"># Check *file* argument</span>
    <span class="s1">sio </span><span class="s2">= </span><span class="s1">io</span><span class="s2">.</span><span class="s1">StringIO</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">setp</span><span class="s2">(</span><span class="s1">lines1</span><span class="s2">, </span><span class="s5">'zorder'</span><span class="s2">, </span><span class="s1">file</span><span class="s2">=</span><span class="s1">sio</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">sio</span><span class="s2">.</span><span class="s1">getvalue</span><span class="s2">() == </span><span class="s5">'  zorder: float</span><span class="s0">\n</span><span class="s5">'</span>


<span class="s0">def </span><span class="s1">test_None_zorder</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ln</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">), </span><span class="s1">zorder</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">get_zorder</span><span class="s2">() == </span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">.</span><span class="s1">zorder</span>
    <span class="s1">ln</span><span class="s2">.</span><span class="s1">set_zorder</span><span class="s2">(</span><span class="s4">123456</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">get_zorder</span><span class="s2">() == </span><span class="s4">123456</span>
    <span class="s1">ln</span><span class="s2">.</span><span class="s1">set_zorder</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ln</span><span class="s2">.</span><span class="s1">get_zorder</span><span class="s2">() == </span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">.</span><span class="s1">zorder</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'accept_clause, expected'</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s5">''</span><span class="s2">, </span><span class="s5">'unknown'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s5">&quot;ACCEPTS: [ '-' | '--' | '-.' ]&quot;</span><span class="s2">, </span><span class="s5">&quot;[ '-' | '--' | '-.' ]&quot;</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s5">'ACCEPTS: Some description.'</span><span class="s2">, </span><span class="s5">'Some description.'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s5">'.. ACCEPTS: Some description.'</span><span class="s2">, </span><span class="s5">'Some description.'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s5">'arg : int'</span><span class="s2">, </span><span class="s5">'int'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s5">'*arg : int'</span><span class="s2">, </span><span class="s5">'int'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s5">'arg : int</span><span class="s0">\n</span><span class="s5">ACCEPTS: Something else.'</span><span class="s2">, </span><span class="s5">'Something else. '</span><span class="s2">),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_artist_inspector_get_valid_values</span><span class="s2">(</span><span class="s1">accept_clause</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s0">class </span><span class="s1">TestArtist</span><span class="s2">(</span><span class="s1">martist</span><span class="s2">.</span><span class="s1">Artist</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">set_f</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">):</span>
            <span class="s0">pass</span>

    <span class="s1">TestArtist</span><span class="s2">.</span><span class="s1">set_f</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s5">&quot;&quot;&quot; 
    Some text. 
 
    %s 
    &quot;&quot;&quot; </span><span class="s2">% </span><span class="s1">accept_clause</span>
    <span class="s1">valid_values </span><span class="s2">= </span><span class="s1">martist</span><span class="s2">.</span><span class="s1">ArtistInspector</span><span class="s2">(</span><span class="s1">TestArtist</span><span class="s2">).</span><span class="s1">get_valid_values</span><span class="s2">(</span><span class="s5">'f'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">valid_values </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_artist_inspector_get_aliases</span><span class="s2">():</span>
    <span class="s3"># test the correct format and type of get_aliases method</span>
    <span class="s1">ai </span><span class="s2">= </span><span class="s1">martist</span><span class="s2">.</span><span class="s1">ArtistInspector</span><span class="s2">(</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">)</span>
    <span class="s1">aliases </span><span class="s2">= </span><span class="s1">ai</span><span class="s2">.</span><span class="s1">get_aliases</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">aliases</span><span class="s2">[</span><span class="s5">&quot;linewidth&quot;</span><span class="s2">] == {</span><span class="s5">&quot;lw&quot;</span><span class="s2">}</span>


<span class="s0">def </span><span class="s1">test_set_alpha</span><span class="s2">():</span>
    <span class="s1">art </span><span class="s2">= </span><span class="s1">martist</span><span class="s2">.</span><span class="s1">Artist</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">'^alpha must be numeric or None'</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">set_alpha</span><span class="s2">(</span><span class="s5">'string'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">'^alpha must be numeric or None'</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">set_alpha</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;outside 0-1 range&quot;</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">set_alpha</span><span class="s2">(</span><span class="s4">1.1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;outside 0-1 range&quot;</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">set_alpha</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_alpha_for_array</span><span class="s2">():</span>
    <span class="s1">art </span><span class="s2">= </span><span class="s1">martist</span><span class="s2">.</span><span class="s1">Artist</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">'^alpha must be numeric or None'</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">_set_alpha_for_array</span><span class="s2">(</span><span class="s5">'string'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;outside 0-1 range&quot;</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">_set_alpha_for_array</span><span class="s2">(</span><span class="s4">1.1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;outside 0-1 range&quot;</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">_set_alpha_for_array</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;alpha must be between 0 and 1&quot;</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">_set_alpha_for_array</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;alpha must be between 0 and 1&quot;</span><span class="s2">):</span>
        <span class="s1">art</span><span class="s2">.</span><span class="s1">_set_alpha_for_array</span><span class="s2">([</span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_callbacks</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">func</span><span class="s2">(</span><span class="s1">artist</span><span class="s2">):</span>
        <span class="s1">func</span><span class="s2">.</span><span class="s1">counter </span><span class="s2">+= </span><span class="s4">1</span>

    <span class="s1">func</span><span class="s2">.</span><span class="s1">counter </span><span class="s2">= </span><span class="s4">0</span>

    <span class="s1">art </span><span class="s2">= </span><span class="s1">martist</span><span class="s2">.</span><span class="s1">Artist</span><span class="s2">()</span>
    <span class="s1">oid </span><span class="s2">= </span><span class="s1">art</span><span class="s2">.</span><span class="s1">add_callback</span><span class="s2">(</span><span class="s1">func</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">func</span><span class="s2">.</span><span class="s1">counter </span><span class="s2">== </span><span class="s4">0</span>
    <span class="s1">art</span><span class="s2">.</span><span class="s1">pchanged</span><span class="s2">()  </span><span class="s3"># must call the callback</span>
    <span class="s0">assert </span><span class="s1">func</span><span class="s2">.</span><span class="s1">counter </span><span class="s2">== </span><span class="s4">1</span>
    <span class="s1">art</span><span class="s2">.</span><span class="s1">set_zorder</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)  </span><span class="s3"># setting a property must also call the callback</span>
    <span class="s0">assert </span><span class="s1">func</span><span class="s2">.</span><span class="s1">counter </span><span class="s2">== </span><span class="s4">2</span>
    <span class="s1">art</span><span class="s2">.</span><span class="s1">remove_callback</span><span class="s2">(</span><span class="s1">oid</span><span class="s2">)</span>
    <span class="s1">art</span><span class="s2">.</span><span class="s1">pchanged</span><span class="s2">()  </span><span class="s3"># must not call the callback anymore</span>
    <span class="s0">assert </span><span class="s1">func</span><span class="s2">.</span><span class="s1">counter </span><span class="s2">== </span><span class="s4">2</span>


<span class="s0">def </span><span class="s1">test_set_signature</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test autogenerated ``set()`` for Artist subclasses.&quot;&quot;&quot;</span>
    <span class="s0">class </span><span class="s1">MyArtist1</span><span class="s2">(</span><span class="s1">martist</span><span class="s2">.</span><span class="s1">Artist</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">set_myparam1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">val</span><span class="s2">):</span>
            <span class="s0">pass</span>

    <span class="s0">assert </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">MyArtist1</span><span class="s2">.</span><span class="s1">set</span><span class="s2">, </span><span class="s5">'_autogenerated_signature'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s5">'myparam1' </span><span class="s0">in </span><span class="s1">MyArtist1</span><span class="s2">.</span><span class="s1">set</span><span class="s2">.</span><span class="s1">__doc__</span>

    <span class="s0">class </span><span class="s1">MyArtist2</span><span class="s2">(</span><span class="s1">MyArtist1</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">set_myparam2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">val</span><span class="s2">):</span>
            <span class="s0">pass</span>

    <span class="s0">assert </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">MyArtist2</span><span class="s2">.</span><span class="s1">set</span><span class="s2">, </span><span class="s5">'_autogenerated_signature'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s5">'myparam1' </span><span class="s0">in </span><span class="s1">MyArtist2</span><span class="s2">.</span><span class="s1">set</span><span class="s2">.</span><span class="s1">__doc__</span>
    <span class="s0">assert </span><span class="s5">'myparam2' </span><span class="s0">in </span><span class="s1">MyArtist2</span><span class="s2">.</span><span class="s1">set</span><span class="s2">.</span><span class="s1">__doc__</span>


<span class="s0">def </span><span class="s1">test_set_is_overwritten</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;set() defined in Artist subclasses should not be overwritten.&quot;&quot;&quot;</span>
    <span class="s0">class </span><span class="s1">MyArtist3</span><span class="s2">(</span><span class="s1">martist</span><span class="s2">.</span><span class="s1">Artist</span><span class="s2">):</span>

        <span class="s0">def </span><span class="s1">set</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
            <span class="s6">&quot;&quot;&quot;Not overwritten.&quot;&quot;&quot;</span>

    <span class="s0">assert not </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">MyArtist3</span><span class="s2">.</span><span class="s1">set</span><span class="s2">, </span><span class="s5">'_autogenerated_signature'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">MyArtist3</span><span class="s2">.</span><span class="s1">set</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">== </span><span class="s5">&quot;Not overwritten.&quot;</span>

    <span class="s0">class </span><span class="s1">MyArtist4</span><span class="s2">(</span><span class="s1">MyArtist3</span><span class="s2">):</span>
        <span class="s0">pass</span>

    <span class="s0">assert </span><span class="s1">MyArtist4</span><span class="s2">.</span><span class="s1">set </span><span class="s0">is </span><span class="s1">MyArtist3</span><span class="s2">.</span><span class="s1">set</span>


<span class="s0">def </span><span class="s1">test_format_cursor_data_BoundaryNorm</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test if cursor data is correct when using BoundaryNorm.&quot;&quot;&quot;</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">3</span><span class="s2">, </span><span class="s4">3</span><span class="s2">))</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] = </span><span class="s4">0.9</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s4">0.99</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">] = </span><span class="s4">0.999</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] = -</span><span class="s4">1</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s4">0</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">] = </span><span class="s4">1</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] = </span><span class="s4">0.09</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s4">0.009</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">] = </span><span class="s4">0.0009</span>

    <span class="s3"># map range -1..1 to 0..256 in 0.1 steps</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s5">&quot;-1..1 to 0..256 in 0.1&quot;</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">), </span><span class="s4">256</span><span class="s2">)</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>

    <span class="s1">labels_list </span><span class="s2">= [</span>
        <span class="s5">&quot;[0.9]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[1.]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[1.]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[-1.0]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.0]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[1.0]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.09]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.009]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.0009]&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">labels_list</span><span class="s2">):</span>
        <span class="s3"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.1))</span>
        <span class="s0">assert </span><span class="s1">img</span><span class="s2">.</span><span class="s1">format_cursor_data</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) == </span><span class="s1">label</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># map range -1..1 to 0..256 in 0.01 steps</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s5">&quot;-1..1 to 0..256 in 0.01&quot;</span><span class="s2">)</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">'RdBu_r'</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s4">200</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">200</span><span class="s2">), </span><span class="s4">200</span><span class="s2">)</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>

    <span class="s1">labels_list </span><span class="s2">= [</span>
        <span class="s5">&quot;[0.90]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.99]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[1.0]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[-1.00]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.00]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[1.00]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.09]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.009]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.0009]&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">labels_list</span><span class="s2">):</span>
        <span class="s3"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.01))</span>
        <span class="s0">assert </span><span class="s1">img</span><span class="s2">.</span><span class="s1">format_cursor_data</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) == </span><span class="s1">label</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># map range -1..1 to 0..256 in 0.01 steps</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s5">&quot;-1..1 to 0..256 in 0.001&quot;</span><span class="s2">)</span>
    <span class="s1">cmap </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colormaps</span><span class="s2">[</span><span class="s5">'RdBu_r'</span><span class="s2">].</span><span class="s1">resampled</span><span class="s2">(</span><span class="s4">2000</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2000</span><span class="s2">), </span><span class="s4">2000</span><span class="s2">)</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">cmap</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>

    <span class="s1">labels_list </span><span class="s2">= [</span>
        <span class="s5">&quot;[0.900]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.990]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.999]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[-1.000]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.000]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[1.000]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.090]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.009]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.0009]&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">labels_list</span><span class="s2">):</span>
        <span class="s3"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.001))</span>
        <span class="s0">assert </span><span class="s1">img</span><span class="s2">.</span><span class="s1">format_cursor_data</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) == </span><span class="s1">label</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s3"># different testing data set with</span>
    <span class="s3"># out of bounds values for 0..1 range</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s4">7</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] = -</span><span class="s4">1.0</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] = </span><span class="s4">0.0</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">2</span><span class="s2">] = </span><span class="s4">0.1</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] = </span><span class="s4">0.5</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">4</span><span class="s2">] = </span><span class="s4">0.9</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">5</span><span class="s2">] = </span><span class="s4">1.0</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s4">6</span><span class="s2">] = </span><span class="s4">2.0</span>

    <span class="s1">labels_list </span><span class="s2">= [</span>
        <span class="s5">&quot;[-1.0]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.0]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.1]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.5]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[0.9]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[1.0]&quot;</span><span class="s2">,</span>
        <span class="s5">&quot;[2.0]&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s5">&quot;noclip, neither&quot;</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s4">256</span><span class="s2">, </span><span class="s1">clip</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'neither'</span><span class="s2">)</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">labels_list</span><span class="s2">):</span>
        <span class="s3"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img</span><span class="s2">.</span><span class="s1">format_cursor_data</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) == </span><span class="s1">label</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s5">&quot;noclip, min&quot;</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s4">256</span><span class="s2">, </span><span class="s1">clip</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'min'</span><span class="s2">)</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">labels_list</span><span class="s2">):</span>
        <span class="s3"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img</span><span class="s2">.</span><span class="s1">format_cursor_data</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) == </span><span class="s1">label</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s5">&quot;noclip, max&quot;</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s4">256</span><span class="s2">, </span><span class="s1">clip</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'max'</span><span class="s2">)</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">labels_list</span><span class="s2">):</span>
        <span class="s3"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img</span><span class="s2">.</span><span class="s1">format_cursor_data</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) == </span><span class="s1">label</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s5">&quot;noclip, both&quot;</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s4">256</span><span class="s2">, </span><span class="s1">clip</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'both'</span><span class="s2">)</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">labels_list</span><span class="s2">):</span>
        <span class="s3"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img</span><span class="s2">.</span><span class="s1">format_cursor_data</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) == </span><span class="s1">label</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">suptitle</span><span class="s2">(</span><span class="s5">&quot;clip, neither&quot;</span><span class="s2">)</span>
    <span class="s1">norm </span><span class="s2">= </span><span class="s1">mcolors</span><span class="s2">.</span><span class="s1">BoundaryNorm</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s1">endpoint</span><span class="s2">=</span><span class="s0">True</span><span class="s2">), </span><span class="s4">256</span><span class="s2">, </span><span class="s1">clip</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">extend</span><span class="s2">=</span><span class="s5">'neither'</span><span class="s2">)</span>
    <span class="s1">img </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">imshow</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s5">'RdBu_r'</span><span class="s2">, </span><span class="s1">norm</span><span class="s2">=</span><span class="s1">norm</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">v</span><span class="s2">, </span><span class="s1">label </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, </span><span class="s1">labels_list</span><span class="s2">):</span>
        <span class="s3"># label = &quot;[{:-#.{}g}]&quot;.format(v, cbook._g_sig_digits(v, 0.33))</span>
        <span class="s0">assert </span><span class="s1">img</span><span class="s2">.</span><span class="s1">format_cursor_data</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) == </span><span class="s1">label</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_auto_no_rasterize</span><span class="s2">():</span>
    <span class="s0">class </span><span class="s1">Gen1</span><span class="s2">(</span><span class="s1">martist</span><span class="s2">.</span><span class="s1">Artist</span><span class="s2">):</span>
        <span class="s2">...</span>

    <span class="s0">assert </span><span class="s5">'draw' </span><span class="s0">in </span><span class="s1">Gen1</span><span class="s2">.</span><span class="s1">__dict__</span>
    <span class="s0">assert </span><span class="s1">Gen1</span><span class="s2">.</span><span class="s1">__dict__</span><span class="s2">[</span><span class="s5">'draw'</span><span class="s2">] </span><span class="s0">is </span><span class="s1">Gen1</span><span class="s2">.</span><span class="s1">draw</span>

    <span class="s0">class </span><span class="s1">Gen2</span><span class="s2">(</span><span class="s1">Gen1</span><span class="s2">):</span>
        <span class="s2">...</span>

    <span class="s0">assert </span><span class="s5">'draw' </span><span class="s0">not in </span><span class="s1">Gen2</span><span class="s2">.</span><span class="s1">__dict__</span>
    <span class="s0">assert </span><span class="s1">Gen2</span><span class="s2">.</span><span class="s1">draw </span><span class="s0">is </span><span class="s1">Gen1</span><span class="s2">.</span><span class="s1">draw</span>


<span class="s0">def </span><span class="s1">test_draw_wraper_forward_input</span><span class="s2">():</span>
    <span class="s0">class </span><span class="s1">TestKlass</span><span class="s2">(</span><span class="s1">martist</span><span class="s2">.</span><span class="s1">Artist</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">draw</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">renderer</span><span class="s2">, </span><span class="s1">extra</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">extra</span>

    <span class="s1">art </span><span class="s2">= </span><span class="s1">TestKlass</span><span class="s2">()</span>
    <span class="s1">renderer </span><span class="s2">= </span><span class="s1">mbackend_bases</span><span class="s2">.</span><span class="s1">RendererBase</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s5">'aardvark' </span><span class="s2">== </span><span class="s1">art</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">, </span><span class="s5">'aardvark'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s5">'aardvark' </span><span class="s2">== </span><span class="s1">art</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">(</span><span class="s1">renderer</span><span class="s2">, </span><span class="s1">extra</span><span class="s2">=</span><span class="s5">'aardvark'</span><span class="s2">)</span>
</pre>
</body>
</html>