<html>
<head>
<title>test_svmlight_format.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
.s7 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_svmlight_format.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">gzip</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">shutil</span>
<span class="s0">from </span><span class="s1">bz2 </span><span class="s0">import </span><span class="s1">BZ2File</span>
<span class="s0">from </span><span class="s1">importlib </span><span class="s0">import </span><span class="s1">resources</span>
<span class="s0">from </span><span class="s1">io </span><span class="s0">import </span><span class="s1">BytesIO</span>
<span class="s0">from </span><span class="s1">tempfile </span><span class="s0">import </span><span class="s1">NamedTemporaryFile</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">sparse </span><span class="s0">as </span><span class="s1">sp</span>

<span class="s0">import </span><span class="s1">sklearn</span>
<span class="s0">from </span><span class="s1">sklearn</span><span class="s2">.</span><span class="s1">datasets </span><span class="s0">import </span><span class="s1">dump_svmlight_file</span><span class="s2">, </span><span class="s1">load_svmlight_file</span><span class="s2">, </span><span class="s1">load_svmlight_files</span>
<span class="s0">from </span><span class="s1">sklearn</span><span class="s2">.</span><span class="s1">utils</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">assert_allclose</span><span class="s2">,</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">,</span>
    <span class="s1">assert_array_equal</span><span class="s2">,</span>
    <span class="s1">create_memmap_backed_data</span><span class="s2">,</span>
    <span class="s1">fails_if_pypy</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">sklearn</span><span class="s2">.</span><span class="s1">utils</span><span class="s2">.</span><span class="s1">fixes </span><span class="s0">import </span><span class="s1">CSR_CONTAINERS</span>

<span class="s1">TEST_DATA_MODULE </span><span class="s2">= </span><span class="s3">&quot;sklearn.datasets.tests.data&quot;</span>
<span class="s1">datafile </span><span class="s2">= </span><span class="s3">&quot;svmlight_classification.txt&quot;</span>
<span class="s1">multifile </span><span class="s2">= </span><span class="s3">&quot;svmlight_multilabel.txt&quot;</span>
<span class="s1">invalidfile </span><span class="s2">= </span><span class="s3">&quot;svmlight_invalid.txt&quot;</span>
<span class="s1">invalidfile2 </span><span class="s2">= </span><span class="s3">&quot;svmlight_invalid_order.txt&quot;</span>

<span class="s1">pytestmark </span><span class="s2">= </span><span class="s1">fails_if_pypy</span>


<span class="s0">def </span><span class="s1">_svmlight_local_test_file_path</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">resources</span><span class="s2">.</span><span class="s1">files</span><span class="s2">(</span><span class="s1">TEST_DATA_MODULE</span><span class="s2">) / </span><span class="s1">filename</span>


<span class="s0">def </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Helper to load resource `filename` with `importlib.resources` 
    &quot;&quot;&quot;</span>
    <span class="s1">data_path </span><span class="s2">= </span><span class="s1">_svmlight_local_test_file_path</span><span class="s2">(</span><span class="s1">filename</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">data_path</span><span class="s2">.</span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_svmlight_file</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>

    <span class="s5"># test X's shape</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">.</span><span class="s1">indptr</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s6">7</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s6">6</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">1</span><span class="s2">] == </span><span class="s6">21</span>
    <span class="s0">assert </span><span class="s1">y</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s6">6</span>

    <span class="s5"># test X's non-zero values</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">val </span><span class="s0">in </span><span class="s2">(</span>
        <span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">2.5</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, -</span><span class="s6">5.2</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">15</span><span class="s2">, </span><span class="s6">1.5</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, -</span><span class="s6">3</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s6">20</span><span class="s2">, </span><span class="s6">27</span><span class="s2">),</span>
    <span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">X</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">] == </span><span class="s1">val</span>

    <span class="s5"># tests X's zero values</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">3</span><span class="s2">] == </span><span class="s6">0</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">5</span><span class="s2">] == </span><span class="s6">0</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">8</span><span class="s2">] == </span><span class="s6">0</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">16</span><span class="s2">] == </span><span class="s6">0</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">18</span><span class="s2">] == </span><span class="s6">0</span>

    <span class="s5"># test can change X's values</span>
    <span class="s1">X</span><span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">] *= </span><span class="s6">2</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">] == </span><span class="s6">5</span>

    <span class="s5"># test y</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_load_svmlight_file_fd</span><span class="s2">():</span>
    <span class="s5"># test loading from file descriptor</span>

    <span class="s5"># GH20081: testing equality between path-based and</span>
    <span class="s5"># fd-based load_svmlight_file</span>

    <span class="s1">data_path </span><span class="s2">= </span><span class="s1">resources</span><span class="s2">.</span><span class="s1">files</span><span class="s2">(</span><span class="s1">TEST_DATA_MODULE</span><span class="s2">) / </span><span class="s1">datafile</span>
    <span class="s1">data_path </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">)</span>
    <span class="s1">X1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">)</span>

    <span class="s1">fd </span><span class="s2">= </span><span class="s1">os</span><span class="s2">.</span><span class="s1">open</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">, </span><span class="s1">os</span><span class="s2">.</span><span class="s1">O_RDONLY</span><span class="s2">)</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">X2</span><span class="s2">, </span><span class="s1">y2 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">fd</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X1</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">)</span>
    <span class="s0">finally</span><span class="s2">:</span>
        <span class="s1">os</span><span class="s2">.</span><span class="s1">close</span><span class="s2">(</span><span class="s1">fd</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_svmlight_pathlib</span><span class="s2">():</span>
    <span class="s5"># test loading from file descriptor</span>
    <span class="s1">data_path </span><span class="s2">= </span><span class="s1">_svmlight_local_test_file_path</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>
    <span class="s1">X1</span><span class="s2">, </span><span class="s1">y1 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">))</span>
    <span class="s1">X2</span><span class="s2">, </span><span class="s1">y2 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">)</span>

    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">X1</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_svmlight_file_multilabel</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">multifile</span><span class="s2">, </span><span class="s1">multilabel</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">y </span><span class="s2">== [(</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">), (</span><span class="s6">2</span><span class="s2">,), (), (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)]</span>


<span class="s0">def </span><span class="s1">test_load_svmlight_files</span><span class="s2">():</span>
    <span class="s1">data_path </span><span class="s2">= </span><span class="s1">_svmlight_local_test_file_path</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>
    <span class="s1">X_train</span><span class="s2">, </span><span class="s1">y_train</span><span class="s2">, </span><span class="s1">X_test</span><span class="s2">, </span><span class="s1">y_test </span><span class="s2">= </span><span class="s1">load_svmlight_files</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s1">str</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">)] * </span><span class="s6">2</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
    <span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">X_train</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">X_test</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y_train</span><span class="s2">, </span><span class="s1">y_test</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">X_train</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>
    <span class="s0">assert </span><span class="s1">X_test</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span>

    <span class="s1">X1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">X3</span><span class="s2">, </span><span class="s1">y3 </span><span class="s2">= </span><span class="s1">load_svmlight_files</span><span class="s2">([</span><span class="s1">str</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">)] * </span><span class="s6">3</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">X1</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">dtype</span>
    <span class="s0">assert </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">X3</span><span class="s2">.</span><span class="s1">dtype</span>
    <span class="s0">assert </span><span class="s1">X3</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>


<span class="s0">def </span><span class="s1">test_load_svmlight_file_n_features</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">=</span><span class="s6">22</span><span class="s2">)</span>

    <span class="s5"># test X'shape</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">.</span><span class="s1">indptr</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s6">7</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s6">6</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">1</span><span class="s2">] == </span><span class="s6">22</span>

    <span class="s5"># test X's non-zero values</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">val </span><span class="s0">in </span><span class="s2">((</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">2.5</span><span class="s2">), (</span><span class="s6">0</span><span class="s2">, </span><span class="s6">10</span><span class="s2">, -</span><span class="s6">5.2</span><span class="s2">), (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">), (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, -</span><span class="s6">3</span><span class="s2">)):</span>
        <span class="s0">assert </span><span class="s1">X</span><span class="s2">[</span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">] == </span><span class="s1">val</span>

    <span class="s5"># 21 features in file</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">=</span><span class="s6">20</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_compressed</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">NamedTemporaryFile</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">=</span><span class="s3">&quot;sklearn-test&quot;</span><span class="s2">, </span><span class="s1">suffix</span><span class="s2">=</span><span class="s3">&quot;.gz&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">tmp</span><span class="s2">:</span>
        <span class="s1">tmp</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()  </span><span class="s5"># necessary under windows</span>
        <span class="s0">with </span><span class="s1">_svmlight_local_test_file_path</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">).</span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">gzip</span><span class="s2">.</span><span class="s1">open</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s3">&quot;wb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">fh_out</span><span class="s2">:</span>
                <span class="s1">shutil</span><span class="s2">.</span><span class="s1">copyfileobj</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">fh_out</span><span class="s2">)</span>
        <span class="s1">Xgz</span><span class="s2">, </span><span class="s1">ygz </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s5"># because we &quot;close&quot; it manually and write to it,</span>
        <span class="s5"># we need to remove it manually.</span>
        <span class="s1">os</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">Xgz</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">ygz</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">NamedTemporaryFile</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">=</span><span class="s3">&quot;sklearn-test&quot;</span><span class="s2">, </span><span class="s1">suffix</span><span class="s2">=</span><span class="s3">&quot;.bz2&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">tmp</span><span class="s2">:</span>
        <span class="s1">tmp</span><span class="s2">.</span><span class="s1">close</span><span class="s2">()  </span><span class="s5"># necessary under windows</span>
        <span class="s0">with </span><span class="s1">_svmlight_local_test_file_path</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">).</span><span class="s1">open</span><span class="s2">(</span><span class="s3">&quot;rb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s0">with </span><span class="s1">BZ2File</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">name</span><span class="s2">, </span><span class="s3">&quot;wb&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">fh_out</span><span class="s2">:</span>
                <span class="s1">shutil</span><span class="s2">.</span><span class="s1">copyfileobj</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">fh_out</span><span class="s2">)</span>
        <span class="s1">Xbz</span><span class="s2">, </span><span class="s1">ybz </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
        <span class="s5"># because we &quot;close&quot; it manually and write to it,</span>
        <span class="s5"># we need to remove it manually.</span>
        <span class="s1">os</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">Xbz</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">ybz</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_invalid_file</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">invalidfile</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_invalid_order_file</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">invalidfile2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_zero_based</span><span class="s2">():</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s7">b&quot;-1 4:1.</span><span class="s0">\n</span><span class="s7">1 0:1</span><span class="s0">\n</span><span class="s7">&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_zero_based_auto</span><span class="s2">():</span>
    <span class="s1">data1 </span><span class="s2">= </span><span class="s7">b&quot;-1 1:1 2:2 3:3</span><span class="s0">\n</span><span class="s7">&quot;</span>
    <span class="s1">data2 </span><span class="s2">= </span><span class="s7">b&quot;-1 0:0 1:1</span><span class="s0">\n</span><span class="s7">&quot;</span>

    <span class="s1">f1 </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data1</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f1</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s3">&quot;auto&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">3</span><span class="s2">)</span>

    <span class="s1">f1 </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data1</span><span class="s2">)</span>
    <span class="s1">f2 </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data2</span><span class="s2">)</span>
    <span class="s1">X1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">y2 </span><span class="s2">= </span><span class="s1">load_svmlight_files</span><span class="s2">([</span><span class="s1">f1</span><span class="s2">, </span><span class="s1">f2</span><span class="s2">], </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s3">&quot;auto&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">X1</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">4</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s6">1</span><span class="s2">, </span><span class="s6">4</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_with_qid</span><span class="s2">():</span>
    <span class="s5"># load svmfile with qid attribute</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s7">b&quot;&quot;&quot; 
    3 qid:1 1:0.53 2:0.12 
    2 qid:1 1:0.13 2:0.1 
    7 qid:2 1:0.87 2:0.12&quot;&quot;&quot;</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">7</span><span class="s2">])</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), [[</span><span class="s6">0.53</span><span class="s2">, </span><span class="s6">0.12</span><span class="s2">], [</span><span class="s6">0.13</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">], [</span><span class="s6">0.87</span><span class="s2">, </span><span class="s6">0.12</span><span class="s2">]])</span>
    <span class="s1">res1 </span><span class="s2">= </span><span class="s1">load_svmlight_files</span><span class="s2">([</span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)], </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">res2 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">qid </span><span class="s0">in </span><span class="s2">(</span><span class="s1">res1</span><span class="s2">, </span><span class="s1">res2</span><span class="s2">):</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">7</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">qid</span><span class="s2">, [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">])</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), [[</span><span class="s6">0.53</span><span class="s2">, </span><span class="s6">0.12</span><span class="s2">], [</span><span class="s6">0.13</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">], [</span><span class="s6">0.87</span><span class="s2">, </span><span class="s6">0.12</span><span class="s2">]])</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span>
    <span class="s3">&quot;testing the overflow of 32 bit sparse indexing requires a large amount of memory&quot;</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_load_large_qid</span><span class="s2">():</span>
    <span class="s4">&quot;&quot;&quot; 
    load large libsvm / svmlight file with qid attribute. Tests 64-bit query ID 
    &quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s7">b&quot;</span><span class="s0">\n</span><span class="s7">&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
        <span class="s2">(</span>
            <span class="s3">&quot;3 qid:{0} 1:0.53 2:0.12</span><span class="s0">\n</span><span class="s3">2 qid:{0} 1:0.13 2:0.1&quot;</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">i</span><span class="s2">).</span><span class="s1">encode</span><span class="s2">()</span>
            <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">40 </span><span class="s2">* </span><span class="s6">1000 </span><span class="s2">* </span><span class="s6">1000</span><span class="s2">)</span>
        <span class="s2">)</span>
    <span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">qid </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">[-</span><span class="s6">4</span><span class="s2">:], [</span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">2</span><span class="s2">])</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">unique</span><span class="s2">(</span><span class="s1">qid</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s6">40 </span><span class="s2">* </span><span class="s6">1000 </span><span class="s2">* </span><span class="s6">1000</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_load_invalid_file2</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">data_path </span><span class="s2">= </span><span class="s1">_svmlight_local_test_file_path</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>
        <span class="s1">invalid_path </span><span class="s2">= </span><span class="s1">_svmlight_local_test_file_path</span><span class="s2">(</span><span class="s1">invalidfile</span><span class="s2">)</span>
        <span class="s1">load_svmlight_files</span><span class="s2">([</span><span class="s1">str</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">), </span><span class="s1">str</span><span class="s2">(</span><span class="s1">invalid_path</span><span class="s2">), </span><span class="s1">str</span><span class="s2">(</span><span class="s1">data_path</span><span class="s2">)])</span>


<span class="s0">def </span><span class="s1">test_not_a_filename</span><span class="s2">():</span>
    <span class="s5"># in python 3 integers are valid file opening arguments (taken as unix</span>
    <span class="s5"># file descriptors)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">):</span>
        <span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s6">0.42</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_invalid_filename</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">OSError</span><span class="s2">):</span>
        <span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s3">&quot;trou pic nic douille&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;csr_container&quot;</span><span class="s2">, </span><span class="s1">CSR_CONTAINERS</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_dump</span><span class="s2">(</span><span class="s1">csr_container</span><span class="s2">):</span>
    <span class="s1">X_sparse</span><span class="s2">, </span><span class="s1">y_dense </span><span class="s2">= </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>
    <span class="s1">X_dense </span><span class="s2">= </span><span class="s1">X_sparse</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">()</span>
    <span class="s1">y_sparse </span><span class="s2">= </span><span class="s1">csr_container</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">atleast_2d</span><span class="s2">(</span><span class="s1">y_dense</span><span class="s2">))</span>

    <span class="s5"># slicing a csr_matrix can unsort its .indices, so test that we sort</span>
    <span class="s5"># those correctly</span>
    <span class="s1">X_sliced </span><span class="s2">= </span><span class="s1">X_sparse</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">X_sparse</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])]</span>
    <span class="s1">y_sliced </span><span class="s2">= </span><span class="s1">y_sparse</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">y_sparse</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])]</span>

    <span class="s0">for </span><span class="s1">X </span><span class="s0">in </span><span class="s2">(</span><span class="s1">X_sparse</span><span class="s2">, </span><span class="s1">X_dense</span><span class="s2">, </span><span class="s1">X_sliced</span><span class="s2">):</span>
        <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s2">(</span><span class="s1">y_sparse</span><span class="s2">, </span><span class="s1">y_dense</span><span class="s2">, </span><span class="s1">y_sliced</span><span class="s2">):</span>
            <span class="s0">for </span><span class="s1">zero_based </span><span class="s0">in </span><span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
                <span class="s0">for </span><span class="s1">dtype </span><span class="s0">in </span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">]:</span>
                    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
                    <span class="s5"># we need to pass a comment to get the version info in;</span>
                    <span class="s5"># LibSVM doesn't grok comments so they're not put in by</span>
                    <span class="s5"># default anymore.</span>

                    <span class="s0">if </span><span class="s1">sp</span><span class="s2">.</span><span class="s1">issparse</span><span class="s2">(</span><span class="s1">y</span><span class="s2">) </span><span class="s0">and </span><span class="s1">y</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s6">1</span><span class="s2">:</span>
                        <span class="s5"># make sure y's shape is: (n_samples, n_labels)</span>
                        <span class="s5"># when it is sparse</span>
                        <span class="s1">y </span><span class="s2">= </span><span class="s1">y</span><span class="s2">.</span><span class="s1">T</span>

                    <span class="s5"># Note: with dtype=np.int32 we are performing unsafe casts,</span>
                    <span class="s5"># where X.astype(dtype) overflows. The result is</span>
                    <span class="s5"># then platform dependent and X_dense.astype(dtype) may be</span>
                    <span class="s5"># different from X_sparse.astype(dtype).asarray().</span>
                    <span class="s1">X_input </span><span class="s2">= </span><span class="s1">X</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">)</span>

                    <span class="s1">dump_svmlight_file</span><span class="s2">(</span>
                        <span class="s1">X_input</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">=</span><span class="s3">&quot;test&quot;</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s1">zero_based</span>
                    <span class="s2">)</span>
                    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>

                    <span class="s1">comment </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">()</span>
                    <span class="s1">comment </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">comment</span><span class="s2">, </span><span class="s3">&quot;utf-8&quot;</span><span class="s2">)</span>

                    <span class="s0">assert </span><span class="s3">&quot;scikit-learn %s&quot; </span><span class="s2">% </span><span class="s1">sklearn</span><span class="s2">.</span><span class="s1">__version__ </span><span class="s0">in </span><span class="s1">comment</span>

                    <span class="s1">comment </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">()</span>
                    <span class="s1">comment </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">comment</span><span class="s2">, </span><span class="s3">&quot;utf-8&quot;</span><span class="s2">)</span>

                    <span class="s0">assert </span><span class="s2">[</span><span class="s3">&quot;one&quot;</span><span class="s2">, </span><span class="s3">&quot;zero&quot;</span><span class="s2">][</span><span class="s1">zero_based</span><span class="s2">] + </span><span class="s3">&quot;-based&quot; </span><span class="s0">in </span><span class="s1">comment</span>

                    <span class="s1">X2</span><span class="s2">, </span><span class="s1">y2 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s1">zero_based</span><span class="s2">)</span>
                    <span class="s0">assert </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">dtype</span>
                    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">X2</span><span class="s2">.</span><span class="s1">sorted_indices</span><span class="s2">().</span><span class="s1">indices</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">indices</span><span class="s2">)</span>

                    <span class="s1">X2_dense </span><span class="s2">= </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">()</span>
                    <span class="s0">if </span><span class="s1">sp</span><span class="s2">.</span><span class="s1">issparse</span><span class="s2">(</span><span class="s1">X_input</span><span class="s2">):</span>
                        <span class="s1">X_input_dense </span><span class="s2">= </span><span class="s1">X_input</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">()</span>
                    <span class="s0">else</span><span class="s2">:</span>
                        <span class="s1">X_input_dense </span><span class="s2">= </span><span class="s1">X_input</span>

                    <span class="s0">if </span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">:</span>
                        <span class="s5"># allow a rounding error at the last decimal place</span>
                        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X_input_dense</span><span class="s2">, </span><span class="s1">X2_dense</span><span class="s2">, </span><span class="s6">4</span><span class="s2">)</span>
                        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span>
                            <span class="s1">y_dense</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">), </span><span class="s1">y2</span><span class="s2">, </span><span class="s6">4</span>
                        <span class="s2">)</span>
                    <span class="s0">else</span><span class="s2">:</span>
                        <span class="s5"># allow a rounding error at the last decimal place</span>
                        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X_input_dense</span><span class="s2">, </span><span class="s1">X2_dense</span><span class="s2">, </span><span class="s6">15</span><span class="s2">)</span>
                        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span>
                            <span class="s1">y_dense</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">copy</span><span class="s2">=</span><span class="s0">False</span><span class="s2">), </span><span class="s1">y2</span><span class="s2">, </span><span class="s6">15</span>
                        <span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;csr_container&quot;</span><span class="s2">, </span><span class="s1">CSR_CONTAINERS</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_dump_multilabel</span><span class="s2">(</span><span class="s1">csr_container</span><span class="s2">):</span>
    <span class="s1">X </span><span class="s2">= [[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">5</span><span class="s2">], [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">]]</span>
    <span class="s1">y_dense </span><span class="s2">= [[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">], [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">]]</span>
    <span class="s1">y_sparse </span><span class="s2">= </span><span class="s1">csr_container</span><span class="s2">(</span><span class="s1">y_dense</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s2">[</span><span class="s1">y_dense</span><span class="s2">, </span><span class="s1">y_sparse</span><span class="s2">]:</span>
        <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
        <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">multilabel</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s5"># make sure it dumps multilabel correctly</span>
        <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">() == </span><span class="s7">b&quot;1 0:1 2:3 4:5</span><span class="s0">\n</span><span class="s7">&quot;</span>
        <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">() == </span><span class="s7">b&quot;0,2 </span><span class="s0">\n</span><span class="s7">&quot;</span>
        <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">() == </span><span class="s7">b&quot;0,1 1:5 3:1</span><span class="s0">\n</span><span class="s7">&quot;</span>


<span class="s0">def </span><span class="s1">test_dump_concise</span><span class="s2">():</span>
    <span class="s1">one </span><span class="s2">= </span><span class="s6">1</span>
    <span class="s1">two </span><span class="s2">= </span><span class="s6">2.1</span>
    <span class="s1">three </span><span class="s2">= </span><span class="s6">3.01</span>
    <span class="s1">exact </span><span class="s2">= </span><span class="s6">1.000000000000001</span>
    <span class="s5"># loses the last decimal place</span>
    <span class="s1">almost </span><span class="s2">= </span><span class="s6">1.0000000000000001</span>
    <span class="s1">X </span><span class="s2">= [</span>
        <span class="s2">[</span><span class="s1">one</span><span class="s2">, </span><span class="s1">two</span><span class="s2">, </span><span class="s1">three</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">, </span><span class="s1">almost</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s6">1e9</span><span class="s2">, </span><span class="s6">2e18</span><span class="s2">, </span><span class="s6">3e27</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
    <span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s1">one</span><span class="s2">, </span><span class="s1">two</span><span class="s2">, </span><span class="s1">three</span><span class="s2">, </span><span class="s1">exact</span><span class="s2">, </span><span class="s1">almost</span><span class="s2">]</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">)</span>
    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s5"># make sure it's using the most concise format possible</span>
    <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">() == </span><span class="s7">b&quot;1 0:1 1:2.1 2:3.01 3:1.000000000000001 4:1</span><span class="s0">\n</span><span class="s7">&quot;</span>
    <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">() == </span><span class="s7">b&quot;2.1 0:1000000000 1:2e+18 2:3e+27</span><span class="s0">\n</span><span class="s7">&quot;</span>
    <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">() == </span><span class="s7">b&quot;3.01 </span><span class="s0">\n</span><span class="s7">&quot;</span>
    <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">() == </span><span class="s7">b&quot;1.000000000000001 </span><span class="s0">\n</span><span class="s7">&quot;</span>
    <span class="s0">assert </span><span class="s1">f</span><span class="s2">.</span><span class="s1">readline</span><span class="s2">() == </span><span class="s7">b&quot;1 </span><span class="s0">\n</span><span class="s7">&quot;</span>
    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s5"># make sure it's correct too :)</span>
    <span class="s1">X2</span><span class="s2">, </span><span class="s1">y2 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_dump_comment</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">()</span>

    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">ascii_comment </span><span class="s2">= </span><span class="s3">&quot;This is a comment</span><span class="s0">\n</span><span class="s3">spanning multiple lines.&quot;</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">=</span><span class="s1">ascii_comment</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>

    <span class="s1">X2</span><span class="s2">, </span><span class="s1">y2 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">)</span>

    <span class="s5"># XXX we have to update this to support Python 3.x</span>
    <span class="s1">utf8_comment </span><span class="s2">= </span><span class="s7">b&quot;It is true that</span><span class="s0">\n\xc2\xbd\xc2\xb2 </span><span class="s7">= </span><span class="s0">\xc2\xbc</span><span class="s7">&quot;</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">UnicodeDecodeError</span><span class="s2">):</span>
        <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">=</span><span class="s1">utf8_comment</span><span class="s2">)</span>

    <span class="s1">unicode_comment </span><span class="s2">= </span><span class="s1">utf8_comment</span><span class="s2">.</span><span class="s1">decode</span><span class="s2">(</span><span class="s3">&quot;utf-8&quot;</span><span class="s2">)</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">=</span><span class="s1">unicode_comment</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>

    <span class="s1">X2</span><span class="s2">, </span><span class="s1">y2 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">)</span>

    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">=</span><span class="s3">&quot;I've got a </span><span class="s0">\0</span><span class="s3">.&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_dump_invalid</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>

    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">y2d </span><span class="s2">= [</span><span class="s1">y</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y2d</span><span class="s2">, </span><span class="s1">f</span><span class="s2">)</span>

    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">[:-</span><span class="s6">1</span><span class="s2">], </span><span class="s1">f</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_dump_query_id</span><span class="s2">():</span>
    <span class="s5"># test dumping a file with query_id</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">)</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">()</span>
    <span class="s1">query_id </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]) // </span><span class="s6">2</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">query_id</span><span class="s2">=</span><span class="s1">query_id</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">X1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">query_id1 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">X1</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">query_id</span><span class="s2">, </span><span class="s1">query_id1</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_load_with_long_qid</span><span class="s2">():</span>
    <span class="s5"># load svmfile with longint qid attribute</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s7">b&quot;&quot;&quot; 
    1 qid:0 0:1 1:2 2:3 
    0 qid:72048431380967004 0:1440446648 1:72048431380967004 2:236784985 
    0 qid:-9223372036854775807 0:1440446648 1:72048431380967004 2:236784985 
    3 qid:9223372036854775807  0:1440446648 1:72048431380967004 2:236784985&quot;&quot;&quot;</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">qid </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">BytesIO</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">true_X </span><span class="s2">= [</span>
        <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s6">1440446648</span><span class="s2">, </span><span class="s6">72048431380967004</span><span class="s2">, </span><span class="s6">236784985</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s6">1440446648</span><span class="s2">, </span><span class="s6">72048431380967004</span><span class="s2">, </span><span class="s6">236784985</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s6">1440446648</span><span class="s2">, </span><span class="s6">72048431380967004</span><span class="s2">, </span><span class="s6">236784985</span><span class="s2">],</span>
    <span class="s2">]</span>

    <span class="s1">true_y </span><span class="s2">= [</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">3</span><span class="s2">]</span>
    <span class="s1">trueQID </span><span class="s2">= [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">72048431380967004</span><span class="s2">, -</span><span class="s6">9223372036854775807</span><span class="s2">, </span><span class="s6">9223372036854775807</span><span class="s2">]</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">true_y</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">true_X</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">qid</span><span class="s2">, </span><span class="s1">trueQID</span><span class="s2">)</span>

    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">query_id</span><span class="s2">=</span><span class="s1">qid</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">qid </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">true_y</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">true_X</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">qid</span><span class="s2">, </span><span class="s1">trueQID</span><span class="s2">)</span>

    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">true_y</span><span class="s2">)</span>
    <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">true_X</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;csr_container&quot;</span><span class="s2">, </span><span class="s1">CSR_CONTAINERS</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_load_zeros</span><span class="s2">(</span><span class="s1">csr_container</span><span class="s2">):</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">true_X </span><span class="s2">= </span><span class="s1">csr_container</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">=(</span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">)))</span>
    <span class="s1">true_y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">])</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">true_X</span><span class="s2">, </span><span class="s1">true_y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">zero_based </span><span class="s0">in </span><span class="s2">[</span><span class="s3">&quot;auto&quot;</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]:</span>
        <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">=</span><span class="s6">4</span><span class="s2">, </span><span class="s1">zero_based</span><span class="s2">=</span><span class="s1">zero_based</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">true_y</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">true_X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;sparsity&quot;</span><span class="s2">, [</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0.1</span><span class="s2">, </span><span class="s6">0.5</span><span class="s2">, </span><span class="s6">0.99</span><span class="s2">, </span><span class="s6">1</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;n_samples&quot;</span><span class="s2">, [</span><span class="s6">13</span><span class="s2">, </span><span class="s6">101</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;n_features&quot;</span><span class="s2">, [</span><span class="s6">2</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, </span><span class="s6">41</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;csr_container&quot;</span><span class="s2">, </span><span class="s1">CSR_CONTAINERS</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_load_with_offsets</span><span class="s2">(</span><span class="s1">sparsity</span><span class="s2">, </span><span class="s1">n_samples</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">, </span><span class="s1">csr_container</span><span class="s2">):</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span><span class="s1">low</span><span class="s2">=</span><span class="s6">0.0</span><span class="s2">, </span><span class="s1">high</span><span class="s2">=</span><span class="s6">1.0</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=(</span><span class="s1">n_samples</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">))</span>
    <span class="s0">if </span><span class="s1">sparsity</span><span class="s2">:</span>
        <span class="s1">X</span><span class="s2">[</span><span class="s1">X </span><span class="s2">&lt; </span><span class="s1">sparsity</span><span class="s2">] = </span><span class="s6">0.0</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">csr_container</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s1">low</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">high</span><span class="s2">=</span><span class="s6">2</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">n_samples</span><span class="s2">)</span>

    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">)</span>
    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>

    <span class="s1">size </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">f</span><span class="s2">.</span><span class="s1">getvalue</span><span class="s2">())</span>

    <span class="s5"># put some marks that are likely to happen anywhere in a row</span>
    <span class="s1">mark_0 </span><span class="s2">= </span><span class="s6">0</span>
    <span class="s1">mark_1 </span><span class="s2">= </span><span class="s1">size </span><span class="s2">// </span><span class="s6">3</span>
    <span class="s1">length_0 </span><span class="s2">= </span><span class="s1">mark_1 </span><span class="s2">- </span><span class="s1">mark_0</span>
    <span class="s1">mark_2 </span><span class="s2">= </span><span class="s6">4 </span><span class="s2">* </span><span class="s1">size </span><span class="s2">// </span><span class="s6">5</span>
    <span class="s1">length_1 </span><span class="s2">= </span><span class="s1">mark_2 </span><span class="s2">- </span><span class="s1">mark_1</span>

    <span class="s5"># load the original sparse matrix into 3 independent CSR matrices</span>
    <span class="s1">X_0</span><span class="s2">, </span><span class="s1">y_0 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span>
        <span class="s1">f</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">=</span><span class="s1">n_features</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">mark_0</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s1">length_0</span>
    <span class="s2">)</span>
    <span class="s1">X_1</span><span class="s2">, </span><span class="s1">y_1 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span>
        <span class="s1">f</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">=</span><span class="s1">n_features</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">mark_1</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s1">length_1</span>
    <span class="s2">)</span>
    <span class="s1">X_2</span><span class="s2">, </span><span class="s1">y_2 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">=</span><span class="s1">n_features</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">mark_2</span><span class="s2">)</span>

    <span class="s1">y_concat </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">y_0</span><span class="s2">, </span><span class="s1">y_1</span><span class="s2">, </span><span class="s1">y_2</span><span class="s2">])</span>
    <span class="s1">X_concat </span><span class="s2">= </span><span class="s1">sp</span><span class="s2">.</span><span class="s1">vstack</span><span class="s2">([</span><span class="s1">X_0</span><span class="s2">, </span><span class="s1">X_1</span><span class="s2">, </span><span class="s1">X_2</span><span class="s2">])</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y_concat</span><span class="s2">)</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">X_concat</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;csr_container&quot;</span><span class="s2">, </span><span class="s1">CSR_CONTAINERS</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_load_offset_exhaustive_splits</span><span class="s2">(</span><span class="s1">csr_container</span><span class="s2">):</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">6</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">6</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">0</span><span class="s2">],</span>
        <span class="s2">]</span>
    <span class="s2">)</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">csr_container</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">n_samples</span><span class="s2">, </span><span class="s1">n_features </span><span class="s2">= </span><span class="s1">X</span><span class="s2">.</span><span class="s1">shape</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randint</span><span class="s2">(</span><span class="s1">low</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">high</span><span class="s2">=</span><span class="s6">2</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">n_samples</span><span class="s2">)</span>
    <span class="s1">query_id </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">n_samples</span><span class="s2">) // </span><span class="s6">2</span>

    <span class="s1">f </span><span class="s2">= </span><span class="s1">BytesIO</span><span class="s2">()</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">f</span><span class="s2">, </span><span class="s1">query_id</span><span class="s2">=</span><span class="s1">query_id</span><span class="s2">)</span>
    <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>

    <span class="s1">size </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">f</span><span class="s2">.</span><span class="s1">getvalue</span><span class="s2">())</span>

    <span class="s5"># load the same data in 2 parts with all the possible byte offsets to</span>
    <span class="s5"># locate the split so has to test for particular boundary cases</span>
    <span class="s0">for </span><span class="s1">mark </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">size</span><span class="s2">):</span>
        <span class="s1">f</span><span class="s2">.</span><span class="s1">seek</span><span class="s2">(</span><span class="s6">0</span><span class="s2">)</span>
        <span class="s1">X_0</span><span class="s2">, </span><span class="s1">y_0</span><span class="s2">, </span><span class="s1">q_0 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span>
            <span class="s1">f</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">=</span><span class="s1">n_features</span><span class="s2">, </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s1">mark</span>
        <span class="s2">)</span>
        <span class="s1">X_1</span><span class="s2">, </span><span class="s1">y_1</span><span class="s2">, </span><span class="s1">q_1 </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span>
            <span class="s1">f</span><span class="s2">, </span><span class="s1">n_features</span><span class="s2">=</span><span class="s1">n_features</span><span class="s2">, </span><span class="s1">query_id</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">mark</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=-</span><span class="s6">1</span>
        <span class="s2">)</span>
        <span class="s1">q_concat </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">q_0</span><span class="s2">, </span><span class="s1">q_1</span><span class="s2">])</span>
        <span class="s1">y_concat </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">y_0</span><span class="s2">, </span><span class="s1">y_1</span><span class="s2">])</span>
        <span class="s1">X_concat </span><span class="s2">= </span><span class="s1">sp</span><span class="s2">.</span><span class="s1">vstack</span><span class="s2">([</span><span class="s1">X_0</span><span class="s2">, </span><span class="s1">X_1</span><span class="s2">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">y_concat</span><span class="s2">)</span>
        <span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">query_id</span><span class="s2">, </span><span class="s1">q_concat</span><span class="s2">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">(), </span><span class="s1">X_concat</span><span class="s2">.</span><span class="s1">toarray</span><span class="s2">())</span>


<span class="s0">def </span><span class="s1">test_load_with_offsets_error</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;n_features is required&quot;</span><span class="s2">):</span>
        <span class="s1">_load_svmlight_local_test_file</span><span class="s2">(</span><span class="s1">datafile</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s6">3</span><span class="s2">, </span><span class="s1">length</span><span class="s2">=</span><span class="s6">3</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;csr_container&quot;</span><span class="s2">, </span><span class="s1">CSR_CONTAINERS</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_multilabel_y_explicit_zeros</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">, </span><span class="s1">csr_container</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot; 
    Ensure that if y contains explicit zeros (i.e. elements of y.data equal to 
    0) then those explicit zeros are not encoded. 
    &quot;&quot;&quot;</span>
    <span class="s1">save_path </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">tmp_path </span><span class="s2">/ </span><span class="s3">&quot;svm_explicit_zero&quot;</span><span class="s2">)</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s6">42</span><span class="s2">)</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s6">3</span><span class="s2">, </span><span class="s6">5</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
    <span class="s1">indptr </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">6</span><span class="s2">])</span>
    <span class="s1">indices </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">])</span>
    <span class="s5"># The first and last element are explicit zeros.</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s6">0</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">1</span><span class="s2">, </span><span class="s6">0</span><span class="s2">])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">csr_container</span><span class="s2">((</span><span class="s1">data</span><span class="s2">, </span><span class="s1">indices</span><span class="s2">, </span><span class="s1">indptr</span><span class="s2">), </span><span class="s1">shape</span><span class="s2">=(</span><span class="s6">3</span><span class="s2">, </span><span class="s6">3</span><span class="s2">))</span>
    <span class="s5"># y as a dense array would look like</span>
    <span class="s5"># [[0, 0, 1],</span>
    <span class="s5">#  [0, 0, 1],</span>
    <span class="s5">#  [1, 1, 0]]</span>

    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">save_path</span><span class="s2">, </span><span class="s1">multilabel</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">_</span><span class="s2">, </span><span class="s1">y_load </span><span class="s2">= </span><span class="s1">load_svmlight_file</span><span class="s2">(</span><span class="s1">save_path</span><span class="s2">, </span><span class="s1">multilabel</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">y_true </span><span class="s2">= [(</span><span class="s6">2.0</span><span class="s2">,), (</span><span class="s6">2.0</span><span class="s2">,), (</span><span class="s6">0.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">)]</span>
    <span class="s0">assert </span><span class="s1">y_load </span><span class="s2">== </span><span class="s1">y_true</span>


<span class="s0">def </span><span class="s1">test_dump_read_only</span><span class="s2">(</span><span class="s1">tmp_path</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Ensure that there is no ValueError when dumping a read-only `X`. 
 
    Non-regression test for: 
    https://github.com/scikit-learn/scikit-learn/issues/28026 
    &quot;&quot;&quot;</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s6">42</span><span class="s2">)</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s6">5</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s6">5</span><span class="s2">)</span>

    <span class="s5"># Convert to memmap-backed which are read-only</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">create_memmap_backed_data</span><span class="s2">([</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">])</span>

    <span class="s1">save_path </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">tmp_path </span><span class="s2">/ </span><span class="s3">&quot;svm_read_only&quot;</span><span class="s2">)</span>
    <span class="s1">dump_svmlight_file</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">save_path</span><span class="s2">)</span>
</pre>
</body>
</html>