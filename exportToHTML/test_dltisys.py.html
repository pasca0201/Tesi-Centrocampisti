<html>
<head>
<title>test_dltisys.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_dltisys.py</font>
</center></td></tr></table>
<pre><span class="s0"># Author: Jeffrey Armstrong &lt;jeff@approximatrix.com&gt;</span>
<span class="s0"># April 4, 2011</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">testing </span><span class="s2">import </span><span class="s3">(</span><span class="s1">assert_equal</span><span class="s3">,</span>
                           <span class="s1">assert_array_almost_equal</span><span class="s3">, </span><span class="s1">assert_array_equal</span><span class="s3">,</span>
                           <span class="s1">assert_allclose</span><span class="s3">, </span><span class="s1">assert_</span><span class="s3">, </span><span class="s1">assert_almost_equal</span><span class="s3">,</span>
                           <span class="s1">suppress_warnings</span><span class="s3">)</span>
<span class="s2">from </span><span class="s1">pytest </span><span class="s2">import </span><span class="s1">raises </span><span class="s2">as </span><span class="s1">assert_raises</span>
<span class="s2">from </span><span class="s1">scipy</span><span class="s3">.</span><span class="s1">signal </span><span class="s2">import </span><span class="s3">(</span><span class="s1">dlsim</span><span class="s3">, </span><span class="s1">dstep</span><span class="s3">, </span><span class="s1">dimpulse</span><span class="s3">, </span><span class="s1">tf2zpk</span><span class="s3">, </span><span class="s1">lti</span><span class="s3">, </span><span class="s1">dlti</span><span class="s3">,</span>
                          <span class="s1">StateSpace</span><span class="s3">, </span><span class="s1">TransferFunction</span><span class="s3">, </span><span class="s1">ZerosPolesGain</span><span class="s3">,</span>
                          <span class="s1">dfreqresp</span><span class="s3">, </span><span class="s1">dbode</span><span class="s3">, </span><span class="s1">BadCoefficients</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestDLTI</span><span class="s3">:</span>

    <span class="s2">def </span><span class="s1">test_dlsim</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.9</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">], [-</span><span class="s4">0.2</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">]])</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.4</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">, -</span><span class="s4">0.1</span><span class="s3">], [</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">0.05</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.3</span><span class="s3">]])</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">, -</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.5</span>

        <span class="s0"># Create an input matrix with inputs down the columns (3 cols) and its</span>
        <span class="s0"># respective time input vector</span>
        <span class="s1">u </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">hstack</span><span class="s3">((</span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">4.0</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)[:, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">newaxis</span><span class="s3">],</span>
                       <span class="s1">np</span><span class="s3">.</span><span class="s1">full</span><span class="s3">((</span><span class="s4">5</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s4">0.01</span><span class="s3">),</span>
                       <span class="s1">np</span><span class="s3">.</span><span class="s1">full</span><span class="s3">((</span><span class="s4">5</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), -</span><span class="s4">0.002</span><span class="s3">)))</span>
        <span class="s1">t_in </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)</span>

        <span class="s0"># Define the known result</span>
        <span class="s1">yout_truth </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[-</span><span class="s4">0.001</span><span class="s3">,</span>
                                <span class="s3">-</span><span class="s4">0.00073</span><span class="s3">,</span>
                                <span class="s4">0.039446</span><span class="s3">,</span>
                                <span class="s4">0.0915387</span><span class="s3">,</span>
                                <span class="s4">0.13195948</span><span class="s3">]]).</span><span class="s1">T</span>
        <span class="s1">xout_truth </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                                 <span class="s3">[</span><span class="s4">0.0012</span><span class="s3">, </span><span class="s4">0.0005</span><span class="s3">],</span>
                                 <span class="s3">[</span><span class="s4">0.40233</span><span class="s3">, </span><span class="s4">0.00071</span><span class="s3">],</span>
                                 <span class="s3">[</span><span class="s4">1.163368</span><span class="s3">, -</span><span class="s4">0.079327</span><span class="s3">],</span>
                                 <span class="s3">[</span><span class="s4">2.2402985</span><span class="s3">, -</span><span class="s4">0.3035679</span><span class="s3">]])</span>

        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout</span><span class="s3">, </span><span class="s1">xout </span><span class="s3">= </span><span class="s1">dlsim</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">), </span><span class="s1">u</span><span class="s3">, </span><span class="s1">t_in</span><span class="s3">)</span>

        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout_truth</span><span class="s3">, </span><span class="s1">yout</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">xout_truth</span><span class="s3">, </span><span class="s1">xout</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">t_in</span><span class="s3">, </span><span class="s1">tout</span><span class="s3">)</span>

        <span class="s0"># Make sure input with single-dimension doesn't raise error</span>
        <span class="s1">dlsim</span><span class="s3">((</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">), </span><span class="s4">4</span><span class="s3">)</span>

        <span class="s0"># Interpolated control - inputs should have different time steps</span>
        <span class="s0"># than the discrete model uses internally</span>
        <span class="s1">u_sparse </span><span class="s3">= </span><span class="s1">u</span><span class="s3">[[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">4</span><span class="s3">], :]</span>
        <span class="s1">t_sparse </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s3">])</span>

        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout</span><span class="s3">, </span><span class="s1">xout </span><span class="s3">= </span><span class="s1">dlsim</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">), </span><span class="s1">u_sparse</span><span class="s3">, </span><span class="s1">t_sparse</span><span class="s3">)</span>

        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout_truth</span><span class="s3">, </span><span class="s1">yout</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">xout_truth</span><span class="s3">, </span><span class="s1">xout</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">tout</span><span class="s3">), </span><span class="s1">yout</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">])</span>

        <span class="s0"># Transfer functions (assume dt = 0.5)</span>
        <span class="s1">num </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">1.0</span><span class="s3">, -</span><span class="s4">0.1</span><span class="s3">])</span>
        <span class="s1">den </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">0.3</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">0.2</span><span class="s3">])</span>
        <span class="s1">yout_truth </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">,</span>
                                <span class="s4">0.0</span><span class="s3">,</span>
                                <span class="s4">3.33333333333333</span><span class="s3">,</span>
                                <span class="s3">-</span><span class="s4">4.77777777777778</span><span class="s3">,</span>
                                <span class="s4">23.0370370370370</span><span class="s3">]]).</span><span class="s1">T</span>

        <span class="s0"># Assume use of the first column of the control input built earlier</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dlsim</span><span class="s3">((</span><span class="s1">num</span><span class="s3">, </span><span class="s1">den</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">), </span><span class="s1">u</span><span class="s3">[:, </span><span class="s4">0</span><span class="s3">], </span><span class="s1">t_in</span><span class="s3">)</span>

        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">, </span><span class="s1">yout_truth</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">t_in</span><span class="s3">, </span><span class="s1">tout</span><span class="s3">)</span>

        <span class="s0"># Retest the same with a 1-D input vector</span>
        <span class="s1">uflat </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">u</span><span class="s3">[:, </span><span class="s4">0</span><span class="s3">])</span>
        <span class="s1">uflat </span><span class="s3">= </span><span class="s1">uflat</span><span class="s3">.</span><span class="s1">reshape</span><span class="s3">((</span><span class="s4">5</span><span class="s3">,))</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dlsim</span><span class="s3">((</span><span class="s1">num</span><span class="s3">, </span><span class="s1">den</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">), </span><span class="s1">uflat</span><span class="s3">, </span><span class="s1">t_in</span><span class="s3">)</span>

        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">, </span><span class="s1">yout_truth</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">t_in</span><span class="s3">, </span><span class="s1">tout</span><span class="s3">)</span>

        <span class="s0"># zeros-poles-gain representation</span>
        <span class="s1">zd </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">0.5</span><span class="s3">, -</span><span class="s4">0.5</span><span class="s3">])</span>
        <span class="s1">pd </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1.j </span><span class="s3">/ </span><span class="s1">np</span><span class="s3">.</span><span class="s1">sqrt</span><span class="s3">(</span><span class="s4">2</span><span class="s3">), -</span><span class="s4">1.j </span><span class="s3">/ </span><span class="s1">np</span><span class="s3">.</span><span class="s1">sqrt</span><span class="s3">(</span><span class="s4">2</span><span class="s3">)])</span>
        <span class="s1">k </span><span class="s3">= </span><span class="s4">1.0</span>
        <span class="s1">yout_truth </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s3">, </span><span class="s4">2.25</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">]]).</span><span class="s1">T</span>

        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dlsim</span><span class="s3">((</span><span class="s1">zd</span><span class="s3">, </span><span class="s1">pd</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">), </span><span class="s1">u</span><span class="s3">[:, </span><span class="s4">0</span><span class="s3">], </span><span class="s1">t_in</span><span class="s3">)</span>

        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">, </span><span class="s1">yout_truth</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">t_in</span><span class="s3">, </span><span class="s1">tout</span><span class="s3">)</span>

        <span class="s0"># Raise an error for continuous-time systems</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">lti</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">dlsim</span><span class="s3">, </span><span class="s1">system</span><span class="s3">, </span><span class="s1">u</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dstep</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.9</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">], [-</span><span class="s4">0.2</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">]])</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.4</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">, -</span><span class="s4">0.1</span><span class="s3">], [</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">0.05</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.3</span><span class="s3">]])</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">, -</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.5</span>

        <span class="s0"># Because b.shape[1] == 3, dstep should result in a tuple of three</span>
        <span class="s0"># result vectors</span>
        <span class="s1">yout_step_truth </span><span class="s3">= (</span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">0.04</span><span class="s3">, </span><span class="s4">0.052</span><span class="s3">, </span><span class="s4">0.0404</span><span class="s3">, </span><span class="s4">0.00956</span><span class="s3">,</span>
                                       <span class="s3">-</span><span class="s4">0.036324</span><span class="s3">, -</span><span class="s4">0.093318</span><span class="s3">, -</span><span class="s4">0.15782348</span><span class="s3">,</span>
                                       <span class="s3">-</span><span class="s4">0.226628324</span><span class="s3">, -</span><span class="s4">0.2969374948</span><span class="s3">]),</span>
                           <span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([-</span><span class="s4">0.1</span><span class="s3">, -</span><span class="s4">0.075</span><span class="s3">, -</span><span class="s4">0.058</span><span class="s3">, -</span><span class="s4">0.04815</span><span class="s3">,</span>
                                       <span class="s3">-</span><span class="s4">0.04453</span><span class="s3">, -</span><span class="s4">0.0461895</span><span class="s3">, -</span><span class="s4">0.0521812</span><span class="s3">,</span>
                                       <span class="s3">-</span><span class="s4">0.061588875</span><span class="s3">, -</span><span class="s4">0.073549579</span><span class="s3">,</span>
                                       <span class="s3">-</span><span class="s4">0.08727047595</span><span class="s3">]),</span>
                           <span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">0.0</span><span class="s3">, -</span><span class="s4">0.01</span><span class="s3">, -</span><span class="s4">0.013</span><span class="s3">, -</span><span class="s4">0.0101</span><span class="s3">, -</span><span class="s4">0.00239</span><span class="s3">,</span>
                                       <span class="s4">0.009081</span><span class="s3">, </span><span class="s4">0.0233295</span><span class="s3">, </span><span class="s4">0.03945587</span><span class="s3">,</span>
                                       <span class="s4">0.056657081</span><span class="s3">, </span><span class="s4">0.0742343737</span><span class="s3">]))</span>

        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dstep</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">), </span><span class="s1">n</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>

        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">), </span><span class="s4">3</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">len</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">)):</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s4">10</span><span class="s3">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">flatten</span><span class="s3">(), </span><span class="s1">yout_step_truth</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>

        <span class="s0"># Check that the other two inputs (tf, zpk) will work as well</span>
        <span class="s1">tfin </span><span class="s3">= ([</span><span class="s4">1.0</span><span class="s3">], [</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">], </span><span class="s4">0.5</span><span class="s3">)</span>
        <span class="s1">yout_tfstep </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">])</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dstep</span><span class="s3">(</span><span class="s1">tfin</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">[</span><span class="s4">0</span><span class="s3">].</span><span class="s1">flatten</span><span class="s3">(), </span><span class="s1">yout_tfstep</span><span class="s3">)</span>

        <span class="s1">zpkin </span><span class="s3">= </span><span class="s1">tf2zpk</span><span class="s3">(</span><span class="s1">tfin</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">tfin</span><span class="s3">[</span><span class="s4">1</span><span class="s3">]) + (</span><span class="s4">0.5</span><span class="s3">,)</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dstep</span><span class="s3">(</span><span class="s1">zpkin</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">[</span><span class="s4">0</span><span class="s3">].</span><span class="s1">flatten</span><span class="s3">(), </span><span class="s1">yout_tfstep</span><span class="s3">)</span>

        <span class="s0"># Raise an error for continuous-time systems</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">lti</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">dstep</span><span class="s3">, </span><span class="s1">system</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dimpulse</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.9</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">], [-</span><span class="s4">0.2</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">]])</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.4</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">, -</span><span class="s4">0.1</span><span class="s3">], [</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">0.05</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.3</span><span class="s3">]])</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">, -</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.5</span>

        <span class="s0"># Because b.shape[1] == 3, dimpulse should result in a tuple of three</span>
        <span class="s0"># result vectors</span>
        <span class="s1">yout_imp_truth </span><span class="s3">= (</span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">0.04</span><span class="s3">, </span><span class="s4">0.012</span><span class="s3">, -</span><span class="s4">0.0116</span><span class="s3">, -</span><span class="s4">0.03084</span><span class="s3">,</span>
                                      <span class="s3">-</span><span class="s4">0.045884</span><span class="s3">, -</span><span class="s4">0.056994</span><span class="s3">, -</span><span class="s4">0.06450548</span><span class="s3">,</span>
                                      <span class="s3">-</span><span class="s4">0.068804844</span><span class="s3">, -</span><span class="s4">0.0703091708</span><span class="s3">]),</span>
                          <span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([-</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.025</span><span class="s3">, </span><span class="s4">0.017</span><span class="s3">, </span><span class="s4">0.00985</span><span class="s3">, </span><span class="s4">0.00362</span><span class="s3">,</span>
                                      <span class="s3">-</span><span class="s4">0.0016595</span><span class="s3">, -</span><span class="s4">0.0059917</span><span class="s3">, -</span><span class="s4">0.009407675</span><span class="s3">,</span>
                                      <span class="s3">-</span><span class="s4">0.011960704</span><span class="s3">, -</span><span class="s4">0.01372089695</span><span class="s3">]),</span>
                          <span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">0.0</span><span class="s3">, -</span><span class="s4">0.01</span><span class="s3">, -</span><span class="s4">0.003</span><span class="s3">, </span><span class="s4">0.0029</span><span class="s3">, </span><span class="s4">0.00771</span><span class="s3">,</span>
                                      <span class="s4">0.011471</span><span class="s3">, </span><span class="s4">0.0142485</span><span class="s3">, </span><span class="s4">0.01612637</span><span class="s3">,</span>
                                      <span class="s4">0.017201211</span><span class="s3">, </span><span class="s4">0.0175772927</span><span class="s3">]))</span>

        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dimpulse</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">), </span><span class="s1">n</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>

        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">), </span><span class="s4">3</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">len</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">)):</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s4">10</span><span class="s3">)</span>
            <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">flatten</span><span class="s3">(), </span><span class="s1">yout_imp_truth</span><span class="s3">[</span><span class="s1">i</span><span class="s3">])</span>

        <span class="s0"># Check that the other two inputs (tf, zpk) will work as well</span>
        <span class="s1">tfin </span><span class="s3">= ([</span><span class="s4">1.0</span><span class="s3">], [</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">], </span><span class="s4">0.5</span><span class="s3">)</span>
        <span class="s1">yout_tfimpulse </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">([</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, -</span><span class="s4">1.0</span><span class="s3">])</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dimpulse</span><span class="s3">(</span><span class="s1">tfin</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">[</span><span class="s4">0</span><span class="s3">].</span><span class="s1">flatten</span><span class="s3">(), </span><span class="s1">yout_tfimpulse</span><span class="s3">)</span>

        <span class="s1">zpkin </span><span class="s3">= </span><span class="s1">tf2zpk</span><span class="s3">(</span><span class="s1">tfin</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">tfin</span><span class="s3">[</span><span class="s4">1</span><span class="s3">]) + (</span><span class="s4">0.5</span><span class="s3">,)</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout </span><span class="s3">= </span><span class="s1">dimpulse</span><span class="s3">(</span><span class="s1">zpkin</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">[</span><span class="s4">0</span><span class="s3">].</span><span class="s1">flatten</span><span class="s3">(), </span><span class="s1">yout_tfimpulse</span><span class="s3">)</span>

        <span class="s0"># Raise an error for continuous-time systems</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">lti</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">dimpulse</span><span class="s3">, </span><span class="s1">system</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dlsim_trivial</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">n </span><span class="s3">= </span><span class="s4">5</span>
        <span class="s1">u </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">(</span><span class="s1">n</span><span class="s3">).</span><span class="s1">reshape</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout</span><span class="s3">, </span><span class="s1">xout </span><span class="s3">= </span><span class="s1">dlsim</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">u</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">tout</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">n</span><span class="s3">)))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s1">n</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">xout</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s1">n</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)))</span>

    <span class="s2">def </span><span class="s1">test_dlsim_simple1d</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.5</span><span class="s3">]])</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1.0</span><span class="s3">]])</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">n </span><span class="s3">= </span><span class="s4">5</span>
        <span class="s1">u </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">(</span><span class="s1">n</span><span class="s3">).</span><span class="s1">reshape</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout</span><span class="s3">, </span><span class="s1">xout </span><span class="s3">= </span><span class="s1">dlsim</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">u</span><span class="s3">, </span><span class="s1">x0</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">tout</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">n</span><span class="s3">)))</span>
        <span class="s1">expected </span><span class="s3">= (</span><span class="s4">0.5 </span><span class="s3">** </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">n</span><span class="s3">))).</span><span class="s1">reshape</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">xout</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dlsim_simple2d</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">lambda1 </span><span class="s3">= </span><span class="s4">0.5</span>
        <span class="s1">lambda2 </span><span class="s3">= </span><span class="s4">0.25</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s1">lambda1</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">0.0</span><span class="s3">, </span><span class="s1">lambda2</span><span class="s3">]])</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">]])</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">0.0</span><span class="s3">]])</span>
        <span class="s1">n </span><span class="s3">= </span><span class="s4">5</span>
        <span class="s1">u </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">(</span><span class="s1">n</span><span class="s3">).</span><span class="s1">reshape</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">tout</span><span class="s3">, </span><span class="s1">yout</span><span class="s3">, </span><span class="s1">xout </span><span class="s3">= </span><span class="s1">dlsim</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">u</span><span class="s3">, </span><span class="s1">x0</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">tout</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">n</span><span class="s3">)))</span>
        <span class="s0"># The analytical solution:</span>
        <span class="s1">expected </span><span class="s3">= (</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">lambda1</span><span class="s3">, </span><span class="s1">lambda2</span><span class="s3">]) **</span>
                                <span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">n</span><span class="s3">)).</span><span class="s1">reshape</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">yout</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">xout</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_more_step_and_impulse</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">lambda1 </span><span class="s3">= </span><span class="s4">0.5</span>
        <span class="s1">lambda2 </span><span class="s3">= </span><span class="s4">0.75</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s1">lambda1</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">0.0</span><span class="s3">, </span><span class="s1">lambda2</span><span class="s3">]])</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">]])</span>
        <span class="s1">c </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">]])</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">0.0</span><span class="s3">]])</span>

        <span class="s1">n </span><span class="s3">= </span><span class="s4">10</span>

        <span class="s0"># Check a step response.</span>
        <span class="s1">ts</span><span class="s3">, </span><span class="s1">ys </span><span class="s3">= </span><span class="s1">dstep</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">n</span><span class="s3">=</span><span class="s1">n</span><span class="s3">)</span>

        <span class="s0"># Create the exact step response.</span>
        <span class="s1">stp0 </span><span class="s3">= (</span><span class="s4">1.0 </span><span class="s3">/ (</span><span class="s4">1 </span><span class="s3">- </span><span class="s1">lambda1</span><span class="s3">)) * (</span><span class="s4">1.0 </span><span class="s3">- </span><span class="s1">lambda1 </span><span class="s3">** </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">n</span><span class="s3">))</span>
        <span class="s1">stp1 </span><span class="s3">= (</span><span class="s4">1.0 </span><span class="s3">/ (</span><span class="s4">1 </span><span class="s3">- </span><span class="s1">lambda2</span><span class="s3">)) * (</span><span class="s4">1.0 </span><span class="s3">- </span><span class="s1">lambda2 </span><span class="s3">** </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">n</span><span class="s3">))</span>

        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">ys</span><span class="s3">[</span><span class="s4">0</span><span class="s3">][:, </span><span class="s4">0</span><span class="s3">], </span><span class="s1">stp0</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">ys</span><span class="s3">[</span><span class="s4">1</span><span class="s3">][:, </span><span class="s4">0</span><span class="s3">], </span><span class="s1">stp1</span><span class="s3">)</span>

        <span class="s0"># Check an impulse response with an initial condition.</span>
        <span class="s1">x0 </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">])</span>
        <span class="s1">ti</span><span class="s3">, </span><span class="s1">yi </span><span class="s3">= </span><span class="s1">dimpulse</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">, </span><span class="s1">c</span><span class="s3">, </span><span class="s1">d</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">n</span><span class="s3">=</span><span class="s1">n</span><span class="s3">, </span><span class="s1">x0</span><span class="s3">=</span><span class="s1">x0</span><span class="s3">)</span>

        <span class="s0"># Create the exact impulse response.</span>
        <span class="s1">imp </span><span class="s3">= (</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">lambda1</span><span class="s3">, </span><span class="s1">lambda2</span><span class="s3">]) **</span>
                            <span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s1">n </span><span class="s3">+ </span><span class="s4">1</span><span class="s3">).</span><span class="s1">reshape</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">))</span>
        <span class="s1">imp</span><span class="s3">[</span><span class="s4">0</span><span class="s3">, :] = </span><span class="s4">0.0</span>
        <span class="s0"># Analytical solution to impulse response</span>
        <span class="s1">y0 </span><span class="s3">= </span><span class="s1">imp</span><span class="s3">[:</span><span class="s1">n</span><span class="s3">, </span><span class="s4">0</span><span class="s3">] + </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dot</span><span class="s3">(</span><span class="s1">imp</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:</span><span class="s1">n </span><span class="s3">+ </span><span class="s4">1</span><span class="s3">, :], </span><span class="s1">x0</span><span class="s3">)</span>
        <span class="s1">y1 </span><span class="s3">= </span><span class="s1">imp</span><span class="s3">[:</span><span class="s1">n</span><span class="s3">, </span><span class="s4">1</span><span class="s3">] + </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dot</span><span class="s3">(</span><span class="s1">imp</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:</span><span class="s1">n </span><span class="s3">+ </span><span class="s4">1</span><span class="s3">, :], </span><span class="s1">x0</span><span class="s3">)</span>

        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">yi</span><span class="s3">[</span><span class="s4">0</span><span class="s3">][:, </span><span class="s4">0</span><span class="s3">], </span><span class="s1">y0</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">yi</span><span class="s3">[</span><span class="s4">1</span><span class="s3">][:, </span><span class="s4">0</span><span class="s3">], </span><span class="s1">y1</span><span class="s3">)</span>

        <span class="s0"># Check that dt=0.1, n=3 gives 3 time values.</span>
        <span class="s1">system </span><span class="s3">= ([</span><span class="s4">1.0</span><span class="s3">], [</span><span class="s4">1.0</span><span class="s3">, -</span><span class="s4">0.5</span><span class="s3">], </span><span class="s4">0.1</span><span class="s3">)</span>
        <span class="s1">t</span><span class="s3">, (</span><span class="s1">y</span><span class="s3">,) = </span><span class="s1">dstep</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.2</span><span class="s3">])</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">y</span><span class="s3">.</span><span class="s1">T</span><span class="s3">, [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">]])</span>
        <span class="s1">t</span><span class="s3">, (</span><span class="s1">y</span><span class="s3">,) = </span><span class="s1">dimpulse</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">t</span><span class="s3">, [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.2</span><span class="s3">])</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">y</span><span class="s3">.</span><span class="s1">T</span><span class="s3">, [[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">]])</span>


<span class="s2">class </span><span class="s1">TestDlti</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_dlti_instantiation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test that lti can be instantiated.</span>

        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.05</span>
        <span class="s0"># TransferFunction</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">dlti</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">TransferFunction</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">dlti</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s2">not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">lti</span><span class="s3">))</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">)</span>

        <span class="s0"># ZerosPolesGain</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">dlti</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([]), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([-</span><span class="s4">1</span><span class="s3">]), </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">ZerosPolesGain</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">dlti</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s2">not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">lti</span><span class="s3">))</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">)</span>

        <span class="s0"># StateSpace</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">dlti</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [-</span><span class="s4">1</span><span class="s3">], </span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">StateSpace</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">dlti</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s2">not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">lti</span><span class="s3">))</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">)</span>

        <span class="s0"># Number of inputs</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">dlti</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">dlti</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestStateSpaceDisc</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_initialization</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Check that all initializations work</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.05</span>
        <span class="s1">StateSpace</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">StateSpace</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">2</span><span class="s3">], [</span><span class="s4">3</span><span class="s3">], [</span><span class="s4">4</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">StateSpace</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], [</span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">]]), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">2</span><span class="s3">]]),</span>
                   <span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">]]), </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">StateSpace</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_conversion</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Check the conversion functions</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">StateSpace</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.05</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_ss</span><span class="s3">(), </span><span class="s1">StateSpace</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_tf</span><span class="s3">(), </span><span class="s1">TransferFunction</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_zpk</span><span class="s3">(), </span><span class="s1">ZerosPolesGain</span><span class="s3">))</span>

        <span class="s0"># Make sure copies work</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">StateSpace</span><span class="s3">(</span><span class="s1">s</span><span class="s3">) </span><span class="s2">is not </span><span class="s1">s</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_ss</span><span class="s3">() </span><span class="s2">is not </span><span class="s1">s</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_properties</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test setters/getters for cross class properties.</span>
        <span class="s0"># This implicitly tests to_tf() and to_zpk()</span>

        <span class="s0"># Getters</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">StateSpace</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.05</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">poles</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">, [</span><span class="s4">0</span><span class="s3">])</span>


<span class="s2">class </span><span class="s1">TestTransferFunction</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_initialization</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Check that all initializations work</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.05</span>
        <span class="s1">TransferFunction</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">TransferFunction</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">2</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">TransferFunction</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">]), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">2</span><span class="s3">]), </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">TransferFunction</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_conversion</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Check the conversion functions</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.05</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_ss</span><span class="s3">(), </span><span class="s1">StateSpace</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_tf</span><span class="s3">(), </span><span class="s1">TransferFunction</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_zpk</span><span class="s3">(), </span><span class="s1">ZerosPolesGain</span><span class="s3">))</span>

        <span class="s0"># Make sure copies work</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">TransferFunction</span><span class="s3">(</span><span class="s1">s</span><span class="s3">) </span><span class="s2">is not </span><span class="s1">s</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_tf</span><span class="s3">() </span><span class="s2">is not </span><span class="s1">s</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_properties</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test setters/getters for cross class properties.</span>
        <span class="s0"># This implicitly tests to_ss() and to_zpk()</span>

        <span class="s0"># Getters</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.05</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">poles</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">, [</span><span class="s4">0</span><span class="s3">])</span>


<span class="s2">class </span><span class="s1">TestZerosPolesGain</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_initialization</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Check that all initializations work</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.05</span>
        <span class="s1">ZerosPolesGain</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">ZerosPolesGain</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">2</span><span class="s3">], </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">ZerosPolesGain</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">]), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">2</span><span class="s3">]), </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">ZerosPolesGain</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_conversion</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Check the conversion functions</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">ZerosPolesGain</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.05</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_ss</span><span class="s3">(), </span><span class="s1">StateSpace</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_tf</span><span class="s3">(), </span><span class="s1">TransferFunction</span><span class="s3">))</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_zpk</span><span class="s3">(), </span><span class="s1">ZerosPolesGain</span><span class="s3">))</span>

        <span class="s0"># Make sure copies work</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">ZerosPolesGain</span><span class="s3">(</span><span class="s1">s</span><span class="s3">) </span><span class="s2">is not </span><span class="s1">s</span><span class="s3">)</span>
        <span class="s1">assert_</span><span class="s3">(</span><span class="s1">s</span><span class="s3">.</span><span class="s1">to_zpk</span><span class="s3">() </span><span class="s2">is not </span><span class="s1">s</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">Test_dfreqresp</span><span class="s3">:</span>

    <span class="s2">def </span><span class="s1">test_manual</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test dfreqresp() real part calculation (manual sanity check).</span>
        <span class="s0"># 1st order low-pass filter: H(z) = 1 / (z - 0.2),</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">0.2</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.1</span><span class="s3">)</span>
        <span class="s1">w </span><span class="s3">= [</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">]</span>
        <span class="s1">w</span><span class="s3">, </span><span class="s1">H </span><span class="s3">= </span><span class="s1">dfreqresp</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>

        <span class="s0"># test real</span>
        <span class="s1">expected_re </span><span class="s3">= [</span><span class="s4">1.2383</span><span class="s3">, </span><span class="s4">0.4130</span><span class="s3">, -</span><span class="s4">0.7553</span><span class="s3">]</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">.</span><span class="s1">real</span><span class="s3">, </span><span class="s1">expected_re</span><span class="s3">, </span><span class="s1">decimal</span><span class="s3">=</span><span class="s4">4</span><span class="s3">)</span>

        <span class="s0"># test imag</span>
        <span class="s1">expected_im </span><span class="s3">= [-</span><span class="s4">0.1555</span><span class="s3">, -</span><span class="s4">1.0214</span><span class="s3">, </span><span class="s4">0.3955</span><span class="s3">]</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">.</span><span class="s1">imag</span><span class="s3">, </span><span class="s1">expected_im</span><span class="s3">, </span><span class="s1">decimal</span><span class="s3">=</span><span class="s4">4</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_auto</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test dfreqresp() real part calculation.</span>
        <span class="s0"># 1st order low-pass filter: H(z) = 1 / (z - 0.2),</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">0.2</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.1</span><span class="s3">)</span>
        <span class="s1">w </span><span class="s3">= [</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">100</span><span class="s3">]</span>
        <span class="s1">w</span><span class="s3">, </span><span class="s1">H </span><span class="s3">= </span><span class="s1">dfreqresp</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s1">jw </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">exp</span><span class="s3">(</span><span class="s1">w </span><span class="s3">* </span><span class="s4">1j</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">polyval</span><span class="s3">(</span><span class="s1">system</span><span class="s3">.</span><span class="s1">num</span><span class="s3">, </span><span class="s1">jw</span><span class="s3">) / </span><span class="s1">np</span><span class="s3">.</span><span class="s1">polyval</span><span class="s3">(</span><span class="s1">system</span><span class="s3">.</span><span class="s1">den</span><span class="s3">, </span><span class="s1">jw</span><span class="s3">)</span>

        <span class="s0"># test real</span>
        <span class="s1">expected_re </span><span class="s3">= </span><span class="s1">y</span><span class="s3">.</span><span class="s1">real</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">.</span><span class="s1">real</span><span class="s3">, </span><span class="s1">expected_re</span><span class="s3">)</span>

        <span class="s0"># test imag</span>
        <span class="s1">expected_im </span><span class="s3">= </span><span class="s1">y</span><span class="s3">.</span><span class="s1">imag</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">H</span><span class="s3">.</span><span class="s1">imag</span><span class="s3">, </span><span class="s1">expected_im</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_freq_range</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test that freqresp() finds a reasonable frequency range.</span>
        <span class="s0"># 1st order low-pass filter: H(z) = 1 / (z - 0.2),</span>
        <span class="s0"># Expected range is from 0.01 to 10.</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">0.2</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.1</span><span class="s3">)</span>
        <span class="s1">n </span><span class="s3">= </span><span class="s4">10</span>
        <span class="s1">expected_w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s1">endpoint</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
        <span class="s1">w</span><span class="s3">, </span><span class="s1">H </span><span class="s3">= </span><span class="s1">dfreqresp</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s1">n</span><span class="s3">)</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">w</span><span class="s3">, </span><span class="s1">expected_w</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_pole_one</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test that freqresp() doesn't fail on a system with a pole at 0.</span>
        <span class="s0"># integrator, pole at zero: H(s) = 1 / s</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.1</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">sup</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">RuntimeWarning</span><span class="s3">, </span><span class="s1">message</span><span class="s3">=</span><span class="s5">&quot;divide by zero&quot;</span><span class="s3">)</span>
            <span class="s1">sup</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">RuntimeWarning</span><span class="s3">, </span><span class="s1">message</span><span class="s3">=</span><span class="s5">&quot;invalid value encountered&quot;</span><span class="s3">)</span>
            <span class="s1">w</span><span class="s3">, </span><span class="s1">H </span><span class="s3">= </span><span class="s1">dfreqresp</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">w</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s4">0.</span><span class="s3">)  </span><span class="s0"># a fail would give not-a-number</span>

    <span class="s2">def </span><span class="s1">test_error</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Raise an error for continuous-time systems</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">lti</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">dfreqresp</span><span class="s3">, </span><span class="s1">system</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_from_state_space</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># H(z) = 2 / z^3 - 0.5 * z^2</span>

        <span class="s1">system_TF </span><span class="s3">= </span><span class="s1">dlti</span><span class="s3">([</span><span class="s4">2</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">])</span>

        <span class="s1">A </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]])</span>
        <span class="s1">B </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]).</span><span class="s1">T</span>
        <span class="s1">C </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">]])</span>
        <span class="s1">D </span><span class="s3">= </span><span class="s4">0</span>

        <span class="s1">system_SS </span><span class="s3">= </span><span class="s1">dlti</span><span class="s3">(</span><span class="s1">A</span><span class="s3">, </span><span class="s1">B</span><span class="s3">, </span><span class="s1">C</span><span class="s3">, </span><span class="s1">D</span><span class="s3">)</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s4">10.0</span><span class="s3">**</span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(-</span><span class="s4">3</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">.5</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">sup</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">BadCoefficients</span><span class="s3">)</span>
            <span class="s1">w1</span><span class="s3">, </span><span class="s1">H1 </span><span class="s3">= </span><span class="s1">dfreqresp</span><span class="s3">(</span><span class="s1">system_TF</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
            <span class="s1">w2</span><span class="s3">, </span><span class="s1">H2 </span><span class="s3">= </span><span class="s1">dfreqresp</span><span class="s3">(</span><span class="s1">system_SS</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>

        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">H1</span><span class="s3">, </span><span class="s1">H2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_from_zpk</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># 1st order low-pass filter: H(s) = 0.3 / (z - 0.2),</span>
        <span class="s1">system_ZPK </span><span class="s3">= </span><span class="s1">dlti</span><span class="s3">([],[</span><span class="s4">0.2</span><span class="s3">],</span><span class="s4">0.3</span><span class="s3">)</span>
        <span class="s1">system_TF </span><span class="s3">= </span><span class="s1">dlti</span><span class="s3">(</span><span class="s4">0.3</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">0.2</span><span class="s3">])</span>
        <span class="s1">w </span><span class="s3">= [</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">100</span><span class="s3">]</span>
        <span class="s1">w1</span><span class="s3">, </span><span class="s1">H1 </span><span class="s3">= </span><span class="s1">dfreqresp</span><span class="s3">(</span><span class="s1">system_ZPK</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s1">w2</span><span class="s3">, </span><span class="s1">H2 </span><span class="s3">= </span><span class="s1">dfreqresp</span><span class="s3">(</span><span class="s1">system_TF</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">H1</span><span class="s3">, </span><span class="s1">H2</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">Test_bode</span><span class="s3">:</span>

    <span class="s2">def </span><span class="s1">test_manual</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test bode() magnitude calculation (manual sanity check).</span>
        <span class="s0"># 1st order low-pass filter: H(s) = 0.3 / (z - 0.2),</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.1</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">(</span><span class="s4">0.3</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">0.2</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">w </span><span class="s3">= [</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span><span class="s3">]</span>
        <span class="s1">w2</span><span class="s3">, </span><span class="s1">mag</span><span class="s3">, </span><span class="s1">phase </span><span class="s3">= </span><span class="s1">dbode</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>

        <span class="s0"># Test mag</span>
        <span class="s1">expected_mag </span><span class="s3">= [-</span><span class="s4">8.5329</span><span class="s3">, -</span><span class="s4">8.8396</span><span class="s3">, -</span><span class="s4">9.6162</span><span class="s3">, -</span><span class="s4">12.0412</span><span class="s3">]</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">mag</span><span class="s3">, </span><span class="s1">expected_mag</span><span class="s3">, </span><span class="s1">decimal</span><span class="s3">=</span><span class="s4">4</span><span class="s3">)</span>

        <span class="s0"># Test phase</span>
        <span class="s1">expected_phase </span><span class="s3">= [-</span><span class="s4">7.1575</span><span class="s3">, -</span><span class="s4">35.2814</span><span class="s3">, -</span><span class="s4">67.9809</span><span class="s3">, -</span><span class="s4">180.0000</span><span class="s3">]</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">phase</span><span class="s3">, </span><span class="s1">expected_phase</span><span class="s3">, </span><span class="s1">decimal</span><span class="s3">=</span><span class="s4">4</span><span class="s3">)</span>

        <span class="s0"># Test frequency</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">w</span><span class="s3">) / </span><span class="s1">dt</span><span class="s3">, </span><span class="s1">w2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_auto</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test bode() magnitude calculation.</span>
        <span class="s0"># 1st order low-pass filter: H(s) = 0.3 / (z - 0.2),</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">(</span><span class="s4">0.3</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">0.2</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.1</span><span class="s3">)</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span><span class="s3">])</span>
        <span class="s1">w2</span><span class="s3">, </span><span class="s1">mag</span><span class="s3">, </span><span class="s1">phase </span><span class="s3">= </span><span class="s1">dbode</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s1">jw </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">exp</span><span class="s3">(</span><span class="s1">w </span><span class="s3">* </span><span class="s4">1j</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">polyval</span><span class="s3">(</span><span class="s1">system</span><span class="s3">.</span><span class="s1">num</span><span class="s3">, </span><span class="s1">jw</span><span class="s3">) / </span><span class="s1">np</span><span class="s3">.</span><span class="s1">polyval</span><span class="s3">(</span><span class="s1">system</span><span class="s3">.</span><span class="s1">den</span><span class="s3">, </span><span class="s1">jw</span><span class="s3">)</span>

        <span class="s0"># Test mag</span>
        <span class="s1">expected_mag </span><span class="s3">= </span><span class="s4">20.0 </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">log10</span><span class="s3">(</span><span class="s1">abs</span><span class="s3">(</span><span class="s1">y</span><span class="s3">))</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">mag</span><span class="s3">, </span><span class="s1">expected_mag</span><span class="s3">)</span>

        <span class="s0"># Test phase</span>
        <span class="s1">expected_phase </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">rad2deg</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">angle</span><span class="s3">(</span><span class="s1">y</span><span class="s3">))</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">phase</span><span class="s3">, </span><span class="s1">expected_phase</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_range</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test that bode() finds a reasonable frequency range.</span>
        <span class="s0"># 1st order low-pass filter: H(s) = 0.3 / (z - 0.2),</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s4">0.1</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">(</span><span class="s4">0.3</span><span class="s3">, [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">0.2</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.1</span><span class="s3">)</span>
        <span class="s1">n </span><span class="s3">= </span><span class="s4">10</span>
        <span class="s0"># Expected range is from 0.01 to 10.</span>
        <span class="s1">expected_w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span><span class="s3">, </span><span class="s1">n</span><span class="s3">, </span><span class="s1">endpoint</span><span class="s3">=</span><span class="s2">False</span><span class="s3">) / </span><span class="s1">dt</span>
        <span class="s1">w</span><span class="s3">, </span><span class="s1">mag</span><span class="s3">, </span><span class="s1">phase </span><span class="s3">= </span><span class="s1">dbode</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s1">n</span><span class="s3">)</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">w</span><span class="s3">, </span><span class="s1">expected_w</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_pole_one</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test that freqresp() doesn't fail on a system with a pole at 0.</span>
        <span class="s0"># integrator, pole at zero: H(s) = 1 / s</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.1</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">sup</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">RuntimeWarning</span><span class="s3">, </span><span class="s1">message</span><span class="s3">=</span><span class="s5">&quot;divide by zero&quot;</span><span class="s3">)</span>
            <span class="s1">sup</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">RuntimeWarning</span><span class="s3">, </span><span class="s1">message</span><span class="s3">=</span><span class="s5">&quot;invalid value encountered&quot;</span><span class="s3">)</span>
            <span class="s1">w</span><span class="s3">, </span><span class="s1">mag</span><span class="s3">, </span><span class="s1">phase </span><span class="s3">= </span><span class="s1">dbode</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">w</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s4">0.</span><span class="s3">)  </span><span class="s0"># a fail would give not-a-number</span>

    <span class="s2">def </span><span class="s1">test_imaginary</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># bode() should not fail on a system with pure imaginary poles.</span>
        <span class="s0"># The test passes if bode doesn't raise an exception.</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">100</span><span class="s3">], </span><span class="s1">dt</span><span class="s3">=</span><span class="s4">0.1</span><span class="s3">)</span>
        <span class="s1">dbode</span><span class="s3">(</span><span class="s1">system</span><span class="s3">, </span><span class="s1">n</span><span class="s3">=</span><span class="s4">2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_error</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Raise an error for continuous-time systems</span>
        <span class="s1">system </span><span class="s3">= </span><span class="s1">lti</span><span class="s3">([</span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">dbode</span><span class="s3">, </span><span class="s1">system</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestTransferFunctionZConversion</span><span class="s3">:</span>
    <span class="s6">&quot;&quot;&quot;Test private conversions between 'z' and 'z**-1' polynomials.&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">test_full</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Numerator and denominator same order</span>
        <span class="s1">num </span><span class="s3">= [</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">]</span>
        <span class="s1">den </span><span class="s3">= [</span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">]</span>
        <span class="s1">num2</span><span class="s3">, </span><span class="s1">den2 </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">.</span><span class="s1">_z_to_zinv</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">den</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">num2</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">den</span><span class="s3">, </span><span class="s1">den2</span><span class="s3">)</span>

        <span class="s1">num2</span><span class="s3">, </span><span class="s1">den2 </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">.</span><span class="s1">_zinv_to_z</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">den</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">num2</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">den</span><span class="s3">, </span><span class="s1">den2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_numerator</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Numerator lower order than denominator</span>
        <span class="s1">num </span><span class="s3">= [</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">den </span><span class="s3">= [</span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">7</span><span class="s3">]</span>
        <span class="s1">num2</span><span class="s3">, </span><span class="s1">den2 </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">.</span><span class="s1">_z_to_zinv</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">den</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">], </span><span class="s1">num2</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">den</span><span class="s3">, </span><span class="s1">den2</span><span class="s3">)</span>

        <span class="s1">num2</span><span class="s3">, </span><span class="s1">den2 </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">.</span><span class="s1">_zinv_to_z</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">den</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">([</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], </span><span class="s1">num2</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">den</span><span class="s3">, </span><span class="s1">den2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_denominator</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Numerator higher order than denominator</span>
        <span class="s1">num </span><span class="s3">= [</span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">]</span>
        <span class="s1">den </span><span class="s3">= [</span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">]</span>
        <span class="s1">num2</span><span class="s3">, </span><span class="s1">den2 </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">.</span><span class="s1">_z_to_zinv</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">den</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">num2</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">], </span><span class="s1">den2</span><span class="s3">)</span>

        <span class="s1">num2</span><span class="s3">, </span><span class="s1">den2 </span><span class="s3">= </span><span class="s1">TransferFunction</span><span class="s3">.</span><span class="s1">_zinv_to_z</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">den</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">num</span><span class="s3">, </span><span class="s1">num2</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">([</span><span class="s4">5</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">0</span><span class="s3">], </span><span class="s1">den2</span><span class="s3">)</span>

</pre>
</body>
</html>