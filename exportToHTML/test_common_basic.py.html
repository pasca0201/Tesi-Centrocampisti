<html>
<head>
<title>test_common_basic.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
.s7 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_common_basic.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests that work on both the Python and C engines but do not have a 
specific classification into the other test modules. 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">datetime</span>
<span class="s2">from </span><span class="s1">inspect </span><span class="s2">import </span><span class="s1">signature</span>
<span class="s2">from </span><span class="s1">io </span><span class="s2">import </span><span class="s1">StringIO</span>
<span class="s2">import </span><span class="s1">os</span>
<span class="s2">from </span><span class="s1">pathlib </span><span class="s2">import </span><span class="s1">Path</span>
<span class="s2">import </span><span class="s1">sys</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">EmptyDataError</span><span class="s3">,</span>
    <span class="s1">ParserError</span><span class="s3">,</span>
    <span class="s1">ParserWarning</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">DataFrame</span><span class="s3">,</span>
    <span class="s1">Index</span><span class="s3">,</span>
    <span class="s1">Timestamp</span><span class="s3">,</span>
    <span class="s1">compat</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_testing </span><span class="s2">as </span><span class="s1">tm</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">parsers </span><span class="s2">import </span><span class="s1">TextFileReader</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.</span><span class="s1">parsers</span><span class="s3">.</span><span class="s1">c_parser_wrapper </span><span class="s2">import </span><span class="s1">CParserWrapper</span>

<span class="s1">pytestmark </span><span class="s3">= </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span>
    <span class="s4">&quot;ignore:Passing a BlockManager to DataFrame:DeprecationWarning&quot;</span>
<span class="s3">)</span>

<span class="s1">xfail_pyarrow </span><span class="s3">= </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">usefixtures</span><span class="s3">(</span><span class="s4">&quot;pyarrow_xfail&quot;</span><span class="s3">)</span>
<span class="s1">skip_pyarrow </span><span class="s3">= </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">usefixtures</span><span class="s3">(</span><span class="s4">&quot;pyarrow_skip&quot;</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_override_set_noconvert_columns</span><span class="s3">():</span>
    <span class="s5"># see gh-17351</span>
    <span class="s5">#</span>
    <span class="s5"># Usecols needs to be sorted in _set_noconvert_columns based</span>
    <span class="s5"># on the test_usecols_with_parse_dates test from test_usecols.py</span>
    <span class="s2">class </span><span class="s1">MyTextFileReader</span><span class="s3">(</span><span class="s1">TextFileReader</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_currow </span><span class="s3">= </span><span class="s6">0</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">squeeze </span><span class="s3">= </span><span class="s2">False</span>

    <span class="s2">class </span><span class="s1">MyCParserWrapper</span><span class="s3">(</span><span class="s1">CParserWrapper</span><span class="s3">):</span>
        <span class="s2">def </span><span class="s1">_set_noconvert_columns</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">usecols_dtype </span><span class="s3">== </span><span class="s4">&quot;integer&quot;</span><span class="s3">:</span>
                <span class="s5"># self.usecols is a set, which is documented as unordered</span>
                <span class="s5"># but in practice, a CPython set of integers is sorted.</span>
                <span class="s5"># In other implementations this assumption does not hold.</span>
                <span class="s5"># The following code simulates a different order, which</span>
                <span class="s5"># before GH 17351 would cause the wrong columns to be</span>
                <span class="s5"># converted via the parse_dates parameter</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">usecols </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">usecols</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">usecols</span><span class="s3">.</span><span class="s1">reverse</span><span class="s3">()</span>
            <span class="s2">return </span><span class="s1">CParserWrapper</span><span class="s3">.</span><span class="s1">_set_noconvert_columns</span><span class="s3">(</span><span class="s1">self</span><span class="s3">)</span>

    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;a,b,c,d,e 
0,1,2014-01-01,09:00,4 
0,1,2014-01-02,10:00,4&quot;&quot;&quot;</span>

    <span class="s1">parse_dates </span><span class="s3">= [[</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">]]</span>
    <span class="s1">cols </span><span class="s3">= {</span>
        <span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">],</span>
        <span class="s4">&quot;c_d&quot;</span><span class="s3">: [</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2014-01-01 09:00:00&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2014-01-02 10:00:00&quot;</span><span class="s3">)],</span>
    <span class="s3">}</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">cols</span><span class="s3">, </span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;c_d&quot;</span><span class="s3">, </span><span class="s4">&quot;a&quot;</span><span class="s3">])</span>

    <span class="s1">parser </span><span class="s3">= </span><span class="s1">MyTextFileReader</span><span class="s3">()</span>
    <span class="s1">parser</span><span class="s3">.</span><span class="s1">options </span><span class="s3">= {</span>
        <span class="s4">&quot;usecols&quot;</span><span class="s3">: [</span><span class="s6">0</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">],</span>
        <span class="s4">&quot;parse_dates&quot;</span><span class="s3">: </span><span class="s1">parse_dates</span><span class="s3">,</span>
        <span class="s4">&quot;delimiter&quot;</span><span class="s3">: </span><span class="s4">&quot;,&quot;</span><span class="s3">,</span>
    <span class="s3">}</span>
    <span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">= </span><span class="s4">&quot;c&quot;</span>
    <span class="s1">parser</span><span class="s3">.</span><span class="s1">_engine </span><span class="s3">= </span><span class="s1">MyCParserWrapper</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), **</span><span class="s1">parser</span><span class="s3">.</span><span class="s1">options</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read</span><span class="s3">()</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_csv_local</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">csv1</span><span class="s3">):</span>
    <span class="s1">prefix </span><span class="s3">= </span><span class="s4">&quot;file:///&quot; </span><span class="s2">if </span><span class="s1">compat</span><span class="s3">.</span><span class="s1">is_platform_windows</span><span class="s3">() </span><span class="s2">else </span><span class="s4">&quot;file://&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s1">fname </span><span class="s3">= </span><span class="s1">prefix </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">(</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">abspath</span><span class="s3">(</span><span class="s1">csv1</span><span class="s3">))</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">fname</span><span class="s3">, </span><span class="s1">index_col</span><span class="s3">=</span><span class="s6">0</span><span class="s3">, </span><span class="s1">parse_dates</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
    <span class="s5"># TODO: make unit check more specific</span>
    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">result</span><span class="s3">.</span><span class="s1">index </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">index</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s6">0.980269</span><span class="s3">, </span><span class="s6">3.685731</span><span class="s3">, -</span><span class="s6">0.364216805298</span><span class="s3">, -</span><span class="s6">1.159738</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s6">1.047916</span><span class="s3">, -</span><span class="s6">0.041232</span><span class="s3">, -</span><span class="s6">0.16181208307</span><span class="s3">, </span><span class="s6">0.212549</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s6">0.498581</span><span class="s3">, </span><span class="s6">0.731168</span><span class="s3">, -</span><span class="s6">0.537677223318</span><span class="s3">, </span><span class="s6">1.346270</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s6">1.120202</span><span class="s3">, </span><span class="s6">1.567621</span><span class="s3">, </span><span class="s6">0.00364077397681</span><span class="s3">, </span><span class="s6">0.675253</span><span class="s3">],</span>
            <span class="s3">[-</span><span class="s6">0.487094</span><span class="s3">, </span><span class="s6">0.571455</span><span class="s3">, -</span><span class="s6">1.6116394093</span><span class="s3">, </span><span class="s6">0.103469</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s6">0.836649</span><span class="s3">, </span><span class="s6">0.246462</span><span class="s3">, </span><span class="s6">0.588542635376</span><span class="s3">, </span><span class="s6">1.062782</span><span class="s3">],</span>
            <span class="s3">[-</span><span class="s6">0.157161</span><span class="s3">, </span><span class="s6">1.340307</span><span class="s3">, </span><span class="s6">1.1957779562</span><span class="s3">, -</span><span class="s6">1.097007</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">],</span>
        <span class="s1">index</span><span class="s3">=</span><span class="s1">Index</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">3</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">4</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">5</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">6</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">7</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">10</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">11</span><span class="s3">),</span>
            <span class="s3">],</span>
            <span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;index&quot;</span><span class="s3">,</span>
        <span class="s3">),</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_1000_sep</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;A|B|C 
1|2,334|5 
10|13|10. 
&quot;&quot;&quot;</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;A&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">10</span><span class="s3">], </span><span class="s4">&quot;B&quot;</span><span class="s3">: [</span><span class="s6">2334</span><span class="s3">, </span><span class="s6">13</span><span class="s3">], </span><span class="s4">&quot;C&quot;</span><span class="s3">: [</span><span class="s6">5</span><span class="s3">, </span><span class="s6">10.0</span><span class="s3">]})</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'thousands' option is not supported with the 'pyarrow' engine&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">&quot;|&quot;</span><span class="s3">, </span><span class="s1">thousands</span><span class="s3">=</span><span class="s4">&quot;,&quot;</span><span class="s3">)</span>
        <span class="s2">return</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">&quot;|&quot;</span><span class="s3">, </span><span class="s1">thousands</span><span class="s3">=</span><span class="s4">&quot;,&quot;</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">xfail_pyarrow  </span><span class="s5"># ValueError: Found non-unique column index</span>
<span class="s2">def </span><span class="s1">test_unnamed_columns</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;A,B,C,, 
1,2,3,4,5 
6,7,8,9,10 
11,12,13,14,15 
&quot;&quot;&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[[</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">5</span><span class="s3">], [</span><span class="s6">6</span><span class="s3">, </span><span class="s6">7</span><span class="s3">, </span><span class="s6">8</span><span class="s3">, </span><span class="s6">9</span><span class="s3">, </span><span class="s6">10</span><span class="s3">], [</span><span class="s6">11</span><span class="s3">, </span><span class="s6">12</span><span class="s3">, </span><span class="s6">13</span><span class="s3">, </span><span class="s6">14</span><span class="s3">, </span><span class="s6">15</span><span class="s3">]],</span>
        <span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">,</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;Unnamed: 3&quot;</span><span class="s3">, </span><span class="s4">&quot;Unnamed: 4&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_csv_mixed_type</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;A,B,C 
a,1,2 
b,3,4 
c,4,5 
&quot;&quot;&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;A&quot;</span><span class="s3">: [</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">], </span><span class="s4">&quot;B&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">4</span><span class="s3">], </span><span class="s4">&quot;C&quot;</span><span class="s3">: [</span><span class="s6">2</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">5</span><span class="s3">]})</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_csv_low_memory_no_rows_with_index</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see gh-21141</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s2">if not </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">low_memory</span><span class="s3">:</span>
        <span class="s1">pytest</span><span class="s3">.</span><span class="s1">skip</span><span class="s3">(</span><span class="s4">&quot;This is a low-memory specific test&quot;</span><span class="s3">)</span>

    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;A,B,C 
1,1,1,2 
2,2,3,4 
3,3,4,5 
&quot;&quot;&quot;</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'nrows' option is not supported with the 'pyarrow' engine&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">low_memory</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">index_col</span><span class="s3">=</span><span class="s6">0</span><span class="s3">, </span><span class="s1">nrows</span><span class="s3">=</span><span class="s6">0</span><span class="s3">)</span>
        <span class="s2">return</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">low_memory</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">index_col</span><span class="s3">=</span><span class="s6">0</span><span class="s3">, </span><span class="s1">nrows</span><span class="s3">=</span><span class="s6">0</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">])</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_csv_dataframe</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">csv1</span><span class="s3">):</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">csv1</span><span class="s3">, </span><span class="s1">index_col</span><span class="s3">=</span><span class="s6">0</span><span class="s3">, </span><span class="s1">parse_dates</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
    <span class="s5"># TODO: make unit check more specific</span>
    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">result</span><span class="s3">.</span><span class="s1">index </span><span class="s3">= </span><span class="s1">result</span><span class="s3">.</span><span class="s1">index</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s6">0.980269</span><span class="s3">, </span><span class="s6">3.685731</span><span class="s3">, -</span><span class="s6">0.364216805298</span><span class="s3">, -</span><span class="s6">1.159738</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s6">1.047916</span><span class="s3">, -</span><span class="s6">0.041232</span><span class="s3">, -</span><span class="s6">0.16181208307</span><span class="s3">, </span><span class="s6">0.212549</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s6">0.498581</span><span class="s3">, </span><span class="s6">0.731168</span><span class="s3">, -</span><span class="s6">0.537677223318</span><span class="s3">, </span><span class="s6">1.346270</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s6">1.120202</span><span class="s3">, </span><span class="s6">1.567621</span><span class="s3">, </span><span class="s6">0.00364077397681</span><span class="s3">, </span><span class="s6">0.675253</span><span class="s3">],</span>
            <span class="s3">[-</span><span class="s6">0.487094</span><span class="s3">, </span><span class="s6">0.571455</span><span class="s3">, -</span><span class="s6">1.6116394093</span><span class="s3">, </span><span class="s6">0.103469</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s6">0.836649</span><span class="s3">, </span><span class="s6">0.246462</span><span class="s3">, </span><span class="s6">0.588542635376</span><span class="s3">, </span><span class="s6">1.062782</span><span class="s3">],</span>
            <span class="s3">[-</span><span class="s6">0.157161</span><span class="s3">, </span><span class="s6">1.340307</span><span class="s3">, </span><span class="s6">1.1957779562</span><span class="s3">, -</span><span class="s6">1.097007</span><span class="s3">],</span>
        <span class="s3">],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">],</span>
        <span class="s1">index</span><span class="s3">=</span><span class="s1">Index</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">3</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">4</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">5</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">6</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">7</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">10</span><span class="s3">),</span>
                <span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">11</span><span class="s3">),</span>
            <span class="s3">],</span>
            <span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;index&quot;</span><span class="s3">,</span>
        <span class="s3">),</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;nrows&quot;</span><span class="s3">, [</span><span class="s6">3</span><span class="s3">, </span><span class="s6">3.0</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_read_nrows</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">nrows</span><span class="s3">):</span>
    <span class="s5"># see gh-10476</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;index,A,B,C,D 
foo,2,3,4,5 
bar,7,8,9,10 
baz,12,13,14,15 
qux,12,13,14,15 
foo2,12,13,14,15 
bar2,12,13,14,15 
&quot;&quot;&quot;</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[[</span><span class="s4">&quot;foo&quot;</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">5</span><span class="s3">], [</span><span class="s4">&quot;bar&quot;</span><span class="s3">, </span><span class="s6">7</span><span class="s3">, </span><span class="s6">8</span><span class="s3">, </span><span class="s6">9</span><span class="s3">, </span><span class="s6">10</span><span class="s3">], [</span><span class="s4">&quot;baz&quot;</span><span class="s3">, </span><span class="s6">12</span><span class="s3">, </span><span class="s6">13</span><span class="s3">, </span><span class="s6">14</span><span class="s3">, </span><span class="s6">15</span><span class="s3">]],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;index&quot;</span><span class="s3">, </span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'nrows' option is not supported with the 'pyarrow' engine&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">nrows</span><span class="s3">=</span><span class="s1">nrows</span><span class="s3">)</span>
        <span class="s2">return</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">nrows</span><span class="s3">=</span><span class="s1">nrows</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;nrows&quot;</span><span class="s3">, [</span><span class="s6">1.2</span><span class="s3">, </span><span class="s4">&quot;foo&quot;</span><span class="s3">, -</span><span class="s6">1</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_read_nrows_bad</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">nrows</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;index,A,B,C,D 
foo,2,3,4,5 
bar,7,8,9,10 
baz,12,13,14,15 
qux,12,13,14,15 
foo2,12,13,14,15 
bar2,12,13,14,15 
&quot;&quot;&quot;</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s4">r&quot;'nrows' must be an integer &gt;=0&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'nrows' option is not supported with the 'pyarrow' engine&quot;</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">nrows</span><span class="s3">=</span><span class="s1">nrows</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_nrows_skipfooter_errors</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;'skipfooter' not supported with 'nrows'&quot;</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;a</span><span class="s2">\n</span><span class="s4">1</span><span class="s2">\n</span><span class="s4">2</span><span class="s2">\n</span><span class="s4">3</span><span class="s2">\n</span><span class="s4">4</span><span class="s2">\n</span><span class="s4">5</span><span class="s2">\n</span><span class="s4">6&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skipfooter</span><span class="s3">=</span><span class="s6">1</span><span class="s3">, </span><span class="s1">nrows</span><span class="s3">=</span><span class="s6">5</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_missing_trailing_delimiters</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;A,B,C,D 
1,2,3,4 
1,3,3, 
1,4,5&quot;&quot;&quot;</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[[</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">4</span><span class="s3">], [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">], [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">5</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]],</span>
        <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_skip_initial_space</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= (</span>
        <span class="s4">'&quot;09-Apr-2012&quot;, &quot;01:10:18.300&quot;, 2456026.548822908, 12849, '</span>
        <span class="s4">&quot;1.00361,  1.12551, 330.65659, 0355626618.16711,  73.48821, &quot;</span>
        <span class="s4">&quot;314.11625,  1917.09447,   179.71425,  80.000, 240.000, -350,  &quot;</span>
        <span class="s4">&quot;70.06056, 344.98370, 1,   1, -0.689265, -0.692787,  &quot;</span>
        <span class="s4">&quot;0.212036,    14.7674,   41.605,   -9999.0,   -9999.0,   &quot;</span>
        <span class="s4">&quot;-9999.0,   -9999.0,   -9999.0,  -9999.0, 000, 012, 128&quot;</span>
    <span class="s3">)</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'skipinitialspace' option is not supported with the 'pyarrow' engine&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span>
                <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
                <span class="s1">names</span><span class="s3">=</span><span class="s1">list</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s6">33</span><span class="s3">)),</span>
                <span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
                <span class="s1">na_values</span><span class="s3">=[</span><span class="s4">&quot;-9999.0&quot;</span><span class="s3">],</span>
                <span class="s1">skipinitialspace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s2">return</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
        <span class="s1">names</span><span class="s3">=</span><span class="s1">list</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s6">33</span><span class="s3">)),</span>
        <span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">na_values</span><span class="s3">=[</span><span class="s4">&quot;-9999.0&quot;</span><span class="s3">],</span>
        <span class="s1">skipinitialspace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s3">[</span>
                <span class="s4">&quot;09-Apr-2012&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;01:10:18.300&quot;</span><span class="s3">,</span>
                <span class="s6">2456026.548822908</span><span class="s3">,</span>
                <span class="s6">12849</span><span class="s3">,</span>
                <span class="s6">1.00361</span><span class="s3">,</span>
                <span class="s6">1.12551</span><span class="s3">,</span>
                <span class="s6">330.65659</span><span class="s3">,</span>
                <span class="s6">355626618.16711</span><span class="s3">,</span>
                <span class="s6">73.48821</span><span class="s3">,</span>
                <span class="s6">314.11625</span><span class="s3">,</span>
                <span class="s6">1917.09447</span><span class="s3">,</span>
                <span class="s6">179.71425</span><span class="s3">,</span>
                <span class="s6">80.0</span><span class="s3">,</span>
                <span class="s6">240.0</span><span class="s3">,</span>
                <span class="s3">-</span><span class="s6">350</span><span class="s3">,</span>
                <span class="s6">70.06056</span><span class="s3">,</span>
                <span class="s6">344.9837</span><span class="s3">,</span>
                <span class="s6">1</span><span class="s3">,</span>
                <span class="s6">1</span><span class="s3">,</span>
                <span class="s3">-</span><span class="s6">0.689265</span><span class="s3">,</span>
                <span class="s3">-</span><span class="s6">0.692787</span><span class="s3">,</span>
                <span class="s6">0.212036</span><span class="s3">,</span>
                <span class="s6">14.7674</span><span class="s3">,</span>
                <span class="s6">41.605</span><span class="s3">,</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">,</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">,</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">,</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">,</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">,</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">,</span>
                <span class="s6">0</span><span class="s3">,</span>
                <span class="s6">12</span><span class="s3">,</span>
                <span class="s6">128</span><span class="s3">,</span>
            <span class="s3">]</span>
        <span class="s3">]</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_trailing_delimiters</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see gh-2442</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;A,B,C 
1,2,3, 
4,5,6, 
7,8,9,&quot;&quot;&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">index_col</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;A&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">7</span><span class="s3">], </span><span class="s4">&quot;B&quot;</span><span class="s3">: [</span><span class="s6">2</span><span class="s3">, </span><span class="s6">5</span><span class="s3">, </span><span class="s6">8</span><span class="s3">], </span><span class="s4">&quot;C&quot;</span><span class="s3">: [</span><span class="s6">3</span><span class="s3">, </span><span class="s6">6</span><span class="s3">, </span><span class="s6">9</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_escapechar</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># https://stackoverflow.com/questions/13824840/feature-request-for-</span>
    <span class="s5"># pandas-read-csv</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">'''SEARCH_TERM,ACTUAL_URL 
&quot;bra tv board&quot;,&quot;http://www.ikea.com/se/sv/catalog/categories/departments/living_room/10475/?se%7cps%7cnonbranded%7cvardagsrum%7cgoogle%7ctv_bord&quot; 
&quot;tv p</span><span class="s2">\xc3\xa5 </span><span class="s4">hjul&quot;,&quot;http://www.ikea.com/se/sv/catalog/categories/departments/living_room/10475/?se%7cps%7cnonbranded%7cvardagsrum%7cgoogle%7ctv_bord&quot; 
&quot;SLAGBORD, </span><span class="s2">\\</span><span class="s4">&quot;Bergslagen</span><span class="s2">\\</span><span class="s4">&quot;, IKEA:s 1700-tals series&quot;,&quot;http://www.ikea.com/se/sv/catalog/categories/departments/living_room/10475/?se%7cps%7cnonbranded%7cvardagsrum%7cgoogle%7ctv_bord&quot;'''</span>

    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span>
        <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">escapechar</span><span class="s3">=</span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot;</span><span class="s3">, </span><span class="s1">quotechar</span><span class="s3">=</span><span class="s4">'&quot;'</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s4">&quot;utf-8&quot;</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">result</span><span class="s3">[</span><span class="s4">&quot;SEARCH_TERM&quot;</span><span class="s3">][</span><span class="s6">2</span><span class="s3">] == </span><span class="s4">'SLAGBORD, &quot;Bergslagen&quot;, IKEA:s 1700-tals series'</span>

    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">columns</span><span class="s3">, </span><span class="s1">Index</span><span class="s3">([</span><span class="s4">&quot;SEARCH_TERM&quot;</span><span class="s3">, </span><span class="s4">&quot;ACTUAL_URL&quot;</span><span class="s3">]))</span>


<span class="s2">def </span><span class="s1">test_ignore_leading_whitespace</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see gh-3374, gh-6607</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot; a b c</span><span class="s2">\n </span><span class="s4">1 2 3</span><span class="s2">\n </span><span class="s4">4 5 6</span><span class="s2">\n </span><span class="s4">7 8 9&quot;</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;the 'pyarrow' engine does not support regex separators&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">r&quot;\s+&quot;</span><span class="s3">)</span>
        <span class="s2">return</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">r&quot;\s+&quot;</span><span class="s3">)</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">7</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: [</span><span class="s6">2</span><span class="s3">, </span><span class="s6">5</span><span class="s3">, </span><span class="s6">8</span><span class="s3">], </span><span class="s4">&quot;c&quot;</span><span class="s3">: [</span><span class="s6">3</span><span class="s3">, </span><span class="s6">6</span><span class="s3">, </span><span class="s6">9</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;usecols&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, [</span><span class="s6">0</span><span class="s3">, </span><span class="s6">1</span><span class="s3">], [</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">]])</span>
<span class="s2">def </span><span class="s1">test_uneven_lines_with_usecols</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">usecols</span><span class="s3">):</span>
    <span class="s5"># see gh-12203</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">r&quot;&quot;&quot;a,b,c 
0,1,2 
3,4,5,6,7 
8,9,10&quot;&quot;&quot;</span>

    <span class="s2">if </span><span class="s1">usecols </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s5"># Make sure that an error is still raised</span>
        <span class="s5"># when the &quot;usecols&quot; parameter is not provided.</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">r&quot;Expected \d+ fields in line \d+, saw \d+&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ParserError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s6">0</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">8</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">9</span><span class="s3">]})</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">usecols</span><span class="s3">=</span><span class="s1">usecols</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;data,kwargs,expected&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s5"># First, check to see that the response of parser when faced with no</span>
        <span class="s5"># provided columns raises the correct error, with or without usecols.</span>
        <span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">, {}, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;&quot;</span><span class="s3">, {</span><span class="s4">&quot;usecols&quot;</span><span class="s3">: [</span><span class="s4">&quot;X&quot;</span><span class="s3">]}, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s4">&quot;,,&quot;</span><span class="s3">,</span>
            <span class="s3">{</span><span class="s4">&quot;names&quot;</span><span class="s3">: [</span><span class="s4">&quot;Dummy&quot;</span><span class="s3">, </span><span class="s4">&quot;X&quot;</span><span class="s3">, </span><span class="s4">&quot;Dummy_2&quot;</span><span class="s3">], </span><span class="s4">&quot;usecols&quot;</span><span class="s3">: [</span><span class="s4">&quot;X&quot;</span><span class="s3">]},</span>
            <span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;X&quot;</span><span class="s3">], </span><span class="s1">index</span><span class="s3">=[</span><span class="s6">0</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">),</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s4">&quot;&quot;</span><span class="s3">,</span>
            <span class="s3">{</span><span class="s4">&quot;names&quot;</span><span class="s3">: [</span><span class="s4">&quot;Dummy&quot;</span><span class="s3">, </span><span class="s4">&quot;X&quot;</span><span class="s3">, </span><span class="s4">&quot;Dummy_2&quot;</span><span class="s3">], </span><span class="s4">&quot;usecols&quot;</span><span class="s3">: [</span><span class="s4">&quot;X&quot;</span><span class="s3">]},</span>
            <span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;X&quot;</span><span class="s3">]),</span>
        <span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_read_empty_with_usecols</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">data</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
    <span class="s5"># see gh-12493</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s2">if </span><span class="s1">expected </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;No columns to parse from file&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">EmptyDataError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), **</span><span class="s1">kwargs</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), **</span><span class="s1">kwargs</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;kwargs,expected&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s5"># gh-8661, gh-8679: this should ignore six lines, including</span>
        <span class="s5"># lines with trailing whitespace and blank lines.</span>
        <span class="s3">(</span>
            <span class="s3">{</span>
                <span class="s4">&quot;header&quot;</span><span class="s3">: </span><span class="s2">None</span><span class="s3">,</span>
                <span class="s4">&quot;delim_whitespace&quot;</span><span class="s3">: </span><span class="s2">True</span><span class="s3">,</span>
                <span class="s4">&quot;skiprows&quot;</span><span class="s3">: [</span><span class="s6">0</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">5</span><span class="s3">, </span><span class="s6">6</span><span class="s3">],</span>
                <span class="s4">&quot;skip_blank_lines&quot;</span><span class="s3">: </span><span class="s2">True</span><span class="s3">,</span>
            <span class="s3">},</span>
            <span class="s1">DataFrame</span><span class="s3">([[</span><span class="s6">1.0</span><span class="s3">, </span><span class="s6">2.0</span><span class="s3">, </span><span class="s6">4.0</span><span class="s3">], [</span><span class="s6">5.1</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s6">10.0</span><span class="s3">]]),</span>
        <span class="s3">),</span>
        <span class="s5"># gh-8983: test skipping set of rows after a row with trailing spaces.</span>
        <span class="s3">(</span>
            <span class="s3">{</span>
                <span class="s4">&quot;delim_whitespace&quot;</span><span class="s3">: </span><span class="s2">True</span><span class="s3">,</span>
                <span class="s4">&quot;skiprows&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">5</span><span class="s3">, </span><span class="s6">6</span><span class="s3">],</span>
                <span class="s4">&quot;skip_blank_lines&quot;</span><span class="s3">: </span><span class="s2">True</span><span class="s3">,</span>
            <span class="s3">},</span>
            <span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;A&quot;</span><span class="s3">: [</span><span class="s6">1.0</span><span class="s3">, </span><span class="s6">5.1</span><span class="s3">], </span><span class="s4">&quot;B&quot;</span><span class="s3">: [</span><span class="s6">2.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">], </span><span class="s4">&quot;C&quot;</span><span class="s3">: [</span><span class="s6">4.0</span><span class="s3">, </span><span class="s6">10</span><span class="s3">]}),</span>
        <span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_trailing_spaces</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;A B C  </span><span class="s2">\n</span><span class="s4">random line with trailing spaces    </span><span class="s2">\n</span><span class="s4">skip</span><span class="s2">\n</span><span class="s4">1,2,3</span><span class="s2">\n</span><span class="s4">1,2.,4.</span><span class="s2">\n</span><span class="s4">random line with trailing tabs</span><span class="s2">\t\t\t\n   \n</span><span class="s4">5.1,NaN,10.0</span><span class="s2">\n</span><span class="s4">&quot;  </span><span class="s5"># noqa: E501</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s1">depr_msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' keyword in pd.read_csv is deprecated&quot;</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' option is not supported with the 'pyarrow' engine&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
                <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
            <span class="s3">):</span>
                <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;  &quot;</span><span class="s3">)), **</span><span class="s1">kwargs</span><span class="s3">)</span>
        <span class="s2">return</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
        <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
    <span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;  &quot;</span><span class="s3">)), **</span><span class="s1">kwargs</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_raise_on_sep_with_delim_whitespace</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see gh-6607</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;a b c</span><span class="s2">\n</span><span class="s4">1 2 3&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s1">depr_msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' keyword in pd.read_csv is deprecated&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;you can only specify one&quot;</span><span class="s3">):</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
            <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
        <span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">r&quot;\s&quot;</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_filepath_or_buffer</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see gh-43366</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;Expected file path name or file-like&quot;</span><span class="s3">):</span>
        <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">filepath_or_buffer</span><span class="s3">=</span><span class="s7">b&quot;input&quot;</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;delim_whitespace&quot;</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_single_char_leading_whitespace</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">):</span>
    <span class="s5"># see gh-9710</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">MyColumn 
a 
b 
a 
b</span><span class="s2">\n</span><span class="s4">&quot;&quot;&quot;</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;MyColumn&quot;</span><span class="s3">: </span><span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;abab&quot;</span><span class="s3">)})</span>
    <span class="s1">depr_msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' keyword in pd.read_csv is deprecated&quot;</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'skipinitialspace' option is not supported with the 'pyarrow' engine&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
                <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
            <span class="s3">):</span>
                <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span>
                    <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">),</span>
                    <span class="s1">skipinitialspace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">,</span>
                    <span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s1">delim_whitespace</span><span class="s3">,</span>
                <span class="s3">)</span>
        <span class="s2">return</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
        <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
    <span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span>
            <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skipinitialspace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s1">delim_whitespace</span>
        <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;sep,skip_blank_lines,exp_data&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, [[</span><span class="s6">1.0</span><span class="s3">, </span><span class="s6">2.0</span><span class="s3">, </span><span class="s6">4.0</span><span class="s3">], [</span><span class="s6">5.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s6">10.0</span><span class="s3">], [-</span><span class="s6">70.0</span><span class="s3">, </span><span class="s6">0.4</span><span class="s3">, </span><span class="s6">1.0</span><span class="s3">]]),</span>
        <span class="s3">(</span><span class="s4">r&quot;\s+&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, [[</span><span class="s6">1.0</span><span class="s3">, </span><span class="s6">2.0</span><span class="s3">, </span><span class="s6">4.0</span><span class="s3">], [</span><span class="s6">5.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s6">10.0</span><span class="s3">], [-</span><span class="s6">70.0</span><span class="s3">, </span><span class="s6">0.4</span><span class="s3">, </span><span class="s6">1.0</span><span class="s3">]]),</span>
        <span class="s3">(</span>
            <span class="s4">&quot;,&quot;</span><span class="s3">,</span>
            <span class="s2">False</span><span class="s3">,</span>
            <span class="s3">[</span>
                <span class="s3">[</span><span class="s6">1.0</span><span class="s3">, </span><span class="s6">2.0</span><span class="s3">, </span><span class="s6">4.0</span><span class="s3">],</span>
                <span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">],</span>
                <span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">],</span>
                <span class="s3">[</span><span class="s6">5.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s6">10.0</span><span class="s3">],</span>
                <span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">],</span>
                <span class="s3">[-</span><span class="s6">70.0</span><span class="s3">, </span><span class="s6">0.4</span><span class="s3">, </span><span class="s6">1.0</span><span class="s3">],</span>
            <span class="s3">],</span>
        <span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_empty_lines</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">sep</span><span class="s3">, </span><span class="s1">skip_blank_lines</span><span class="s3">, </span><span class="s1">exp_data</span><span class="s3">, </span><span class="s1">request</span><span class="s3">):</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s4">A,B,C 
1,2.,4. 
 
 
5.,NaN,10.0 
 
-70,.4,1 
&quot;&quot;&quot;</span>

    <span class="s2">if </span><span class="s1">sep </span><span class="s3">== </span><span class="s4">r&quot;\s+&quot;</span><span class="s3">:</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">data</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;  &quot;</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
            <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;the 'pyarrow' engine does not support regex separators&quot;</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span>
                    <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s1">sep</span><span class="s3">, </span><span class="s1">skip_blank_lines</span><span class="s3">=</span><span class="s1">skip_blank_lines</span>
                <span class="s3">)</span>
            <span class="s2">return</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s1">sep</span><span class="s3">, </span><span class="s1">skip_blank_lines</span><span class="s3">=</span><span class="s1">skip_blank_lines</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">exp_data</span><span class="s3">, </span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">])</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_whitespace_lines</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot; 
 
</span><span class="s2">\t  \t\t</span>
<span class="s2">\t</span>
<span class="s4">A,B,C 
</span><span class="s2">\t    </span><span class="s4">1,2.,4. 
5.,NaN,10.0 
&quot;&quot;&quot;</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([[</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2.0</span><span class="s3">, </span><span class="s6">4.0</span><span class="s3">], [</span><span class="s6">5.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s6">10.0</span><span class="s3">]], </span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">])</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;data,expected&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span>
            <span class="s4">&quot;&quot;&quot;   A   B   C   D 
a   1   2   3   4 
b   1   2   3   4 
c   1   2   3   4 
&quot;&quot;&quot;</span><span class="s3">,</span>
            <span class="s1">DataFrame</span><span class="s3">(</span>
                <span class="s3">[[</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">4</span><span class="s3">], [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">4</span><span class="s3">], [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">, </span><span class="s6">4</span><span class="s3">]],</span>
                <span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;A&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s4">&quot;C&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">],</span>
                <span class="s1">index</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">],</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
        <span class="s3">(</span>
            <span class="s4">&quot;    a b c</span><span class="s2">\n</span><span class="s4">1 2 3 </span><span class="s2">\n</span><span class="s4">4 5  6</span><span class="s2">\n </span><span class="s4">7 8 9&quot;</span><span class="s3">,</span>
            <span class="s1">DataFrame</span><span class="s3">([[</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">], [</span><span class="s6">4</span><span class="s3">, </span><span class="s6">5</span><span class="s3">, </span><span class="s6">6</span><span class="s3">], [</span><span class="s6">7</span><span class="s3">, </span><span class="s6">8</span><span class="s3">, </span><span class="s6">9</span><span class="s3">]], </span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">]),</span>
        <span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_whitespace_regex_separator</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">data</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
    <span class="s5"># see gh-6607</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;the 'pyarrow' engine does not support regex separators&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">r&quot;\s+&quot;</span><span class="s3">)</span>
        <span class="s2">return</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">r&quot;\s+&quot;</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_sub_character</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">csv_dir_path</span><span class="s3">):</span>
    <span class="s5"># see gh-16893</span>
    <span class="s1">filename </span><span class="s3">= </span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">csv_dir_path</span><span class="s3">, </span><span class="s4">&quot;sub_char.csv&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([[</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">]], </span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s2">\x1a</span><span class="s4">b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">])</span>

    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;filename&quot;</span><span class="s3">, [</span><span class="s4">&quot;sé-es-vé.csv&quot;</span><span class="s3">, </span><span class="s4">&quot;ru-sй.csv&quot;</span><span class="s3">, </span><span class="s4">&quot;中文文件名.csv&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_filename_with_special_chars</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">filename</span><span class="s3">):</span>
    <span class="s5"># see gh-15086.</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">df </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">]})</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">ensure_clean</span><span class="s3">(</span><span class="s1">filename</span><span class="s3">) </span><span class="s2">as </span><span class="s1">path</span><span class="s3">:</span>
        <span class="s1">df</span><span class="s3">.</span><span class="s1">to_csv</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">index</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">df</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_table_same_signature_as_read_csv</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH-34976</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s1">table_sign </span><span class="s3">= </span><span class="s1">signature</span><span class="s3">(</span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_table</span><span class="s3">)</span>
    <span class="s1">csv_sign </span><span class="s3">= </span><span class="s1">signature</span><span class="s3">(</span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">table_sign</span><span class="s3">.</span><span class="s1">parameters</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">() == </span><span class="s1">csv_sign</span><span class="s3">.</span><span class="s1">parameters</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()</span>
    <span class="s2">assert </span><span class="s1">table_sign</span><span class="s3">.</span><span class="s1">return_annotation </span><span class="s3">== </span><span class="s1">csv_sign</span><span class="s3">.</span><span class="s1">return_annotation</span>

    <span class="s2">for </span><span class="s1">key</span><span class="s3">, </span><span class="s1">csv_param </span><span class="s2">in </span><span class="s1">csv_sign</span><span class="s3">.</span><span class="s1">parameters</span><span class="s3">.</span><span class="s1">items</span><span class="s3">():</span>
        <span class="s1">table_param </span><span class="s3">= </span><span class="s1">table_sign</span><span class="s3">.</span><span class="s1">parameters</span><span class="s3">[</span><span class="s1">key</span><span class="s3">]</span>
        <span class="s2">if </span><span class="s1">key </span><span class="s3">== </span><span class="s4">&quot;sep&quot;</span><span class="s3">:</span>
            <span class="s2">assert </span><span class="s1">csv_param</span><span class="s3">.</span><span class="s1">default </span><span class="s3">== </span><span class="s4">&quot;,&quot;</span>
            <span class="s2">assert </span><span class="s1">table_param</span><span class="s3">.</span><span class="s1">default </span><span class="s3">== </span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span>
            <span class="s2">assert </span><span class="s1">table_param</span><span class="s3">.</span><span class="s1">annotation </span><span class="s3">== </span><span class="s1">csv_param</span><span class="s3">.</span><span class="s1">annotation</span>
            <span class="s2">assert </span><span class="s1">table_param</span><span class="s3">.</span><span class="s1">kind </span><span class="s3">== </span><span class="s1">csv_param</span><span class="s3">.</span><span class="s1">kind</span>
            <span class="s2">continue</span>

        <span class="s2">assert </span><span class="s1">table_param </span><span class="s3">== </span><span class="s1">csv_param</span>


<span class="s2">def </span><span class="s1">test_read_table_equivalency_to_read_csv</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see gh-21948</span>
    <span class="s5"># As of 0.25.0, read_table is undeprecated</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;a</span><span class="s2">\t</span><span class="s4">b</span><span class="s2">\n</span><span class="s4">1</span><span class="s2">\t</span><span class="s4">2</span><span class="s2">\n</span><span class="s4">3</span><span class="s2">\t</span><span class="s4">4&quot;</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span><span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_table</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;read_func&quot;</span><span class="s3">, [</span><span class="s4">&quot;read_csv&quot;</span><span class="s3">, </span><span class="s4">&quot;read_table&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_read_csv_and_table_sys_setprofile</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">read_func</span><span class="s3">):</span>
    <span class="s5"># GH#41069</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;a b</span><span class="s2">\n</span><span class="s4">0 1&quot;</span>

    <span class="s1">sys</span><span class="s3">.</span><span class="s1">setprofile</span><span class="s3">(</span><span class="s2">lambda </span><span class="s3">*</span><span class="s1">a</span><span class="s3">, **</span><span class="s1">k</span><span class="s3">: </span><span class="s2">None</span><span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">parser</span><span class="s3">, </span><span class="s1">read_func</span><span class="s3">)(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">))</span>
    <span class="s1">sys</span><span class="s3">.</span><span class="s1">setprofile</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a b&quot;</span><span class="s3">: [</span><span class="s4">&quot;0 1&quot;</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_first_row_bom</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see gh-26545</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">'''</span><span class="s2">\ufeff</span><span class="s4">&quot;Head1&quot;</span><span class="s2">\t</span><span class="s4">&quot;Head2&quot;</span><span class="s2">\t</span><span class="s4">&quot;Head3&quot;'''</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;Head1&quot;</span><span class="s3">, </span><span class="s4">&quot;Head2&quot;</span><span class="s3">, </span><span class="s4">&quot;Head3&quot;</span><span class="s3">])</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_first_row_bom_unquoted</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see gh-36343</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ufeff</span><span class="s4">Head1</span><span class="s2">\t</span><span class="s4">Head2</span><span class="s2">\t</span><span class="s4">Head3&quot;&quot;&quot;</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span><span class="s1">columns</span><span class="s3">=[</span><span class="s4">&quot;Head1&quot;</span><span class="s3">, </span><span class="s4">&quot;Head2&quot;</span><span class="s3">, </span><span class="s4">&quot;Head3&quot;</span><span class="s3">])</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;nrows&quot;</span><span class="s3">, </span><span class="s1">range</span><span class="s3">(</span><span class="s6">1</span><span class="s3">, </span><span class="s6">6</span><span class="s3">))</span>
<span class="s2">def </span><span class="s1">test_blank_lines_between_header_and_data_rows</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">nrows</span><span class="s3">):</span>
    <span class="s5"># GH 28071</span>
    <span class="s1">ref </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">(</span>
        <span class="s3">[[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">], [</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">], [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">], [</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">], [</span><span class="s6">3</span><span class="s3">, </span><span class="s6">4</span><span class="s3">]],</span>
        <span class="s1">columns</span><span class="s3">=</span><span class="s1">list</span><span class="s3">(</span><span class="s4">&quot;ab&quot;</span><span class="s3">),</span>
    <span class="s3">)</span>
    <span class="s1">csv </span><span class="s3">= </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">header</span><span class="s2">\n\n</span><span class="s4">a,b</span><span class="s2">\n\n\n</span><span class="s4">1,2</span><span class="s2">\n\n</span><span class="s4">3,4&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'nrows' option is not supported with the 'pyarrow' engine&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span>
                <span class="s1">StringIO</span><span class="s3">(</span><span class="s1">csv</span><span class="s3">), </span><span class="s1">header</span><span class="s3">=</span><span class="s6">3</span><span class="s3">, </span><span class="s1">nrows</span><span class="s3">=</span><span class="s1">nrows</span><span class="s3">, </span><span class="s1">skip_blank_lines</span><span class="s3">=</span><span class="s2">False</span>
            <span class="s3">)</span>
        <span class="s2">return</span>

    <span class="s1">df </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">csv</span><span class="s3">), </span><span class="s1">header</span><span class="s3">=</span><span class="s6">3</span><span class="s3">, </span><span class="s1">nrows</span><span class="s3">=</span><span class="s1">nrows</span><span class="s3">, </span><span class="s1">skip_blank_lines</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">df</span><span class="s3">, </span><span class="s1">ref</span><span class="s3">[:</span><span class="s1">nrows</span><span class="s3">])</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_no_header_two_extra_columns</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH 26218</span>
    <span class="s1">column_names </span><span class="s3">= [</span><span class="s4">&quot;one&quot;</span><span class="s3">, </span><span class="s4">&quot;two&quot;</span><span class="s3">, </span><span class="s4">&quot;three&quot;</span><span class="s3">]</span>
    <span class="s1">ref </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([[</span><span class="s4">&quot;foo&quot;</span><span class="s3">, </span><span class="s4">&quot;bar&quot;</span><span class="s3">, </span><span class="s4">&quot;baz&quot;</span><span class="s3">]], </span><span class="s1">columns</span><span class="s3">=</span><span class="s1">column_names</span><span class="s3">)</span>
    <span class="s1">stream </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">(</span><span class="s4">&quot;foo,bar,baz,bam,blah&quot;</span><span class="s3">)</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">df </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv_check_warnings</span><span class="s3">(</span>
        <span class="s1">ParserWarning</span><span class="s3">,</span>
        <span class="s4">&quot;Length of header or names does not match length of data. &quot;</span>
        <span class="s4">&quot;This leads to a loss of data with index_col=False.&quot;</span><span class="s3">,</span>
        <span class="s1">stream</span><span class="s3">,</span>
        <span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">names</span><span class="s3">=</span><span class="s1">column_names</span><span class="s3">,</span>
        <span class="s1">index_col</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">df</span><span class="s3">, </span><span class="s1">ref</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_csv_names_not_accepting_sets</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH 34946</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;</span><span class="s2">\ 
    </span><span class="s4">1,2,3 
    4,5,6</span><span class="s2">\n</span><span class="s4">&quot;&quot;&quot;</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;Names should be an ordered collection.&quot;</span><span class="s3">):</span>
        <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">names</span><span class="s3">=</span><span class="s1">set</span><span class="s3">(</span><span class="s4">&quot;QAZ&quot;</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">test_read_table_delim_whitespace_default_sep</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH: 35958</span>
    <span class="s1">f </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">(</span><span class="s4">&quot;a  b  c</span><span class="s2">\n</span><span class="s4">1 -2 -3</span><span class="s2">\n</span><span class="s4">4  5   6&quot;</span><span class="s3">)</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s1">depr_msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' keyword in pd.read_table is deprecated&quot;</span>

    <span class="s2">if </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">engine </span><span class="s3">== </span><span class="s4">&quot;pyarrow&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' option is not supported with the 'pyarrow' engine&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
                <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
            <span class="s3">):</span>
                <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_table</span><span class="s3">(</span><span class="s1">f</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s2">return</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
        <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
    <span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_table</span><span class="s3">(</span><span class="s1">f</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">4</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: [-</span><span class="s6">2</span><span class="s3">, </span><span class="s6">5</span><span class="s3">], </span><span class="s4">&quot;c&quot;</span><span class="s3">: [-</span><span class="s6">3</span><span class="s3">, </span><span class="s6">6</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;delimiter&quot;</span><span class="s3">, [</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_read_csv_delim_whitespace_non_default_sep</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">):</span>
    <span class="s5"># GH: 35958</span>
    <span class="s1">f </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">(</span><span class="s4">&quot;a  b  c</span><span class="s2">\n</span><span class="s4">1 -2 -3</span><span class="s2">\n</span><span class="s4">4  5   6&quot;</span><span class="s3">)</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">msg </span><span class="s3">= (</span>
        <span class="s4">&quot;Specified a delimiter with both sep and &quot;</span>
        <span class="s4">&quot;delim_whitespace=True; you can only specify one.&quot;</span>
    <span class="s3">)</span>
    <span class="s1">depr_msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' keyword in pd.read_csv is deprecated&quot;</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
        <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
    <span class="s3">):</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">f</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">sep</span><span class="s3">=</span><span class="s1">delimiter</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">f</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s1">delimiter</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_csv_delimiter_and_sep_no_default</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH#39823</span>
    <span class="s1">f </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">(</span><span class="s4">&quot;a,b</span><span class="s2">\n</span><span class="s4">1,2&quot;</span><span class="s3">)</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Specified a sep and a delimiter; you can only specify one.&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">f</span><span class="s3">, </span><span class="s1">sep</span><span class="s3">=</span><span class="s4">&quot; &quot;</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s4">&quot;.&quot;</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;kwargs&quot;</span><span class="s3">, [{</span><span class="s4">&quot;delimiter&quot;</span><span class="s3">: </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">}, {</span><span class="s4">&quot;sep&quot;</span><span class="s3">: </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">}])</span>
<span class="s2">def </span><span class="s1">test_read_csv_line_break_as_separator</span><span class="s3">(</span><span class="s1">kwargs</span><span class="s3">, </span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH#43528</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;&quot;&quot;a,b,c 
1,2,3 
    &quot;&quot;&quot;</span>
    <span class="s1">msg </span><span class="s3">= (</span>
        <span class="s4">r&quot;Specified \\n as separator or delimiter. This forces the python engine &quot;</span>
        <span class="s4">r&quot;which does not accept a line terminator. Hence it is not allowed to use &quot;</span>
        <span class="s4">r&quot;the line terminator as separator.&quot;</span>
    <span class="s3">)</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), **</span><span class="s1">kwargs</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;delimiter&quot;</span><span class="s3">, [</span><span class="s4">&quot;,&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s2">\t</span><span class="s4">&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_read_table_delim_whitespace_non_default_sep</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">):</span>
    <span class="s5"># GH: 35958</span>
    <span class="s1">f </span><span class="s3">= </span><span class="s1">StringIO</span><span class="s3">(</span><span class="s4">&quot;a  b  c</span><span class="s2">\n</span><span class="s4">1 -2 -3</span><span class="s2">\n</span><span class="s4">4  5   6&quot;</span><span class="s3">)</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">msg </span><span class="s3">= (</span>
        <span class="s4">&quot;Specified a delimiter with both sep and &quot;</span>
        <span class="s4">&quot;delim_whitespace=True; you can only specify one.&quot;</span>
    <span class="s3">)</span>
    <span class="s1">depr_msg </span><span class="s3">= </span><span class="s4">&quot;The 'delim_whitespace' keyword in pd.read_table is deprecated&quot;</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span>
        <span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">, </span><span class="s1">check_stacklevel</span><span class="s3">=</span><span class="s2">False</span>
    <span class="s3">):</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_table</span><span class="s3">(</span><span class="s1">f</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">sep</span><span class="s3">=</span><span class="s1">delimiter</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_table</span><span class="s3">(</span><span class="s1">f</span><span class="s3">, </span><span class="s1">delim_whitespace</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">=</span><span class="s1">delimiter</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_dict_keys_as_names</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH: 36928</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;1,2&quot;</span>

    <span class="s1">keys </span><span class="s3">= {</span><span class="s4">&quot;a&quot;</span><span class="s3">: </span><span class="s1">int</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">: </span><span class="s1">int</span><span class="s3">}.</span><span class="s1">keys</span><span class="s3">()</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">names</span><span class="s3">=</span><span class="s1">keys</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: [</span><span class="s6">2</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">xfail_pyarrow  </span><span class="s5"># UnicodeDecodeError: 'utf-8' codec can't decode byte 0xed in position 0</span>
<span class="s2">def </span><span class="s1">test_encoding_surrogatepass</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH39017</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">content </span><span class="s3">= </span><span class="s7">b&quot;</span><span class="s2">\xed\xbd\xbf</span><span class="s7">&quot;</span>
    <span class="s1">decoded </span><span class="s3">= </span><span class="s1">content</span><span class="s3">.</span><span class="s1">decode</span><span class="s3">(</span><span class="s4">&quot;utf-8&quot;</span><span class="s3">, </span><span class="s1">errors</span><span class="s3">=</span><span class="s4">&quot;surrogatepass&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s1">decoded</span><span class="s3">: [</span><span class="s1">decoded</span><span class="s3">]}, </span><span class="s1">index</span><span class="s3">=[</span><span class="s1">decoded </span><span class="s3">* </span><span class="s6">2</span><span class="s3">])</span>
    <span class="s1">expected</span><span class="s3">.</span><span class="s1">index</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">decoded </span><span class="s3">* </span><span class="s6">2</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">ensure_clean</span><span class="s3">() </span><span class="s2">as </span><span class="s1">path</span><span class="s3">:</span>
        <span class="s1">Path</span><span class="s3">(</span><span class="s1">path</span><span class="s3">).</span><span class="s1">write_bytes</span><span class="s3">(</span>
            <span class="s1">content </span><span class="s3">* </span><span class="s6">2 </span><span class="s3">+ </span><span class="s7">b&quot;,&quot; </span><span class="s3">+ </span><span class="s1">content </span><span class="s3">+ </span><span class="s7">b&quot;</span><span class="s2">\n</span><span class="s7">&quot; </span><span class="s3">+ </span><span class="s1">content </span><span class="s3">* </span><span class="s6">2 </span><span class="s3">+ </span><span class="s7">b&quot;,&quot; </span><span class="s3">+ </span><span class="s1">content</span>
        <span class="s3">)</span>
        <span class="s1">df </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">encoding_errors</span><span class="s3">=</span><span class="s4">&quot;surrogatepass&quot;</span><span class="s3">, </span><span class="s1">index_col</span><span class="s3">=</span><span class="s6">0</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">df</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">UnicodeDecodeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;'utf-8' codec can't decode byte&quot;</span><span class="s3">):</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_malformed_second_line</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># see GH14782</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">a</span><span class="s2">\n</span><span class="s4">b</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">skip_blank_lines</span><span class="s3">=</span><span class="s2">False</span><span class="s3">, </span><span class="s1">header</span><span class="s3">=</span><span class="s6">1</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s4">&quot;b&quot;</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">skip_pyarrow</span>
<span class="s2">def </span><span class="s1">test_short_single_line</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH 47566</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">columns </span><span class="s3">= [</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">]</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;1,2&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">names</span><span class="s3">=</span><span class="s1">columns</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: [</span><span class="s6">2</span><span class="s3">], </span><span class="s4">&quot;c&quot;</span><span class="s3">: [</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">xfail_pyarrow  </span><span class="s5"># ValueError: Length mismatch: Expected axis has 2 elements</span>
<span class="s2">def </span><span class="s1">test_short_multi_line</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH 47566</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">columns </span><span class="s3">= [</span><span class="s4">&quot;a&quot;</span><span class="s3">, </span><span class="s4">&quot;b&quot;</span><span class="s3">, </span><span class="s4">&quot;c&quot;</span><span class="s3">]</span>
    <span class="s1">data </span><span class="s3">= </span><span class="s4">&quot;1,2</span><span class="s2">\n</span><span class="s4">1,2&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">data</span><span class="s3">), </span><span class="s1">header</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">names</span><span class="s3">=</span><span class="s1">columns</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">({</span><span class="s4">&quot;a&quot;</span><span class="s3">: [</span><span class="s6">1</span><span class="s3">, </span><span class="s6">1</span><span class="s3">], </span><span class="s4">&quot;b&quot;</span><span class="s3">: [</span><span class="s6">2</span><span class="s3">, </span><span class="s6">2</span><span class="s3">], </span><span class="s4">&quot;c&quot;</span><span class="s3">: [</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]})</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_read_seek</span><span class="s3">(</span><span class="s1">all_parsers</span><span class="s3">):</span>
    <span class="s5"># GH48646</span>
    <span class="s1">parser </span><span class="s3">= </span><span class="s1">all_parsers</span>
    <span class="s1">prefix </span><span class="s3">= </span><span class="s4">&quot;### DATA</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s1">content </span><span class="s3">= </span><span class="s4">&quot;nkey,value</span><span class="s2">\n</span><span class="s4">tables,rectangular</span><span class="s2">\n</span><span class="s4">&quot;</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">ensure_clean</span><span class="s3">() </span><span class="s2">as </span><span class="s1">path</span><span class="s3">:</span>
        <span class="s1">Path</span><span class="s3">(</span><span class="s1">path</span><span class="s3">).</span><span class="s1">write_text</span><span class="s3">(</span><span class="s1">prefix </span><span class="s3">+ </span><span class="s1">content</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s4">&quot;utf-8&quot;</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">open</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s4">&quot;utf-8&quot;</span><span class="s3">) </span><span class="s2">as </span><span class="s1">file</span><span class="s3">:</span>
            <span class="s1">file</span><span class="s3">.</span><span class="s1">readline</span><span class="s3">()</span>
            <span class="s1">actual </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">.</span><span class="s1">read_csv</span><span class="s3">(</span><span class="s1">StringIO</span><span class="s3">(</span><span class="s1">content</span><span class="s3">))</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">actual</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
</pre>
</body>
</html>