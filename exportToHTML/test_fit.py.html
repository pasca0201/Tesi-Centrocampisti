<html>
<head>
<title>test_fit.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_fit.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">as </span><span class="s1">npt</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_allclose</span><span class="s2">, </span><span class="s1">assert_equal</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">scipy </span><span class="s0">import </span><span class="s1">stats</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">optimize </span><span class="s0">import </span><span class="s1">differential_evolution</span>

<span class="s0">from </span><span class="s2">.</span><span class="s1">test_continuous_basic </span><span class="s0">import </span><span class="s1">distcont</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">_distn_infrastructure </span><span class="s0">import </span><span class="s1">FitError</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">_distr_params </span><span class="s0">import </span><span class="s1">distdiscrete</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">stats </span><span class="s0">import </span><span class="s1">goodness_of_fit</span>


<span class="s3"># this is not a proper statistical test for convergence, but only</span>
<span class="s3"># verifies that the estimate and true values don't differ by too much</span>

<span class="s1">fit_sizes </span><span class="s2">= [</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">5000</span><span class="s2">, </span><span class="s4">10000</span><span class="s2">]  </span><span class="s3"># sample sizes to try</span>

<span class="s1">thresh_percent </span><span class="s2">= </span><span class="s4">0.25  </span><span class="s3"># percent of true parameters for fail cut-off</span>
<span class="s1">thresh_min </span><span class="s2">= </span><span class="s4">0.75  </span><span class="s3"># minimum difference estimate - true to fail test</span>

<span class="s1">mle_failing_fits </span><span class="s2">= [</span>
        <span class="s5">'gausshyper'</span><span class="s2">,</span>
        <span class="s5">'genexpon'</span><span class="s2">,</span>
        <span class="s5">'gengamma'</span><span class="s2">,</span>
        <span class="s5">'irwinhall'</span><span class="s2">,</span>
        <span class="s5">'kappa4'</span><span class="s2">,</span>
        <span class="s5">'ksone'</span><span class="s2">,</span>
        <span class="s5">'kstwo'</span><span class="s2">,</span>
        <span class="s5">'ncf'</span><span class="s2">,</span>
        <span class="s5">'ncx2'</span><span class="s2">,</span>
        <span class="s5">'truncexpon'</span><span class="s2">,</span>
        <span class="s5">'tukeylambda'</span><span class="s2">,</span>
        <span class="s5">'vonmises'</span><span class="s2">,</span>
        <span class="s5">'levy_stable'</span><span class="s2">,</span>
        <span class="s5">'trapezoid'</span><span class="s2">,</span>
        <span class="s5">'truncweibull_min'</span><span class="s2">,</span>
        <span class="s5">'studentized_range'</span><span class="s2">,</span>
<span class="s2">]</span>

<span class="s3"># these pass but are XSLOW (&gt;1s)</span>
<span class="s1">mle_Xslow_fits </span><span class="s2">= [</span><span class="s5">'betaprime'</span><span class="s2">, </span><span class="s5">'crystalball'</span><span class="s2">, </span><span class="s5">'exponweib'</span><span class="s2">, </span><span class="s5">'f'</span><span class="s2">, </span><span class="s5">'geninvgauss'</span><span class="s2">,</span>
                  <span class="s5">'jf_skew_t'</span><span class="s2">, </span><span class="s5">'recipinvgauss'</span><span class="s2">, </span><span class="s5">'rel_breitwigner'</span><span class="s2">, </span><span class="s5">'vonmises_line'</span><span class="s2">]</span>

<span class="s3"># The MLE fit method of these distributions doesn't perform well when all</span>
<span class="s3"># parameters are fit, so test them with the location fixed at 0.</span>
<span class="s1">mle_use_floc0 </span><span class="s2">= [</span>
    <span class="s5">'burr'</span><span class="s2">,</span>
    <span class="s5">'chi'</span><span class="s2">,</span>
    <span class="s5">'chi2'</span><span class="s2">,</span>
    <span class="s5">'mielke'</span><span class="s2">,</span>
    <span class="s5">'pearson3'</span><span class="s2">,</span>
    <span class="s5">'genhalflogistic'</span><span class="s2">,</span>
    <span class="s5">'rdist'</span><span class="s2">,</span>
    <span class="s5">'pareto'</span><span class="s2">,</span>
    <span class="s5">'powerlaw'</span><span class="s2">,  </span><span class="s3"># distfn.nnlf(est2, rvs) &gt; distfn.nnlf(est1, rvs) otherwise</span>
    <span class="s5">'powerlognorm'</span><span class="s2">,</span>
    <span class="s5">'wrapcauchy'</span><span class="s2">,</span>
    <span class="s5">'rel_breitwigner'</span><span class="s2">,</span>
<span class="s2">]</span>

<span class="s1">mm_failing_fits </span><span class="s2">= [</span><span class="s5">'alpha'</span><span class="s2">, </span><span class="s5">'betaprime'</span><span class="s2">, </span><span class="s5">'burr'</span><span class="s2">, </span><span class="s5">'burr12'</span><span class="s2">, </span><span class="s5">'cauchy'</span><span class="s2">, </span><span class="s5">'chi'</span><span class="s2">,</span>
                   <span class="s5">'chi2'</span><span class="s2">, </span><span class="s5">'crystalball'</span><span class="s2">, </span><span class="s5">'dgamma'</span><span class="s2">, </span><span class="s5">'dweibull'</span><span class="s2">, </span><span class="s5">'f'</span><span class="s2">,</span>
                   <span class="s5">'fatiguelife'</span><span class="s2">, </span><span class="s5">'fisk'</span><span class="s2">, </span><span class="s5">'foldcauchy'</span><span class="s2">, </span><span class="s5">'genextreme'</span><span class="s2">,</span>
                   <span class="s5">'gengamma'</span><span class="s2">, </span><span class="s5">'genhyperbolic'</span><span class="s2">, </span><span class="s5">'gennorm'</span><span class="s2">, </span><span class="s5">'genpareto'</span><span class="s2">,</span>
                   <span class="s5">'halfcauchy'</span><span class="s2">, </span><span class="s5">'invgamma'</span><span class="s2">, </span><span class="s5">'invweibull'</span><span class="s2">, </span><span class="s5">'irwinhall'</span><span class="s2">, </span><span class="s5">'jf_skew_t'</span><span class="s2">,</span>
                   <span class="s5">'johnsonsu'</span><span class="s2">, </span><span class="s5">'kappa3'</span><span class="s2">, </span><span class="s5">'ksone'</span><span class="s2">, </span><span class="s5">'kstwo'</span><span class="s2">, </span><span class="s5">'levy'</span><span class="s2">, </span><span class="s5">'levy_l'</span><span class="s2">,</span>
                   <span class="s5">'levy_stable'</span><span class="s2">, </span><span class="s5">'loglaplace'</span><span class="s2">, </span><span class="s5">'lomax'</span><span class="s2">, </span><span class="s5">'mielke'</span><span class="s2">, </span><span class="s5">'nakagami'</span><span class="s2">,</span>
                   <span class="s5">'ncf'</span><span class="s2">, </span><span class="s5">'nct'</span><span class="s2">, </span><span class="s5">'ncx2'</span><span class="s2">, </span><span class="s5">'pareto'</span><span class="s2">, </span><span class="s5">'powerlognorm'</span><span class="s2">, </span><span class="s5">'powernorm'</span><span class="s2">,</span>
                   <span class="s5">'rel_breitwigner'</span><span class="s2">, </span><span class="s5">'skewcauchy'</span><span class="s2">, </span><span class="s5">'t'</span><span class="s2">, </span><span class="s5">'trapezoid'</span><span class="s2">, </span><span class="s5">'triang'</span><span class="s2">,</span>
                   <span class="s5">'truncpareto'</span><span class="s2">, </span><span class="s5">'truncweibull_min'</span><span class="s2">, </span><span class="s5">'tukeylambda'</span><span class="s2">,</span>
                   <span class="s5">'studentized_range'</span><span class="s2">]</span>

<span class="s3"># not sure if these fail, but they caused my patience to fail</span>
<span class="s1">mm_XXslow_fits </span><span class="s2">= [</span><span class="s5">'argus'</span><span class="s2">, </span><span class="s5">'exponpow'</span><span class="s2">, </span><span class="s5">'exponweib'</span><span class="s2">, </span><span class="s5">'gausshyper'</span><span class="s2">, </span><span class="s5">'genexpon'</span><span class="s2">,</span>
                  <span class="s5">'genhalflogistic'</span><span class="s2">, </span><span class="s5">'halfgennorm'</span><span class="s2">, </span><span class="s5">'gompertz'</span><span class="s2">, </span><span class="s5">'johnsonsb'</span><span class="s2">,</span>
                  <span class="s5">'kappa4'</span><span class="s2">, </span><span class="s5">'kstwobign'</span><span class="s2">, </span><span class="s5">'recipinvgauss'</span><span class="s2">,</span>
                  <span class="s5">'truncexpon'</span><span class="s2">, </span><span class="s5">'vonmises'</span><span class="s2">, </span><span class="s5">'vonmises_line'</span><span class="s2">]</span>

<span class="s3"># these pass but are XSLOW (&gt;1s)</span>
<span class="s1">mm_Xslow_fits </span><span class="s2">= [</span><span class="s5">'wrapcauchy'</span><span class="s2">]</span>

<span class="s1">failing_fits </span><span class="s2">= {</span><span class="s5">&quot;MM&quot;</span><span class="s2">: </span><span class="s1">mm_failing_fits </span><span class="s2">+ </span><span class="s1">mm_XXslow_fits</span><span class="s2">, </span><span class="s5">&quot;MLE&quot;</span><span class="s2">: </span><span class="s1">mle_failing_fits</span><span class="s2">}</span>
<span class="s1">xslow_fits </span><span class="s2">= {</span><span class="s5">&quot;MM&quot;</span><span class="s2">: </span><span class="s1">mm_Xslow_fits</span><span class="s2">, </span><span class="s5">&quot;MLE&quot;</span><span class="s2">: </span><span class="s1">mle_Xslow_fits</span><span class="s2">}</span>
<span class="s1">fail_interval_censored </span><span class="s2">= {</span><span class="s5">&quot;truncpareto&quot;</span><span class="s2">}</span>

<span class="s3"># Don't run the fit test on these:</span>
<span class="s1">skip_fit </span><span class="s2">= [</span>
    <span class="s5">'erlang'</span><span class="s2">,  </span><span class="s3"># Subclass of gamma, generates a warning.</span>
    <span class="s5">'genhyperbolic'</span><span class="s2">, </span><span class="s5">'norminvgauss'</span><span class="s2">,  </span><span class="s3"># too slow</span>
<span class="s2">]</span>


<span class="s0">def </span><span class="s1">cases_test_cont_fit</span><span class="s2">():</span>
    <span class="s3"># this tests the closeness of the estimated parameters to the true</span>
    <span class="s3"># parameters with fit method of continuous distributions</span>
    <span class="s3"># Note: is slow, some distributions don't converge with sample</span>
    <span class="s3"># size &lt;= 10000</span>
    <span class="s0">for </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">distcont</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">distname </span><span class="s0">not in </span><span class="s1">skip_fit</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'distname,arg'</span><span class="s2">, </span><span class="s1">cases_test_cont_fit</span><span class="s2">())</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'method'</span><span class="s2">, [</span><span class="s5">&quot;MLE&quot;</span><span class="s2">, </span><span class="s5">&quot;MM&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_cont_fit</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">):</span>
    <span class="s1">run_xfail </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">getenv</span><span class="s2">(</span><span class="s5">'SCIPY_XFAIL'</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>
    <span class="s1">run_xslow </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">os</span><span class="s2">.</span><span class="s1">getenv</span><span class="s2">(</span><span class="s5">'SCIPY_XSLOW'</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>

    <span class="s0">if </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">failing_fits</span><span class="s2">[</span><span class="s1">method</span><span class="s2">] </span><span class="s0">and not </span><span class="s1">run_xfail</span><span class="s2">:</span>
        <span class="s3"># The generic `fit` method can't be expected to work perfectly for all</span>
        <span class="s3"># distributions, data, and guesses. Some failures are expected.</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s5">&quot;Failure expected; set environment variable SCIPY_XFAIL=1 to run.&quot;</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">xslow_fits</span><span class="s2">[</span><span class="s1">method</span><span class="s2">] </span><span class="s0">and not </span><span class="s1">run_xslow</span><span class="s2">:</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s5">&quot;Very slow; set environment variable SCIPY_XSLOW=1 to run.&quot;</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">)</span>

    <span class="s1">distfn </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>

    <span class="s1">truearg </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hstack</span><span class="s2">([</span><span class="s1">arg</span><span class="s2">, [</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">]])</span>
    <span class="s1">diffthreshold </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">vstack</span><span class="s2">([</span><span class="s1">truearg</span><span class="s2">*</span><span class="s1">thresh_percent</span><span class="s2">,</span>
                                      <span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">numargs</span><span class="s2">+</span><span class="s4">2</span><span class="s2">, </span><span class="s1">thresh_min</span><span class="s2">)]),</span>
                           <span class="s4">0</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">fit_size </span><span class="s0">in </span><span class="s1">fit_sizes</span><span class="s2">:</span>
        <span class="s3"># Note that if a fit succeeds, the other fit_sizes are skipped</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s4">1234</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">all</span><span class="s2">=</span><span class="s5">'ignore'</span><span class="s2">):</span>
            <span class="s1">rvs </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s1">fit_size</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s5">'MLE' </span><span class="s0">and </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">name </span><span class="s0">in </span><span class="s1">mle_use_floc0</span><span class="s2">:</span>
                <span class="s1">kwds </span><span class="s2">= {</span><span class="s5">'floc'</span><span class="s2">: </span><span class="s4">0</span><span class="s2">}</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">kwds </span><span class="s2">= {}</span>
            <span class="s3"># start with default values</span>
            <span class="s1">est </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">, **</span><span class="s1">kwds</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s5">'MLE'</span><span class="s2">:</span>
                <span class="s3"># Trivial test of the use of CensoredData.  The fit() method</span>
                <span class="s3"># will check that data contains no actual censored data, and</span>
                <span class="s3"># do a regular uncensored fit.</span>
                <span class="s1">data1 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">CensoredData</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">)</span>
                <span class="s1">est1 </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">data1</span><span class="s2">, **</span><span class="s1">kwds</span><span class="s2">)</span>
                <span class="s1">msg </span><span class="s2">= (</span><span class="s5">'Different results fitting uncensored data wrapped as'</span>
                       <span class="s5">f' CensoredData: </span><span class="s0">{</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">name</span><span class="s0">}</span><span class="s5">: est=</span><span class="s0">{</span><span class="s1">est</span><span class="s0">} </span><span class="s5">est1=</span><span class="s0">{</span><span class="s1">est1</span><span class="s0">}</span><span class="s5">'</span><span class="s2">)</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">est1</span><span class="s2">, </span><span class="s1">est</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-10</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">)</span>
            <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s5">'MLE' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">not in </span><span class="s1">fail_interval_censored</span><span class="s2">:</span>
                <span class="s3"># Convert the first `nic` values in rvs to interval-censored</span>
                <span class="s3"># values. The interval is small, so est2 should be close to</span>
                <span class="s3"># est.</span>
                <span class="s1">nic </span><span class="s2">= </span><span class="s4">15</span>
                <span class="s1">interval </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">column_stack</span><span class="s2">((</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">))</span>
                <span class="s1">interval</span><span class="s2">[:</span><span class="s1">nic</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] *= </span><span class="s4">0.99</span>
                <span class="s1">interval</span><span class="s2">[:</span><span class="s1">nic</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] *= </span><span class="s4">1.01</span>
                <span class="s1">interval</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
                <span class="s1">data2 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">CensoredData</span><span class="s2">(</span><span class="s1">interval</span><span class="s2">=</span><span class="s1">interval</span><span class="s2">)</span>
                <span class="s1">est2 </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">data2</span><span class="s2">, **</span><span class="s1">kwds</span><span class="s2">)</span>
                <span class="s1">msg </span><span class="s2">= (</span><span class="s5">'Different results fitting interval-censored'</span>
                       <span class="s5">f' data: </span><span class="s0">{</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">name</span><span class="s0">}</span><span class="s5">: est=</span><span class="s0">{</span><span class="s1">est</span><span class="s0">} </span><span class="s5">est2=</span><span class="s0">{</span><span class="s1">est2</span><span class="s0">}</span><span class="s5">'</span><span class="s2">)</span>
                <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">est2</span><span class="s2">, </span><span class="s1">est</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">0.05</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">)</span>

        <span class="s1">diff </span><span class="s2">= </span><span class="s1">est </span><span class="s2">- </span><span class="s1">truearg</span>

        <span class="s3"># threshold for location</span>
        <span class="s1">diffthreshold</span><span class="s2">[-</span><span class="s4">2</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">max</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">())*</span><span class="s1">thresh_percent</span><span class="s2">,</span>
                                    <span class="s1">thresh_min</span><span class="s2">])</span>

        <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">any</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">est</span><span class="s2">)):</span>
            <span class="s0">raise </span><span class="s1">AssertionError</span><span class="s2">(</span><span class="s5">'nan returned in fit'</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">diff</span><span class="s2">) &lt;= </span><span class="s1">diffthreshold</span><span class="s2">):</span>
                <span class="s0">break</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">txt </span><span class="s2">= </span><span class="s5">'parameter: %s</span><span class="s0">\n</span><span class="s5">' </span><span class="s2">% </span><span class="s1">str</span><span class="s2">(</span><span class="s1">truearg</span><span class="s2">)</span>
        <span class="s1">txt </span><span class="s2">+= </span><span class="s5">'estimated: %s</span><span class="s0">\n</span><span class="s5">' </span><span class="s2">% </span><span class="s1">str</span><span class="s2">(</span><span class="s1">est</span><span class="s2">)</span>
        <span class="s1">txt </span><span class="s2">+= </span><span class="s5">'diff     : %s</span><span class="s0">\n</span><span class="s5">' </span><span class="s2">% </span><span class="s1">str</span><span class="s2">(</span><span class="s1">diff</span><span class="s2">)</span>
        <span class="s0">raise </span><span class="s1">AssertionError</span><span class="s2">(</span><span class="s5">'fit not very good in %s</span><span class="s0">\n</span><span class="s5">' </span><span class="s2">% </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s1">txt</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">_check_loc_scale_mle_fit</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>
    <span class="s1">actual </span><span class="s2">= </span><span class="s1">d</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)[-</span><span class="s4">2</span><span class="s2">:]</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">desired</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s1">atol</span><span class="s2">,</span>
                    <span class="s1">err_msg</span><span class="s2">=</span><span class="s5">'poor mle fit of (loc, scale) in %s' </span><span class="s2">% </span><span class="s1">name</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_non_default_loc_scale_mle_fit</span><span class="s2">():</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.01</span><span class="s2">, </span><span class="s4">1.78</span><span class="s2">, </span><span class="s4">1.78</span><span class="s2">, </span><span class="s4">1.78</span><span class="s2">, </span><span class="s4">1.88</span><span class="s2">, </span><span class="s4">1.88</span><span class="s2">, </span><span class="s4">1.88</span><span class="s2">, </span><span class="s4">2.00</span><span class="s2">])</span>
    <span class="s1">_check_loc_scale_mle_fit</span><span class="s2">(</span><span class="s5">'uniform'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, [</span><span class="s4">1.01</span><span class="s2">, </span><span class="s4">0.99</span><span class="s2">], </span><span class="s4">1e-3</span><span class="s2">)</span>
    <span class="s1">_check_loc_scale_mle_fit</span><span class="s2">(</span><span class="s5">'expon'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, [</span><span class="s4">1.01</span><span class="s2">, </span><span class="s4">0.73875</span><span class="s2">], </span><span class="s4">1e-3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_expon_fit</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;gh-6167&quot;&quot;&quot;</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">phat </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">expon</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">floc</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">phat</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_fit_error</span><span class="s2">():</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">concatenate</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s4">29</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">21</span><span class="s2">)])</span>
    <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Optimization converged to parameters that are...&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">FitError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">), </span><span class="s1">\</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">):</span>
        <span class="s1">stats</span><span class="s2">.</span><span class="s1">beta</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;dist, params&quot;</span><span class="s2">,</span>
                         <span class="s2">[(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, (</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">2.5</span><span class="s2">)),  </span><span class="s3"># type: ignore[attr-defined]</span>
                          <span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">binom</span><span class="s2">, (</span><span class="s4">10</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">))])  </span><span class="s3"># type: ignore[attr-defined]</span>
<span class="s0">def </span><span class="s1">test_nnlf_and_related_methods</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">params</span><span class="s2">):</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">983459824</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s5">'pdf'</span><span class="s2">):</span>
        <span class="s1">logpxf </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">logpdf</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">logpxf </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">logpmf</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">params</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
    <span class="s1">ref </span><span class="s2">= -</span><span class="s1">logpxf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, *</span><span class="s1">params</span><span class="s2">).</span><span class="s1">sum</span><span class="s2">()</span>
    <span class="s1">res1 </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">nnlf</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">res2 </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">_penalized_nnlf</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res1</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res2</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">cases_test_fit_mle</span><span class="s2">():</span>
    <span class="s3"># These fail default test or hang</span>
    <span class="s1">skip_basic_fit </span><span class="s2">= {</span><span class="s5">'argus'</span><span class="s2">, </span><span class="s5">'irwinhall'</span><span class="s2">, </span><span class="s5">'foldnorm'</span><span class="s2">, </span><span class="s5">'truncpareto'</span><span class="s2">,</span>
                      <span class="s5">'truncweibull_min'</span><span class="s2">, </span><span class="s5">'ksone'</span><span class="s2">, </span><span class="s5">'levy_stable'</span><span class="s2">,</span>
                      <span class="s5">'studentized_range'</span><span class="s2">, </span><span class="s5">'kstwo'</span><span class="s2">, </span><span class="s5">'arcsine'</span><span class="s2">}</span>

    <span class="s3"># Please keep this list in alphabetical order...</span>
    <span class="s1">slow_basic_fit </span><span class="s2">= {</span><span class="s5">'alpha'</span><span class="s2">, </span><span class="s5">'betaprime'</span><span class="s2">, </span><span class="s5">'binom'</span><span class="s2">, </span><span class="s5">'bradford'</span><span class="s2">, </span><span class="s5">'burr12'</span><span class="s2">,</span>
                      <span class="s5">'chi'</span><span class="s2">, </span><span class="s5">'crystalball'</span><span class="s2">, </span><span class="s5">'dweibull'</span><span class="s2">, </span><span class="s5">'erlang'</span><span class="s2">, </span><span class="s5">'exponnorm'</span><span class="s2">,</span>
                      <span class="s5">'exponpow'</span><span class="s2">, </span><span class="s5">'f'</span><span class="s2">, </span><span class="s5">'fatiguelife'</span><span class="s2">, </span><span class="s5">'fisk'</span><span class="s2">, </span><span class="s5">'foldcauchy'</span><span class="s2">, </span><span class="s5">'gamma'</span><span class="s2">,</span>
                      <span class="s5">'genexpon'</span><span class="s2">, </span><span class="s5">'genextreme'</span><span class="s2">, </span><span class="s5">'gennorm'</span><span class="s2">, </span><span class="s5">'genpareto'</span><span class="s2">,</span>
                      <span class="s5">'gompertz'</span><span class="s2">, </span><span class="s5">'halfgennorm'</span><span class="s2">, </span><span class="s5">'invgamma'</span><span class="s2">, </span><span class="s5">'invgauss'</span><span class="s2">, </span><span class="s5">'invweibull'</span><span class="s2">,</span>
                      <span class="s5">'jf_skew_t'</span><span class="s2">, </span><span class="s5">'johnsonsb'</span><span class="s2">, </span><span class="s5">'johnsonsu'</span><span class="s2">, </span><span class="s5">'kappa3'</span><span class="s2">,</span>
                      <span class="s5">'kstwobign'</span><span class="s2">, </span><span class="s5">'loglaplace'</span><span class="s2">, </span><span class="s5">'lognorm'</span><span class="s2">, </span><span class="s5">'lomax'</span><span class="s2">, </span><span class="s5">'mielke'</span><span class="s2">,</span>
                      <span class="s5">'nakagami'</span><span class="s2">, </span><span class="s5">'nbinom'</span><span class="s2">, </span><span class="s5">'norminvgauss'</span><span class="s2">,</span>
                      <span class="s5">'pareto'</span><span class="s2">, </span><span class="s5">'pearson3'</span><span class="s2">, </span><span class="s5">'powerlaw'</span><span class="s2">, </span><span class="s5">'powernorm'</span><span class="s2">,</span>
                      <span class="s5">'randint'</span><span class="s2">, </span><span class="s5">'rdist'</span><span class="s2">, </span><span class="s5">'recipinvgauss'</span><span class="s2">, </span><span class="s5">'rice'</span><span class="s2">, </span><span class="s5">'skewnorm'</span><span class="s2">,</span>
                      <span class="s5">'t'</span><span class="s2">, </span><span class="s5">'uniform'</span><span class="s2">, </span><span class="s5">'weibull_max'</span><span class="s2">, </span><span class="s5">'weibull_min'</span><span class="s2">, </span><span class="s5">'wrapcauchy'</span><span class="s2">}</span>

    <span class="s3"># Please keep this list in alphabetical order...</span>
    <span class="s1">xslow_basic_fit </span><span class="s2">= {</span><span class="s5">'beta'</span><span class="s2">, </span><span class="s5">'betabinom'</span><span class="s2">, </span><span class="s5">'betanbinom'</span><span class="s2">, </span><span class="s5">'burr'</span><span class="s2">, </span><span class="s5">'exponweib'</span><span class="s2">,</span>
                       <span class="s5">'gausshyper'</span><span class="s2">, </span><span class="s5">'gengamma'</span><span class="s2">, </span><span class="s5">'genhalflogistic'</span><span class="s2">,</span>
                       <span class="s5">'genhyperbolic'</span><span class="s2">, </span><span class="s5">'geninvgauss'</span><span class="s2">,</span>
                       <span class="s5">'hypergeom'</span><span class="s2">, </span><span class="s5">'kappa4'</span><span class="s2">, </span><span class="s5">'loguniform'</span><span class="s2">,</span>
                       <span class="s5">'ncf'</span><span class="s2">, </span><span class="s5">'nchypergeom_fisher'</span><span class="s2">, </span><span class="s5">'nchypergeom_wallenius'</span><span class="s2">,</span>
                       <span class="s5">'nct'</span><span class="s2">, </span><span class="s5">'ncx2'</span><span class="s2">, </span><span class="s5">'nhypergeom'</span><span class="s2">,</span>
                       <span class="s5">'powerlognorm'</span><span class="s2">, </span><span class="s5">'reciprocal'</span><span class="s2">, </span><span class="s5">'rel_breitwigner'</span><span class="s2">,</span>
                       <span class="s5">'skellam'</span><span class="s2">, </span><span class="s5">'trapezoid'</span><span class="s2">, </span><span class="s5">'triang'</span><span class="s2">, </span><span class="s5">'truncnorm'</span><span class="s2">,</span>
                       <span class="s5">'tukeylambda'</span><span class="s2">, </span><span class="s5">'vonmises'</span><span class="s2">, </span><span class="s5">'zipfian'</span><span class="s2">}</span>

    <span class="s0">for </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">distdiscrete </span><span class="s2">+ </span><span class="s1">distcont</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">skip_basic_fit </span><span class="s0">or not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s1">reason </span><span class="s2">= </span><span class="s5">&quot;tested separately&quot;</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">reason</span><span class="s2">))</span>
        <span class="s0">elif </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">slow_basic_fit</span><span class="s2">:</span>
            <span class="s1">reason </span><span class="s2">= </span><span class="s5">&quot;too slow (&gt;= 0.25s)&quot;</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">reason</span><span class="s2">))</span>
        <span class="s0">elif </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">xslow_basic_fit</span><span class="s2">:</span>
            <span class="s1">reason </span><span class="s2">= </span><span class="s5">&quot;too slow (&gt;= 1.0s)&quot;</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">reason</span><span class="s2">))</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">dist</span>


<span class="s0">def </span><span class="s1">cases_test_fit_mse</span><span class="s2">():</span>
    <span class="s3"># the first four are so slow that I'm not sure whether they would pass</span>
    <span class="s1">skip_basic_fit </span><span class="s2">= {</span><span class="s5">'levy_stable'</span><span class="s2">, </span><span class="s5">'studentized_range'</span><span class="s2">, </span><span class="s5">'ksone'</span><span class="s2">, </span><span class="s5">'skewnorm'</span><span class="s2">,</span>
                      <span class="s5">'irwinhall'</span><span class="s2">, </span><span class="s3"># hangs</span>
                      <span class="s5">'norminvgauss'</span><span class="s2">,  </span><span class="s3"># super slow (~1 hr) but passes</span>
                      <span class="s5">'kstwo'</span><span class="s2">,  </span><span class="s3"># very slow (~25 min) but passes</span>
                      <span class="s5">'geninvgauss'</span><span class="s2">,  </span><span class="s3"># quite slow (~4 minutes) but passes</span>
                      <span class="s5">'gausshyper'</span><span class="s2">, </span><span class="s5">'genhyperbolic'</span><span class="s2">,  </span><span class="s3"># integration warnings</span>
                      <span class="s5">'tukeylambda'</span><span class="s2">,  </span><span class="s3"># close, but doesn't meet tolerance</span>
                      <span class="s5">'vonmises'</span><span class="s2">,  </span><span class="s3"># can have negative CDF; doesn't play nice</span>
                      <span class="s5">'argus'</span><span class="s2">}  </span><span class="s3"># doesn't meet tolerance; tested separately</span>

    <span class="s3"># Please keep this list in alphabetical order...</span>
    <span class="s1">slow_basic_fit </span><span class="s2">= {</span><span class="s5">'alpha'</span><span class="s2">, </span><span class="s5">'anglit'</span><span class="s2">, </span><span class="s5">'arcsine'</span><span class="s2">, </span><span class="s5">'betabinom'</span><span class="s2">, </span><span class="s5">'bradford'</span><span class="s2">,</span>
                      <span class="s5">'chi'</span><span class="s2">, </span><span class="s5">'chi2'</span><span class="s2">, </span><span class="s5">'crystalball'</span><span class="s2">, </span><span class="s5">'dweibull'</span><span class="s2">,</span>
                      <span class="s5">'erlang'</span><span class="s2">, </span><span class="s5">'exponnorm'</span><span class="s2">, </span><span class="s5">'exponpow'</span><span class="s2">, </span><span class="s5">'exponweib'</span><span class="s2">,</span>
                      <span class="s5">'fatiguelife'</span><span class="s2">, </span><span class="s5">'fisk'</span><span class="s2">, </span><span class="s5">'foldcauchy'</span><span class="s2">, </span><span class="s5">'foldnorm'</span><span class="s2">,</span>
                      <span class="s5">'gamma'</span><span class="s2">, </span><span class="s5">'genexpon'</span><span class="s2">, </span><span class="s5">'genextreme'</span><span class="s2">, </span><span class="s5">'genhalflogistic'</span><span class="s2">,</span>
                      <span class="s5">'genlogistic'</span><span class="s2">, </span><span class="s5">'genpareto'</span><span class="s2">, </span><span class="s5">'gompertz'</span><span class="s2">,</span>
                      <span class="s5">'hypergeom'</span><span class="s2">, </span><span class="s5">'invweibull'</span><span class="s2">,</span>
                      <span class="s5">'johnsonsu'</span><span class="s2">, </span><span class="s5">'kappa3'</span><span class="s2">, </span><span class="s5">'kstwobign'</span><span class="s2">,</span>
                      <span class="s5">'laplace_asymmetric'</span><span class="s2">, </span><span class="s5">'loggamma'</span><span class="s2">, </span><span class="s5">'loglaplace'</span><span class="s2">,</span>
                      <span class="s5">'lognorm'</span><span class="s2">, </span><span class="s5">'lomax'</span><span class="s2">,</span>
                      <span class="s5">'maxwell'</span><span class="s2">, </span><span class="s5">'nhypergeom'</span><span class="s2">,</span>
                      <span class="s5">'pareto'</span><span class="s2">, </span><span class="s5">'powernorm'</span><span class="s2">, </span><span class="s5">'randint'</span><span class="s2">, </span><span class="s5">'recipinvgauss'</span><span class="s2">,</span>
                      <span class="s5">'semicircular'</span><span class="s2">,</span>
                      <span class="s5">'t'</span><span class="s2">, </span><span class="s5">'triang'</span><span class="s2">, </span><span class="s5">'truncexpon'</span><span class="s2">, </span><span class="s5">'truncpareto'</span><span class="s2">,</span>
                      <span class="s5">'uniform'</span><span class="s2">,</span>
                      <span class="s5">'wald'</span><span class="s2">, </span><span class="s5">'weibull_max'</span><span class="s2">, </span><span class="s5">'weibull_min'</span><span class="s2">, </span><span class="s5">'wrapcauchy'</span><span class="s2">}</span>

    <span class="s3"># Please keep this list in alphabetical order...</span>
    <span class="s1">xslow_basic_fit </span><span class="s2">= {</span><span class="s5">'argus'</span><span class="s2">, </span><span class="s5">'beta'</span><span class="s2">, </span><span class="s5">'betaprime'</span><span class="s2">, </span><span class="s5">'burr'</span><span class="s2">, </span><span class="s5">'burr12'</span><span class="s2">,</span>
                       <span class="s5">'dgamma'</span><span class="s2">, </span><span class="s5">'f'</span><span class="s2">, </span><span class="s5">'gengamma'</span><span class="s2">, </span><span class="s5">'gennorm'</span><span class="s2">,</span>
                       <span class="s5">'halfgennorm'</span><span class="s2">, </span><span class="s5">'invgamma'</span><span class="s2">, </span><span class="s5">'invgauss'</span><span class="s2">, </span><span class="s5">'jf_skew_t'</span><span class="s2">,</span>
                       <span class="s5">'johnsonsb'</span><span class="s2">, </span><span class="s5">'kappa4'</span><span class="s2">, </span><span class="s5">'loguniform'</span><span class="s2">, </span><span class="s5">'mielke'</span><span class="s2">,</span>
                       <span class="s5">'nakagami'</span><span class="s2">, </span><span class="s5">'ncf'</span><span class="s2">, </span><span class="s5">'nchypergeom_fisher'</span><span class="s2">,</span>
                       <span class="s5">'nchypergeom_wallenius'</span><span class="s2">, </span><span class="s5">'nct'</span><span class="s2">, </span><span class="s5">'ncx2'</span><span class="s2">,</span>
                       <span class="s5">'pearson3'</span><span class="s2">, </span><span class="s5">'powerlaw'</span><span class="s2">, </span><span class="s5">'powerlognorm'</span><span class="s2">,</span>
                       <span class="s5">'rdist'</span><span class="s2">, </span><span class="s5">'reciprocal'</span><span class="s2">, </span><span class="s5">'rel_breitwigner'</span><span class="s2">, </span><span class="s5">'rice'</span><span class="s2">,</span>
                       <span class="s5">'trapezoid'</span><span class="s2">, </span><span class="s5">'truncnorm'</span><span class="s2">, </span><span class="s5">'truncweibull_min'</span><span class="s2">,</span>
                       <span class="s5">'vonmises_line'</span><span class="s2">, </span><span class="s5">'zipfian'</span><span class="s2">}</span>

    <span class="s1">warns_basic_fit </span><span class="s2">= {</span><span class="s5">'skellam'</span><span class="s2">}  </span><span class="s3"># can remove mark after gh-14901 is resolved</span>

    <span class="s0">for </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">distdiscrete </span><span class="s2">+ </span><span class="s1">distcont</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">skip_basic_fit </span><span class="s0">or not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
            <span class="s1">reason </span><span class="s2">= </span><span class="s5">&quot;Fails. Oh well.&quot;</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">reason</span><span class="s2">))</span>
        <span class="s0">elif </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">slow_basic_fit</span><span class="s2">:</span>
            <span class="s1">reason </span><span class="s2">= </span><span class="s5">&quot;too slow (&gt;= 0.25s)&quot;</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">reason</span><span class="s2">))</span>
        <span class="s0">elif </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">xslow_basic_fit</span><span class="s2">:</span>
            <span class="s1">reason </span><span class="s2">= </span><span class="s5">&quot;too slow (&gt;= 1.0s)&quot;</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s1">reason</span><span class="s2">))</span>
        <span class="s0">elif </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">warns_basic_fit</span><span class="s2">:</span>
            <span class="s1">mark </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s5">'ignore::RuntimeWarning'</span><span class="s2">)</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">mark</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">dist</span>


<span class="s0">def </span><span class="s1">cases_test_fitstart</span><span class="s2">():</span>
    <span class="s0">for </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">shapes </span><span class="s0">in </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">distcont</span><span class="s2">).</span><span class="s1">items</span><span class="s2">():</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s0">not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">str</span><span class="s2">) </span><span class="s0">or</span>
                <span class="s1">distname </span><span class="s0">in </span><span class="s2">{</span><span class="s5">'studentized_range'</span><span class="s2">, </span><span class="s5">'recipinvgauss'</span><span class="s2">}):  </span><span class="s3"># slow</span>
            <span class="s0">continue</span>
        <span class="s0">yield </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">shapes</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'distname, shapes'</span><span class="s2">, </span><span class="s1">cases_test_fitstart</span><span class="s2">())</span>
<span class="s0">def </span><span class="s1">test_fitstart</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">shapes</span><span class="s2">):</span>
    <span class="s1">dist </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">216342614</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">invalid</span><span class="s2">=</span><span class="s5">'ignore'</span><span class="s2">, </span><span class="s1">divide</span><span class="s2">=</span><span class="s5">'ignore'</span><span class="s2">):  </span><span class="s3"># irrelevant to test</span>
        <span class="s1">guess </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">_fitstart</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">_argcheck</span><span class="s2">(*</span><span class="s1">guess</span><span class="s2">[:-</span><span class="s4">2</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">assert_nlff_less_or_close</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">params1</span><span class="s2">, </span><span class="s1">params0</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-7</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">0</span><span class="s2">,</span>
                              <span class="s1">nlff_name</span><span class="s2">=</span><span class="s5">'nnlf'</span><span class="s2">):</span>
    <span class="s1">nlff </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">nlff_name</span><span class="s2">)</span>
    <span class="s1">nlff1 </span><span class="s2">= </span><span class="s1">nlff</span><span class="s2">(</span><span class="s1">params1</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">nlff0 </span><span class="s2">= </span><span class="s1">nlff</span><span class="s2">(</span><span class="s1">params0</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>
    <span class="s0">if not </span><span class="s2">(</span><span class="s1">nlff1 </span><span class="s2">&lt; </span><span class="s1">nlff0</span><span class="s2">):</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">nlff1</span><span class="s2">, </span><span class="s1">nlff0</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s1">rtol</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s1">atol</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TestFit</span><span class="s2">:</span>
    <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">binom  </span><span class="s3"># type: ignore[attr-defined]</span>
    <span class="s1">seed </span><span class="s2">= </span><span class="s4">654634816187</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">seed</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">binom</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)  </span><span class="s3"># type: ignore[attr-defined]  # noqa: E501</span>
    <span class="s1">shape_bounds_a </span><span class="s2">= [(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]</span>
    <span class="s1">shape_bounds_d </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'p'</span><span class="s2">: (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)}</span>
    <span class="s1">atol </span><span class="s2">= </span><span class="s4">5e-2</span>
    <span class="s1">rtol </span><span class="s2">= </span><span class="s4">1e-2</span>
    <span class="s1">tols </span><span class="s2">= {</span><span class="s5">'atol'</span><span class="s2">: </span><span class="s1">atol</span><span class="s2">, </span><span class="s5">'rtol'</span><span class="s2">: </span><span class="s1">rtol</span><span class="s2">}</span>

    <span class="s0">def </span><span class="s1">opt</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwds</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">differential_evolution</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, **</span><span class="s1">kwds</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_dist_iv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;`dist` must be an instance of...&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_a</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_data_iv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;`data` must be exactly one-dimensional.&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_a</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;All elements of `data` must be finite numbers.&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_a</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_a</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, [</span><span class="s5">'1'</span><span class="s2">, </span><span class="s5">'2'</span><span class="s2">, </span><span class="s5">'3'</span><span class="s2">], </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_a</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_bounds_iv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Bounds provided for the following unrecognized...&quot;</span>
        <span class="s1">shape_bounds </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'p'</span><span class="s2">: (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s5">'1'</span><span class="s2">: (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)}</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Each element of a `bounds` sequence must be a tuple...&quot;</span>
        <span class="s1">shape_bounds </span><span class="s2">= [(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Each element of `bounds` must be a tuple specifying...&quot;</span>
        <span class="s1">shape_bounds </span><span class="s2">= [(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">)]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;A `bounds` sequence must contain at least 2 elements...&quot;</span>
        <span class="s1">shape_bounds </span><span class="s2">= [(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;A `bounds` sequence may not contain more than 3 elements...&quot;</span>
        <span class="s1">bounds </span><span class="s2">= [(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;There are no values for `p` on the interval...&quot;</span>
        <span class="s1">shape_bounds </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'p'</span><span class="s2">: (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)}</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;There are no values for `n` on the interval...&quot;</span>
        <span class="s1">shape_bounds </span><span class="s2">= [(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;There are no integer values for `n` on the interval...&quot;</span>
        <span class="s1">shape_bounds </span><span class="s2">= [(</span><span class="s4">1.4</span><span class="s2">, </span><span class="s4">1.6</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;The intersection of user-provided bounds for `n`&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= [(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_guess_iv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Guesses provided for the following unrecognized...&quot;</span>
        <span class="s1">guess </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: </span><span class="s4">1</span><span class="s2">, </span><span class="s5">'p'</span><span class="s2">: </span><span class="s4">0.5</span><span class="s2">, </span><span class="s5">'1'</span><span class="s2">: </span><span class="s4">255</span><span class="s2">}</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Each element of `guess` must be a scalar...&quot;</span>
        <span class="s1">guess </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: </span><span class="s4">1</span><span class="s2">, </span><span class="s5">'p'</span><span class="s2">: </span><span class="s5">'hi'</span><span class="s2">}</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>
        <span class="s1">guess </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s5">'f'</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>
        <span class="s1">guess </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;A `guess` sequence must contain at least 2...&quot;</span>
        <span class="s1">guess </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;A `guess` sequence may not contain more than 3...&quot;</span>
        <span class="s1">guess </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Guess for parameter `n` rounded.*|Guess for parameter `p` clipped.*&quot;</span>
        <span class="s1">guess </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: </span><span class="s4">4.5</span><span class="s2">, </span><span class="s5">'p'</span><span class="s2">: -</span><span class="s4">0.5</span><span class="s2">}</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Guess for parameter `loc` rounded...&quot;</span>
        <span class="s1">guess </span><span class="s2">= [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Guess for parameter `p` clipped...&quot;</span>
        <span class="s1">guess </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s5">'p'</span><span class="s2">: -</span><span class="s4">0.5</span><span class="s2">}</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Guess for parameter `loc` clipped...&quot;</span>
        <span class="s1">guess </span><span class="s2">= [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">data</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">shape_bounds_d</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">guess</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">basic_fit_test</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dist_name</span><span class="s2">, </span><span class="s1">method</span><span class="s2">):</span>

        <span class="s1">N </span><span class="s2">= </span><span class="s4">5000</span>
        <span class="s1">dist_data </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">distcont </span><span class="s2">+ </span><span class="s1">distdiscrete</span><span class="s2">)</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">dist_name</span><span class="s2">)</span>
        <span class="s1">shapes </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">dist_data</span><span class="s2">[</span><span class="s1">dist_name</span><span class="s2">])</span>
        <span class="s1">bounds </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">((</span><span class="s1">len</span><span class="s2">(</span><span class="s1">shapes</span><span class="s2">) + </span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
        <span class="s1">bounds</span><span class="s2">[:-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">] = </span><span class="s1">shapes</span><span class="s2">/</span><span class="s4">10.</span><span class="s2">**</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sign</span><span class="s2">(</span><span class="s1">shapes</span><span class="s2">)</span>
        <span class="s1">bounds</span><span class="s2">[:-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">] = </span><span class="s1">shapes</span><span class="s2">*</span><span class="s4">10.</span><span class="s2">**</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sign</span><span class="s2">(</span><span class="s1">shapes</span><span class="s2">)</span>
        <span class="s1">bounds</span><span class="s2">[-</span><span class="s4">2</span><span class="s2">] = (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">bounds</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">] = (</span><span class="s4">1e-16</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
        <span class="s1">loc </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(*</span><span class="s1">bounds</span><span class="s2">[-</span><span class="s4">2</span><span class="s2">])</span>
        <span class="s1">scale </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(*</span><span class="s1">bounds</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">])</span>
        <span class="s1">ref </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">dist_data</span><span class="s2">[</span><span class="s1">dist_name</span><span class="s2">]) + [</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">]</span>

        <span class="s0">if </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s5">'pmf'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
            <span class="s1">ref </span><span class="s2">= </span><span class="s1">ref</span><span class="s2">[:-</span><span class="s4">1</span><span class="s2">]</span>
            <span class="s1">ref</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">)</span>
            <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">ref</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
            <span class="s1">bounds </span><span class="s2">= </span><span class="s1">bounds</span><span class="s2">[:-</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s5">'pdf'</span><span class="s2">, </span><span class="s0">False</span><span class="s2">):</span>
            <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">ref</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">npt</span><span class="s2">.</span><span class="s1">suppress_warnings</span><span class="s2">() </span><span class="s0">as </span><span class="s1">sup</span><span class="s2">:</span>
            <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s5">&quot;overflow encountered&quot;</span><span class="s2">)</span>
            <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">,</span>
                            <span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>

        <span class="s1">nlff_names </span><span class="s2">= {</span><span class="s5">'mle'</span><span class="s2">: </span><span class="s5">'nnlf'</span><span class="s2">, </span><span class="s5">'mse'</span><span class="s2">: </span><span class="s5">'_penalized_nlpsf'</span><span class="s2">}</span>
        <span class="s1">nlff_name </span><span class="s2">= </span><span class="s1">nlff_names</span><span class="s2">[</span><span class="s1">method</span><span class="s2">]</span>
        <span class="s1">assert_nlff_less_or_close</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">,</span>
                                  <span class="s1">nlff_name</span><span class="s2">=</span><span class="s1">nlff_name</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;dist_name&quot;</span><span class="s2">, </span><span class="s1">cases_test_fit_mle</span><span class="s2">())</span>
    <span class="s0">def </span><span class="s1">test_basic_fit_mle</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dist_name</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">basic_fit_test</span><span class="s2">(</span><span class="s1">dist_name</span><span class="s2">, </span><span class="s5">&quot;mle&quot;</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;dist_name&quot;</span><span class="s2">, </span><span class="s1">cases_test_fit_mse</span><span class="s2">())</span>
    <span class="s0">def </span><span class="s1">test_basic_fit_mse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">dist_name</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">basic_fit_test</span><span class="s2">(</span><span class="s1">dist_name</span><span class="s2">, </span><span class="s5">&quot;mse&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_arcsine</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Can't guarantee that all distributions will fit all data with</span>
        <span class="s3"># arbitrary bounds. This distribution just happens to fail above.</span>
        <span class="s3"># Try something slightly different.</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">arcsine</span>
        <span class="s1">shapes </span><span class="s2">= (</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">shapes</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s1">assert_nlff_less_or_close</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">shapes</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;method&quot;</span><span class="s2">, (</span><span class="s5">'mle'</span><span class="s2">, </span><span class="s5">'mse'</span><span class="s2">))</span>
    <span class="s0">def </span><span class="s1">test_argus</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">method</span><span class="s2">):</span>
        <span class="s3"># Can't guarantee that all distributions will fit all data with</span>
        <span class="s3"># arbitrary bounds. This distribution just happens to fail above.</span>
        <span class="s3"># Try something slightly different.</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">argus</span>
        <span class="s1">shapes </span><span class="s2">= (</span><span class="s4">1.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">shapes</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= {</span><span class="s5">'chi'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'loc'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>

        <span class="s1">assert_nlff_less_or_close</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">shapes</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_foldnorm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Can't guarantee that all distributions will fit all data with</span>
        <span class="s3"># arbitrary bounds. This distribution just happens to fail above.</span>
        <span class="s3"># Try something slightly different.</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">foldnorm</span>
        <span class="s1">shapes </span><span class="s2">= (</span><span class="s4">1.952125337355587</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">shapes</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= {</span><span class="s5">'c'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'loc'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>

        <span class="s1">assert_nlff_less_or_close</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">shapes</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_truncpareto</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Can't guarantee that all distributions will fit all data with</span>
        <span class="s3"># arbitrary bounds. This distribution just happens to fail above.</span>
        <span class="s3"># Try something slightly different.</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">truncpareto</span>
        <span class="s1">shapes </span><span class="s2">= (</span><span class="s4">1.8</span><span class="s2">, </span><span class="s4">5.3</span><span class="s2">, </span><span class="s4">2.3</span><span class="s2">, </span><span class="s4">4.1</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">shapes</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= [(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)]*</span><span class="s4">4</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>

        <span class="s1">assert_nlff_less_or_close</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">shapes</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_truncweibull_min</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Can't guarantee that all distributions will fit all data with</span>
        <span class="s3"># arbitrary bounds. This distribution just happens to fail above.</span>
        <span class="s3"># Try something slightly different.</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">truncweibull_min</span>
        <span class="s1">shapes </span><span class="s2">= (</span><span class="s4">2.5</span><span class="s2">, </span><span class="s4">0.25</span><span class="s2">, </span><span class="s4">1.75</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">3.</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">shapes</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= [(</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)]*</span><span class="s4">5</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>

        <span class="s1">assert_nlff_less_or_close</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">shapes</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_missing_shape_bounds</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># some distributions have a small domain w.r.t. a parameter, e.g.</span>
        <span class="s3"># $p \in [0, 1]$ for binomial distribution</span>
        <span class="s3"># User does not need to provide these because the intersection of the</span>
        <span class="s3"># user's bounds (none) and the distribution's domain is finite</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">1000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>

        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">binom</span>
        <span class="s1">n</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">loc </span><span class="s2">= </span><span class="s4">10</span><span class="s2">, </span><span class="s4">0.65</span><span class="s2">, </span><span class="s4">0</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">20</span><span class="s2">])}  </span><span class="s3"># check arrays are OK, too</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s1">n</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">), **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">bernoulli</span>
        <span class="s1">p</span><span class="s2">, </span><span class="s1">loc </span><span class="s2">= </span><span class="s4">0.314159</span><span class="s2">, </span><span class="s4">0</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s1">p</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">), **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fit_only_loc_scale</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># fit only loc</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">5000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>

        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span>
        <span class="s1">loc</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">1</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">loc_bounds </span><span class="s2">= (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">bounds </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s1">loc_bounds</span><span class="s2">}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">), **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

        <span class="s3"># fit only scale</span>
        <span class="s1">loc</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s4">0</span><span class="s2">, </span><span class="s4">2.5</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">scale_bounds </span><span class="s2">= (</span><span class="s4">0.01</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">bounds </span><span class="s2">= {</span><span class="s5">'scale'</span><span class="s2">: </span><span class="s1">scale_bounds</span><span class="s2">}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">), **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

        <span class="s3"># fit only loc and scale</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span>
        <span class="s1">loc</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.5</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">bounds </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s1">loc_bounds</span><span class="s2">, </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s1">scale_bounds</span><span class="s2">}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">), **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_everything_fixed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">5000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>

        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span>
        <span class="s1">loc</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.5</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s3"># loc, scale fixed to 0, 1 by default</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

        <span class="s3"># loc, scale explicitly fixed</span>
        <span class="s1">bounds </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: (</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: (</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">)}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">), **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

        <span class="s3"># `n` gets fixed during polishing</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">binom</span>
        <span class="s1">n</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">loc </span><span class="s2">= </span><span class="s4">10</span><span class="s2">, </span><span class="s4">0.65</span><span class="s2">, </span><span class="s4">0</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">n</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">shape_bounds </span><span class="s2">= {</span><span class="s5">'n'</span><span class="s2">: (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">20</span><span class="s2">), </span><span class="s5">'p'</span><span class="s2">: (</span><span class="s4">0.65</span><span class="s2">, </span><span class="s4">0.65</span><span class="s2">)}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">shape_bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, (</span><span class="s1">n</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">), **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_failure</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">5000</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">)</span>

        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">nbinom</span>
        <span class="s1">shapes </span><span class="s2">= (</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">shapes</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s0">assert </span><span class="s1">data</span><span class="s2">.</span><span class="s1">min</span><span class="s2">() == </span><span class="s4">0</span>
        <span class="s3"># With lower bounds on location at 0.5, likelihood is zero</span>
        <span class="s1">bounds </span><span class="s2">= [(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">30</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), (</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)]</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">)</span>
        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;Optimization converged to parameter values that are&quot;</span>
        <span class="s0">assert </span><span class="s1">res</span><span class="s2">.</span><span class="s1">message</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s1">message</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">res</span><span class="s2">.</span><span class="s1">success </span><span class="s0">is False</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span>
    <span class="s0">def </span><span class="s1">test_guess</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test that guess helps DE find the desired solution</span>
        <span class="s1">N </span><span class="s2">= </span><span class="s4">2000</span>
        <span class="s3"># With some seeds, `fit` doesn't need a guess</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">196390444561</span><span class="s2">)</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">nhypergeom</span>
        <span class="s1">params </span><span class="s2">= (</span><span class="s4">20</span><span class="s2">, </span><span class="s4">7</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>
        <span class="s1">bounds </span><span class="s2">= [(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">200</span><span class="s2">), (</span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">70</span><span class="s2">), (</span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">120</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)]</span>

        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">params</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s1">N</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">guess</span><span class="s2">=</span><span class="s1">params</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">opt</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, **</span><span class="s1">self</span><span class="s2">.</span><span class="s1">tols</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_mse_accuracy_1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test maximum spacing estimation against example from Wikipedia</span>
        <span class="s3"># https://en.wikipedia.org/wiki/Maximum_spacing_estimation#Examples</span>
        <span class="s1">data </span><span class="s2">= [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">4</span><span class="s2">]</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">expon</span>
        <span class="s1">bounds </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: (</span><span class="s4">1e-8</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)}</span>
        <span class="s1">res_mle </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">=</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s5">'mle'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res_mle</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-3</span><span class="s2">)</span>
        <span class="s1">res_mse </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">=</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s5">'mse'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res_mse</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">, </span><span class="s4">3.915</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_mse_accuracy_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test maximum spacing estimation against example from Wikipedia</span>
        <span class="s3"># https://en.wikipedia.org/wiki/Maximum_spacing_estimation#Examples</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">9843212616816518964</span><span class="s2">)</span>

        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">uniform</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s4">10</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s4">6</span><span class="s2">).</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s1">n</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">bounds </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: (</span><span class="s4">1e-8</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">=</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s5">'mse'</span><span class="s2">)</span>
        <span class="s3"># (loc=3.608118420015416, scale=5.509323262055043)</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
        <span class="s1">a </span><span class="s2">= (</span><span class="s1">n</span><span class="s2">*</span><span class="s1">x</span><span class="s2">[</span><span class="s4">0</span><span class="s2">] - </span><span class="s1">x</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">])/(</span><span class="s1">n </span><span class="s2">- </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">b </span><span class="s2">= (</span><span class="s1">n</span><span class="s2">*</span><span class="s1">x</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">] - </span><span class="s1">x</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])/(</span><span class="s1">n </span><span class="s2">- </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s1">ref </span><span class="s2">= </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">-</span><span class="s1">a  </span><span class="s3"># (3.6081133632151503, 5.509328130317254)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">params</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>


<span class="s3"># Data from Matlab: https://www.mathworks.com/help/stats/lillietest.html</span>
<span class="s1">examgrades </span><span class="s2">= [</span><span class="s4">65</span><span class="s2">, </span><span class="s4">61</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">88</span><span class="s2">, </span><span class="s4">69</span><span class="s2">, </span><span class="s4">89</span><span class="s2">, </span><span class="s4">55</span><span class="s2">, </span><span class="s4">84</span><span class="s2">, </span><span class="s4">86</span><span class="s2">, </span><span class="s4">84</span><span class="s2">, </span><span class="s4">71</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">84</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">78</span><span class="s2">, </span><span class="s4">67</span><span class="s2">,</span>
              <span class="s4">96</span><span class="s2">, </span><span class="s4">66</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, </span><span class="s4">59</span><span class="s2">, </span><span class="s4">71</span><span class="s2">, </span><span class="s4">69</span><span class="s2">, </span><span class="s4">63</span><span class="s2">, </span><span class="s4">79</span><span class="s2">, </span><span class="s4">76</span><span class="s2">, </span><span class="s4">63</span><span class="s2">, </span><span class="s4">85</span><span class="s2">, </span><span class="s4">87</span><span class="s2">, </span><span class="s4">88</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">71</span><span class="s2">,</span>
              <span class="s4">65</span><span class="s2">, </span><span class="s4">84</span><span class="s2">, </span><span class="s4">71</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">79</span><span class="s2">, </span><span class="s4">64</span><span class="s2">, </span><span class="s4">65</span><span class="s2">, </span><span class="s4">84</span><span class="s2">, </span><span class="s4">77</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, </span><span class="s4">84</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">92</span><span class="s2">,</span>
              <span class="s4">90</span><span class="s2">, </span><span class="s4">79</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">71</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">71</span><span class="s2">, </span><span class="s4">58</span><span class="s2">, </span><span class="s4">79</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">64</span><span class="s2">, </span><span class="s4">77</span><span class="s2">, </span><span class="s4">82</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">59</span><span class="s2">, </span><span class="s4">54</span><span class="s2">, </span><span class="s4">82</span><span class="s2">,</span>
              <span class="s4">57</span><span class="s2">, </span><span class="s4">79</span><span class="s2">, </span><span class="s4">79</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">74</span><span class="s2">, </span><span class="s4">82</span><span class="s2">, </span><span class="s4">63</span><span class="s2">, </span><span class="s4">64</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">69</span><span class="s2">, </span><span class="s4">87</span><span class="s2">, </span><span class="s4">68</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">83</span><span class="s2">, </span><span class="s4">73</span><span class="s2">,</span>
              <span class="s4">80</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">73</span><span class="s2">, </span><span class="s4">71</span><span class="s2">, </span><span class="s4">66</span><span class="s2">, </span><span class="s4">78</span><span class="s2">, </span><span class="s4">64</span><span class="s2">, </span><span class="s4">74</span><span class="s2">, </span><span class="s4">68</span><span class="s2">, </span><span class="s4">67</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">85</span><span class="s2">, </span><span class="s4">74</span><span class="s2">, </span><span class="s4">76</span><span class="s2">,</span>
              <span class="s4">80</span><span class="s2">, </span><span class="s4">77</span><span class="s2">, </span><span class="s4">93</span><span class="s2">, </span><span class="s4">70</span><span class="s2">, </span><span class="s4">86</span><span class="s2">, </span><span class="s4">80</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">83</span><span class="s2">, </span><span class="s4">68</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">85</span><span class="s2">, </span><span class="s4">64</span><span class="s2">, </span><span class="s4">74</span><span class="s2">, </span><span class="s4">82</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">77</span><span class="s2">,</span>
              <span class="s4">66</span><span class="s2">, </span><span class="s4">85</span><span class="s2">, </span><span class="s4">75</span><span class="s2">, </span><span class="s4">81</span><span class="s2">, </span><span class="s4">69</span><span class="s2">, </span><span class="s4">60</span><span class="s2">, </span><span class="s4">83</span><span class="s2">, </span><span class="s4">72</span><span class="s2">]</span>


<span class="s0">class </span><span class="s1">TestGoodnessOfFit</span><span class="s2">:</span>

    <span class="s0">def </span><span class="s1">test_gof_iv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">dist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">r&quot;`dist` must be a \(non-frozen\) instance of...&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">(), </span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;`data` must be a one-dimensional array of numbers.&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]])</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;`statistic` must be one of...&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">statistic</span><span class="s2">=</span><span class="s5">'mm'</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;`n_mc_samples` must be an integer.&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">n_mc_samples</span><span class="s2">=</span><span class="s4">1000.5</span><span class="s2">)</span>

        <span class="s1">message </span><span class="s2">= </span><span class="s5">&quot;'herring' cannot be used to seed a&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
            <span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s5">'herring'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_against_ks</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">8517426291317196949</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">examgrades</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">std</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">ddof</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">,</span>
                              <span class="s1">statistic</span><span class="s2">=</span><span class="s5">'ks'</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">ref </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kstest</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">(**</span><span class="s1">known_params</span><span class="s2">).</span><span class="s1">cdf</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s5">'exact'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">)  </span><span class="s3"># ~0.0848</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-3</span><span class="s2">)  </span><span class="s3"># ~0.335</span>

    <span class="s0">def </span><span class="s1">test_against_lilliefors</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">2291803665717442724</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">examgrades</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">statistic</span><span class="s2">=</span><span class="s5">'ks'</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">std</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">ddof</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)}</span>
        <span class="s1">ref </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kstest</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">(**</span><span class="s1">known_params</span><span class="s2">).</span><span class="s1">cdf</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s5">'exact'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">)  </span><span class="s3"># ~0.0848</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s4">0.0348</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_against_cvm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">8674330857509546614</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">examgrades</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">std</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">ddof</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">,</span>
                              <span class="s1">statistic</span><span class="s2">=</span><span class="s5">'cvm'</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">ref </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">cramervonmises</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">(**</span><span class="s1">known_params</span><span class="s2">).</span><span class="s1">cdf</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">)  </span><span class="s3"># ~0.090</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-3</span><span class="s2">)  </span><span class="s3"># ~0.636</span>

    <span class="s0">def </span><span class="s1">test_against_anderson_case_0</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># &quot;Case 0&quot; is where loc and scale are known [1]</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">7384539336846690410</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">101</span><span class="s2">)</span>
        <span class="s3"># loc that produced critical value of statistic found w/ root_scalar</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s4">45.01575354024957</span><span class="s2">, </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s4">30</span><span class="s2">}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">,</span>
                              <span class="s1">statistic</span><span class="s2">=</span><span class="s5">'ad'</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s4">2.492</span><span class="s2">)  </span><span class="s3"># See [1] Table 1A 1.0</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_against_anderson_case_1</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># &quot;Case 1&quot; is where scale is known and loc is fit [1]</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">5040212485680146248</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">101</span><span class="s2">)</span>
        <span class="s3"># scale that produced critical value of statistic found w/ root_scalar</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'scale'</span><span class="s2">: </span><span class="s4">29.957112639101933</span><span class="s2">}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">,</span>
                              <span class="s1">statistic</span><span class="s2">=</span><span class="s5">'ad'</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s4">0.908</span><span class="s2">)  </span><span class="s3"># See [1] Table 1B 1.1</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_against_anderson_case_2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># &quot;Case 2&quot; is where loc is known and scale is fit [1]</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">726693985720914083</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">101</span><span class="s2">)</span>
        <span class="s3"># loc that produced critical value of statistic found w/ root_scalar</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s4">44.5680212261933</span><span class="s2">}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">,</span>
                              <span class="s1">statistic</span><span class="s2">=</span><span class="s5">'ad'</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s4">2.904</span><span class="s2">)  </span><span class="s3"># See [1] Table 1B 1.2</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s4">0.025</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_against_anderson_case_3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># &quot;Case 3&quot; is where both loc and scale are fit [1]</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">6763691329830218206</span><span class="s2">)</span>
        <span class="s3"># c that produced critical value of statistic found w/ root_scalar</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">skewnorm</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s4">1.4477847789132101</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">100</span><span class="s2">,</span>
                               <span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">statistic</span><span class="s2">=</span><span class="s5">'ad'</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s4">0.559</span><span class="s2">)  </span><span class="s3"># See [1] Table 1B 1.2</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s4">0.15</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-3</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span>
    <span class="s0">def </span><span class="s1">test_against_anderson_gumbel_r</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">7302761058217743</span><span class="s2">)</span>
        <span class="s3"># c that produced critical value of statistic found w/ root_scalar</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">genextreme</span><span class="s2">(</span><span class="s4">0.051896837188595134</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">,</span>
                             <span class="s1">scale</span><span class="s2">=</span><span class="s4">1.5</span><span class="s2">).</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">gumbel_r</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">statistic</span><span class="s2">=</span><span class="s5">'ad'</span><span class="s2">,</span>
                              <span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">ref </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">anderson</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">dist</span><span class="s2">=</span><span class="s5">'gumbel_r'</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">critical_values</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">significance_level</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]/</span><span class="s4">100</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">5e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_against_filliben_norm</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test against `stats.fit` ref. [7] Section 8 &quot;Example&quot;</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">8024266430745011915</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= [</span><span class="s4">6</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">4</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, -</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s4">0</span><span class="s2">, </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s4">1</span><span class="s2">}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">,</span>
                                    <span class="s1">statistic</span><span class="s2">=</span><span class="s5">&quot;filliben&quot;</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s3"># Slight discrepancy presumably due to roundoff in Filliben's</span>
        <span class="s3"># calculation. Using exact order statistic medians instead of</span>
        <span class="s3"># Filliben's approximation doesn't account for it.</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s4">0.98538</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s4">0.75 </span><span class="s2">&lt; </span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue </span><span class="s2">&lt; </span><span class="s4">0.9</span>

        <span class="s3"># Using R's ppcc library:</span>
        <span class="s3"># library(ppcc)</span>
        <span class="s3"># options(digits=16)</span>
        <span class="s3"># x &lt; - c(6, 1, -4, 8, -2, 5, 0)</span>
        <span class="s3"># set.seed(100)</span>
        <span class="s3"># ppccTest(x, &quot;qnorm&quot;, ppos=&quot;Filliben&quot;)</span>
        <span class="s3"># Discrepancy with</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s4">0.98540957187084</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">2e-5</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s4">0.8875</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">2e-3</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_filliben_property</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Filliben's statistic should be independent of data location and scale</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">8535677809395478813</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">,</span>
                                    <span class="s1">statistic</span><span class="s2">=</span><span class="s5">&quot;filliben&quot;</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s4">0</span><span class="s2">, </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s4">1</span><span class="s2">}</span>
        <span class="s1">ref </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">,</span>
                                    <span class="s1">statistic</span><span class="s2">=</span><span class="s5">&quot;filliben&quot;</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-15</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'case'</span><span class="s2">, [(</span><span class="s4">25</span><span class="s2">, [</span><span class="s4">.928</span><span class="s2">, </span><span class="s4">.937</span><span class="s2">, </span><span class="s4">.950</span><span class="s2">, </span><span class="s4">.958</span><span class="s2">, </span><span class="s4">.966</span><span class="s2">]),</span>
                                      <span class="s2">(</span><span class="s4">50</span><span class="s2">, [</span><span class="s4">.959</span><span class="s2">, </span><span class="s4">.965</span><span class="s2">, </span><span class="s4">.972</span><span class="s2">, </span><span class="s4">.977</span><span class="s2">, </span><span class="s4">.981</span><span class="s2">]),</span>
                                      <span class="s2">(</span><span class="s4">95</span><span class="s2">, [</span><span class="s4">.977</span><span class="s2">, </span><span class="s4">.979</span><span class="s2">, </span><span class="s4">.983</span><span class="s2">, </span><span class="s4">.986</span><span class="s2">, </span><span class="s4">.989</span><span class="s2">])])</span>
    <span class="s0">def </span><span class="s1">test_against_filliben_norm_table</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">case</span><span class="s2">):</span>
        <span class="s3"># Test against `stats.fit` ref. [7] Table 1</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">504569995557928957</span><span class="s2">)</span>
        <span class="s1">n</span><span class="s2">, </span><span class="s1">ref </span><span class="s2">= </span><span class="s1">case</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s4">0</span><span class="s2">, </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s4">1</span><span class="s2">}</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">,</span>
                                    <span class="s1">statistic</span><span class="s2">=</span><span class="s5">&quot;filliben&quot;</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">percentiles </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.005</span><span class="s2">, </span><span class="s4">0.01</span><span class="s2">, </span><span class="s4">0.025</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">])</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">scoreatpercentile</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">null_distribution</span><span class="s2">, </span><span class="s1">percentiles</span><span class="s2">*</span><span class="s4">100</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">2e-3</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'case'</span><span class="s2">, [(</span><span class="s4">5</span><span class="s2">, </span><span class="s4">0.95772790260469</span><span class="s2">, </span><span class="s4">0.4755</span><span class="s2">),</span>
                                      <span class="s2">(</span><span class="s4">6</span><span class="s2">, </span><span class="s4">0.95398832257958</span><span class="s2">, </span><span class="s4">0.3848</span><span class="s2">),</span>
                                      <span class="s2">(</span><span class="s4">7</span><span class="s2">, </span><span class="s4">0.9432692889277</span><span class="s2">, </span><span class="s4">0.2328</span><span class="s2">)])</span>
    <span class="s0">def </span><span class="s1">test_against_ppcc</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">case</span><span class="s2">):</span>
        <span class="s3"># Test against R ppcc, e.g.</span>
        <span class="s3"># library(ppcc)</span>
        <span class="s3"># options(digits=16)</span>
        <span class="s3"># x &lt; - c(0.52325412, 1.06907699, -0.36084066, 0.15305959, 0.99093194)</span>
        <span class="s3"># set.seed(100)</span>
        <span class="s3"># ppccTest(x, &quot;qrayleigh&quot;, ppos=&quot;Filliben&quot;)</span>
        <span class="s1">n</span><span class="s2">, </span><span class="s1">ref_statistic</span><span class="s2">, </span><span class="s1">ref_pvalue </span><span class="s2">= </span><span class="s1">case</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">7777775561439803116</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">rayleigh</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">statistic</span><span class="s2">=</span><span class="s5">&quot;filliben&quot;</span><span class="s2">,</span>
                                    <span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">statistic</span><span class="s2">, </span><span class="s1">ref_statistic</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-4</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">.</span><span class="s1">pvalue</span><span class="s2">, </span><span class="s1">ref_pvalue</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">1.5e-2</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_params_effects</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Ensure that `guessed_params`, `fit_params`, and `known_params` have</span>
        <span class="s3"># the intended effects.</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">9121950977643805391</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">skewnorm</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(-</span><span class="s4">5.044559778383153</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">50</span><span class="s2">,</span>
                               <span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s3"># Show that `guessed_params` don't fit to the guess,</span>
        <span class="s3"># but `fit_params` and `known_params` respect the provided fit</span>
        <span class="s1">guessed_params </span><span class="s2">= {</span><span class="s5">'c'</span><span class="s2">: </span><span class="s4">13.4</span><span class="s2">}</span>
        <span class="s1">fit_params </span><span class="s2">= {</span><span class="s5">'scale'</span><span class="s2">: </span><span class="s4">13.73</span><span class="s2">}</span>
        <span class="s1">known_params </span><span class="s2">= {</span><span class="s5">'loc'</span><span class="s2">: -</span><span class="s4">13.85</span><span class="s2">}</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">9121950977643805391</span><span class="s2">)</span>
        <span class="s1">res1 </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">weibull_min</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">n_mc_samples</span><span class="s2">=</span><span class="s4">2</span><span class="s2">,</span>
                               <span class="s1">guessed_params</span><span class="s2">=</span><span class="s1">guessed_params</span><span class="s2">,</span>
                               <span class="s1">fit_params</span><span class="s2">=</span><span class="s1">fit_params</span><span class="s2">,</span>
                               <span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">res1</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">c</span><span class="s2">, </span><span class="s4">13.4</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res1</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">, </span><span class="s4">13.73</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res1</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">, -</span><span class="s4">13.85</span><span class="s2">)</span>

        <span class="s3"># Show that changing the guess changes the parameter that gets fit,</span>
        <span class="s3"># and it changes the null distribution</span>
        <span class="s1">guessed_params </span><span class="s2">= {</span><span class="s5">'c'</span><span class="s2">: </span><span class="s4">2</span><span class="s2">}</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">9121950977643805391</span><span class="s2">)</span>
        <span class="s1">res2 </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">weibull_min</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">n_mc_samples</span><span class="s2">=</span><span class="s4">2</span><span class="s2">,</span>
                               <span class="s1">guessed_params</span><span class="s2">=</span><span class="s1">guessed_params</span><span class="s2">,</span>
                               <span class="s1">fit_params</span><span class="s2">=</span><span class="s1">fit_params</span><span class="s2">,</span>
                               <span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">res2</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">c</span><span class="s2">,</span>
                               <span class="s1">res1</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">c</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-8</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">res2</span><span class="s2">.</span><span class="s1">null_distribution</span><span class="s2">,</span>
                               <span class="s1">res1</span><span class="s2">.</span><span class="s1">null_distribution</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s4">1e-8</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res2</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">, </span><span class="s4">13.73</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res2</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">, -</span><span class="s4">13.85</span><span class="s2">)</span>

        <span class="s3"># If we set all parameters as fit_params and known_params,</span>
        <span class="s3"># they're all fixed to those values, but the null distribution</span>
        <span class="s3"># varies.</span>
        <span class="s1">fit_params </span><span class="s2">= {</span><span class="s5">'c'</span><span class="s2">: </span><span class="s4">13.4</span><span class="s2">, </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s4">13.73</span><span class="s2">}</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">9121950977643805391</span><span class="s2">)</span>
        <span class="s1">res3 </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">weibull_min</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">n_mc_samples</span><span class="s2">=</span><span class="s4">2</span><span class="s2">,</span>
                               <span class="s1">guessed_params</span><span class="s2">=</span><span class="s1">guessed_params</span><span class="s2">,</span>
                               <span class="s1">fit_params</span><span class="s2">=</span><span class="s1">fit_params</span><span class="s2">,</span>
                               <span class="s1">known_params</span><span class="s2">=</span><span class="s1">known_params</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res3</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">c</span><span class="s2">, </span><span class="s4">13.4</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res3</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">, </span><span class="s4">13.73</span><span class="s2">)</span>
        <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res3</span><span class="s2">.</span><span class="s1">fit_result</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">, -</span><span class="s4">13.85</span><span class="s2">)</span>
        <span class="s0">assert not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">res3</span><span class="s2">.</span><span class="s1">null_distribution</span><span class="s2">, </span><span class="s1">res1</span><span class="s2">.</span><span class="s1">null_distribution</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_custom_statistic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s3"># Test support for custom statistic function.</span>

        <span class="s3"># References:</span>
        <span class="s3"># [1] Pyke, R. (1965).  &quot;Spacings&quot;.  Journal of the Royal Statistical</span>
        <span class="s3">#     Society: Series B (Methodological), 27(3): 395-436.</span>
        <span class="s3"># [2] Burrows, P. M. (1979).  &quot;Selected Percentage Points of</span>
        <span class="s3">#     Greenwood's Statistics&quot;.  Journal of the Royal Statistical</span>
        <span class="s3">#     Society. Series A (General), 142(2): 256-258.</span>

        <span class="s3"># Use the Greenwood statistic for illustration; see [1, p.402].</span>
        <span class="s0">def </span><span class="s1">greenwood</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, *, </span><span class="s1">axis</span><span class="s2">):</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s1">axis</span><span class="s2">)</span>
            <span class="s1">y </span><span class="s2">= </span><span class="s1">dist</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
            <span class="s1">d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s1">axis</span><span class="s2">, </span><span class="s1">prepend</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">append</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">d </span><span class="s2">** </span><span class="s4">2</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s1">axis</span><span class="s2">)</span>

        <span class="s3"># Run the Monte Carlo test with sample size = 5 on a fully specified</span>
        <span class="s3"># null distribution, and compare the simulated quantiles to the exact</span>
        <span class="s3"># ones given in [2, Table 1, column (n = 5)].</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">9121950977643805391</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">expon</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s4">5</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">goodness_of_fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">expon</span><span class="s2">, </span><span class="s1">data</span><span class="s2">,</span>
                                 <span class="s1">known_params</span><span class="s2">={</span><span class="s5">'loc'</span><span class="s2">: </span><span class="s4">0</span><span class="s2">, </span><span class="s5">'scale'</span><span class="s2">: </span><span class="s4">1</span><span class="s2">},</span>
                                 <span class="s1">statistic</span><span class="s2">=</span><span class="s1">greenwood</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">p </span><span class="s2">= [</span><span class="s4">.01</span><span class="s2">, </span><span class="s4">.05</span><span class="s2">, </span><span class="s4">.1</span><span class="s2">, </span><span class="s4">.2</span><span class="s2">, </span><span class="s4">.3</span><span class="s2">, </span><span class="s4">.4</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.6</span><span class="s2">, </span><span class="s4">.7</span><span class="s2">, </span><span class="s4">.8</span><span class="s2">, </span><span class="s4">.9</span><span class="s2">, </span><span class="s4">.95</span><span class="s2">, </span><span class="s4">.99</span><span class="s2">]</span>
        <span class="s1">exact_quantiles </span><span class="s2">= [</span>
            <span class="s4">.183863</span><span class="s2">, </span><span class="s4">.199403</span><span class="s2">, </span><span class="s4">.210088</span><span class="s2">, </span><span class="s4">.226040</span><span class="s2">, </span><span class="s4">.239947</span><span class="s2">, </span><span class="s4">.253677</span><span class="s2">, </span><span class="s4">.268422</span><span class="s2">,</span>
            <span class="s4">.285293</span><span class="s2">, </span><span class="s4">.306002</span><span class="s2">, </span><span class="s4">.334447</span><span class="s2">, </span><span class="s4">.382972</span><span class="s2">, </span><span class="s4">.432049</span><span class="s2">, </span><span class="s4">.547468</span><span class="s2">]</span>
        <span class="s1">simulated_quantiles </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">quantile</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">null_distribution</span><span class="s2">, </span><span class="s1">p</span><span class="s2">)</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">simulated_quantiles</span><span class="s2">, </span><span class="s1">exact_quantiles</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s4">0.005</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">TestFitResult</span><span class="s2">:</span>
    <span class="s0">def </span><span class="s1">test_plot_iv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">1769658657308472721</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">100</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s0">def </span><span class="s1">optimizer</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">differential_evolution</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s1">bounds </span><span class="s2">= [(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">30</span><span class="s2">), (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s1">optimizer</span><span class="s2">)</span>
        <span class="s0">try</span><span class="s2">:</span>
            <span class="s0">import </span><span class="s1">matplotlib  </span><span class="s3"># noqa: F401</span>
            <span class="s1">message </span><span class="s2">= </span><span class="s5">r&quot;`plot_type` must be one of \{'...&quot;</span>
            <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
                <span class="s1">res</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">plot_type</span><span class="s2">=</span><span class="s5">'llama'</span><span class="s2">)</span>
        <span class="s0">except </span><span class="s2">(</span><span class="s1">ModuleNotFoundError</span><span class="s2">, </span><span class="s1">ImportError</span><span class="s2">):</span>
            <span class="s3"># Avoid trying to call MPL with numpy 2.0-dev, because that fails</span>
            <span class="s3"># too often due to ABI mismatches and is hard to avoid. This test</span>
            <span class="s3"># will work fine again once MPL has done a 2.0-compatible release.</span>
            <span class="s0">if not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">__version__</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s5">'2.0.0.dev0'</span><span class="s2">):</span>
                <span class="s1">message </span><span class="s2">= </span><span class="s5">r&quot;matplotlib must be installed to use method `plot`.&quot;</span>
                <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ModuleNotFoundError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
                    <span class="s1">res</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">plot_type</span><span class="s2">=</span><span class="s5">'llama'</span><span class="s2">)</span>
</pre>
</body>
</html>