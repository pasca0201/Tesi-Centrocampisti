<html>
<head>
<title>test_streamplot.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_streamplot.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_array_almost_equal</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>


<span class="s0">def </span><span class="s1">velocity_field</span><span class="s2">():</span>
    <span class="s1">Y</span><span class="s2">, </span><span class="s1">X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mgrid</span><span class="s2">[-</span><span class="s3">3</span><span class="s2">:</span><span class="s3">3</span><span class="s2">:</span><span class="s3">100j</span><span class="s2">, -</span><span class="s3">3</span><span class="s2">:</span><span class="s3">3</span><span class="s2">:</span><span class="s3">200j</span><span class="s2">]</span>
    <span class="s1">U </span><span class="s2">= -</span><span class="s3">1 </span><span class="s2">- </span><span class="s1">X</span><span class="s2">**</span><span class="s3">2 </span><span class="s2">+ </span><span class="s1">Y</span>
    <span class="s1">V </span><span class="s2">= </span><span class="s3">1 </span><span class="s2">+ </span><span class="s1">X </span><span class="s2">- </span><span class="s1">Y</span><span class="s2">**</span><span class="s3">2</span>
    <span class="s0">return </span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span>


<span class="s0">def </span><span class="s1">swirl_velocity_field</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">3.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">200</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">3.</span><span class="s2">, </span><span class="s3">3.</span><span class="s2">, </span><span class="s3">100</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s3">0.1</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) * (-</span><span class="s1">Y</span><span class="s2">) - </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) * </span><span class="s1">X</span>
    <span class="s1">V </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) * (-</span><span class="s1">Y</span><span class="s2">) + </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) * </span><span class="s1">X</span>
    <span class="s0">return </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'streamplot_startpoints'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">,</span>
                  <span class="s1">extensions</span><span class="s2">=[</span><span class="s4">'png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_startpoints</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s1">velocity_field</span><span class="s2">()</span>
    <span class="s1">start_x</span><span class="s2">, </span><span class="s1">start_y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">X</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(), </span><span class="s1">X</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(), </span><span class="s3">5</span><span class="s2">),</span>
                                   <span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s1">Y</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(), </span><span class="s1">Y</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(), </span><span class="s3">5</span><span class="s2">))</span>
    <span class="s1">start_points </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">column_stack</span><span class="s2">([</span><span class="s1">start_x</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">(), </span><span class="s1">start_y</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">()])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">start_points</span><span class="s2">=</span><span class="s1">start_points</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">start_x</span><span class="s2">, </span><span class="s1">start_y</span><span class="s2">, </span><span class="s4">'ok'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'streamplot_colormap'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s3">0.022</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_colormap</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s1">velocity_field</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">U</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s3">0.6</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s3">2</span><span class="s2">,</span>
                   <span class="s1">cmap</span><span class="s2">=</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">autumn</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">colorbar</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'streamplot_linewidth'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s3">0.004</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_linewidth</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s1">velocity_field</span><span class="s2">()</span>
    <span class="s1">speed </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hypot</span><span class="s2">(</span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">)</span>
    <span class="s1">lw </span><span class="s2">= </span><span class="s3">5 </span><span class="s2">* </span><span class="s1">speed </span><span class="s2">/ </span><span class="s1">speed</span><span class="s2">.</span><span class="s1">max</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=[</span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'k'</span><span class="s2">, </span><span class="s1">linewidth</span><span class="s2">=</span><span class="s1">lw</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'streamplot_masks_and_nans'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_masks_and_nans</span><span class="s2">():</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s1">velocity_field</span><span class="s2">()</span>
    <span class="s1">mask </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">U</span><span class="s2">.</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">bool</span><span class="s2">)</span>
    <span class="s1">mask</span><span class="s2">[</span><span class="s3">40</span><span class="s2">:</span><span class="s3">60</span><span class="s2">, </span><span class="s3">80</span><span class="s2">:</span><span class="s3">120</span><span class="s2">] = </span><span class="s3">1</span>
    <span class="s1">U</span><span class="s2">[:</span><span class="s3">20</span><span class="s2">, :</span><span class="s3">40</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">U</span><span class="s2">, </span><span class="s1">mask</span><span class="s2">=</span><span class="s1">mask</span><span class="s2">)</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">invalid</span><span class="s2">=</span><span class="s4">'ignore'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s1">U</span><span class="s2">, </span><span class="s1">cmap</span><span class="s2">=</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">Blues</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'streamplot_maxlength.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s3">0.302</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_maxlength</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s1">swirl_velocity_field</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">maxlength</span><span class="s2">=</span><span class="s3">10.</span><span class="s2">, </span><span class="s1">start_points</span><span class="s2">=[[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">]],</span>
                  <span class="s1">linewidth</span><span class="s2">=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s3">3</span>
    <span class="s5"># Compatibility for old test image</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">3.2555988021882305</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">3.078326760195413</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'streamplot_maxlength_no_broken.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s3">0.302</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_maxlength_no_broken</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s1">swirl_velocity_field</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">maxlength</span><span class="s2">=</span><span class="s3">10.</span><span class="s2">, </span><span class="s1">start_points</span><span class="s2">=[[</span><span class="s3">0.</span><span class="s2">, </span><span class="s3">1.5</span><span class="s2">]],</span>
                  <span class="s1">linewidth</span><span class="s2">=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">broken_streamlines</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">()[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_ylim</span><span class="s2">()[-</span><span class="s3">1</span><span class="s2">] == </span><span class="s3">3</span>
    <span class="s5"># Compatibility for old test image</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s1">xlim</span><span class="s2">=(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">3.2555988021882305</span><span class="s2">), </span><span class="s1">ylim</span><span class="s2">=(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">3.078326760195413</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'streamplot_direction.png'</span><span class="s2">],</span>
                  <span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s4">'mpl20'</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s3">0.073</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_direction</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s1">swirl_velocity_field</span><span class="s2">()</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">integration_direction</span><span class="s2">=</span><span class="s4">'backward'</span><span class="s2">,</span>
                   <span class="s1">maxlength</span><span class="s2">=</span><span class="s3">1.5</span><span class="s2">, </span><span class="s1">start_points</span><span class="s2">=[[</span><span class="s3">1.5</span><span class="s2">, </span><span class="s3">0.</span><span class="s2">]],</span>
                   <span class="s1">linewidth</span><span class="s2">=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s3">2</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_streamplot_limits</span><span class="s2">():</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">axes</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">4</span><span class="s2">, </span><span class="s3">10</span><span class="s2">)</span>
    <span class="s1">y</span><span class="s2">, </span><span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">trans </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Affine2D</span><span class="s2">().</span><span class="s1">translate</span><span class="s2">(</span><span class="s3">25</span><span class="s2">, </span><span class="s3">32</span><span class="s2">) + </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transData</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">barbs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">x</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">y</span><span class="s2">), </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">trans</span><span class="s2">)</span>
    <span class="s5"># The calculated bounds are approximately the bounds of the original data,</span>
    <span class="s5"># this is because the entire path is taken into account when updating the</span>
    <span class="s5"># datalim.</span>
    <span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">dataLim</span><span class="s2">.</span><span class="s1">bounds</span><span class="s2">, (</span><span class="s3">20</span><span class="s2">, </span><span class="s3">30</span><span class="s2">, </span><span class="s3">15</span><span class="s2">, </span><span class="s3">6</span><span class="s2">),</span>
                              <span class="s1">decimal</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_streamplot_grid</span><span class="s2">():</span>
    <span class="s1">u </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">))</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s3">2</span><span class="s2">, </span><span class="s3">2</span><span class="s2">))</span>

    <span class="s5"># Test for same rows and columns</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">], [</span><span class="s3">10</span><span class="s2">, </span><span class="s3">30</span><span class="s2">]])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s2">], [</span><span class="s3">20</span><span class="s2">, </span><span class="s3">20</span><span class="s2">]])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;The rows of 'x' must be equal&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">], [</span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">]])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s2">], [</span><span class="s3">20</span><span class="s2">, </span><span class="s3">30</span><span class="s2">]])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;The columns of 'y' must be equal&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">], [</span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">]])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s3">10</span><span class="s2">, </span><span class="s3">10</span><span class="s2">], [</span><span class="s3">20</span><span class="s2">, </span><span class="s3">20</span><span class="s2">]])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>

    <span class="s5"># Test for maximum dimensions</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[[</span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">]]])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'y' can have at maximum &quot;</span>
                                         <span class="s4">&quot;2 dimensions&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>

    <span class="s5"># Test for equal spacing</span>
    <span class="s1">u </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">))</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">))</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">20</span><span class="s2">])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">10</span><span class="s2">, </span><span class="s3">30</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'y' values must be equally spaced&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>

    <span class="s5"># Test for strictly increasing</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">40</span><span class="s2">])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">0</span><span class="s2">, </span><span class="s3">20</span><span class="s2">, </span><span class="s3">10</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s4">&quot;'y' must be strictly increasing&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_streamplot_inputs</span><span class="s2">():  </span><span class="s5"># test no exception occurs.</span>
    <span class="s5"># fully-masked</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">3</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">3</span><span class="s2">),</span>
                   <span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">full</span><span class="s2">((</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">),</span>
                   <span class="s1">color</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">))</span>
    <span class="s5"># array-likes</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">streamplot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s3">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s3">3</span><span class="s2">),</span>
                   <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s3">3</span><span class="s2">, </span><span class="s3">3</span><span class="s2">))</span>
</pre>
</body>
</html>