<html>
<head>
<title>test_fitpack2.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #2aacb8;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_fitpack2.py</font>
</center></td></tr></table>
<pre><span class="s0"># Created by Pearu Peterson, June 2003</span>
<span class="s2">import </span><span class="s1">itertools</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">from </span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">testing </span><span class="s2">import </span><span class="s3">(</span><span class="s1">assert_equal</span><span class="s3">, </span><span class="s1">assert_almost_equal</span><span class="s3">, </span><span class="s1">assert_array_equal</span><span class="s3">,</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">, </span><span class="s1">assert_allclose</span><span class="s3">, </span><span class="s1">suppress_warnings</span><span class="s3">)</span>
<span class="s2">from </span><span class="s1">pytest </span><span class="s2">import </span><span class="s1">raises </span><span class="s2">as </span><span class="s1">assert_raises</span>

<span class="s2">from </span><span class="s1">numpy </span><span class="s2">import </span><span class="s1">array</span><span class="s3">, </span><span class="s1">diff</span><span class="s3">, </span><span class="s1">linspace</span><span class="s3">, </span><span class="s1">meshgrid</span><span class="s3">, </span><span class="s1">ones</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">shape</span>
<span class="s2">from </span><span class="s1">scipy</span><span class="s3">.</span><span class="s1">interpolate</span><span class="s3">.</span><span class="s1">_fitpack_py </span><span class="s2">import </span><span class="s1">bisplrep</span><span class="s3">, </span><span class="s1">bisplev</span><span class="s3">, </span><span class="s1">splrep</span><span class="s3">, </span><span class="s1">spalde</span>
<span class="s2">from </span><span class="s1">scipy</span><span class="s3">.</span><span class="s1">interpolate</span><span class="s3">.</span><span class="s1">_fitpack2 </span><span class="s2">import </span><span class="s3">(</span><span class="s1">UnivariateSpline</span><span class="s3">,</span>
        <span class="s1">LSQUnivariateSpline</span><span class="s3">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s3">,</span>
        <span class="s1">LSQBivariateSpline</span><span class="s3">, </span><span class="s1">SmoothBivariateSpline</span><span class="s3">, </span><span class="s1">RectBivariateSpline</span><span class="s3">,</span>
        <span class="s1">LSQSphereBivariateSpline</span><span class="s3">, </span><span class="s1">SmoothSphereBivariateSpline</span><span class="s3">,</span>
        <span class="s1">RectSphereBivariateSpline</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestUnivariateSpline</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_linear_constant</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">k</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">(),[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_coeffs</span><span class="s3">(),[</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_residual</span><span class="s3">(),</span><span class="s4">0.0</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1.5</span><span class="s3">,</span><span class="s4">2</span><span class="s3">]),[</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">])</span>

    <span class="s2">def </span><span class="s1">test_preserve_shape</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">]</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">arg </span><span class="s3">= </span><span class="s4">2</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">shape</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">), </span><span class="s1">shape</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">)))</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">shape</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">), </span><span class="s1">shape</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">, </span><span class="s1">nu</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)))</span>
        <span class="s1">arg </span><span class="s3">= [</span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">]</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">shape</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">), </span><span class="s1">shape</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">)))</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">shape</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">), </span><span class="s1">shape</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">, </span><span class="s1">nu</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)))</span>

    <span class="s2">def </span><span class="s1">test_linear_1d</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">0</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">4</span><span class="s3">]</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">k</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">(),[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_coeffs</span><span class="s3">(),[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">4</span><span class="s3">])</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_residual</span><span class="s3">(),</span><span class="s4">0.0</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1.5</span><span class="s3">,</span><span class="s4">2</span><span class="s3">]),[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">])</span>

    <span class="s2">def </span><span class="s1">test_subclassing</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># See #731</span>

        <span class="s2">class </span><span class="s1">ZeroSpline</span><span class="s3">(</span><span class="s1">UnivariateSpline</span><span class="s3">):</span>
            <span class="s2">def </span><span class="s1">__call__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">x</span><span class="s3">):</span>
                <span class="s2">return </span><span class="s4">0</span><span class="s3">*</span><span class="s1">array</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>

        <span class="s1">sp </span><span class="s3">= </span><span class="s1">ZeroSpline</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">], [</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">], </span><span class="s1">k</span><span class="s3">=</span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">sp</span><span class="s3">([</span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">]), [</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">])</span>

    <span class="s2">def </span><span class="s1">test_empty_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test whether empty input returns an empty output. Ticket 1014</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">5</span><span class="s3">,</span><span class="s4">7</span><span class="s3">,</span><span class="s4">9</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">0</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">9</span><span class="s3">,</span><span class="s4">12</span><span class="s3">,</span><span class="s4">21</span><span class="s3">]</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">([]), </span><span class="s1">array</span><span class="s3">([]))</span>

    <span class="s2">def </span><span class="s1">test_roots</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">9</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">21</span><span class="s3">]</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">.</span><span class="s1">roots</span><span class="s3">()[</span><span class="s4">0</span><span class="s3">], </span><span class="s4">1.050290639101332</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_roots_length</span><span class="s3">(</span><span class="s1">self</span><span class="s3">): </span><span class="s0"># for gh18335</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">50 </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1000</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">cos</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">)</span>
        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">.</span><span class="s1">roots</span><span class="s3">()), </span><span class="s4">50</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_derivatives</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">9</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">0</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">21</span><span class="s3">]</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">.</span><span class="s1">derivatives</span><span class="s3">(</span><span class="s4">3.5</span><span class="s3">),</span>
                            <span class="s3">[</span><span class="s4">5.5152902</span><span class="s3">, </span><span class="s4">1.7146577</span><span class="s3">, -</span><span class="s4">0.1830357</span><span class="s3">, </span><span class="s4">0.3125</span><span class="s3">])</span>

    <span class="s2">def </span><span class="s1">test_derivatives_2</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">8</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">x</span><span class="s3">**</span><span class="s4">3 </span><span class="s3">+ </span><span class="s4">2.</span><span class="s3">*</span><span class="s1">x</span><span class="s3">**</span><span class="s4">2</span>

        <span class="s1">tck </span><span class="s3">= </span><span class="s1">splrep</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">)</span>
        <span class="s1">ders </span><span class="s3">= </span><span class="s1">spalde</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s1">tck</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">ders</span><span class="s3">, [</span><span class="s4">45.</span><span class="s3">,   </span><span class="s0"># 3**3 + 2*(3)**2</span>
                               <span class="s4">39.</span><span class="s3">,   </span><span class="s0"># 3*(3)**2 + 4*(3)</span>
                               <span class="s4">22.</span><span class="s3">,   </span><span class="s0"># 6*(3) + 4</span>
                               <span class="s4">6.</span><span class="s3">],   </span><span class="s0"># 6*3**0</span>
                        <span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-15</span><span class="s3">)</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">.</span><span class="s1">derivatives</span><span class="s3">(</span><span class="s4">3</span><span class="s3">),</span>
                        <span class="s1">ders</span><span class="s3">,</span>
                        <span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-15</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_resize_regression</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Regression test for #1375.&quot;&quot;&quot;</span>
        <span class="s1">x </span><span class="s3">= [-</span><span class="s4">1.</span><span class="s3">, -</span><span class="s4">0.65016502</span><span class="s3">, -</span><span class="s4">0.58856235</span><span class="s3">, -</span><span class="s4">0.26903553</span><span class="s3">, -</span><span class="s4">0.17370892</span><span class="s3">,</span>
             <span class="s3">-</span><span class="s4">0.10011001</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.10011001</span><span class="s3">, </span><span class="s4">0.17370892</span><span class="s3">, </span><span class="s4">0.26903553</span><span class="s3">, </span><span class="s4">0.58856235</span><span class="s3">,</span>
             <span class="s4">0.65016502</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">1.</span><span class="s3">,</span><span class="s4">0.62928599</span><span class="s3">, </span><span class="s4">0.5797223</span><span class="s3">, </span><span class="s4">0.39965815</span><span class="s3">, </span><span class="s4">0.36322694</span><span class="s3">, </span><span class="s4">0.3508061</span><span class="s3">,</span>
             <span class="s4">0.35214793</span><span class="s3">, </span><span class="s4">0.3508061</span><span class="s3">, </span><span class="s4">0.36322694</span><span class="s3">, </span><span class="s4">0.39965815</span><span class="s3">, </span><span class="s4">0.5797223</span><span class="s3">,</span>
             <span class="s4">0.62928599</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">]</span>
        <span class="s1">w </span><span class="s3">= [</span><span class="s4">1.00000000e+12</span><span class="s3">, </span><span class="s4">6.88875973e+02</span><span class="s3">, </span><span class="s4">4.89314737e+02</span><span class="s3">, </span><span class="s4">4.26864807e+02</span><span class="s3">,</span>
             <span class="s4">6.07746770e+02</span><span class="s3">, </span><span class="s4">4.51341444e+02</span><span class="s3">, </span><span class="s4">3.17480210e+02</span><span class="s3">, </span><span class="s4">4.51341444e+02</span><span class="s3">,</span>
             <span class="s4">6.07746770e+02</span><span class="s3">, </span><span class="s4">4.26864807e+02</span><span class="s3">, </span><span class="s4">4.89314737e+02</span><span class="s3">, </span><span class="s4">6.88875973e+02</span><span class="s3">,</span>
             <span class="s4">1.00000000e+12</span><span class="s3">]</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">desired </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0.35100374</span><span class="s3">, </span><span class="s4">0.51715855</span><span class="s3">, </span><span class="s4">0.87789547</span><span class="s3">, </span><span class="s4">0.98719344</span><span class="s3">])</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">([</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">, </span><span class="s4">0.99</span><span class="s3">]), </span><span class="s1">desired</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">5e-4</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_out_of_range_regression</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test different extrapolation modes. See ticket 3557</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">5</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">float</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">x</span><span class="s3">**</span><span class="s4">3</span>

        <span class="s1">xp </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">8</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">100</span><span class="s3">)</span>
        <span class="s1">xp_zeros </span><span class="s3">= </span><span class="s1">xp</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">xp_zeros</span><span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">logical_or</span><span class="s3">(</span><span class="s1">xp_zeros </span><span class="s3">&lt; </span><span class="s4">0.</span><span class="s3">, </span><span class="s1">xp_zeros </span><span class="s3">&gt; </span><span class="s4">4.</span><span class="s3">)] = </span><span class="s4">0</span>
        <span class="s1">xp_clip </span><span class="s3">= </span><span class="s1">xp</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">xp_clip</span><span class="s3">[</span><span class="s1">xp_clip </span><span class="s3">&lt; </span><span class="s1">x</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]] = </span><span class="s1">x</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">xp_clip</span><span class="s3">[</span><span class="s1">xp_clip </span><span class="s3">&gt; </span><span class="s1">x</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">]] = </span><span class="s1">x</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">]</span>

        <span class="s2">for </span><span class="s1">cls </span><span class="s2">in </span><span class="s3">[</span><span class="s1">UnivariateSpline</span><span class="s3">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s3">]:</span>
            <span class="s1">spl </span><span class="s3">= </span><span class="s1">cls</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s6">'extrapolate'</span><span class="s3">]:</span>
                <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">), </span><span class="s1">xp</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>
                <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">)(</span><span class="s1">xp</span><span class="s3">), </span><span class="s1">xp</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s6">'zeros'</span><span class="s3">]:</span>
                <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">), </span><span class="s1">xp_zeros</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>
                <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">)(</span><span class="s1">xp</span><span class="s3">), </span><span class="s1">xp_zeros</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s3">[</span><span class="s4">2</span><span class="s3">, </span><span class="s6">'raise'</span><span class="s3">]:</span>
                <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">spl</span><span class="s3">, </span><span class="s1">xp</span><span class="s3">, **</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">))</span>
            <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s3">[</span><span class="s4">3</span><span class="s3">, </span><span class="s6">'const'</span><span class="s3">]:</span>
                <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">), </span><span class="s1">xp_clip</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>
                <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">)(</span><span class="s1">xp</span><span class="s3">), </span><span class="s1">xp_clip</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>

        <span class="s0"># also test LSQUnivariateSpline [which needs explicit knots]</span>
        <span class="s1">t </span><span class="s3">= </span><span class="s1">spl</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">()[</span><span class="s4">3</span><span class="s3">:</span><span class="s4">4</span><span class="s3">]  </span><span class="s0"># interior knots w/ default k=3</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">LSQUnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">t</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s4">0</span><span class="s3">), </span><span class="s1">xp</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s4">1</span><span class="s3">), </span><span class="s1">xp_zeros</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">spl</span><span class="s3">, </span><span class="s1">xp</span><span class="s3">, **</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">ext</span><span class="s3">=</span><span class="s4">2</span><span class="s3">))</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s4">3</span><span class="s3">), </span><span class="s1">xp_clip</span><span class="s3">**</span><span class="s4">3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-16</span><span class="s3">)</span>

        <span class="s0"># also make sure that unknown values for `ext` are caught early</span>
        <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s3">[-</span><span class="s4">1</span><span class="s3">, </span><span class="s6">'unknown'</span><span class="s3">]:</span>
            <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
            <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">spl</span><span class="s3">, </span><span class="s1">xp</span><span class="s3">, **</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">))</span>
            <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">UnivariateSpline</span><span class="s3">,</span>
                    <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_lsq_fpchec</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">xs </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">100</span><span class="s3">) * </span><span class="s4">1.</span>
        <span class="s1">ys </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">100</span><span class="s3">) * </span><span class="s4">1.</span>
        <span class="s1">knots </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">99</span><span class="s3">, </span><span class="s4">10</span><span class="s3">)</span>
        <span class="s1">bbox </span><span class="s3">= (-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">101</span><span class="s3">)</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">LSQUnivariateSpline</span><span class="s3">, </span><span class="s1">xs</span><span class="s3">, </span><span class="s1">ys</span><span class="s3">, </span><span class="s1">knots</span><span class="s3">,</span>
                      <span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_derivative_and_antiderivative</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Thin wrappers to splder/splantider, so light smoke test only.</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">70</span><span class="s3">)**</span><span class="s4">3</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">cos</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>

        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">)</span>
        <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">spl</span><span class="s3">.</span><span class="s1">antiderivative</span><span class="s3">(</span><span class="s4">2</span><span class="s3">).</span><span class="s1">derivative</span><span class="s3">(</span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl</span><span class="s3">(</span><span class="s4">0.3</span><span class="s3">), </span><span class="s1">spl2</span><span class="s3">(</span><span class="s4">0.3</span><span class="s3">))</span>

        <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">spl</span><span class="s3">.</span><span class="s1">antiderivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl2</span><span class="s3">(</span><span class="s4">0.6</span><span class="s3">) - </span><span class="s1">spl2</span><span class="s3">(</span><span class="s4">0.2</span><span class="s3">),</span>
                        <span class="s1">spl</span><span class="s3">.</span><span class="s1">integral</span><span class="s3">(</span><span class="s4">0.2</span><span class="s3">, </span><span class="s4">0.6</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_derivative_extrapolation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Regression test for gh-10195: for a const-extrapolation spline</span>
        <span class="s0"># its derivative evaluates to zero for extrapolation</span>
        <span class="s1">x_values </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">]</span>
        <span class="s1">y_values </span><span class="s3">= [</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">5</span><span class="s3">]</span>
        <span class="s1">f </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s6">'const'</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>

        <span class="s1">x </span><span class="s3">= [-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">9.5</span><span class="s3">, </span><span class="s4">10</span><span class="s3">]</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">f</span><span class="s3">.</span><span class="s1">derivative</span><span class="s3">()(</span><span class="s1">x</span><span class="s3">), </span><span class="s4">0</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-15</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_integral_out_of_bounds</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Regression test for gh-7906: .integral(a, b) is wrong if both</span>
        <span class="s0"># a and b are out-of-bounds</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">ext </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">4</span><span class="s3">):</span>
            <span class="s1">f </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">ext</span><span class="s3">=</span><span class="s1">ext</span><span class="s3">)</span>
            <span class="s2">for </span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) </span><span class="s2">in </span><span class="s3">[(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), (</span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">), (</span><span class="s4">2</span><span class="s3">, </span><span class="s4">5</span><span class="s3">),</span>
                           <span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">), (-</span><span class="s4">2</span><span class="s3">, </span><span class="s4">0</span><span class="s3">), (-</span><span class="s4">2</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">)]:</span>
                <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">f</span><span class="s3">.</span><span class="s1">integral</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">), </span><span class="s4">0</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-15</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_nan</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># bail out early if the input data contains nans</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">float</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">x</span><span class="s3">**</span><span class="s4">3</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones_like</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s0"># also test LSQUnivariateSpline [which needs explicit knots]</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">t </span><span class="s3">= </span><span class="s1">spl</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">()[</span><span class="s4">3</span><span class="s3">:</span><span class="s4">4</span><span class="s3">]  </span><span class="s0"># interior knots w/ default k=3</span>
        <span class="s1">y_end </span><span class="s3">= </span><span class="s1">y</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s2">for </span><span class="s1">z </span><span class="s2">in </span><span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">inf</span><span class="s3">, -</span><span class="s1">np</span><span class="s3">.</span><span class="s1">inf</span><span class="s3">]:</span>
            <span class="s1">y</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] = </span><span class="s1">z</span>
            <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">UnivariateSpline</span><span class="s3">,</span>
                    <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
            <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s3">,</span>
                    <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
            <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">LSQUnivariateSpline</span><span class="s3">,</span>
                    <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">t</span><span class="s3">=</span><span class="s1">t</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
            <span class="s1">y</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] = </span><span class="s1">y_end  </span><span class="s0"># check valid y but invalid w</span>
            <span class="s1">w</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] = </span><span class="s1">z</span>
            <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">UnivariateSpline</span><span class="s3">,</span>
                    <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
            <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s3">,</span>
                    <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
            <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">LSQUnivariateSpline</span><span class="s3">,</span>
                    <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">t</span><span class="s3">=</span><span class="s1">t</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_strictly_increasing_x</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test the x is required to be strictly increasing for</span>
        <span class="s0"># UnivariateSpline if s=0 and for InterpolatedUnivariateSpline,</span>
        <span class="s0"># but merely increasing for UnivariateSpline if s&gt;0</span>
        <span class="s0"># and for LSQUnivariateSpline; see gh-8535</span>
        <span class="s1">xx </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">float</span><span class="s3">)</span>
        <span class="s1">yy </span><span class="s3">= </span><span class="s1">xx</span><span class="s3">**</span><span class="s4">3</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">float</span><span class="s3">)</span>
        <span class="s1">x</span><span class="s3">[</span><span class="s4">1</span><span class="s3">] = </span><span class="s1">x</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">x</span><span class="s3">**</span><span class="s4">3</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones_like</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s0"># also test LSQUnivariateSpline [which needs explicit knots]</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">xx</span><span class="s3">, </span><span class="s1">yy</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">t </span><span class="s3">= </span><span class="s1">spl</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">()[</span><span class="s4">3</span><span class="s3">:</span><span class="s4">4</span><span class="s3">]  </span><span class="s0"># interior knots w/ default k=3</span>
        <span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">LSQUnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">t</span><span class="s3">=</span><span class="s1">t</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">UnivariateSpline</span><span class="s3">,</span>
                <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s3">,</span>
                <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_increasing_x</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test that x is required to be increasing, see gh-8535</span>
        <span class="s1">xx </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">float</span><span class="s3">)</span>
        <span class="s1">yy </span><span class="s3">= </span><span class="s1">xx</span><span class="s3">**</span><span class="s4">3</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">float</span><span class="s3">)</span>
        <span class="s1">x</span><span class="s3">[</span><span class="s4">1</span><span class="s3">] = </span><span class="s1">x</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] - </span><span class="s4">1.0</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">x</span><span class="s3">**</span><span class="s4">3</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones_like</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s0"># also test LSQUnivariateSpline [which needs explicit knots]</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">xx</span><span class="s3">, </span><span class="s1">yy</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">t </span><span class="s3">= </span><span class="s1">spl</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">()[</span><span class="s4">3</span><span class="s3">:</span><span class="s4">4</span><span class="s3">]  </span><span class="s0"># interior knots w/ default k=3</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">UnivariateSpline</span><span class="s3">,</span>
                <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">InterpolatedUnivariateSpline</span><span class="s3">,</span>
                <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>
        <span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">LSQUnivariateSpline</span><span class="s3">,</span>
                <span class="s3">**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y</span><span class="s3">, </span><span class="s1">t</span><span class="s3">=</span><span class="s1">t</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_for_univariate_spline</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x_values </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">]</span>
            <span class="s1">y_values </span><span class="s3">= [</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">]</span>
            <span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x and y should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x_values </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">]</span>
            <span class="s1">y_values </span><span class="s3">= [</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">2.8</span><span class="s3">]</span>
            <span class="s1">w_values </span><span class="s3">= [-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">]</span>
            <span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w_values</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x, y, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">bbox </span><span class="s3">= (-</span><span class="s4">1</span><span class="s3">)</span>
            <span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;bbox shape should be (2,)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">6</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;k should be 1 &lt;= k &lt;= 5&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=-</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;s should be s &gt;= 0.0&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_for_interpolated_univariate_spline</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x_values </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">]</span>
            <span class="s1">y_values </span><span class="s3">= [</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">]</span>
            <span class="s1">InterpolatedUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x and y should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x_values </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">]</span>
            <span class="s1">y_values </span><span class="s3">= [</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">2.8</span><span class="s3">]</span>
            <span class="s1">w_values </span><span class="s3">= [-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">]</span>
            <span class="s1">InterpolatedUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w_values</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x, y, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">bbox </span><span class="s3">= (-</span><span class="s4">1</span><span class="s3">)</span>
            <span class="s1">InterpolatedUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;bbox shape should be (2,)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">InterpolatedUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">6</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;k should be 1 &lt;= k &lt;= 5&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_for_lsq_univariate_spline</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s1">x_values </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">]</span>
        <span class="s1">y_values </span><span class="s3">= [</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">2.8</span><span class="s3">]</span>
        <span class="s1">spl </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">check_finite</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">t_values </span><span class="s3">= </span><span class="s1">spl</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">()[</span><span class="s4">3</span><span class="s3">:</span><span class="s4">4</span><span class="s3">]  </span><span class="s0"># interior knots w/ default k=3</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x_values </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">]</span>
            <span class="s1">y_values </span><span class="s3">= [</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">]</span>
            <span class="s1">LSQUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">t_values</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x and y should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x_values </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">]</span>
            <span class="s1">y_values </span><span class="s3">= [</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">2.8</span><span class="s3">]</span>
            <span class="s1">w_values </span><span class="s3">= [</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">]</span>
            <span class="s1">LSQUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">t_values</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w_values</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x, y, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s1">message </span><span class="s3">= </span><span class="s6">&quot;Interior knots t must satisfy Schoenberg-Whitney conditions&quot;</span>
        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">message</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">bbox </span><span class="s3">= (</span><span class="s4">100</span><span class="s3">, -</span><span class="s4">100</span><span class="s3">)</span>
            <span class="s1">LSQUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">t_values</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">bbox </span><span class="s3">= (-</span><span class="s4">1</span><span class="s3">)</span>
            <span class="s1">LSQUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">t_values</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;bbox shape should be (2,)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">LSQUnivariateSpline</span><span class="s3">(</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">t_values</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">6</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;k should be 1 &lt;= k &lt;= 5&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x_values </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">8.5</span><span class="s3">])</span>
        <span class="s1">y_values </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1.3</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">2.8</span><span class="s3">])</span>
        <span class="s1">w_values </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">])</span>
        <span class="s1">bbox </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([-</span><span class="s4">100</span><span class="s3">, </span><span class="s4">100</span><span class="s3">])</span>
        <span class="s0"># np.array input</span>
        <span class="s1">spl1 </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x_values</span><span class="s3">, </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y_values</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w_values</span><span class="s3">,</span>
                                <span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
        <span class="s0"># list input</span>
        <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">=</span><span class="s1">x_values</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">y</span><span class="s3">=</span><span class="s1">y_values</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(),</span>
                                <span class="s1">w</span><span class="s3">=</span><span class="s1">w_values</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">())</span>

        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl1</span><span class="s3">([</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">, </span><span class="s4">0.99</span><span class="s3">]),</span>
                        <span class="s1">spl2</span><span class="s3">([</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">, </span><span class="s4">0.99</span><span class="s3">]))</span>

    <span class="s2">def </span><span class="s1">test_fpknot_oob_crash</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># https://github.com/scipy/scipy/issues/3691</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">range</span><span class="s3">(</span><span class="s4">109</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.9</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">11.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">,</span>
             <span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.9</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">,</span>
             <span class="s4">10.9</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">11.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.9</span><span class="s3">,</span>
             <span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.5</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.7</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">,</span>
             <span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">11.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">,</span>
             <span class="s4">10.9</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.7</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.6</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">,</span>
             <span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.5</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.7</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.5</span><span class="s3">,</span>
             <span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">11.5</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.7</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">,</span>
             <span class="s4">10.7</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.9</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.8</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">,</span>
             <span class="s4">0.</span><span class="s3">, </span><span class="s4">10.7</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.6</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.4</span><span class="s3">,</span>
             <span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.6</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.5</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">,</span>
             <span class="s4">10.7</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.4</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">, </span><span class="s4">10.8</span><span class="s3">, </span><span class="s4">0.</span><span class="s3">]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">r </span><span class="s3">= </span><span class="s1">sup</span><span class="s3">.</span><span class="s1">record</span><span class="s3">(</span>
                <span class="s1">UserWarning</span><span class="s3">,</span>
                <span class="s6">r&quot;&quot;&quot; 
The maximal number of iterations maxit \(set to 20 by the program\) 
allowed for finding a smoothing spline with fp=s has been reached: s 
too small. 
There is an approximation returned but the corresponding weighted sum 
of squared residuals does not satisfy the condition abs\(fp-s\)/s &lt; tol.&quot;&quot;&quot;</span><span class="s3">)</span>
            <span class="s1">UnivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">k</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">r</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestLSQBivariateSpline</span><span class="s3">:</span>
    <span class="s0"># NOTE: The systems in this test class are rank-deficient</span>
    <span class="s2">def </span><span class="s1">test_linear_constant</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">z </span><span class="s3">= [</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s4">0.1</span>
        <span class="s1">tx </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">+</span><span class="s1">s</span><span class="s3">,</span><span class="s4">3</span><span class="s3">-</span><span class="s1">s</span><span class="s3">]</span>
        <span class="s1">ty </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">+</span><span class="s1">s</span><span class="s3">,</span><span class="s4">3</span><span class="s3">-</span><span class="s1">s</span><span class="s3">]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">r </span><span class="s3">= </span><span class="s1">sup</span><span class="s3">.</span><span class="s1">record</span><span class="s3">(</span><span class="s1">UserWarning</span><span class="s3">, </span><span class="s6">&quot;</span><span class="s2">\n</span><span class="s6">The coefficients of the spline&quot;</span><span class="s3">)</span>
            <span class="s1">lut </span><span class="s3">= </span><span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">,</span><span class="s1">tx</span><span class="s3">,</span><span class="s1">ty</span><span class="s3">,</span><span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">r</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>

        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">), </span><span class="s4">3.</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_bilinearity</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">z </span><span class="s3">= [</span><span class="s4">0</span><span class="s3">,</span><span class="s4">7</span><span class="s3">,</span><span class="s4">8</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">7</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">]</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s4">0.1</span>
        <span class="s1">tx </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">+</span><span class="s1">s</span><span class="s3">,</span><span class="s4">3</span><span class="s3">-</span><span class="s1">s</span><span class="s3">]</span>
        <span class="s1">ty </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">+</span><span class="s1">s</span><span class="s3">,</span><span class="s4">3</span><span class="s3">-</span><span class="s1">s</span><span class="s3">]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s0"># This seems to fail (ier=1, see ticket 1642).</span>
            <span class="s1">sup</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">UserWarning</span><span class="s3">, </span><span class="s6">&quot;</span><span class="s2">\n</span><span class="s6">The coefficients of the spline&quot;</span><span class="s3">)</span>
            <span class="s1">lut </span><span class="s3">= </span><span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">,</span><span class="s1">tx</span><span class="s3">,</span><span class="s1">ty</span><span class="s3">,</span><span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>

        <span class="s1">tx</span><span class="s3">, </span><span class="s1">ty </span><span class="s3">= </span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">()</span>
        <span class="s2">for </span><span class="s1">xa</span><span class="s3">, </span><span class="s1">xb </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">tx</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:]):</span>
            <span class="s2">for </span><span class="s1">ya</span><span class="s3">, </span><span class="s1">yb </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:]):</span>
                <span class="s2">for </span><span class="s1">t </span><span class="s2">in </span><span class="s3">[</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">]:</span>
                    <span class="s2">for </span><span class="s1">s </span><span class="s2">in </span><span class="s3">[</span><span class="s4">0.3</span><span class="s3">, </span><span class="s4">0.4</span><span class="s3">, </span><span class="s4">0.7</span><span class="s3">]:</span>
                        <span class="s1">xp </span><span class="s3">= </span><span class="s1">xa</span><span class="s3">*(</span><span class="s4">1</span><span class="s3">-</span><span class="s1">t</span><span class="s3">) + </span><span class="s1">xb</span><span class="s3">*</span><span class="s1">t</span>
                        <span class="s1">yp </span><span class="s3">= </span><span class="s1">ya</span><span class="s3">*(</span><span class="s4">1</span><span class="s3">-</span><span class="s1">s</span><span class="s3">) + </span><span class="s1">yb</span><span class="s3">*</span><span class="s1">s</span>
                        <span class="s1">zp </span><span class="s3">= (+ </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">xa</span><span class="s3">, </span><span class="s1">ya</span><span class="s3">)*(</span><span class="s4">1</span><span class="s3">-</span><span class="s1">t</span><span class="s3">)*(</span><span class="s4">1</span><span class="s3">-</span><span class="s1">s</span><span class="s3">)</span>
                              <span class="s3">+ </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">xb</span><span class="s3">, </span><span class="s1">ya</span><span class="s3">)*</span><span class="s1">t</span><span class="s3">*(</span><span class="s4">1</span><span class="s3">-</span><span class="s1">s</span><span class="s3">)</span>
                              <span class="s3">+ </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">xa</span><span class="s3">, </span><span class="s1">yb</span><span class="s3">)*(</span><span class="s4">1</span><span class="s3">-</span><span class="s1">t</span><span class="s3">)*</span><span class="s1">s</span>
                              <span class="s3">+ </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">xb</span><span class="s3">, </span><span class="s1">yb</span><span class="s3">)*</span><span class="s1">t</span><span class="s3">*</span><span class="s1">s</span><span class="s3">)</span>
                        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">,</span><span class="s1">yp</span><span class="s3">), </span><span class="s1">zp</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_integral</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">8</span><span class="s3">,</span><span class="s4">8</span><span class="s3">,</span><span class="s4">8</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">,</span><span class="s4">7</span><span class="s3">,</span><span class="s4">8</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">7</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">])</span>

        <span class="s1">s </span><span class="s3">= </span><span class="s4">0.1</span>
        <span class="s1">tx </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">+</span><span class="s1">s</span><span class="s3">,</span><span class="s4">3</span><span class="s3">-</span><span class="s1">s</span><span class="s3">]</span>
        <span class="s1">ty </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">+</span><span class="s1">s</span><span class="s3">,</span><span class="s4">3</span><span class="s3">-</span><span class="s1">s</span><span class="s3">]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">r </span><span class="s3">= </span><span class="s1">sup</span><span class="s3">.</span><span class="s1">record</span><span class="s3">(</span><span class="s1">UserWarning</span><span class="s3">, </span><span class="s6">&quot;</span><span class="s2">\n</span><span class="s6">The coefficients of the spline&quot;</span><span class="s3">)</span>
            <span class="s1">lut </span><span class="s3">= </span><span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">r</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">tx</span><span class="s3">, </span><span class="s1">ty </span><span class="s3">= </span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">()</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">)</span>
        <span class="s1">trpz </span><span class="s3">= </span><span class="s4">.25</span><span class="s3">*(</span><span class="s1">diff</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">)[:,</span><span class="s2">None</span><span class="s3">]*</span><span class="s1">diff</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)[</span><span class="s2">None</span><span class="s3">,:]</span>
                    <span class="s3">* (</span><span class="s1">tz</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">,:-</span><span class="s4">1</span><span class="s3">]+</span><span class="s1">tz</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:,:-</span><span class="s4">1</span><span class="s3">]+</span><span class="s1">tz</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">:]+</span><span class="s1">tz</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:,</span><span class="s4">1</span><span class="s3">:])).</span><span class="s1">sum</span><span class="s3">()</span>

        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">integral</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">tx</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">]),</span>
                            <span class="s1">trpz</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_empty_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># Test whether empty inputs returns an empty output. Ticket 1014</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">z </span><span class="s3">= [</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s4">0.1</span>
        <span class="s1">tx </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">+</span><span class="s1">s</span><span class="s3">,</span><span class="s4">3</span><span class="s3">-</span><span class="s1">s</span><span class="s3">]</span>
        <span class="s1">ty </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">+</span><span class="s1">s</span><span class="s3">,</span><span class="s4">3</span><span class="s3">-</span><span class="s1">s</span><span class="s3">]</span>
        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">r </span><span class="s3">= </span><span class="s1">sup</span><span class="s3">.</span><span class="s1">record</span><span class="s3">(</span><span class="s1">UserWarning</span><span class="s3">, </span><span class="s6">&quot;</span><span class="s2">\n</span><span class="s6">The coefficients of the spline&quot;</span><span class="s3">)</span>
            <span class="s1">lut </span><span class="s3">= </span><span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">r</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>

        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">([], []), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">)))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">([], [], </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">0</span><span class="s3">,)))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s4">0.1</span>
        <span class="s1">tx </span><span class="s3">= [</span><span class="s4">1 </span><span class="s3">+ </span><span class="s1">s</span><span class="s3">, </span><span class="s4">3 </span><span class="s3">- </span><span class="s1">s</span><span class="s3">]</span>
        <span class="s1">ty </span><span class="s3">= [</span><span class="s4">1 </span><span class="s3">+ </span><span class="s1">s</span><span class="s3">, </span><span class="s4">3 </span><span class="s3">- </span><span class="s1">s</span><span class="s3">]</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>
            <span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x, y, and z should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s4">20</span><span class="s3">)</span>
            <span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x, y, z, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;w should be positive&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">bbox </span><span class="s3">= (-</span><span class="s4">100</span><span class="s3">, </span><span class="s4">100</span><span class="s3">, -</span><span class="s4">100</span><span class="s3">)</span>
            <span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;bbox shape should be (4,)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">kx</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">ky</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;The length of x, y and z should be at least (kx+1) * (ky+1)&quot; </span><span class="s2">in </span><span class="s1">\</span>
               <span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">0.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s4">0.1</span>
        <span class="s1">tx </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1 </span><span class="s3">+ </span><span class="s1">s</span><span class="s3">, </span><span class="s4">3 </span><span class="s3">- </span><span class="s1">s</span><span class="s3">])</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1 </span><span class="s3">+ </span><span class="s1">s</span><span class="s3">, </span><span class="s4">3 </span><span class="s3">- </span><span class="s1">s</span><span class="s3">])</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
        <span class="s1">bbox </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">])</span>

        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">r </span><span class="s3">= </span><span class="s1">sup</span><span class="s3">.</span><span class="s1">record</span><span class="s3">(</span><span class="s1">UserWarning</span><span class="s3">, </span><span class="s6">&quot;</span><span class="s2">\n</span><span class="s6">The coefficients of the spline&quot;</span><span class="s3">)</span>
            <span class="s0"># np.array input</span>
            <span class="s1">spl1 </span><span class="s3">= </span><span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
            <span class="s0"># list input</span>
            <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">y</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">z</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(),</span>
                                      <span class="s1">tx</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">ty</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(),</span>
                                      <span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
            <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl1</span><span class="s3">(</span><span class="s4">2.0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s3">), </span><span class="s1">spl2</span><span class="s3">(</span><span class="s4">2.0</span><span class="s3">, </span><span class="s4">2.0</span><span class="s3">))</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">r</span><span class="s3">), </span><span class="s4">2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_unequal_length_of_knots</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s5">&quot;&quot;&quot;Test for the case when the input knot-location arrays in x and y are 
        of different lengths. 
        &quot;&quot;&quot;</span>
        <span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">mgrid</span><span class="s3">[</span><span class="s4">0</span><span class="s3">:</span><span class="s4">100</span><span class="s3">, </span><span class="s4">0</span><span class="s3">:</span><span class="s4">100</span><span class="s3">]</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">x</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">()</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">y</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">()</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s4">3.0 </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones_like</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s1">tx </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">98.0</span><span class="s3">, </span><span class="s4">29</span><span class="s3">)</span>
        <span class="s1">ty </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">98.0</span><span class="s3">, </span><span class="s4">33</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">r </span><span class="s3">= </span><span class="s1">sup</span><span class="s3">.</span><span class="s1">record</span><span class="s3">(</span><span class="s1">UserWarning</span><span class="s3">, </span><span class="s6">&quot;</span><span class="s2">\n</span><span class="s6">The coefficients of the spline&quot;</span><span class="s3">)</span>
            <span class="s1">lut </span><span class="s3">= </span><span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">,</span><span class="s1">tx</span><span class="s3">,</span><span class="s1">ty</span><span class="s3">)</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">r</span><span class="s3">), </span><span class="s4">1</span><span class="s3">)</span>

        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">), </span><span class="s1">z</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestSmoothBivariateSpline</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_linear_constant</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">z </span><span class="s3">= [</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">,</span><span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">(),([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_coeffs</span><span class="s3">(),[</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_residual</span><span class="s3">(),</span><span class="s4">0.0</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1.5</span><span class="s3">,</span><span class="s4">2</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1.5</span><span class="s3">]),[[</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">],[</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">],[</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]])</span>

    <span class="s2">def </span><span class="s1">test_linear_1d</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">z </span><span class="s3">= [</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">4</span><span class="s3">]</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">,</span><span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_knots</span><span class="s3">(),([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_coeffs</span><span class="s3">(),[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">4</span><span class="s3">])</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_residual</span><span class="s3">(),</span><span class="s4">0.0</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1.5</span><span class="s3">,</span><span class="s4">2</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1.5</span><span class="s3">]),[[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">]])</span>

    <span class="s2">def </span><span class="s1">test_integral</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">4</span><span class="s3">]</span>
        <span class="s1">y </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">,</span><span class="s4">7</span><span class="s3">,</span><span class="s4">8</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">7</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">])</span>

        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s0"># This seems to fail (ier=1, see ticket 1642).</span>
            <span class="s1">sup</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">UserWarning</span><span class="s3">, </span><span class="s6">&quot;</span><span class="s2">\n</span><span class="s6">The required storage space&quot;</span><span class="s3">)</span>
            <span class="s1">lut </span><span class="s3">= </span><span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">)</span>

        <span class="s1">tx </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">4</span><span class="s3">]</span>
        <span class="s1">ty </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">]</span>

        <span class="s1">tz </span><span class="s3">= </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">, </span><span class="s1">ty</span><span class="s3">)</span>
        <span class="s1">trpz </span><span class="s3">= </span><span class="s4">.25</span><span class="s3">*(</span><span class="s1">diff</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">)[:,</span><span class="s2">None</span><span class="s3">]*</span><span class="s1">diff</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">)[</span><span class="s2">None</span><span class="s3">,:]</span>
                    <span class="s3">* (</span><span class="s1">tz</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">,:-</span><span class="s4">1</span><span class="s3">]+</span><span class="s1">tz</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:,:-</span><span class="s4">1</span><span class="s3">]+</span><span class="s1">tz</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">:]+</span><span class="s1">tz</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:,</span><span class="s4">1</span><span class="s3">:])).</span><span class="s1">sum</span><span class="s3">()</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">integral</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">tx</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">]), </span><span class="s1">trpz</span><span class="s3">)</span>

        <span class="s1">lut2 </span><span class="s3">= </span><span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">kx</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">ky</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">)</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut2</span><span class="s3">.</span><span class="s1">integral</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">tx</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">]), </span><span class="s1">trpz</span><span class="s3">,</span>
                            <span class="s1">decimal</span><span class="s3">=</span><span class="s4">0</span><span class="s3">)  </span><span class="s0"># the quadratures give 23.75 and 23.85</span>

        <span class="s1">tz </span><span class="s3">= </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">trpz </span><span class="s3">= </span><span class="s4">.25</span><span class="s3">*(</span><span class="s1">diff</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">])[:,</span><span class="s2">None</span><span class="s3">]*</span><span class="s1">diff</span><span class="s3">(</span><span class="s1">ty</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">])[</span><span class="s2">None</span><span class="s3">,:]</span>
                    <span class="s3">* (</span><span class="s1">tz</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">,:-</span><span class="s4">1</span><span class="s3">]+</span><span class="s1">tz</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:,:-</span><span class="s4">1</span><span class="s3">]+</span><span class="s1">tz</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">1</span><span class="s3">:]+</span><span class="s1">tz</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:,</span><span class="s4">1</span><span class="s3">:])).</span><span class="s1">sum</span><span class="s3">()</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">integral</span><span class="s3">(</span><span class="s1">tx</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">tx</span><span class="s3">[-</span><span class="s4">2</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">ty</span><span class="s3">[-</span><span class="s4">2</span><span class="s3">]), </span><span class="s1">trpz</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_rerun_lwrk2_too_small</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># in this setting, lwrk2 is too small in the default run. Here we</span>
        <span class="s0"># check for equality with the bisplrep/bisplev output because there,</span>
        <span class="s0"># an automatic re-run of the spline representation is done if ier&gt;10.</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">80</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">80</span><span class="s3">)</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">x </span><span class="s3">+ </span><span class="s1">y</span>
        <span class="s1">xi </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">100</span><span class="s3">)</span>
        <span class="s1">yi </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">100</span><span class="s3">)</span>
        <span class="s1">tck </span><span class="s3">= </span><span class="s1">bisplrep</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">res1 </span><span class="s3">= </span><span class="s1">bisplev</span><span class="s3">(</span><span class="s1">xi</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">, </span><span class="s1">tck</span><span class="s3">)</span>
        <span class="s1">interp_ </span><span class="s3">= </span><span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">res2 </span><span class="s3">= </span><span class="s1">interp_</span><span class="s3">(</span><span class="s1">xi</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">)</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">res1</span><span class="s3">, </span><span class="s1">res2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>
            <span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x, y, and z should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s4">20</span><span class="s3">)</span>
            <span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x, y, z, and w should have a same length&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">10.0</span><span class="s3">)</span>
            <span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;w should be positive&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">bbox </span><span class="s3">= (-</span><span class="s4">100</span><span class="s3">, </span><span class="s4">100</span><span class="s3">, -</span><span class="s4">100</span><span class="s3">)</span>
            <span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;bbox shape should be (4,)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">kx</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">ky</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;The length of x, y and z should be at least (kx+1) * (ky+1)&quot; </span><span class="s2">in</span><span class="s1">\</span>
               <span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=-</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;s should be s &gt;= 0.0&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">0.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">])</span>
        <span class="s1">bbox </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">3.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">3.0</span><span class="s3">])</span>
        <span class="s0"># np.array input</span>
        <span class="s1">spl1 </span><span class="s3">= </span><span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">, </span><span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s0"># list input</span>
        <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">y</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">z</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(),</span>
                                     <span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(),</span>
                                     <span class="s1">kx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">ky</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">spl1</span><span class="s3">(</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">), </span><span class="s1">spl2</span><span class="s3">(</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">))</span>


<span class="s2">class </span><span class="s1">TestLSQSphereBivariateSpline</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">setup_method</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># define the input data and coordinates</span>
        <span class="s1">ntheta</span><span class="s3">, </span><span class="s1">nphi </span><span class="s3">= </span><span class="s4">70</span><span class="s3">, </span><span class="s4">90</span>
        <span class="s1">theta </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.5</span><span class="s3">/(</span><span class="s1">ntheta </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s4">1 </span><span class="s3">- </span><span class="s4">0.5</span><span class="s3">/(</span><span class="s1">ntheta </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s1">ntheta</span><span class="s3">) * </span><span class="s1">pi</span>
        <span class="s1">phi </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.5</span><span class="s3">/(</span><span class="s1">nphi </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s4">1 </span><span class="s3">- </span><span class="s4">0.5</span><span class="s3">/(</span><span class="s1">nphi </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s1">nphi</span><span class="s3">) * </span><span class="s4">2. </span><span class="s3">* </span><span class="s1">pi</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">ones</span><span class="s3">((</span><span class="s1">theta</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">phi</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]))</span>
        <span class="s0"># define knots and extract data values at the knots</span>
        <span class="s1">knotst </span><span class="s3">= </span><span class="s1">theta</span><span class="s3">[::</span><span class="s4">5</span><span class="s3">]</span>
        <span class="s1">knotsp </span><span class="s3">= </span><span class="s1">phi</span><span class="s3">[::</span><span class="s4">5</span><span class="s3">]</span>
        <span class="s1">knotdata </span><span class="s3">= </span><span class="s1">data</span><span class="s3">[::</span><span class="s4">5</span><span class="s3">, ::</span><span class="s4">5</span><span class="s3">]</span>
        <span class="s0"># calculate spline coefficients</span>
        <span class="s1">lats</span><span class="s3">, </span><span class="s1">lons </span><span class="s3">= </span><span class="s1">meshgrid</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">)</span>
        <span class="s1">lut_lsq </span><span class="s3">= </span><span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                           <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">lut_lsq </span><span class="s3">= </span><span class="s1">lut_lsq</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">data </span><span class="s3">= </span><span class="s1">knotdata</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">new_lons</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">new_lats </span><span class="s3">= </span><span class="s1">knotsp</span><span class="s3">, </span><span class="s1">knotst</span>

    <span class="s2">def </span><span class="s1">test_linear_constant</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_lsq</span><span class="s3">.</span><span class="s1">get_residual</span><span class="s3">(), </span><span class="s4">0.0</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_lsq</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">new_lats</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">new_lons</span><span class="s3">),</span>
                                  <span class="s1">self</span><span class="s3">.</span><span class="s1">data</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_empty_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_lsq</span><span class="s3">([], []), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">)))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_lsq</span><span class="s3">([], [], </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">0</span><span class="s3">,)))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">ntheta</span><span class="s3">, </span><span class="s1">nphi </span><span class="s3">= </span><span class="s4">70</span><span class="s3">, </span><span class="s4">90</span>
        <span class="s1">theta </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.5 </span><span class="s3">/ (</span><span class="s1">ntheta </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s4">1 </span><span class="s3">- </span><span class="s4">0.5 </span><span class="s3">/ (</span><span class="s1">ntheta </span><span class="s3">- </span><span class="s4">1</span><span class="s3">),</span>
                         <span class="s1">ntheta</span><span class="s3">) * </span><span class="s1">pi</span>
        <span class="s1">phi </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.5 </span><span class="s3">/ (</span><span class="s1">nphi </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s4">1 </span><span class="s3">- </span><span class="s4">0.5 </span><span class="s3">/ (</span><span class="s1">nphi </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s1">nphi</span><span class="s3">) * </span><span class="s4">2. </span><span class="s3">* </span><span class="s1">pi</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">ones</span><span class="s3">((</span><span class="s1">theta</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">phi</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]))</span>
        <span class="s0"># define knots and extract data values at the knots</span>
        <span class="s1">knotst </span><span class="s3">= </span><span class="s1">theta</span><span class="s3">[::</span><span class="s4">5</span><span class="s3">]</span>
        <span class="s1">knotsp </span><span class="s3">= </span><span class="s1">phi</span><span class="s3">[::</span><span class="s4">5</span><span class="s3">]</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_theta </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s1">ntheta</span><span class="s3">) * </span><span class="s1">pi</span>
            <span class="s1">invalid_lats</span><span class="s3">, </span><span class="s1">lons </span><span class="s3">= </span><span class="s1">meshgrid</span><span class="s3">(</span><span class="s1">invalid_theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">)</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">invalid_lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;theta should be between [0, pi]&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_theta </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">1.1</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s1">ntheta</span><span class="s3">) * </span><span class="s1">pi</span>
            <span class="s1">invalid_lats</span><span class="s3">, </span><span class="s1">lons </span><span class="s3">= </span><span class="s1">meshgrid</span><span class="s3">(</span><span class="s1">invalid_theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">)</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">invalid_lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;theta should be between [0, pi]&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_phi </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">0.1</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s1">ntheta</span><span class="s3">) * </span><span class="s4">2.0 </span><span class="s3">* </span><span class="s1">pi</span>
            <span class="s1">lats</span><span class="s3">, </span><span class="s1">invalid_lons </span><span class="s3">= </span><span class="s1">meshgrid</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">invalid_phi</span><span class="s3">)</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">invalid_lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;phi should be between [0, 2pi]&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_phi </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.0</span><span class="s3">, </span><span class="s4">1.1</span><span class="s3">, </span><span class="s1">num</span><span class="s3">=</span><span class="s1">ntheta</span><span class="s3">) * </span><span class="s4">2.0 </span><span class="s3">* </span><span class="s1">pi</span>
            <span class="s1">lats</span><span class="s3">, </span><span class="s1">invalid_lons </span><span class="s3">= </span><span class="s1">meshgrid</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">invalid_phi</span><span class="s3">)</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">invalid_lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;phi should be between [0, 2pi]&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s1">lats</span><span class="s3">, </span><span class="s1">lons </span><span class="s3">= </span><span class="s1">meshgrid</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_knotst </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">(</span><span class="s1">knotst</span><span class="s3">)</span>
            <span class="s1">invalid_knotst</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] = -</span><span class="s4">0.1</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">invalid_knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;tt should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_knotst </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">(</span><span class="s1">knotst</span><span class="s3">)</span>
            <span class="s1">invalid_knotst</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] = </span><span class="s1">pi</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">invalid_knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;tt should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_knotsp </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">(</span><span class="s1">knotsp</span><span class="s3">)</span>
            <span class="s1">invalid_knotsp</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] = -</span><span class="s4">0.1</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">knotst</span><span class="s3">, </span><span class="s1">invalid_knotsp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;tp should be between (0, 2pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_knotsp </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">(</span><span class="s1">knotsp</span><span class="s3">)</span>
            <span class="s1">invalid_knotsp</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] = </span><span class="s4">2 </span><span class="s3">* </span><span class="s1">pi</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">knotst</span><span class="s3">, </span><span class="s1">invalid_knotsp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;tp should be between (0, 2pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_w </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">])</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">invalid_w</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;w should be positive&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">0.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                     <span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">ntheta</span><span class="s3">, </span><span class="s1">nphi </span><span class="s3">= </span><span class="s4">70</span><span class="s3">, </span><span class="s4">90</span>
        <span class="s1">theta </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.5 </span><span class="s3">/ (</span><span class="s1">ntheta </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s4">1 </span><span class="s3">- </span><span class="s4">0.5 </span><span class="s3">/ (</span><span class="s1">ntheta </span><span class="s3">- </span><span class="s4">1</span><span class="s3">),</span>
                         <span class="s1">ntheta</span><span class="s3">) * </span><span class="s1">pi</span>
        <span class="s1">phi </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.5 </span><span class="s3">/ (</span><span class="s1">nphi </span><span class="s3">- </span><span class="s4">1</span><span class="s3">), </span><span class="s4">1 </span><span class="s3">- </span><span class="s4">0.5 </span><span class="s3">/ (</span><span class="s1">nphi </span><span class="s3">- </span><span class="s4">1</span><span class="s3">),</span>
                       <span class="s1">nphi</span><span class="s3">) * </span><span class="s4">2. </span><span class="s3">* </span><span class="s1">pi</span>
        <span class="s1">lats</span><span class="s3">, </span><span class="s1">lons </span><span class="s3">= </span><span class="s1">meshgrid</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">)</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">ones</span><span class="s3">((</span><span class="s1">theta</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">phi</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]))</span>
        <span class="s0"># define knots and extract data values at the knots</span>
        <span class="s1">knotst </span><span class="s3">= </span><span class="s1">theta</span><span class="s3">[::</span><span class="s4">5</span><span class="s3">]</span>
        <span class="s1">knotsp </span><span class="s3">= </span><span class="s1">phi</span><span class="s3">[::</span><span class="s4">5</span><span class="s3">]</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s1">ones</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">().</span><span class="s1">shape</span><span class="s3">[</span><span class="s4">0</span><span class="s3">])</span>

        <span class="s0"># np.array input</span>
        <span class="s1">spl1 </span><span class="s3">= </span><span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(),</span>
                                        <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">(), </span><span class="s1">knotst</span><span class="s3">, </span><span class="s1">knotsp</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">)</span>
        <span class="s0"># list input</span>
        <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">LSQSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">().</span><span class="s1">tolist</span><span class="s3">(),</span>
                                        <span class="s1">lons</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">().</span><span class="s1">tolist</span><span class="s3">(),</span>
                                        <span class="s1">data</span><span class="s3">.</span><span class="s1">T</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">().</span><span class="s1">tolist</span><span class="s3">(),</span>
                                        <span class="s1">knotst</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(),</span>
                                        <span class="s1">knotsp</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">())</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">spl1</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">), </span><span class="s1">spl2</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">))</span>


<span class="s2">class </span><span class="s1">TestSmoothSphereBivariateSpline</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">setup_method</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">theta </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">.25</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">,</span>
                       <span class="s4">.75</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">])</span>
        <span class="s1">phi </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">,</span>
                     <span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">lut </span><span class="s3">= </span><span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1E10</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_linear_constant</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">get_residual</span><span class="s3">(), </span><span class="s4">0.</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">2</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">]),</span>
                                  <span class="s3">[[</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">], [</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">], [</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">]])</span>

    <span class="s2">def </span><span class="s1">test_empty_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut</span><span class="s3">([], []), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">)))</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut</span><span class="s3">([], [], </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">0</span><span class="s3">,)))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">theta </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                       <span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
        <span class="s1">phi </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">,</span>
                     <span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_theta </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([-</span><span class="s4">0.1 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                                   <span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                                   <span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
            <span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">invalid_theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1E10</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;theta should be between [0, pi]&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_theta </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                                   <span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                                   <span class="s4">1.1 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
            <span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">invalid_theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1E10</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;theta should be between [0, pi]&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_phi </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([-</span><span class="s4">.1 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                                 <span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
            <span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">invalid_phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1E10</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;phi should be between [0, 2pi]&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_phi </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1.0 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                                 <span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">2.1 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
            <span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">invalid_phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1E10</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;phi should be between [0, 2pi]&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">invalid_w </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([-</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">])</span>
            <span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">invalid_w</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1E10</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;w should be positive&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=-</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;s should be positive&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=-</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;eps should be between (0, 1)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">theta </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.25 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                          <span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.75 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
        <span class="s1">phi </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">, </span><span class="s4">.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">,</span>
                        <span class="s1">pi</span><span class="s3">, </span><span class="s4">1.5 </span><span class="s3">* </span><span class="s1">pi</span><span class="s3">])</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">3</span><span class="s3">])</span>
        <span class="s1">w </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">])</span>

        <span class="s0"># np.array input</span>
        <span class="s1">spl1 </span><span class="s3">= </span><span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">, </span><span class="s1">phi</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1E10</span><span class="s3">)</span>

        <span class="s0"># list input</span>
        <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">theta</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">phi</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(),</span>
                                           <span class="s1">r</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">w</span><span class="s3">=</span><span class="s1">w</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">s</span><span class="s3">=</span><span class="s4">1E10</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">spl1</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">), </span><span class="s1">spl2</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">))</span>


<span class="s2">class </span><span class="s1">TestRectBivariateSpline</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_defaults</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">),</span><span class="s1">z</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_evaluate</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>

        <span class="s1">xi </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2.3</span><span class="s3">, </span><span class="s4">5.3</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">3.3</span><span class="s3">, </span><span class="s4">1.2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">yi </span><span class="s3">= [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3.3</span><span class="s3">, </span><span class="s4">1.2</span><span class="s3">, </span><span class="s4">4.0</span><span class="s3">, </span><span class="s4">5.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">3</span><span class="s3">]</span>
        <span class="s1">zi </span><span class="s3">= </span><span class="s1">lut</span><span class="s3">.</span><span class="s1">ev</span><span class="s3">(</span><span class="s1">xi</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">)</span>
        <span class="s1">zi2 </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">, </span><span class="s1">yp</span><span class="s3">)[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">] </span><span class="s2">for </span><span class="s1">xp</span><span class="s3">, </span><span class="s1">yp </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">xi</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">)])</span>

        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">zi</span><span class="s3">, </span><span class="s1">zi2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_derivatives_grid</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">dx </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,-</span><span class="s4">20</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">],[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">13</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">],[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,-</span><span class="s4">11</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">],[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">]])/</span><span class="s4">6.</span>
        <span class="s1">dy </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">4</span><span class="s3">,-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,-</span><span class="s4">4</span><span class="s3">],[</span><span class="s4">4</span><span class="s3">,-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,-</span><span class="s4">4</span><span class="s3">],[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1.5</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,-</span><span class="s4">1.5</span><span class="s3">,</span><span class="s4">0</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s4">2</span><span class="s3">,</span><span class="s4">.25</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,-</span><span class="s4">.25</span><span class="s3">,-</span><span class="s4">2</span><span class="s3">],[</span><span class="s4">4</span><span class="s3">,-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,-</span><span class="s4">4</span><span class="s3">]])</span>
        <span class="s1">dxdy </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">40</span><span class="s3">,-</span><span class="s4">25</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">25</span><span class="s3">,-</span><span class="s4">40</span><span class="s3">],[-</span><span class="s4">26</span><span class="s3">,</span><span class="s4">16.25</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,-</span><span class="s4">16.25</span><span class="s3">,</span><span class="s4">26</span><span class="s3">],</span>
            <span class="s3">[-</span><span class="s4">8</span><span class="s3">,</span><span class="s4">5</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,-</span><span class="s4">5</span><span class="s3">,</span><span class="s4">8</span><span class="s3">],[</span><span class="s4">22</span><span class="s3">,-</span><span class="s4">13.75</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">13.75</span><span class="s3">,-</span><span class="s4">22</span><span class="s3">],[-</span><span class="s4">8</span><span class="s3">,</span><span class="s4">5</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,-</span><span class="s4">5</span><span class="s3">,</span><span class="s4">8</span><span class="s3">]])/</span><span class="s4">6.</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">dx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span><span class="s1">dx</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">dy</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span><span class="s1">dy</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">dx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">dy</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span><span class="s1">dxdy</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_derivatives</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">dx </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">2.</span><span class="s3">/</span><span class="s4">3</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">])</span>
        <span class="s1">dy </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">4</span><span class="s3">,-</span><span class="s4">1</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,-</span><span class="s4">.25</span><span class="s3">,-</span><span class="s4">4</span><span class="s3">])</span>
        <span class="s1">dxdy </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">160</span><span class="s3">,</span><span class="s4">65</span><span class="s3">,</span><span class="s4">0</span><span class="s3">,</span><span class="s4">55</span><span class="s3">,</span><span class="s4">32</span><span class="s3">])/</span><span class="s4">24.</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">dx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span><span class="s1">dx</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">dy</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span><span class="s1">dy</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">dx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">dy</span><span class="s3">=</span><span class="s4">1</span><span class="s3">,</span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span><span class="s1">dxdy</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_partial_derivative_method_grid</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">dx </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">20</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">13</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">11</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">]]) / </span><span class="s4">6.</span>
        <span class="s1">dy </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">4</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, -</span><span class="s4">4</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">4</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, -</span><span class="s4">4</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">2</span><span class="s3">, </span><span class="s4">.25</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">.25</span><span class="s3">, -</span><span class="s4">2</span><span class="s3">],</span>
                    <span class="s3">[</span><span class="s4">4</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, -</span><span class="s4">4</span><span class="s3">]])</span>
        <span class="s1">dxdy </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">40</span><span class="s3">, -</span><span class="s4">25</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">25</span><span class="s3">, -</span><span class="s4">40</span><span class="s3">],</span>
                      <span class="s3">[-</span><span class="s4">26</span><span class="s3">, </span><span class="s4">16.25</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">16.25</span><span class="s3">, </span><span class="s4">26</span><span class="s3">],</span>
                      <span class="s3">[-</span><span class="s4">8</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">5</span><span class="s3">, </span><span class="s4">8</span><span class="s3">],</span>
                      <span class="s3">[</span><span class="s4">22</span><span class="s3">, -</span><span class="s4">13.75</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">13.75</span><span class="s3">, -</span><span class="s4">22</span><span class="s3">],</span>
                      <span class="s3">[-</span><span class="s4">8</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">5</span><span class="s3">, </span><span class="s4">8</span><span class="s3">]]) / </span><span class="s4">6.</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">), </span><span class="s1">dx</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">), </span><span class="s1">dy</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">), </span><span class="s1">dxdy</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_partial_derivative_method</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">dx </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">2.</span><span class="s3">/</span><span class="s4">3</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">])</span>
        <span class="s1">dy </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">4</span><span class="s3">, -</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, -</span><span class="s4">.25</span><span class="s3">, -</span><span class="s4">4</span><span class="s3">])</span>
        <span class="s1">dxdy </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">160</span><span class="s3">, </span><span class="s4">65</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">55</span><span class="s3">, </span><span class="s4">32</span><span class="s3">]) / </span><span class="s4">24.</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">,</span>
                                                               <span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                                  <span class="s1">dx</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">,</span>
                                                               <span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                                  <span class="s1">dy</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">,</span>
                                                               <span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                                  <span class="s1">dxdy</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_partial_derivative_order_too_large</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">float</span><span class="s3">)</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">x</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">ones</span><span class="s3">((</span><span class="s1">x</span><span class="s3">.</span><span class="s1">size</span><span class="s3">, </span><span class="s1">y</span><span class="s3">.</span><span class="s1">size</span><span class="s3">))</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">):</span>
            <span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">4</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_broadcast</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">4</span><span class="s3">,</span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">), </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">[:,</span><span class="s2">None</span><span class="s3">], </span><span class="s1">y</span><span class="s3">[</span><span class="s2">None</span><span class="s3">,:], </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_invalid_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">6</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                       <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
            <span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x must be strictly increasing&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                       <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
            <span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;y must be strictly increasing&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                       <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
            <span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x dimension of z must have same number of elements as x&quot;</span><span class="s1">\</span>
               <span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">],</span>
                       <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">]])</span>
            <span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;y dimension of z must have same number of elements as y&quot;</span><span class="s1">\</span>
               <span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
            <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                       <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
            <span class="s1">bbox </span><span class="s3">= (-</span><span class="s4">100</span><span class="s3">, </span><span class="s4">100</span><span class="s3">, -</span><span class="s4">100</span><span class="s3">)</span>
            <span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;bbox shape should be (4,)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">info</span><span class="s3">:</span>
            <span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=-</span><span class="s4">1.0</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;s should be s &gt;= 0.0&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">bbox </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">])</span>

        <span class="s1">spl1 </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">, </span><span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">)</span>
        <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">y</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">z</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(),</span>
                                   <span class="s1">bbox</span><span class="s3">=</span><span class="s1">bbox</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">())</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">spl1</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">), </span><span class="s1">spl2</span><span class="s3">(</span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_not_increasing_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># gh-8565</span>
        <span class="s1">NSamp </span><span class="s3">= </span><span class="s4">20</span>
        <span class="s1">Theta </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">uniform</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span><span class="s3">, </span><span class="s1">NSamp</span><span class="s3">)</span>
        <span class="s1">Phi </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">random</span><span class="s3">.</span><span class="s1">uniform</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">2 </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span><span class="s3">, </span><span class="s1">NSamp</span><span class="s3">)</span>
        <span class="s1">Data </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ones</span><span class="s3">(</span><span class="s1">NSamp</span><span class="s3">)</span>

        <span class="s1">Interpolator </span><span class="s3">= </span><span class="s1">SmoothSphereBivariateSpline</span><span class="s3">(</span><span class="s1">Theta</span><span class="s3">, </span><span class="s1">Phi</span><span class="s3">, </span><span class="s1">Data</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">3.5</span><span class="s3">)</span>

        <span class="s1">NLon </span><span class="s3">= </span><span class="s4">6</span>
        <span class="s1">NLat </span><span class="s3">= </span><span class="s4">3</span>
        <span class="s1">GridPosLats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">NLat</span><span class="s3">) / </span><span class="s1">NLat </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span>
        <span class="s1">GridPosLons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s1">NLon</span><span class="s3">) / </span><span class="s1">NLon </span><span class="s3">* </span><span class="s4">2 </span><span class="s3">* </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi</span>

        <span class="s0"># No error</span>
        <span class="s1">Interpolator</span><span class="s3">(</span><span class="s1">GridPosLats</span><span class="s3">, </span><span class="s1">GridPosLons</span><span class="s3">)</span>

        <span class="s1">nonGridPosLats </span><span class="s3">= </span><span class="s1">GridPosLats</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">nonGridPosLats</span><span class="s3">[</span><span class="s4">2</span><span class="s3">] = </span><span class="s4">0.001</span>
        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">Interpolator</span><span class="s3">(</span><span class="s1">nonGridPosLats</span><span class="s3">, </span><span class="s1">GridPosLons</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;x must be strictly increasing&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s1">nonGridPosLons </span><span class="s3">= </span><span class="s1">GridPosLons</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">nonGridPosLons</span><span class="s3">[</span><span class="s4">2</span><span class="s3">] = </span><span class="s4">0.001</span>
        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">Interpolator</span><span class="s3">(</span><span class="s1">GridPosLats</span><span class="s3">, </span><span class="s1">nonGridPosLons</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;y must be strictly increasing&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestRectSphereBivariateSpline</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_defaults</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">2</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">),</span><span class="s1">z</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_evaluate</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">2</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">yi </span><span class="s3">= [</span><span class="s4">0.2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2.3</span><span class="s3">, </span><span class="s4">2.35</span><span class="s3">, </span><span class="s4">3.0</span><span class="s3">, </span><span class="s4">3.99</span><span class="s3">, </span><span class="s4">5.25</span><span class="s3">]</span>
        <span class="s1">xi </span><span class="s3">= [</span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">0.4</span><span class="s3">, </span><span class="s4">1.1</span><span class="s3">, </span><span class="s4">0.45</span><span class="s3">, </span><span class="s4">0.2345</span><span class="s3">, </span><span class="s4">1.</span><span class="s3">, </span><span class="s4">0.0001</span><span class="s3">]</span>
        <span class="s1">zi </span><span class="s3">= </span><span class="s1">lut</span><span class="s3">.</span><span class="s1">ev</span><span class="s3">(</span><span class="s1">xi</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">)</span>
        <span class="s1">zi2 </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">xp</span><span class="s3">, </span><span class="s1">yp</span><span class="s3">)[</span><span class="s4">0</span><span class="s3">,</span><span class="s4">0</span><span class="s3">] </span><span class="s2">for </span><span class="s1">xp</span><span class="s3">, </span><span class="s1">yp </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">xi</span><span class="s3">, </span><span class="s1">yi</span><span class="s3">)])</span>
        <span class="s1">assert_almost_equal</span><span class="s3">(</span><span class="s1">zi</span><span class="s3">, </span><span class="s1">zi2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dot</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">atleast_2d</span><span class="s3">(</span><span class="s4">90. </span><span class="s3">- </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">80.</span><span class="s3">, </span><span class="s4">80.</span><span class="s3">, </span><span class="s4">18</span><span class="s3">)).</span><span class="s1">T</span><span class="s3">,</span>
                      <span class="s1">np</span><span class="s3">.</span><span class="s1">atleast_2d</span><span class="s3">(</span><span class="s4">180. </span><span class="s3">- </span><span class="s1">np</span><span class="s3">.</span><span class="s1">abs</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">350.</span><span class="s3">, </span><span class="s4">9</span><span class="s3">)))).</span><span class="s1">T</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">1</span><span class="s3">, </span><span class="s4">170</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">350</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;u should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">181</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">350</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;u should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">170</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">181</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;v[0] should be between [-pi, pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">170</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">10</span><span class="s3">, </span><span class="s4">360</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;v[-1] should be v[0] + 2pi or less&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">170</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">350</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=-</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;s should be positive&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_derivatives_grid</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">2</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>

        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>

        <span class="s1">y </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.02</span><span class="s3">, </span><span class="s4">2</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.02</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.02</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.02</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>

        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">), </span><span class="s1">_numdiff_2d</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                        <span class="s1">rtol</span><span class="s3">=</span><span class="s4">1e-4</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-4</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dphi</span><span class="s3">=</span><span class="s4">1</span><span class="s3">), </span><span class="s1">_numdiff_2d</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dy</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                        <span class="s1">rtol</span><span class="s3">=</span><span class="s4">1e-4</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-4</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">dphi</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                        <span class="s1">_numdiff_2d</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">dy</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">1e-6</span><span class="s3">),</span>
                        <span class="s1">rtol</span><span class="s3">=</span><span class="s4">1e-3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-3</span><span class="s3">)</span>

        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                           <span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dphi</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                           <span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">dphi</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                           <span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">))</span>

        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                           <span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">0</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dphi</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                           <span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">))</span>
        <span class="s1">assert_array_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">dphi</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                           <span class="s1">lut</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_derivatives</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">2</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">3</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">,</span><span class="s4">2</span><span class="s3">,</span><span class="s4">1</span><span class="s3">]])</span>

        <span class="s1">lut </span><span class="s3">= </span><span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">z</span><span class="s3">)</span>

        <span class="s1">y </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.02</span><span class="s3">, </span><span class="s4">2</span><span class="s3">*</span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.02</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.02</span><span class="s3">, </span><span class="s1">pi</span><span class="s3">-</span><span class="s4">0.02</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>

        <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">).</span><span class="s1">shape</span><span class="s3">, </span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                        <span class="s1">_numdiff_2d</span><span class="s3">(</span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">: </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">), </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                        <span class="s1">rtol</span><span class="s3">=</span><span class="s4">1e-4</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-4</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dphi</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                        <span class="s1">_numdiff_2d</span><span class="s3">(</span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">: </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">), </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dy</span><span class="s3">=</span><span class="s4">1</span><span class="s3">),</span>
                        <span class="s1">rtol</span><span class="s3">=</span><span class="s4">1e-4</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-4</span><span class="s3">)</span>
        <span class="s1">assert_allclose</span><span class="s3">(</span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dtheta</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">dphi</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                        <span class="s1">_numdiff_2d</span><span class="s3">(</span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">: </span><span class="s1">lut</span><span class="s3">(</span><span class="s1">x</span><span class="s3">,</span><span class="s1">y</span><span class="s3">,</span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">),</span>
                                    <span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dx</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">dy</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">1e-6</span><span class="s3">),</span>
                        <span class="s1">rtol</span><span class="s3">=</span><span class="s4">1e-3</span><span class="s3">, </span><span class="s1">atol</span><span class="s3">=</span><span class="s4">1e-3</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_invalid_input_2</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">dot</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">atleast_2d</span><span class="s3">(</span><span class="s4">90. </span><span class="s3">- </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">80.</span><span class="s3">, </span><span class="s4">80.</span><span class="s3">, </span><span class="s4">18</span><span class="s3">)).</span><span class="s1">T</span><span class="s3">,</span>
                      <span class="s1">np</span><span class="s3">.</span><span class="s1">atleast_2d</span><span class="s3">(</span><span class="s4">180. </span><span class="s3">- </span><span class="s1">np</span><span class="s3">.</span><span class="s1">abs</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.</span><span class="s3">, </span><span class="s4">350.</span><span class="s3">, </span><span class="s4">9</span><span class="s3">)))).</span><span class="s1">T</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">170</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">350</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;u should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">180</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">350</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;u should be between (0, pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">170</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">181</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;v[0] should be between [-pi, pi)&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">170</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(-</span><span class="s4">10</span><span class="s3">, </span><span class="s4">360</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;v[-1] should be v[0] + 2pi or less&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">) </span><span class="s2">as </span><span class="s1">exc_info</span><span class="s3">:</span>
            <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">170</span><span class="s3">, </span><span class="s4">9</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">350</span><span class="s3">, </span><span class="s4">18</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">180.</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">, </span><span class="s1">data</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=-</span><span class="s4">1</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s6">&quot;s should be positive&quot; </span><span class="s2">in </span><span class="s1">str</span><span class="s3">(</span><span class="s1">exc_info</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_array_like_input</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">2 </span><span class="s3">* </span><span class="s1">pi </span><span class="s3">- </span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.01</span><span class="s3">, </span><span class="s1">pi </span><span class="s3">- </span><span class="s4">0.01</span><span class="s3">, </span><span class="s4">7</span><span class="s3">)</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">], [</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">],</span>
                   <span class="s3">[</span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">]])</span>
        <span class="s0"># np.array input</span>
        <span class="s1">spl1 </span><span class="s3">= </span><span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s0"># list input</span>
        <span class="s1">spl2 </span><span class="s3">= </span><span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">y</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">(), </span><span class="s1">z</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">())</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">spl1</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">), </span><span class="s1">spl2</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_negative_evaluation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">lats </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">25</span><span class="s3">, </span><span class="s4">30</span><span class="s3">, </span><span class="s4">35</span><span class="s3">, </span><span class="s4">40</span><span class="s3">, </span><span class="s4">45</span><span class="s3">])</span>
        <span class="s1">lons </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([-</span><span class="s4">90</span><span class="s3">, -</span><span class="s4">85</span><span class="s3">, -</span><span class="s4">80</span><span class="s3">, -</span><span class="s4">75</span><span class="s3">, </span><span class="s4">70</span><span class="s3">])</span>
        <span class="s1">mesh </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">meshgrid</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">, </span><span class="s1">lons</span><span class="s3">)</span>
        <span class="s1">data </span><span class="s3">= </span><span class="s1">mesh</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] + </span><span class="s1">mesh</span><span class="s3">[</span><span class="s4">1</span><span class="s3">]  </span><span class="s0"># lon + lat value</span>
        <span class="s1">lat_r </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">radians</span><span class="s3">(</span><span class="s1">lats</span><span class="s3">)</span>
        <span class="s1">lon_r </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">radians</span><span class="s3">(</span><span class="s1">lons</span><span class="s3">)</span>
        <span class="s1">interpolator </span><span class="s3">= </span><span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">lat_r</span><span class="s3">, </span><span class="s1">lon_r</span><span class="s3">, </span><span class="s1">data</span><span class="s3">)</span>
        <span class="s1">query_lat </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">radians</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">35</span><span class="s3">, </span><span class="s4">37.5</span><span class="s3">]))</span>
        <span class="s1">query_lon </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">radians</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([-</span><span class="s4">80</span><span class="s3">, -</span><span class="s4">77.5</span><span class="s3">]))</span>
        <span class="s1">data_interp </span><span class="s3">= </span><span class="s1">interpolator</span><span class="s3">(</span><span class="s1">query_lat</span><span class="s3">, </span><span class="s1">query_lon</span><span class="s3">)</span>
        <span class="s1">ans </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[-</span><span class="s4">45.0</span><span class="s3">, -</span><span class="s4">42.480862</span><span class="s3">],</span>
                        <span class="s3">[-</span><span class="s4">49.0625</span><span class="s3">, -</span><span class="s4">46.54315</span><span class="s3">]])</span>
        <span class="s1">assert_array_almost_equal</span><span class="s3">(</span><span class="s1">data_interp</span><span class="s3">, </span><span class="s1">ans</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_pole_continuity_gh_14591</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># regression test for https://github.com/scipy/scipy/issues/14591</span>
        <span class="s0"># with pole_continuty=(True, True), the internal work array size</span>
        <span class="s0"># was too small, leading to a FITPACK data validation error.</span>

        <span class="s0"># The reproducer in gh-14591 was using a NetCDF4 file with</span>
        <span class="s0"># 361x507 arrays, so here we trivialize array sizes to a minimum</span>
        <span class="s0"># which still demonstrates the issue.</span>
        <span class="s1">u </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">10</span>
        <span class="s1">v </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">) * </span><span class="s1">np</span><span class="s3">.</span><span class="s1">pi </span><span class="s3">/ </span><span class="s4">10</span>
        <span class="s1">r </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">zeros</span><span class="s3">((</span><span class="s4">9</span><span class="s3">, </span><span class="s4">9</span><span class="s3">))</span>
        <span class="s2">for </span><span class="s1">p </span><span class="s2">in </span><span class="s3">[(</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">), (</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">), (</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">)]:</span>
            <span class="s1">RectSphereBivariateSpline</span><span class="s3">(</span><span class="s1">u</span><span class="s3">, </span><span class="s1">v</span><span class="s3">, </span><span class="s1">r</span><span class="s3">, </span><span class="s1">s</span><span class="s3">=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">pole_continuity</span><span class="s3">=</span><span class="s1">p</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_numdiff_2d</span><span class="s3">(</span><span class="s1">func</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">dx</span><span class="s3">=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">dy</span><span class="s3">=</span><span class="s4">0</span><span class="s3">, </span><span class="s1">eps</span><span class="s3">=</span><span class="s4">1e-8</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">dx </span><span class="s3">== </span><span class="s4">0 </span><span class="s2">and </span><span class="s1">dy </span><span class="s3">== </span><span class="s4">0</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">func</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">dx </span><span class="s3">== </span><span class="s4">1 </span><span class="s2">and </span><span class="s1">dy </span><span class="s3">== </span><span class="s4">0</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s3">(</span><span class="s1">func</span><span class="s3">(</span><span class="s1">x </span><span class="s3">+ </span><span class="s1">eps</span><span class="s3">, </span><span class="s1">y</span><span class="s3">) - </span><span class="s1">func</span><span class="s3">(</span><span class="s1">x </span><span class="s3">- </span><span class="s1">eps</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)) / (</span><span class="s4">2</span><span class="s3">*</span><span class="s1">eps</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">dx </span><span class="s3">== </span><span class="s4">0 </span><span class="s2">and </span><span class="s1">dy </span><span class="s3">== </span><span class="s4">1</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s3">(</span><span class="s1">func</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s3">+ </span><span class="s1">eps</span><span class="s3">) - </span><span class="s1">func</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y </span><span class="s3">- </span><span class="s1">eps</span><span class="s3">)) / (</span><span class="s4">2</span><span class="s3">*</span><span class="s1">eps</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">dx </span><span class="s3">== </span><span class="s4">1 </span><span class="s2">and </span><span class="s1">dy </span><span class="s3">== </span><span class="s4">1</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s3">(</span><span class="s1">func</span><span class="s3">(</span><span class="s1">x </span><span class="s3">+ </span><span class="s1">eps</span><span class="s3">, </span><span class="s1">y </span><span class="s3">+ </span><span class="s1">eps</span><span class="s3">) - </span><span class="s1">func</span><span class="s3">(</span><span class="s1">x </span><span class="s3">- </span><span class="s1">eps</span><span class="s3">, </span><span class="s1">y </span><span class="s3">+ </span><span class="s1">eps</span><span class="s3">)</span>
                <span class="s3">- </span><span class="s1">func</span><span class="s3">(</span><span class="s1">x </span><span class="s3">+ </span><span class="s1">eps</span><span class="s3">, </span><span class="s1">y </span><span class="s3">- </span><span class="s1">eps</span><span class="s3">) + </span><span class="s1">func</span><span class="s3">(</span><span class="s1">x </span><span class="s3">- </span><span class="s1">eps</span><span class="s3">, </span><span class="s1">y </span><span class="s3">- </span><span class="s1">eps</span><span class="s3">)) / (</span><span class="s4">2</span><span class="s3">*</span><span class="s1">eps</span><span class="s3">)**</span><span class="s4">2</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s6">&quot;invalid derivative order&quot;</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">Test_DerivedBivariateSpline</span><span class="s3">:</span>
    <span class="s5">&quot;&quot;&quot;Test the creation, usage, and attribute access of the (private) 
    _DerivedBivariateSpline class. 
    &quot;&quot;&quot;</span>
    <span class="s2">def </span><span class="s1">setup_method</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">concatenate</span><span class="s3">(</span><span class="s1">list</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">))))</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">concatenate</span><span class="s3">(</span><span class="s1">list</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">10</span><span class="s3">), </span><span class="s1">range</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">11</span><span class="s3">))))</span>
        <span class="s1">z </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">concatenate</span><span class="s3">((</span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">10</span><span class="s3">)))</span>
        <span class="s2">with </span><span class="s1">suppress_warnings</span><span class="s3">() </span><span class="s2">as </span><span class="s1">sup</span><span class="s3">:</span>
            <span class="s1">sup</span><span class="s3">.</span><span class="s1">record</span><span class="s3">(</span><span class="s1">UserWarning</span><span class="s3">, </span><span class="s6">&quot;</span><span class="s2">\n</span><span class="s6">The coefficients of the spline&quot;</span><span class="s3">)</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">lut_lsq </span><span class="s3">= </span><span class="s1">LSQBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">,</span>
                                              <span class="s1">linspace</span><span class="s3">(</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">19.5</span><span class="s3">, </span><span class="s4">4</span><span class="s3">),</span>
                                              <span class="s1">linspace</span><span class="s3">(</span><span class="s4">1.5</span><span class="s3">, </span><span class="s4">20.5</span><span class="s3">, </span><span class="s4">4</span><span class="s3">),</span>
                                              <span class="s1">eps</span><span class="s3">=</span><span class="s4">1e-2</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">lut_smooth </span><span class="s3">= </span><span class="s1">SmoothBivariateSpline</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">y</span><span class="s3">, </span><span class="s1">z</span><span class="s3">)</span>
        <span class="s1">xx </span><span class="s3">= </span><span class="s1">linspace</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">20</span><span class="s3">)</span>
        <span class="s1">yy </span><span class="s3">= </span><span class="s1">xx </span><span class="s3">+ </span><span class="s4">1.0</span>
        <span class="s1">zz </span><span class="s3">= </span><span class="s1">array</span><span class="s3">([</span><span class="s1">np</span><span class="s3">.</span><span class="s1">roll</span><span class="s3">(</span><span class="s1">z</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">z</span><span class="s3">.</span><span class="s1">size</span><span class="s3">)])</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">lut_rect </span><span class="s3">= </span><span class="s1">RectBivariateSpline</span><span class="s3">(</span><span class="s1">xx</span><span class="s3">, </span><span class="s1">yy</span><span class="s3">, </span><span class="s1">zz</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">orders </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">itertools</span><span class="s3">.</span><span class="s1">product</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s4">3</span><span class="s3">), </span><span class="s1">range</span><span class="s3">(</span><span class="s4">3</span><span class="s3">)))</span>

    <span class="s2">def </span><span class="s1">test_creation_from_LSQ</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">for </span><span class="s1">nux</span><span class="s3">, </span><span class="s1">nuy </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">orders</span><span class="s3">:</span>
            <span class="s1">lut_der </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_lsq</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s1">nux</span><span class="s3">, </span><span class="s1">nuy</span><span class="s3">)</span>
            <span class="s1">a </span><span class="s3">= </span><span class="s1">lut_der</span><span class="s3">(</span><span class="s4">3.5</span><span class="s3">, </span><span class="s4">3.5</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">b </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_lsq</span><span class="s3">(</span><span class="s4">3.5</span><span class="s3">, </span><span class="s4">3.5</span><span class="s3">, </span><span class="s1">dx</span><span class="s3">=</span><span class="s1">nux</span><span class="s3">, </span><span class="s1">dy</span><span class="s3">=</span><span class="s1">nuy</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_creation_from_Smooth</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">for </span><span class="s1">nux</span><span class="s3">, </span><span class="s1">nuy </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">orders</span><span class="s3">:</span>
            <span class="s1">lut_der </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_smooth</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s1">nux</span><span class="s3">, </span><span class="s1">nuy</span><span class="s3">)</span>
            <span class="s1">a </span><span class="s3">= </span><span class="s1">lut_der</span><span class="s3">(</span><span class="s4">5.5</span><span class="s3">, </span><span class="s4">5.5</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">b </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_smooth</span><span class="s3">(</span><span class="s4">5.5</span><span class="s3">, </span><span class="s4">5.5</span><span class="s3">, </span><span class="s1">dx</span><span class="s3">=</span><span class="s1">nux</span><span class="s3">, </span><span class="s1">dy</span><span class="s3">=</span><span class="s1">nuy</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_creation_from_Rect</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">for </span><span class="s1">nux</span><span class="s3">, </span><span class="s1">nuy </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">orders</span><span class="s3">:</span>
            <span class="s1">lut_der </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_rect</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s1">nux</span><span class="s3">, </span><span class="s1">nuy</span><span class="s3">)</span>
            <span class="s1">a </span><span class="s3">= </span><span class="s1">lut_der</span><span class="s3">(</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">b </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_rect</span><span class="s3">(</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1.5</span><span class="s3">, </span><span class="s1">dx</span><span class="s3">=</span><span class="s1">nux</span><span class="s3">, </span><span class="s1">dy</span><span class="s3">=</span><span class="s1">nuy</span><span class="s3">, </span><span class="s1">grid</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
            <span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_invalid_attribute_fp</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">der </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_rect</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">):</span>
            <span class="s1">der</span><span class="s3">.</span><span class="s1">fp</span>

    <span class="s2">def </span><span class="s1">test_invalid_attribute_get_residual</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">der </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">lut_smooth</span><span class="s3">.</span><span class="s1">partial_derivative</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">assert_raises</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">):</span>
            <span class="s1">der</span><span class="s3">.</span><span class="s1">get_residual</span><span class="s3">()</span>
</pre>
</body>
</html>