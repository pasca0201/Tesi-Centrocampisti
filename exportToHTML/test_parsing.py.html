<html>
<head>
<title>test_parsing.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_parsing.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
Tests for Timestamp parsing, aimed at pandas/_libs/tslibs/parsing.pyx 
&quot;&quot;&quot;</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s1">datetime</span>
<span class="s2">import </span><span class="s1">re</span>

<span class="s2">from </span><span class="s1">dateutil</span><span class="s3">.</span><span class="s1">parser </span><span class="s2">import </span><span class="s1">parse </span><span class="s2">as </span><span class="s1">du_parse</span>
<span class="s2">from </span><span class="s1">dateutil</span><span class="s3">.</span><span class="s1">tz </span><span class="s2">import </span><span class="s1">tzlocal</span>
<span class="s2">from </span><span class="s1">hypothesis </span><span class="s2">import </span><span class="s1">given</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">parsing</span><span class="s3">,</span>
    <span class="s1">strptime</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs</span><span class="s3">.</span><span class="s1">parsing </span><span class="s2">import </span><span class="s1">parse_datetime_string_with_reso</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">compat </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">ISMUSL</span><span class="s3">,</span>
    <span class="s1">is_platform_windows</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">util</span><span class="s3">.</span><span class="s1">_test_decorators </span><span class="s2">as </span><span class="s1">td</span>

<span class="s2">import </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_testing </span><span class="s2">as </span><span class="s1">tm</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_testing</span><span class="s3">.</span><span class="s1">_hypothesis </span><span class="s2">import </span><span class="s1">DATETIME_NO_TZ</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">skipif</span><span class="s3">(</span>
    <span class="s1">is_platform_windows</span><span class="s3">() </span><span class="s2">or </span><span class="s1">ISMUSL</span><span class="s3">,</span>
    <span class="s1">reason</span><span class="s3">=</span><span class="s4">&quot;TZ setting incorrect on Windows and MUSL Linux&quot;</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_parsing_tzlocal_deprecated</span><span class="s3">():</span>
    <span class="s5"># GH#50791</span>
    <span class="s1">msg </span><span class="s3">= (</span>
        <span class="s4">&quot;Parsing 'EST' as tzlocal.*&quot;</span>
        <span class="s4">&quot;Pass the 'tz' keyword or call tz_localize after construction instead&quot;</span>
    <span class="s3">)</span>
    <span class="s1">dtstr </span><span class="s3">= </span><span class="s4">&quot;Jan 15 2004 03:00 EST&quot;</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">set_timezone</span><span class="s3">(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s3">):</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">res</span><span class="s3">, </span><span class="s1">_ </span><span class="s3">= </span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s1">dtstr</span><span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">res</span><span class="s3">.</span><span class="s1">tzinfo</span><span class="s3">, </span><span class="s1">tzlocal</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">res </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">py_parse_datetime_string</span><span class="s3">(</span><span class="s1">dtstr</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">res</span><span class="s3">.</span><span class="s1">tzinfo</span><span class="s3">, </span><span class="s1">tzlocal</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_parse_datetime_string_with_reso</span><span class="s3">():</span>
    <span class="s3">(</span><span class="s1">parsed</span><span class="s3">, </span><span class="s1">reso</span><span class="s3">) = </span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s4">&quot;4Q1984&quot;</span><span class="s3">)</span>
    <span class="s3">(</span><span class="s1">parsed_lower</span><span class="s3">, </span><span class="s1">reso_lower</span><span class="s3">) = </span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s4">&quot;4q1984&quot;</span><span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">reso </span><span class="s3">== </span><span class="s1">reso_lower</span>
    <span class="s2">assert </span><span class="s1">parsed </span><span class="s3">== </span><span class="s1">parsed_lower</span>


<span class="s2">def </span><span class="s1">test_parse_datetime_string_with_reso_nanosecond_reso</span><span class="s3">():</span>
    <span class="s5"># GH#46811</span>
    <span class="s1">parsed</span><span class="s3">, </span><span class="s1">reso </span><span class="s3">= </span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s4">&quot;2022-04-20 09:19:19.123456789&quot;</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">reso </span><span class="s3">== </span><span class="s4">&quot;nanosecond&quot;</span>


<span class="s2">def </span><span class="s1">test_parse_datetime_string_with_reso_invalid_type</span><span class="s3">():</span>
    <span class="s5"># Raise on invalid input, don't just return it</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Argument 'date_string' has incorrect type (expected str, got tuple)&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">re</span><span class="s3">.</span><span class="s1">escape</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">)):</span>
        <span class="s1">parse_datetime_string_with_reso</span><span class="s3">((</span><span class="s6">4</span><span class="s3">, </span><span class="s6">5</span><span class="s3">))</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;dashed,normal&quot;</span><span class="s3">, [(</span><span class="s4">&quot;1988-Q2&quot;</span><span class="s3">, </span><span class="s4">&quot;1988Q2&quot;</span><span class="s3">), (</span><span class="s4">&quot;2Q-1988&quot;</span><span class="s3">, </span><span class="s4">&quot;2Q1988&quot;</span><span class="s3">)]</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_parse_time_quarter_with_dash</span><span class="s3">(</span><span class="s1">dashed</span><span class="s3">, </span><span class="s1">normal</span><span class="s3">):</span>
    <span class="s5"># see gh-9688</span>
    <span class="s3">(</span><span class="s1">parsed_dash</span><span class="s3">, </span><span class="s1">reso_dash</span><span class="s3">) = </span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s1">dashed</span><span class="s3">)</span>
    <span class="s3">(</span><span class="s1">parsed</span><span class="s3">, </span><span class="s1">reso</span><span class="s3">) = </span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s1">normal</span><span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">parsed_dash </span><span class="s3">== </span><span class="s1">parsed</span>
    <span class="s2">assert </span><span class="s1">reso_dash </span><span class="s3">== </span><span class="s1">reso</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dashed&quot;</span><span class="s3">, [</span><span class="s4">&quot;-2Q1992&quot;</span><span class="s3">, </span><span class="s4">&quot;2-Q1992&quot;</span><span class="s3">, </span><span class="s4">&quot;4-4Q1992&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_parse_time_quarter_with_dash_error</span><span class="s3">(</span><span class="s1">dashed</span><span class="s3">):</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s4">f&quot;Unknown datetime string format, unable to parse: </span><span class="s2">{</span><span class="s1">dashed</span><span class="s2">}</span><span class="s4">&quot;</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">DateParseError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s1">dashed</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;date_string,expected&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span><span class="s4">&quot;123.1234&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;-50000&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;999&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;m&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;T&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;Mon Sep 16, 2013&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2012-01-01&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;01/01/2012&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;01012012&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;0101&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;1-1&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_does_not_convert_mixed_integer</span><span class="s3">(</span><span class="s1">date_string</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
    <span class="s2">assert </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">_does_string_look_like_datetime</span><span class="s3">(</span><span class="s1">date_string</span><span class="s3">) </span><span class="s2">is </span><span class="s1">expected</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;date_str,kwargs,msg&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span>
            <span class="s4">&quot;2013Q5&quot;</span><span class="s3">,</span>
            <span class="s3">{},</span>
            <span class="s3">(</span>
                <span class="s4">&quot;Incorrect quarterly string is given, &quot;</span>
                <span class="s4">&quot;quarter must be between 1 and 4: 2013Q5&quot;</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
        <span class="s5"># see gh-5418</span>
        <span class="s3">(</span>
            <span class="s4">&quot;2013Q1&quot;</span><span class="s3">,</span>
            <span class="s3">{</span><span class="s4">&quot;freq&quot;</span><span class="s3">: </span><span class="s4">&quot;INVLD-L-DEC-SAT&quot;</span><span class="s3">},</span>
            <span class="s3">(</span>
                <span class="s4">&quot;Unable to retrieve month information &quot;</span>
                <span class="s4">&quot;from given freq: INVLD-L-DEC-SAT&quot;</span>
            <span class="s3">),</span>
        <span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_parsers_quarterly_with_freq_error</span><span class="s3">(</span><span class="s1">date_str</span><span class="s3">, </span><span class="s1">kwargs</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">):</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">DateParseError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">parsing</span><span class="s3">.</span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s1">date_str</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;date_str,freq,expected&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span><span class="s4">&quot;2013Q2&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s1">datetime</span><span class="s3">(</span><span class="s6">2013</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">1</span><span class="s3">)),</span>
        <span class="s3">(</span><span class="s4">&quot;2013Q2&quot;</span><span class="s3">, </span><span class="s4">&quot;Y-APR&quot;</span><span class="s3">, </span><span class="s1">datetime</span><span class="s3">(</span><span class="s6">2012</span><span class="s3">, </span><span class="s6">8</span><span class="s3">, </span><span class="s6">1</span><span class="s3">)),</span>
        <span class="s3">(</span><span class="s4">&quot;2013-Q2&quot;</span><span class="s3">, </span><span class="s4">&quot;Y-DEC&quot;</span><span class="s3">, </span><span class="s1">datetime</span><span class="s3">(</span><span class="s6">2013</span><span class="s3">, </span><span class="s6">4</span><span class="s3">, </span><span class="s6">1</span><span class="s3">)),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_parsers_quarterly_with_freq</span><span class="s3">(</span><span class="s1">date_str</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
    <span class="s1">result</span><span class="s3">, </span><span class="s1">_ </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s1">date_str</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">expected</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;date_str&quot;</span><span class="s3">, [</span><span class="s4">&quot;2Q 2005&quot;</span><span class="s3">, </span><span class="s4">&quot;2Q-200Y&quot;</span><span class="s3">, </span><span class="s4">&quot;2Q-200&quot;</span><span class="s3">, </span><span class="s4">&quot;22Q2005&quot;</span><span class="s3">, </span><span class="s4">&quot;2Q200.&quot;</span><span class="s3">, </span><span class="s4">&quot;6Q-20&quot;</span><span class="s3">]</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_parsers_quarter_invalid</span><span class="s3">(</span><span class="s1">date_str</span><span class="s3">):</span>
    <span class="s2">if </span><span class="s1">date_str </span><span class="s3">== </span><span class="s4">&quot;6Q-20&quot;</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= (</span>
            <span class="s4">&quot;Incorrect quarterly string is given, quarter &quot;</span>
            <span class="s4">f&quot;must be between 1 and 4: </span><span class="s2">{</span><span class="s1">date_str</span><span class="s2">}</span><span class="s4">&quot;</span>
        <span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">f&quot;Unknown datetime string format, unable to parse: </span><span class="s2">{</span><span class="s1">date_str</span><span class="s2">}</span><span class="s4">&quot;</span>

    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">parsing</span><span class="s3">.</span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s1">date_str</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;date_str,expected&quot;</span><span class="s3">,</span>
    <span class="s3">[(</span><span class="s4">&quot;201101&quot;</span><span class="s3">, </span><span class="s1">datetime</span><span class="s3">(</span><span class="s6">2011</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">)), (</span><span class="s4">&quot;200005&quot;</span><span class="s3">, </span><span class="s1">datetime</span><span class="s3">(</span><span class="s6">2000</span><span class="s3">, </span><span class="s6">5</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s6">0</span><span class="s3">))],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_parsers_month_freq</span><span class="s3">(</span><span class="s1">date_str</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
    <span class="s1">result</span><span class="s3">, </span><span class="s1">_ </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s1">date_str</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;ME&quot;</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">expected</span>


<span class="s3">@</span><span class="s1">td</span><span class="s3">.</span><span class="s1">skip_if_not_us_locale</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;string,fmt&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span><span class="s4">&quot;20111230&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y%m%d&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;201112300000&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y%m%d%H%M&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;20111230000000&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y%m%d%H%M%S&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;20111230T00&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y%m%dT%H&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;20111230T0000&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y%m%dT%H%M&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;20111230T000000&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y%m%dT%H%M%S&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%d&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-01&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;30-12-2011&quot;</span><span class="s3">, </span><span class="s4">&quot;%d-%m-%Y&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30 00:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00UTC&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%Z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00Z&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00+9&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00+09&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00+090&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00+0900&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00-0900&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00+09:00&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00+09:000&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00+9:0&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00+09:&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000UTC&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%Z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000Z&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000+9&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000+09&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000+090&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000+0900&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000-0900&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000+09:00&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000+09:000&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000+9:0&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%z&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30T00:00:00.000000+09:&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-12-30 00:00:00.000000&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%d %H:%M:%S.%f&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;Tue 24 Aug 2021 01:30:48&quot;</span><span class="s3">, </span><span class="s4">&quot;%a %d %b %Y %H:%M:%S&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;Tuesday 24 Aug 2021 01:30:48&quot;</span><span class="s3">, </span><span class="s4">&quot;%A %d %b %Y %H:%M:%S&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;Tue 24 Aug 2021 01:30:48 AM&quot;</span><span class="s3">, </span><span class="s4">&quot;%a %d %b %Y %I:%M:%S %p&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;Tuesday 24 Aug 2021 01:30:48 AM&quot;</span><span class="s3">, </span><span class="s4">&quot;%A %d %b %Y %I:%M:%S %p&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;27.03.2003 14:55:00.000&quot;</span><span class="s3">, </span><span class="s4">&quot;%d.%m.%Y %H:%M:%S.%f&quot;</span><span class="s3">),  </span><span class="s5"># GH50317</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_guess_datetime_format_with_parseable_formats</span><span class="s3">(</span><span class="s1">string</span><span class="s3">, </span><span class="s1">fmt</span><span class="s3">):</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">maybe_produces_warning</span><span class="s3">(</span>
        <span class="s1">UserWarning</span><span class="s3">, </span><span class="s1">fmt </span><span class="s2">is not None and </span><span class="s1">re</span><span class="s3">.</span><span class="s1">search</span><span class="s3">(</span><span class="s4">r&quot;%d.*%m&quot;</span><span class="s3">, </span><span class="s1">fmt</span><span class="s3">)</span>
    <span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">guess_datetime_format</span><span class="s3">(</span><span class="s1">string</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">fmt</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dayfirst,expected&quot;</span><span class="s3">, [(</span><span class="s2">True</span><span class="s3">, </span><span class="s4">&quot;%d/%m/%Y&quot;</span><span class="s3">), (</span><span class="s2">False</span><span class="s3">, </span><span class="s4">&quot;%m/%d/%Y&quot;</span><span class="s3">)])</span>
<span class="s2">def </span><span class="s1">test_guess_datetime_format_with_dayfirst</span><span class="s3">(</span><span class="s1">dayfirst</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
    <span class="s1">ambiguous_string </span><span class="s3">= </span><span class="s4">&quot;01/01/2011&quot;</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">guess_datetime_format</span><span class="s3">(</span><span class="s1">ambiguous_string</span><span class="s3">, </span><span class="s1">dayfirst</span><span class="s3">=</span><span class="s1">dayfirst</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">expected</span>


<span class="s3">@</span><span class="s1">td</span><span class="s3">.</span><span class="s1">skip_if_not_us_locale</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;string,fmt&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span><span class="s4">&quot;30/Dec/2011&quot;</span><span class="s3">, </span><span class="s4">&quot;%d/%b/%Y&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;30/December/2011&quot;</span><span class="s3">, </span><span class="s4">&quot;%d/%B/%Y&quot;</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;30/Dec/2011 00:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;%d/%b/%Y %H:%M:%S&quot;</span><span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_guess_datetime_format_with_locale_specific_formats</span><span class="s3">(</span><span class="s1">string</span><span class="s3">, </span><span class="s1">fmt</span><span class="s3">):</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">guess_datetime_format</span><span class="s3">(</span><span class="s1">string</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">fmt</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;invalid_dt&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s4">&quot;01/2013&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;12:00:00&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;1/1/1/1&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;this_is_not_a_datetime&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;51a&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;13/2019&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;202001&quot;</span><span class="s3">,  </span><span class="s5"># YYYYMM isn't ISO8601</span>
        <span class="s4">&quot;2020/01&quot;</span><span class="s3">,  </span><span class="s5"># YYYY/MM isn't ISO8601 either</span>
        <span class="s4">&quot;87156549591102612381000001219H5&quot;</span><span class="s3">,</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_guess_datetime_format_invalid_inputs</span><span class="s3">(</span><span class="s1">invalid_dt</span><span class="s3">):</span>
    <span class="s5"># A datetime string must include a year, month and a day for it to be</span>
    <span class="s5"># guessable, in addition to being a string that looks like a datetime.</span>
    <span class="s2">assert </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">guess_datetime_format</span><span class="s3">(</span><span class="s1">invalid_dt</span><span class="s3">) </span><span class="s2">is None</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;invalid_type_dt&quot;</span><span class="s3">, [</span><span class="s6">9</span><span class="s3">, </span><span class="s1">datetime</span><span class="s3">(</span><span class="s6">2011</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">1</span><span class="s3">)])</span>
<span class="s2">def </span><span class="s1">test_guess_datetime_format_wrong_type_inputs</span><span class="s3">(</span><span class="s1">invalid_type_dt</span><span class="s3">):</span>
    <span class="s5"># A datetime string must include a year, month and a day for it to be</span>
    <span class="s5"># guessable, in addition to being a string that looks like a datetime.</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span>
        <span class="s1">TypeError</span><span class="s3">,</span>
        <span class="s1">match</span><span class="s3">=</span><span class="s4">r&quot;^Argument 'dt_str' has incorrect type \(expected str, got .*\)$&quot;</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s1">parsing</span><span class="s3">.</span><span class="s1">guess_datetime_format</span><span class="s3">(</span><span class="s1">invalid_type_dt</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;string,fmt,dayfirst,warning&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span><span class="s4">&quot;2011-1-1&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%d&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-1-1&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%d-%m&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;1/1/2011&quot;</span><span class="s3">, </span><span class="s4">&quot;%m/%d/%Y&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;1/1/2011&quot;</span><span class="s3">, </span><span class="s4">&quot;%d/%m/%Y&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;30-1-2011&quot;</span><span class="s3">, </span><span class="s4">&quot;%d-%m-%Y&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s1">UserWarning</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;30-1-2011&quot;</span><span class="s3">, </span><span class="s4">&quot;%d-%m-%Y&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-1-1 0:0:0&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-1-1 0:0:0&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%d-%m %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-1-3T00:00:0&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-1-3T00:00:0&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%d-%mT%H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-1-1 00:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;2011-1-1 00:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y-%d-%m %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">None</span><span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_guess_datetime_format_no_padding</span><span class="s3">(</span><span class="s1">string</span><span class="s3">, </span><span class="s1">fmt</span><span class="s3">, </span><span class="s1">dayfirst</span><span class="s3">, </span><span class="s1">warning</span><span class="s3">):</span>
    <span class="s5"># see gh-11142</span>
    <span class="s1">msg </span><span class="s3">= (</span>
        <span class="s4">rf&quot;Parsing dates in </span><span class="s2">{</span><span class="s1">fmt</span><span class="s2">} </span><span class="s4">format when dayfirst=False \(the default\) &quot;</span>
        <span class="s4">&quot;was specified. &quot;</span>
        <span class="s4">&quot;Pass `dayfirst=True` or specify a format to silence this warning.&quot;</span>
    <span class="s3">)</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">warning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">guess_datetime_format</span><span class="s3">(</span><span class="s1">string</span><span class="s3">, </span><span class="s1">dayfirst</span><span class="s3">=</span><span class="s1">dayfirst</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">fmt</span>


<span class="s2">def </span><span class="s1">test_try_parse_dates</span><span class="s3">():</span>
    <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s4">&quot;5/1/2000&quot;</span><span class="s3">, </span><span class="s4">&quot;6/1/2000&quot;</span><span class="s3">, </span><span class="s4">&quot;7/1/2000&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">try_parse_dates</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">, </span><span class="s1">parser</span><span class="s3">=</span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">du_parse</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">dayfirst</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>

    <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">du_parse</span><span class="s3">(</span><span class="s1">d</span><span class="s3">, </span><span class="s1">dayfirst</span><span class="s3">=</span><span class="s2">True</span><span class="s3">) </span><span class="s2">for </span><span class="s1">d </span><span class="s2">in </span><span class="s1">arr</span><span class="s3">])</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_parse_datetime_string_with_reso_check_instance_type_raise_exception</span><span class="s3">():</span>
    <span class="s5"># issue 20684</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Argument 'date_string' has incorrect type (expected str, got tuple)&quot;</span>
    <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">re</span><span class="s3">.</span><span class="s1">escape</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">)):</span>
        <span class="s1">parse_datetime_string_with_reso</span><span class="s3">((</span><span class="s6">1</span><span class="s3">, </span><span class="s6">2</span><span class="s3">, </span><span class="s6">3</span><span class="s3">))</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">parse_datetime_string_with_reso</span><span class="s3">(</span><span class="s4">&quot;2019&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= (</span><span class="s1">datetime</span><span class="s3">(</span><span class="s6">2019</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">1</span><span class="s3">), </span><span class="s4">&quot;year&quot;</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">expected</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;fmt,expected&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s3">(</span><span class="s4">&quot;%Y %m %d %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y/%m/%d %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">r&quot;%Y\%m\%d %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y.%m.%d %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y%m%d %H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%z&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S%Z&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%z&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f%Z&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y%m%d&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y%m&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m-%d&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
        <span class="s3">(</span><span class="s4">&quot;%Y-%m&quot;</span><span class="s3">, </span><span class="s2">True</span><span class="s3">),</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_is_iso_format</span><span class="s3">(</span><span class="s1">fmt</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
    <span class="s5"># see gh-41047</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">strptime</span><span class="s3">.</span><span class="s1">_test_format_is_iso</span><span class="s3">(</span><span class="s1">fmt</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">expected</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;input&quot;</span><span class="s3">,</span>
    <span class="s3">[</span>
        <span class="s4">&quot;2018-01-01T00:00:00.123456789&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;2018-01-01T00:00:00.123456&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;2018-01-01T00:00:00.123&quot;</span><span class="s3">,</span>
    <span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_guess_datetime_format_f</span><span class="s3">(</span><span class="s1">input</span><span class="s3">):</span>
    <span class="s5"># https://github.com/pandas-dev/pandas/issues/49043</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">parsing</span><span class="s3">.</span><span class="s1">guess_datetime_format</span><span class="s3">(</span><span class="s1">input</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s4">&quot;%Y-%m-%dT%H:%M:%S.%f&quot;</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">expected</span>


<span class="s2">def </span><span class="s1">_helper_hypothesis_delimited_date</span><span class="s3">(</span><span class="s1">call</span><span class="s3">, </span><span class="s1">date_string</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>
    <span class="s1">msg</span><span class="s3">, </span><span class="s1">result </span><span class="s3">= </span><span class="s2">None</span><span class="s3">, </span><span class="s2">None</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">call</span><span class="s3">(</span><span class="s1">date_string</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>
    <span class="s2">except </span><span class="s1">ValueError </span><span class="s2">as </span><span class="s1">err</span><span class="s3">:</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s1">str</span><span class="s3">(</span><span class="s1">err</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">msg</span><span class="s3">, </span><span class="s1">result</span>


<span class="s3">@</span><span class="s1">given</span><span class="s3">(</span><span class="s1">DATETIME_NO_TZ</span><span class="s3">)</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;delimiter&quot;</span><span class="s3">, </span><span class="s1">list</span><span class="s3">(</span><span class="s4">&quot; -./&quot;</span><span class="s3">))</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dayfirst&quot;</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
    <span class="s4">&quot;date_format&quot;</span><span class="s3">,</span>
    <span class="s3">[</span><span class="s4">&quot;%d %m %Y&quot;</span><span class="s3">, </span><span class="s4">&quot;%m %d %Y&quot;</span><span class="s3">, </span><span class="s4">&quot;%m %Y&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y %m %d&quot;</span><span class="s3">, </span><span class="s4">&quot;%y %m %d&quot;</span><span class="s3">, </span><span class="s4">&quot;%Y%m%d&quot;</span><span class="s3">, </span><span class="s4">&quot;%y%m%d&quot;</span><span class="s3">],</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_hypothesis_delimited_date</span><span class="s3">(</span>
    <span class="s1">request</span><span class="s3">, </span><span class="s1">date_format</span><span class="s3">, </span><span class="s1">dayfirst</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">, </span><span class="s1">test_datetime</span>
<span class="s3">):</span>
    <span class="s2">if </span><span class="s1">date_format </span><span class="s3">== </span><span class="s4">&quot;%m %Y&quot; </span><span class="s2">and </span><span class="s1">delimiter </span><span class="s3">== </span><span class="s4">&quot;.&quot;</span><span class="s3">:</span>
        <span class="s1">request</span><span class="s3">.</span><span class="s1">applymarker</span><span class="s3">(</span>
            <span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">xfail</span><span class="s3">(</span>
                <span class="s1">reason</span><span class="s3">=</span><span class="s4">&quot;parse_datetime_string cannot reliably tell whether &quot;</span>
                <span class="s4">&quot;e.g. %m.%Y is a float or a date&quot;</span>
            <span class="s3">)</span>
        <span class="s3">)</span>
    <span class="s1">date_string </span><span class="s3">= </span><span class="s1">test_datetime</span><span class="s3">.</span><span class="s1">strftime</span><span class="s3">(</span><span class="s1">date_format</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s4">&quot; &quot;</span><span class="s3">, </span><span class="s1">delimiter</span><span class="s3">))</span>

    <span class="s1">except_out_dateutil</span><span class="s3">, </span><span class="s1">result </span><span class="s3">= </span><span class="s1">_helper_hypothesis_delimited_date</span><span class="s3">(</span>
        <span class="s1">parsing</span><span class="s3">.</span><span class="s1">py_parse_datetime_string</span><span class="s3">, </span><span class="s1">date_string</span><span class="s3">, </span><span class="s1">dayfirst</span><span class="s3">=</span><span class="s1">dayfirst</span>
    <span class="s3">)</span>
    <span class="s1">except_in_dateutil</span><span class="s3">, </span><span class="s1">expected </span><span class="s3">= </span><span class="s1">_helper_hypothesis_delimited_date</span><span class="s3">(</span>
        <span class="s1">du_parse</span><span class="s3">,</span>
        <span class="s1">date_string</span><span class="s3">,</span>
        <span class="s1">default</span><span class="s3">=</span><span class="s1">datetime</span><span class="s3">(</span><span class="s6">1</span><span class="s3">, </span><span class="s6">1</span><span class="s3">, </span><span class="s6">1</span><span class="s3">),</span>
        <span class="s1">dayfirst</span><span class="s3">=</span><span class="s1">dayfirst</span><span class="s3">,</span>
        <span class="s1">yearfirst</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
    <span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">except_out_dateutil </span><span class="s3">== </span><span class="s1">except_in_dateutil</span>
    <span class="s2">assert </span><span class="s1">result </span><span class="s3">== </span><span class="s1">expected</span>
</pre>
</body>
</html>