<html>
<head>
<title>test_datetime64.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_datetime64.py</font>
</center></td></tr></table>
<pre><span class="s0"># Arithmetic tests for DataFrame/Series/Index/Array classes that should</span>
<span class="s0"># behave identically.</span>
<span class="s0"># Specifically for datetime64 and datetime64tz dtypes</span>
<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">datetime</span><span class="s3">,</span>
    <span class="s1">time</span><span class="s3">,</span>
    <span class="s1">timedelta</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">itertools </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">product</span><span class="s3">,</span>
    <span class="s1">starmap</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">operator</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">import </span><span class="s1">pytz</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs</span><span class="s3">.</span><span class="s1">conversion </span><span class="s2">import </span><span class="s1">localize_pydatetime</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs</span><span class="s3">.</span><span class="s1">offsets </span><span class="s2">import </span><span class="s1">shift_months</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s1">PerformanceWarning</span>

<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">DateOffset</span><span class="s3">,</span>
    <span class="s1">DatetimeIndex</span><span class="s3">,</span>
    <span class="s1">NaT</span><span class="s3">,</span>
    <span class="s1">Period</span><span class="s3">,</span>
    <span class="s1">Series</span><span class="s3">,</span>
    <span class="s1">Timedelta</span><span class="s3">,</span>
    <span class="s1">TimedeltaIndex</span><span class="s3">,</span>
    <span class="s1">Timestamp</span><span class="s3">,</span>
    <span class="s1">date_range</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_testing </span><span class="s2">as </span><span class="s1">tm</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core </span><span class="s2">import </span><span class="s1">roperator</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">tests</span><span class="s3">.</span><span class="s1">arithmetic</span><span class="s3">.</span><span class="s1">common </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">assert_cannot_add</span><span class="s3">,</span>
    <span class="s1">assert_invalid_addsub_type</span><span class="s3">,</span>
    <span class="s1">assert_invalid_comparison</span><span class="s3">,</span>
    <span class="s1">get_upcast_box</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s0"># ------------------------------------------------------------------</span>
<span class="s0"># Comparisons</span>


<span class="s2">class </span><span class="s1">TestDatetime64ArrayLikeComparisons</span><span class="s3">:</span>
    <span class="s0"># Comparison tests for datetime64 vectors fully parametrized over</span>
    <span class="s0">#  DataFrame/Series/DatetimeIndex/DatetimeArray.  Ideally all comparison</span>
    <span class="s0">#  tests will eventually end up here.</span>

    <span class="s2">def </span><span class="s1">test_compare_zerodim</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># Test comparison with zero-dimensional array is unboxed</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">box </span><span class="s3">= </span><span class="s1">box_with_array</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

        <span class="s1">other </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">.</span><span class="s1">to_numpy</span><span class="s3">()[</span><span class="s5">0</span><span class="s3">])</span>

        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box</span><span class="s3">)</span>
        <span class="s1">xbox </span><span class="s3">= </span><span class="s1">get_upcast_box</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dtarr </span><span class="s3">&lt;= </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;other&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s4">&quot;foo&quot;</span><span class="s3">,</span>
            <span class="s3">-</span><span class="s5">1</span><span class="s3">,</span>
            <span class="s5">99</span><span class="s3">,</span>
            <span class="s5">4.0</span><span class="s3">,</span>
            <span class="s1">object</span><span class="s3">(),</span>
            <span class="s1">timedelta</span><span class="s3">(</span><span class="s1">days</span><span class="s3">=</span><span class="s5">2</span><span class="s3">),</span>
            <span class="s0"># GH#19800, GH#19301 datetime.date comparison raises to</span>
            <span class="s0">#  match DatetimeIndex/Timestamp.  This also matches the behavior</span>
            <span class="s0">#  of stdlib datetime.datetime</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s5">2001</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">).</span><span class="s1">date</span><span class="s3">(),</span>
            <span class="s0"># GH#19301 None and NaN are *not* cast to NaT for comparisons</span>
            <span class="s2">None</span><span class="s3">,</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">,</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_cmp_scalar_invalid</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#22074, GH#15966</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">assert_invalid_comparison</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;other&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s0"># GH#4968 invalid date/int comparisons</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s1">range</span><span class="s3">(</span><span class="s5">10</span><span class="s3">)),</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s5">10</span><span class="s3">),</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s5">10</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">float32</span><span class="s3">),</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s5">10</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">),</span>
            <span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;1ns&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">).</span><span class="s1">array</span><span class="s3">,</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;1ns&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)),</span>
            <span class="s1">list</span><span class="s3">(</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;1ns&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)),</span>
            <span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;1 Day&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">),</span>
            <span class="s1">pd</span><span class="s3">.</span><span class="s1">period_range</span><span class="s3">(</span><span class="s4">&quot;1971-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">).</span><span class="s1">array</span><span class="s3">,</span>
            <span class="s1">pd</span><span class="s3">.</span><span class="s1">period_range</span><span class="s3">(</span><span class="s4">&quot;1971-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_cmp_arraylike_invalid</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span>
    <span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">dta </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1970-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;ns&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">).</span><span class="s1">_data</span>
        <span class="s1">obj </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dta</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">assert_invalid_comparison</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_cmp_mixed_invalid</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">dta </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1970-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;h&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">).</span><span class="s1">_data</span>

        <span class="s1">other </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s1">dta</span><span class="s3">[</span><span class="s5">3</span><span class="s3">], </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s1">days</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)])</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dta </span><span class="s3">== </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dta </span><span class="s3">!= </span><span class="s1">other</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, ~</span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Invalid comparison between|Cannot compare type|not supported between&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dta </span><span class="s3">&lt; </span><span class="s1">other</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dta </span><span class="s3">&gt; </span><span class="s1">other</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dta </span><span class="s3">&lt;= </span><span class="s1">other</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dta </span><span class="s3">&gt;= </span><span class="s1">other</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_nat_comparison</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#22242, GH#22163 DataFrame considered NaT == ts incorrectly</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">box </span><span class="s3">= </span><span class="s1">box_with_array</span>

        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2021-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">ts</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">])</span>

        <span class="s1">obj </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">box</span><span class="s3">)</span>
        <span class="s1">xbox </span><span class="s3">= </span><span class="s1">get_upcast_box</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">bool_</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">obj </span><span class="s3">== </span><span class="s1">ts</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestDatetime64SeriesComparison</span><span class="s3">:</span>
    <span class="s0"># TODO: moved from tests.series.test_operators; needs cleanup</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;pair&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span>
                <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2011-01-03&quot;</span><span class="s3">)],</span>
                <span class="s3">[</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2011-01-03&quot;</span><span class="s3">)],</span>
            <span class="s3">),</span>
            <span class="s3">(</span>
                <span class="s3">[</span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;1 days&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;3 days&quot;</span><span class="s3">)],</span>
                <span class="s3">[</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;3 days&quot;</span><span class="s3">)],</span>
            <span class="s3">),</span>
            <span class="s3">(</span>
                <span class="s3">[</span><span class="s1">Period</span><span class="s3">(</span><span class="s4">&quot;2011-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;M&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Period</span><span class="s3">(</span><span class="s4">&quot;2011-03&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;M&quot;</span><span class="s3">)],</span>
                <span class="s3">[</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Period</span><span class="s3">(</span><span class="s4">&quot;2011-03&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;M&quot;</span><span class="s3">)],</span>
            <span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;reverse&quot;</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dtype&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s1">object</span><span class="s3">])</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;op, expected&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">eq</span><span class="s3">, </span><span class="s1">Series</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])),</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span><span class="s3">, </span><span class="s1">Series</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])),</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">lt</span><span class="s3">, </span><span class="s1">Series</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])),</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">gt</span><span class="s3">, </span><span class="s1">Series</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])),</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ge</span><span class="s3">, </span><span class="s1">Series</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])),</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">le</span><span class="s3">, </span><span class="s1">Series</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_nat_comparisons</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">dtype</span><span class="s3">,</span>
        <span class="s1">index_or_series</span><span class="s3">,</span>
        <span class="s1">reverse</span><span class="s3">,</span>
        <span class="s1">pair</span><span class="s3">,</span>
        <span class="s1">op</span><span class="s3">,</span>
        <span class="s1">expected</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s1">box </span><span class="s3">= </span><span class="s1">index_or_series</span>
        <span class="s1">lhs</span><span class="s3">, </span><span class="s1">rhs </span><span class="s3">= </span><span class="s1">pair</span>
        <span class="s2">if </span><span class="s1">reverse</span><span class="s3">:</span>
            <span class="s0"># add lhs / rhs switched data</span>
            <span class="s1">lhs</span><span class="s3">, </span><span class="s1">rhs </span><span class="s3">= </span><span class="s1">rhs</span><span class="s3">, </span><span class="s1">lhs</span>

        <span class="s1">left </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">lhs</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">right </span><span class="s3">= </span><span class="s1">box</span><span class="s3">(</span><span class="s1">rhs</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">left</span><span class="s3">, </span><span class="s1">right</span><span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;data&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2011-01-03&quot;</span><span class="s3">)],</span>
            <span class="s3">[</span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;1 days&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;3 days&quot;</span><span class="s3">)],</span>
            <span class="s3">[</span><span class="s1">Period</span><span class="s3">(</span><span class="s4">&quot;2011-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;M&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Period</span><span class="s3">(</span><span class="s4">&quot;2011-03&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;M&quot;</span><span class="s3">)],</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dtype&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s1">object</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_nat_comparisons_scalar</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">data</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">box </span><span class="s3">= </span><span class="s1">box_with_array</span>

        <span class="s1">left </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">data</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>
        <span class="s1">left </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">left</span><span class="s3">, </span><span class="s1">box</span><span class="s3">)</span>
        <span class="s1">xbox </span><span class="s3">= </span><span class="s1">get_upcast_box</span><span class="s3">(</span><span class="s1">left</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= [</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">]</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">box </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array </span><span class="s2">and </span><span class="s1">dtype </span><span class="s2">is </span><span class="s1">object</span><span class="s3">:</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;bool&quot;</span><span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">left </span><span class="s3">== </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">== </span><span class="s1">left</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">]</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">box </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array </span><span class="s2">and </span><span class="s1">dtype </span><span class="s2">is </span><span class="s1">object</span><span class="s3">:</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;bool&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">left </span><span class="s3">!= </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">!= </span><span class="s1">left</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= [</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">]</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">box </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array </span><span class="s2">and </span><span class="s1">dtype </span><span class="s2">is </span><span class="s1">object</span><span class="s3">:</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;bool&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">left </span><span class="s3">&lt; </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">&gt; </span><span class="s1">left</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">left </span><span class="s3">&lt;= </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">&gt;= </span><span class="s1">left</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">left </span><span class="s3">&gt; </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">&lt; </span><span class="s1">left</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">left </span><span class="s3">&gt;= </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">&lt;= </span><span class="s1">left</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;val&quot;</span><span class="s3">, [</span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">2000</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">4</span><span class="s3">), </span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">2000</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">5</span><span class="s3">)])</span>
    <span class="s2">def </span><span class="s1">test_series_comparison_scalars</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">val</span><span class="s3">):</span>
        <span class="s1">series </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">))</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">series </span><span class="s3">&gt; </span><span class="s1">val</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">x </span><span class="s3">&gt; </span><span class="s1">val </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">series</span><span class="s3">])</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;left,right&quot;</span><span class="s3">, [(</span><span class="s4">&quot;lt&quot;</span><span class="s3">, </span><span class="s4">&quot;gt&quot;</span><span class="s3">), (</span><span class="s4">&quot;le&quot;</span><span class="s3">, </span><span class="s4">&quot;ge&quot;</span><span class="s3">), (</span><span class="s4">&quot;eq&quot;</span><span class="s3">, </span><span class="s4">&quot;eq&quot;</span><span class="s3">), (</span><span class="s4">&quot;ne&quot;</span><span class="s3">, </span><span class="s4">&quot;ne&quot;</span><span class="s3">)]</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_timestamp_compare_series</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">left</span><span class="s3">, </span><span class="s1">right</span><span class="s3">):</span>
        <span class="s0"># see gh-4982</span>
        <span class="s0"># Make sure we can compare Timestamps on the right AND left hand side.</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20010101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">), </span><span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;dates&quot;</span><span class="s3">)</span>
        <span class="s1">s_nat </span><span class="s3">= </span><span class="s1">ser</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">(</span><span class="s1">deep</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>

        <span class="s1">ser</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] = </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">)</span>
        <span class="s1">ser</span><span class="s3">[</span><span class="s5">3</span><span class="s3">] = </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">)</span>

        <span class="s1">left_f </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">operator</span><span class="s3">, </span><span class="s1">left</span><span class="s3">)</span>
        <span class="s1">right_f </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">operator</span><span class="s3">, </span><span class="s1">right</span><span class="s3">)</span>

        <span class="s0"># No NaT</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">left_f</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20010109&quot;</span><span class="s3">))</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">right_f</span><span class="s3">(</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20010109&quot;</span><span class="s3">), </span><span class="s1">ser</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># NaT</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">left_f</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">))</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">right_f</span><span class="s3">(</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">), </span><span class="s1">ser</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># Compare to Timestamp with series containing NaT</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">left_f</span><span class="s3">(</span><span class="s1">s_nat</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20010109&quot;</span><span class="s3">))</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">right_f</span><span class="s3">(</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20010109&quot;</span><span class="s3">), </span><span class="s1">s_nat</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># Compare to NaT with series containing NaT</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">left_f</span><span class="s3">(</span><span class="s1">s_nat</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">right_f</span><span class="s3">(</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">s_nat</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_timestamp_equality</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#11034</span>
        <span class="s1">box </span><span class="s3">= </span><span class="s1">box_with_array</span>

        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-29 01:59:00&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-30&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">])</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">box</span><span class="s3">)</span>
        <span class="s1">xbox </span><span class="s3">= </span><span class="s1">get_upcast_box</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">ser</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">!= </span><span class="s1">ser</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">], </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">box </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">DataFrame</span><span class="s3">:</span>
            <span class="s0"># alignment for frame vs series comparisons deprecated</span>
            <span class="s0">#  in GH#46795 enforced 2.0</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;not aligned&quot;</span><span class="s3">):</span>
                <span class="s1">ser </span><span class="s3">!= </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>

        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">!= </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">], </span><span class="s1">xbox</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">box </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">DataFrame</span><span class="s3">:</span>
            <span class="s0"># alignment for frame vs series comparisons deprecated</span>
            <span class="s0">#  in GH#46795 enforced 2.0</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;not aligned&quot;</span><span class="s3">):</span>
                <span class="s1">ser </span><span class="s3">!= </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">!= </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">], </span><span class="s1">xbox</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">== </span><span class="s1">ser</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">], </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">box </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">DataFrame</span><span class="s3">:</span>
            <span class="s0"># alignment for frame vs series comparisons deprecated</span>
            <span class="s0">#  in GH#46795 enforced 2.0</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;not aligned&quot;</span><span class="s3">):</span>
                <span class="s1">ser </span><span class="s3">== </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">== </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">], </span><span class="s1">xbox</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">box </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">DataFrame</span><span class="s3">:</span>
            <span class="s0"># alignment for frame vs series comparisons deprecated</span>
            <span class="s0">#  in GH#46795 enforced 2.0</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;not aligned&quot;</span><span class="s3">):</span>
                <span class="s1">ser </span><span class="s3">== </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">== </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">], </span><span class="s1">xbox</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;datetimelike&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s5">2013</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">),</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2013-01-01T00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;ns&quot;</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;op,expected&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">lt</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">]),</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">le</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">]),</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">eq</span><span class="s3">, [</span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">]),</span>
            <span class="s3">(</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">gt</span><span class="s3">, [</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">]),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dt64_compare_datetime_scalar</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">datetimelike</span><span class="s3">, </span><span class="s1">op</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
        <span class="s0"># GH#17965, test for ability to compare datetime64[ns] columns</span>
        <span class="s0">#  to datetimelike</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120101&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">),</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">,</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130103&quot;</span><span class="s3">),</span>
            <span class="s3">],</span>
            <span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;A&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">datetimelike</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;A&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestDatetimeIndexComparisons</span><span class="s3">:</span>
    <span class="s0"># TODO: moved from tests.indexes.test_base; parametrize and de-duplicate</span>
    <span class="s2">def </span><span class="s1">test_comparators</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">comparison_op</span><span class="s3">):</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2020-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">element </span><span class="s3">= </span><span class="s1">index</span><span class="s3">[</span><span class="s1">len</span><span class="s3">(</span><span class="s1">index</span><span class="s3">) // </span><span class="s5">2</span><span class="s3">]</span>
        <span class="s1">element </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">element</span><span class="s3">).</span><span class="s1">to_datetime64</span><span class="s3">()</span>

        <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">index</span><span class="s3">)</span>
        <span class="s1">arr_result </span><span class="s3">= </span><span class="s1">comparison_op</span><span class="s3">(</span><span class="s1">arr</span><span class="s3">, </span><span class="s1">element</span><span class="s3">)</span>
        <span class="s1">index_result </span><span class="s3">= </span><span class="s1">comparison_op</span><span class="s3">(</span><span class="s1">index</span><span class="s3">, </span><span class="s1">element</span><span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">index_result</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ndarray</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">arr_result</span><span class="s3">, </span><span class="s1">index_result</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;other&quot;</span><span class="s3">,</span>
        <span class="s3">[</span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">2016</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">)],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dti_cmp_datetimelike</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">tz </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">other</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">):</span>
                <span class="s1">pytest</span><span class="s3">.</span><span class="s1">skip</span><span class="s3">(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">type</span><span class="s3">(</span><span class="s1">other</span><span class="s3">).</span><span class="s1">__name__</span><span class="s2">} </span><span class="s4">is not tz aware&quot;</span><span class="s3">)</span>
            <span class="s1">other </span><span class="s3">= </span><span class="s1">localize_pydatetime</span><span class="s3">(</span><span class="s1">other</span><span class="s3">, </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">tzinfo</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">== </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">&gt; </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">&gt;= </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">&lt; </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">&lt;= </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dtype&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s1">object</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dti_cmp_nat</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">left </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2011-01-03&quot;</span><span class="s3">)])</span>
        <span class="s1">right </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2011-01-03&quot;</span><span class="s3">)])</span>

        <span class="s1">left </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">left</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">right </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">right</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">xbox </span><span class="s3">= </span><span class="s1">get_upcast_box</span><span class="s3">(</span><span class="s1">left</span><span class="s3">, </span><span class="s1">right</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span>

        <span class="s1">lhs</span><span class="s3">, </span><span class="s1">rhs </span><span class="s3">= </span><span class="s1">left</span><span class="s3">, </span><span class="s1">right</span>
        <span class="s2">if </span><span class="s1">dtype </span><span class="s2">is </span><span class="s1">object</span><span class="s3">:</span>
            <span class="s1">lhs</span><span class="s3">, </span><span class="s1">rhs </span><span class="s3">= </span><span class="s1">left</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">), </span><span class="s1">right</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rhs </span><span class="s3">== </span><span class="s1">lhs</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">lhs </span><span class="s3">!= </span><span class="s1">rhs</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">lhs </span><span class="s3">== </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">== </span><span class="s1">rhs</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">lhs </span><span class="s3">!= </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">!= </span><span class="s1">lhs</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">lhs </span><span class="s3">&lt; </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">NaT </span><span class="s3">&gt; </span><span class="s1">lhs</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dti_cmp_nat_behaves_like_float_cmp_nan</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">fidx1 </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Index</span><span class="s3">([</span><span class="s5">1.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s5">3.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s5">5.0</span><span class="s3">, </span><span class="s5">7.0</span><span class="s3">])</span>
        <span class="s1">fidx2 </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Index</span><span class="s3">([</span><span class="s5">2.0</span><span class="s3">, </span><span class="s5">3.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s5">6.0</span><span class="s3">, </span><span class="s5">7.0</span><span class="s3">])</span>

        <span class="s1">didx1 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;2014-01-01&quot;</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s4">&quot;2014-03-01&quot;</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s4">&quot;2014-05-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2014-07-01&quot;</span><span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">didx2 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;2014-02-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2014-03-01&quot;</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s4">&quot;2014-06-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2014-07-01&quot;</span><span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">darr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2014-02-01 00:00&quot;</span><span class="s3">),</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2014-03-01 00:00&quot;</span><span class="s3">),</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">),</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">),</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2014-06-01 00:00&quot;</span><span class="s3">),</span>
                <span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2014-07-01 00:00&quot;</span><span class="s3">),</span>
            <span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s1">cases </span><span class="s3">= [(</span><span class="s1">fidx1</span><span class="s3">, </span><span class="s1">fidx2</span><span class="s3">), (</span><span class="s1">didx1</span><span class="s3">, </span><span class="s1">didx2</span><span class="s3">), (</span><span class="s1">didx1</span><span class="s3">, </span><span class="s1">darr</span><span class="s3">)]</span>

        <span class="s0"># Check pd.NaT is handles as the same as np.nan</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s2">None</span><span class="s3">):</span>
            <span class="s2">for </span><span class="s1">idx1</span><span class="s3">, </span><span class="s1">idx2 </span><span class="s2">in </span><span class="s1">cases</span><span class="s3">:</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&lt; </span><span class="s1">idx2</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx2 </span><span class="s3">&gt; </span><span class="s1">idx1</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&lt;= </span><span class="s1">idx2</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx2 </span><span class="s3">&gt;= </span><span class="s1">idx1</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">== </span><span class="s1">idx2</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">!= </span><span class="s1">idx2</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s2">None</span><span class="s3">):</span>
            <span class="s2">for </span><span class="s1">idx1</span><span class="s3">, </span><span class="s1">val </span><span class="s2">in </span><span class="s3">[(</span><span class="s1">fidx1</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">), (</span><span class="s1">didx1</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">)]:</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&lt; </span><span class="s1">val</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&gt; </span><span class="s1">val</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&lt;= </span><span class="s1">val</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&gt;= </span><span class="s1">val</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">== </span><span class="s1">val</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">!= </span><span class="s1">val</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># Check pd.NaT is handles as the same as np.nan</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s2">None</span><span class="s3">):</span>
            <span class="s2">for </span><span class="s1">idx1</span><span class="s3">, </span><span class="s1">val </span><span class="s2">in </span><span class="s3">[(</span><span class="s1">fidx1</span><span class="s3">, </span><span class="s5">3</span><span class="s3">), (</span><span class="s1">didx1</span><span class="s3">, </span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">2014</span><span class="s3">, </span><span class="s5">3</span><span class="s3">, </span><span class="s5">1</span><span class="s3">))]:</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&lt; </span><span class="s1">val</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&gt; </span><span class="s1">val</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&lt;= </span><span class="s1">val</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">&gt;= </span><span class="s1">val</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">== </span><span class="s1">val</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

                <span class="s1">result </span><span class="s3">= </span><span class="s1">idx1 </span><span class="s3">!= </span><span class="s1">val</span>
                <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>
                <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_comparison_tzawareness_compat</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">comparison_op</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#18162</span>
        <span class="s1">op </span><span class="s3">= </span><span class="s1">comparison_op</span>
        <span class="s1">box </span><span class="s3">= </span><span class="s1">box_with_array</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">6</span><span class="s3">)</span>
        <span class="s1">dz </span><span class="s3">= </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s3">)</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">, </span><span class="s1">box</span><span class="s3">)</span>
        <span class="s1">dz </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">, </span><span class="s1">box</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">box </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">DataFrame</span><span class="s3">:</span>
            <span class="s1">tolist </span><span class="s3">= </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">x</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">).</span><span class="s1">values</span><span class="s3">.</span><span class="s1">tolist</span><span class="s3">()[</span><span class="s5">0</span><span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">tolist </span><span class="s3">= </span><span class="s1">list</span>

        <span class="s2">if </span><span class="s1">op </span><span class="s2">not in </span><span class="s3">[</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">eq</span><span class="s3">, </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span><span class="s3">]:</span>
            <span class="s1">msg </span><span class="s3">= (</span>
                <span class="s4">r&quot;Invalid comparison between dtype=datetime64\[ns.*\] &quot;</span>
                <span class="s4">&quot;and (Timestamp|DatetimeArray|list|ndarray)&quot;</span>
            <span class="s3">)</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">, </span><span class="s1">dz</span><span class="s3">)</span>

            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">, </span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">))</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">))</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">, </span><span class="s1">dr</span><span class="s3">)</span>

            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">, </span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">))</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">))</span>

        <span class="s0"># The aware==aware and naive==naive comparisons should *not* raise</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dr </span><span class="s3">== </span><span class="s1">dr</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dr </span><span class="s3">== </span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">))</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">) == </span><span class="s1">dr</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">) == </span><span class="s1">dr</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dr </span><span class="s3">== </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">))</span>

        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dz </span><span class="s3">== </span><span class="s1">dz</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dz </span><span class="s3">== </span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">))</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">) == </span><span class="s1">dz</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">) == </span><span class="s1">dz</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dz </span><span class="s3">== </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">tolist</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">), </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_comparison_tzawareness_compat_scalars</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">comparison_op</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#18162</span>
        <span class="s1">op </span><span class="s3">= </span><span class="s1">comparison_op</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">6</span><span class="s3">)</span>
        <span class="s1">dz </span><span class="s3">= </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s3">)</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">dz </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s0"># Check comparisons against scalar Timestamps</span>
        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-03-14 01:59&quot;</span><span class="s3">)</span>
        <span class="s1">ts_tz </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-03-14 01:59&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;Europe/Amsterdam&quot;</span><span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dr </span><span class="s3">&gt; </span><span class="s1">ts</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">r&quot;Invalid comparison between dtype=datetime64\[ns.*\] and Timestamp&quot;</span>
        <span class="s2">if </span><span class="s1">op </span><span class="s2">not in </span><span class="s3">[</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">eq</span><span class="s3">, </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span><span class="s3">]:</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">, </span><span class="s1">ts_tz</span><span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dz </span><span class="s3">&gt; </span><span class="s1">ts_tz</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">op </span><span class="s2">not in </span><span class="s3">[</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">eq</span><span class="s3">, </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span><span class="s3">]:</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dz</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">)</span>

        <span class="s2">if </span><span class="s1">op </span><span class="s2">not in </span><span class="s3">[</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">eq</span><span class="s3">, </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span><span class="s3">]:</span>
            <span class="s0"># GH#12601: Check comparison against Timestamps and DatetimeIndex</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">ts</span><span class="s3">, </span><span class="s1">dz</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;other&quot;</span><span class="s3">,</span>
        <span class="s3">[</span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">2016</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">)],</span>
    <span class="s3">)</span>
    <span class="s0"># Bug in NumPy? https://github.com/numpy/numpy/issues/13841</span>
    <span class="s0"># Raising in __eq__ will fallback to NumPy, which warns, fails,</span>
    <span class="s0"># then re-raises the original exception. So we just need to ignore.</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s4">&quot;ignore:elementwise comp:DeprecationWarning&quot;</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_scalar_comparison_tzawareness</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">comparison_op</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">tz_aware_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span>
    <span class="s3">):</span>
        <span class="s1">op </span><span class="s3">= </span><span class="s1">comparison_op</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">xbox </span><span class="s3">= </span><span class="s1">get_upcast_box</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">op </span><span class="s2">in </span><span class="s3">[</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">eq</span><span class="s3">, </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span><span class="s3">]:</span>
            <span class="s1">exbool </span><span class="s3">= </span><span class="s1">op </span><span class="s2">is </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">exbool</span><span class="s3">, </span><span class="s1">exbool</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">bool</span><span class="s3">)</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">)</span>

            <span class="s1">result </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

            <span class="s1">result </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">other</span><span class="s3">, </span><span class="s1">dtarr</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">msg </span><span class="s3">= (</span>
                <span class="s4">r&quot;Invalid comparison between dtype=datetime64\[ns, .*\] &quot;</span>
                <span class="s4">f&quot;and </span><span class="s2">{</span><span class="s1">type</span><span class="s3">(</span><span class="s1">other</span><span class="s3">).</span><span class="s1">__name__</span><span class="s2">}</span><span class="s4">&quot;</span>
            <span class="s3">)</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">)</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">other</span><span class="s3">, </span><span class="s1">dtarr</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_nat_comparison_tzawareness</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">comparison_op</span><span class="s3">):</span>
        <span class="s0"># GH#19276</span>
        <span class="s0"># tzaware DatetimeIndex should not raise when compared to NaT</span>
        <span class="s1">op </span><span class="s3">= </span><span class="s1">comparison_op</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;2014-01-01&quot;</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s4">&quot;2014-03-01&quot;</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">, </span><span class="s4">&quot;2014-05-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2014-07-01&quot;</span><span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">op </span><span class="s3">== </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">ne</span><span class="s3">] * </span><span class="s1">len</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">))</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dti_cmp_str</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s0"># GH#22074</span>
        <span class="s0"># regardless of tz, we expect these comparisons are valid</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">other </span><span class="s3">= </span><span class="s4">&quot;1/1/2000&quot;</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">== </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">] + [</span><span class="s2">False</span><span class="s3">] * </span><span class="s5">9</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">!= </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">] + [</span><span class="s2">True</span><span class="s3">] * </span><span class="s5">9</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">&lt; </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">&lt;= </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">] + [</span><span class="s2">False</span><span class="s3">] * </span><span class="s5">9</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">&gt; </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">] + [</span><span class="s2">True</span><span class="s3">] * </span><span class="s5">9</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">&gt;= </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dti_cmp_list</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">== </span><span class="s1">list</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">== </span><span class="s1">rng</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;other&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;1D&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">),</span>
            <span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;1D&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">).</span><span class="s1">to_series</span><span class="s3">(),</span>
            <span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;1D&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">).</span><span class="s1">asi8</span><span class="s3">.</span><span class="s1">view</span><span class="s3">(</span><span class="s4">&quot;m8[ns]&quot;</span><span class="s3">),</span>
        <span class="s3">],</span>
        <span class="s1">ids</span><span class="s3">=</span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">type</span><span class="s3">(</span><span class="s1">x</span><span class="s3">).</span><span class="s1">__name__</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dti_cmp_tdi_tzawareness</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">other</span><span class="s3">):</span>
        <span class="s0"># GH#22074</span>
        <span class="s0"># reversion test that we _don't_ call _assert_tzawareness_compat</span>
        <span class="s0"># when comparing against TimedeltaIndex</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2000-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;Asia/Tokyo&quot;</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">== </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">False</span><span class="s3">] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">!= </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Invalid comparison between&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dti </span><span class="s3">&lt; </span><span class="s1">other</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dti </span><span class="s3">&lt;= </span><span class="s1">other</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dti </span><span class="s3">&gt; </span><span class="s1">other</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dti </span><span class="s3">&gt;= </span><span class="s1">other</span>

    <span class="s2">def </span><span class="s1">test_dti_cmp_object_dtype</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># GH#22074</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2000-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;Asia/Tokyo&quot;</span><span class="s3">)</span>

        <span class="s1">other </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;O&quot;</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">== </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">other </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">!= </span><span class="s1">other</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">other </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">list</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">[:</span><span class="s5">5</span><span class="s3">]) + [</span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s1">days</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)] * </span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">== </span><span class="s1">other</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s2">True</span><span class="s3">] * </span><span class="s5">5 </span><span class="s3">+ [</span><span class="s2">False</span><span class="s3">] * </span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;&gt;=' not supported between instances of 'Timestamp' and 'Timedelta'&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dti </span><span class="s3">&gt;= </span><span class="s1">other</span>


<span class="s0"># ------------------------------------------------------------------</span>
<span class="s0"># Arithmetic</span>


<span class="s2">class </span><span class="s1">TestDatetime64Arithmetic</span><span class="s3">:</span>
    <span class="s0"># This class is intended for &quot;finished&quot; tests that are fully parametrized</span>
    <span class="s0">#  over DataFrame/Series/Index/DatetimeArray</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Addition/Subtraction of timedelta-like</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">arm_slow</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_add_timedeltalike_scalar</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">two_hours</span><span class="s3">, </span><span class="s1">box_with_array</span>
    <span class="s3">):</span>
        <span class="s0"># GH#22005, GH#22163 check DataFrame doesn't raise TypeError</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2000-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2000-02-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2000-01-01 02:00&quot;</span><span class="s3">, </span><span class="s4">&quot;2000-02-01 02:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">+ </span><span class="s1">two_hours</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">two_hours </span><span class="s3">+ </span><span class="s1">rng</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">rng </span><span class="s3">+= </span><span class="s1">two_hours</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_sub_timedeltalike_scalar</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">two_hours</span><span class="s3">, </span><span class="s1">box_with_array</span>
    <span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2000-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2000-02-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1999-12-31 22:00&quot;</span><span class="s3">, </span><span class="s4">&quot;2000-01-31 22:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">- </span><span class="s1">two_hours</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">rng </span><span class="s3">-= </span><span class="s1">two_hours</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64_array_sub_dt_with_different_timezone</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">t1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">).</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">t1 </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">t1</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">t2 </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">).</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;CET&quot;</span><span class="s3">)</span>
        <span class="s1">tnaive </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">20130101</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">t1 </span><span class="s3">- </span><span class="s1">t2</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;0 days 06:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;1 days 06:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;2 days 06:00:00&quot;</span><span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">t2 </span><span class="s3">- </span><span class="s1">t1</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;-1 days +18:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;-2 days +18:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;-3 days +18:00:00&quot;</span><span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Cannot subtract tz-naive and tz-aware datetime-like objects&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">t1 </span><span class="s3">- </span><span class="s1">tnaive</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tnaive </span><span class="s3">- </span><span class="s1">t1</span>

    <span class="s2">def </span><span class="s1">test_dt64_array_sub_dt64_array_with_different_timezone</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">t1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">).</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">t1 </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">t1</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">t2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">).</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;CET&quot;</span><span class="s3">)</span>
        <span class="s1">t2 </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">t2</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tnaive </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">t1 </span><span class="s3">- </span><span class="s1">t2</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;0 days 06:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;0 days 06:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;0 days 06:00:00&quot;</span><span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">t2 </span><span class="s3">- </span><span class="s1">t1</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;-1 days +18:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;-1 days +18:00:00&quot;</span><span class="s3">, </span><span class="s4">&quot;-1 days +18:00:00&quot;</span><span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Cannot subtract tz-naive and tz-aware datetime-like objects&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">t1 </span><span class="s3">- </span><span class="s1">tnaive</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tnaive </span><span class="s3">- </span><span class="s1">t1</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_add_sub_td64_nat</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s0"># GH#23320 special handling for timedelta64(&quot;NaT&quot;)</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1994-04-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">9</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;QS&quot;</span><span class="s3">)</span>
        <span class="s1">other </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s4">&quot;NaT&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s4">&quot;NaT&quot;</span><span class="s3">] * </span><span class="s5">9</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>

        <span class="s1">obj </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">obj </span><span class="s3">+ </span><span class="s1">other</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">other </span><span class="s3">+ </span><span class="s1">obj</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">obj </span><span class="s3">- </span><span class="s1">other</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot subtract&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">other </span><span class="s3">- </span><span class="s1">obj</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_add_sub_td64ndarray</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tdi </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">([</span><span class="s4">&quot;-1 Day&quot;</span><span class="s3">, </span><span class="s4">&quot;-1 Day&quot;</span><span class="s3">, </span><span class="s4">&quot;-1 Day&quot;</span><span class="s3">])</span>
        <span class="s1">tdarr </span><span class="s3">= </span><span class="s1">tdi</span><span class="s3">.</span><span class="s1">values</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2015-12-31&quot;</span><span class="s3">, </span><span class="s4">&quot;2016-01-02&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dtarr </span><span class="s3">+ </span><span class="s1">tdarr</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">tdarr </span><span class="s3">+ </span><span class="s1">dtarr</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-02&quot;</span><span class="s3">, </span><span class="s4">&quot;2016-01-04&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dtarr </span><span class="s3">- </span><span class="s1">tdarr</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot subtract|(bad|unsupported) operand type for unary&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tdarr </span><span class="s3">- </span><span class="s1">dtarr</span>

    <span class="s0"># -----------------------------------------------------------------</span>
    <span class="s0"># Subtraction of datetime-like scalars</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;ts&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2013-01-01&quot;</span><span class="s3">),</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2013-01-01&quot;</span><span class="s3">).</span><span class="s1">to_pydatetime</span><span class="s3">(),</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2013-01-01&quot;</span><span class="s3">).</span><span class="s1">to_datetime64</span><span class="s3">(),</span>
            <span class="s0"># GH#7996, GH#22163 ensure non-nano datetime64 is converted to nano</span>
            <span class="s0">#  for DataFrame operation</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2013-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_sub_dtscalar</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">ts</span><span class="s3">):</span>
        <span class="s0"># GH#8554, GH#22163 DataFrame op should _not_ return dt64 dtype</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2013-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">).</span><span class="s1">_with_freq</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">([</span><span class="s4">&quot;0 Days&quot;</span><span class="s3">, </span><span class="s4">&quot;1 Day&quot;</span><span class="s3">, </span><span class="s4">&quot;2 Days&quot;</span><span class="s3">])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">idx </span><span class="s3">- </span><span class="s1">ts</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">ts </span><span class="s3">- </span><span class="s1">idx</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, -</span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, -</span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_sub_timestamp_tzaware</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2014-03-17&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">ser</span><span class="s3">.</span><span class="s1">_with_freq</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">ts </span><span class="s3">= </span><span class="s1">ser</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>

        <span class="s1">ser </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">delta_series </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">)])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">delta_series</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">ser </span><span class="s3">- </span><span class="s1">ts</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">ts </span><span class="s3">- </span><span class="s1">ser</span><span class="s3">, -</span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_sub_NaT</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s0"># GH#18808</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;19900315&quot;</span><span class="s3">)]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">NaT</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">f&quot;timedelta64[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s4">]&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">dti_tz </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;Asia/Tokyo&quot;</span><span class="s3">)</span>
        <span class="s1">ser_tz </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti_tz</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser_tz </span><span class="s3">- </span><span class="s1">NaT</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">f&quot;timedelta64[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s4">]&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Subtraction of datetime-like array-like</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_sub_dt64object_array</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz_naive_fixture</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">- </span><span class="s1">dti</span>

        <span class="s1">obj </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">obj </span><span class="s3">- </span><span class="s1">obj</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_naive_sub_dt64ndarray</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">dt64vals </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">values</span>

        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">dtarr </span><span class="s3">- </span><span class="s1">dtarr</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dtarr </span><span class="s3">- </span><span class="s1">dt64vals</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt64vals </span><span class="s3">- </span><span class="s1">dtarr</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_aware_sub_dt64ndarray_raises</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">tz_aware_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span>
    <span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">dt64vals </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">values</span>

        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Cannot subtract tz-naive and tz-aware datetime&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dtarr </span><span class="s3">- </span><span class="s1">dt64vals</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dt64vals </span><span class="s3">- </span><span class="s1">dtarr</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Addition of datetime-like others (invalid)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_add_dtlike_raises</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#22163 ensure DataFrame doesn't cast Timestamp to i8</span>
        <span class="s0"># GH#9631</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">tz </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">dti2 </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">dti2 </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">values</span><span class="s3">)</span>
        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">dti</span><span class="s3">)</span>
        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">dtarr</span><span class="s3">)</span>
        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">dti</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">dti</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">to_pydatetime</span><span class="s3">())</span>
        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">dti</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">to_datetime64</span><span class="s3">())</span>
        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">dti2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">dti2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">to_pydatetime</span><span class="s3">())</span>
        <span class="s1">assert_cannot_add</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">))</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Other Invalid Addition/Subtraction</span>

    <span class="s0"># Note: freq here includes both Tick and non-Tick offsets; this is</span>
    <span class="s0">#  relevant because historically integer-addition was allowed if we had</span>
    <span class="s0">#  a freq.</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;freq&quot;</span><span class="s3">, [</span><span class="s4">&quot;h&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s4">&quot;W&quot;</span><span class="s3">, </span><span class="s4">&quot;2ME&quot;</span><span class="s3">, </span><span class="s4">&quot;MS&quot;</span><span class="s3">, </span><span class="s4">&quot;QE&quot;</span><span class="s3">, </span><span class="s4">&quot;B&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">])</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dtype&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s4">&quot;uint8&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_addsub_intlike</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">request</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">, </span><span class="s1">index_or_series_or_array</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span>
    <span class="s3">):</span>
        <span class="s0"># GH#19959, GH#19123, GH#19012</span>
        <span class="s0"># GH#55860 use index_or_series_or_array instead of box_with_array</span>
        <span class="s0">#  bc DataFrame alignment makes it inapplicable</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s2">if </span><span class="s1">freq </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s4">&quot;NaT&quot;</span><span class="s3">, </span><span class="s4">&quot;2017-04-05 06:07:08&quot;</span><span class="s3">], </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

        <span class="s1">obj </span><span class="s3">= </span><span class="s1">index_or_series_or_array</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">)</span>
        <span class="s1">other </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s5">4</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">])</span>
        <span class="s2">if </span><span class="s1">dtype </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">other </span><span class="s3">= </span><span class="s1">other</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">dtype</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;|&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s4">&quot;Addition/subtraction of integers&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;cannot subtract DatetimeArray from&quot;</span><span class="s3">,</span>
                <span class="s0"># IntegerArray</span>
                <span class="s4">&quot;can only perform ops with numeric values&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;unsupported operand type.*Categorical&quot;</span><span class="s3">,</span>
                <span class="s4">r&quot;unsupported operand type\(s\) for -: 'int' and 'Timestamp'&quot;</span><span class="s3">,</span>
            <span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">(</span><span class="s5">2</span><span class="s3">), </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">), </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">other</span><span class="s3">), </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">other</span><span class="s3">), </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Categorical</span><span class="s3">(</span><span class="s1">other</span><span class="s3">), </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Index</span><span class="s3">(</span><span class="s1">other</span><span class="s3">), </span><span class="s1">msg</span><span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">other</span><span class="s3">), </span><span class="s1">msg</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;other&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s5">3.14</span><span class="s3">,</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s5">2.0</span><span class="s3">, </span><span class="s5">3.0</span><span class="s3">]),</span>
            <span class="s0"># GH#13078 datetime +/- Period is invalid</span>
            <span class="s1">Period</span><span class="s3">(</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;D&quot;</span><span class="s3">),</span>
            <span class="s0"># https://github.com/pandas-dev/pandas/issues/10329</span>
            <span class="s1">time</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">3</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dti_freq&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_add_sub_invalid</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">dti_freq</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2011-01-02&quot;</span><span class="s3">], </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">dti_freq</span><span class="s3">)</span>
        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;|&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s4">&quot;unsupported operand type&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;cannot (add|subtract)&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;cannot use operands with types&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;ufunc '?(add|subtract)'? cannot use operands with types&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;Concatenation operation is not implemented for NumPy arrays&quot;</span><span class="s3">,</span>
            <span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;pi_freq&quot;</span><span class="s3">, [</span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s4">&quot;W&quot;</span><span class="s3">, </span><span class="s4">&quot;Q&quot;</span><span class="s3">, </span><span class="s4">&quot;h&quot;</span><span class="s3">])</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;dti_freq&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_add_sub_parr</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">dti_freq</span><span class="s3">, </span><span class="s1">pi_freq</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">box_with_array2</span>
    <span class="s3">):</span>
        <span class="s0"># GH#20049 subtracting PeriodIndex should raise TypeError</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2011-01-02&quot;</span><span class="s3">], </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">dti_freq</span><span class="s3">)</span>
        <span class="s1">pi </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">to_period</span><span class="s3">(</span><span class="s1">pi_freq</span><span class="s3">)</span>

        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">parr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">pi</span><span class="s3">, </span><span class="s1">box_with_array2</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;|&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s4">&quot;cannot (add|subtract)&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;unsupported operand&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;descriptor.*requires&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;ufunc.*cannot use operands&quot;</span><span class="s3">,</span>
            <span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">parr</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s4">&quot;ignore::pandas.errors.PerformanceWarning&quot;</span><span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_addsub_time_objects_raises</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s0"># https://github.com/pandas-dev/pandas/issues/10329</span>

        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">obj1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2012-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">obj2 </span><span class="s3">= [</span><span class="s1">time</span><span class="s3">(</span><span class="s1">i</span><span class="s3">, </span><span class="s1">i</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s5">3</span><span class="s3">)]</span>

        <span class="s1">obj1 </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">obj1</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">obj2 </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">obj2</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;|&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s4">&quot;unsupported operand&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;cannot subtract DatetimeArray from ndarray&quot;</span><span class="s3">,</span>
            <span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s0"># pandas.errors.PerformanceWarning: Non-vectorized DateOffset being</span>
        <span class="s0"># applied to Series or DatetimeIndex</span>
        <span class="s0"># we aren't testing that here, so ignore.</span>
        <span class="s1">assert_invalid_addsub_type</span><span class="s3">(</span><span class="s1">obj1</span><span class="s3">, </span><span class="s1">obj2</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">)</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Other invalid operations</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;dt64_series&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s1">Series</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;19900315&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;19900315&quot;</span><span class="s3">)]),</span>
            <span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;19900315&quot;</span><span class="s3">)]),</span>
            <span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;one&quot;</span><span class="s3">, [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1.0</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s5">1</span><span class="s3">)])</span>
    <span class="s2">def </span><span class="s1">test_dt64_mul_div_numeric_invalid</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">one</span><span class="s3">, </span><span class="s1">dt64_series</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">obj </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dt64_series</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot perform .* with this index type&quot;</span>

        <span class="s0"># multiplication</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">obj </span><span class="s3">* </span><span class="s1">one</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">one </span><span class="s3">* </span><span class="s1">obj</span>

        <span class="s0"># division</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">obj </span><span class="s3">/ </span><span class="s1">one</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">one </span><span class="s3">/ </span><span class="s1">obj</span>


<span class="s2">class </span><span class="s1">TestDatetime64DateOffsetArithmetic</span><span class="s3">:</span>
    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Tick DateOffsets</span>

    <span class="s0"># TODO: parametrize over timezone?</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;unit&quot;</span><span class="s3">, [</span><span class="s4">&quot;s&quot;</span><span class="s3">, </span><span class="s4">&quot;ms&quot;</span><span class="s3">, </span><span class="s4">&quot;us&quot;</span><span class="s3">, </span><span class="s4">&quot;ns&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_series_add_tick_DateOffset</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s0"># GH#4532</span>
        <span class="s0"># operate with pd.offsets</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:01&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:02&quot;</span><span class="s3">)]</span>
        <span class="s3">).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:01:05&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:02:05&quot;</span><span class="s3">)]</span>
        <span class="s3">).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>

        <span class="s1">ser </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">+ </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Second</span><span class="s3">(</span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result2 </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Second</span><span class="s3">(</span><span class="s5">5</span><span class="s3">) + </span><span class="s1">ser</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result2</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_series_sub_tick_DateOffset</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#4532</span>
        <span class="s0"># operate with pd.offsets</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:01&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:02&quot;</span><span class="s3">)])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:00:55&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:01:55&quot;</span><span class="s3">)]</span>
        <span class="s3">)</span>

        <span class="s1">ser </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Second</span><span class="s3">(</span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result2 </span><span class="s3">= -</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Second</span><span class="s3">(</span><span class="s5">5</span><span class="s3">) + </span><span class="s1">ser</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result2</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;(bad|unsupported) operand type for unary&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Second</span><span class="s3">(</span><span class="s5">5</span><span class="s3">) - </span><span class="s1">ser</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;cls_name&quot;</span><span class="s3">, [</span><span class="s4">&quot;Day&quot;</span><span class="s3">, </span><span class="s4">&quot;Hour&quot;</span><span class="s3">, </span><span class="s4">&quot;Minute&quot;</span><span class="s3">, </span><span class="s4">&quot;Second&quot;</span><span class="s3">, </span><span class="s4">&quot;Milli&quot;</span><span class="s3">, </span><span class="s4">&quot;Micro&quot;</span><span class="s3">, </span><span class="s4">&quot;Nano&quot;</span><span class="s3">]</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_add_sub_tick_DateOffset_smoke</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">cls_name</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#4532</span>
        <span class="s0"># smoke tests for valid DateOffsets</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:01&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:02&quot;</span><span class="s3">)])</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">offset_cls </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">, </span><span class="s1">cls_name</span><span class="s3">)</span>
        <span class="s1">ser </span><span class="s3">+ </span><span class="s1">offset_cls</span><span class="s3">(</span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">offset_cls</span><span class="s3">(</span><span class="s5">5</span><span class="s3">) + </span><span class="s1">ser</span>
        <span class="s1">ser </span><span class="s3">- </span><span class="s1">offset_cls</span><span class="s3">(</span><span class="s5">5</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dti_add_tick_tzaware</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_aware_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#21610, GH#22163 ensure DataFrame doesn't return object-dtype</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s2">if </span><span class="s1">tz </span><span class="s3">== </span><span class="s4">&quot;US/Pacific&quot;</span><span class="s3">:</span>
            <span class="s1">dates </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2012-11-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
            <span class="s1">offset </span><span class="s3">= </span><span class="s1">dates </span><span class="s3">+ </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Hour</span><span class="s3">(</span><span class="s5">5</span><span class="s3">)</span>
            <span class="s2">assert </span><span class="s1">dates</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] + </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Hour</span><span class="s3">(</span><span class="s5">5</span><span class="s3">) == </span><span class="s1">offset</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>

        <span class="s1">dates </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2010-11-01 00:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;h&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;2010-11-01 05:00&quot;</span><span class="s3">, </span><span class="s4">&quot;2010-11-01 06:00&quot;</span><span class="s3">, </span><span class="s4">&quot;2010-11-01 07:00&quot;</span><span class="s3">],</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;h&quot;</span><span class="s3">,</span>
            <span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">,</span>
        <span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>

        <span class="s1">dates </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dates</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">scalar </span><span class="s2">in </span><span class="s3">[</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Hour</span><span class="s3">(</span><span class="s5">5</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">5</span><span class="s3">, </span><span class="s4">&quot;h&quot;</span><span class="s3">), </span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">hours</span><span class="s3">=</span><span class="s5">5</span><span class="s3">)]:</span>
            <span class="s1">offset </span><span class="s3">= </span><span class="s1">dates </span><span class="s3">+ </span><span class="s1">scalar</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">offset</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
            <span class="s1">offset </span><span class="s3">= </span><span class="s1">scalar </span><span class="s3">+ </span><span class="s1">dates</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">offset</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

            <span class="s1">roundtrip </span><span class="s3">= </span><span class="s1">offset </span><span class="s3">- </span><span class="s1">scalar</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">roundtrip</span><span class="s3">, </span><span class="s1">dates</span><span class="s3">)</span>

            <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;|&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span>
                <span class="s3">[</span><span class="s4">&quot;bad operand type for unary -&quot;</span><span class="s3">, </span><span class="s4">&quot;cannot subtract DatetimeArray&quot;</span><span class="s3">]</span>
            <span class="s3">)</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">scalar </span><span class="s3">- </span><span class="s1">dates</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># RelativeDelta DateOffsets</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;unit&quot;</span><span class="s3">, [</span><span class="s4">&quot;s&quot;</span><span class="s3">, </span><span class="s4">&quot;ms&quot;</span><span class="s3">, </span><span class="s4">&quot;us&quot;</span><span class="s3">, </span><span class="s4">&quot;ns&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_add_sub_relativedelta_offsets</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s0"># GH#10699</span>
        <span class="s1">vec </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-05 00:15:00&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-31 00:23:00&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-01&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-03-31&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-02-29&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-12-31&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-05-15&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2001-06-15&quot;</span><span class="s3">),</span>
            <span class="s3">]</span>
        <span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">vec </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">vec</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">vec_items </span><span class="s3">= </span><span class="s1">vec</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] </span><span class="s2">if </span><span class="s1">box_with_array </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">DataFrame </span><span class="s2">else </span><span class="s1">vec</span>

        <span class="s0"># DateOffset relativedelta fastpath</span>
        <span class="s1">relative_kwargs </span><span class="s3">= [</span>
            <span class="s3">(</span><span class="s4">&quot;years&quot;</span><span class="s3">, </span><span class="s5">2</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s4">&quot;months&quot;</span><span class="s3">, </span><span class="s5">5</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s4">&quot;days&quot;</span><span class="s3">, </span><span class="s5">3</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s4">&quot;hours&quot;</span><span class="s3">, </span><span class="s5">5</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s4">&quot;minutes&quot;</span><span class="s3">, </span><span class="s5">10</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s4">&quot;seconds&quot;</span><span class="s3">, </span><span class="s5">2</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s4">&quot;microseconds&quot;</span><span class="s3">, </span><span class="s5">5</span><span class="s3">),</span>
        <span class="s3">]</span>
        <span class="s2">for </span><span class="s1">i</span><span class="s3">, (</span><span class="s1">offset_unit</span><span class="s3">, </span><span class="s1">value</span><span class="s3">) </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">relative_kwargs</span><span class="s3">):</span>
            <span class="s1">off </span><span class="s3">= </span><span class="s1">DateOffset</span><span class="s3">(**{</span><span class="s1">offset_unit</span><span class="s3">: </span><span class="s1">value</span><span class="s3">})</span>

            <span class="s1">exp_unit </span><span class="s3">= </span><span class="s1">unit</span>
            <span class="s2">if </span><span class="s1">offset_unit </span><span class="s3">== </span><span class="s4">&quot;microseconds&quot; </span><span class="s2">and </span><span class="s1">unit </span><span class="s3">!= </span><span class="s4">&quot;ns&quot;</span><span class="s3">:</span>
                <span class="s1">exp_unit </span><span class="s3">= </span><span class="s4">&quot;us&quot;</span>

            <span class="s0"># TODO(GH#55564): as_unit will be unnecessary</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">x </span><span class="s3">+ </span><span class="s1">off </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">vec_items</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">exp_unit</span><span class="s3">)</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">vec </span><span class="s3">+ </span><span class="s1">off</span><span class="s3">)</span>

            <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">x </span><span class="s3">- </span><span class="s1">off </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">vec_items</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">exp_unit</span><span class="s3">)</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">vec </span><span class="s3">- </span><span class="s1">off</span><span class="s3">)</span>

            <span class="s1">off </span><span class="s3">= </span><span class="s1">DateOffset</span><span class="s3">(**</span><span class="s1">dict</span><span class="s3">(</span><span class="s1">relative_kwargs</span><span class="s3">[: </span><span class="s1">i </span><span class="s3">+ </span><span class="s5">1</span><span class="s3">]))</span>

            <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">x </span><span class="s3">+ </span><span class="s1">off </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">vec_items</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">exp_unit</span><span class="s3">)</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">vec </span><span class="s3">+ </span><span class="s1">off</span><span class="s3">)</span>

            <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">x </span><span class="s3">- </span><span class="s1">off </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">vec_items</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">exp_unit</span><span class="s3">)</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">vec </span><span class="s3">- </span><span class="s1">off</span><span class="s3">)</span>
            <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;(bad|unsupported) operand type for unary&quot;</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">off </span><span class="s3">- </span><span class="s1">vec</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Non-Tick, Non-RelativeDelta DateOffsets</span>

    <span class="s0"># TODO: redundant with test_dt64arr_add_sub_DateOffset?  that includes</span>
    <span class="s0">#  tz-aware cases which this does not</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s4">&quot;ignore::pandas.errors.PerformanceWarning&quot;</span><span class="s3">)</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;cls_and_kwargs&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s4">&quot;YearBegin&quot;</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s4">&quot;YearBegin&quot;</span><span class="s3">, {</span><span class="s4">&quot;month&quot;</span><span class="s3">: </span><span class="s5">5</span><span class="s3">}),</span>
            <span class="s4">&quot;YearEnd&quot;</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s4">&quot;YearEnd&quot;</span><span class="s3">, {</span><span class="s4">&quot;month&quot;</span><span class="s3">: </span><span class="s5">5</span><span class="s3">}),</span>
            <span class="s4">&quot;MonthBegin&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;MonthEnd&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;SemiMonthEnd&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;SemiMonthBegin&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;Week&quot;</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s4">&quot;Week&quot;</span><span class="s3">, {</span><span class="s4">&quot;weekday&quot;</span><span class="s3">: </span><span class="s5">3</span><span class="s3">}),</span>
            <span class="s4">&quot;Week&quot;</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s4">&quot;Week&quot;</span><span class="s3">, {</span><span class="s4">&quot;weekday&quot;</span><span class="s3">: </span><span class="s5">6</span><span class="s3">}),</span>
            <span class="s4">&quot;BusinessDay&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;BDay&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;QuarterEnd&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;QuarterBegin&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;CustomBusinessDay&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;CDay&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;CBMonthEnd&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;CBMonthBegin&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;BMonthBegin&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;BMonthEnd&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;BusinessHour&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;BYearBegin&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;BYearEnd&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;BQuarterBegin&quot;</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s4">&quot;LastWeekOfMonth&quot;</span><span class="s3">, {</span><span class="s4">&quot;weekday&quot;</span><span class="s3">: </span><span class="s5">2</span><span class="s3">}),</span>
            <span class="s3">(</span>
                <span class="s4">&quot;FY5253Quarter&quot;</span><span class="s3">,</span>
                <span class="s3">{</span>
                    <span class="s4">&quot;qtr_with_extra_week&quot;</span><span class="s3">: </span><span class="s5">1</span><span class="s3">,</span>
                    <span class="s4">&quot;startingMonth&quot;</span><span class="s3">: </span><span class="s5">1</span><span class="s3">,</span>
                    <span class="s4">&quot;weekday&quot;</span><span class="s3">: </span><span class="s5">2</span><span class="s3">,</span>
                    <span class="s4">&quot;variation&quot;</span><span class="s3">: </span><span class="s4">&quot;nearest&quot;</span><span class="s3">,</span>
                <span class="s3">},</span>
            <span class="s3">),</span>
            <span class="s3">(</span><span class="s4">&quot;FY5253&quot;</span><span class="s3">, {</span><span class="s4">&quot;weekday&quot;</span><span class="s3">: </span><span class="s5">0</span><span class="s3">, </span><span class="s4">&quot;startingMonth&quot;</span><span class="s3">: </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;variation&quot;</span><span class="s3">: </span><span class="s4">&quot;nearest&quot;</span><span class="s3">}),</span>
            <span class="s3">(</span><span class="s4">&quot;WeekOfMonth&quot;</span><span class="s3">, {</span><span class="s4">&quot;weekday&quot;</span><span class="s3">: </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;week&quot;</span><span class="s3">: </span><span class="s5">2</span><span class="s3">}),</span>
            <span class="s4">&quot;Easter&quot;</span><span class="s3">,</span>
            <span class="s3">(</span><span class="s4">&quot;DateOffset&quot;</span><span class="s3">, {</span><span class="s4">&quot;day&quot;</span><span class="s3">: </span><span class="s5">4</span><span class="s3">}),</span>
            <span class="s3">(</span><span class="s4">&quot;DateOffset&quot;</span><span class="s3">, {</span><span class="s4">&quot;month&quot;</span><span class="s3">: </span><span class="s5">5</span><span class="s3">}),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;normalize&quot;</span><span class="s3">, [</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">])</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;n&quot;</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">5</span><span class="s3">])</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;unit&quot;</span><span class="s3">, [</span><span class="s4">&quot;s&quot;</span><span class="s3">, </span><span class="s4">&quot;ms&quot;</span><span class="s3">, </span><span class="s4">&quot;us&quot;</span><span class="s3">, </span><span class="s4">&quot;ns&quot;</span><span class="s3">])</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;tz&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s4">&quot;US/Central&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_add_sub_DateOffsets</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">n</span><span class="s3">, </span><span class="s1">normalize</span><span class="s3">, </span><span class="s1">cls_and_kwargs</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">, </span><span class="s1">tz</span>
    <span class="s3">):</span>
        <span class="s0"># GH#10699</span>
        <span class="s0"># assert vectorized operation matches pointwise operations</span>

        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">cls_and_kwargs</span><span class="s3">, </span><span class="s1">tuple</span><span class="s3">):</span>
            <span class="s0"># If cls_name param is a tuple, then 2nd entry is kwargs for</span>
            <span class="s0"># the offset constructor</span>
            <span class="s1">cls_name</span><span class="s3">, </span><span class="s1">kwargs </span><span class="s3">= </span><span class="s1">cls_and_kwargs</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">cls_name </span><span class="s3">= </span><span class="s1">cls_and_kwargs</span>
            <span class="s1">kwargs </span><span class="s3">= {}</span>

        <span class="s2">if </span><span class="s1">n </span><span class="s3">== </span><span class="s5">0 </span><span class="s2">and </span><span class="s1">cls_name </span><span class="s2">in </span><span class="s3">[</span>
            <span class="s4">&quot;WeekOfMonth&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;LastWeekOfMonth&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;FY5253Quarter&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;FY5253&quot;</span><span class="s3">,</span>
        <span class="s3">]:</span>
            <span class="s0"># passing n = 0 is invalid for these offset classes</span>
            <span class="s2">return</span>

        <span class="s1">vec </span><span class="s3">= (</span>
            <span class="s1">DatetimeIndex</span><span class="s3">(</span>
                <span class="s3">[</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-05 00:15:00&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-31 00:23:00&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-01&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-03-31&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-02-29&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-12-31&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-05-15&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2001-06-15&quot;</span><span class="s3">),</span>
                <span class="s3">]</span>
            <span class="s3">)</span>
            <span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
            <span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s3">)</span>
        <span class="s1">vec </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">vec</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">vec_items </span><span class="s3">= </span><span class="s1">vec</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] </span><span class="s2">if </span><span class="s1">box_with_array </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">DataFrame </span><span class="s2">else </span><span class="s1">vec</span>

        <span class="s1">offset_cls </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">, </span><span class="s1">cls_name</span><span class="s3">)</span>
        <span class="s1">offset </span><span class="s3">= </span><span class="s1">offset_cls</span><span class="s3">(</span><span class="s1">n</span><span class="s3">, </span><span class="s1">normalize</span><span class="s3">=</span><span class="s1">normalize</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>

        <span class="s0"># TODO(GH#55564): as_unit will be unnecessary</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">x </span><span class="s3">+ </span><span class="s1">offset </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">vec_items</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">vec </span><span class="s3">+ </span><span class="s1">offset</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">offset </span><span class="s3">+ </span><span class="s1">vec</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">x </span><span class="s3">- </span><span class="s1">offset </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">vec_items</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">vec </span><span class="s3">- </span><span class="s1">offset</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">offset </span><span class="s3">+ </span><span class="s1">x </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">vec_items</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">offset </span><span class="s3">+ </span><span class="s1">vec</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;(bad|unsupported) operand type for unary&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">offset </span><span class="s3">- </span><span class="s1">vec</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;other&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">MonthEnd</span><span class="s3">(), </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Day</span><span class="s3">(</span><span class="s1">n</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)]),</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">years</span><span class="s3">=</span><span class="s5">1</span><span class="s3">), </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">MonthEnd</span><span class="s3">()]),</span>
            <span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(  </span><span class="s0"># matching offsets</span>
                <span class="s3">[</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">years</span><span class="s3">=</span><span class="s5">1</span><span class="s3">), </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">years</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)]</span>
            <span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;op&quot;</span><span class="s3">, [</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">add</span><span class="s3">, </span><span class="s1">roperator</span><span class="s3">.</span><span class="s1">radd</span><span class="s3">, </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">sub</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dt64arr_add_sub_offset_array</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">op</span><span class="s3">, </span><span class="s1">other</span>
    <span class="s3">):</span>
        <span class="s0"># GH#18849</span>
        <span class="s0"># GH#10699 array of offsets</span>

        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">op</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">[</span><span class="s1">n</span><span class="s3">], </span><span class="s1">other</span><span class="s3">[</span><span class="s1">n</span><span class="s3">]) </span><span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">))])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
            <span class="s1">res </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># Same thing but boxing other</span>
        <span class="s1">other </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">other</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">box_with_array </span><span class="s2">is </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array </span><span class="s2">and </span><span class="s1">op </span><span class="s2">is </span><span class="s1">roperator</span><span class="s3">.</span><span class="s1">radd</span><span class="s3">:</span>
            <span class="s0"># We expect a NumpyExtensionArray, not ndarray[object] here</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">object</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
            <span class="s1">res </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;op, offset, exp, exp_freq&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span>
                <span class="s4">&quot;__add__&quot;</span><span class="s3">,</span>
                <span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">months</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">days</span><span class="s3">=</span><span class="s5">10</span><span class="s3">),</span>
                <span class="s3">[</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2014-04-11&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2015-04-11&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2016-04-11&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-04-11&quot;</span><span class="s3">),</span>
                <span class="s3">],</span>
                <span class="s2">None</span><span class="s3">,</span>
            <span class="s3">),</span>
            <span class="s3">(</span>
                <span class="s4">&quot;__add__&quot;</span><span class="s3">,</span>
                <span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">months</span><span class="s3">=</span><span class="s5">3</span><span class="s3">),</span>
                <span class="s3">[</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2014-04-01&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2015-04-01&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2016-04-01&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-04-01&quot;</span><span class="s3">),</span>
                <span class="s3">],</span>
                <span class="s4">&quot;YS-APR&quot;</span><span class="s3">,</span>
            <span class="s3">),</span>
            <span class="s3">(</span>
                <span class="s4">&quot;__sub__&quot;</span><span class="s3">,</span>
                <span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">months</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">days</span><span class="s3">=</span><span class="s5">10</span><span class="s3">),</span>
                <span class="s3">[</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2013-09-21&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2014-09-21&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2015-09-21&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2016-09-21&quot;</span><span class="s3">),</span>
                <span class="s3">],</span>
                <span class="s2">None</span><span class="s3">,</span>
            <span class="s3">),</span>
            <span class="s3">(</span>
                <span class="s4">&quot;__sub__&quot;</span><span class="s3">,</span>
                <span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">months</span><span class="s3">=</span><span class="s5">3</span><span class="s3">),</span>
                <span class="s3">[</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2013-10-01&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2014-10-01&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2015-10-01&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2016-10-01&quot;</span><span class="s3">),</span>
                <span class="s3">],</span>
                <span class="s4">&quot;YS-OCT&quot;</span><span class="s3">,</span>
            <span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_dti_add_sub_nonzero_mth_offset</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">op</span><span class="s3">, </span><span class="s1">offset</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">, </span><span class="s1">exp_freq</span><span class="s3">, </span><span class="s1">tz_aware_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span>
    <span class="s3">):</span>
        <span class="s0"># GH 26258</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s1">date </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s4">&quot;01 Jan 2014&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s4">&quot;01 Jan 2017&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;YS&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">date </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">date</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s2">False</span><span class="s3">)</span>
        <span class="s1">mth </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">date</span><span class="s3">, </span><span class="s1">op</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">mth</span><span class="s3">(</span><span class="s1">offset</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">exp</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s2">False</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64arr_series_add_DateOffset_with_milli</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># GH 57529</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s4">&quot;2000-01-01 00:00:00.012345678&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2000-01-31 00:00:00.012345678&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2000-02-29 00:00:00.012345678&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">+ </span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">milliseconds</span><span class="s3">=</span><span class="s5">4</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s4">&quot;2000-01-01 00:00:00.016345678&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2000-01-31 00:00:00.016345678&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2000-02-29 00:00:00.016345678&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">+ </span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">days</span><span class="s3">=</span><span class="s5">1</span><span class="s3">, </span><span class="s1">milliseconds</span><span class="s3">=</span><span class="s5">4</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s4">&quot;2000-01-02 00:00:00.016345678&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2000-02-01 00:00:00.016345678&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;2000-03-01 00:00:00.016345678&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestDatetime64OverflowHandling</span><span class="s3">:</span>
    <span class="s0"># TODO: box + de-duplicate</span>

    <span class="s2">def </span><span class="s1">test_dt64_overflow_masking</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#25317</span>
        <span class="s1">left </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;1969-12-31&quot;</span><span class="s3">)], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;M8[ns]&quot;</span><span class="s3">)</span>
        <span class="s1">right </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">])</span>

        <span class="s1">left </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">left</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">right </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">right</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;m8[ns]&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">left </span><span class="s3">- </span><span class="s1">right</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64_series_arith_overflow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># GH#12534, fixed by GH#19024</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;1700-01-31&quot;</span><span class="s3">)</span>
        <span class="s1">td </span><span class="s3">= </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;20000 Days&quot;</span><span class="s3">)</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1949-09-30&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;100YE&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">4</span><span class="s3">)</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Overflow in int64 addition&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">ser </span><span class="s3">- </span><span class="s1">dt</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dt </span><span class="s3">- </span><span class="s1">ser</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">ser </span><span class="s3">+ </span><span class="s1">td</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">td </span><span class="s3">+ </span><span class="s1">ser</span>

        <span class="s1">ser</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">] = </span><span class="s1">NaT</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;2004-10-03&quot;</span><span class="s3">, </span><span class="s4">&quot;2104-10-04&quot;</span><span class="s3">, </span><span class="s4">&quot;2204-10-04&quot;</span><span class="s3">, </span><span class="s4">&quot;NaT&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ns]&quot;</span>
        <span class="s3">)</span>
        <span class="s1">res </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">+ </span><span class="s1">td</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">res </span><span class="s3">= </span><span class="s1">td </span><span class="s3">+ </span><span class="s1">ser</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">ser</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[</span><span class="s5">1</span><span class="s3">:] = </span><span class="s1">NaT</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s4">&quot;91279 Days&quot;</span><span class="s3">, </span><span class="s4">&quot;NaT&quot;</span><span class="s3">, </span><span class="s4">&quot;NaT&quot;</span><span class="s3">, </span><span class="s4">&quot;NaT&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;timedelta64[ns]&quot;</span><span class="s3">)</span>
        <span class="s1">res </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">dt</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">res </span><span class="s3">= </span><span class="s1">dt </span><span class="s3">- </span><span class="s1">ser</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, -</span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_datetimeindex_sub_timestamp_overflow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">dtimax </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">to_datetime</span><span class="s3">([</span><span class="s4">&quot;2021-12-28 17:19&quot;</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">max</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">dtimin </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">to_datetime</span><span class="s3">([</span><span class="s4">&quot;2021-12-28 17:19&quot;</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">min</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>

        <span class="s1">tsneg </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;1950-01-01&quot;</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">ts_neg_variants </span><span class="s3">= [</span>
            <span class="s1">tsneg</span><span class="s3">,</span>
            <span class="s1">tsneg</span><span class="s3">.</span><span class="s1">to_pydatetime</span><span class="s3">(),</span>
            <span class="s1">tsneg</span><span class="s3">.</span><span class="s1">to_datetime64</span><span class="s3">().</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">),</span>
            <span class="s1">tsneg</span><span class="s3">.</span><span class="s1">to_datetime64</span><span class="s3">().</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;datetime64[D]&quot;</span><span class="s3">),</span>
        <span class="s3">]</span>

        <span class="s1">tspos </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;1980-01-01&quot;</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">ts_pos_variants </span><span class="s3">= [</span>
            <span class="s1">tspos</span><span class="s3">,</span>
            <span class="s1">tspos</span><span class="s3">.</span><span class="s1">to_pydatetime</span><span class="s3">(),</span>
            <span class="s1">tspos</span><span class="s3">.</span><span class="s1">to_datetime64</span><span class="s3">().</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">),</span>
            <span class="s1">tspos</span><span class="s3">.</span><span class="s1">to_datetime64</span><span class="s3">().</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;datetime64[D]&quot;</span><span class="s3">),</span>
        <span class="s3">]</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Overflow in int64 addition&quot;</span>
        <span class="s2">for </span><span class="s1">variant </span><span class="s2">in </span><span class="s1">ts_neg_variants</span><span class="s3">:</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">dtimax </span><span class="s3">- </span><span class="s1">variant</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">max</span><span class="s3">.</span><span class="s1">_value </span><span class="s3">- </span><span class="s1">tspos</span><span class="s3">.</span><span class="s1">_value</span>
        <span class="s2">for </span><span class="s1">variant </span><span class="s2">in </span><span class="s1">ts_pos_variants</span><span class="s3">:</span>
            <span class="s1">res </span><span class="s3">= </span><span class="s1">dtimax </span><span class="s3">- </span><span class="s1">variant</span>
            <span class="s2">assert </span><span class="s1">res</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">_value </span><span class="s3">== </span><span class="s1">expected</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">min</span><span class="s3">.</span><span class="s1">_value </span><span class="s3">- </span><span class="s1">tsneg</span><span class="s3">.</span><span class="s1">_value</span>
        <span class="s2">for </span><span class="s1">variant </span><span class="s2">in </span><span class="s1">ts_neg_variants</span><span class="s3">:</span>
            <span class="s1">res </span><span class="s3">= </span><span class="s1">dtimin </span><span class="s3">- </span><span class="s1">variant</span>
            <span class="s2">assert </span><span class="s1">res</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">_value </span><span class="s3">== </span><span class="s1">expected</span>

        <span class="s2">for </span><span class="s1">variant </span><span class="s2">in </span><span class="s1">ts_pos_variants</span><span class="s3">:</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
                <span class="s1">dtimin </span><span class="s3">- </span><span class="s1">variant</span>

    <span class="s2">def </span><span class="s1">test_datetimeindex_sub_datetimeindex_overflow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># GH#22492, GH#22508</span>
        <span class="s1">dtimax </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">to_datetime</span><span class="s3">([</span><span class="s4">&quot;2021-12-28 17:19&quot;</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">max</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">dtimin </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">to_datetime</span><span class="s3">([</span><span class="s4">&quot;2021-12-28 17:19&quot;</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">min</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>

        <span class="s1">ts_neg </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">to_datetime</span><span class="s3">([</span><span class="s4">&quot;1950-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;1950-01-01&quot;</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">ts_pos </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">to_datetime</span><span class="s3">([</span><span class="s4">&quot;1980-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;1980-01-01&quot;</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>

        <span class="s0"># General tests</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">max</span><span class="s3">.</span><span class="s1">_value </span><span class="s3">- </span><span class="s1">ts_pos</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">_value</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dtimax </span><span class="s3">- </span><span class="s1">ts_pos</span>
        <span class="s2">assert </span><span class="s1">result</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">_value </span><span class="s3">== </span><span class="s1">expected</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">min</span><span class="s3">.</span><span class="s1">_value </span><span class="s3">- </span><span class="s1">ts_neg</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">_value</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dtimin </span><span class="s3">- </span><span class="s1">ts_neg</span>
        <span class="s2">assert </span><span class="s1">result</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">_value </span><span class="s3">== </span><span class="s1">expected</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Overflow in int64 addition&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dtimax </span><span class="s3">- </span><span class="s1">ts_neg</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dtimin </span><span class="s3">- </span><span class="s1">ts_pos</span>

        <span class="s0"># Edge cases</span>
        <span class="s1">tmin </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">to_datetime</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">min</span><span class="s3">])</span>
        <span class="s1">t1 </span><span class="s3">= </span><span class="s1">tmin </span><span class="s3">+ </span><span class="s1">Timedelta</span><span class="s3">.</span><span class="s1">max </span><span class="s3">+ </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;1us&quot;</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">t1 </span><span class="s3">- </span><span class="s1">tmin</span>

        <span class="s1">tmax </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">to_datetime</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">max</span><span class="s3">])</span>
        <span class="s1">t2 </span><span class="s3">= </span><span class="s1">tmax </span><span class="s3">+ </span><span class="s1">Timedelta</span><span class="s3">.</span><span class="s1">min </span><span class="s3">- </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;1us&quot;</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OverflowError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tmax </span><span class="s3">- </span><span class="s1">t2</span>


<span class="s2">class </span><span class="s1">TestTimestampSeriesArithmetic</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_empty_series_add_sub</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s0"># GH#13844</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;M8[ns]&quot;</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;m8[ns]&quot;</span><span class="s3">)</span>
        <span class="s1">a </span><span class="s3">= </span><span class="s1">box_with_array</span><span class="s3">(</span><span class="s1">a</span><span class="s3">)</span>
        <span class="s1">b </span><span class="s3">= </span><span class="s1">box_with_array</span><span class="s3">(</span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">a </span><span class="s3">+ </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">a </span><span class="s3">- </span><span class="s1">b</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b </span><span class="s3">+ </span><span class="s1">a</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot subtract&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">b </span><span class="s3">- </span><span class="s1">a</span>

    <span class="s2">def </span><span class="s1">test_operators_datetimelike</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># ## timedelta64 ###</span>
        <span class="s1">td1 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">minutes</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s1">seconds</span><span class="s3">=</span><span class="s5">3</span><span class="s3">)] * </span><span class="s5">3</span><span class="s3">)</span>
        <span class="s1">td1</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] = </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span>

        <span class="s0"># ## datetime64 ###</span>
        <span class="s1">dt1 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20111230&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120101&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120103&quot;</span><span class="s3">),</span>
            <span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">dt1</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] = </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span>
        <span class="s1">dt2 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20111231&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120102&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120104&quot;</span><span class="s3">),</span>
            <span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">dt1 </span><span class="s3">- </span><span class="s1">dt2</span>
        <span class="s1">dt2 </span><span class="s3">- </span><span class="s1">dt1</span>

        <span class="s0"># datetime64 with timetimedelta</span>
        <span class="s1">dt1 </span><span class="s3">+ </span><span class="s1">td1</span>
        <span class="s1">td1 </span><span class="s3">+ </span><span class="s1">dt1</span>
        <span class="s1">dt1 </span><span class="s3">- </span><span class="s1">td1</span>

        <span class="s0"># timetimedelta with datetime64</span>
        <span class="s1">td1 </span><span class="s3">+ </span><span class="s1">dt1</span>
        <span class="s1">dt1 </span><span class="s3">+ </span><span class="s1">td1</span>

    <span class="s2">def </span><span class="s1">test_dt64ser_sub_datetime_dtype</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">1993</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">7</span><span class="s3">, </span><span class="s5">13</span><span class="s3">, </span><span class="s5">30</span><span class="s3">, </span><span class="s5">00</span><span class="s3">))</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">1993</span><span class="s3">, </span><span class="s5">6</span><span class="s3">, </span><span class="s5">22</span><span class="s3">, </span><span class="s5">13</span><span class="s3">, </span><span class="s5">30</span><span class="s3">)</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">ts</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s4">]&quot;</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">dt</span>

        <span class="s0"># the expected unit is the max of `unit` and the unit imputed to `dt`,</span>
        <span class="s0">#  which is &quot;us&quot;</span>
        <span class="s1">exp_unit </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">get_finest_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">, </span><span class="s4">&quot;us&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">dtype </span><span class="s3">== </span><span class="s4">f&quot;timedelta64[</span><span class="s2">{</span><span class="s1">exp_unit</span><span class="s2">}</span><span class="s4">]&quot;</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># TODO: This next block of tests came from tests.series.test_operators,</span>
    <span class="s0"># needs to be de-duplicated and parametrized over `box` classes</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s4">&quot;left, right, op_fail&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">[</span>
                <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20111230&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120101&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">],</span>
                <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20111231&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120102&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120104&quot;</span><span class="s3">)],</span>
                <span class="s3">[</span><span class="s4">&quot;__sub__&quot;</span><span class="s3">, </span><span class="s4">&quot;__rsub__&quot;</span><span class="s3">],</span>
            <span class="s3">],</span>
            <span class="s3">[</span>
                <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20111230&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20120101&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">],</span>
                <span class="s3">[</span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">minutes</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s1">seconds</span><span class="s3">=</span><span class="s5">3</span><span class="s3">), </span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">minutes</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s1">seconds</span><span class="s3">=</span><span class="s5">3</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">],</span>
                <span class="s3">[</span><span class="s4">&quot;__add__&quot;</span><span class="s3">, </span><span class="s4">&quot;__radd__&quot;</span><span class="s3">, </span><span class="s4">&quot;__sub__&quot;</span><span class="s3">],</span>
            <span class="s3">],</span>
            <span class="s3">[</span>
                <span class="s3">[</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20111230&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s3">),</span>
                    <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20111230&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s3">),</span>
                    <span class="s1">NaT</span><span class="s3">,</span>
                <span class="s3">],</span>
                <span class="s3">[</span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">minutes</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s1">seconds</span><span class="s3">=</span><span class="s5">3</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">minutes</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s1">seconds</span><span class="s3">=</span><span class="s5">3</span><span class="s3">)],</span>
                <span class="s3">[</span><span class="s4">&quot;__add__&quot;</span><span class="s3">, </span><span class="s4">&quot;__radd__&quot;</span><span class="s3">, </span><span class="s4">&quot;__sub__&quot;</span><span class="s3">],</span>
            <span class="s3">],</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_operators_datetimelike_invalid</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">left</span><span class="s3">, </span><span class="s1">right</span><span class="s3">, </span><span class="s1">op_fail</span><span class="s3">, </span><span class="s1">all_arithmetic_operators</span>
    <span class="s3">):</span>
        <span class="s0"># these are all TypeError ops</span>
        <span class="s1">op_str </span><span class="s3">= </span><span class="s1">all_arithmetic_operators</span>
        <span class="s1">arg1 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">left</span><span class="s3">)</span>
        <span class="s1">arg2 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">right</span><span class="s3">)</span>
        <span class="s0"># check that we are getting a TypeError</span>
        <span class="s0"># with 'operate' (from core/ops.py) for the ops that are not</span>
        <span class="s0"># defined</span>
        <span class="s1">op </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">arg1</span><span class="s3">, </span><span class="s1">op_str</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
        <span class="s0"># Previously, _validate_for_numeric_binop in core/indexes/base.py</span>
        <span class="s0"># did this for us.</span>
        <span class="s2">if </span><span class="s1">op_str </span><span class="s2">not in </span><span class="s1">op_fail</span><span class="s3">:</span>
            <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span>
                <span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s4">&quot;operate|[cC]annot|unsupported operand&quot;</span>
            <span class="s3">):</span>
                <span class="s1">op</span><span class="s3">(</span><span class="s1">arg2</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s0"># Smoke test</span>
            <span class="s1">op</span><span class="s3">(</span><span class="s1">arg2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_sub_single_tz</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s0"># GH#12290</span>
        <span class="s1">s1 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2016-02-10&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;America/Sao_Paulo&quot;</span><span class="s3">)]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">s2 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2016-02-08&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;America/Sao_Paulo&quot;</span><span class="s3">)]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">s1 </span><span class="s3">- </span><span class="s1">s2</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;2days&quot;</span><span class="s3">)]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">s2 </span><span class="s3">- </span><span class="s1">s1</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;-2days&quot;</span><span class="s3">)]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64tz_series_sub_dtitz</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># GH#19071 subtracting tzaware DatetimeIndex from tzaware Series</span>
        <span class="s0"># (with same tz) raises, fixed by #19024</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1999-09-30&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s4">&quot;US/Pacific&quot;</span><span class="s3">)</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">TimedeltaIndex</span><span class="s3">([</span><span class="s4">&quot;0days&quot;</span><span class="s3">] * </span><span class="s5">10</span><span class="s3">))</span>

        <span class="s1">res </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">- </span><span class="s1">ser</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">res </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">dti</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_sub_datetime_compat</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s0"># see GH#14088</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">2016</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">23</span><span class="s3">, </span><span class="s5">12</span><span class="s3">, </span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s1">pytz</span><span class="s3">.</span><span class="s1">utc</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">dt </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s5">2016</span><span class="s3">, </span><span class="s5">8</span><span class="s3">, </span><span class="s5">22</span><span class="s3">, </span><span class="s5">12</span><span class="s3">, </span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s1">pytz</span><span class="s3">.</span><span class="s1">utc</span><span class="s3">)</span>
        <span class="s0"># The datetime object has &quot;us&quot; so we upcast lower units</span>
        <span class="s1">exp_unit </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">get_finest_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">, </span><span class="s4">&quot;us&quot;</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;1 days&quot;</span><span class="s3">), </span><span class="s1">NaT</span><span class="s3">]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">exp_unit</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">dt</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
        <span class="s1">result2 </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result2</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dt64_series_add_mixed_tick_DateOffset</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># GH#4532</span>
        <span class="s0"># operate with pd.offsets</span>
        <span class="s1">s </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:01&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:02&quot;</span><span class="s3">)])</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">s </span><span class="s3">+ </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Milli</span><span class="s3">(</span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">result2 </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Milli</span><span class="s3">(</span><span class="s5">5</span><span class="s3">) + </span><span class="s1">s</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:01:00.005&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:02:00.005&quot;</span><span class="s3">)]</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result2</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">s </span><span class="s3">+ </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Minute</span><span class="s3">(</span><span class="s5">5</span><span class="s3">) + </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Milli</span><span class="s3">(</span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:06:00.005&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130101 9:07:00.005&quot;</span><span class="s3">)]</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_datetime64_ops_nat</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s0"># GH#11349</span>
        <span class="s1">datetime_series </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;19900315&quot;</span><span class="s3">)]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">nat_series_dtype_timestamp </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">f&quot;datetime64[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s4">]&quot;</span><span class="s3">)</span>
        <span class="s1">single_nat_dtype_datetime </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">f&quot;datetime64[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s4">]&quot;</span><span class="s3">)</span>

        <span class="s0"># subtraction</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(-</span><span class="s1">NaT </span><span class="s3">+ </span><span class="s1">datetime_series</span><span class="s3">, </span><span class="s1">nat_series_dtype_timestamp</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;bad operand type for unary -: 'DatetimeArray'&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s3">-</span><span class="s1">single_nat_dtype_datetime </span><span class="s3">+ </span><span class="s1">datetime_series</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s3">-</span><span class="s1">NaT </span><span class="s3">+ </span><span class="s1">nat_series_dtype_timestamp</span><span class="s3">, </span><span class="s1">nat_series_dtype_timestamp</span>
        <span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s3">-</span><span class="s1">single_nat_dtype_datetime </span><span class="s3">+ </span><span class="s1">nat_series_dtype_timestamp</span>

        <span class="s0"># addition</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">nat_series_dtype_timestamp </span><span class="s3">+ </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">nat_series_dtype_timestamp</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">NaT </span><span class="s3">+ </span><span class="s1">nat_series_dtype_timestamp</span><span class="s3">, </span><span class="s1">nat_series_dtype_timestamp</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">nat_series_dtype_timestamp </span><span class="s3">+ </span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">nat_series_dtype_timestamp</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">NaT </span><span class="s3">+ </span><span class="s1">nat_series_dtype_timestamp</span><span class="s3">, </span><span class="s1">nat_series_dtype_timestamp</span>
        <span class="s3">)</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Timezone-Centric Tests</span>

    <span class="s2">def </span><span class="s1">test_operators_datetimelike_with_timezones</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s4">&quot;US/Eastern&quot;</span>
        <span class="s1">dt1 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2000-01-01 09:00:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">), </span><span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;foo&quot;</span><span class="s3">)</span>
        <span class="s1">dt2 </span><span class="s3">= </span><span class="s1">dt1</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">dt2</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] = </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span>

        <span class="s1">td1 </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;1 days 1 min&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">5</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;h&quot;</span><span class="s3">))</span>
        <span class="s1">td2 </span><span class="s3">= </span><span class="s1">td1</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">td2</span><span class="s3">.</span><span class="s1">iloc</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] = </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span>
        <span class="s2">assert </span><span class="s1">td2</span><span class="s3">.</span><span class="s1">_values</span><span class="s3">.</span><span class="s1">freq </span><span class="s2">is None</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt1 </span><span class="s3">+ </span><span class="s1">td1</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt1</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) + </span><span class="s1">td1</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt2 </span><span class="s3">+ </span><span class="s1">td2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt2</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) + </span><span class="s1">td2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s0"># odd numpy behavior with scalar timedeltas</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">td1</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] + </span><span class="s1">dt1</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt1</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) + </span><span class="s1">td1</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">td2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] + </span><span class="s1">dt2</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt2</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) + </span><span class="s1">td2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt1 </span><span class="s3">- </span><span class="s1">td1</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt1</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) - </span><span class="s1">td1</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;(bad|unsupported) operand type for unary&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">td1</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] - </span><span class="s1">dt1</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt2 </span><span class="s3">- </span><span class="s1">td2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt2</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) - </span><span class="s1">td2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">td2</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] - </span><span class="s1">dt2</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt1 </span><span class="s3">+ </span><span class="s1">td1</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt1</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) + </span><span class="s1">td1</span><span class="s3">).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt2 </span><span class="s3">+ </span><span class="s1">td2</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt2</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) + </span><span class="s1">td2</span><span class="s3">).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt1 </span><span class="s3">- </span><span class="s1">td1</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt1</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) - </span><span class="s1">td1</span><span class="s3">).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dt2 </span><span class="s3">- </span><span class="s1">td2</span>
        <span class="s1">exp </span><span class="s3">= (</span><span class="s1">dt2</span><span class="s3">.</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s2">None</span><span class="s3">) - </span><span class="s1">td2</span><span class="s3">).</span><span class="s1">dt</span><span class="s3">.</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot (add|subtract)&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">td1 </span><span class="s3">- </span><span class="s1">dt1</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">td2 </span><span class="s3">- </span><span class="s1">dt2</span>


<span class="s2">class </span><span class="s1">TestDatetimeIndexArithmetic</span><span class="s3">:</span>
    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Binary operations DatetimeIndex and TimedeltaIndex/array</span>

    <span class="s2">def </span><span class="s1">test_dti_add_tdi</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s0"># GH#17558</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">tdi </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;0 days&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">_with_freq</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>

        <span class="s0"># add with TimedeltaIndex</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">+ </span><span class="s1">tdi</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">tdi </span><span class="s3">+ </span><span class="s1">dti</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># add with timedelta64 array</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">+ </span><span class="s1">tdi</span><span class="s3">.</span><span class="s1">values</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">tdi</span><span class="s3">.</span><span class="s1">values </span><span class="s3">+ </span><span class="s1">dti</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dti_iadd_tdi</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s0"># GH#17558</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">tdi </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;0 days&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">_with_freq</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>

        <span class="s0"># iadd with TimedeltaIndex</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">+= </span><span class="s1">tdi</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;0 days&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">+= </span><span class="s1">dti</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># iadd with timedelta64 array</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">+= </span><span class="s1">tdi</span><span class="s3">.</span><span class="s1">values</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;0 days&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">+= </span><span class="s1">dti</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_dti_sub_tdi</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s0"># GH#17558</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)] * </span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">tdi </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;0 days&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;-1D&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">_with_freq</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>

        <span class="s0"># sub with TimedeltaIndex</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">- </span><span class="s1">tdi</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot subtract .*TimedeltaArray&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tdi </span><span class="s3">- </span><span class="s1">dti</span>

        <span class="s0"># sub with timedelta64 array</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">- </span><span class="s1">tdi</span><span class="s3">.</span><span class="s1">values</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot subtract a datelike from a TimedeltaArray&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tdi</span><span class="s3">.</span><span class="s1">values </span><span class="s3">- </span><span class="s1">dti</span>

    <span class="s2">def </span><span class="s1">test_dti_isub_tdi</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s0"># GH#17558</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)] * </span><span class="s5">10</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">tdi </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">timedelta_range</span><span class="s3">(</span><span class="s4">&quot;0 days&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;-1D&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">_with_freq</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>

        <span class="s0"># isub with TimedeltaIndex</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)] * </span><span class="s5">10</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">-= </span><span class="s1">tdi</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># DTA.__isub__ GH#43904</span>
        <span class="s1">dta </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">_data</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">dta </span><span class="s3">-= </span><span class="s1">tdi</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_datetime_array_equal</span><span class="s3">(</span><span class="s1">dta</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">_data</span><span class="s3">)</span>

        <span class="s1">out </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">_data</span><span class="s3">.</span><span class="s1">copy</span><span class="s3">()</span>
        <span class="s1">np</span><span class="s3">.</span><span class="s1">subtract</span><span class="s3">(</span><span class="s1">out</span><span class="s3">, </span><span class="s1">tdi</span><span class="s3">, </span><span class="s1">out</span><span class="s3">=</span><span class="s1">out</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_datetime_array_equal</span><span class="s3">(</span><span class="s1">out</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">_data</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot subtract a datelike from a TimedeltaArray&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tdi </span><span class="s3">-= </span><span class="s1">dti</span>

        <span class="s0"># isub with timedelta64 array</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)] * </span><span class="s5">10</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">-= </span><span class="s1">tdi</span><span class="s3">.</span><span class="s1">values</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tdi</span><span class="s3">.</span><span class="s1">values </span><span class="s3">-= </span><span class="s1">dti</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">tdi</span><span class="s3">.</span><span class="s1">_values </span><span class="s3">-= </span><span class="s1">dti</span>

    <span class="s0"># -------------------------------------------------------------</span>
    <span class="s0"># Binary Operations DatetimeIndex and datetime-like</span>
    <span class="s0"># TODO: A couple other tests belong in this section.  Move them in</span>
    <span class="s0"># A PR where there isn't already a giant diff.</span>

    <span class="s0"># -------------------------------------------------------------</span>

    <span class="s2">def </span><span class="s1">test_dta_add_sub_index</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s0"># Check that DatetimeArray defers to Index classes</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz_naive_fixture</span><span class="s3">)</span>
        <span class="s1">dta </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">array</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dta </span><span class="s3">- </span><span class="s1">dti</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">- </span><span class="s1">dti</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">tdi </span><span class="s3">= </span><span class="s1">result</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dta </span><span class="s3">+ </span><span class="s1">tdi</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">+ </span><span class="s1">tdi</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dta </span><span class="s3">- </span><span class="s1">tdi</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">- </span><span class="s1">tdi</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_sub_dti_dti</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s0"># previously performed setop (deprecated in 0.16.0), now changed to</span>
        <span class="s0"># return subtraction -&gt; TimeDeltaIndex (GH ...)</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">dti_tz </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">).</span><span class="s1">tz_localize</span><span class="s3">(</span><span class="s4">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">([</span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">0</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti </span><span class="s3">- </span><span class="s1">dti</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti_tz </span><span class="s3">- </span><span class="s1">dti_tz</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;Cannot subtract tz-naive and tz-aware datetime-like objects&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dti_tz </span><span class="s3">- </span><span class="s1">dti</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dti </span><span class="s3">- </span><span class="s1">dti_tz</span>

        <span class="s0"># isub</span>
        <span class="s1">dti </span><span class="s3">-= </span><span class="s1">dti</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s0"># different length raises ValueError</span>
        <span class="s1">dti1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">dti2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">4</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot add indices of unequal length&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">dti1 </span><span class="s3">- </span><span class="s1">dti2</span>

        <span class="s0"># NaN propagation</span>
        <span class="s1">dti1 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s4">&quot;2012-01-01&quot;</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s4">&quot;2012-01-03&quot;</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">dti2 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s4">&quot;2012-01-02&quot;</span><span class="s3">, </span><span class="s4">&quot;2012-01-03&quot;</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">TimedeltaIndex</span><span class="s3">([</span><span class="s4">&quot;1 days&quot;</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">nan</span><span class="s3">]).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dti2 </span><span class="s3">- </span><span class="s1">dti1</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s0"># -------------------------------------------------------------------</span>
    <span class="s0"># TODO: Most of this block is moved from series or frame tests, needs</span>
    <span class="s0"># cleanup, box-parametrization, and de-duplication</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;op&quot;</span><span class="s3">, [</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">add</span><span class="s3">, </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">sub</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_timedelta64_equal_timedelta_supported_ops</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">op</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">):</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130301&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130228 23:00:00&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130228 22:00:00&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;20130228 21:00:00&quot;</span><span class="s3">),</span>
            <span class="s3">]</span>
        <span class="s3">)</span>
        <span class="s1">obj </span><span class="s3">= </span><span class="s1">box_with_array</span><span class="s3">(</span><span class="s1">ser</span><span class="s3">)</span>

        <span class="s1">intervals </span><span class="s3">= [</span><span class="s4">&quot;D&quot;</span><span class="s3">, </span><span class="s4">&quot;h&quot;</span><span class="s3">, </span><span class="s4">&quot;m&quot;</span><span class="s3">, </span><span class="s4">&quot;s&quot;</span><span class="s3">, </span><span class="s4">&quot;us&quot;</span><span class="s3">]</span>

        <span class="s2">def </span><span class="s1">timedelta64</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">):</span>
            <span class="s0"># see casting notes in NumPy gh-12927</span>
            <span class="s2">return </span><span class="s1">np</span><span class="s3">.</span><span class="s1">sum</span><span class="s3">(</span><span class="s1">list</span><span class="s3">(</span><span class="s1">starmap</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">, </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">args</span><span class="s3">, </span><span class="s1">intervals</span><span class="s3">))))</span>

        <span class="s2">for </span><span class="s1">d</span><span class="s3">, </span><span class="s1">h</span><span class="s3">, </span><span class="s1">m</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">us </span><span class="s2">in </span><span class="s1">product</span><span class="s3">(*([</span><span class="s1">range</span><span class="s3">(</span><span class="s5">2</span><span class="s3">)] * </span><span class="s5">5</span><span class="s3">)):</span>
            <span class="s1">nptd </span><span class="s3">= </span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s1">d</span><span class="s3">, </span><span class="s1">h</span><span class="s3">, </span><span class="s1">m</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">us</span><span class="s3">)</span>
            <span class="s1">pytd </span><span class="s3">= </span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">days</span><span class="s3">=</span><span class="s1">d</span><span class="s3">, </span><span class="s1">hours</span><span class="s3">=</span><span class="s1">h</span><span class="s3">, </span><span class="s1">minutes</span><span class="s3">=</span><span class="s1">m</span><span class="s3">, </span><span class="s1">seconds</span><span class="s3">=</span><span class="s1">s</span><span class="s3">, </span><span class="s1">microseconds</span><span class="s3">=</span><span class="s1">us</span><span class="s3">)</span>
            <span class="s1">lhs </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">nptd</span><span class="s3">)</span>
            <span class="s1">rhs </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">pytd</span><span class="s3">)</span>

            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">lhs</span><span class="s3">, </span><span class="s1">rhs</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_ops_nat_mixed_datetime64_timedelta64</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s0"># GH#11349</span>
        <span class="s1">timedelta_series </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">&quot;1s&quot;</span><span class="s3">)])</span>
        <span class="s1">datetime_series </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;19900315&quot;</span><span class="s3">)])</span>
        <span class="s1">nat_series_dtype_timedelta </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;timedelta64[ns]&quot;</span><span class="s3">)</span>
        <span class="s1">nat_series_dtype_timestamp </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">)</span>
        <span class="s1">single_nat_dtype_datetime </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">)</span>
        <span class="s1">single_nat_dtype_timedelta </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;timedelta64[ns]&quot;</span><span class="s3">)</span>

        <span class="s0"># subtraction</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">datetime_series </span><span class="s3">- </span><span class="s1">single_nat_dtype_datetime</span><span class="s3">, </span><span class="s1">nat_series_dtype_timedelta</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">datetime_series </span><span class="s3">- </span><span class="s1">single_nat_dtype_timedelta</span><span class="s3">, </span><span class="s1">nat_series_dtype_timestamp</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s3">-</span><span class="s1">single_nat_dtype_timedelta </span><span class="s3">+ </span><span class="s1">datetime_series</span><span class="s3">, </span><span class="s1">nat_series_dtype_timestamp</span>
        <span class="s3">)</span>

        <span class="s0"># without a Series wrapping the NaT, it is ambiguous</span>
        <span class="s0"># whether it is a datetime64 or timedelta64</span>
        <span class="s0"># defaults to interpreting it as timedelta64</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">nat_series_dtype_timestamp </span><span class="s3">- </span><span class="s1">single_nat_dtype_datetime</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timedelta</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">nat_series_dtype_timestamp </span><span class="s3">- </span><span class="s1">single_nat_dtype_timedelta</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s3">-</span><span class="s1">single_nat_dtype_timedelta </span><span class="s3">+ </span><span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;cannot subtract a datelike&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">timedelta_series </span><span class="s3">- </span><span class="s1">single_nat_dtype_datetime</span>

        <span class="s0"># addition</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">nat_series_dtype_timestamp </span><span class="s3">+ </span><span class="s1">single_nat_dtype_timedelta</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">single_nat_dtype_timedelta </span><span class="s3">+ </span><span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">nat_series_dtype_timestamp </span><span class="s3">+ </span><span class="s1">single_nat_dtype_timedelta</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">single_nat_dtype_timedelta </span><span class="s3">+ </span><span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">nat_series_dtype_timedelta </span><span class="s3">+ </span><span class="s1">single_nat_dtype_datetime</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span>
            <span class="s1">single_nat_dtype_datetime </span><span class="s3">+ </span><span class="s1">nat_series_dtype_timedelta</span><span class="s3">,</span>
            <span class="s1">nat_series_dtype_timestamp</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_ufunc_coercions</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;2D&quot;</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;x&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>

        <span class="s1">delta </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2011-01-02&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;2D&quot;</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;x&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">result </span><span class="s2">in </span><span class="s3">[</span><span class="s1">idx </span><span class="s3">+ </span><span class="s1">delta</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">delta</span><span class="s3">)]:</span>
            <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">DatetimeIndex</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
            <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s4">&quot;2D&quot;</span>

        <span class="s1">exp </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2010-12-31&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">3</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;2D&quot;</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;x&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">result </span><span class="s2">in </span><span class="s3">[</span><span class="s1">idx </span><span class="s3">- </span><span class="s1">delta</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">subtract</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">delta</span><span class="s3">)]:</span>
            <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">DatetimeIndex</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
            <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s4">&quot;2D&quot;</span>

        <span class="s0"># When adding/subtracting an ndarray (which has no .freq), the result</span>
        <span class="s0">#  does not infer freq</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">idx</span><span class="s3">.</span><span class="s1">_with_freq</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s1">delta </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">), </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s5">3</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">)]</span>
        <span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;2011-01-02&quot;</span><span class="s3">, </span><span class="s4">&quot;2011-01-05&quot;</span><span class="s3">, </span><span class="s4">&quot;2011-01-08&quot;</span><span class="s3">], </span><span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;x&quot;</span>
        <span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">result </span><span class="s2">in </span><span class="s3">[</span><span class="s1">idx </span><span class="s3">+ </span><span class="s1">delta</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">delta</span><span class="s3">)]:</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
            <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">exp</span><span class="s3">.</span><span class="s1">freq</span>

        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;2010-12-31&quot;</span><span class="s3">, </span><span class="s4">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s4">&quot;2011-01-02&quot;</span><span class="s3">], </span><span class="s1">name</span><span class="s3">=</span><span class="s4">&quot;x&quot;</span>
        <span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">result </span><span class="s2">in </span><span class="s3">[</span><span class="s1">idx </span><span class="s3">- </span><span class="s1">delta</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">subtract</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">delta</span><span class="s3">)]:</span>
            <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">DatetimeIndex</span><span class="s3">)</span>
            <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
            <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">exp</span><span class="s3">.</span><span class="s1">freq</span>

    <span class="s2">def </span><span class="s1">test_dti_add_series</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">names</span><span class="s3">):</span>
        <span class="s0"># GH#13905</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">index </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s4">&quot;2016-06-28 05:30&quot;</span><span class="s3">, </span><span class="s4">&quot;2016-06-28 05:31&quot;</span><span class="s3">], </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s1">names</span><span class="s3">[</span><span class="s5">0</span><span class="s3">]</span>
        <span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s4">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s1">seconds</span><span class="s3">=</span><span class="s5">5</span><span class="s3">)] * </span><span class="s5">2</span><span class="s3">, </span><span class="s1">index</span><span class="s3">=</span><span class="s1">index</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s1">names</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">index </span><span class="s3">+ </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s1">seconds</span><span class="s3">=</span><span class="s5">5</span><span class="s3">), </span><span class="s1">index</span><span class="s3">=</span><span class="s1">index</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s1">names</span><span class="s3">[</span><span class="s5">2</span><span class="s3">])</span>

        <span class="s0"># passing name arg isn't enough when names[2] is None</span>
        <span class="s1">expected</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">names</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]</span>
        <span class="s2">assert </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">dtype </span><span class="s3">== </span><span class="s1">index</span><span class="s3">.</span><span class="s1">dtype</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">+ </span><span class="s1">index</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">result2 </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">ser</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result2</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s1">seconds</span><span class="s3">=</span><span class="s5">5</span><span class="s3">)</span>
        <span class="s1">result3 </span><span class="s3">= </span><span class="s1">ser</span><span class="s3">.</span><span class="s1">values </span><span class="s3">+ </span><span class="s1">index</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result3</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">result4 </span><span class="s3">= </span><span class="s1">index </span><span class="s3">+ </span><span class="s1">ser</span><span class="s3">.</span><span class="s1">values</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result4</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;op&quot;</span><span class="s3">, [</span><span class="s1">operator</span><span class="s3">.</span><span class="s1">add</span><span class="s3">, </span><span class="s1">roperator</span><span class="s3">.</span><span class="s1">radd</span><span class="s3">, </span><span class="s1">operator</span><span class="s3">.</span><span class="s1">sub</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dti_addsub_offset_arraylike</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">names</span><span class="s3">, </span><span class="s1">op</span><span class="s3">, </span><span class="s1">index_or_series</span>
    <span class="s3">):</span>
        <span class="s0"># GH#18849, GH#19744</span>
        <span class="s1">other_box </span><span class="s3">= </span><span class="s1">index_or_series</span>

        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s1">names</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
        <span class="s1">other </span><span class="s3">= </span><span class="s1">other_box</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">MonthEnd</span><span class="s3">(), </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Day</span><span class="s3">(</span><span class="s1">n</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)], </span><span class="s1">name</span><span class="s3">=</span><span class="s1">names</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>

        <span class="s1">xbox </span><span class="s3">= </span><span class="s1">get_upcast_box</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">other</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
            <span class="s1">res </span><span class="s3">= </span><span class="s1">op</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">other</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">op</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">[</span><span class="s1">n</span><span class="s3">], </span><span class="s1">other</span><span class="s3">[</span><span class="s1">n</span><span class="s3">]) </span><span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">len</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">))], </span><span class="s1">name</span><span class="s3">=</span><span class="s1">names</span><span class="s3">[</span><span class="s5">2</span><span class="s3">], </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;infer&quot;</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">res</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;other_box&quot;</span><span class="s3">, [</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Index</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_dti_addsub_object_arraylike</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">, </span><span class="s1">other_box</span>
    <span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">dtarr </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">box_with_array</span><span class="s3">)</span>
        <span class="s1">other </span><span class="s3">= </span><span class="s1">other_box</span><span class="s3">([</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">MonthEnd</span><span class="s3">(), </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s1">days</span><span class="s3">=</span><span class="s5">4</span><span class="s3">)])</span>
        <span class="s1">xbox </span><span class="s3">= </span><span class="s1">get_upcast_box</span><span class="s3">(</span><span class="s1">dtarr</span><span class="s3">, </span><span class="s1">other</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s4">&quot;2017-01-31&quot;</span><span class="s3">, </span><span class="s4">&quot;2017-01-06&quot;</span><span class="s3">], </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz_naive_fixture</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">dtarr </span><span class="s3">+ </span><span class="s1">other</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s4">&quot;2016-12-31&quot;</span><span class="s3">, </span><span class="s4">&quot;2016-12-29&quot;</span><span class="s3">], </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz_naive_fixture</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">box_expected</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">xbox</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">dtarr </span><span class="s3">- </span><span class="s1">other</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;years&quot;</span><span class="s3">, [-</span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">])</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;months&quot;</span><span class="s3">, [-</span><span class="s5">2</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">])</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;unit&quot;</span><span class="s3">, [</span><span class="s4">&quot;s&quot;</span><span class="s3">, </span><span class="s4">&quot;ms&quot;</span><span class="s3">, </span><span class="s4">&quot;us&quot;</span><span class="s3">, </span><span class="s4">&quot;ns&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">test_shift_months</span><span class="s3">(</span><span class="s1">years</span><span class="s3">, </span><span class="s1">months</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
    <span class="s1">dti </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-05 00:15:00&quot;</span><span class="s3">),</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-31 00:23:00&quot;</span><span class="s3">),</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-01-01&quot;</span><span class="s3">),</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-02-29&quot;</span><span class="s3">),</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s4">&quot;2000-12-31&quot;</span><span class="s3">),</span>
        <span class="s3">]</span>
    <span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
    <span class="s1">shifted </span><span class="s3">= </span><span class="s1">shift_months</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">.</span><span class="s1">asi8</span><span class="s3">, </span><span class="s1">years </span><span class="s3">* </span><span class="s5">12 </span><span class="s3">+ </span><span class="s1">months</span><span class="s3">, </span><span class="s1">reso</span><span class="s3">=</span><span class="s1">dti</span><span class="s3">.</span><span class="s1">_data</span><span class="s3">.</span><span class="s1">_creso</span><span class="s3">)</span>
    <span class="s1">shifted_dt64 </span><span class="s3">= </span><span class="s1">shifted</span><span class="s3">.</span><span class="s1">view</span><span class="s3">(</span><span class="s4">f&quot;M8[</span><span class="s2">{</span><span class="s1">dti</span><span class="s3">.</span><span class="s1">unit</span><span class="s2">}</span><span class="s4">]&quot;</span><span class="s3">)</span>
    <span class="s1">actual </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">shifted_dt64</span><span class="s3">)</span>

    <span class="s1">raw </span><span class="s3">= [</span><span class="s1">x </span><span class="s3">+ </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">years</span><span class="s3">=</span><span class="s1">years</span><span class="s3">, </span><span class="s1">months</span><span class="s3">=</span><span class="s1">months</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">dti</span><span class="s3">]</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">raw</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">.</span><span class="s1">unit</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">actual</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_dt64arr_addsub_object_dtype_2d</span><span class="s3">():</span>
    <span class="s0"># block-wise DataFrame operations will require operating on 2D</span>
    <span class="s0">#  DatetimeArray/TimedeltaArray, so check that specifically.</span>
    <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s4">&quot;1994-02-13&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s4">&quot;2W&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">4</span><span class="s3">)</span>
    <span class="s1">dta </span><span class="s3">= </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">_data</span><span class="s3">.</span><span class="s1">reshape</span><span class="s3">((</span><span class="s5">4</span><span class="s3">, </span><span class="s5">1</span><span class="s3">))</span>

    <span class="s1">other </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([[</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Day</span><span class="s3">(</span><span class="s1">n</span><span class="s3">)] </span><span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s5">4</span><span class="s3">)])</span>
    <span class="s2">assert </span><span class="s1">other</span><span class="s3">.</span><span class="s1">shape </span><span class="s3">== </span><span class="s1">dta</span><span class="s3">.</span><span class="s1">shape</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dta </span><span class="s3">+ </span><span class="s1">other</span>
    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
        <span class="s1">expected </span><span class="s3">= (</span><span class="s1">dta</span><span class="s3">[:, </span><span class="s5">0</span><span class="s3">] + </span><span class="s1">other</span><span class="s3">[:, </span><span class="s5">0</span><span class="s3">]).</span><span class="s1">reshape</span><span class="s3">(-</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>

    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">PerformanceWarning</span><span class="s3">):</span>
        <span class="s0"># Case where we expect to get a TimedeltaArray back</span>
        <span class="s1">result2 </span><span class="s3">= </span><span class="s1">dta </span><span class="s3">- </span><span class="s1">dta</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s1">object</span><span class="s3">)</span>

    <span class="s2">assert </span><span class="s1">result2</span><span class="s3">.</span><span class="s1">shape </span><span class="s3">== (</span><span class="s5">4</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
    <span class="s2">assert </span><span class="s1">all</span><span class="s3">(</span><span class="s1">td</span><span class="s3">.</span><span class="s1">_value </span><span class="s3">== </span><span class="s5">0 </span><span class="s2">for </span><span class="s1">td </span><span class="s2">in </span><span class="s1">result2</span><span class="s3">.</span><span class="s1">ravel</span><span class="s3">())</span>


<span class="s2">def </span><span class="s1">test_non_nano_dt64_addsub_np_nat_scalars</span><span class="s3">():</span>
    <span class="s0"># GH 52295</span>
    <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s5">1233242342344</span><span class="s3">, </span><span class="s5">232432434324</span><span class="s3">, </span><span class="s5">332434242344</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ms]&quot;</span><span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">, </span><span class="s4">&quot;ms&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">] * </span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;timedelta64[ms]&quot;</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">+ </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">, </span><span class="s4">&quot;ms&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">] * </span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ms]&quot;</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_non_nano_dt64_addsub_np_nat_scalars_unitless</span><span class="s3">():</span>
    <span class="s0"># GH 52295</span>
    <span class="s0"># TODO: Can we default to the ser unit?</span>
    <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s5">1233242342344</span><span class="s3">, </span><span class="s5">232432434324</span><span class="s3">, </span><span class="s5">332434242344</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ms]&quot;</span><span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">] * </span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;timedelta64[ns]&quot;</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">+ </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">] * </span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[ns]&quot;</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">test_non_nano_dt64_addsub_np_nat_scalars_unsupported_unit</span><span class="s3">():</span>
    <span class="s0"># GH 52295</span>
    <span class="s1">ser </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s5">12332</span><span class="s3">, </span><span class="s5">23243</span><span class="s3">, </span><span class="s5">33243</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[s]&quot;</span><span class="s3">)</span>
    <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">- </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">] * </span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;timedelta64[s]&quot;</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s1">result </span><span class="s3">= </span><span class="s1">ser </span><span class="s3">+ </span><span class="s1">np</span><span class="s3">.</span><span class="s1">timedelta64</span><span class="s3">(</span><span class="s4">&quot;nat&quot;</span><span class="s3">, </span><span class="s4">&quot;D&quot;</span><span class="s3">)</span>
    <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s1">NaT</span><span class="s3">] * </span><span class="s5">3</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s4">&quot;datetime64[s]&quot;</span><span class="s3">)</span>
    <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
</pre>
</body>
</html>