<html>
<head>
<title>test_quiver.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #6aab73;}
.s5 { color: #7a7e85;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_quiver.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">platform</span>
<span class="s0">import </span><span class="s1">sys</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>


<span class="s0">def </span><span class="s1">draw_quiver</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1</span><span class="s2">),</span>
                       <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">2 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s3">1</span><span class="s2">))</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">V </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">Y</span><span class="s2">)</span>

    <span class="s1">Q </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">Q</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">platform</span><span class="s2">.</span><span class="s1">python_implementation</span><span class="s2">() != </span><span class="s4">'CPython'</span><span class="s2">,</span>
                    <span class="s1">reason</span><span class="s2">=</span><span class="s4">'Requires CPython'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_quiver_memory_leak</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">Q </span><span class="s2">= </span><span class="s1">draw_quiver</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">ttX </span><span class="s2">= </span><span class="s1">Q</span><span class="s2">.</span><span class="s1">X</span>
    <span class="s1">Q</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>

    <span class="s0">del </span><span class="s1">Q</span>

    <span class="s0">assert </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">getrefcount</span><span class="s2">(</span><span class="s1">ttX</span><span class="s2">) == </span><span class="s3">2</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skipif</span><span class="s2">(</span><span class="s1">platform</span><span class="s2">.</span><span class="s1">python_implementation</span><span class="s2">() != </span><span class="s4">'CPython'</span><span class="s2">,</span>
                    <span class="s1">reason</span><span class="s2">=</span><span class="s4">'Requires CPython'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_quiver_key_memory_leak</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">Q </span><span class="s2">= </span><span class="s1">draw_quiver</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">)</span>

    <span class="s1">qk </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">Q</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.92</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s4">r'$2 \frac{m}{s}$'</span><span class="s2">,</span>
                      <span class="s1">labelpos</span><span class="s2">=</span><span class="s4">'W'</span><span class="s2">,</span>
                      <span class="s1">fontproperties</span><span class="s2">={</span><span class="s4">'weight'</span><span class="s2">: </span><span class="s4">'bold'</span><span class="s2">})</span>
    <span class="s0">assert </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">getrefcount</span><span class="s2">(</span><span class="s1">qk</span><span class="s2">) == </span><span class="s3">3</span>
    <span class="s1">qk</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">getrefcount</span><span class="s2">(</span><span class="s1">qk</span><span class="s2">) == </span><span class="s3">2</span>


<span class="s0">def </span><span class="s1">test_quiver_number_of_args</span><span class="s2">():</span>
    <span class="s1">X </span><span class="s2">= [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">TypeError</span><span class="s2">,</span>
            <span class="s1">match</span><span class="s2">=</span><span class="s4">'takes from 2 to 5 positional arguments but 1 were given'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">TypeError</span><span class="s2">,</span>
            <span class="s1">match</span><span class="s2">=</span><span class="s4">'takes from 2 to 5 positional arguments but 6 were given'</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">X</span><span class="s2">, </span><span class="s1">X</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_quiver_arg_sizes</span><span class="s2">():</span>
    <span class="s1">X2 </span><span class="s2">= [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">]</span>
    <span class="s1">X3 </span><span class="s2">= [</span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s3">3</span><span class="s2">]</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s4">'X and Y must be the same size, but '</span>
                               <span class="s4">'X.size is 2 and Y.size is 3.'</span><span class="s2">)):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X3</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s4">'Argument U has a size 3 which does not match '</span>
                               <span class="s4">'2, the number of arrow positions'</span><span class="s2">)):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X3</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s4">'Argument V has a size 3 which does not match '</span>
                               <span class="s4">'2, the number of arrow positions'</span><span class="s2">)):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X3</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span>
            <span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s4">'Argument C has a size 3 which does not match '</span>
                               <span class="s4">'2, the number of arrow positions'</span><span class="s2">)):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X2</span><span class="s2">, </span><span class="s1">X3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_no_warnings</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">15</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">10</span><span class="s2">))</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">V </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">phi </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s3">15</span><span class="s2">, </span><span class="s3">10</span><span class="s2">) - </span><span class="s3">.5</span><span class="s2">) * </span><span class="s3">150</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">angles</span><span class="s2">=</span><span class="s1">phi</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()  </span><span class="s5"># Check that no warning is emitted.</span>


<span class="s0">def </span><span class="s1">test_zero_headlength</span><span class="s2">():</span>
    <span class="s5"># Based on report by Doug McNeil:</span>
    <span class="s5"># https://discourse.matplotlib.org/t/quiver-warnings/16722</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">10</span><span class="s2">))</span>
    <span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">X</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">Y</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">headlength</span><span class="s2">=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">headaxislength</span><span class="s2">=</span><span class="s3">0</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()  </span><span class="s5"># Check that no warning is emitted.</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'quiver_animated_test_image.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_quiver_animate</span><span class="s2">():</span>
    <span class="s5"># Tests fix for #2616</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">Q </span><span class="s2">= </span><span class="s1">draw_quiver</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, </span><span class="s1">animated</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">Q</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.92</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s4">r'$2 \frac{m}{s}$'</span><span class="s2">,</span>
                 <span class="s1">labelpos</span><span class="s2">=</span><span class="s4">'W'</span><span class="s2">, </span><span class="s1">fontproperties</span><span class="s2">={</span><span class="s4">'weight'</span><span class="s2">: </span><span class="s4">'bold'</span><span class="s2">})</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'quiver_with_key_test_image.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_quiver_with_key</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s3">0.1</span><span class="s2">)</span>
    <span class="s1">Q </span><span class="s2">= </span><span class="s1">draw_quiver</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">Q</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.95</span><span class="s2">, </span><span class="s3">2</span><span class="s2">,</span>
                 <span class="s4">r'$2\, \mathrm{m}\, \mathrm{s}^{-1}$'</span><span class="s2">,</span>
                 <span class="s1">angle</span><span class="s2">=-</span><span class="s3">10</span><span class="s2">,</span>
                 <span class="s1">coordinates</span><span class="s2">=</span><span class="s4">'figure'</span><span class="s2">,</span>
                 <span class="s1">labelpos</span><span class="s2">=</span><span class="s4">'W'</span><span class="s2">,</span>
                 <span class="s1">fontproperties</span><span class="s2">={</span><span class="s4">'weight'</span><span class="s2">: </span><span class="s4">'bold'</span><span class="s2">, </span><span class="s4">'size'</span><span class="s2">: </span><span class="s4">'large'</span><span class="s2">})</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'quiver_single_test_image.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_quiver_single</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">margins</span><span class="s2">(</span><span class="s3">0.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">([</span><span class="s3">1</span><span class="s2">], [</span><span class="s3">1</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">], [</span><span class="s3">2</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_quiver_copy</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">uv </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">u</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">1.1</span><span class="s2">]), </span><span class="s1">v</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">2.0</span><span class="s2">]))</span>
    <span class="s1">q0 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">([</span><span class="s3">1</span><span class="s2">], [</span><span class="s3">1</span><span class="s2">], </span><span class="s1">uv</span><span class="s2">[</span><span class="s4">'u'</span><span class="s2">], </span><span class="s1">uv</span><span class="s2">[</span><span class="s4">'v'</span><span class="s2">])</span>
    <span class="s1">uv</span><span class="s2">[</span><span class="s4">'v'</span><span class="s2">][</span><span class="s3">0</span><span class="s2">] = </span><span class="s3">0</span>
    <span class="s0">assert </span><span class="s1">q0</span><span class="s2">.</span><span class="s1">V</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] == </span><span class="s3">2.0</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'quiver_key_pivot.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_quiver_key_pivot</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">u</span><span class="s2">, </span><span class="s1">v </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">mgrid</span><span class="s2">[</span><span class="s3">0</span><span class="s2">:</span><span class="s3">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">:</span><span class="s3">10j</span><span class="s2">, </span><span class="s3">0</span><span class="s2">:</span><span class="s3">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">:</span><span class="s3">10j</span><span class="s2">]</span>

    <span class="s1">q </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">u</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">v</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s3">2</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s4">'N'</span><span class="s2">, </span><span class="s1">labelpos</span><span class="s2">=</span><span class="s4">'N'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s4">'E'</span><span class="s2">, </span><span class="s1">labelpos</span><span class="s2">=</span><span class="s4">'E'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s4">'S'</span><span class="s2">, </span><span class="s1">labelpos</span><span class="s2">=</span><span class="s4">'S'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s4">'W'</span><span class="s2">, </span><span class="s1">labelpos</span><span class="s2">=</span><span class="s4">'W'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'quiver_key_xy.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_quiver_key_xy</span><span class="s2">():</span>
    <span class="s5"># With scale_units='xy', ensure quiverkey still matches its quiver.</span>
    <span class="s5"># Note that the quiver and quiverkey lengths depend on the axes aspect</span>
    <span class="s5"># ratio, and that with angles='xy' their angles also depend on the axes</span>
    <span class="s5"># aspect ratio.</span>
    <span class="s1">X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">8</span><span class="s2">)</span>
    <span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s3">8</span><span class="s2">)</span>
    <span class="s1">angles </span><span class="s2">= </span><span class="s1">X </span><span class="s2">* (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s3">4</span><span class="s2">)</span>
    <span class="s1">uv </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">exp</span><span class="s2">(</span><span class="s3">1j </span><span class="s2">* </span><span class="s1">angles</span><span class="s2">)</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">uv</span><span class="s2">.</span><span class="s1">real</span>
    <span class="s1">V </span><span class="s2">= </span><span class="s1">uv</span><span class="s2">.</span><span class="s1">imag</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s3">2</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">angle_str </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">, (</span><span class="s4">'uv'</span><span class="s2">, </span><span class="s4">'xy'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">8</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s3">0.2</span><span class="s2">, </span><span class="s3">0.2</span><span class="s2">)</span>
        <span class="s1">q </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">pivot</span><span class="s2">=</span><span class="s4">'middle'</span><span class="s2">,</span>
                      <span class="s1">units</span><span class="s2">=</span><span class="s4">'xy'</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s3">0.05</span><span class="s2">,</span>
                      <span class="s1">scale</span><span class="s2">=</span><span class="s3">2</span><span class="s2">, </span><span class="s1">scale_units</span><span class="s2">=</span><span class="s4">'xy'</span><span class="s2">,</span>
                      <span class="s1">angles</span><span class="s2">=</span><span class="s1">angle_str</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">angle </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">((</span><span class="s3">0.2</span><span class="s2">, </span><span class="s3">0.5</span><span class="s2">, </span><span class="s3">0.8</span><span class="s2">), (</span><span class="s3">0</span><span class="s2">, </span><span class="s3">45</span><span class="s2">, </span><span class="s3">90</span><span class="s2">)):</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s1">X</span><span class="s2">=</span><span class="s1">x</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">=</span><span class="s3">0.8</span><span class="s2">, </span><span class="s1">U</span><span class="s2">=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">angle</span><span class="s2">=</span><span class="s1">angle</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">''</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s4">'b'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'barbs_test_image.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_barbs</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s3">12</span><span class="s2">*</span><span class="s1">X</span><span class="s2">, </span><span class="s3">12</span><span class="s2">*</span><span class="s1">Y</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barbs</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">hypot</span><span class="s2">(</span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">), </span><span class="s1">fill_empty</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">rounding</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
             <span class="s1">sizes</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">emptybarb</span><span class="s2">=</span><span class="s3">0.25</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">0.2</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s3">0.3</span><span class="s2">),</span>
             <span class="s1">cmap</span><span class="s2">=</span><span class="s4">'viridis'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'barbs_pivot_test_image.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_barbs_pivot</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s3">12</span><span class="s2">*</span><span class="s1">X</span><span class="s2">, </span><span class="s3">12</span><span class="s2">*</span><span class="s1">Y</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barbs</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">fill_empty</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">rounding</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">pivot</span><span class="s2">=</span><span class="s3">1.7</span><span class="s2">,</span>
             <span class="s1">sizes</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">emptybarb</span><span class="s2">=</span><span class="s3">0.25</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">0.2</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s3">0.3</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s3">49</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s4">'black'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'barbs_test_flip.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_barbs_flip</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test barbs with an array for flip_barb.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s2">)</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">U</span><span class="s2">, </span><span class="s1">V </span><span class="s2">= </span><span class="s3">12</span><span class="s2">*</span><span class="s1">X</span><span class="s2">, </span><span class="s3">12</span><span class="s2">*</span><span class="s1">Y</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">barbs</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">fill_empty</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">rounding</span><span class="s2">=</span><span class="s0">False</span><span class="s2">, </span><span class="s1">pivot</span><span class="s2">=</span><span class="s3">1.7</span><span class="s2">,</span>
             <span class="s1">sizes</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">emptybarb</span><span class="s2">=</span><span class="s3">0.25</span><span class="s2">, </span><span class="s1">spacing</span><span class="s2">=</span><span class="s3">0.2</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s3">0.3</span><span class="s2">),</span>
             <span class="s1">flip_barb</span><span class="s2">=</span><span class="s1">Y </span><span class="s2">&lt; </span><span class="s3">0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_barb_copy</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">u </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">1.1</span><span class="s2">])</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">2.2</span><span class="s2">])</span>
    <span class="s1">b0 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">barbs</span><span class="s2">([</span><span class="s3">1</span><span class="s2">], [</span><span class="s3">1</span><span class="s2">], </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>
    <span class="s1">u</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] = </span><span class="s3">0</span>
    <span class="s0">assert </span><span class="s1">b0</span><span class="s2">.</span><span class="s1">u</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] == </span><span class="s3">1.1</span>
    <span class="s1">v</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] = </span><span class="s3">0</span>
    <span class="s0">assert </span><span class="s1">b0</span><span class="s2">.</span><span class="s1">v</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] == </span><span class="s3">2.2</span>


<span class="s0">def </span><span class="s1">test_bad_masked_sizes</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test error handling when given differing sized masked arrays.&quot;&quot;&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">3</span><span class="s2">)</span>
    <span class="s1">u </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s3">15. </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s3">4</span><span class="s2">,)))</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s3">15. </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">u</span><span class="s2">))</span>
    <span class="s1">u</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked</span>
    <span class="s1">v</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">barbs</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_angles_and_scale</span><span class="s2">():</span>
    <span class="s5"># angles array + scale_units kwarg</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">15</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">10</span><span class="s2">))</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">V </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>
    <span class="s1">phi </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s3">15</span><span class="s2">, </span><span class="s3">10</span><span class="s2">) - </span><span class="s3">.5</span><span class="s2">) * </span><span class="s3">150</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">angles</span><span class="s2">=</span><span class="s1">phi</span><span class="s2">, </span><span class="s1">scale_units</span><span class="s2">=</span><span class="s4">'xy'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s4">'quiver_xy.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_quiver_xy</span><span class="s2">():</span>
    <span class="s5"># simple arrow pointing from SW to NE</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">subplot_kw</span><span class="s2">=</span><span class="s1">dict</span><span class="s2">(</span><span class="s1">aspect</span><span class="s2">=</span><span class="s4">'equal'</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s1">angles</span><span class="s2">=</span><span class="s4">'xy'</span><span class="s2">, </span><span class="s1">scale_units</span><span class="s2">=</span><span class="s4">'xy'</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s3">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_quiverkey_angles</span><span class="s2">():</span>
    <span class="s5"># Check that only a single arrow is plotted for a quiverkey when an array</span>
    <span class="s5"># of angles is given to the original quiver plot</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">2</span><span class="s2">))</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">V </span><span class="s2">= </span><span class="s1">angles </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>

    <span class="s1">q </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, </span><span class="s1">angles</span><span class="s2">=</span><span class="s1">angles</span><span class="s2">)</span>
    <span class="s1">qk </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s3">2</span><span class="s2">, </span><span class="s4">'Label'</span><span class="s2">)</span>
    <span class="s5"># The arrows are only created when the key is drawn</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">qk</span><span class="s2">.</span><span class="s1">verts</span><span class="s2">) == </span><span class="s3">1</span>


<span class="s0">def </span><span class="s1">test_quiverkey_angles_xy_aitoff</span><span class="s2">():</span>
    <span class="s5"># GH 26316 and GH 26748</span>
    <span class="s5"># Test that only one arrow will be plotted with non-cartesian</span>
    <span class="s5"># when angles='xy' and/or scale_units='xy'</span>

    <span class="s5"># only for test purpose</span>
    <span class="s5"># scale_units='xy' may not be a valid use case for non-cartesian</span>
    <span class="s1">kwargs_list </span><span class="s2">= [</span>
        <span class="s2">{</span><span class="s4">'angles'</span><span class="s2">: </span><span class="s4">'xy'</span><span class="s2">},</span>
        <span class="s2">{</span><span class="s4">'angles'</span><span class="s2">: </span><span class="s4">'xy'</span><span class="s2">, </span><span class="s4">'scale_units'</span><span class="s2">: </span><span class="s4">'xy'</span><span class="s2">},</span>
        <span class="s2">{</span><span class="s4">'scale_units'</span><span class="s2">: </span><span class="s4">'xy'</span><span class="s2">}</span>
    <span class="s2">]</span>

    <span class="s0">for </span><span class="s1">kwargs_dict </span><span class="s0">in </span><span class="s1">kwargs_list</span><span class="s2">:</span>

        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s3">11</span><span class="s2">)</span>
        <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) * </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi </span><span class="s2">/ </span><span class="s3">6</span>
        <span class="s1">vx </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">vy </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>

        <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
        <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s1">projection</span><span class="s2">=</span><span class="s4">'aitoff'</span><span class="s2">)</span>
        <span class="s1">q </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">vx</span><span class="s2">, </span><span class="s1">vy</span><span class="s2">, **</span><span class="s1">kwargs_dict</span><span class="s2">)</span>
        <span class="s1">qk </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s4">'1 units'</span><span class="s2">)</span>

        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">qk</span><span class="s2">.</span><span class="s1">verts</span><span class="s2">) == </span><span class="s3">1</span>


<span class="s0">def </span><span class="s1">test_quiverkey_angles_scale_units_cartesian</span><span class="s2">():</span>
    <span class="s5"># GH 26316</span>
    <span class="s5"># Test that only one arrow will be plotted with normal cartesian</span>
    <span class="s5"># when angles='xy' and/or scale_units='xy'</span>

    <span class="s1">kwargs_list </span><span class="s2">= [</span>
        <span class="s2">{</span><span class="s4">'angles'</span><span class="s2">: </span><span class="s4">'xy'</span><span class="s2">},</span>
        <span class="s2">{</span><span class="s4">'angles'</span><span class="s2">: </span><span class="s4">'xy'</span><span class="s2">, </span><span class="s4">'scale_units'</span><span class="s2">: </span><span class="s4">'xy'</span><span class="s2">},</span>
        <span class="s2">{</span><span class="s4">'scale_units'</span><span class="s2">: </span><span class="s4">'xy'</span><span class="s2">}</span>
    <span class="s2">]</span>

    <span class="s0">for </span><span class="s1">kwargs_dict </span><span class="s0">in </span><span class="s1">kwargs_list</span><span class="s2">:</span>
        <span class="s1">X </span><span class="s2">= [</span><span class="s3">0</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">]</span>
        <span class="s1">Y </span><span class="s2">= [</span><span class="s3">0</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">]</span>
        <span class="s1">U </span><span class="s2">= [</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s2">]</span>
        <span class="s1">V </span><span class="s2">= [</span><span class="s3">1</span><span class="s2">, -</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">]</span>

        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">q </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">, **</span><span class="s1">kwargs_dict</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s1">X</span><span class="s2">=</span><span class="s3">0.3</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">=</span><span class="s3">1.1</span><span class="s2">, </span><span class="s1">U</span><span class="s2">=</span><span class="s3">1</span><span class="s2">,</span>
                     <span class="s1">label</span><span class="s2">=</span><span class="s4">'Quiver key, length = 1'</span><span class="s2">, </span><span class="s1">labelpos</span><span class="s2">=</span><span class="s4">'E'</span><span class="s2">)</span>
        <span class="s1">qk </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiverkey</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">, </span><span class="s4">'1 units'</span><span class="s2">)</span>

        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">qk</span><span class="s2">.</span><span class="s1">verts</span><span class="s2">) == </span><span class="s3">1</span>


<span class="s0">def </span><span class="s1">test_quiver_setuvc_numbers</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Check that it is possible to set all arrow UVC to the same numbers&quot;&quot;&quot;</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">X</span><span class="s2">, </span><span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">meshgrid</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">2</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s3">2</span><span class="s2">))</span>
    <span class="s1">U </span><span class="s2">= </span><span class="s1">V </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones_like</span><span class="s2">(</span><span class="s1">X</span><span class="s2">)</span>

    <span class="s1">q </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">quiver</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">U</span><span class="s2">, </span><span class="s1">V</span><span class="s2">)</span>
    <span class="s1">q</span><span class="s2">.</span><span class="s1">set_UVC</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)</span>
</pre>
</body>
</html>