<html>
<head>
<title>_docscrape.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #7a7e85;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #2aacb8;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_docscrape.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Extract reference documentation from the NumPy source tree. 
 
&quot;&quot;&quot;</span>
<span class="s2"># copied from numpydoc/docscrape.py</span>
<span class="s3">import </span><span class="s1">inspect</span>
<span class="s3">import </span><span class="s1">textwrap</span>
<span class="s3">import </span><span class="s1">re</span>
<span class="s3">import </span><span class="s1">pydoc</span>
<span class="s3">from </span><span class="s1">warnings </span><span class="s3">import </span><span class="s1">warn</span>
<span class="s3">from </span><span class="s1">collections </span><span class="s3">import </span><span class="s1">namedtuple</span>
<span class="s3">from </span><span class="s1">collections</span><span class="s4">.</span><span class="s1">abc </span><span class="s3">import </span><span class="s1">Callable</span><span class="s4">, </span><span class="s1">Mapping</span>
<span class="s3">import </span><span class="s1">copy</span>
<span class="s3">import </span><span class="s1">sys</span>


<span class="s3">def </span><span class="s1">strip_blank_lines</span><span class="s4">(</span><span class="s1">l</span><span class="s4">):</span>
    <span class="s0">&quot;Remove leading and trailing blank lines from a list of lines&quot;</span>
    <span class="s3">while </span><span class="s1">l </span><span class="s3">and not </span><span class="s1">l</span><span class="s4">[</span><span class="s5">0</span><span class="s4">].</span><span class="s1">strip</span><span class="s4">():</span>
        <span class="s3">del </span><span class="s1">l</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>
    <span class="s3">while </span><span class="s1">l </span><span class="s3">and not </span><span class="s1">l</span><span class="s4">[-</span><span class="s5">1</span><span class="s4">].</span><span class="s1">strip</span><span class="s4">():</span>
        <span class="s3">del </span><span class="s1">l</span><span class="s4">[-</span><span class="s5">1</span><span class="s4">]</span>
    <span class="s3">return </span><span class="s1">l</span>


<span class="s3">class </span><span class="s1">Reader</span><span class="s4">:</span>
    <span class="s0">&quot;&quot;&quot;A line-based string reader. 
 
    &quot;&quot;&quot;</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">data</span><span class="s4">):</span>
        <span class="s0">&quot;&quot;&quot; 
        Parameters 
        ---------- 
        data : str 
           String with lines separated by '\\n'. 
 
        &quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">data</span><span class="s4">, </span><span class="s1">list</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_str </span><span class="s4">= </span><span class="s1">data</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_str </span><span class="s4">= </span><span class="s1">data</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s6">'</span><span class="s3">\n</span><span class="s6">'</span><span class="s4">)  </span><span class="s2"># store string as list of lines</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">reset</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">__getitem__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">n</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str</span><span class="s4">[</span><span class="s1">n</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">reset</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_l </span><span class="s4">= </span><span class="s5">0  </span><span class="s2"># current line nr</span>

    <span class="s3">def </span><span class="s1">read</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">eof</span><span class="s4">():</span>
            <span class="s1">out </span><span class="s4">= </span><span class="s1">self</span><span class="s4">[</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_l</span><span class="s4">]</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_l </span><span class="s4">+= </span><span class="s5">1</span>
            <span class="s3">return </span><span class="s1">out</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s6">''</span>

    <span class="s3">def </span><span class="s1">seek_next_non_empty_line</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">for </span><span class="s1">l </span><span class="s3">in </span><span class="s1">self</span><span class="s4">[</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_l</span><span class="s4">:]:</span>
            <span class="s3">if </span><span class="s1">l</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">():</span>
                <span class="s3">break</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">_l </span><span class="s4">+= </span><span class="s5">1</span>

    <span class="s3">def </span><span class="s1">eof</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_l </span><span class="s4">&gt;= </span><span class="s1">len</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">read_to_condition</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">condition_func</span><span class="s4">):</span>
        <span class="s1">start </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_l</span>
        <span class="s3">for </span><span class="s1">line </span><span class="s3">in </span><span class="s1">self</span><span class="s4">[</span><span class="s1">start</span><span class="s4">:]:</span>
            <span class="s3">if </span><span class="s1">condition_func</span><span class="s4">(</span><span class="s1">line</span><span class="s4">):</span>
                <span class="s3">return </span><span class="s1">self</span><span class="s4">[</span><span class="s1">start</span><span class="s4">:</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_l</span><span class="s4">]</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_l </span><span class="s4">+= </span><span class="s5">1</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">eof</span><span class="s4">():</span>
                <span class="s3">return </span><span class="s1">self</span><span class="s4">[</span><span class="s1">start</span><span class="s4">:</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_l</span><span class="s4">+</span><span class="s5">1</span><span class="s4">]</span>
        <span class="s3">return </span><span class="s4">[]</span>

    <span class="s3">def </span><span class="s1">read_to_next_empty_line</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">seek_next_non_empty_line</span><span class="s4">()</span>

        <span class="s3">def </span><span class="s1">is_empty</span><span class="s4">(</span><span class="s1">line</span><span class="s4">):</span>
            <span class="s3">return not </span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">()</span>

        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">read_to_condition</span><span class="s4">(</span><span class="s1">is_empty</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">read_to_next_unindented_line</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">def </span><span class="s1">is_unindented</span><span class="s4">(</span><span class="s1">line</span><span class="s4">):</span>
            <span class="s3">return </span><span class="s4">(</span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">() </span><span class="s3">and </span><span class="s4">(</span><span class="s1">len</span><span class="s4">(</span><span class="s1">line</span><span class="s4">.</span><span class="s1">lstrip</span><span class="s4">()) == </span><span class="s1">len</span><span class="s4">(</span><span class="s1">line</span><span class="s4">)))</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">read_to_condition</span><span class="s4">(</span><span class="s1">is_unindented</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">peek</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">n</span><span class="s4">=</span><span class="s5">0</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_l </span><span class="s4">+ </span><span class="s1">n </span><span class="s4">&lt; </span><span class="s1">len</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str</span><span class="s4">):</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">[</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_l </span><span class="s4">+ </span><span class="s1">n</span><span class="s4">]</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s6">''</span>

    <span class="s3">def </span><span class="s1">is_empty</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return not </span><span class="s6">''</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str</span><span class="s4">).</span><span class="s1">strip</span><span class="s4">()</span>


<span class="s3">class </span><span class="s1">ParseError</span><span class="s4">(</span><span class="s1">Exception</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__str__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">message </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">args</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>
        <span class="s3">if </span><span class="s1">hasattr</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s6">'docstring'</span><span class="s4">):</span>
            <span class="s1">message </span><span class="s4">= </span><span class="s6">f&quot;</span><span class="s3">{</span><span class="s1">message</span><span class="s3">} </span><span class="s6">in </span><span class="s3">{</span><span class="s1">self</span><span class="s4">.</span><span class="s1">docstring</span><span class="s3">!r}</span><span class="s6">&quot;</span>
        <span class="s3">return </span><span class="s1">message</span>


<span class="s1">Parameter </span><span class="s4">= </span><span class="s1">namedtuple</span><span class="s4">(</span><span class="s6">'Parameter'</span><span class="s4">, [</span><span class="s6">'name'</span><span class="s4">, </span><span class="s6">'type'</span><span class="s4">, </span><span class="s6">'desc'</span><span class="s4">])</span>


<span class="s3">class </span><span class="s1">NumpyDocString</span><span class="s4">(</span><span class="s1">Mapping</span><span class="s4">):</span>
    <span class="s0">&quot;&quot;&quot;Parses a numpydoc string to an abstract representation 
 
    Instances define a mapping from section title to structured data. 
 
    &quot;&quot;&quot;</span>

    <span class="s1">sections </span><span class="s4">= {</span>
        <span class="s6">'Signature'</span><span class="s4">: </span><span class="s6">''</span><span class="s4">,</span>
        <span class="s6">'Summary'</span><span class="s4">: [</span><span class="s6">''</span><span class="s4">],</span>
        <span class="s6">'Extended Summary'</span><span class="s4">: [],</span>
        <span class="s6">'Parameters'</span><span class="s4">: [],</span>
        <span class="s6">'Returns'</span><span class="s4">: [],</span>
        <span class="s6">'Yields'</span><span class="s4">: [],</span>
        <span class="s6">'Receives'</span><span class="s4">: [],</span>
        <span class="s6">'Raises'</span><span class="s4">: [],</span>
        <span class="s6">'Warns'</span><span class="s4">: [],</span>
        <span class="s6">'Other Parameters'</span><span class="s4">: [],</span>
        <span class="s6">'Attributes'</span><span class="s4">: [],</span>
        <span class="s6">'Methods'</span><span class="s4">: [],</span>
        <span class="s6">'See Also'</span><span class="s4">: [],</span>
        <span class="s6">'Notes'</span><span class="s4">: [],</span>
        <span class="s6">'Warnings'</span><span class="s4">: [],</span>
        <span class="s6">'References'</span><span class="s4">: </span><span class="s6">''</span><span class="s4">,</span>
        <span class="s6">'Examples'</span><span class="s4">: </span><span class="s6">''</span><span class="s4">,</span>
        <span class="s6">'index'</span><span class="s4">: {}</span>
    <span class="s4">}</span>

    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">docstring</span><span class="s4">, </span><span class="s1">config</span><span class="s4">={}):</span>
        <span class="s1">orig_docstring </span><span class="s4">= </span><span class="s1">docstring</span>
        <span class="s1">docstring </span><span class="s4">= </span><span class="s1">textwrap</span><span class="s4">.</span><span class="s1">dedent</span><span class="s4">(</span><span class="s1">docstring</span><span class="s4">).</span><span class="s1">split</span><span class="s4">(</span><span class="s6">'</span><span class="s3">\n</span><span class="s6">'</span><span class="s4">)</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">_doc </span><span class="s4">= </span><span class="s1">Reader</span><span class="s4">(</span><span class="s1">docstring</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_parsed_data </span><span class="s4">= </span><span class="s1">copy</span><span class="s4">.</span><span class="s1">deepcopy</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">sections</span><span class="s4">)</span>

        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_parse</span><span class="s4">()</span>
        <span class="s3">except </span><span class="s1">ParseError </span><span class="s3">as </span><span class="s1">e</span><span class="s4">:</span>
            <span class="s1">e</span><span class="s4">.</span><span class="s1">docstring </span><span class="s4">= </span><span class="s1">orig_docstring</span>
            <span class="s3">raise</span>

    <span class="s3">def </span><span class="s1">__getitem__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">key</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_parsed_data</span><span class="s4">[</span><span class="s1">key</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">__setitem__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">key</span><span class="s4">, </span><span class="s1">val</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">key </span><span class="s3">not in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_parsed_data</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_error_location</span><span class="s4">(</span><span class="s6">&quot;Unknown section %s&quot; </span><span class="s4">% </span><span class="s1">key</span><span class="s4">, </span><span class="s1">error</span><span class="s4">=</span><span class="s3">False</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_parsed_data</span><span class="s4">[</span><span class="s1">key</span><span class="s4">] = </span><span class="s1">val</span>

    <span class="s3">def </span><span class="s1">__iter__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">iter</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_parsed_data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">__len__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">len</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_parsed_data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">_is_at_section</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">seek_next_non_empty_line</span><span class="s4">()</span>

        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">eof</span><span class="s4">():</span>
            <span class="s3">return False</span>

        <span class="s1">l1 </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">peek</span><span class="s4">().</span><span class="s1">strip</span><span class="s4">()  </span><span class="s2"># e.g. Parameters</span>

        <span class="s3">if </span><span class="s1">l1</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">'.. index::'</span><span class="s4">):</span>
            <span class="s3">return True</span>

        <span class="s1">l2 </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">peek</span><span class="s4">(</span><span class="s5">1</span><span class="s4">).</span><span class="s1">strip</span><span class="s4">()  </span><span class="s2"># ---------- or ==========</span>
        <span class="s3">return </span><span class="s1">l2</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">'-'</span><span class="s4">*</span><span class="s1">len</span><span class="s4">(</span><span class="s1">l1</span><span class="s4">)) </span><span class="s3">or </span><span class="s1">l2</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">'='</span><span class="s4">*</span><span class="s1">len</span><span class="s4">(</span><span class="s1">l1</span><span class="s4">))</span>

    <span class="s3">def </span><span class="s1">_strip</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">doc</span><span class="s4">):</span>
        <span class="s1">i </span><span class="s4">= </span><span class="s5">0</span>
        <span class="s1">j </span><span class="s4">= </span><span class="s5">0</span>
        <span class="s3">for </span><span class="s1">i</span><span class="s4">, </span><span class="s1">line </span><span class="s3">in </span><span class="s1">enumerate</span><span class="s4">(</span><span class="s1">doc</span><span class="s4">):</span>
            <span class="s3">if </span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">():</span>
                <span class="s3">break</span>

        <span class="s3">for </span><span class="s1">j</span><span class="s4">, </span><span class="s1">line </span><span class="s3">in </span><span class="s1">enumerate</span><span class="s4">(</span><span class="s1">doc</span><span class="s4">[::-</span><span class="s5">1</span><span class="s4">]):</span>
            <span class="s3">if </span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">():</span>
                <span class="s3">break</span>

        <span class="s3">return </span><span class="s1">doc</span><span class="s4">[</span><span class="s1">i</span><span class="s4">:</span><span class="s1">len</span><span class="s4">(</span><span class="s1">doc</span><span class="s4">)-</span><span class="s1">j</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">_read_to_next_section</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">section </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">read_to_next_empty_line</span><span class="s4">()</span>

        <span class="s3">while not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_is_at_section</span><span class="s4">() </span><span class="s3">and not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">eof</span><span class="s4">():</span>
            <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">peek</span><span class="s4">(-</span><span class="s5">1</span><span class="s4">).</span><span class="s1">strip</span><span class="s4">():  </span><span class="s2"># previous line was empty</span>
                <span class="s1">section </span><span class="s4">+= [</span><span class="s6">''</span><span class="s4">]</span>

            <span class="s1">section </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">read_to_next_empty_line</span><span class="s4">()</span>

        <span class="s3">return </span><span class="s1">section</span>

    <span class="s3">def </span><span class="s1">_read_sections</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">while not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">eof</span><span class="s4">():</span>
            <span class="s1">data </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_read_to_next_section</span><span class="s4">()</span>
            <span class="s1">name </span><span class="s4">= </span><span class="s1">data</span><span class="s4">[</span><span class="s5">0</span><span class="s4">].</span><span class="s1">strip</span><span class="s4">()</span>

            <span class="s3">if </span><span class="s1">name</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">'..'</span><span class="s4">):  </span><span class="s2"># index section</span>
                <span class="s3">yield </span><span class="s1">name</span><span class="s4">, </span><span class="s1">data</span><span class="s4">[</span><span class="s5">1</span><span class="s4">:]</span>
            <span class="s3">elif </span><span class="s1">len</span><span class="s4">(</span><span class="s1">data</span><span class="s4">) &lt; </span><span class="s5">2</span><span class="s4">:</span>
                <span class="s3">yield </span><span class="s1">StopIteration</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s3">yield </span><span class="s1">name</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_strip</span><span class="s4">(</span><span class="s1">data</span><span class="s4">[</span><span class="s5">2</span><span class="s4">:])</span>

    <span class="s3">def </span><span class="s1">_parse_param_list</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">content</span><span class="s4">, </span><span class="s1">single_element_is_type</span><span class="s4">=</span><span class="s3">False</span><span class="s4">):</span>
        <span class="s1">r </span><span class="s4">= </span><span class="s1">Reader</span><span class="s4">(</span><span class="s1">content</span><span class="s4">)</span>
        <span class="s1">params </span><span class="s4">= []</span>
        <span class="s3">while not </span><span class="s1">r</span><span class="s4">.</span><span class="s1">eof</span><span class="s4">():</span>
            <span class="s1">header </span><span class="s4">= </span><span class="s1">r</span><span class="s4">.</span><span class="s1">read</span><span class="s4">().</span><span class="s1">strip</span><span class="s4">()</span>
            <span class="s3">if </span><span class="s6">' : ' </span><span class="s3">in </span><span class="s1">header</span><span class="s4">:</span>
                <span class="s1">arg_name</span><span class="s4">, </span><span class="s1">arg_type </span><span class="s4">= </span><span class="s1">header</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s6">' : '</span><span class="s4">)[:</span><span class="s5">2</span><span class="s4">]</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s3">if </span><span class="s1">single_element_is_type</span><span class="s4">:</span>
                    <span class="s1">arg_name</span><span class="s4">, </span><span class="s1">arg_type </span><span class="s4">= </span><span class="s6">''</span><span class="s4">, </span><span class="s1">header</span>
                <span class="s3">else</span><span class="s4">:</span>
                    <span class="s1">arg_name</span><span class="s4">, </span><span class="s1">arg_type </span><span class="s4">= </span><span class="s1">header</span><span class="s4">, </span><span class="s6">''</span>

            <span class="s1">desc </span><span class="s4">= </span><span class="s1">r</span><span class="s4">.</span><span class="s1">read_to_next_unindented_line</span><span class="s4">()</span>
            <span class="s1">desc </span><span class="s4">= </span><span class="s1">dedent_lines</span><span class="s4">(</span><span class="s1">desc</span><span class="s4">)</span>
            <span class="s1">desc </span><span class="s4">= </span><span class="s1">strip_blank_lines</span><span class="s4">(</span><span class="s1">desc</span><span class="s4">)</span>

            <span class="s1">params</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">Parameter</span><span class="s4">(</span><span class="s1">arg_name</span><span class="s4">, </span><span class="s1">arg_type</span><span class="s4">, </span><span class="s1">desc</span><span class="s4">))</span>

        <span class="s3">return </span><span class="s1">params</span>

    <span class="s2"># See also supports the following formats.</span>
    <span class="s2">#</span>
    <span class="s2"># &lt;FUNCNAME&gt;</span>
    <span class="s2"># &lt;FUNCNAME&gt; SPACE* COLON SPACE+ &lt;DESC&gt; SPACE*</span>
    <span class="s2"># &lt;FUNCNAME&gt; ( COMMA SPACE+ &lt;FUNCNAME&gt;)+ (COMMA | PERIOD)? SPACE*</span>
    <span class="s2"># &lt;FUNCNAME&gt; ( COMMA SPACE+ &lt;FUNCNAME&gt;)* SPACE* COLON SPACE+ &lt;DESC&gt; SPACE*</span>

    <span class="s2"># &lt;FUNCNAME&gt; is one of</span>
    <span class="s2">#   &lt;PLAIN_FUNCNAME&gt;</span>
    <span class="s2">#   COLON &lt;ROLE&gt; COLON BACKTICK &lt;PLAIN_FUNCNAME&gt; BACKTICK</span>
    <span class="s2"># where</span>
    <span class="s2">#   &lt;PLAIN_FUNCNAME&gt; is a legal function name, and</span>
    <span class="s2">#   &lt;ROLE&gt; is any nonempty sequence of word characters.</span>
    <span class="s2"># Examples: func_f1  :meth:`func_h1` :obj:`~baz.obj_r` :class:`class_j`</span>
    <span class="s2"># &lt;DESC&gt; is a string describing the function.</span>

    <span class="s1">_role </span><span class="s4">= </span><span class="s6">r&quot;:(?P&lt;role&gt;\w+):&quot;</span>
    <span class="s1">_funcbacktick </span><span class="s4">= </span><span class="s6">r&quot;`(?P&lt;name&gt;(?:~\w+\.)?[a-zA-Z0-9_\.-]+)`&quot;</span>
    <span class="s1">_funcplain </span><span class="s4">= </span><span class="s6">r&quot;(?P&lt;name2&gt;[a-zA-Z0-9_\.-]+)&quot;</span>
    <span class="s1">_funcname </span><span class="s4">= </span><span class="s6">r&quot;(&quot; </span><span class="s4">+ </span><span class="s1">_role </span><span class="s4">+ </span><span class="s1">_funcbacktick </span><span class="s4">+ </span><span class="s6">r&quot;|&quot; </span><span class="s4">+ </span><span class="s1">_funcplain </span><span class="s4">+ </span><span class="s6">r&quot;)&quot;</span>
    <span class="s1">_funcnamenext </span><span class="s4">= </span><span class="s1">_funcname</span><span class="s4">.</span><span class="s1">replace</span><span class="s4">(</span><span class="s6">'role'</span><span class="s4">, </span><span class="s6">'rolenext'</span><span class="s4">)</span>
    <span class="s1">_funcnamenext </span><span class="s4">= </span><span class="s1">_funcnamenext</span><span class="s4">.</span><span class="s1">replace</span><span class="s4">(</span><span class="s6">'name'</span><span class="s4">, </span><span class="s6">'namenext'</span><span class="s4">)</span>
    <span class="s1">_description </span><span class="s4">= </span><span class="s6">r&quot;(?P&lt;description&gt;\s*:(\s+(?P&lt;desc&gt;\S+.*))?)?\s*$&quot;</span>
    <span class="s1">_func_rgx </span><span class="s4">= </span><span class="s1">re</span><span class="s4">.</span><span class="s1">compile</span><span class="s4">(</span><span class="s6">r&quot;^\s*&quot; </span><span class="s4">+ </span><span class="s1">_funcname </span><span class="s4">+ </span><span class="s6">r&quot;\s*&quot;</span><span class="s4">)</span>
    <span class="s1">_line_rgx </span><span class="s4">= </span><span class="s1">re</span><span class="s4">.</span><span class="s1">compile</span><span class="s4">(</span>
        <span class="s6">r&quot;^\s*&quot; </span><span class="s4">+</span>
        <span class="s6">r&quot;(?P&lt;allfuncs&gt;&quot; </span><span class="s4">+        </span><span class="s2"># group for all function names</span>
        <span class="s1">_funcname </span><span class="s4">+</span>
        <span class="s6">r&quot;(?P&lt;morefuncs&gt;([,]\s+&quot; </span><span class="s4">+ </span><span class="s1">_funcnamenext </span><span class="s4">+ </span><span class="s6">r&quot;)*)&quot; </span><span class="s4">+</span>
        <span class="s6">r&quot;)&quot; </span><span class="s4">+                     </span><span class="s2"># end of &quot;allfuncs&quot;</span>
        <span class="s2"># Some function lists have a trailing comma (or period)  '\s*'</span>
        <span class="s6">r&quot;(?P&lt;trailing&gt;[,\.])?&quot; </span><span class="s4">+</span>
        <span class="s1">_description</span><span class="s4">)</span>

    <span class="s2"># Empty &lt;DESC&gt; elements are replaced with '..'</span>
    <span class="s1">empty_description </span><span class="s4">= </span><span class="s6">'..'</span>

    <span class="s3">def </span><span class="s1">_parse_see_also</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">content</span><span class="s4">):</span>
        <span class="s0">&quot;&quot;&quot; 
        func_name : Descriptive text 
            continued text 
        another_func_name : Descriptive text 
        func_name1, func_name2, :meth:`func_name`, func_name3 
 
        &quot;&quot;&quot;</span>

        <span class="s1">items </span><span class="s4">= []</span>

        <span class="s3">def </span><span class="s1">parse_item_name</span><span class="s4">(</span><span class="s1">text</span><span class="s4">):</span>
            <span class="s0">&quot;&quot;&quot;Match ':role:`name`' or 'name'.&quot;&quot;&quot;</span>
            <span class="s1">m </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_func_rgx</span><span class="s4">.</span><span class="s1">match</span><span class="s4">(</span><span class="s1">text</span><span class="s4">)</span>
            <span class="s3">if not </span><span class="s1">m</span><span class="s4">:</span>
                <span class="s3">raise </span><span class="s1">ParseError</span><span class="s4">(</span><span class="s6">&quot;%s is not a item name&quot; </span><span class="s4">% </span><span class="s1">text</span><span class="s4">)</span>
            <span class="s1">role </span><span class="s4">= </span><span class="s1">m</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">'role'</span><span class="s4">)</span>
            <span class="s1">name </span><span class="s4">= </span><span class="s1">m</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">'name'</span><span class="s4">) </span><span class="s3">if </span><span class="s1">role </span><span class="s3">else </span><span class="s1">m</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">'name2'</span><span class="s4">)</span>
            <span class="s3">return </span><span class="s1">name</span><span class="s4">, </span><span class="s1">role</span><span class="s4">, </span><span class="s1">m</span><span class="s4">.</span><span class="s1">end</span><span class="s4">()</span>

        <span class="s1">rest </span><span class="s4">= []</span>
        <span class="s3">for </span><span class="s1">line </span><span class="s3">in </span><span class="s1">content</span><span class="s4">:</span>
            <span class="s3">if not </span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">():</span>
                <span class="s3">continue</span>

            <span class="s1">line_match </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_line_rgx</span><span class="s4">.</span><span class="s1">match</span><span class="s4">(</span><span class="s1">line</span><span class="s4">)</span>
            <span class="s1">description </span><span class="s4">= </span><span class="s3">None</span>
            <span class="s3">if </span><span class="s1">line_match</span><span class="s4">:</span>
                <span class="s1">description </span><span class="s4">= </span><span class="s1">line_match</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">'desc'</span><span class="s4">)</span>
                <span class="s3">if </span><span class="s1">line_match</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">'trailing'</span><span class="s4">) </span><span class="s3">and </span><span class="s1">description</span><span class="s4">:</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_error_location</span><span class="s4">(</span>
                        <span class="s6">'Unexpected comma or period after function list at '</span>
                        <span class="s6">'index %d of line &quot;%s&quot;' </span><span class="s4">% (</span><span class="s1">line_match</span><span class="s4">.</span><span class="s1">end</span><span class="s4">(</span><span class="s6">'trailing'</span><span class="s4">),</span>
                                                   <span class="s1">line</span><span class="s4">),</span>
                        <span class="s1">error</span><span class="s4">=</span><span class="s3">False</span><span class="s4">)</span>
            <span class="s3">if not </span><span class="s1">description </span><span class="s3">and </span><span class="s1">line</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">' '</span><span class="s4">):</span>
                <span class="s1">rest</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">())</span>
            <span class="s3">elif </span><span class="s1">line_match</span><span class="s4">:</span>
                <span class="s1">funcs </span><span class="s4">= []</span>
                <span class="s1">text </span><span class="s4">= </span><span class="s1">line_match</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">'allfuncs'</span><span class="s4">)</span>
                <span class="s3">while True</span><span class="s4">:</span>
                    <span class="s3">if not </span><span class="s1">text</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">():</span>
                        <span class="s3">break</span>
                    <span class="s1">name</span><span class="s4">, </span><span class="s1">role</span><span class="s4">, </span><span class="s1">match_end </span><span class="s4">= </span><span class="s1">parse_item_name</span><span class="s4">(</span><span class="s1">text</span><span class="s4">)</span>
                    <span class="s1">funcs</span><span class="s4">.</span><span class="s1">append</span><span class="s4">((</span><span class="s1">name</span><span class="s4">, </span><span class="s1">role</span><span class="s4">))</span>
                    <span class="s1">text </span><span class="s4">= </span><span class="s1">text</span><span class="s4">[</span><span class="s1">match_end</span><span class="s4">:].</span><span class="s1">strip</span><span class="s4">()</span>
                    <span class="s3">if </span><span class="s1">text </span><span class="s3">and </span><span class="s1">text</span><span class="s4">[</span><span class="s5">0</span><span class="s4">] == </span><span class="s6">','</span><span class="s4">:</span>
                        <span class="s1">text </span><span class="s4">= </span><span class="s1">text</span><span class="s4">[</span><span class="s5">1</span><span class="s4">:].</span><span class="s1">strip</span><span class="s4">()</span>
                <span class="s1">rest </span><span class="s4">= </span><span class="s1">list</span><span class="s4">(</span><span class="s1">filter</span><span class="s4">(</span><span class="s3">None</span><span class="s4">, [</span><span class="s1">description</span><span class="s4">]))</span>
                <span class="s1">items</span><span class="s4">.</span><span class="s1">append</span><span class="s4">((</span><span class="s1">funcs</span><span class="s4">, </span><span class="s1">rest</span><span class="s4">))</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s3">raise </span><span class="s1">ParseError</span><span class="s4">(</span><span class="s6">&quot;%s is not a item name&quot; </span><span class="s4">% </span><span class="s1">line</span><span class="s4">)</span>
        <span class="s3">return </span><span class="s1">items</span>

    <span class="s3">def </span><span class="s1">_parse_index</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">section</span><span class="s4">, </span><span class="s1">content</span><span class="s4">):</span>
        <span class="s0">&quot;&quot;&quot; 
        .. index:: default 
           :refguide: something, else, and more 
 
        &quot;&quot;&quot;</span>
        <span class="s3">def </span><span class="s1">strip_each_in</span><span class="s4">(</span><span class="s1">lst</span><span class="s4">):</span>
            <span class="s3">return </span><span class="s4">[</span><span class="s1">s</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">() </span><span class="s3">for </span><span class="s1">s </span><span class="s3">in </span><span class="s1">lst</span><span class="s4">]</span>

        <span class="s1">out </span><span class="s4">= {}</span>
        <span class="s1">section </span><span class="s4">= </span><span class="s1">section</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s6">'::'</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">section</span><span class="s4">) &gt; </span><span class="s5">1</span><span class="s4">:</span>
            <span class="s1">out</span><span class="s4">[</span><span class="s6">'default'</span><span class="s4">] = </span><span class="s1">strip_each_in</span><span class="s4">(</span><span class="s1">section</span><span class="s4">[</span><span class="s5">1</span><span class="s4">].</span><span class="s1">split</span><span class="s4">(</span><span class="s6">','</span><span class="s4">))[</span><span class="s5">0</span><span class="s4">]</span>
        <span class="s3">for </span><span class="s1">line </span><span class="s3">in </span><span class="s1">content</span><span class="s4">:</span>
            <span class="s1">line </span><span class="s4">= </span><span class="s1">line</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s6">':'</span><span class="s4">)</span>
            <span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">line</span><span class="s4">) &gt; </span><span class="s5">2</span><span class="s4">:</span>
                <span class="s1">out</span><span class="s4">[</span><span class="s1">line</span><span class="s4">[</span><span class="s5">1</span><span class="s4">]] = </span><span class="s1">strip_each_in</span><span class="s4">(</span><span class="s1">line</span><span class="s4">[</span><span class="s5">2</span><span class="s4">].</span><span class="s1">split</span><span class="s4">(</span><span class="s6">','</span><span class="s4">))</span>
        <span class="s3">return </span><span class="s1">out</span>

    <span class="s3">def </span><span class="s1">_parse_summary</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0">&quot;&quot;&quot;Grab signature (if given) and summary&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_is_at_section</span><span class="s4">():</span>
            <span class="s3">return</span>

        <span class="s2"># If several signatures present, take the last one</span>
        <span class="s3">while True</span><span class="s4">:</span>
            <span class="s1">summary </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">read_to_next_empty_line</span><span class="s4">()</span>
            <span class="s1">summary_str </span><span class="s4">= </span><span class="s6">&quot; &quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">([</span><span class="s1">s</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">() </span><span class="s3">for </span><span class="s1">s </span><span class="s3">in </span><span class="s1">summary</span><span class="s4">]).</span><span class="s1">strip</span><span class="s4">()</span>
            <span class="s1">compiled </span><span class="s4">= </span><span class="s1">re</span><span class="s4">.</span><span class="s1">compile</span><span class="s4">(</span><span class="s6">r'^([\w., ]+=)?\s*[\w\.]+\(.*\)$'</span><span class="s4">)</span>
            <span class="s3">if </span><span class="s1">compiled</span><span class="s4">.</span><span class="s1">match</span><span class="s4">(</span><span class="s1">summary_str</span><span class="s4">):</span>
                <span class="s1">self</span><span class="s4">[</span><span class="s6">'Signature'</span><span class="s4">] = </span><span class="s1">summary_str</span>
                <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_is_at_section</span><span class="s4">():</span>
                    <span class="s3">continue</span>
            <span class="s3">break</span>

        <span class="s3">if </span><span class="s1">summary </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s1">self</span><span class="s4">[</span><span class="s6">'Summary'</span><span class="s4">] = </span><span class="s1">summary</span>

        <span class="s3">if not </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_is_at_section</span><span class="s4">():</span>
            <span class="s1">self</span><span class="s4">[</span><span class="s6">'Extended Summary'</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_read_to_next_section</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">_parse</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_doc</span><span class="s4">.</span><span class="s1">reset</span><span class="s4">()</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_parse_summary</span><span class="s4">()</span>

        <span class="s1">sections </span><span class="s4">= </span><span class="s1">list</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_read_sections</span><span class="s4">())</span>
        <span class="s1">section_names </span><span class="s4">= {</span><span class="s1">section </span><span class="s3">for </span><span class="s1">section</span><span class="s4">, </span><span class="s1">content </span><span class="s3">in </span><span class="s1">sections</span><span class="s4">}</span>

        <span class="s1">has_returns </span><span class="s4">= </span><span class="s6">'Returns' </span><span class="s3">in </span><span class="s1">section_names</span>
        <span class="s1">has_yields </span><span class="s4">= </span><span class="s6">'Yields' </span><span class="s3">in </span><span class="s1">section_names</span>
        <span class="s2"># We could do more tests, but we are not. Arbitrarily.</span>
        <span class="s3">if </span><span class="s1">has_returns </span><span class="s3">and </span><span class="s1">has_yields</span><span class="s4">:</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">'Docstring contains both a Returns and Yields section.'</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>
        <span class="s3">if not </span><span class="s1">has_yields </span><span class="s3">and </span><span class="s6">'Receives' </span><span class="s3">in </span><span class="s1">section_names</span><span class="s4">:</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s6">'Docstring contains a Receives section but not Yields.'</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>

        <span class="s3">for </span><span class="s4">(</span><span class="s1">section</span><span class="s4">, </span><span class="s1">content</span><span class="s4">) </span><span class="s3">in </span><span class="s1">sections</span><span class="s4">:</span>
            <span class="s3">if not </span><span class="s1">section</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">'..'</span><span class="s4">):</span>
                <span class="s1">section </span><span class="s4">= (</span><span class="s1">s</span><span class="s4">.</span><span class="s1">capitalize</span><span class="s4">() </span><span class="s3">for </span><span class="s1">s </span><span class="s3">in </span><span class="s1">section</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s6">' '</span><span class="s4">))</span>
                <span class="s1">section </span><span class="s4">= </span><span class="s6">' '</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">section</span><span class="s4">)</span>
                <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s1">section</span><span class="s4">):</span>
                    <span class="s1">self</span><span class="s4">.</span><span class="s1">_error_location</span><span class="s4">(</span><span class="s6">&quot;The section %s appears twice&quot;</span>
                                         <span class="s4">% </span><span class="s1">section</span><span class="s4">)</span>

            <span class="s3">if </span><span class="s1">section </span><span class="s3">in </span><span class="s4">(</span><span class="s6">'Parameters'</span><span class="s4">, </span><span class="s6">'Other Parameters'</span><span class="s4">, </span><span class="s6">'Attributes'</span><span class="s4">,</span>
                           <span class="s6">'Methods'</span><span class="s4">):</span>
                <span class="s1">self</span><span class="s4">[</span><span class="s1">section</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_parse_param_list</span><span class="s4">(</span><span class="s1">content</span><span class="s4">)</span>
            <span class="s3">elif </span><span class="s1">section </span><span class="s3">in </span><span class="s4">(</span><span class="s6">'Returns'</span><span class="s4">, </span><span class="s6">'Yields'</span><span class="s4">, </span><span class="s6">'Raises'</span><span class="s4">, </span><span class="s6">'Warns'</span><span class="s4">,</span>
                             <span class="s6">'Receives'</span><span class="s4">):</span>
                <span class="s1">self</span><span class="s4">[</span><span class="s1">section</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_parse_param_list</span><span class="s4">(</span>
                    <span class="s1">content</span><span class="s4">, </span><span class="s1">single_element_is_type</span><span class="s4">=</span><span class="s3">True</span><span class="s4">)</span>
            <span class="s3">elif </span><span class="s1">section</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">'.. index::'</span><span class="s4">):</span>
                <span class="s1">self</span><span class="s4">[</span><span class="s6">'index'</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_parse_index</span><span class="s4">(</span><span class="s1">section</span><span class="s4">, </span><span class="s1">content</span><span class="s4">)</span>
            <span class="s3">elif </span><span class="s1">section </span><span class="s4">== </span><span class="s6">'See Also'</span><span class="s4">:</span>
                <span class="s1">self</span><span class="s4">[</span><span class="s6">'See Also'</span><span class="s4">] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_parse_see_also</span><span class="s4">(</span><span class="s1">content</span><span class="s4">)</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s1">self</span><span class="s4">[</span><span class="s1">section</span><span class="s4">] = </span><span class="s1">content</span>

    <span class="s3">def </span><span class="s1">_error_location</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">msg</span><span class="s4">, </span><span class="s1">error</span><span class="s4">=</span><span class="s3">True</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">hasattr</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s6">'_obj'</span><span class="s4">):</span>
            <span class="s2"># we know where the docs came from:</span>
            <span class="s3">try</span><span class="s4">:</span>
                <span class="s1">filename </span><span class="s4">= </span><span class="s1">inspect</span><span class="s4">.</span><span class="s1">getsourcefile</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_obj</span><span class="s4">)</span>
            <span class="s3">except </span><span class="s1">TypeError</span><span class="s4">:</span>
                <span class="s1">filename </span><span class="s4">= </span><span class="s3">None</span>
            <span class="s1">msg </span><span class="s4">= </span><span class="s1">msg </span><span class="s4">+ (</span><span class="s6">f&quot; in the docstring of </span><span class="s3">{</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_obj</span><span class="s3">} </span><span class="s6">in </span><span class="s3">{</span><span class="s1">filename</span><span class="s3">}</span><span class="s6">.&quot;</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">error</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">warn</span><span class="s4">(</span><span class="s1">msg</span><span class="s4">, </span><span class="s1">stacklevel</span><span class="s4">=</span><span class="s5">3</span><span class="s4">)</span>

    <span class="s2"># string conversion routines</span>

    <span class="s3">def </span><span class="s1">_str_header</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">name</span><span class="s4">, </span><span class="s1">symbol</span><span class="s4">=</span><span class="s6">'-'</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s4">[</span><span class="s1">name</span><span class="s4">, </span><span class="s1">len</span><span class="s4">(</span><span class="s1">name</span><span class="s4">)*</span><span class="s1">symbol</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">_str_indent</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">doc</span><span class="s4">, </span><span class="s1">indent</span><span class="s4">=</span><span class="s5">4</span><span class="s4">):</span>
        <span class="s1">out </span><span class="s4">= []</span>
        <span class="s3">for </span><span class="s1">line </span><span class="s3">in </span><span class="s1">doc</span><span class="s4">:</span>
            <span class="s1">out </span><span class="s4">+= [</span><span class="s6">' '</span><span class="s4">*</span><span class="s1">indent </span><span class="s4">+ </span><span class="s1">line</span><span class="s4">]</span>
        <span class="s3">return </span><span class="s1">out</span>

    <span class="s3">def </span><span class="s1">_str_signature</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">[</span><span class="s6">'Signature'</span><span class="s4">]:</span>
            <span class="s3">return </span><span class="s4">[</span><span class="s1">self</span><span class="s4">[</span><span class="s6">'Signature'</span><span class="s4">].</span><span class="s1">replace</span><span class="s4">(</span><span class="s6">'*'</span><span class="s4">, </span><span class="s6">r'\*'</span><span class="s4">)] + [</span><span class="s6">''</span><span class="s4">]</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s4">[</span><span class="s6">''</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">_str_summary</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">[</span><span class="s6">'Summary'</span><span class="s4">]:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">[</span><span class="s6">'Summary'</span><span class="s4">] + [</span><span class="s6">''</span><span class="s4">]</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s4">[]</span>

    <span class="s3">def </span><span class="s1">_str_extended_summary</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">[</span><span class="s6">'Extended Summary'</span><span class="s4">]:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">[</span><span class="s6">'Extended Summary'</span><span class="s4">] + [</span><span class="s6">''</span><span class="s4">]</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s4">[]</span>

    <span class="s3">def </span><span class="s1">_str_param_list</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">name</span><span class="s4">):</span>
        <span class="s1">out </span><span class="s4">= []</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">[</span><span class="s1">name</span><span class="s4">]:</span>
            <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_header</span><span class="s4">(</span><span class="s1">name</span><span class="s4">)</span>
            <span class="s3">for </span><span class="s1">param </span><span class="s3">in </span><span class="s1">self</span><span class="s4">[</span><span class="s1">name</span><span class="s4">]:</span>
                <span class="s1">parts </span><span class="s4">= []</span>
                <span class="s3">if </span><span class="s1">param</span><span class="s4">.</span><span class="s1">name</span><span class="s4">:</span>
                    <span class="s1">parts</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">param</span><span class="s4">.</span><span class="s1">name</span><span class="s4">)</span>
                <span class="s3">if </span><span class="s1">param</span><span class="s4">.</span><span class="s1">type</span><span class="s4">:</span>
                    <span class="s1">parts</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">param</span><span class="s4">.</span><span class="s1">type</span><span class="s4">)</span>
                <span class="s1">out </span><span class="s4">+= [</span><span class="s6">' : '</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">parts</span><span class="s4">)]</span>
                <span class="s3">if </span><span class="s1">param</span><span class="s4">.</span><span class="s1">desc </span><span class="s3">and </span><span class="s6">''</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">param</span><span class="s4">.</span><span class="s1">desc</span><span class="s4">).</span><span class="s1">strip</span><span class="s4">():</span>
                    <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_indent</span><span class="s4">(</span><span class="s1">param</span><span class="s4">.</span><span class="s1">desc</span><span class="s4">)</span>
            <span class="s1">out </span><span class="s4">+= [</span><span class="s6">''</span><span class="s4">]</span>
        <span class="s3">return </span><span class="s1">out</span>

    <span class="s3">def </span><span class="s1">_str_section</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">name</span><span class="s4">):</span>
        <span class="s1">out </span><span class="s4">= []</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">[</span><span class="s1">name</span><span class="s4">]:</span>
            <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_header</span><span class="s4">(</span><span class="s1">name</span><span class="s4">)</span>
            <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">[</span><span class="s1">name</span><span class="s4">]</span>
            <span class="s1">out </span><span class="s4">+= [</span><span class="s6">''</span><span class="s4">]</span>
        <span class="s3">return </span><span class="s1">out</span>

    <span class="s3">def </span><span class="s1">_str_see_also</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">func_role</span><span class="s4">):</span>
        <span class="s3">if not </span><span class="s1">self</span><span class="s4">[</span><span class="s6">'See Also'</span><span class="s4">]:</span>
            <span class="s3">return </span><span class="s4">[]</span>
        <span class="s1">out </span><span class="s4">= []</span>
        <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_header</span><span class="s4">(</span><span class="s6">&quot;See Also&quot;</span><span class="s4">)</span>
        <span class="s1">out </span><span class="s4">+= [</span><span class="s6">''</span><span class="s4">]</span>
        <span class="s1">last_had_desc </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s3">for </span><span class="s1">funcs</span><span class="s4">, </span><span class="s1">desc </span><span class="s3">in </span><span class="s1">self</span><span class="s4">[</span><span class="s6">'See Also'</span><span class="s4">]:</span>
            <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">funcs</span><span class="s4">, </span><span class="s1">list</span><span class="s4">)</span>
            <span class="s1">links </span><span class="s4">= []</span>
            <span class="s3">for </span><span class="s1">func</span><span class="s4">, </span><span class="s1">role </span><span class="s3">in </span><span class="s1">funcs</span><span class="s4">:</span>
                <span class="s3">if </span><span class="s1">role</span><span class="s4">:</span>
                    <span class="s1">link </span><span class="s4">= </span><span class="s6">f':</span><span class="s3">{</span><span class="s1">role</span><span class="s3">}</span><span class="s6">:`</span><span class="s3">{</span><span class="s1">func</span><span class="s3">}</span><span class="s6">`'</span>
                <span class="s3">elif </span><span class="s1">func_role</span><span class="s4">:</span>
                    <span class="s1">link </span><span class="s4">= </span><span class="s6">f':</span><span class="s3">{</span><span class="s1">func_role</span><span class="s3">}</span><span class="s6">:`</span><span class="s3">{</span><span class="s1">func</span><span class="s3">}</span><span class="s6">`'</span>
                <span class="s3">else</span><span class="s4">:</span>
                    <span class="s1">link </span><span class="s4">= </span><span class="s6">&quot;`%s`_&quot; </span><span class="s4">% </span><span class="s1">func</span>
                <span class="s1">links</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">link</span><span class="s4">)</span>
            <span class="s1">link </span><span class="s4">= </span><span class="s6">', '</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">links</span><span class="s4">)</span>
            <span class="s1">out </span><span class="s4">+= [</span><span class="s1">link</span><span class="s4">]</span>
            <span class="s3">if </span><span class="s1">desc</span><span class="s4">:</span>
                <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_indent</span><span class="s4">([</span><span class="s6">' '</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">desc</span><span class="s4">)])</span>
                <span class="s1">last_had_desc </span><span class="s4">= </span><span class="s3">True</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s1">last_had_desc </span><span class="s4">= </span><span class="s3">False</span>
                <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_indent</span><span class="s4">([</span><span class="s1">self</span><span class="s4">.</span><span class="s1">empty_description</span><span class="s4">])</span>

        <span class="s3">if </span><span class="s1">last_had_desc</span><span class="s4">:</span>
            <span class="s1">out </span><span class="s4">+= [</span><span class="s6">''</span><span class="s4">]</span>
        <span class="s1">out </span><span class="s4">+= [</span><span class="s6">''</span><span class="s4">]</span>
        <span class="s3">return </span><span class="s1">out</span>

    <span class="s3">def </span><span class="s1">_str_index</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">idx </span><span class="s4">= </span><span class="s1">self</span><span class="s4">[</span><span class="s6">'index'</span><span class="s4">]</span>
        <span class="s1">out </span><span class="s4">= []</span>
        <span class="s1">output_index </span><span class="s4">= </span><span class="s3">False</span>
        <span class="s1">default_index </span><span class="s4">= </span><span class="s1">idx</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s6">'default'</span><span class="s4">, </span><span class="s6">''</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">default_index</span><span class="s4">:</span>
            <span class="s1">output_index </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s1">out </span><span class="s4">+= [</span><span class="s6">'.. index:: %s' </span><span class="s4">% </span><span class="s1">default_index</span><span class="s4">]</span>
        <span class="s3">for </span><span class="s1">section</span><span class="s4">, </span><span class="s1">references </span><span class="s3">in </span><span class="s1">idx</span><span class="s4">.</span><span class="s1">items</span><span class="s4">():</span>
            <span class="s3">if </span><span class="s1">section </span><span class="s4">== </span><span class="s6">'default'</span><span class="s4">:</span>
                <span class="s3">continue</span>
            <span class="s1">output_index </span><span class="s4">= </span><span class="s3">True</span>
            <span class="s1">out </span><span class="s4">+= [</span><span class="s6">'   :{}: {}'</span><span class="s4">.</span><span class="s1">format</span><span class="s4">(</span><span class="s1">section</span><span class="s4">, </span><span class="s6">', '</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">references</span><span class="s4">))]</span>
        <span class="s3">if </span><span class="s1">output_index</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">out</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s6">''</span>

    <span class="s3">def </span><span class="s1">__str__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">func_role</span><span class="s4">=</span><span class="s6">''</span><span class="s4">):</span>
        <span class="s1">out </span><span class="s4">= []</span>
        <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_signature</span><span class="s4">()</span>
        <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_summary</span><span class="s4">()</span>
        <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_extended_summary</span><span class="s4">()</span>
        <span class="s3">for </span><span class="s1">param_list </span><span class="s3">in </span><span class="s4">(</span><span class="s6">'Parameters'</span><span class="s4">, </span><span class="s6">'Returns'</span><span class="s4">, </span><span class="s6">'Yields'</span><span class="s4">, </span><span class="s6">'Receives'</span><span class="s4">,</span>
                           <span class="s6">'Other Parameters'</span><span class="s4">, </span><span class="s6">'Raises'</span><span class="s4">, </span><span class="s6">'Warns'</span><span class="s4">):</span>
            <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_param_list</span><span class="s4">(</span><span class="s1">param_list</span><span class="s4">)</span>
        <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_section</span><span class="s4">(</span><span class="s6">'Warnings'</span><span class="s4">)</span>
        <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_see_also</span><span class="s4">(</span><span class="s1">func_role</span><span class="s4">)</span>
        <span class="s3">for </span><span class="s1">s </span><span class="s3">in </span><span class="s4">(</span><span class="s6">'Notes'</span><span class="s4">, </span><span class="s6">'References'</span><span class="s4">, </span><span class="s6">'Examples'</span><span class="s4">):</span>
            <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_section</span><span class="s4">(</span><span class="s1">s</span><span class="s4">)</span>
        <span class="s3">for </span><span class="s1">param_list </span><span class="s3">in </span><span class="s4">(</span><span class="s6">'Attributes'</span><span class="s4">, </span><span class="s6">'Methods'</span><span class="s4">):</span>
            <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_param_list</span><span class="s4">(</span><span class="s1">param_list</span><span class="s4">)</span>
        <span class="s1">out </span><span class="s4">+= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_str_index</span><span class="s4">()</span>
        <span class="s3">return </span><span class="s6">'</span><span class="s3">\n</span><span class="s6">'</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">out</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">indent</span><span class="s4">(</span><span class="s1">str</span><span class="s4">, </span><span class="s1">indent</span><span class="s4">=</span><span class="s5">4</span><span class="s4">):</span>
    <span class="s1">indent_str </span><span class="s4">= </span><span class="s6">' '</span><span class="s4">*</span><span class="s1">indent</span>
    <span class="s3">if </span><span class="s1">str </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">return </span><span class="s1">indent_str</span>
    <span class="s1">lines </span><span class="s4">= </span><span class="s1">str</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s6">'</span><span class="s3">\n</span><span class="s6">'</span><span class="s4">)</span>
    <span class="s3">return </span><span class="s6">'</span><span class="s3">\n</span><span class="s6">'</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">indent_str </span><span class="s4">+ </span><span class="s1">l </span><span class="s3">for </span><span class="s1">l </span><span class="s3">in </span><span class="s1">lines</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">dedent_lines</span><span class="s4">(</span><span class="s1">lines</span><span class="s4">):</span>
    <span class="s0">&quot;&quot;&quot;Deindent a list of lines maximally&quot;&quot;&quot;</span>
    <span class="s3">return </span><span class="s1">textwrap</span><span class="s4">.</span><span class="s1">dedent</span><span class="s4">(</span><span class="s6">&quot;</span><span class="s3">\n</span><span class="s6">&quot;</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">lines</span><span class="s4">)).</span><span class="s1">split</span><span class="s4">(</span><span class="s6">&quot;</span><span class="s3">\n</span><span class="s6">&quot;</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">header</span><span class="s4">(</span><span class="s1">text</span><span class="s4">, </span><span class="s1">style</span><span class="s4">=</span><span class="s6">'-'</span><span class="s4">):</span>
    <span class="s3">return </span><span class="s1">text </span><span class="s4">+ </span><span class="s6">'</span><span class="s3">\n</span><span class="s6">' </span><span class="s4">+ </span><span class="s1">style</span><span class="s4">*</span><span class="s1">len</span><span class="s4">(</span><span class="s1">text</span><span class="s4">) + </span><span class="s6">'</span><span class="s3">\n</span><span class="s6">'</span>


<span class="s3">class </span><span class="s1">FunctionDoc</span><span class="s4">(</span><span class="s1">NumpyDocString</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">func</span><span class="s4">, </span><span class="s1">role</span><span class="s4">=</span><span class="s6">'func'</span><span class="s4">, </span><span class="s1">doc</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">config</span><span class="s4">={}):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_f </span><span class="s4">= </span><span class="s1">func</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_role </span><span class="s4">= </span><span class="s1">role  </span><span class="s2"># e.g. &quot;func&quot; or &quot;meth&quot;</span>

        <span class="s3">if </span><span class="s1">doc </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">func </span><span class="s3">is None</span><span class="s4">:</span>
                <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">&quot;No function or docstring given&quot;</span><span class="s4">)</span>
            <span class="s1">doc </span><span class="s4">= </span><span class="s1">inspect</span><span class="s4">.</span><span class="s1">getdoc</span><span class="s4">(</span><span class="s1">func</span><span class="s4">) </span><span class="s3">or </span><span class="s6">''</span>
        <span class="s1">NumpyDocString</span><span class="s4">.</span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">doc</span><span class="s4">, </span><span class="s1">config</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">get_func</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">func_name </span><span class="s4">= </span><span class="s1">getattr</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_f</span><span class="s4">, </span><span class="s6">'__name__'</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">__class__</span><span class="s4">.</span><span class="s1">__name__</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">inspect</span><span class="s4">.</span><span class="s1">isclass</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_f</span><span class="s4">):</span>
            <span class="s1">func </span><span class="s4">= </span><span class="s1">getattr</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_f</span><span class="s4">, </span><span class="s6">'__call__'</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_f</span><span class="s4">.</span><span class="s1">__init__</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">func </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_f</span>
        <span class="s3">return </span><span class="s1">func</span><span class="s4">, </span><span class="s1">func_name</span>

    <span class="s3">def </span><span class="s1">__str__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">out </span><span class="s4">= </span><span class="s6">''</span>

        <span class="s1">func</span><span class="s4">, </span><span class="s1">func_name </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">get_func</span><span class="s4">()</span>

        <span class="s1">roles </span><span class="s4">= {</span><span class="s6">'func'</span><span class="s4">: </span><span class="s6">'function'</span><span class="s4">,</span>
                 <span class="s6">'meth'</span><span class="s4">: </span><span class="s6">'method'</span><span class="s4">}</span>

        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_role</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_role </span><span class="s3">not in </span><span class="s1">roles</span><span class="s4">:</span>
                <span class="s1">print</span><span class="s4">(</span><span class="s6">&quot;Warning: invalid role %s&quot; </span><span class="s4">% </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_role</span><span class="s4">)</span>
            <span class="s1">out </span><span class="s4">+= </span><span class="s6">'.. {}:: {}</span><span class="s3">\n    \n\n</span><span class="s6">'</span><span class="s4">.</span><span class="s1">format</span><span class="s4">(</span><span class="s1">roles</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_role</span><span class="s4">, </span><span class="s6">''</span><span class="s4">),</span>
                                             <span class="s1">func_name</span><span class="s4">)</span>

        <span class="s1">out </span><span class="s4">+= </span><span class="s1">super</span><span class="s4">().</span><span class="s1">__str__</span><span class="s4">(</span><span class="s1">func_role</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_role</span><span class="s4">)</span>
        <span class="s3">return </span><span class="s1">out</span>


<span class="s3">class </span><span class="s1">ClassDoc</span><span class="s4">(</span><span class="s1">NumpyDocString</span><span class="s4">):</span>

    <span class="s1">extra_public_methods </span><span class="s4">= [</span><span class="s6">'__call__'</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">cls</span><span class="s4">, </span><span class="s1">doc</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">modulename</span><span class="s4">=</span><span class="s6">''</span><span class="s4">, </span><span class="s1">func_doc</span><span class="s4">=</span><span class="s1">FunctionDoc</span><span class="s4">,</span>
                 <span class="s1">config</span><span class="s4">={}):</span>
        <span class="s3">if not </span><span class="s1">inspect</span><span class="s4">.</span><span class="s1">isclass</span><span class="s4">(</span><span class="s1">cls</span><span class="s4">) </span><span class="s3">and </span><span class="s1">cls </span><span class="s3">is not None</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">&quot;Expected a class or None, but got %r&quot; </span><span class="s4">% </span><span class="s1">cls</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_cls </span><span class="s4">= </span><span class="s1">cls</span>

        <span class="s3">if </span><span class="s6">'sphinx' </span><span class="s3">in </span><span class="s1">sys</span><span class="s4">.</span><span class="s1">modules</span><span class="s4">:</span>
            <span class="s3">from </span><span class="s1">sphinx</span><span class="s4">.</span><span class="s1">ext</span><span class="s4">.</span><span class="s1">autodoc </span><span class="s3">import </span><span class="s1">ALL</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s1">ALL </span><span class="s4">= </span><span class="s1">object</span><span class="s4">()</span>

        <span class="s1">self</span><span class="s4">.</span><span class="s1">show_inherited_members </span><span class="s4">= </span><span class="s1">config</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
                    <span class="s6">'show_inherited_class_members'</span><span class="s4">, </span><span class="s3">True</span><span class="s4">)</span>

        <span class="s3">if </span><span class="s1">modulename </span><span class="s3">and not </span><span class="s1">modulename</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s6">'.'</span><span class="s4">):</span>
            <span class="s1">modulename </span><span class="s4">+= </span><span class="s6">'.'</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_mod </span><span class="s4">= </span><span class="s1">modulename</span>

        <span class="s3">if </span><span class="s1">doc </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">cls </span><span class="s3">is None</span><span class="s4">:</span>
                <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s6">&quot;No class or documentation string given&quot;</span><span class="s4">)</span>
            <span class="s1">doc </span><span class="s4">= </span><span class="s1">pydoc</span><span class="s4">.</span><span class="s1">getdoc</span><span class="s4">(</span><span class="s1">cls</span><span class="s4">)</span>

        <span class="s1">NumpyDocString</span><span class="s4">.</span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">doc</span><span class="s4">)</span>

        <span class="s1">_members </span><span class="s4">= </span><span class="s1">config</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s6">'members'</span><span class="s4">, [])</span>
        <span class="s3">if </span><span class="s1">_members </span><span class="s3">is </span><span class="s1">ALL</span><span class="s4">:</span>
            <span class="s1">_members </span><span class="s4">= </span><span class="s3">None</span>
        <span class="s1">_exclude </span><span class="s4">= </span><span class="s1">config</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s6">'exclude-members'</span><span class="s4">, [])</span>

        <span class="s3">if </span><span class="s1">config</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s6">'show_class_members'</span><span class="s4">, </span><span class="s3">True</span><span class="s4">) </span><span class="s3">and </span><span class="s1">_exclude </span><span class="s3">is not </span><span class="s1">ALL</span><span class="s4">:</span>
            <span class="s3">def </span><span class="s1">splitlines_x</span><span class="s4">(</span><span class="s1">s</span><span class="s4">):</span>
                <span class="s3">if not </span><span class="s1">s</span><span class="s4">:</span>
                    <span class="s3">return </span><span class="s4">[]</span>
                <span class="s3">else</span><span class="s4">:</span>
                    <span class="s3">return </span><span class="s1">s</span><span class="s4">.</span><span class="s1">splitlines</span><span class="s4">()</span>
            <span class="s3">for </span><span class="s1">field</span><span class="s4">, </span><span class="s1">items </span><span class="s3">in </span><span class="s4">[(</span><span class="s6">'Methods'</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">methods</span><span class="s4">),</span>
                                 <span class="s4">(</span><span class="s6">'Attributes'</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">properties</span><span class="s4">)]:</span>
                <span class="s3">if not </span><span class="s1">self</span><span class="s4">[</span><span class="s1">field</span><span class="s4">]:</span>
                    <span class="s1">doc_list </span><span class="s4">= []</span>
                    <span class="s3">for </span><span class="s1">name </span><span class="s3">in </span><span class="s1">sorted</span><span class="s4">(</span><span class="s1">items</span><span class="s4">):</span>
                        <span class="s3">if </span><span class="s4">(</span><span class="s1">name </span><span class="s3">in </span><span class="s1">_exclude </span><span class="s3">or</span>
                                <span class="s4">(</span><span class="s1">_members </span><span class="s3">and </span><span class="s1">name </span><span class="s3">not in </span><span class="s1">_members</span><span class="s4">)):</span>
                            <span class="s3">continue</span>
                        <span class="s3">try</span><span class="s4">:</span>
                            <span class="s1">doc_item </span><span class="s4">= </span><span class="s1">pydoc</span><span class="s4">.</span><span class="s1">getdoc</span><span class="s4">(</span><span class="s1">getattr</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cls</span><span class="s4">, </span><span class="s1">name</span><span class="s4">))</span>
                            <span class="s1">doc_list</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span>
                                <span class="s1">Parameter</span><span class="s4">(</span><span class="s1">name</span><span class="s4">, </span><span class="s6">''</span><span class="s4">, </span><span class="s1">splitlines_x</span><span class="s4">(</span><span class="s1">doc_item</span><span class="s4">)))</span>
                        <span class="s3">except </span><span class="s1">AttributeError</span><span class="s4">:</span>
                            <span class="s3">pass  </span><span class="s2"># method doesn't exist</span>
                    <span class="s1">self</span><span class="s4">[</span><span class="s1">field</span><span class="s4">] = </span><span class="s1">doc_list</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">methods</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cls </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s4">[]</span>
        <span class="s3">return </span><span class="s4">[</span><span class="s1">name </span><span class="s3">for </span><span class="s1">name</span><span class="s4">, </span><span class="s1">func </span><span class="s3">in </span><span class="s1">inspect</span><span class="s4">.</span><span class="s1">getmembers</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cls</span><span class="s4">)</span>
                <span class="s3">if </span><span class="s4">((</span><span class="s3">not </span><span class="s1">name</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">'_'</span><span class="s4">)</span>
                     <span class="s3">or </span><span class="s1">name </span><span class="s3">in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">extra_public_methods</span><span class="s4">)</span>
                    <span class="s3">and </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">func</span><span class="s4">, </span><span class="s1">Callable</span><span class="s4">)</span>
                    <span class="s3">and </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_is_show_member</span><span class="s4">(</span><span class="s1">name</span><span class="s4">))]</span>

    <span class="s4">@</span><span class="s1">property</span>
    <span class="s3">def </span><span class="s1">properties</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cls </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s4">[]</span>
        <span class="s3">return </span><span class="s4">[</span><span class="s1">name </span><span class="s3">for </span><span class="s1">name</span><span class="s4">, </span><span class="s1">func </span><span class="s3">in </span><span class="s1">inspect</span><span class="s4">.</span><span class="s1">getmembers</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cls</span><span class="s4">)</span>
                <span class="s3">if </span><span class="s4">(</span><span class="s3">not </span><span class="s1">name</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s6">'_'</span><span class="s4">) </span><span class="s3">and</span>
                    <span class="s4">(</span><span class="s1">func </span><span class="s3">is None or </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">func</span><span class="s4">, </span><span class="s1">property</span><span class="s4">) </span><span class="s3">or</span>
                     <span class="s1">inspect</span><span class="s4">.</span><span class="s1">isdatadescriptor</span><span class="s4">(</span><span class="s1">func</span><span class="s4">))</span>
                    <span class="s3">and </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_is_show_member</span><span class="s4">(</span><span class="s1">name</span><span class="s4">))]</span>

    <span class="s3">def </span><span class="s1">_is_show_member</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">name</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">show_inherited_members</span><span class="s4">:</span>
            <span class="s3">return True  </span><span class="s2"># show all class members</span>
        <span class="s3">if </span><span class="s1">name </span><span class="s3">not in </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cls</span><span class="s4">.</span><span class="s1">__dict__</span><span class="s4">:</span>
            <span class="s3">return False  </span><span class="s2"># class member is inherited, we do not show it</span>
        <span class="s3">return True</span>
</pre>
</body>
</html>