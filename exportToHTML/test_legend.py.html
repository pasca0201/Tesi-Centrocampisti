<html>
<head>
<title>test_legend.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_legend.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">collections</span>
<span class="s0">import </span><span class="s1">itertools</span>
<span class="s0">import </span><span class="s1">platform</span>
<span class="s0">import </span><span class="s1">time</span>
<span class="s0">from </span><span class="s1">unittest </span><span class="s0">import </span><span class="s1">mock</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">import </span><span class="s1">assert_allclose</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">check_figures_equal</span><span class="s2">, </span><span class="s1">image_comparison</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">_markers </span><span class="s0">import </span><span class="s1">needs_usetex</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">matplotlib </span><span class="s0">as </span><span class="s1">mpl</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">patches </span><span class="s0">as </span><span class="s1">mpatches</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">transforms </span><span class="s0">as </span><span class="s1">mtransforms</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">collections </span><span class="s0">as </span><span class="s1">mcollections</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">lines </span><span class="s0">as </span><span class="s1">mlines</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">legend_handler </span><span class="s0">import </span><span class="s1">HandlerTuple</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">legend </span><span class="s0">as </span><span class="s1">mlegend</span>
<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">_api</span><span class="s2">, </span><span class="s1">rc_context</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">font_manager </span><span class="s0">import </span><span class="s1">FontProperties</span>


<span class="s0">def </span><span class="s1">test_legend_ordereddict</span><span class="s2">():</span>
    <span class="s3"># smoketest that ordereddict inputs work...</span>

    <span class="s1">X </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">Y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">randn</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">labels </span><span class="s2">= [</span><span class="s5">'a'</span><span class="s2">] * </span><span class="s4">5 </span><span class="s2">+ [</span><span class="s5">'b'</span><span class="s2">] * </span><span class="s4">5</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s5">'r'</span><span class="s2">] * </span><span class="s4">5 </span><span class="s2">+ [</span><span class="s5">'g'</span><span class="s2">] * </span><span class="s4">5</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">label</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">X</span><span class="s2">, </span><span class="s1">Y</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">label</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">)</span>

    <span class="s1">handles</span><span class="s2">, </span><span class="s1">labels </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_legend_handles_labels</span><span class="s2">()</span>
    <span class="s1">legend </span><span class="s2">= </span><span class="s1">collections</span><span class="s2">.</span><span class="s1">OrderedDict</span><span class="s2">(</span><span class="s1">zip</span><span class="s2">(</span><span class="s1">labels</span><span class="s2">, </span><span class="s1">handles</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">legend</span><span class="s2">.</span><span class="s1">values</span><span class="s2">(), </span><span class="s1">legend</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(),</span>
              <span class="s1">loc</span><span class="s2">=</span><span class="s5">'center left'</span><span class="s2">, </span><span class="s1">bbox_to_anchor</span><span class="s2">=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'legend_auto1'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_legend_auto1</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test automatic legend placement&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">50 </span><span class="s2">- </span><span class="s1">x</span><span class="s2">, </span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'y=1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x </span><span class="s2">- </span><span class="s4">50</span><span class="s2">, </span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'y=-1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'legend_auto2'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_legend_auto2</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test automatic legend placement&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">b1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">align</span><span class="s2">=</span><span class="s5">'edge'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'m'</span><span class="s2">)</span>
    <span class="s1">b2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">[::-</span><span class="s4">1</span><span class="s2">], </span><span class="s1">align</span><span class="s2">=</span><span class="s5">'edge'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s1">b1</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">b2</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]], [</span><span class="s5">'up'</span><span class="s2">, </span><span class="s5">'down'</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'legend_auto3'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_legend_auto3</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test automatic legend placement&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s4">0.95</span><span class="s2">, </span><span class="s4">0.95</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s5">'o-'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'line'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_auto4</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Check that the legend location with automatic placement is the same, 
    whatever the histogram type is. Related to issue #9580. 
    &quot;&quot;&quot;</span>
    <span class="s3"># NB: barstacked is pointless with a single dataset.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">6.4</span><span class="s2">, </span><span class="s4">2.4</span><span class="s2">))</span>
    <span class="s1">leg_bboxes </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">ht </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, (</span><span class="s5">'bar'</span><span class="s2">, </span><span class="s5">'step'</span><span class="s2">, </span><span class="s5">'stepfilled'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_title</span><span class="s2">(</span><span class="s1">ht</span><span class="s2">)</span>
        <span class="s3"># A high bar on the left but an even higher one on the right.</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s4">0</span><span class="s2">] + </span><span class="s4">5</span><span class="s2">*[</span><span class="s4">9</span><span class="s2">], </span><span class="s1">bins</span><span class="s2">=</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;Legend&quot;</span><span class="s2">, </span><span class="s1">histtype</span><span class="s2">=</span><span class="s1">ht</span><span class="s2">)</span>
        <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">&quot;best&quot;</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">leg_bboxes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span>
            <span class="s1">leg</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">()))</span>

    <span class="s3"># The histogram type &quot;bar&quot; is assumed to be the correct reference.</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">)</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">2</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_auto5</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Check that the automatic placement handle a rather complex 
    case with non rectangular patch. Related to issue #9580. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">9.6</span><span class="s2">, </span><span class="s4">4.8</span><span class="s2">))</span>

    <span class="s1">leg_bboxes </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">loc </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, (</span><span class="s5">&quot;center&quot;</span><span class="s2">, </span><span class="s5">&quot;best&quot;</span><span class="s2">)):</span>
        <span class="s3"># An Ellipse patch at the top, a U-shaped Polygon patch at the</span>
        <span class="s3"># bottom and a ring-like Wedge patch: the correct placement of</span>
        <span class="s3"># the legend should be in the center.</span>
        <span class="s0">for </span><span class="s1">_patch </span><span class="s0">in </span><span class="s2">[</span>
                <span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Ellipse</span><span class="s2">(</span>
                    <span class="s1">xy</span><span class="s2">=(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">), </span><span class="s1">width</span><span class="s2">=</span><span class="s4">0.8</span><span class="s2">, </span><span class="s1">height</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s5">&quot;C1&quot;</span><span class="s2">),</span>
                <span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Polygon</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span>
                    <span class="s2">[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">],</span>
                    <span class="s2">[</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], [</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">]]), </span><span class="s1">fc</span><span class="s2">=</span><span class="s5">&quot;C1&quot;</span><span class="s2">),</span>
                <span class="s1">mpatches</span><span class="s2">.</span><span class="s1">Wedge</span><span class="s2">((</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">), </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">360</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s4">0.05</span><span class="s2">, </span><span class="s1">fc</span><span class="s2">=</span><span class="s5">&quot;C0&quot;</span><span class="s2">)</span>
                <span class="s2">]:</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">_patch</span><span class="s2">)</span>

        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">], [</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;A segment&quot;</span><span class="s2">)  </span><span class="s3"># sthg to label</span>

        <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">leg_bboxes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span>
            <span class="s1">leg</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">()))</span>

    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'legend_various_labels'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_various_labels</span><span class="s2">():</span>
    <span class="s3"># tests all sorts of label types</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s4">121</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">4</span><span class="s2">), </span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">4.1</span><span class="s2">), </span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Développés'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">), </span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'__nolegend__'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">numpoints</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_label_with_leading_underscore</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Test that artists with labels starting with an underscore are not added to 
    the legend, and that a warning is issued if one tries to add them 
    explicitly. 
    &quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'_foo'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">_api</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;with an underscore&quot;</span><span class="s2">):</span>
        <span class="s1">legend </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">handles</span><span class="s2">=[</span><span class="s1">line</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">legend</span><span class="s2">.</span><span class="s1">legend_handles</span><span class="s2">) == </span><span class="s4">0</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'legend_labels_first.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">0.013 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'arm64' </span><span class="s0">else </span><span class="s4">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_labels_first</span><span class="s2">():</span>
    <span class="s3"># test labels to left of markers</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s5">'-o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">5</span><span class="s2">, </span><span class="s5">':x'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;x&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">20</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">), </span><span class="s5">'d'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;diamond&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">, </span><span class="s1">markerfirst</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'legend_multiple_keys.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">0.013 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'arm64' </span><span class="s0">else </span><span class="s4">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_multiple_keys</span><span class="s2">():</span>
    <span class="s3"># test legend entries with multiple keys</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">p1</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s5">'-o'</span><span class="s2">)</span>
    <span class="s1">p2</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], </span><span class="s5">'-x'</span><span class="s2">)</span>
    <span class="s1">p3</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">], </span><span class="s5">'-d'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([(</span><span class="s1">p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">), (</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">p1</span><span class="s2">), </span><span class="s1">p3</span><span class="s2">], [</span><span class="s5">'two keys'</span><span class="s2">, </span><span class="s5">'pad=0'</span><span class="s2">, </span><span class="s5">'one key'</span><span class="s2">],</span>
              <span class="s1">numpoints</span><span class="s2">=</span><span class="s4">1</span><span class="s2">,</span>
              <span class="s1">handler_map</span><span class="s2">={(</span><span class="s1">p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">): </span><span class="s1">HandlerTuple</span><span class="s2">(</span><span class="s1">ndivide</span><span class="s2">=</span><span class="s0">None</span><span class="s2">),</span>
                           <span class="s2">(</span><span class="s1">p2</span><span class="s2">, </span><span class="s1">p1</span><span class="s2">): </span><span class="s1">HandlerTuple</span><span class="s2">(</span><span class="s1">ndivide</span><span class="s2">=</span><span class="s0">None</span><span class="s2">, </span><span class="s1">pad</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)})</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'rgba_alpha.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">0 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'x86_64' </span><span class="s0">else </span><span class="s4">0.03</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_alpha_rgba</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">5</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s5">'Longlabel that will go away'</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'center'</span><span class="s2">)</span>
    <span class="s1">leg</span><span class="s2">.</span><span class="s1">legendPatch</span><span class="s2">.</span><span class="s1">set_facecolor</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'rcparam_alpha.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">0 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'x86_64' </span><span class="s0">else </span><span class="s4">0.03</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_alpha_rcparam</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">5</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rc_context</span><span class="s2">(</span><span class="s1">rc</span><span class="s2">={</span><span class="s5">'legend.framealpha'</span><span class="s2">: </span><span class="s4">.75</span><span class="s2">}):</span>
        <span class="s1">leg </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s5">'Longlabel that will go away'</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'center'</span><span class="s2">)</span>
        <span class="s3"># this alpha is going to be over-ridden by the rcparam with</span>
        <span class="s3"># sets the alpha of the patch to be non-None which causes the alpha</span>
        <span class="s3"># value of the face color to be discarded.  This behavior may not be</span>
        <span class="s3"># ideal, but it is what it is and we should keep track of it changing</span>
        <span class="s1">leg</span><span class="s2">.</span><span class="s1">legendPatch</span><span class="s2">.</span><span class="s1">set_facecolor</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'fancy'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tol</span><span class="s2">=</span><span class="s4">0.05</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_fancy</span><span class="s2">():</span>
    <span class="s3"># Tolerance caused by changing default shadow &quot;shade&quot; from 0.3 to 1 - 0.7 =</span>
    <span class="s3"># 0.30000000000000004</span>
    <span class="s3"># using subplot triggers some offsetbox functionality untested elsewhere</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">121</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">5</span><span class="s2">] * </span><span class="s4">10</span><span class="s2">, </span><span class="s5">'o--'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'XX'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'XX</span><span class="s0">\n</span><span class="s5">XX'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">errorbar</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">xerr</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">,</span>
                 <span class="s1">yerr</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'XX'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">&quot;center left&quot;</span><span class="s2">, </span><span class="s1">bbox_to_anchor</span><span class="s2">=[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">],</span>
               <span class="s1">ncols</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">title</span><span class="s2">=</span><span class="s5">&quot;My legend&quot;</span><span class="s2">, </span><span class="s1">numpoints</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'framealpha'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">0 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'x86_64' </span><span class="s0">else </span><span class="s4">0.024</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_framealpha</span><span class="s2">():</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">100</span><span class="s2">, </span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">x</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'mylabel'</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">framealpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'scatter_rc3'</span><span class="s2">, </span><span class="s5">'scatter_rc1'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_rc</span><span class="s2">():</span>
    <span class="s3"># using subplot triggers some offsetbox functionality untested elsewhere</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">121</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'three'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">&quot;center left&quot;</span><span class="s2">, </span><span class="s1">bbox_to_anchor</span><span class="s2">=[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">],</span>
              <span class="s1">title</span><span class="s2">=</span><span class="s5">&quot;My legend&quot;</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.scatterpoints'</span><span class="s2">] = </span><span class="s4">1</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">(</span><span class="s4">121</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'one'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">&quot;center left&quot;</span><span class="s2">, </span><span class="s1">bbox_to_anchor</span><span class="s2">=[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">],</span>
              <span class="s1">title</span><span class="s2">=</span><span class="s5">&quot;My legend&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'legend_expand'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_legend_expand</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test expand mode&quot;&quot;&quot;</span>
    <span class="s1">legend_modes </span><span class="s2">= [</span><span class="s0">None</span><span class="s2">, </span><span class="s5">&quot;expand&quot;</span><span class="s2">]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">legend_modes</span><span class="s2">), </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">mode </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">, </span><span class="s1">legend_modes</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">50 </span><span class="s2">- </span><span class="s1">x</span><span class="s2">, </span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'y=1'</span><span class="s2">)</span>
        <span class="s1">l1 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'upper left'</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s1">mode</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">l1</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x </span><span class="s2">- </span><span class="s4">50</span><span class="s2">, </span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'y=-1'</span><span class="s2">)</span>
        <span class="s1">l2 </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s1">mode</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">l2</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'lower left'</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s1">mode</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'hatching'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'default'</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_hatching</span><span class="s2">():</span>
    <span class="s3"># Remove legend texts when this image is regenerated.</span>
    <span class="s3"># Remove this line when this test image is regenerated.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'text.kerning_factor'</span><span class="s2">] = </span><span class="s4">6</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s3"># Patches</span>
    <span class="s1">patch </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s5">'xx'</span><span class="s2">,</span>
                          <span class="s1">label</span><span class="s2">=</span><span class="s5">'Patch</span><span class="s0">\n</span><span class="s5">default color</span><span class="s0">\n</span><span class="s5">filled'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">patch</span><span class="s2">)</span>
    <span class="s1">patch </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s4">0.33</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s5">'||'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'C1'</span><span class="s2">,</span>
                          <span class="s1">label</span><span class="s2">=</span><span class="s5">'Patch</span><span class="s0">\n</span><span class="s5">explicit color</span><span class="s0">\n</span><span class="s5">filled'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">patch</span><span class="s2">)</span>
    <span class="s1">patch </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">), </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s5">'xx'</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                          <span class="s1">label</span><span class="s2">=</span><span class="s5">'Patch</span><span class="s0">\n</span><span class="s5">default color</span><span class="s0">\n</span><span class="s5">unfilled'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">patch</span><span class="s2">)</span>
    <span class="s1">patch </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">Rectangle</span><span class="s2">((</span><span class="s4">0.33</span><span class="s2">, </span><span class="s4">0.4</span><span class="s2">), </span><span class="s4">0.3</span><span class="s2">, </span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">hatch</span><span class="s2">=</span><span class="s5">'||'</span><span class="s2">, </span><span class="s1">fill</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
                          <span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'C1'</span><span class="s2">,</span>
                          <span class="s1">label</span><span class="s2">=</span><span class="s5">'Patch</span><span class="s0">\n</span><span class="s5">explicit color</span><span class="s0">\n</span><span class="s5">unfilled'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_patch</span><span class="s2">(</span><span class="s1">patch</span><span class="s2">)</span>

    <span class="s3"># Paths</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">.15</span><span class="s2">, </span><span class="s4">.3</span><span class="s2">], [</span><span class="s4">.8</span><span class="s2">, </span><span class="s4">.8</span><span class="s2">, </span><span class="s4">.8</span><span class="s2">], [</span><span class="s4">.9</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">.9</span><span class="s2">],</span>
                    <span class="s1">hatch</span><span class="s2">=</span><span class="s5">'+'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Path</span><span class="s0">\n</span><span class="s5">default color'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">([</span><span class="s4">.33</span><span class="s2">, </span><span class="s4">.48</span><span class="s2">, </span><span class="s4">.63</span><span class="s2">], [</span><span class="s4">.8</span><span class="s2">, </span><span class="s4">.8</span><span class="s2">, </span><span class="s4">.8</span><span class="s2">], [</span><span class="s4">.9</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">.9</span><span class="s2">],</span>
                    <span class="s1">hatch</span><span class="s2">=</span><span class="s5">'+'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'C2'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Path</span><span class="s0">\n</span><span class="s5">explicit color'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s4">0.01</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s4">0.01</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">handlelength</span><span class="s2">=</span><span class="s4">4</span><span class="s2">, </span><span class="s1">handleheight</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_remove</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">, </span><span class="s5">&quot;test&quot;</span><span class="s2">)</span>
    <span class="s1">leg</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">legends </span><span class="s2">== []</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s5">&quot;test&quot;</span><span class="s2">)</span>
    <span class="s1">leg</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_legend</span><span class="s2">() </span><span class="s0">is None</span>


<span class="s0">def </span><span class="s1">test_reverse_legend_handles_and_labels</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Check that the legend handles and labels are reversed.&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s4">1</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s4">1</span>
    <span class="s1">labels </span><span class="s2">= [</span><span class="s5">&quot;First label&quot;</span><span class="s2">, </span><span class="s5">&quot;Second label&quot;</span><span class="s2">, </span><span class="s5">&quot;Third label&quot;</span><span class="s2">]</span>
    <span class="s1">markers </span><span class="s2">= [</span><span class="s5">'.'</span><span class="s2">, </span><span class="s5">','</span><span class="s2">, </span><span class="s5">'o'</span><span class="s2">]</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">markers</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">markers</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">[</span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">markers</span><span class="s2">[</span><span class="s4">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">[</span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">reverse</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">actual_labels </span><span class="s2">= [</span><span class="s1">t</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()]</span>
    <span class="s1">actual_markers </span><span class="s2">= [</span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_marker</span><span class="s2">() </span><span class="s0">for </span><span class="s1">h </span><span class="s0">in </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">legend_handles</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">actual_labels </span><span class="s2">== </span><span class="s1">list</span><span class="s2">(</span><span class="s1">reversed</span><span class="s2">(</span><span class="s1">labels</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">actual_markers </span><span class="s2">== </span><span class="s1">list</span><span class="s2">(</span><span class="s1">reversed</span><span class="s2">(</span><span class="s1">markers</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">(</span><span class="s1">extensions</span><span class="s2">=[</span><span class="s5">&quot;png&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_reverse_legend_display</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s6">&quot;&quot;&quot;Check that the rendered legend entries are reversed&quot;&quot;&quot;</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_test</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">1</span><span class="s2">], </span><span class="s5">'ro'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;first&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">2</span><span class="s2">], </span><span class="s5">'bx'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;second&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">reverse</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">2</span><span class="s2">], </span><span class="s5">'bx'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;second&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">1</span><span class="s2">], </span><span class="s5">'ro'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;first&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s0">class </span><span class="s1">TestLegendFunction</span><span class="s2">:</span>
    <span class="s3"># Tests the legend function on the Axes and pyplot.</span>
    <span class="s0">def </span><span class="s1">test_legend_no_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'hello world'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">(), </span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'hello world'</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_legend_positional_handles_labels</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'hello world'</span><span class="s2">])</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">(), </span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'hello world'</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_legend_positional_handles_only</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">'but found an Artist'</span><span class="s2">):</span>
            <span class="s3"># a single arg is interpreted as labels</span>
            <span class="s3"># it's a common error to just pass handles</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_legend_positional_labels_only</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'hello world'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s5">'foobar'</span><span class="s2">])</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">(), </span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'foobar'</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_legend_three_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'hello world'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'foobar'</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">)</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">(), </span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'foobar'</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_legend_handler_map</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'hello world'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.'</span>
                        <span class="s5">'_get_legend_handles_labels'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">handles_labels</span><span class="s2">:</span>
            <span class="s1">handles_labels</span><span class="s2">.</span><span class="s1">return_value </span><span class="s2">= </span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'hello world'</span><span class="s2">]</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">handler_map</span><span class="s2">={</span><span class="s5">'1'</span><span class="s2">: </span><span class="s4">2</span><span class="s2">})</span>
        <span class="s1">handles_labels</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">([</span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">()], {</span><span class="s5">'1'</span><span class="s2">: </span><span class="s4">2</span><span class="s2">})</span>

    <span class="s0">def </span><span class="s1">test_legend_kwargs_handles_only</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">11</span><span class="s2">)</span>
        <span class="s1">ln1</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'x'</span><span class="s2">)</span>
        <span class="s1">ln2</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">x</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'2x'</span><span class="s2">)</span>
        <span class="s1">ln3</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">3</span><span class="s2">*</span><span class="s1">x</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'3x'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">handles</span><span class="s2">=[</span><span class="s1">ln3</span><span class="s2">, </span><span class="s1">ln2</span><span class="s2">])  </span><span class="s3"># reversed and not ln1</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, [</span><span class="s1">ln3</span><span class="s2">, </span><span class="s1">ln2</span><span class="s2">], [</span><span class="s5">'3x'</span><span class="s2">, </span><span class="s5">'2x'</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_legend_kwargs_labels_only</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">11</span><span class="s2">)</span>
        <span class="s1">ln1</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">ln2</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">'x'</span><span class="s2">, </span><span class="s5">'2x'</span><span class="s2">])</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, [</span><span class="s1">ln1</span><span class="s2">, </span><span class="s1">ln2</span><span class="s2">], [</span><span class="s5">'x'</span><span class="s2">, </span><span class="s5">'2x'</span><span class="s2">])</span>

    <span class="s0">def </span><span class="s1">test_legend_kwargs_handles_labels</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">th </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s4">1024</span><span class="s2">)</span>
        <span class="s1">lns</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">th</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">th</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'sin'</span><span class="s2">)</span>
        <span class="s1">lnc</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">th</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">th</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'cos'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s3"># labels of lns, lnc are overwritten with explicit ('a', 'b')</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labels</span><span class="s2">=(</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">), </span><span class="s1">handles</span><span class="s2">=(</span><span class="s1">lnc</span><span class="s2">, </span><span class="s1">lns</span><span class="s2">))</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">, (</span><span class="s1">lnc</span><span class="s2">, </span><span class="s1">lns</span><span class="s2">), (</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">test_warn_mixed_args_and_kwargs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">th </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">, </span><span class="s4">1024</span><span class="s2">)</span>
        <span class="s1">lns</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">th</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sin</span><span class="s2">(</span><span class="s1">th</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'sin'</span><span class="s2">)</span>
        <span class="s1">lnc</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">th</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cos</span><span class="s2">(</span><span class="s1">th</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'cos'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">DeprecationWarning</span><span class="s2">) </span><span class="s0">as </span><span class="s1">record</span><span class="s2">:</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">((</span><span class="s1">lnc</span><span class="s2">, </span><span class="s1">lns</span><span class="s2">), </span><span class="s1">labels</span><span class="s2">=(</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">))</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">record</span><span class="s2">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">str</span><span class="s2">(</span><span class="s1">record</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">message</span><span class="s2">).</span><span class="s1">startswith</span><span class="s2">(</span>
            <span class="s5">&quot;You have mixed positional and keyword arguments, some input may &quot;</span>
            <span class="s5">&quot;be discarded.&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_parasite</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">from </span><span class="s1">mpl_toolkits</span><span class="s2">.</span><span class="s1">axes_grid1 </span><span class="s0">import </span><span class="s1">host_subplot  </span><span class="s3"># type: ignore</span>

        <span class="s1">host </span><span class="s2">= </span><span class="s1">host_subplot</span><span class="s2">(</span><span class="s4">111</span><span class="s2">)</span>
        <span class="s1">par </span><span class="s2">= </span><span class="s1">host</span><span class="s2">.</span><span class="s1">twinx</span><span class="s2">()</span>

        <span class="s1">p1</span><span class="s2">, = </span><span class="s1">host</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;Density&quot;</span><span class="s2">)</span>
        <span class="s1">p2</span><span class="s2">, = </span><span class="s1">par</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;Temperature&quot;</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">host</span><span class="s2">, [</span><span class="s1">p1</span><span class="s2">, </span><span class="s1">p2</span><span class="s2">], [</span><span class="s5">'Density'</span><span class="s2">, </span><span class="s5">'Temperature'</span><span class="s2">])</span>


<span class="s0">class </span><span class="s1">TestLegendFigureFunction</span><span class="s2">:</span>
    <span class="s3"># Tests the legend function for figure</span>
    <span class="s0">def </span><span class="s1">test_legend_handle_label</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'hello world'</span><span class="s2">])</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'hello world'</span><span class="s2">],</span>
                                  <span class="s1">bbox_transform</span><span class="s2">=</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">transFigure</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_legend_no_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'hello world'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'hello world'</span><span class="s2">],</span>
                                  <span class="s1">bbox_transform</span><span class="s2">=</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">transFigure</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_legend_label_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s5">'foobar'</span><span class="s2">])</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">, </span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'foobar'</span><span class="s2">],</span>
                                  <span class="s1">bbox_transform</span><span class="s2">=</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">transFigure</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_legend_label_three_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;0-2&quot;</span><span class="s2">):</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'foobar'</span><span class="s2">], </span><span class="s5">'right'</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;0-2&quot;</span><span class="s2">):</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">, [</span><span class="s5">'foobar'</span><span class="s2">], </span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'left'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_legend_kw_args</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
        <span class="s1">lines2 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">) * </span><span class="s4">2.</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">mock</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s5">'matplotlib.legend.Legend'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">Legend</span><span class="s2">:</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=(</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">), </span><span class="s1">handles</span><span class="s2">=(</span><span class="s1">lines</span><span class="s2">, </span><span class="s1">lines2</span><span class="s2">))</span>
        <span class="s1">Legend</span><span class="s2">.</span><span class="s1">assert_called_with</span><span class="s2">(</span>
            <span class="s1">fig</span><span class="s2">, (</span><span class="s1">lines</span><span class="s2">, </span><span class="s1">lines2</span><span class="s2">), (</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">), </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">,</span>
            <span class="s1">bbox_transform</span><span class="s2">=</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">transFigure</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_warn_args_kwargs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
        <span class="s1">lines2 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">) * </span><span class="s4">2.</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">DeprecationWarning</span><span class="s2">) </span><span class="s0">as </span><span class="s1">record</span><span class="s2">:</span>
            <span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">((</span><span class="s1">lines</span><span class="s2">, </span><span class="s1">lines2</span><span class="s2">), </span><span class="s1">labels</span><span class="s2">=(</span><span class="s5">'a'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">))</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">record</span><span class="s2">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s1">str</span><span class="s2">(</span><span class="s1">record</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">message</span><span class="s2">).</span><span class="s1">startswith</span><span class="s2">(</span>
            <span class="s5">&quot;You have mixed positional and keyword arguments, some input may &quot;</span>
            <span class="s5">&quot;be discarded.&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_figure_legend_outside</span><span class="s2">():</span>
    <span class="s1">todos </span><span class="s2">= [</span><span class="s5">'upper ' </span><span class="s2">+ </span><span class="s1">pos </span><span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s2">[</span><span class="s5">'left'</span><span class="s2">, </span><span class="s5">'center'</span><span class="s2">, </span><span class="s5">'right'</span><span class="s2">]]</span>
    <span class="s1">todos </span><span class="s2">+= [</span><span class="s5">'lower ' </span><span class="s2">+ </span><span class="s1">pos </span><span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s2">[</span><span class="s5">'left'</span><span class="s2">, </span><span class="s5">'center'</span><span class="s2">, </span><span class="s5">'right'</span><span class="s2">]]</span>
    <span class="s1">todos </span><span class="s2">+= [</span><span class="s5">'left ' </span><span class="s2">+ </span><span class="s1">pos </span><span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s2">[</span><span class="s5">'lower'</span><span class="s2">, </span><span class="s5">'center'</span><span class="s2">, </span><span class="s5">'upper'</span><span class="s2">]]</span>
    <span class="s1">todos </span><span class="s2">+= [</span><span class="s5">'right ' </span><span class="s2">+ </span><span class="s1">pos </span><span class="s0">for </span><span class="s1">pos </span><span class="s0">in </span><span class="s2">[</span><span class="s5">'lower'</span><span class="s2">, </span><span class="s5">'center'</span><span class="s2">, </span><span class="s5">'upper'</span><span class="s2">]]</span>

    <span class="s1">upperext </span><span class="s2">= [</span><span class="s4">20.347556</span><span class="s2">,  </span><span class="s4">27.722556</span><span class="s2">, </span><span class="s4">790.583</span><span class="s2">, </span><span class="s4">545.499</span><span class="s2">]</span>
    <span class="s1">lowerext </span><span class="s2">= [</span><span class="s4">20.347556</span><span class="s2">,  </span><span class="s4">71.056556</span><span class="s2">, </span><span class="s4">790.583</span><span class="s2">, </span><span class="s4">588.833</span><span class="s2">]</span>
    <span class="s1">leftext </span><span class="s2">= [</span><span class="s4">151.681556</span><span class="s2">, </span><span class="s4">27.722556</span><span class="s2">, </span><span class="s4">790.583</span><span class="s2">, </span><span class="s4">588.833</span><span class="s2">]</span>
    <span class="s1">rightext </span><span class="s2">= [</span><span class="s4">20.347556</span><span class="s2">,  </span><span class="s4">27.722556</span><span class="s2">, </span><span class="s4">659.249</span><span class="s2">, </span><span class="s4">588.833</span><span class="s2">]</span>
    <span class="s1">axbb </span><span class="s2">= [</span><span class="s1">upperext</span><span class="s2">, </span><span class="s1">upperext</span><span class="s2">, </span><span class="s1">upperext</span><span class="s2">,</span>
            <span class="s1">lowerext</span><span class="s2">, </span><span class="s1">lowerext</span><span class="s2">, </span><span class="s1">lowerext</span><span class="s2">,</span>
            <span class="s1">leftext</span><span class="s2">, </span><span class="s1">leftext</span><span class="s2">, </span><span class="s1">leftext</span><span class="s2">,</span>
            <span class="s1">rightext</span><span class="s2">, </span><span class="s1">rightext</span><span class="s2">, </span><span class="s1">rightext</span><span class="s2">]</span>

    <span class="s1">legbb </span><span class="s2">= [[</span><span class="s4">10.</span><span class="s2">, </span><span class="s4">555.</span><span class="s2">, </span><span class="s4">133.</span><span class="s2">, </span><span class="s4">590.</span><span class="s2">],     </span><span class="s3"># upper left</span>
             <span class="s2">[</span><span class="s4">338.5</span><span class="s2">, </span><span class="s4">555.</span><span class="s2">, </span><span class="s4">461.5</span><span class="s2">, </span><span class="s4">590.</span><span class="s2">],  </span><span class="s3"># upper center</span>
             <span class="s2">[</span><span class="s4">667</span><span class="s2">, </span><span class="s4">555.</span><span class="s2">, </span><span class="s4">790.</span><span class="s2">,  </span><span class="s4">590.</span><span class="s2">],    </span><span class="s3"># upper right</span>
             <span class="s2">[</span><span class="s4">10.</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">, </span><span class="s4">133.</span><span class="s2">,  </span><span class="s4">45.</span><span class="s2">],      </span><span class="s3"># lower left</span>
             <span class="s2">[</span><span class="s4">338.5</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">, </span><span class="s4">461.5</span><span class="s2">,  </span><span class="s4">45.</span><span class="s2">],   </span><span class="s3"># lower center</span>
             <span class="s2">[</span><span class="s4">667.</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">, </span><span class="s4">790.</span><span class="s2">,  </span><span class="s4">45.</span><span class="s2">],     </span><span class="s3"># lower right</span>
             <span class="s2">[</span><span class="s4">10.</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">, </span><span class="s4">133.</span><span class="s2">, </span><span class="s4">45.</span><span class="s2">],       </span><span class="s3"># left lower</span>
             <span class="s2">[</span><span class="s4">10.</span><span class="s2">, </span><span class="s4">282.5</span><span class="s2">, </span><span class="s4">133.</span><span class="s2">, </span><span class="s4">317.5</span><span class="s2">],   </span><span class="s3"># left center</span>
             <span class="s2">[</span><span class="s4">10.</span><span class="s2">, </span><span class="s4">555.</span><span class="s2">, </span><span class="s4">133.</span><span class="s2">, </span><span class="s4">590.</span><span class="s2">],     </span><span class="s3"># left upper</span>
             <span class="s2">[</span><span class="s4">667</span><span class="s2">, </span><span class="s4">10.</span><span class="s2">, </span><span class="s4">790.</span><span class="s2">, </span><span class="s4">45.</span><span class="s2">],       </span><span class="s3"># right lower</span>
             <span class="s2">[</span><span class="s4">667.</span><span class="s2">, </span><span class="s4">282.5</span><span class="s2">, </span><span class="s4">790.</span><span class="s2">, </span><span class="s4">317.5</span><span class="s2">],  </span><span class="s3"># right center</span>
             <span class="s2">[</span><span class="s4">667.</span><span class="s2">, </span><span class="s4">555.</span><span class="s2">, </span><span class="s4">790.</span><span class="s2">, </span><span class="s4">590.</span><span class="s2">]]    </span><span class="s3"># right upper</span>

    <span class="s0">for </span><span class="s1">nn</span><span class="s2">, </span><span class="s1">todo </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">todos</span><span class="s2">):</span>
        <span class="s1">print</span><span class="s2">(</span><span class="s1">todo</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">constrained_layout</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
        <span class="s1">axs</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Boo1'</span><span class="s2">)</span>
        <span class="s1">leg </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'outside ' </span><span class="s2">+ </span><span class="s1">todo</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>

        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">extents</span><span class="s2">,</span>
                        <span class="s1">axbb</span><span class="s2">[</span><span class="s1">nn</span><span class="s2">])</span>
        <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">extents</span><span class="s2">,</span>
                        <span class="s1">legbb</span><span class="s2">[</span><span class="s1">nn</span><span class="s2">])</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'legend_stackplot.png'</span><span class="s2">],</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">0.031 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'arm64' </span><span class="s0">else </span><span class="s4">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_legend_stackplot</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test legend for PolyCollection using stackplot.&quot;&quot;&quot;</span>
    <span class="s3"># related to #1341, #1943, and PR #3303</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">y1 </span><span class="s2">= </span><span class="s4">1.0 </span><span class="s2">* </span><span class="s1">x</span>
    <span class="s1">y2 </span><span class="s2">= </span><span class="s4">2.0 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s4">1</span>
    <span class="s1">y3 </span><span class="s2">= </span><span class="s4">3.0 </span><span class="s2">* </span><span class="s1">x </span><span class="s2">+ </span><span class="s4">2</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">stackplot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">y3</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">'y1'</span><span class="s2">, </span><span class="s5">'y2'</span><span class="s2">, </span><span class="s5">'y3'</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">70</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_cross_figure_patch_legend</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig2</span><span class="s2">, </span><span class="s1">ax2 </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">brs </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">3</span><span class="s2">), </span><span class="s1">range</span><span class="s2">(</span><span class="s4">3</span><span class="s2">))</span>
    <span class="s1">fig2</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">brs</span><span class="s2">, </span><span class="s5">'foo'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_nanscatter</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">h </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">&quot;o&quot;</span><span class="s2">,</span>
                   <span class="s1">facecolor</span><span class="s2">=</span><span class="s5">&quot;r&quot;</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">&quot;r&quot;</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s4">3</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s1">h</span><span class="s2">], [</span><span class="s5">&quot;scatter&quot;</span><span class="s2">])</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">color </span><span class="s0">in </span><span class="s2">[</span><span class="s5">'red'</span><span class="s2">, </span><span class="s5">'green'</span><span class="s2">, </span><span class="s5">'blue'</span><span class="s2">]:</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s4">750</span>
        <span class="s1">x</span><span class="s2">, </span><span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">scale </span><span class="s2">= </span><span class="s4">200.0 </span><span class="s2">* </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">color</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">color</span><span class="s2">,</span>
                   <span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.3</span><span class="s2">, </span><span class="s1">edgecolors</span><span class="s2">=</span><span class="s5">'none'</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">grid</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_repeatcheckok</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">'v'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">hand</span><span class="s2">, </span><span class="s1">lab </span><span class="s2">= </span><span class="s1">mlegend</span><span class="s2">.</span><span class="s1">_get_legend_handles_labels</span><span class="s2">([</span><span class="s1">ax</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">lab</span><span class="s2">) == </span><span class="s4">2</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">'o'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'k'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">'v'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">hand</span><span class="s2">, </span><span class="s1">lab </span><span class="s2">= </span><span class="s1">mlegend</span><span class="s2">.</span><span class="s1">_get_legend_handles_labels</span><span class="s2">([</span><span class="s1">ax</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">lab</span><span class="s2">) == </span><span class="s4">2</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'not_covering_scatter.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_not_covering_scatter</span><span class="s2">():</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s5">'b'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'r'</span><span class="s2">]</span>

    <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">3</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s1">n</span><span class="s2">], [</span><span class="s1">n</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">[</span><span class="s1">n</span><span class="s2">])</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s5">'foo'</span><span class="s2">, </span><span class="s5">'foo'</span><span class="s2">, </span><span class="s5">'foo'</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">().</span><span class="s1">set_xlim</span><span class="s2">(-</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">2.2</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">().</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">2.2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'not_covering_scatter_transform.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_not_covering_scatter_transform</span><span class="s2">():</span>
    <span class="s3"># Offsets point to top left, the default auto position</span>
    <span class="s1">offset </span><span class="s2">= </span><span class="s1">mtransforms</span><span class="s2">.</span><span class="s1">Affine2D</span><span class="s2">().</span><span class="s1">translate</span><span class="s2">(-</span><span class="s4">20</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">linspace</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">1000</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s4">20</span><span class="s2">], [</span><span class="s4">10</span><span class="s2">], </span><span class="s1">transform</span><span class="s2">=</span><span class="s1">offset </span><span class="s2">+ </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">().</span><span class="s1">transData</span><span class="s2">)</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s5">'foo'</span><span class="s2">, </span><span class="s5">'bar'</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_linecollection_scaled_dashes</span><span class="s2">():</span>
    <span class="s1">lines1 </span><span class="s2">= [[(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">), (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)], [(</span><span class="s4">.3</span><span class="s2">, </span><span class="s4">.6</span><span class="s2">), (</span><span class="s4">.2</span><span class="s2">, </span><span class="s4">.2</span><span class="s2">)]]</span>
    <span class="s1">lines2 </span><span class="s2">= [[[</span><span class="s4">0.7</span><span class="s2">, </span><span class="s4">.2</span><span class="s2">], [</span><span class="s4">.8</span><span class="s2">, </span><span class="s4">.4</span><span class="s2">]], [[</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.7</span><span class="s2">], [</span><span class="s4">.6</span><span class="s2">, </span><span class="s4">.1</span><span class="s2">]]]</span>
    <span class="s1">lines3 </span><span class="s2">= [[[</span><span class="s4">0.6</span><span class="s2">, </span><span class="s4">.2</span><span class="s2">], [</span><span class="s4">.8</span><span class="s2">, </span><span class="s4">.4</span><span class="s2">]], [[</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.7</span><span class="s2">], [</span><span class="s4">.1</span><span class="s2">, </span><span class="s4">.1</span><span class="s2">]]]</span>
    <span class="s1">lc1 </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">LineCollection</span><span class="s2">(</span><span class="s1">lines1</span><span class="s2">, </span><span class="s1">linestyles</span><span class="s2">=</span><span class="s5">&quot;--&quot;</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">3</span><span class="s2">)</span>
    <span class="s1">lc2 </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">LineCollection</span><span class="s2">(</span><span class="s1">lines2</span><span class="s2">, </span><span class="s1">linestyles</span><span class="s2">=</span><span class="s5">&quot;-.&quot;</span><span class="s2">)</span>
    <span class="s1">lc3 </span><span class="s2">= </span><span class="s1">mcollections</span><span class="s2">.</span><span class="s1">LineCollection</span><span class="s2">(</span><span class="s1">lines3</span><span class="s2">, </span><span class="s1">linestyles</span><span class="s2">=</span><span class="s5">&quot;:&quot;</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">.5</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">lc1</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">lc2</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_collection</span><span class="s2">(</span><span class="s1">lc3</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">([</span><span class="s1">lc1</span><span class="s2">, </span><span class="s1">lc2</span><span class="s2">, </span><span class="s1">lc3</span><span class="s2">], [</span><span class="s5">&quot;line1&quot;</span><span class="s2">, </span><span class="s5">&quot;line2&quot;</span><span class="s2">, </span><span class="s5">'line 3'</span><span class="s2">])</span>
    <span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">, </span><span class="s1">h3 </span><span class="s2">= </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">legend_handles</span>

    <span class="s0">for </span><span class="s1">oh</span><span class="s2">, </span><span class="s1">lh </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">((</span><span class="s1">lc1</span><span class="s2">, </span><span class="s1">lc2</span><span class="s2">, </span><span class="s1">lc3</span><span class="s2">), (</span><span class="s1">h1</span><span class="s2">, </span><span class="s1">h2</span><span class="s2">, </span><span class="s1">h3</span><span class="s2">)):</span>
        <span class="s0">assert </span><span class="s1">oh</span><span class="s2">.</span><span class="s1">get_linestyles</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">] == </span><span class="s1">lh</span><span class="s2">.</span><span class="s1">_dash_pattern</span>


<span class="s0">def </span><span class="s1">test_handler_numpoints</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test legend handler with numpoints &lt;= 1.&quot;&quot;&quot;</span>
    <span class="s3"># related to #6921 and PR #8478</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">5</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">numpoints</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_text_nohandler_warning</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test that Text artists with labels raise a warning&quot;&quot;&quot;</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s1">x</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">y</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">s</span><span class="s2">=</span><span class="s5">&quot;text&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;label&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">) </span><span class="s0">as </span><span class="s1">record</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">record</span><span class="s2">) == </span><span class="s4">1</span>

    <span class="s3"># this should _not_ warn:</span>
    <span class="s1">f</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">pcolormesh</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, (</span><span class="s4">10</span><span class="s2">, </span><span class="s4">10</span><span class="s2">)))</span>
    <span class="s0">with </span><span class="s1">warnings</span><span class="s2">.</span><span class="s1">catch_warnings</span><span class="s2">():</span>
        <span class="s1">warnings</span><span class="s2">.</span><span class="s1">simplefilter</span><span class="s2">(</span><span class="s5">&quot;error&quot;</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">get_legend_handles_labels</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_empty_bar_chart_with_legend</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot;Test legend when bar chart is empty with a label.&quot;&quot;&quot;</span>
    <span class="s3"># related to issue #13003. Calling plt.legend() should not</span>
    <span class="s3"># raise an IndexError.</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">bar</span><span class="s2">([], [], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'shadow_argument_types.png'</span><span class="s2">], </span><span class="s1">remove_text</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s5">'mpl20'</span><span class="s2">,</span>
                  <span class="s1">tol</span><span class="s2">=</span><span class="s4">0.028 </span><span class="s0">if </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">machine</span><span class="s2">() == </span><span class="s5">'arm64' </span><span class="s0">else </span><span class="s4">0</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_shadow_argument_types</span><span class="s2">():</span>
    <span class="s3"># Test that different arguments for shadow work as expected</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>

    <span class="s3"># Test various shadow configurations</span>
    <span class="s3"># as well as different ways of specifying colors</span>
    <span class="s1">legs </span><span class="s2">= (</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'upper left'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">),    </span><span class="s3"># True</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'upper right'</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">False</span><span class="s2">),  </span><span class="s3"># False</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'center left'</span><span class="s2">,                 </span><span class="s3"># string</span>
                      <span class="s1">shadow</span><span class="s2">={</span><span class="s5">'color'</span><span class="s2">: </span><span class="s5">'red'</span><span class="s2">, </span><span class="s5">'alpha'</span><span class="s2">: </span><span class="s4">0.1</span><span class="s2">}),</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'center right'</span><span class="s2">,                </span><span class="s3"># tuple</span>
                      <span class="s1">shadow</span><span class="s2">={</span><span class="s5">'color'</span><span class="s2">: (</span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.2</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">), </span><span class="s5">'oy'</span><span class="s2">: -</span><span class="s4">5</span><span class="s2">}),</span>
            <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'lower left'</span><span class="s2">,                   </span><span class="s3"># tab</span>
                      <span class="s1">shadow</span><span class="s2">={</span><span class="s5">'color'</span><span class="s2">: </span><span class="s5">'tab:cyan'</span><span class="s2">, </span><span class="s5">'ox'</span><span class="s2">: </span><span class="s4">10</span><span class="s2">})</span>
            <span class="s2">)</span>
    <span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">legs</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">add_artist</span><span class="s2">(</span><span class="s1">l</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'lower right'</span><span class="s2">)  </span><span class="s3"># default</span>


<span class="s0">def </span><span class="s1">test_shadow_invalid_argument</span><span class="s2">():</span>
    <span class="s3"># Test if invalid argument to legend shadow</span>
    <span class="s3"># (i.e. not [color|bool]) raises ValueError</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;dict or bool&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">&quot;upper left&quot;</span><span class="s2">, </span><span class="s1">shadow</span><span class="s2">=</span><span class="s5">&quot;aardvark&quot;</span><span class="s2">)  </span><span class="s3"># Bad argument</span>


<span class="s0">def </span><span class="s1">test_shadow_framealpha</span><span class="s2">():</span>
    <span class="s3"># Test if framealpha is activated when shadow is True</span>
    <span class="s3"># and framealpha is not explicitly passed'''</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">100</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;test&quot;</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">shadow</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'w'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_frame</span><span class="s2">().</span><span class="s1">get_alpha</span><span class="s2">() == </span><span class="s4">1</span>


<span class="s0">def </span><span class="s1">test_legend_title_empty</span><span class="s2">():</span>
    <span class="s3"># test that if we don't set the legend title, that</span>
    <span class="s3"># it comes back as an empty string, and that it is not</span>
    <span class="s3"># visible:</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">&quot;&quot;</span>
    <span class="s0">assert not </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_visible</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_legend_proper_window_extent</span><span class="s2">():</span>
    <span class="s3"># test that legend returns the expected extent under various dpi...</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">x01 </span><span class="s2">= </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()).</span><span class="s1">x0</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">200</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">x02 </span><span class="s2">= </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">(</span><span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">get_renderer</span><span class="s2">()).</span><span class="s1">x0</span>
    <span class="s0">assert </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">approx</span><span class="s2">(</span><span class="s1">x01</span><span class="s2">*</span><span class="s4">2</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">) == </span><span class="s1">x02</span>


<span class="s0">def </span><span class="s1">test_window_extent_cached_renderer</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">dpi</span><span class="s2">=</span><span class="s4">100</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">leg2 </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s3"># check that get_window_extent will use the cached renderer</span>
    <span class="s1">leg</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>
    <span class="s1">leg2</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_legend_title_fontprop_fontsize</span><span class="s2">():</span>
    <span class="s3"># test the title_fontsize kwarg</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">, </span><span class="s1">title_fontsize</span><span class="s2">=</span><span class="s4">22</span><span class="s2">,</span>
                   <span class="s1">title_fontproperties</span><span class="s2">={</span><span class="s5">'family'</span><span class="s2">: </span><span class="s5">'serif'</span><span class="s2">, </span><span class="s5">'size'</span><span class="s2">: </span><span class="s4">22</span><span class="s2">})</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">, </span><span class="s1">title_fontproperties</span><span class="s2">=</span><span class="s1">FontProperties</span><span class="s2">(</span>
                                       <span class="s1">family</span><span class="s2">=</span><span class="s5">'serif'</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s4">22</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_size</span><span class="s2">() == </span><span class="s4">22</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axes </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">6</span><span class="s2">))</span>
    <span class="s1">axes </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">.</span><span class="s1">flat</span>
    <span class="s1">axes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s1">leg0 </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">, </span><span class="s1">title_fontsize</span><span class="s2">=</span><span class="s4">22</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">leg0</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_fontsize</span><span class="s2">() == </span><span class="s4">22</span>
    <span class="s1">axes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s1">leg1 </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">,</span>
                          <span class="s1">title_fontproperties</span><span class="s2">={</span><span class="s5">'family'</span><span class="s2">: </span><span class="s5">'serif'</span><span class="s2">, </span><span class="s5">'size'</span><span class="s2">: </span><span class="s4">22</span><span class="s2">})</span>
    <span class="s0">assert </span><span class="s1">leg1</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_fontsize</span><span class="s2">() == </span><span class="s4">22</span>
    <span class="s1">axes</span><span class="s2">[</span><span class="s4">2</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.title_fontsize'</span><span class="s2">] = </span><span class="s0">None</span>
    <span class="s1">leg2 </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">[</span><span class="s4">2</span><span class="s2">].</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">,</span>
                          <span class="s1">title_fontproperties</span><span class="s2">={</span><span class="s5">'family'</span><span class="s2">: </span><span class="s5">'serif'</span><span class="s2">})</span>
    <span class="s0">assert </span><span class="s1">leg2</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_fontsize</span><span class="s2">() == </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'font.size'</span><span class="s2">]</span>
    <span class="s1">axes</span><span class="s2">[</span><span class="s4">3</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s1">leg3 </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">[</span><span class="s4">3</span><span class="s2">].</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">leg3</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_fontsize</span><span class="s2">() == </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'font.size'</span><span class="s2">]</span>
    <span class="s1">axes</span><span class="s2">[</span><span class="s4">4</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.title_fontsize'</span><span class="s2">] = </span><span class="s4">20</span>
    <span class="s1">leg4 </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">[</span><span class="s4">4</span><span class="s2">].</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">,</span>
                          <span class="s1">title_fontproperties</span><span class="s2">={</span><span class="s5">'family'</span><span class="s2">: </span><span class="s5">'serif'</span><span class="s2">})</span>
    <span class="s0">assert </span><span class="s1">leg4</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_fontsize</span><span class="s2">() == </span><span class="s4">20</span>
    <span class="s1">axes</span><span class="s2">[</span><span class="s4">5</span><span class="s2">].</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;mock data&quot;</span><span class="s2">)</span>
    <span class="s1">leg5 </span><span class="s2">= </span><span class="s1">axes</span><span class="s2">[</span><span class="s4">5</span><span class="s2">].</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">'Aardvark'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">leg5</span><span class="s2">.</span><span class="s1">get_title</span><span class="s2">().</span><span class="s1">get_fontsize</span><span class="s2">() == </span><span class="s4">20</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'alignment'</span><span class="s2">, (</span><span class="s5">'center'</span><span class="s2">, </span><span class="s5">'left'</span><span class="s2">, </span><span class="s5">'right'</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_legend_alignment</span><span class="s2">(</span><span class="s1">alignment</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">&quot;Aardvark&quot;</span><span class="s2">, </span><span class="s1">alignment</span><span class="s2">=</span><span class="s1">alignment</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_children</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">align </span><span class="s2">== </span><span class="s1">alignment</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_alignment</span><span class="s2">() == </span><span class="s1">alignment</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'loc'</span><span class="s2">, (</span><span class="s5">'center'</span><span class="s2">, </span><span class="s5">'best'</span><span class="s2">,))</span>
<span class="s0">def </span><span class="s1">test_ax_legend_set_loc</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">leg</span><span class="s2">.</span><span class="s1">set_loc</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">_get_loc</span><span class="s2">() == </span><span class="s1">mlegend</span><span class="s2">.</span><span class="s1">Legend</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">[</span><span class="s1">loc</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'loc'</span><span class="s2">, (</span><span class="s5">'outside right'</span><span class="s2">, </span><span class="s5">'right'</span><span class="s2">,))</span>
<span class="s0">def </span><span class="s1">test_fig_legend_set_loc</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">leg</span><span class="s2">.</span><span class="s1">set_loc</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">)</span>

    <span class="s1">loc </span><span class="s2">= </span><span class="s1">loc</span><span class="s2">.</span><span class="s1">split</span><span class="s2">()[</span><span class="s4">1</span><span class="s2">] </span><span class="s0">if </span><span class="s1">loc</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s5">&quot;outside&quot;</span><span class="s2">) </span><span class="s0">else </span><span class="s1">loc</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">_get_loc</span><span class="s2">() == </span><span class="s1">mlegend</span><span class="s2">.</span><span class="s1">Legend</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">[</span><span class="s1">loc</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'alignment'</span><span class="s2">, (</span><span class="s5">'center'</span><span class="s2">, </span><span class="s5">'left'</span><span class="s2">, </span><span class="s5">'right'</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_legend_set_alignment</span><span class="s2">(</span><span class="s1">alignment</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'test'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">leg</span><span class="s2">.</span><span class="s1">set_alignment</span><span class="s2">(</span><span class="s1">alignment</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_children</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">align </span><span class="s2">== </span><span class="s1">alignment</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_alignment</span><span class="s2">() == </span><span class="s1">alignment</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'color'</span><span class="s2">, (</span><span class="s5">'red'</span><span class="s2">, </span><span class="s5">'none'</span><span class="s2">, (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">)))</span>
<span class="s0">def </span><span class="s1">test_legend_labelcolor_single</span><span class="s2">(</span><span class="s1">color</span><span class="s2">):</span>
    <span class="s3"># test labelcolor for a single color</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s1">color</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">():</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_list</span><span class="s2">():</span>
    <span class="s3"># test labelcolor for a list of colors</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=[</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">])</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_linecolor</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='linecolor'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'linecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_linecolor</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='linecolor' on PathCollection</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'linecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_linecolor_iterable</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='linecolor' on PathCollection</span>
    <span class="s3"># with iterable colors</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">colors </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">().</span><span class="s1">choice</span><span class="s2">([</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">], </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">c</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'linecolor'</span><span class="s2">)</span>
    <span class="s1">text</span><span class="s2">, = </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s5">'black'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_linecolor_cmap</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='linecolor' on PathCollection</span>
    <span class="s3"># with a colormap</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">c</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'linecolor'</span><span class="s2">)</span>
    <span class="s1">text</span><span class="s2">, = </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s5">'black'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_markeredgecolor</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'markeredgecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markeredgecolor</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markeredgecolor' on PathCollection</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'markeredgecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markeredgecolor_iterable</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markeredgecolor' on PathCollection</span>
    <span class="s3"># with iterable colors</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">colors </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">().</span><span class="s1">choice</span><span class="s2">([</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">], </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'markeredgecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'k'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markeredgecolor_cmap</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markeredgecolor' on PathCollection</span>
    <span class="s3"># with a colormap</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">edgecolors </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">viridis</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">),</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">),</span>
        <span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">,</span>
        <span class="s1">c</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">),</span>
        <span class="s1">edgecolor</span><span class="s2">=</span><span class="s1">edgecolors</span><span class="s2">,</span>
        <span class="s1">cmap</span><span class="s2">=</span><span class="s5">&quot;Reds&quot;</span>
    <span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'markeredgecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'k'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_markerfacecolor</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markerfacecolor'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'markerfacecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markerfacecolor</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markerfacecolor' on PathCollection</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'markerfacecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markerfacecolor_iterable</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markerfacecolor' on PathCollection</span>
    <span class="s3"># with iterable colors</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">colors </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">().</span><span class="s1">choice</span><span class="s2">([</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">], </span><span class="s4">10</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s1">colors</span><span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'markerfacecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'k'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_pathcollection_labelcolor_markfacecolor_cmap</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markerfacecolor' on PathCollection</span>
    <span class="s3"># with colormaps</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">facecolors </span><span class="s2">= </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">cm</span><span class="s2">.</span><span class="s1">viridis</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">rand</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">),</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">),</span>
        <span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">,</span>
        <span class="s1">c</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">),</span>
        <span class="s1">facecolor</span><span class="s2">=</span><span class="s1">facecolors</span>
    <span class="s2">)</span>

    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">labelcolor</span><span class="s2">=</span><span class="s5">'markerfacecolor'</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'k'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'color'</span><span class="s2">, (</span><span class="s5">'red'</span><span class="s2">, </span><span class="s5">'none'</span><span class="s2">, (</span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">, </span><span class="s4">.5</span><span class="s2">)))</span>
<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_single</span><span class="s2">(</span><span class="s1">color</span><span class="s2">):</span>
    <span class="s3"># test the rcParams legend.labelcolor for a single color</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.labelcolor'</span><span class="s2">] = </span><span class="s1">color</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">():</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_linecolor</span><span class="s2">():</span>
    <span class="s3"># test the rcParams legend.labelcolor for a linecolor</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.labelcolor'</span><span class="s2">] = </span><span class="s5">'linecolor'</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_markeredgecolor</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.labelcolor'</span><span class="s2">] = </span><span class="s5">'markeredgecolor'</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_markeredgecolor_short</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">markeredgecolor</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.labelcolor'</span><span class="s2">] = </span><span class="s5">'mec'</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_markerfacecolor</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.labelcolor'</span><span class="s2">] = </span><span class="s5">'markerfacecolor'</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_labelcolor_rcparam_markerfacecolor_short</span><span class="s2">():</span>
    <span class="s3"># test the labelcolor for labelcolor='markeredgecolor'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">1</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#1'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">2</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#2'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'g'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s4">10</span><span class="s2">)*</span><span class="s4">3</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'#3'</span><span class="s2">, </span><span class="s1">markerfacecolor</span><span class="s2">=</span><span class="s5">'b'</span><span class="s2">)</span>

    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'legend.labelcolor'</span><span class="s2">] = </span><span class="s5">'mfc'</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">text</span><span class="s2">, </span><span class="s1">color </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">(), [</span><span class="s5">'r'</span><span class="s2">, </span><span class="s5">'g'</span><span class="s2">, </span><span class="s5">'b'</span><span class="s2">]):</span>
        <span class="s0">assert </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">.</span><span class="s1">same_color</span><span class="s2">(</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_color</span><span class="s2">(), </span><span class="s1">color</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s5">&quot;ignore:No artists with labels found to put in legend&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_get_set_draggable</span><span class="s2">():</span>
    <span class="s1">legend </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">assert not </span><span class="s1">legend</span><span class="s2">.</span><span class="s1">get_draggable</span><span class="s2">()</span>
    <span class="s1">legend</span><span class="s2">.</span><span class="s1">set_draggable</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">legend</span><span class="s2">.</span><span class="s1">get_draggable</span><span class="s2">()</span>
    <span class="s1">legend</span><span class="s2">.</span><span class="s1">set_draggable</span><span class="s2">(</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert not </span><span class="s1">legend</span><span class="s2">.</span><span class="s1">get_draggable</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'draggable'</span><span class="s2">, (</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_legend_draggable</span><span class="s2">(</span><span class="s1">draggable</span><span class="s2">):</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">), </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'shabnams'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">draggable</span><span class="s2">=</span><span class="s1">draggable</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_draggable</span><span class="s2">() </span><span class="s0">is </span><span class="s1">draggable</span>


<span class="s0">def </span><span class="s1">test_alpha_handles</span><span class="s2">():</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">hh </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">hist</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.25</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'data'</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'red'</span><span class="s2">)</span>
    <span class="s1">legend </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">for </span><span class="s1">lh </span><span class="s0">in </span><span class="s1">legend</span><span class="s2">.</span><span class="s1">legend_handles</span><span class="s2">:</span>
        <span class="s1">lh</span><span class="s2">.</span><span class="s1">set_alpha</span><span class="s2">(</span><span class="s4">1.0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">lh</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">()[:-</span><span class="s4">1</span><span class="s2">] == </span><span class="s1">hh</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">get_facecolor</span><span class="s2">()[:-</span><span class="s4">1</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">lh</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">()[:-</span><span class="s4">1</span><span class="s2">] == </span><span class="s1">hh</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">get_edgecolor</span><span class="s2">()[:-</span><span class="s4">1</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">needs_usetex</span>
<span class="s0">def </span><span class="s1">test_usetex_no_warn</span><span class="s2">(</span><span class="s1">caplog</span><span class="s2">):</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'font.family'</span><span class="s2">] = </span><span class="s5">'serif'</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'font.serif'</span><span class="s2">] = </span><span class="s5">'Computer Modern'</span>
    <span class="s1">mpl</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'text.usetex'</span><span class="s2">] = </span><span class="s0">True</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'input'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">title</span><span class="s2">=</span><span class="s5">&quot;My legend&quot;</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s5">&quot;Font family ['serif'] not found.&quot; </span><span class="s0">not in </span><span class="s1">caplog</span><span class="s2">.</span><span class="s1">text</span>


<span class="s0">def </span><span class="s1">test_warn_big_data_best_loc</span><span class="s2">(</span><span class="s1">monkeypatch</span><span class="s2">):</span>
    <span class="s3"># Force _find_best_position to think it took a long time.</span>
    <span class="s1">counter </span><span class="s2">= </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">count</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">step</span><span class="s2">=</span><span class="s4">1.5</span><span class="s2">)</span>
    <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s5">'perf_counter'</span><span class="s2">, </span><span class="s0">lambda</span><span class="s2">: </span><span class="s1">next</span><span class="s2">(</span><span class="s1">counter</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()  </span><span class="s3"># So that we can call draw_artist later.</span>

    <span class="s3"># Place line across all possible legend locations.</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s4">0.95</span><span class="s2">, </span><span class="s4">0.95</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s5">'o-'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'line'</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s5">'legend.loc'</span><span class="s2">: </span><span class="s5">'best'</span><span class="s2">}):</span>
        <span class="s1">legend </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s5">'Creating legend with loc=&quot;best&quot; can be slow with large '</span>
                      <span class="s5">'amounts of data.'</span><span class="s2">) </span><span class="s0">as </span><span class="s1">records</span><span class="s2">:</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_artist</span><span class="s2">(</span><span class="s1">legend</span><span class="s2">)  </span><span class="s3"># Don't bother drawing the lines -- it's slow.</span>
    <span class="s3"># The _find_best_position method of Legend is called twice, duplicating</span>
    <span class="s3"># the warning message.</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">records</span><span class="s2">) == </span><span class="s4">2</span>


<span class="s0">def </span><span class="s1">test_no_warn_big_data_when_loc_specified</span><span class="s2">(</span><span class="s1">monkeypatch</span><span class="s2">):</span>
    <span class="s3"># Force _find_best_position to think it took a long time.</span>
    <span class="s1">counter </span><span class="s2">= </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">count</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">step</span><span class="s2">=</span><span class="s4">1.5</span><span class="s2">)</span>
    <span class="s1">monkeypatch</span><span class="s2">.</span><span class="s1">setattr</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s5">'perf_counter'</span><span class="s2">, </span><span class="s0">lambda</span><span class="s2">: </span><span class="s1">next</span><span class="s2">(</span><span class="s1">counter</span><span class="s2">))</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>

    <span class="s3"># Place line across all possible legend locations.</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.9</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s4">0.95</span><span class="s2">, </span><span class="s4">0.95</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.05</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">, </span><span class="s4">0.5</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s5">'o-'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'line'</span><span class="s2">)</span>

    <span class="s1">legend </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s5">'best'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_artist</span><span class="s2">(</span><span class="s1">legend</span><span class="s2">)  </span><span class="s3"># Check that no warning is emitted.</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'label_array'</span><span class="s2">, [[</span><span class="s5">'low'</span><span class="s2">, </span><span class="s5">'high'</span><span class="s2">],</span>
                                         <span class="s2">(</span><span class="s5">'low'</span><span class="s2">, </span><span class="s5">'high'</span><span class="s2">),</span>
                                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">'low'</span><span class="s2">, </span><span class="s5">'high'</span><span class="s2">])])</span>
<span class="s0">def </span><span class="s1">test_plot_multiple_input_multiple_label</span><span class="s2">(</span><span class="s1">label_array</span><span class="s2">):</span>
    <span class="s3"># test ax.plot() with multidimensional input</span>
    <span class="s3"># and multiple labels</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">9</span><span class="s2">]]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">label_array</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">legend_texts </span><span class="s2">= [</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">entry </span><span class="s0">in </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()]</span>
    <span class="s0">assert </span><span class="s1">legend_texts </span><span class="s2">== [</span><span class="s5">'low'</span><span class="s2">, </span><span class="s5">'high'</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'label'</span><span class="s2">, [</span><span class="s5">'one'</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">int</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_plot_multiple_input_single_label</span><span class="s2">(</span><span class="s1">label</span><span class="s2">):</span>
    <span class="s3"># test ax.plot() with multidimensional input</span>
    <span class="s3"># and single label</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">],</span>
         <span class="s2">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">9</span><span class="s2">]]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">label</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s1">legend_texts </span><span class="s2">= [</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">entry </span><span class="s0">in </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()]</span>
    <span class="s0">assert </span><span class="s1">legend_texts </span><span class="s2">== [</span><span class="s1">str</span><span class="s2">(</span><span class="s1">label</span><span class="s2">)] * </span><span class="s4">2</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'label_array'</span><span class="s2">, [[</span><span class="s5">'low'</span><span class="s2">, </span><span class="s5">'high'</span><span class="s2">],</span>
                                         <span class="s2">(</span><span class="s5">'low'</span><span class="s2">, </span><span class="s5">'high'</span><span class="s2">),</span>
                                         <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">'low'</span><span class="s2">, </span><span class="s5">'high'</span><span class="s2">])])</span>
<span class="s0">def </span><span class="s1">test_plot_single_input_multiple_label</span><span class="s2">(</span><span class="s1">label_array</span><span class="s2">):</span>
    <span class="s3"># test ax.plot() with 1D array like input</span>
    <span class="s3"># and iterable label</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">MatplotlibDeprecationWarning</span><span class="s2">,</span>
                      <span class="s1">match</span><span class="s2">=</span><span class="s5">'Passing label as a length 2 sequence'</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">label_array</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()) == </span><span class="s4">1</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s1">str</span><span class="s2">(</span><span class="s1">label_array</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_plot_single_input_list_label</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">line</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([[</span><span class="s4">0</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">]], </span><span class="s1">label</span><span class="s2">=[</span><span class="s5">'A'</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">() == </span><span class="s5">'A'</span>


<span class="s0">def </span><span class="s1">test_plot_multiple_label_incorrect_length_exception</span><span class="s2">():</span>
    <span class="s3"># check that exception is raised if multiple labels</span>
    <span class="s3"># are given, but number of on labels != number of lines</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
        <span class="s1">y </span><span class="s2">= [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">2</span><span class="s2">, </span><span class="s4">5</span><span class="s2">],</span>
             <span class="s2">[</span><span class="s4">4</span><span class="s2">, </span><span class="s4">9</span><span class="s2">]]</span>
        <span class="s1">label </span><span class="s2">= [</span><span class="s5">'high'</span><span class="s2">, </span><span class="s5">'low'</span><span class="s2">, </span><span class="s5">'medium'</span><span class="s2">]</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">label</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_face_edgecolor</span><span class="s2">():</span>
    <span class="s3"># Smoke test for PolyCollection legend handler with 'face' edgecolor.</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">],</span>
                    <span class="s1">facecolor</span><span class="s2">=</span><span class="s5">'r'</span><span class="s2">, </span><span class="s1">edgecolor</span><span class="s2">=</span><span class="s5">'face'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Fill'</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_legend_text_axes</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'line'</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>

    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">axes </span><span class="s0">is </span><span class="s1">ax</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">axes </span><span class="s0">is </span><span class="s1">ax</span>


<span class="s0">def </span><span class="s1">test_handlerline2d</span><span class="s2">():</span>
    <span class="s3"># Test marker consistency for monolithic Line2D legend handler (#11357).</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">scatter</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">&quot;v&quot;</span><span class="s2">)</span>
    <span class="s1">handles </span><span class="s2">= [</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">&quot;v&quot;</span><span class="s2">)]</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">handles</span><span class="s2">, [</span><span class="s5">&quot;Aardvark&quot;</span><span class="s2">], </span><span class="s1">numpoints</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">handles</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">() == </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">legend_handles</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_marker</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_subfigure_legend</span><span class="s2">():</span>
    <span class="s3"># Test that legend can be added to subfigure (#20723)</span>
    <span class="s1">subfig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">().</span><span class="s1">subfigures</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">subfig</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">label</span><span class="s2">=</span><span class="s5">&quot;line&quot;</span><span class="s2">)</span>
    <span class="s1">leg </span><span class="s2">= </span><span class="s1">subfig</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">leg</span><span class="s2">.</span><span class="s1">figure </span><span class="s0">is </span><span class="s1">subfig</span>


<span class="s0">def </span><span class="s1">test_setting_alpha_keeps_polycollection_color</span><span class="s2">():</span>
    <span class="s1">pc </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'#123456'</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'label'</span><span class="s2">)</span>
    <span class="s1">patch </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">().</span><span class="s1">get_patches</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">]</span>
    <span class="s1">patch</span><span class="s2">.</span><span class="s1">set_alpha</span><span class="s2">(</span><span class="s4">0.5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">patch</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">()[:</span><span class="s4">3</span><span class="s2">] == </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">.</span><span class="s1">get_facecolor</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">][:</span><span class="s4">3</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">patch</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">()[:</span><span class="s4">3</span><span class="s2">] == </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">pc</span><span class="s2">.</span><span class="s1">get_edgecolor</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">][:</span><span class="s4">3</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_legend_markers_from_line2d</span><span class="s2">():</span>
    <span class="s3"># Test that markers can be copied for legend lines (#17960)</span>
    <span class="s1">_markers </span><span class="s2">= [</span><span class="s5">'.'</span><span class="s2">, </span><span class="s5">'*'</span><span class="s2">, </span><span class="s5">'v'</span><span class="s2">]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">lines </span><span class="s2">= [</span><span class="s1">mlines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">([</span><span class="s4">0</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">], </span><span class="s1">ls</span><span class="s2">=</span><span class="s5">'None'</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">=</span><span class="s1">mark</span><span class="s2">)</span>
             <span class="s0">for </span><span class="s1">mark </span><span class="s0">in </span><span class="s1">_markers</span><span class="s2">]</span>
    <span class="s1">labels </span><span class="s2">= [</span><span class="s5">&quot;foo&quot;</span><span class="s2">, </span><span class="s5">&quot;bar&quot;</span><span class="s2">, </span><span class="s5">&quot;xyzzy&quot;</span><span class="s2">]</span>
    <span class="s1">markers </span><span class="s2">= [</span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_marker</span><span class="s2">() </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">lines</span><span class="s2">]</span>
    <span class="s1">legend </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">)</span>

    <span class="s1">new_markers </span><span class="s2">= [</span><span class="s1">line</span><span class="s2">.</span><span class="s1">get_marker</span><span class="s2">() </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">legend</span><span class="s2">.</span><span class="s1">get_lines</span><span class="s2">()]</span>
    <span class="s1">new_labels </span><span class="s2">= [</span><span class="s1">text</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">legend</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()]</span>

    <span class="s0">assert </span><span class="s1">markers </span><span class="s2">== </span><span class="s1">new_markers </span><span class="s2">== </span><span class="s1">_markers</span>
    <span class="s0">assert </span><span class="s1">labels </span><span class="s2">== </span><span class="s1">new_labels</span>


<span class="s2">@</span><span class="s1">check_figures_equal</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">test_ncol_ncols</span><span class="s2">(</span><span class="s1">fig_test</span><span class="s2">, </span><span class="s1">fig_ref</span><span class="s2">):</span>
    <span class="s3"># Test that both ncol and ncols work</span>
    <span class="s1">strings </span><span class="s2">= [</span><span class="s5">&quot;a&quot;</span><span class="s2">, </span><span class="s5">&quot;b&quot;</span><span class="s2">, </span><span class="s5">&quot;c&quot;</span><span class="s2">, </span><span class="s5">&quot;d&quot;</span><span class="s2">, </span><span class="s5">&quot;e&quot;</span><span class="s2">, </span><span class="s5">&quot;f&quot;</span><span class="s2">]</span>
    <span class="s1">ncols </span><span class="s2">= </span><span class="s4">3</span>
    <span class="s1">fig_test</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">strings</span><span class="s2">, </span><span class="s1">ncol</span><span class="s2">=</span><span class="s1">ncols</span><span class="s2">)</span>
    <span class="s1">fig_ref</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">strings</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s1">ncols</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_loc_invalid_tuple_exception</span><span class="s2">():</span>
    <span class="s3"># check that exception is raised if the loc arg</span>
    <span class="s3"># of legend is not a 2-tuple of numbers</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s5">'loc must be string, coordinate '</span>
                       <span class="s5">'tuple, or an integer 0-10, not </span><span class="s0">\\</span><span class="s5">(1.1,</span><span class="s0">\\</span><span class="s5">)'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=(</span><span class="s4">1.1</span><span class="s2">, ), </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s5">'loc must be string, coordinate '</span>
                       <span class="s5">'tuple, or an integer 0-10, not </span><span class="s0">\\</span><span class="s5">(0.481, 0.4227, 0.4523</span><span class="s0">\\</span><span class="s5">)'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=(</span><span class="s4">0.481</span><span class="s2">, </span><span class="s4">0.4227</span><span class="s2">, </span><span class="s4">0.4523</span><span class="s2">), </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s5">'loc must be string, coordinate '</span>
                       <span class="s5">'tuple, or an integer 0-10, not </span><span class="s0">\\</span><span class="s5">(0.481, </span><span class="s0">\'</span><span class="s5">go blue</span><span class="s0">\'\\</span><span class="s5">)'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=(</span><span class="s4">0.481</span><span class="s2">, </span><span class="s5">&quot;go blue&quot;</span><span class="s2">), </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_loc_valid_tuple</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=(</span><span class="s4">0.481</span><span class="s2">, </span><span class="s4">0.442</span><span class="s2">), </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">), </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_loc_valid_list</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=[</span><span class="s4">0.481</span><span class="s2">, </span><span class="s4">0.442</span><span class="s2">], </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_loc_invalid_list_exception</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s5">'loc must be string, coordinate '</span>
                       <span class="s5">'tuple, or an integer 0-10, not </span><span class="s0">\\</span><span class="s5">[1.1, 2.2, 3.3</span><span class="s0">\\</span><span class="s5">]'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=[</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">2.2</span><span class="s2">, </span><span class="s4">3.3</span><span class="s2">], </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_loc_invalid_type</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s5">&quot;loc must be string, coordinate &quot;</span>
                       <span class="s5">&quot;tuple, or an integer 0-10, not {'not': True}&quot;</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">={</span><span class="s5">'not'</span><span class="s2">: </span><span class="s0">True</span><span class="s2">}, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_loc_validation_numeric_value</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">5</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">10</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s5">'loc must be string, coordinate '</span>
                       <span class="s5">'tuple, or an integer 0-10, not 11'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s4">11</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=(</span><span class="s5">'loc must be string, coordinate '</span>
                       <span class="s5">'tuple, or an integer 0-10, not -1'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=-</span><span class="s4">1</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;mock data&quot;</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_loc_validation_string_value</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">labels </span><span class="s2">= [</span><span class="s5">&quot;mock data&quot;</span><span class="s2">]</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'upper right'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'best'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'upper right'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'upper left'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'lower left'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'lower right'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'right'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'center left'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'center right'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'lower center'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'upper center'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;'wrong' is not a valid value for&quot;</span><span class="s2">):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">'wrong'</span><span class="s2">, </span><span class="s1">labels</span><span class="s2">=</span><span class="s1">labels</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_handle_label_mismatch</span><span class="s2">():</span>
    <span class="s1">pl1</span><span class="s2">, = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">pl2</span><span class="s2">, = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;number of handles and labels&quot;</span><span class="s2">):</span>
        <span class="s1">legend </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">handles</span><span class="s2">=[</span><span class="s1">pl1</span><span class="s2">, </span><span class="s1">pl2</span><span class="s2">], </span><span class="s1">labels</span><span class="s2">=[</span><span class="s5">&quot;pl1&quot;</span><span class="s2">, </span><span class="s5">&quot;pl2&quot;</span><span class="s2">, </span><span class="s5">&quot;pl3&quot;</span><span class="s2">])</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">legend</span><span class="s2">.</span><span class="s1">legend_handles</span><span class="s2">) == </span><span class="s4">2</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">legend</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()) == </span><span class="s4">2</span>


<span class="s0">def </span><span class="s1">test_legend_handle_label_mismatch_no_len</span><span class="s2">():</span>
    <span class="s1">pl1</span><span class="s2">, = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">pl2</span><span class="s2">, = </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s4">10</span><span class="s2">))</span>
    <span class="s1">legend </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">handles</span><span class="s2">=</span><span class="s1">iter</span><span class="s2">([</span><span class="s1">pl1</span><span class="s2">, </span><span class="s1">pl2</span><span class="s2">]),</span>
                        <span class="s1">labels</span><span class="s2">=</span><span class="s1">iter</span><span class="s2">([</span><span class="s5">&quot;pl1&quot;</span><span class="s2">, </span><span class="s5">&quot;pl2&quot;</span><span class="s2">, </span><span class="s5">&quot;pl3&quot;</span><span class="s2">]))</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">legend</span><span class="s2">.</span><span class="s1">legend_handles</span><span class="s2">) == </span><span class="s4">2</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">legend</span><span class="s2">.</span><span class="s1">get_texts</span><span class="s2">()) == </span><span class="s4">2</span>


<span class="s0">def </span><span class="s1">test_legend_nolabels_warning</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;No artists with labels found&quot;</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s5">&quot;ignore:No artists with labels found to put in legend&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_legend_nolabels_draw</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">gca</span><span class="s2">().</span><span class="s1">get_legend</span><span class="s2">() </span><span class="s0">is not None</span>


<span class="s0">def </span><span class="s1">test_legend_loc_polycollection</span><span class="s2">():</span>
    <span class="s3"># Test that the legend is placed in the correct</span>
    <span class="s3"># position for 'best' for polycollection</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">]</span>
    <span class="s1">y1 </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
    <span class="s1">y2 </span><span class="s2">= [</span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">]</span>
    <span class="s1">leg_bboxes </span><span class="s2">= []</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">5</span><span class="s2">))</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">loc </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, (</span><span class="s5">'best'</span><span class="s2">, </span><span class="s5">'lower left'</span><span class="s2">)):</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">fill_between</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">, </span><span class="s1">y2</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">'gray'</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.5</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'Shaded Area'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">6</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">5</span><span class="s2">)</span>
        <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">leg_bboxes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span>
            <span class="s1">leg</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">()))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_legend_text</span><span class="s2">():</span>
    <span class="s3"># Test that legend is place in the correct</span>
    <span class="s3"># position for 'best' when there is text in figure</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">5</span><span class="s2">))</span>
    <span class="s1">leg_bboxes </span><span class="s2">= []</span>
    <span class="s0">for </span><span class="s1">ax</span><span class="s2">, </span><span class="s1">loc </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">axs</span><span class="s2">.</span><span class="s1">flat</span><span class="s2">, (</span><span class="s5">'best'</span><span class="s2">, </span><span class="s5">'lower left'</span><span class="s2">)):</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]</span>
        <span class="s1">y </span><span class="s2">= [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'plot name'</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s5">'some text blahblah'</span><span class="s2">, </span><span class="s1">verticalalignment</span><span class="s2">=</span><span class="s5">'top'</span><span class="s2">)</span>
        <span class="s1">leg </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">legend</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">leg_bboxes</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span>
            <span class="s1">leg</span><span class="s2">.</span><span class="s1">get_window_extent</span><span class="s2">().</span><span class="s1">transformed</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">transAxes</span><span class="s2">.</span><span class="s1">inverted</span><span class="s2">()))</span>
    <span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">, </span><span class="s1">leg_bboxes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">bounds</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_boxplot_legend_labels</span><span class="s2">():</span>
    <span class="s3"># Test that legend entries are generated when passing `label`.</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s4">19680801</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">random</span><span class="s2">((</span><span class="s4">10</span><span class="s2">, </span><span class="s4">4</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">axs </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">(</span><span class="s1">nrows</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">ncols</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
    <span class="s1">legend_labels </span><span class="s2">= [</span><span class="s5">'box A'</span><span class="s2">, </span><span class="s5">'box B'</span><span class="s2">, </span><span class="s5">'box C'</span><span class="s2">, </span><span class="s5">'box D'</span><span class="s2">]</span>

    <span class="s3"># Testing legend labels and patch passed to legend.</span>
    <span class="s1">bp1 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">patch_artist</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">legend_labels</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">v</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">() </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">bp1</span><span class="s2">[</span><span class="s5">'boxes'</span><span class="s2">]] == </span><span class="s1">legend_labels</span>
    <span class="s1">handles</span><span class="s2">, </span><span class="s1">labels </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_legend_handles_labels</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">labels </span><span class="s2">== </span><span class="s1">legend_labels</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">patches</span><span class="s2">.</span><span class="s1">PathPatch</span><span class="s2">) </span><span class="s0">for </span><span class="s1">h </span><span class="s0">in </span><span class="s1">handles</span><span class="s2">)</span>

    <span class="s3"># Testing legend without `box`.</span>
    <span class="s1">bp2 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">legend_labels</span><span class="s2">, </span><span class="s1">showbox</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s3"># Without a box, The legend entries should be passed from the medians.</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">v</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">() </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">bp2</span><span class="s2">[</span><span class="s5">'medians'</span><span class="s2">]] == </span><span class="s1">legend_labels</span>
    <span class="s1">handles</span><span class="s2">, </span><span class="s1">labels </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">get_legend_handles_labels</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">labels </span><span class="s2">== </span><span class="s1">legend_labels</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">mpl</span><span class="s2">.</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">Line2D</span><span class="s2">) </span><span class="s0">for </span><span class="s1">h </span><span class="s0">in </span><span class="s1">handles</span><span class="s2">)</span>

    <span class="s3"># Testing legend with number of labels different from number of boxes.</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">'values must have same the length'</span><span class="s2">):</span>
        <span class="s1">bp3 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">2</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s1">legend_labels</span><span class="s2">[:-</span><span class="s4">1</span><span class="s2">])</span>

    <span class="s3"># Test that for a string label, only the first box gets a label.</span>
    <span class="s1">bp4 </span><span class="s2">= </span><span class="s1">axs</span><span class="s2">[</span><span class="s4">3</span><span class="s2">].</span><span class="s1">boxplot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s5">'box A'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">bp4</span><span class="s2">[</span><span class="s5">'medians'</span><span class="s2">][</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_label</span><span class="s2">() == </span><span class="s5">'box A'</span>
    <span class="s0">assert </span><span class="s1">all</span><span class="s2">(</span><span class="s1">x</span><span class="s2">.</span><span class="s1">get_label</span><span class="s2">().</span><span class="s1">startswith</span><span class="s2">(</span><span class="s5">&quot;_&quot;</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">bp4</span><span class="s2">[</span><span class="s5">'medians'</span><span class="s2">][</span><span class="s4">1</span><span class="s2">:])</span>
</pre>
</body>
</html>