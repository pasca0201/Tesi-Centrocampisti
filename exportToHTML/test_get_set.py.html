<html>
<head>
<title>test_get_set.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_get_set.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">compat </span><span class="s0">import </span><span class="s1">PY311</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">dtypes</span><span class="s2">.</span><span class="s1">dtypes </span><span class="s0">import </span><span class="s1">DatetimeTZDtype</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">CategoricalIndex</span><span class="s2">,</span>
    <span class="s1">MultiIndex</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s0">def </span><span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">check_dtype</span><span class="s2">=</span><span class="s0">False</span><span class="s2">):</span>
    <span class="s3"># avoid specifying internal representation</span>
    <span class="s3"># as much as possible</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">) == </span><span class="s1">len</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">act</span><span class="s2">, </span><span class="s1">exp </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
        <span class="s1">act </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">act</span><span class="s2">)</span>
        <span class="s1">exp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">asarray</span><span class="s2">(</span><span class="s1">exp</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">act</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s1">check_dtype</span><span class="s2">=</span><span class="s1">check_dtype</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_level_number_integer</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">):</span>
    <span class="s1">idx</span><span class="s2">.</span><span class="s1">names </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_get_level_number</span><span class="s2">(</span><span class="s4">1</span><span class="s2">) == </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">_get_level_number</span><span class="s2">(</span><span class="s4">0</span><span class="s2">) == </span><span class="s4">1</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s5">&quot;Too many levels: Index has only 2 levels, not 3&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">_get_level_number</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">KeyError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Level fourth not found&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">_get_level_number</span><span class="s2">(</span><span class="s5">&quot;fourth&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_dtypes</span><span class="s2">(</span><span class="s1">using_infer_string</span><span class="s2">):</span>
    <span class="s3"># Test MultiIndex.dtypes (# Gh37062)</span>
    <span class="s1">idx_multitype </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(</span>
        <span class="s2">[[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s5">&quot;a&quot;</span><span class="s2">, </span><span class="s5">&quot;b&quot;</span><span class="s2">, </span><span class="s5">&quot;c&quot;</span><span class="s2">], </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s5">&quot;20200101&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s5">&quot;UTC&quot;</span><span class="s2">)],</span>
        <span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;int&quot;</span><span class="s2">, </span><span class="s5">&quot;string&quot;</span><span class="s2">, </span><span class="s5">&quot;dt&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>

    <span class="s1">exp </span><span class="s2">= </span><span class="s5">&quot;object&quot; </span><span class="s0">if not </span><span class="s1">using_infer_string </span><span class="s0">else </span><span class="s5">&quot;string&quot;</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span>
        <span class="s2">{</span>
            <span class="s5">&quot;int&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s5">&quot;int64&quot;</span><span class="s2">),</span>
            <span class="s5">&quot;string&quot;</span><span class="s2">: </span><span class="s1">exp</span><span class="s2">,</span>
            <span class="s5">&quot;dt&quot;</span><span class="s2">: </span><span class="s1">DatetimeTZDtype</span><span class="s2">(</span><span class="s1">tz</span><span class="s2">=</span><span class="s5">&quot;utc&quot;</span><span class="s2">),</span>
        <span class="s2">}</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">idx_multitype</span><span class="s2">.</span><span class="s1">dtypes</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_dtypes_no_level_name</span><span class="s2">(</span><span class="s1">using_infer_string</span><span class="s2">):</span>
    <span class="s3"># Test MultiIndex.dtypes (# GH38580 )</span>
    <span class="s1">idx_multitype </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s5">&quot;a&quot;</span><span class="s2">, </span><span class="s5">&quot;b&quot;</span><span class="s2">, </span><span class="s5">&quot;c&quot;</span><span class="s2">],</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s5">&quot;20200101&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s5">&quot;UTC&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">exp </span><span class="s2">= </span><span class="s5">&quot;object&quot; </span><span class="s0">if not </span><span class="s1">using_infer_string </span><span class="s0">else </span><span class="s5">&quot;string&quot;</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span>
        <span class="s2">{</span>
            <span class="s5">&quot;level_0&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s5">&quot;int64&quot;</span><span class="s2">),</span>
            <span class="s5">&quot;level_1&quot;</span><span class="s2">: </span><span class="s1">exp</span><span class="s2">,</span>
            <span class="s5">&quot;level_2&quot;</span><span class="s2">: </span><span class="s1">DatetimeTZDtype</span><span class="s2">(</span><span class="s1">tz</span><span class="s2">=</span><span class="s5">&quot;utc&quot;</span><span class="s2">),</span>
        <span class="s2">}</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">idx_multitype</span><span class="s2">.</span><span class="s1">dtypes</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_dtypes_duplicate_level_names</span><span class="s2">(</span><span class="s1">using_infer_string</span><span class="s2">):</span>
    <span class="s3"># Test MultiIndex.dtypes with non-unique level names (# GH45174)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s5">&quot;a&quot;</span><span class="s2">, </span><span class="s5">&quot;b&quot;</span><span class="s2">, </span><span class="s5">&quot;c&quot;</span><span class="s2">],</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s5">&quot;20200101&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s4">2</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s5">&quot;UTC&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
        <span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;A&quot;</span><span class="s2">, </span><span class="s5">&quot;A&quot;</span><span class="s2">, </span><span class="s5">&quot;A&quot;</span><span class="s2">],</span>
    <span class="s2">).</span><span class="s1">dtypes</span>
    <span class="s1">exp </span><span class="s2">= </span><span class="s5">&quot;object&quot; </span><span class="s0">if not </span><span class="s1">using_infer_string </span><span class="s0">else </span><span class="s5">&quot;string&quot;</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Series</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s5">&quot;int64&quot;</span><span class="s2">), </span><span class="s1">exp</span><span class="s2">, </span><span class="s1">DatetimeTZDtype</span><span class="s2">(</span><span class="s1">tz</span><span class="s2">=</span><span class="s5">&quot;utc&quot;</span><span class="s2">)],</span>
        <span class="s1">index</span><span class="s2">=[</span><span class="s5">&quot;A&quot;</span><span class="s2">, </span><span class="s5">&quot;A&quot;</span><span class="s2">, </span><span class="s5">&quot;A&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_get_level_number_out_of_bounds</span><span class="s2">(</span><span class="s1">multiindex_dataframe_random_data</span><span class="s2">):</span>
    <span class="s1">frame </span><span class="s2">= </span><span class="s1">multiindex_dataframe_random_data</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Too many levels&quot;</span><span class="s2">):</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">_get_level_number</span><span class="s2">(</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;not a valid level number&quot;</span><span class="s2">):</span>
        <span class="s1">frame</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">_get_level_number</span><span class="s2">(-</span><span class="s4">3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_name_methods</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">):</span>
    <span class="s3"># so long as these are synonyms, we don't need to test set_names</span>
    <span class="s1">index_names </span><span class="s2">= [</span><span class="s5">&quot;first&quot;</span><span class="s2">, </span><span class="s5">&quot;second&quot;</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">rename </span><span class="s2">== </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_names</span>
    <span class="s1">new_names </span><span class="s2">= [</span><span class="s1">name </span><span class="s2">+ </span><span class="s5">&quot;SUFFIX&quot; </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">index_names</span><span class="s2">]</span>
    <span class="s1">ind </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">new_names</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== </span><span class="s1">index_names</span>
    <span class="s0">assert </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== </span><span class="s1">new_names</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s5">&quot;Length of names must match number of levels in MultiIndex&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">ind</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">new_names </span><span class="s2">+ </span><span class="s1">new_names</span><span class="s2">)</span>
    <span class="s1">new_names2 </span><span class="s2">= [</span><span class="s1">name </span><span class="s2">+ </span><span class="s5">&quot;SUFFIX2&quot; </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">new_names</span><span class="s2">]</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">new_names2</span><span class="s2">, </span><span class="s1">inplace</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">res </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== </span><span class="s1">new_names2</span>

    <span class="s3"># set names for specific level (# GH7792)</span>
    <span class="s1">ind </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">new_names</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== </span><span class="s1">index_names</span>
    <span class="s0">assert </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== [</span><span class="s1">new_names</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">index_names</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]]</span>

    <span class="s1">res </span><span class="s2">= </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">new_names2</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">inplace</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">res </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== [</span><span class="s1">new_names2</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">index_names</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]]</span>

    <span class="s3"># set names for multiple levels</span>
    <span class="s1">ind </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">new_names</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== </span><span class="s1">index_names</span>
    <span class="s0">assert </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== </span><span class="s1">new_names</span>

    <span class="s1">res </span><span class="s2">= </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">new_names2</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">inplace</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">res </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== </span><span class="s1">new_names2</span>


<span class="s0">def </span><span class="s1">test_set_levels_codes_directly</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">):</span>
    <span class="s3"># setting levels/codes directly raises AttributeError</span>

    <span class="s1">levels </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span>
    <span class="s1">new_levels </span><span class="s2">= [[</span><span class="s1">lev </span><span class="s2">+ </span><span class="s5">&quot;a&quot; </span><span class="s0">for </span><span class="s1">lev </span><span class="s0">in </span><span class="s1">level</span><span class="s2">] </span><span class="s0">for </span><span class="s1">level </span><span class="s0">in </span><span class="s1">levels</span><span class="s2">]</span>

    <span class="s1">codes </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span>
    <span class="s1">major_codes</span><span class="s2">, </span><span class="s1">minor_codes </span><span class="s2">= </span><span class="s1">codes</span>
    <span class="s1">major_codes </span><span class="s2">= [(</span><span class="s1">x </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">) % </span><span class="s4">3 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">major_codes</span><span class="s2">]</span>
    <span class="s1">minor_codes </span><span class="s2">= [(</span><span class="s1">x </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">) % </span><span class="s4">1 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">minor_codes</span><span class="s2">]</span>
    <span class="s1">new_codes </span><span class="s2">= [</span><span class="s1">major_codes</span><span class="s2">, </span><span class="s1">minor_codes</span><span class="s2">]</span>

    <span class="s1">msg </span><span class="s2">= </span><span class="s5">&quot;Can't set attribute&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">AttributeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">levels </span><span class="s2">= </span><span class="s1">new_levels</span>

    <span class="s1">msg </span><span class="s2">= (</span>
        <span class="s5">&quot;property 'codes' of 'MultiIndex' object has no setter&quot;</span>
        <span class="s0">if </span><span class="s1">PY311</span>
        <span class="s0">else </span><span class="s5">&quot;can't set attribute&quot;</span>
    <span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">AttributeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">codes </span><span class="s2">= </span><span class="s1">new_codes</span>


<span class="s0">def </span><span class="s1">test_set_levels</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">):</span>
    <span class="s3"># side note - you probably wouldn't want to use levels and codes</span>
    <span class="s3"># directly like this - but it is possible.</span>
    <span class="s1">levels </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span>
    <span class="s1">new_levels </span><span class="s2">= [[</span><span class="s1">lev </span><span class="s2">+ </span><span class="s5">&quot;a&quot; </span><span class="s0">for </span><span class="s1">lev </span><span class="s0">in </span><span class="s1">level</span><span class="s2">] </span><span class="s0">for </span><span class="s1">level </span><span class="s0">in </span><span class="s1">levels</span><span class="s2">]</span>

    <span class="s3"># level changing [w/o mutation]</span>
    <span class="s1">ind2 </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">new_levels</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">ind2</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">new_levels</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s3"># level changing specific level [w/o mutation]</span>
    <span class="s1">ind2 </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">new_levels</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">ind2</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, [</span><span class="s1">new_levels</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">levels</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]])</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s1">ind2 </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">new_levels</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">ind2</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, [</span><span class="s1">levels</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">new_levels</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]])</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s3"># level changing multiple levels [w/o mutation]</span>
    <span class="s1">ind2 </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">new_levels</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">ind2</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">new_levels</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">levels</span><span class="s2">)</span>

    <span class="s3"># illegal level changing should not change levels</span>
    <span class="s3"># GH 13754</span>
    <span class="s1">original_index </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;^On&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">([</span><span class="s5">&quot;c&quot;</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">original_index</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">check_dtype</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;^On&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">original_index</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">check_dtype</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;^Levels&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s5">&quot;c&quot;</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">original_index</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">check_dtype</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;^Codes&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">original_index</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">check_dtype</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_codes</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">):</span>
    <span class="s3"># side note - you probably wouldn't want to use levels and codes</span>
    <span class="s3"># directly like this - but it is possible.</span>
    <span class="s1">codes </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span>
    <span class="s1">major_codes</span><span class="s2">, </span><span class="s1">minor_codes </span><span class="s2">= </span><span class="s1">codes</span>
    <span class="s1">major_codes </span><span class="s2">= [(</span><span class="s1">x </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">) % </span><span class="s4">3 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">major_codes</span><span class="s2">]</span>
    <span class="s1">minor_codes </span><span class="s2">= [(</span><span class="s1">x </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">) % </span><span class="s4">1 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">minor_codes</span><span class="s2">]</span>
    <span class="s1">new_codes </span><span class="s2">= [</span><span class="s1">major_codes</span><span class="s2">, </span><span class="s1">minor_codes</span><span class="s2">]</span>

    <span class="s3"># changing codes w/o mutation</span>
    <span class="s1">ind2 </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s1">new_codes</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">ind2</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">new_codes</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">)</span>

    <span class="s3"># codes changing specific level w/o mutation</span>
    <span class="s1">ind2 </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s1">new_codes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">ind2</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, [</span><span class="s1">new_codes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">codes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]])</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">)</span>

    <span class="s1">ind2 </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s1">new_codes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">ind2</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, [</span><span class="s1">codes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">new_codes</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]])</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">)</span>

    <span class="s3"># codes changing multiple levels w/o mutation</span>
    <span class="s1">ind2 </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s1">new_codes</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">ind2</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">new_codes</span><span class="s2">)</span>
    <span class="s1">assert_matching</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">codes</span><span class="s2">)</span>

    <span class="s3"># label changing for levels of different magnitude of categories</span>
    <span class="s1">ind </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">130</span><span class="s2">)])</span>
    <span class="s1">new_codes </span><span class="s2">= </span><span class="s1">range</span><span class="s2">(</span><span class="s4">129</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">([(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">new_codes</span><span class="s2">])</span>

    <span class="s3"># [w/o mutation]</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">ind</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s1">codes</span><span class="s2">=</span><span class="s1">new_codes</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">equals</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_levels_codes_names_bad_input</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">):</span>
    <span class="s1">levels</span><span class="s2">, </span><span class="s1">codes </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">codes</span>
    <span class="s1">names </span><span class="s2">= </span><span class="s1">idx</span><span class="s2">.</span><span class="s1">names</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Length of levels&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">([</span><span class="s1">levels</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Length of codes&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">([</span><span class="s1">codes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Length of names&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">([</span><span class="s1">names</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]])</span>

    <span class="s3"># shouldn't scalar data error, instead should demand list-like</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;list of lists-like&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])</span>

    <span class="s3"># shouldn't scalar data error, instead should demand list-like</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;list of lists-like&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s1">codes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])</span>

    <span class="s3"># shouldn't scalar data error, instead should demand list-like</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;list-like&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">names</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])</span>

    <span class="s3"># should have equal lengths</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;list of lists-like&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;list-like&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>

    <span class="s3"># should have equal lengths</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;list of lists-like&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s1">codes</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;list-like&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">(</span><span class="s1">codes</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>

    <span class="s3"># should have equal lengths</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Length of names&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">names</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">level</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Names must be a&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s1">names</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;inplace&quot;</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_set_names_with_nlevel_1</span><span class="s2">(</span><span class="s1">inplace</span><span class="s2">):</span>
    <span class="s3"># GH 21149</span>
    <span class="s3"># Ensure that .set_names for MultiIndex with</span>
    <span class="s3"># nlevels == 1 does not raise any errors</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">=[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]], </span><span class="s1">codes</span><span class="s2">=[[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;first&quot;</span><span class="s2">])</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_product</span><span class="s2">([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">m</span><span class="s2">.</span><span class="s1">set_names</span><span class="s2">(</span><span class="s5">&quot;first&quot;</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">, </span><span class="s1">inplace</span><span class="s2">=</span><span class="s1">inplace</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">inplace</span><span class="s2">:</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">m</span>

    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;ordered&quot;</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_set_levels_categorical</span><span class="s2">(</span><span class="s1">ordered</span><span class="s2">):</span>
    <span class="s3"># GH13854</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">list</span><span class="s2">(</span><span class="s5">&quot;xyzx&quot;</span><span class="s2">), [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]])</span>

    <span class="s1">cidx </span><span class="s2">= </span><span class="s1">CategoricalIndex</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s5">&quot;bac&quot;</span><span class="s2">), </span><span class="s1">ordered</span><span class="s2">=</span><span class="s1">ordered</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">cidx</span><span class="s2">, </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">=[</span><span class="s1">cidx</span><span class="s2">, [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]], </span><span class="s1">codes</span><span class="s2">=</span><span class="s1">index</span><span class="s2">.</span><span class="s1">codes</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s1">result_lvl </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">get_level_values</span><span class="s2">(</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">expected_lvl </span><span class="s2">= </span><span class="s1">CategoricalIndex</span><span class="s2">(</span>
        <span class="s1">list</span><span class="s2">(</span><span class="s5">&quot;bacb&quot;</span><span class="s2">), </span><span class="s1">categories</span><span class="s2">=</span><span class="s1">cidx</span><span class="s2">.</span><span class="s1">categories</span><span class="s2">, </span><span class="s1">ordered</span><span class="s2">=</span><span class="s1">cidx</span><span class="s2">.</span><span class="s1">ordered</span>
    <span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result_lvl</span><span class="s2">, </span><span class="s1">expected_lvl</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_value_keeps_names</span><span class="s2">():</span>
    <span class="s3"># motivating example from #3742</span>
    <span class="s1">lev1 </span><span class="s2">= [</span><span class="s5">&quot;hans&quot;</span><span class="s2">, </span><span class="s5">&quot;hans&quot;</span><span class="s2">, </span><span class="s5">&quot;hans&quot;</span><span class="s2">, </span><span class="s5">&quot;grethe&quot;</span><span class="s2">, </span><span class="s5">&quot;grethe&quot;</span><span class="s2">, </span><span class="s5">&quot;grethe&quot;</span><span class="s2">]</span>
    <span class="s1">lev2 </span><span class="s2">= [</span><span class="s5">&quot;1&quot;</span><span class="s2">, </span><span class="s5">&quot;2&quot;</span><span class="s2">, </span><span class="s5">&quot;3&quot;</span><span class="s2">] * </span><span class="s4">2</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">lev1</span><span class="s2">, </span><span class="s1">lev2</span><span class="s2">], </span><span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;Name&quot;</span><span class="s2">, </span><span class="s5">&quot;Number&quot;</span><span class="s2">])</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s4">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s4">6</span><span class="s2">, </span><span class="s4">4</span><span class="s2">)),</span>
        <span class="s1">columns</span><span class="s2">=[</span><span class="s5">&quot;one&quot;</span><span class="s2">, </span><span class="s5">&quot;two&quot;</span><span class="s2">, </span><span class="s5">&quot;three&quot;</span><span class="s2">, </span><span class="s5">&quot;four&quot;</span><span class="s2">],</span>
        <span class="s1">index</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">sort_index</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">df</span><span class="s2">.</span><span class="s1">_is_copy </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">df</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== (</span><span class="s5">&quot;Name&quot;</span><span class="s2">, </span><span class="s5">&quot;Number&quot;</span><span class="s2">)</span>
    <span class="s1">df</span><span class="s2">.</span><span class="s1">at</span><span class="s2">[(</span><span class="s5">&quot;grethe&quot;</span><span class="s2">, </span><span class="s5">&quot;4&quot;</span><span class="s2">), </span><span class="s5">&quot;one&quot;</span><span class="s2">] = </span><span class="s4">99.34</span>
    <span class="s0">assert </span><span class="s1">df</span><span class="s2">.</span><span class="s1">_is_copy </span><span class="s0">is None</span>
    <span class="s0">assert </span><span class="s1">df</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">names </span><span class="s2">== (</span><span class="s5">&quot;Name&quot;</span><span class="s2">, </span><span class="s5">&quot;Number&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_levels_with_iterable</span><span class="s2">():</span>
    <span class="s3"># GH23273</span>
    <span class="s1">sizes </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">colors </span><span class="s2">= [</span><span class="s5">&quot;black&quot;</span><span class="s2">] * </span><span class="s4">3</span>
    <span class="s1">index </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">sizes</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">], </span><span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;size&quot;</span><span class="s2">, </span><span class="s5">&quot;color&quot;</span><span class="s2">])</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">map</span><span class="s2">(</span><span class="s1">int</span><span class="s2">, [</span><span class="s5">&quot;3&quot;</span><span class="s2">, </span><span class="s5">&quot;2&quot;</span><span class="s2">, </span><span class="s5">&quot;1&quot;</span><span class="s2">]), </span><span class="s1">level</span><span class="s2">=</span><span class="s5">&quot;size&quot;</span><span class="s2">)</span>

    <span class="s1">expected_sizes </span><span class="s2">= [</span><span class="s4">3</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">expected_sizes</span><span class="s2">, </span><span class="s1">colors</span><span class="s2">], </span><span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;size&quot;</span><span class="s2">, </span><span class="s5">&quot;color&quot;</span><span class="s2">])</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_empty_level</span><span class="s2">():</span>
    <span class="s3"># GH#48636</span>
    <span class="s1">midx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([[]], </span><span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;A&quot;</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">midx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">([]), </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">([])], </span><span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;A&quot;</span><span class="s2">])</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_levels_pos_args_removal</span><span class="s2">():</span>
    <span class="s3"># https://github.com/pandas-dev/pandas/issues/41485</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_tuples</span><span class="s2">(</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s5">&quot;one&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s4">3</span><span class="s2">, </span><span class="s5">&quot;one&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
        <span class="s1">names</span><span class="s2">=[</span><span class="s5">&quot;foo&quot;</span><span class="s2">, </span><span class="s5">&quot;bar&quot;</span><span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;positional arguments&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">([</span><span class="s5">&quot;a&quot;</span><span class="s2">, </span><span class="s5">&quot;b&quot;</span><span class="s2">, </span><span class="s5">&quot;c&quot;</span><span class="s2">], </span><span class="s4">0</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;positional arguments&quot;</span><span class="s2">):</span>
        <span class="s1">idx</span><span class="s2">.</span><span class="s1">set_codes</span><span class="s2">([[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">]], </span><span class="s4">0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_set_levels_categorical_keep_dtype</span><span class="s2">():</span>
    <span class="s3"># GH#52125</span>
    <span class="s1">midx </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([[</span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">]])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">midx</span><span class="s2">.</span><span class="s1">set_levels</span><span class="s2">(</span><span class="s1">levels</span><span class="s2">=</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Categorical</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">]), </span><span class="s1">level</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Categorical</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])])</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
</pre>
</body>
</html>