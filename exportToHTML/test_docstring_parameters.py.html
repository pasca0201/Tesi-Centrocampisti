<html>
<head>
<title>test_docstring_parameters.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_docstring_parameters.py</font>
</center></td></tr></table>
<pre><span class="s0"># Authors: Alexandre Gramfort &lt;alexandre.gramfort@inria.fr&gt;</span>
<span class="s0">#          Raghav RV &lt;rvraghav93@gmail.com&gt;</span>
<span class="s0"># License: BSD 3 clause</span>

<span class="s2">import </span><span class="s1">importlib</span>
<span class="s2">import </span><span class="s1">inspect</span>
<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">warnings</span>
<span class="s2">from </span><span class="s1">inspect </span><span class="s2">import </span><span class="s1">signature</span>
<span class="s2">from </span><span class="s1">pkgutil </span><span class="s2">import </span><span class="s1">walk_packages</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>

<span class="s2">import </span><span class="s1">sklearn</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">datasets </span><span class="s2">import </span><span class="s1">make_classification</span>

<span class="s0"># make it possible to discover experimental estimators when calling `all_estimators`</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">experimental </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">enable_halving_search_cv</span><span class="s3">,  </span><span class="s0"># noqa</span>
    <span class="s1">enable_iterative_imputer</span><span class="s3">,  </span><span class="s0"># noqa</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">linear_model </span><span class="s2">import </span><span class="s1">LogisticRegression</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">preprocessing </span><span class="s2">import </span><span class="s1">FunctionTransformer</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">utils </span><span class="s2">import </span><span class="s1">all_estimators</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">utils</span><span class="s3">.</span><span class="s1">_testing </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">_get_func_name</span><span class="s3">,</span>
    <span class="s1">check_docstring_parameters</span><span class="s3">,</span>
    <span class="s1">ignore_warnings</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">utils</span><span class="s3">.</span><span class="s1">deprecation </span><span class="s2">import </span><span class="s1">_is_deprecated</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">utils</span><span class="s3">.</span><span class="s1">estimator_checks </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">_construct_instance</span><span class="s3">,</span>
    <span class="s1">_enforce_estimator_tags_X</span><span class="s3">,</span>
    <span class="s1">_enforce_estimator_tags_y</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">utils</span><span class="s3">.</span><span class="s1">fixes </span><span class="s2">import </span><span class="s1">_IS_PYPY</span><span class="s3">, </span><span class="s1">parse_version</span><span class="s3">, </span><span class="s1">sp_version</span>

<span class="s0"># walk_packages() ignores DeprecationWarnings, now we need to ignore</span>
<span class="s0"># FutureWarnings</span>
<span class="s2">with </span><span class="s1">warnings</span><span class="s3">.</span><span class="s1">catch_warnings</span><span class="s3">():</span>
    <span class="s1">warnings</span><span class="s3">.</span><span class="s1">simplefilter</span><span class="s3">(</span><span class="s4">&quot;ignore&quot;</span><span class="s3">, </span><span class="s1">FutureWarning</span><span class="s3">)</span>
    <span class="s0"># mypy error: Module has no attribute &quot;__path__&quot;</span>
    <span class="s1">sklearn_path </span><span class="s3">= [</span><span class="s1">os</span><span class="s3">.</span><span class="s1">path</span><span class="s3">.</span><span class="s1">dirname</span><span class="s3">(</span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">__file__</span><span class="s3">)]</span>
    <span class="s1">PUBLIC_MODULES </span><span class="s3">= </span><span class="s1">set</span><span class="s3">(</span>
        <span class="s3">[</span>
            <span class="s1">pckg</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]</span>
            <span class="s2">for </span><span class="s1">pckg </span><span class="s2">in </span><span class="s1">walk_packages</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">=</span><span class="s4">&quot;sklearn.&quot;</span><span class="s3">, </span><span class="s1">path</span><span class="s3">=</span><span class="s1">sklearn_path</span><span class="s3">)</span>
            <span class="s2">if not </span><span class="s3">(</span><span class="s4">&quot;._&quot; </span><span class="s2">in </span><span class="s1">pckg</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] </span><span class="s2">or </span><span class="s4">&quot;.tests.&quot; </span><span class="s2">in </span><span class="s1">pckg</span><span class="s3">[</span><span class="s5">1</span><span class="s3">])</span>
        <span class="s3">]</span>
    <span class="s3">)</span>

<span class="s0"># functions to ignore args / docstring of</span>
<span class="s0"># TODO(1.7): remove &quot;sklearn.utils._joblib&quot;</span>
<span class="s1">_DOCSTRING_IGNORES </span><span class="s3">= [</span>
    <span class="s4">&quot;sklearn.utils.deprecation.load_mlcomp&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;sklearn.pipeline.make_pipeline&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;sklearn.pipeline.make_union&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;sklearn.utils.extmath.safe_sparse_dot&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;sklearn.utils._joblib&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;HalfBinomialLoss&quot;</span><span class="s3">,</span>
<span class="s3">]</span>

<span class="s0"># Methods where y param should be ignored if y=None by default</span>
<span class="s1">_METHODS_IGNORE_NONE_Y </span><span class="s3">= [</span>
    <span class="s4">&quot;fit&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;score&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;fit_predict&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;fit_transform&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;partial_fit&quot;</span><span class="s3">,</span>
    <span class="s4">&quot;predict&quot;</span><span class="s3">,</span>
<span class="s3">]</span>


<span class="s0"># numpydoc 0.8.0's docscrape tool raises because of collections.abc under</span>
<span class="s0"># Python 3.7</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s4">&quot;ignore::FutureWarning&quot;</span><span class="s3">)</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s4">&quot;ignore::DeprecationWarning&quot;</span><span class="s3">)</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">skipif</span><span class="s3">(</span><span class="s1">_IS_PYPY</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">=</span><span class="s4">&quot;test segfaults on PyPy&quot;</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">test_docstring_parameters</span><span class="s3">():</span>
    <span class="s0"># Test module docstring formatting</span>

    <span class="s0"># Skip test if numpydoc is not found</span>
    <span class="s1">pytest</span><span class="s3">.</span><span class="s1">importorskip</span><span class="s3">(</span>
        <span class="s4">&quot;numpydoc&quot;</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">=</span><span class="s4">&quot;numpydoc is required to test the docstrings&quot;</span>
    <span class="s3">)</span>

    <span class="s0"># XXX unreached code as of v0.22</span>
    <span class="s2">from </span><span class="s1">numpydoc </span><span class="s2">import </span><span class="s1">docscrape</span>

    <span class="s1">incorrect </span><span class="s3">= []</span>
    <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">PUBLIC_MODULES</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">name</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s4">&quot;.conftest&quot;</span><span class="s3">):</span>
            <span class="s0"># pytest tooling, not part of the scikit-learn API</span>
            <span class="s2">continue</span>
        <span class="s2">if </span><span class="s1">name </span><span class="s3">== </span><span class="s4">&quot;sklearn.utils.fixes&quot;</span><span class="s3">:</span>
            <span class="s0"># We cannot always control these docstrings</span>
            <span class="s2">continue</span>
        <span class="s2">with </span><span class="s1">warnings</span><span class="s3">.</span><span class="s1">catch_warnings</span><span class="s3">(</span><span class="s1">record</span><span class="s3">=</span><span class="s2">True</span><span class="s3">):</span>
            <span class="s1">module </span><span class="s3">= </span><span class="s1">importlib</span><span class="s3">.</span><span class="s1">import_module</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>
        <span class="s1">classes </span><span class="s3">= </span><span class="s1">inspect</span><span class="s3">.</span><span class="s1">getmembers</span><span class="s3">(</span><span class="s1">module</span><span class="s3">, </span><span class="s1">inspect</span><span class="s3">.</span><span class="s1">isclass</span><span class="s3">)</span>
        <span class="s0"># Exclude non-scikit-learn classes</span>
        <span class="s1">classes </span><span class="s3">= [</span><span class="s1">cls </span><span class="s2">for </span><span class="s1">cls </span><span class="s2">in </span><span class="s1">classes </span><span class="s2">if </span><span class="s1">cls</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">__module__</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;sklearn&quot;</span><span class="s3">)]</span>
        <span class="s2">for </span><span class="s1">cname</span><span class="s3">, </span><span class="s1">cls </span><span class="s2">in </span><span class="s1">classes</span><span class="s3">:</span>
            <span class="s1">this_incorrect </span><span class="s3">= []</span>
            <span class="s2">if </span><span class="s1">cname </span><span class="s2">in </span><span class="s1">_DOCSTRING_IGNORES </span><span class="s2">or </span><span class="s1">cname</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;_&quot;</span><span class="s3">):</span>
                <span class="s2">continue</span>
            <span class="s2">if </span><span class="s1">inspect</span><span class="s3">.</span><span class="s1">isabstract</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">):</span>
                <span class="s2">continue</span>
            <span class="s2">with </span><span class="s1">warnings</span><span class="s3">.</span><span class="s1">catch_warnings</span><span class="s3">(</span><span class="s1">record</span><span class="s3">=</span><span class="s2">True</span><span class="s3">) </span><span class="s2">as </span><span class="s1">w</span><span class="s3">:</span>
                <span class="s1">cdoc </span><span class="s3">= </span><span class="s1">docscrape</span><span class="s3">.</span><span class="s1">ClassDoc</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">)</span>
            <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">w</span><span class="s3">):</span>
                <span class="s2">raise </span><span class="s1">RuntimeError</span><span class="s3">(</span>
                    <span class="s4">&quot;Error for __init__ of %s in %s:</span><span class="s2">\n</span><span class="s4">%s&quot; </span><span class="s3">% (</span><span class="s1">cls</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">w</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
                <span class="s3">)</span>

            <span class="s0"># Skip checks on deprecated classes</span>
            <span class="s2">if </span><span class="s1">_is_deprecated</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">.</span><span class="s1">__new__</span><span class="s3">):</span>
                <span class="s2">continue</span>

            <span class="s1">this_incorrect </span><span class="s3">+= </span><span class="s1">check_docstring_parameters</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">.</span><span class="s1">__init__</span><span class="s3">, </span><span class="s1">cdoc</span><span class="s3">)</span>

            <span class="s2">for </span><span class="s1">method_name </span><span class="s2">in </span><span class="s1">cdoc</span><span class="s3">.</span><span class="s1">methods</span><span class="s3">:</span>
                <span class="s1">method </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">, </span><span class="s1">method_name</span><span class="s3">)</span>
                <span class="s2">if </span><span class="s1">_is_deprecated</span><span class="s3">(</span><span class="s1">method</span><span class="s3">):</span>
                    <span class="s2">continue</span>
                <span class="s1">param_ignore </span><span class="s3">= </span><span class="s2">None</span>
                <span class="s0"># Now skip docstring test for y when y is None</span>
                <span class="s0"># by default for API reason</span>
                <span class="s2">if </span><span class="s1">method_name </span><span class="s2">in </span><span class="s1">_METHODS_IGNORE_NONE_Y</span><span class="s3">:</span>
                    <span class="s1">sig </span><span class="s3">= </span><span class="s1">signature</span><span class="s3">(</span><span class="s1">method</span><span class="s3">)</span>
                    <span class="s2">if </span><span class="s4">&quot;y&quot; </span><span class="s2">in </span><span class="s1">sig</span><span class="s3">.</span><span class="s1">parameters </span><span class="s2">and </span><span class="s1">sig</span><span class="s3">.</span><span class="s1">parameters</span><span class="s3">[</span><span class="s4">&quot;y&quot;</span><span class="s3">].</span><span class="s1">default </span><span class="s2">is None</span><span class="s3">:</span>
                        <span class="s1">param_ignore </span><span class="s3">= [</span><span class="s4">&quot;y&quot;</span><span class="s3">]  </span><span class="s0"># ignore y for fit and score</span>
                <span class="s1">result </span><span class="s3">= </span><span class="s1">check_docstring_parameters</span><span class="s3">(</span><span class="s1">method</span><span class="s3">, </span><span class="s1">ignore</span><span class="s3">=</span><span class="s1">param_ignore</span><span class="s3">)</span>
                <span class="s1">this_incorrect </span><span class="s3">+= </span><span class="s1">result</span>

            <span class="s1">incorrect </span><span class="s3">+= </span><span class="s1">this_incorrect</span>

        <span class="s1">functions </span><span class="s3">= </span><span class="s1">inspect</span><span class="s3">.</span><span class="s1">getmembers</span><span class="s3">(</span><span class="s1">module</span><span class="s3">, </span><span class="s1">inspect</span><span class="s3">.</span><span class="s1">isfunction</span><span class="s3">)</span>
        <span class="s0"># Exclude imported functions</span>
        <span class="s1">functions </span><span class="s3">= [</span><span class="s1">fn </span><span class="s2">for </span><span class="s1">fn </span><span class="s2">in </span><span class="s1">functions </span><span class="s2">if </span><span class="s1">fn</span><span class="s3">[</span><span class="s5">1</span><span class="s3">].</span><span class="s1">__module__ </span><span class="s3">== </span><span class="s1">name</span><span class="s3">]</span>
        <span class="s2">for </span><span class="s1">fname</span><span class="s3">, </span><span class="s1">func </span><span class="s2">in </span><span class="s1">functions</span><span class="s3">:</span>
            <span class="s0"># Don't test private methods / functions</span>
            <span class="s2">if </span><span class="s1">fname</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;_&quot;</span><span class="s3">):</span>
                <span class="s2">continue</span>
            <span class="s2">if </span><span class="s1">fname </span><span class="s3">== </span><span class="s4">&quot;configuration&quot; </span><span class="s2">and </span><span class="s1">name</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s4">&quot;setup&quot;</span><span class="s3">):</span>
                <span class="s2">continue</span>
            <span class="s1">name_ </span><span class="s3">= </span><span class="s1">_get_func_name</span><span class="s3">(</span><span class="s1">func</span><span class="s3">)</span>
            <span class="s2">if not </span><span class="s1">any</span><span class="s3">(</span><span class="s1">d </span><span class="s2">in </span><span class="s1">name_ </span><span class="s2">for </span><span class="s1">d </span><span class="s2">in </span><span class="s1">_DOCSTRING_IGNORES</span><span class="s3">) </span><span class="s2">and not </span><span class="s1">_is_deprecated</span><span class="s3">(</span>
                <span class="s1">func</span>
            <span class="s3">):</span>
                <span class="s1">incorrect </span><span class="s3">+= </span><span class="s1">check_docstring_parameters</span><span class="s3">(</span><span class="s1">func</span><span class="s3">)</span>

    <span class="s1">msg </span><span class="s3">= </span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">incorrect</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">incorrect</span><span class="s3">) &gt; </span><span class="s5">0</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span><span class="s4">&quot;Docstring Error:</span><span class="s2">\n</span><span class="s4">&quot; </span><span class="s3">+ </span><span class="s1">msg</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_construct_searchcv_instance</span><span class="s3">(</span><span class="s1">SearchCV</span><span class="s3">):</span>
    <span class="s2">return </span><span class="s1">SearchCV</span><span class="s3">(</span><span class="s1">LogisticRegression</span><span class="s3">(), {</span><span class="s4">&quot;C&quot;</span><span class="s3">: [</span><span class="s5">0.1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">]})</span>


<span class="s2">def </span><span class="s1">_construct_compose_pipeline_instance</span><span class="s3">(</span><span class="s1">Estimator</span><span class="s3">):</span>
    <span class="s0"># Minimal / degenerate instances: only useful to test the docstrings.</span>
    <span class="s2">if </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;ColumnTransformer&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">Estimator</span><span class="s3">(</span><span class="s1">transformers</span><span class="s3">=[(</span><span class="s4">&quot;transformer&quot;</span><span class="s3">, </span><span class="s4">&quot;passthrough&quot;</span><span class="s3">, [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">])])</span>
    <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;Pipeline&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">Estimator</span><span class="s3">(</span><span class="s1">steps</span><span class="s3">=[(</span><span class="s4">&quot;clf&quot;</span><span class="s3">, </span><span class="s1">LogisticRegression</span><span class="s3">())])</span>
    <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;FeatureUnion&quot;</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">Estimator</span><span class="s3">(</span><span class="s1">transformer_list</span><span class="s3">=[(</span><span class="s4">&quot;transformer&quot;</span><span class="s3">, </span><span class="s1">FunctionTransformer</span><span class="s3">())])</span>


<span class="s2">def </span><span class="s1">_construct_sparse_coder</span><span class="s3">(</span><span class="s1">Estimator</span><span class="s3">):</span>
    <span class="s0"># XXX: hard-coded assumption that n_features=3</span>
    <span class="s1">dictionary </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span>
        <span class="s3">[[</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">0</span><span class="s3">], [-</span><span class="s5">1</span><span class="s3">, -</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">], [</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s3">], [</span><span class="s5">0</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">1</span><span class="s3">]],</span>
        <span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">float64</span><span class="s3">,</span>
    <span class="s3">)</span>
    <span class="s2">return </span><span class="s1">Estimator</span><span class="s3">(</span><span class="s1">dictionary</span><span class="s3">=</span><span class="s1">dictionary</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">ignore_warnings</span><span class="s3">(</span><span class="s1">category</span><span class="s3">=</span><span class="s1">sklearn</span><span class="s3">.</span><span class="s1">exceptions</span><span class="s3">.</span><span class="s1">ConvergenceWarning</span><span class="s3">)</span>
<span class="s0"># TODO(1.6): remove &quot;@pytest.mark.filterwarnings&quot; as SAMME.R will be removed</span>
<span class="s0"># and substituted with the SAMME algorithm as a default</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s4">&quot;ignore:The SAMME.R algorithm&quot;</span><span class="s3">)</span>
<span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s4">&quot;name, Estimator&quot;</span><span class="s3">, </span><span class="s1">all_estimators</span><span class="s3">())</span>
<span class="s2">def </span><span class="s1">test_fit_docstring_attributes</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">Estimator</span><span class="s3">):</span>
    <span class="s1">pytest</span><span class="s3">.</span><span class="s1">importorskip</span><span class="s3">(</span><span class="s4">&quot;numpydoc&quot;</span><span class="s3">)</span>
    <span class="s2">from </span><span class="s1">numpydoc </span><span class="s2">import </span><span class="s1">docscrape</span>

    <span class="s1">doc </span><span class="s3">= </span><span class="s1">docscrape</span><span class="s3">.</span><span class="s1">ClassDoc</span><span class="s3">(</span><span class="s1">Estimator</span><span class="s3">)</span>
    <span class="s1">attributes </span><span class="s3">= </span><span class="s1">doc</span><span class="s3">[</span><span class="s4">&quot;Attributes&quot;</span><span class="s3">]</span>

    <span class="s2">if </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s2">in </span><span class="s3">(</span>
        <span class="s4">&quot;HalvingRandomSearchCV&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;RandomizedSearchCV&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;HalvingGridSearchCV&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;GridSearchCV&quot;</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s1">est </span><span class="s3">= </span><span class="s1">_construct_searchcv_instance</span><span class="s3">(</span><span class="s1">Estimator</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s2">in </span><span class="s3">(</span>
        <span class="s4">&quot;ColumnTransformer&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;Pipeline&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;FeatureUnion&quot;</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s1">est </span><span class="s3">= </span><span class="s1">_construct_compose_pipeline_instance</span><span class="s3">(</span><span class="s1">Estimator</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;SparseCoder&quot;</span><span class="s3">:</span>
        <span class="s1">est </span><span class="s3">= </span><span class="s1">_construct_sparse_coder</span><span class="s3">(</span><span class="s1">Estimator</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">est </span><span class="s3">= </span><span class="s1">_construct_instance</span><span class="s3">(</span><span class="s1">Estimator</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;SelectKBest&quot;</span><span class="s3">:</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">k</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;DummyClassifier&quot;</span><span class="s3">:</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">strategy</span><span class="s3">=</span><span class="s4">&quot;stratified&quot;</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;CCA&quot; </span><span class="s2">or </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;PLS&quot;</span><span class="s3">):</span>
        <span class="s0"># default = 2 is invalid for single target</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">n_components</span><span class="s3">=</span><span class="s5">1</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s2">in </span><span class="s3">(</span>
        <span class="s4">&quot;GaussianRandomProjection&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;SparseRandomProjection&quot;</span><span class="s3">,</span>
    <span class="s3">):</span>
        <span class="s0"># default=&quot;auto&quot; raises an error with the shape of `X`</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">n_components</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;TSNE&quot;</span><span class="s3">:</span>
        <span class="s0"># default raises an error, perplexity must be less than n_samples</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">perplexity</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)</span>

    <span class="s0"># TODO(1.6): remove (avoid FutureWarning)</span>
    <span class="s2">if </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s2">in </span><span class="s3">(</span><span class="s4">&quot;NMF&quot;</span><span class="s3">, </span><span class="s4">&quot;MiniBatchNMF&quot;</span><span class="s3">):</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">n_components</span><span class="s3">=</span><span class="s4">&quot;auto&quot;</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;QuantileRegressor&quot;</span><span class="s3">:</span>
        <span class="s1">solver </span><span class="s3">= </span><span class="s4">&quot;highs&quot; </span><span class="s2">if </span><span class="s1">sp_version </span><span class="s3">&gt;= </span><span class="s1">parse_version</span><span class="s3">(</span><span class="s4">&quot;1.6.0&quot;</span><span class="s3">) </span><span class="s2">else </span><span class="s4">&quot;interior-point&quot;</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">solver</span><span class="s3">=</span><span class="s1">solver</span><span class="s3">)</span>

    <span class="s0"># Low max iter to speed up tests: we are only interested in checking the existence</span>
    <span class="s0"># of fitted attributes. This should be invariant to whether it has converged or not.</span>
    <span class="s2">if </span><span class="s4">&quot;max_iter&quot; </span><span class="s2">in </span><span class="s1">est</span><span class="s3">.</span><span class="s1">get_params</span><span class="s3">():</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">max_iter</span><span class="s3">=</span><span class="s5">2</span><span class="s3">)</span>
        <span class="s0"># min value for `TSNE` is 250</span>
        <span class="s2">if </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;TSNE&quot;</span><span class="s3">:</span>
            <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">max_iter</span><span class="s3">=</span><span class="s5">250</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s4">&quot;random_state&quot; </span><span class="s2">in </span><span class="s1">est</span><span class="s3">.</span><span class="s1">get_params</span><span class="s3">():</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">set_params</span><span class="s3">(</span><span class="s1">random_state</span><span class="s3">=</span><span class="s5">0</span><span class="s3">)</span>

    <span class="s0"># In case we want to deprecate some attributes in the future</span>
    <span class="s1">skipped_attributes </span><span class="s3">= {}</span>

    <span class="s2">if </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s4">&quot;Vectorizer&quot;</span><span class="s3">):</span>
        <span class="s0"># Vectorizer require some specific input data</span>
        <span class="s2">if </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s2">in </span><span class="s3">(</span>
            <span class="s4">&quot;CountVectorizer&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;HashingVectorizer&quot;</span><span class="s3">,</span>
            <span class="s4">&quot;TfidfVectorizer&quot;</span><span class="s3">,</span>
        <span class="s3">):</span>
            <span class="s1">X </span><span class="s3">= [</span>
                <span class="s4">&quot;This is the first document.&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;This document is the second document.&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;And this is the third one.&quot;</span><span class="s3">,</span>
                <span class="s4">&quot;Is this the first document?&quot;</span><span class="s3">,</span>
            <span class="s3">]</span>
        <span class="s2">elif </span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__ </span><span class="s3">== </span><span class="s4">&quot;DictVectorizer&quot;</span><span class="s3">:</span>
            <span class="s1">X </span><span class="s3">= [{</span><span class="s4">&quot;foo&quot;</span><span class="s3">: </span><span class="s5">1</span><span class="s3">, </span><span class="s4">&quot;bar&quot;</span><span class="s3">: </span><span class="s5">2</span><span class="s3">}, {</span><span class="s4">&quot;foo&quot;</span><span class="s3">: </span><span class="s5">3</span><span class="s3">, </span><span class="s4">&quot;baz&quot;</span><span class="s3">: </span><span class="s5">1</span><span class="s3">}]</span>
        <span class="s1">y </span><span class="s3">= </span><span class="s2">None</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">X</span><span class="s3">, </span><span class="s1">y </span><span class="s3">= </span><span class="s1">make_classification</span><span class="s3">(</span>
            <span class="s1">n_samples</span><span class="s3">=</span><span class="s5">20</span><span class="s3">,</span>
            <span class="s1">n_features</span><span class="s3">=</span><span class="s5">3</span><span class="s3">,</span>
            <span class="s1">n_redundant</span><span class="s3">=</span><span class="s5">0</span><span class="s3">,</span>
            <span class="s1">n_classes</span><span class="s3">=</span><span class="s5">2</span><span class="s3">,</span>
            <span class="s1">random_state</span><span class="s3">=</span><span class="s5">2</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s1">y </span><span class="s3">= </span><span class="s1">_enforce_estimator_tags_y</span><span class="s3">(</span><span class="s1">est</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>
        <span class="s1">X </span><span class="s3">= </span><span class="s1">_enforce_estimator_tags_X</span><span class="s3">(</span><span class="s1">est</span><span class="s3">, </span><span class="s1">X</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s4">&quot;1dlabels&quot; </span><span class="s2">in </span><span class="s1">est</span><span class="s3">.</span><span class="s1">_get_tags</span><span class="s3">()[</span><span class="s4">&quot;X_types&quot;</span><span class="s3">]:</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">y</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s4">&quot;2dlabels&quot; </span><span class="s2">in </span><span class="s1">est</span><span class="s3">.</span><span class="s1">_get_tags</span><span class="s3">()[</span><span class="s4">&quot;X_types&quot;</span><span class="s3">]:</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">np</span><span class="s3">.</span><span class="s1">c_</span><span class="s3">[</span><span class="s1">y</span><span class="s3">, </span><span class="s1">y</span><span class="s3">])</span>
    <span class="s2">elif </span><span class="s4">&quot;3darray&quot; </span><span class="s2">in </span><span class="s1">est</span><span class="s3">.</span><span class="s1">_get_tags</span><span class="s3">()[</span><span class="s4">&quot;X_types&quot;</span><span class="s3">]:</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">[</span><span class="s1">np</span><span class="s3">.</span><span class="s1">newaxis</span><span class="s3">, ...], </span><span class="s1">y</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">est</span><span class="s3">.</span><span class="s1">fit</span><span class="s3">(</span><span class="s1">X</span><span class="s3">, </span><span class="s1">y</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">attr </span><span class="s2">in </span><span class="s1">attributes</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">attr</span><span class="s3">.</span><span class="s1">name </span><span class="s2">in </span><span class="s1">skipped_attributes</span><span class="s3">:</span>
            <span class="s2">continue</span>
        <span class="s1">desc </span><span class="s3">= </span><span class="s4">&quot; &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">attr</span><span class="s3">.</span><span class="s1">desc</span><span class="s3">).</span><span class="s1">lower</span><span class="s3">()</span>
        <span class="s0"># As certain attributes are present &quot;only&quot; if a certain parameter is</span>
        <span class="s0"># provided, this checks if the word &quot;only&quot; is present in the attribute</span>
        <span class="s0"># description, and if not the attribute is required to be present.</span>
        <span class="s2">if </span><span class="s4">&quot;only &quot; </span><span class="s2">in </span><span class="s1">desc</span><span class="s3">:</span>
            <span class="s2">continue</span>
        <span class="s0"># ignore deprecation warnings</span>
        <span class="s2">with </span><span class="s1">ignore_warnings</span><span class="s3">(</span><span class="s1">category</span><span class="s3">=</span><span class="s1">FutureWarning</span><span class="s3">):</span>
            <span class="s2">assert </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">est</span><span class="s3">, </span><span class="s1">attr</span><span class="s3">.</span><span class="s1">name</span><span class="s3">)</span>

    <span class="s1">fit_attr </span><span class="s3">= </span><span class="s1">_get_all_fitted_attributes</span><span class="s3">(</span><span class="s1">est</span><span class="s3">)</span>
    <span class="s1">fit_attr_names </span><span class="s3">= [</span><span class="s1">attr</span><span class="s3">.</span><span class="s1">name </span><span class="s2">for </span><span class="s1">attr </span><span class="s2">in </span><span class="s1">attributes</span><span class="s3">]</span>
    <span class="s1">undocumented_attrs </span><span class="s3">= </span><span class="s1">set</span><span class="s3">(</span><span class="s1">fit_attr</span><span class="s3">).</span><span class="s1">difference</span><span class="s3">(</span><span class="s1">fit_attr_names</span><span class="s3">)</span>
    <span class="s1">undocumented_attrs </span><span class="s3">= </span><span class="s1">set</span><span class="s3">(</span><span class="s1">undocumented_attrs</span><span class="s3">).</span><span class="s1">difference</span><span class="s3">(</span><span class="s1">skipped_attributes</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">undocumented_attrs</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">AssertionError</span><span class="s3">(</span>
            <span class="s4">f&quot;Undocumented attributes for </span><span class="s2">{</span><span class="s1">Estimator</span><span class="s3">.</span><span class="s1">__name__</span><span class="s2">}</span><span class="s4">: </span><span class="s2">{</span><span class="s1">undocumented_attrs</span><span class="s2">}</span><span class="s4">&quot;</span>
        <span class="s3">)</span>


<span class="s2">def </span><span class="s1">_get_all_fitted_attributes</span><span class="s3">(</span><span class="s1">estimator</span><span class="s3">):</span>
    <span class="s6">&quot;Get all the fitted attributes of an estimator including properties&quot;</span>
    <span class="s0"># attributes</span>
    <span class="s1">fit_attr </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">estimator</span><span class="s3">.</span><span class="s1">__dict__</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">())</span>

    <span class="s0"># properties</span>
    <span class="s2">with </span><span class="s1">warnings</span><span class="s3">.</span><span class="s1">catch_warnings</span><span class="s3">():</span>
        <span class="s1">warnings</span><span class="s3">.</span><span class="s1">filterwarnings</span><span class="s3">(</span><span class="s4">&quot;error&quot;</span><span class="s3">, </span><span class="s1">category</span><span class="s3">=</span><span class="s1">FutureWarning</span><span class="s3">)</span>

        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">dir</span><span class="s3">(</span><span class="s1">estimator</span><span class="s3">.</span><span class="s1">__class__</span><span class="s3">):</span>
            <span class="s1">obj </span><span class="s3">= </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">estimator</span><span class="s3">.</span><span class="s1">__class__</span><span class="s3">, </span><span class="s1">name</span><span class="s3">)</span>
            <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">, </span><span class="s1">property</span><span class="s3">):</span>
                <span class="s2">continue</span>

            <span class="s0"># ignore properties that raises an AttributeError and deprecated</span>
            <span class="s0"># properties</span>
            <span class="s2">try</span><span class="s3">:</span>
                <span class="s1">getattr</span><span class="s3">(</span><span class="s1">estimator</span><span class="s3">, </span><span class="s1">name</span><span class="s3">)</span>
            <span class="s2">except </span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">FutureWarning</span><span class="s3">):</span>
                <span class="s2">continue</span>
            <span class="s1">fit_attr</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)</span>

    <span class="s2">return </span><span class="s3">[</span><span class="s1">k </span><span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">fit_attr </span><span class="s2">if </span><span class="s1">k</span><span class="s3">.</span><span class="s1">endswith</span><span class="s3">(</span><span class="s4">&quot;_&quot;</span><span class="s3">) </span><span class="s2">and not </span><span class="s1">k</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s4">&quot;_&quot;</span><span class="s3">)]</span>
</pre>
</body>
</html>