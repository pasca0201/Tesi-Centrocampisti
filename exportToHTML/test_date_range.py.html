<html>
<head>
<title>test_date_range.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_date_range.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
test date_range, bdate_range construction from the convenience range functions 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">datetime </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">datetime</span><span class="s3">,</span>
    <span class="s1">time</span><span class="s3">,</span>
    <span class="s1">timedelta</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">re</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">import </span><span class="s1">pytz</span>
<span class="s2">from </span><span class="s1">pytz </span><span class="s2">import </span><span class="s1">timezone</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs </span><span class="s2">import </span><span class="s1">timezones</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs</span><span class="s3">.</span><span class="s1">offsets </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">BDay</span><span class="s3">,</span>
    <span class="s1">CDay</span><span class="s3">,</span>
    <span class="s1">DateOffset</span><span class="s3">,</span>
    <span class="s1">MonthEnd</span><span class="s3">,</span>
    <span class="s1">prefix_mapping</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">errors </span><span class="s2">import </span><span class="s1">OutOfBoundsDatetime</span>
<span class="s2">import </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">util</span><span class="s3">.</span><span class="s1">_test_decorators </span><span class="s2">as </span><span class="s1">td</span>

<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">from </span><span class="s1">pandas </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">DataFrame</span><span class="s3">,</span>
    <span class="s1">DatetimeIndex</span><span class="s3">,</span>
    <span class="s1">Series</span><span class="s3">,</span>
    <span class="s1">Timedelta</span><span class="s3">,</span>
    <span class="s1">Timestamp</span><span class="s3">,</span>
    <span class="s1">bdate_range</span><span class="s3">,</span>
    <span class="s1">date_range</span><span class="s3">,</span>
    <span class="s1">offsets</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_testing </span><span class="s2">as </span><span class="s1">tm</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">core</span><span class="s3">.</span><span class="s1">arrays</span><span class="s3">.</span><span class="s1">datetimes </span><span class="s2">import </span><span class="s1">_generate_range </span><span class="s2">as </span><span class="s1">generate_range</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">tests</span><span class="s3">.</span><span class="s1">indexes</span><span class="s3">.</span><span class="s1">datetimes</span><span class="s3">.</span><span class="s1">test_timezones </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">FixedOffset</span><span class="s3">,</span>
    <span class="s1">fixed_off_no_name</span><span class="s3">,</span>
<span class="s3">)</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">tseries</span><span class="s3">.</span><span class="s1">holiday </span><span class="s2">import </span><span class="s1">USFederalHolidayCalendar</span>

<span class="s1">START</span><span class="s3">, </span><span class="s1">END </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2009</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2010</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_get_expected_range</span><span class="s3">(</span>
    <span class="s1">begin_to_match</span><span class="s3">,</span>
    <span class="s1">end_to_match</span><span class="s3">,</span>
    <span class="s1">both_range</span><span class="s3">,</span>
    <span class="s1">inclusive_endpoints</span><span class="s3">,</span>
<span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Helper to get expected range from a both inclusive range&quot;&quot;&quot;</span>
    <span class="s1">left_match </span><span class="s3">= </span><span class="s1">begin_to_match </span><span class="s3">== </span><span class="s1">both_range</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>
    <span class="s1">right_match </span><span class="s3">= </span><span class="s1">end_to_match </span><span class="s3">== </span><span class="s1">both_range</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">]</span>

    <span class="s2">if </span><span class="s1">inclusive_endpoints </span><span class="s3">== </span><span class="s5">&quot;left&quot; </span><span class="s2">and </span><span class="s1">right_match</span><span class="s3">:</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints </span><span class="s3">== </span><span class="s5">&quot;right&quot; </span><span class="s2">and </span><span class="s1">left_match</span><span class="s3">:</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints </span><span class="s3">== </span><span class="s5">&quot;neither&quot; </span><span class="s2">and </span><span class="s1">left_match </span><span class="s2">and </span><span class="s1">right_match</span><span class="s3">:</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:-</span><span class="s4">1</span><span class="s3">]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints </span><span class="s3">== </span><span class="s5">&quot;neither&quot; </span><span class="s2">and </span><span class="s1">right_match</span><span class="s3">:</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints </span><span class="s3">== </span><span class="s5">&quot;neither&quot; </span><span class="s2">and </span><span class="s1">left_match</span><span class="s3">:</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:]</span>
    <span class="s2">elif </span><span class="s1">inclusive_endpoints </span><span class="s3">== </span><span class="s5">&quot;both&quot;</span><span class="s3">:</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[:]</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[:]</span>

    <span class="s2">return </span><span class="s1">expected_range</span>


<span class="s2">class </span><span class="s1">TestTimestampEquivDateRange</span><span class="s3">:</span>
    <span class="s6"># Older tests in TestTimeSeries constructed their `stamp` objects</span>
    <span class="s6"># using `date_range` instead of the `Timestamp` constructor.</span>
    <span class="s6"># TestTimestampEquivDateRange checks that these are equivalent in the</span>
    <span class="s6"># pertinent cases.</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;20090415&quot;</span><span class="s3">, </span><span class="s5">&quot;20090519&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">stamp </span><span class="s3">= </span><span class="s1">rng</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>

        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20090415&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">ts </span><span class="s3">== </span><span class="s1">stamp</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_dateutil</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;20090415&quot;</span><span class="s3">, </span><span class="s5">&quot;20090519&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;dateutil/US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">stamp </span><span class="s3">= </span><span class="s1">rng</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>

        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20090415&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;dateutil/US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">ts </span><span class="s3">== </span><span class="s1">stamp</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_explicit_pytz</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;20090415&quot;</span><span class="s3">, </span><span class="s5">&quot;20090519&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">pytz</span><span class="s3">.</span><span class="s1">timezone</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">))</span>
        <span class="s1">stamp </span><span class="s3">= </span><span class="s1">rng</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>

        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20090415&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">pytz</span><span class="s3">.</span><span class="s1">timezone</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">))</span>
        <span class="s2">assert </span><span class="s1">ts </span><span class="s3">== </span><span class="s1">stamp</span>

    <span class="s3">@</span><span class="s1">td</span><span class="s3">.</span><span class="s1">skip_if_windows</span>
    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_explicit_dateutil</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs</span><span class="s3">.</span><span class="s1">timezones </span><span class="s2">import </span><span class="s1">dateutil_gettz </span><span class="s2">as </span><span class="s1">gettz</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;20090415&quot;</span><span class="s3">, </span><span class="s5">&quot;20090519&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">gettz</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">))</span>
        <span class="s1">stamp </span><span class="s3">= </span><span class="s1">rng</span><span class="s3">[</span><span class="s4">0</span><span class="s3">]</span>

        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20090415&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">gettz</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">))</span>
        <span class="s2">assert </span><span class="s1">ts </span><span class="s3">== </span><span class="s1">stamp</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_from_datetime_instance</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">datetime_instance </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2014</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">4</span><span class="s3">)</span>
        <span class="s6"># build a timestamp with a frequency, since then it supports</span>
        <span class="s6"># addition/subtraction of integers</span>
        <span class="s1">timestamp_instance </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">datetime_instance</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)[</span><span class="s4">0</span><span class="s3">]</span>

        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">datetime_instance</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">ts </span><span class="s3">== </span><span class="s1">timestamp_instance</span>

    <span class="s2">def </span><span class="s1">test_date_range_timestamp_equiv_preserve_frequency</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">timestamp_instance </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014-03-05&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)[</span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2014-03-05&quot;</span><span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">timestamp_instance </span><span class="s3">== </span><span class="s1">ts</span>


<span class="s2">class </span><span class="s1">TestDateRanges</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_date_range_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2000-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YE&quot;</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s5">&quot;TEST&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">idx</span><span class="s3">.</span><span class="s1">name </span><span class="s3">== </span><span class="s5">&quot;TEST&quot;</span>

    <span class="s2">def </span><span class="s1">test_date_range_invalid_periods</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;periods must be a number, got foo&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s5">&quot;foo&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_fractional_period</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Non-integer 'periods' in pd.date_range, pd.timedelta_range&quot;</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10.5</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;freq,freq_depr&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s5">&quot;2ME&quot;</span><span class="s3">, </span><span class="s5">&quot;2M&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2SME&quot;</span><span class="s3">, </span><span class="s5">&quot;2SM&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2BQE&quot;</span><span class="s3">, </span><span class="s5">&quot;2BQ&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2BYE&quot;</span><span class="s3">, </span><span class="s5">&quot;2BY&quot;</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_date_range_frequency_M_SM_BQ_BY_deprecated</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">freq_depr</span><span class="s3">):</span>
        <span class="s6"># GH#52064</span>
        <span class="s1">depr_msg </span><span class="s3">= </span><span class="s5">f&quot;'</span><span class="s2">{</span><span class="s1">freq_depr</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:]</span><span class="s2">}</span><span class="s5">' is deprecated and will be removed &quot;</span>
        <span class="s5">f&quot;in a future version, please use '</span><span class="s2">{</span><span class="s1">freq</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:]</span><span class="s2">}</span><span class="s5">' instead.&quot;</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">4</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">depr_msg</span><span class="s3">):</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">4</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq_depr</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_tuple_freq_raises</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#34703</span>
        <span class="s1">edate </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2000</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s5">&quot;pass as a string instead&quot;</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">edate</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=(</span><span class="s5">&quot;D&quot;</span><span class="s3">, </span><span class="s4">5</span><span class="s3">), </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">20</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;freq&quot;</span><span class="s3">, [</span><span class="s5">&quot;ns&quot;</span><span class="s3">, </span><span class="s5">&quot;us&quot;</span><span class="s3">, </span><span class="s5">&quot;ms&quot;</span><span class="s3">, </span><span class="s5">&quot;min&quot;</span><span class="s3">, </span><span class="s5">&quot;s&quot;</span><span class="s3">, </span><span class="s5">&quot;h&quot;</span><span class="s3">, </span><span class="s5">&quot;D&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_edges</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">):</span>
        <span class="s6"># GH#13672</span>
        <span class="s1">td </span><span class="s3">= </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s5">f&quot;1</span><span class="s2">{</span><span class="s1">freq</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">)</span>
        <span class="s1">ts </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;1970-01-01&quot;</span><span class="s3">)</span>

        <span class="s1">idx </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s1">ts </span><span class="s3">+ </span><span class="s1">td</span><span class="s3">,</span>
            <span class="s1">end</span><span class="s3">=</span><span class="s1">ts </span><span class="s3">+ </span><span class="s4">4 </span><span class="s3">* </span><span class="s1">td</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">ts </span><span class="s3">+ </span><span class="s1">n </span><span class="s3">* </span><span class="s1">td </span><span class="s2">for </span><span class="s1">n </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">)],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;M8[ns]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s6"># start after end</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s1">ts </span><span class="s3">+ </span><span class="s4">4 </span><span class="s3">* </span><span class="s1">td</span><span class="s3">,</span>
            <span class="s1">end</span><span class="s3">=</span><span class="s1">ts </span><span class="s3">+ </span><span class="s1">td</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;M8[ns]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

        <span class="s6"># start matches end</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s1">ts </span><span class="s3">+ </span><span class="s1">td</span><span class="s3">,</span>
            <span class="s1">end</span><span class="s3">=</span><span class="s1">ts </span><span class="s3">+ </span><span class="s1">td</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">ts </span><span class="s3">+ </span><span class="s1">td</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;M8[ns]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_near_implementation_bound</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#???</span>
        <span class="s1">freq </span><span class="s3">= </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s4">1</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s5">&quot;Cannot generate range with&quot;</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">min</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_nat</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#11587</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Neither `start` nor `end` can be NaT&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">pd</span><span class="s3">.</span><span class="s1">NaT</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_multiplication_overflow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#24255</span>
        <span class="s6"># check that overflows in calculating `addend = periods * stride`</span>
        <span class="s6">#  are caught</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s2">None</span><span class="s3">):</span>
            <span class="s6"># we should _not_ be seeing a overflow RuntimeWarning</span>
            <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;1677-09-22&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">213503</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">dti</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;1677-09-22&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">) == </span><span class="s4">213503</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Cannot generate range with&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1969-05-04&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">200000000</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;30000D&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_unsigned_overflow_handling</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#24255</span>
        <span class="s6"># case where `addend = periods * stride` overflows int64 bounds</span>
        <span class="s6">#  but not uint64 bounds</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;1677-09-22&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2262-04-11&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>

        <span class="s1">dti2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">dti</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">periods</span><span class="s3">=</span><span class="s1">len</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">), </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dti2</span><span class="s3">.</span><span class="s1">equals</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">)</span>

        <span class="s1">dti3 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">dti</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">periods</span><span class="s3">=</span><span class="s1">len</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">), </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dti3</span><span class="s3">.</span><span class="s1">equals</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_int64_overflow_non_recoverable</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#24255</span>
        <span class="s6"># case with start later than 1970-01-01, overflow int64 but not uint64</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Cannot generate range with&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;1970-02-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">106752 </span><span class="s3">* </span><span class="s4">24</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">)</span>

        <span class="s6"># case with end before 1970-01-01, overflow int64 but not uint64</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;1969-11-14&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">106752 </span><span class="s3">* </span><span class="s4">24</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">slow</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;s_ts, e_ts&quot;</span><span class="s3">, [(</span><span class="s5">&quot;2262-02-23&quot;</span><span class="s3">, </span><span class="s5">&quot;1969-11-14&quot;</span><span class="s3">), (</span><span class="s5">&quot;1970-02-01&quot;</span><span class="s3">, </span><span class="s5">&quot;1677-10-22&quot;</span><span class="s3">)]</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_date_range_int64_overflow_stride_endpoint_different_signs</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">s_ts</span><span class="s3">, </span><span class="s1">e_ts</span>
    <span class="s3">):</span>
        <span class="s6"># cases where stride * periods overflow int64 and stride/endpoint</span>
        <span class="s6">#  have different signs</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">s_ts</span><span class="s3">)</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">e_ts</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;-1h&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">expected</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">expected</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] == </span><span class="s1">end</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s1">len</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">), </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;-1h&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_out_of_bounds</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#14187</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Cannot generate range&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">100000</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;1763-10-12&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">100000</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_gen_error</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000 00:00&quot;</span><span class="s3">, </span><span class="s5">&quot;1/1/2000 00:18&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;5min&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">) == </span><span class="s4">4</span>

    <span class="s2">def </span><span class="s1">test_date_range_normalize</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">snap </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">.</span><span class="s1">today</span><span class="s3">()</span>
        <span class="s1">n </span><span class="s3">= </span><span class="s4">50</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">snap</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s1">n</span><span class="s3">, </span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">False</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;2D&quot;</span><span class="s3">)</span>

        <span class="s1">offset </span><span class="s3">= </span><span class="s1">timedelta</span><span class="s3">(</span><span class="s4">2</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">snap </span><span class="s3">+ </span><span class="s1">i </span><span class="s3">* </span><span class="s1">offset </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s1">n</span><span class="s3">)], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;M8[ns]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">offset</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000 08:15&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s1">n</span><span class="s3">, </span><span class="s1">normalize</span><span class="s3">=</span><span class="s2">False</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;B&quot;</span><span class="s3">)</span>
        <span class="s1">the_time </span><span class="s3">= </span><span class="s1">time</span><span class="s3">(</span><span class="s4">8</span><span class="s3">, </span><span class="s4">15</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">val </span><span class="s2">in </span><span class="s1">rng</span><span class="s3">:</span>
            <span class="s2">assert </span><span class="s1">val</span><span class="s3">.</span><span class="s1">time</span><span class="s3">() == </span><span class="s1">the_time</span>

    <span class="s2">def </span><span class="s1">test_date_range_ambiguous_arguments</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># #2538</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">40</span><span class="s3">)</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">40</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= (</span>
            <span class="s5">&quot;Of the four parameters: start, end, periods, and &quot;</span>
            <span class="s5">&quot;freq, exactly three must be specified&quot;</span>
        <span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;s&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_convenience_periods</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH 20808</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2018-04-24&quot;</span><span class="s3">, </span><span class="s5">&quot;2018-04-27&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2018-04-24 00:00:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2018-04-25 12:00:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2018-04-27 00:00:00&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s6"># Test if spacing remains linear if tz changes to dst in range</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s5">&quot;2018-04-01 01:00:00&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2018-04-01 04:00:00&quot;</span><span class="s3">,</span>
            <span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;Australia/Sydney&quot;</span><span class="s3">,</span>
            <span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">,</span>
            <span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2018-04-01 01:00:00+1100&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;Australia/Sydney&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2018-04-01 02:00:00+1000&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;Australia/Sydney&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2018-04-01 04:00:00+1000&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;Australia/Sydney&quot;</span><span class="s3">),</span>
            <span class="s3">]</span>
        <span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_index_comparison</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">df </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">).</span><span class="s1">to_frame</span><span class="s3">()</span>
        <span class="s1">arr </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">rng</span><span class="s3">.</span><span class="s1">to_list</span><span class="s3">()]).</span><span class="s1">T</span>
        <span class="s1">arr2 </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">([</span><span class="s1">rng</span><span class="s3">]).</span><span class="s1">T</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s5">&quot;Unable to coerce to Series&quot;</span><span class="s3">):</span>
            <span class="s1">rng </span><span class="s3">== </span><span class="s1">df</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s5">&quot;Unable to coerce to Series&quot;</span><span class="s3">):</span>
            <span class="s1">df </span><span class="s3">== </span><span class="s1">rng</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DataFrame</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">])</span>

        <span class="s1">results </span><span class="s3">= </span><span class="s1">df </span><span class="s3">== </span><span class="s1">arr2</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_frame_equal</span><span class="s3">(</span><span class="s1">results</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">Series</span><span class="s3">([</span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">True</span><span class="s3">], </span><span class="s1">name</span><span class="s3">=</span><span class="s4">0</span><span class="s3">)</span>

        <span class="s1">results </span><span class="s3">= </span><span class="s1">df</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">arr2</span><span class="s3">[:, </span><span class="s4">0</span><span class="s3">]</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_series_equal</span><span class="s3">(</span><span class="s1">results</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[[</span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">], [</span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">, </span><span class="s2">False</span><span class="s3">], [</span><span class="s2">False</span><span class="s3">, </span><span class="s2">False</span><span class="s3">, </span><span class="s2">True</span><span class="s3">]]</span>
        <span class="s3">)</span>
        <span class="s1">results </span><span class="s3">= </span><span class="s1">rng </span><span class="s3">== </span><span class="s1">arr</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">results</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;start,end,result_tz&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">&quot;20180101&quot;</span><span class="s3">, </span><span class="s5">&quot;20180103&quot;</span><span class="s3">, </span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2018</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2018</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">), </span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20180101&quot;</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20180103&quot;</span><span class="s3">), </span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">],</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20180101&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20180103&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">),</span>
                <span class="s5">&quot;US/Eastern&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20180101&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20180103&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">),</span>
                <span class="s2">None</span><span class="s3">,</span>
            <span class="s3">],</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_date_range_linspacing_tz</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">result_tz</span><span class="s3">):</span>
        <span class="s6"># GH 20983</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">result_tz</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;20180101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_timedelta</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s5">&quot;2020-01-01&quot;</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s5">&quot;2020-01-11&quot;</span>
        <span class="s1">rng1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;3D&quot;</span><span class="s3">)</span>
        <span class="s1">rng2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">days</span><span class="s3">=</span><span class="s4">3</span><span class="s3">))</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng1</span><span class="s3">, </span><span class="s1">rng2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_range_misspecified</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH #1095</span>
        <span class="s1">msg </span><span class="s3">= (</span>
            <span class="s5">&quot;Of the four parameters: start, end, periods, and &quot;</span>
            <span class="s5">&quot;freq, exactly three must be specified&quot;</span>
        <span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">test_compat_replace</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># https://github.com/statsmodels/statsmodels/issues/3349</span>
        <span class="s6"># replace should take ints/longs for compat</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;1960-04-01 00:00:00&quot;</span><span class="s3">), </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">76</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;QS-JAN&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">result</span><span class="s3">) == </span><span class="s4">76</span>

    <span class="s2">def </span><span class="s1">test_catch_infinite_loop</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">offset </span><span class="s3">= </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">minute</span><span class="s3">=</span><span class="s4">5</span><span class="s3">)</span>
        <span class="s6"># blow up, don't loop forever</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Offset &lt;DateOffset: minute=5&gt; did not increment date&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">11</span><span class="s3">), </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">12</span><span class="s3">), </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">offset</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_construct_over_dst</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH 20854</span>
        <span class="s1">pre_dst </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2010-11-07 01:00:00&quot;</span><span class="s3">).</span><span class="s1">tz_localize</span><span class="s3">(</span>
            <span class="s5">&quot;US/Pacific&quot;</span><span class="s3">, </span><span class="s1">ambiguous</span><span class="s3">=</span><span class="s2">True</span>
        <span class="s3">)</span>
        <span class="s1">pst_dst </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2010-11-07 01:00:00&quot;</span><span class="s3">).</span><span class="s1">tz_localize</span><span class="s3">(</span>
            <span class="s5">&quot;US/Pacific&quot;</span><span class="s3">, </span><span class="s1">ambiguous</span><span class="s3">=</span><span class="s2">False</span>
        <span class="s3">)</span>
        <span class="s1">expect_data </span><span class="s3">= [</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2010-11-07 00:00:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Pacific&quot;</span><span class="s3">),</span>
            <span class="s1">pre_dst</span><span class="s3">,</span>
            <span class="s1">pst_dst</span><span class="s3">,</span>
        <span class="s3">]</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">expect_data</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2010-11-7&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Pacific&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_construct_with_different_start_end_string_format</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH 12064</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s5">&quot;2013-01-01 00:00:00+09:00&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2013/01/01 02:00:00+09:00&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">,</span>
            <span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2013-01-01 00:00:00+09:00&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2013-01-01 01:00:00+09:00&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2013-01-01 02:00:00+09:00&quot;</span><span class="s3">),</span>
            <span class="s3">],</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">,</span>
        <span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_error_with_zero_monthends</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">r&quot;Offset &lt;0 \* MonthEnds&gt; did not increment date&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s5">&quot;1/1/2001&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">MonthEnd</span><span class="s3">(</span><span class="s4">0</span><span class="s3">))</span>

    <span class="s2">def </span><span class="s1">test_range_bug</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH #770</span>
        <span class="s1">offset </span><span class="s3">= </span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">months</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2011-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;2012-1-31&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">offset</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>

        <span class="s1">start </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">start </span><span class="s3">+ </span><span class="s1">i </span><span class="s3">* </span><span class="s1">offset </span><span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range</span><span class="s3">(</span><span class="s4">5</span><span class="s3">)], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">offset</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_range_tz_pytz</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># see gh-2906</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">timezone</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">tz</span><span class="s3">.</span><span class="s1">localize</span><span class="s3">(</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">))</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">tz</span><span class="s3">.</span><span class="s1">localize</span><span class="s3">(</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">))</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">tz</span><span class="s3">.</span><span class="s1">zone </span><span class="s3">== </span><span class="s1">tz</span><span class="s3">.</span><span class="s1">zone</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">2</span><span class="s3">] == </span><span class="s1">end</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">tz</span><span class="s3">.</span><span class="s1">zone </span><span class="s3">== </span><span class="s1">tz</span><span class="s3">.</span><span class="s1">zone</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">2</span><span class="s3">] == </span><span class="s1">end</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">tz</span><span class="s3">.</span><span class="s1">zone </span><span class="s3">== </span><span class="s1">tz</span><span class="s3">.</span><span class="s1">zone</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">2</span><span class="s3">] == </span><span class="s1">end</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;start, end&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2014</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">6</span><span class="s3">), </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2014</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">12</span><span class="s3">), </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">),</span>
            <span class="s3">],</span>
            <span class="s3">[</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2013</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">),</span>
                <span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2013</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">6</span><span class="s3">), </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">),</span>
            <span class="s3">],</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_range_tz_dst_straddle_pytz</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">):</span>
        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] == </span><span class="s1">end</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">.</span><span class="s1">hour </span><span class="s3">== </span><span class="s4">0</span><span class="s3">)</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] == </span><span class="s1">end</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">.</span><span class="s1">hour </span><span class="s3">== </span><span class="s4">0</span><span class="s3">)</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s2">None</span><span class="s3">),</span>
            <span class="s1">end</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s2">None</span><span class="s3">),</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">,</span>
            <span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] == </span><span class="s1">end</span>
        <span class="s2">assert </span><span class="s1">np</span><span class="s3">.</span><span class="s1">all</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">.</span><span class="s1">hour </span><span class="s3">== </span><span class="s4">0</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_range_tz_dateutil</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># see gh-2906</span>

        <span class="s6"># Use maybe_get_tz to fix filename in tz under dateutil.</span>
        <span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_libs</span><span class="s3">.</span><span class="s1">tslibs</span><span class="s3">.</span><span class="s1">timezones </span><span class="s2">import </span><span class="s1">maybe_get_tz</span>

        <span class="s1">tz </span><span class="s3">= </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">maybe_get_tz</span><span class="s3">(</span><span class="s5">&quot;dateutil/&quot; </span><span class="s3">+ </span><span class="s1">x</span><span class="s3">)</span>

        <span class="s1">start </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">))</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2011</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">))</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">tz </span><span class="s3">== </span><span class="s1">tz</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">2</span><span class="s3">] == </span><span class="s1">end</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">tz </span><span class="s3">== </span><span class="s1">tz</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">2</span><span class="s3">] == </span><span class="s1">end</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">tz </span><span class="s3">== </span><span class="s1">tz</span><span class="s3">(</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">start</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">2</span><span class="s3">] == </span><span class="s1">end</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;freq&quot;</span><span class="s3">, [</span><span class="s5">&quot;1D&quot;</span><span class="s3">, </span><span class="s5">&quot;3D&quot;</span><span class="s3">, </span><span class="s5">&quot;2ME&quot;</span><span class="s3">, </span><span class="s5">&quot;7W&quot;</span><span class="s3">, </span><span class="s5">&quot;3h&quot;</span><span class="s3">, </span><span class="s5">&quot;YE&quot;</span><span class="s3">])</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;tz&quot;</span><span class="s3">, [</span><span class="s2">None</span><span class="s3">, </span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_range_closed</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">, </span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">):</span>
        <span class="s6"># GH#12409, GH#12684</span>

        <span class="s1">begin </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2011/1/1&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2014/1/1&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

        <span class="s1">result_range </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">begin</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">inclusive</span><span class="s3">=</span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span>
        <span class="s3">)</span>
        <span class="s1">both_range </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">begin</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">inclusive</span><span class="s3">=</span><span class="s5">&quot;both&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">)</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">_get_expected_range</span><span class="s3">(</span>
            <span class="s1">begin</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">both_range</span><span class="s3">, </span><span class="s1">inclusive_endpoints_fixture</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">expected_range</span><span class="s3">, </span><span class="s1">result_range</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;freq&quot;</span><span class="s3">, [</span><span class="s5">&quot;1D&quot;</span><span class="s3">, </span><span class="s5">&quot;3D&quot;</span><span class="s3">, </span><span class="s5">&quot;2ME&quot;</span><span class="s3">, </span><span class="s5">&quot;7W&quot;</span><span class="s3">, </span><span class="s5">&quot;3h&quot;</span><span class="s3">, </span><span class="s5">&quot;YE&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_range_with_tz_closed_with_tz_aware_start_end</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">inclusive_endpoints_fixture</span>
    <span class="s3">):</span>
        <span class="s1">begin </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2011/1/1&quot;</span><span class="s3">)</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2014/1/1&quot;</span><span class="s3">)</span>
        <span class="s1">begintz </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2011/1/1&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">endtz </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2014/1/1&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>

        <span class="s1">result_range </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">begin</span><span class="s3">,</span>
            <span class="s1">end</span><span class="s3">,</span>
            <span class="s1">inclusive</span><span class="s3">=</span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
            <span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">both_range </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">begin</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">inclusive</span><span class="s3">=</span><span class="s5">&quot;both&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span>
        <span class="s3">)</span>
        <span class="s1">expected_range </span><span class="s3">= </span><span class="s1">_get_expected_range</span><span class="s3">(</span>
            <span class="s1">begintz</span><span class="s3">,</span>
            <span class="s1">endtz</span><span class="s3">,</span>
            <span class="s1">both_range</span><span class="s3">,</span>
            <span class="s1">inclusive_endpoints_fixture</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">expected_range</span><span class="s3">, </span><span class="s1">result_range</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_range_closed_boundary</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">):</span>
        <span class="s6"># GH#11804</span>
        <span class="s1">right_boundary </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s5">&quot;2015-09-12&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-12-01&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;QS-MAR&quot;</span><span class="s3">,</span>
            <span class="s1">inclusive</span><span class="s3">=</span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">left_boundary </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s5">&quot;2015-09-01&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-09-12&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;QS-MAR&quot;</span><span class="s3">,</span>
            <span class="s1">inclusive</span><span class="s3">=</span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">both_boundary </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s5">&quot;2015-09-01&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-12-01&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;QS-MAR&quot;</span><span class="s3">,</span>
            <span class="s1">inclusive</span><span class="s3">=</span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">neither_boundary </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s5">&quot;2015-09-11&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-09-12&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;QS-MAR&quot;</span><span class="s3">,</span>
            <span class="s1">inclusive</span><span class="s3">=</span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">,</span>
        <span class="s3">)</span>

        <span class="s1">expected_right </span><span class="s3">= </span><span class="s1">both_boundary</span>
        <span class="s1">expected_left </span><span class="s3">= </span><span class="s1">both_boundary</span>
        <span class="s1">expected_both </span><span class="s3">= </span><span class="s1">both_boundary</span>

        <span class="s2">if </span><span class="s1">inclusive_endpoints_fixture </span><span class="s3">== </span><span class="s5">&quot;right&quot;</span><span class="s3">:</span>
            <span class="s1">expected_left </span><span class="s3">= </span><span class="s1">both_boundary</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:]</span>
        <span class="s2">elif </span><span class="s1">inclusive_endpoints_fixture </span><span class="s3">== </span><span class="s5">&quot;left&quot;</span><span class="s3">:</span>
            <span class="s1">expected_right </span><span class="s3">= </span><span class="s1">both_boundary</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s2">elif </span><span class="s1">inclusive_endpoints_fixture </span><span class="s3">== </span><span class="s5">&quot;both&quot;</span><span class="s3">:</span>
            <span class="s1">expected_right </span><span class="s3">= </span><span class="s1">both_boundary</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:]</span>
            <span class="s1">expected_left </span><span class="s3">= </span><span class="s1">both_boundary</span><span class="s3">[:-</span><span class="s4">1</span><span class="s3">]</span>

        <span class="s1">expected_neither </span><span class="s3">= </span><span class="s1">both_boundary</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:-</span><span class="s4">1</span><span class="s3">]</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">right_boundary</span><span class="s3">, </span><span class="s1">expected_right</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">left_boundary</span><span class="s3">, </span><span class="s1">expected_left</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">both_boundary</span><span class="s3">, </span><span class="s1">expected_both</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">neither_boundary</span><span class="s3">, </span><span class="s1">expected_neither</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_years_only</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_naive_fixture</span><span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_naive_fixture</span>
        <span class="s6"># GH#6961</span>
        <span class="s1">rng1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014&quot;</span><span class="s3">, </span><span class="s5">&quot;2015&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;ME&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014-01-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-12-31&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;ME&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng1</span><span class="s3">, </span><span class="s1">expected1</span><span class="s3">)</span>

        <span class="s1">rng2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014&quot;</span><span class="s3">, </span><span class="s5">&quot;2015&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;MS&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2015-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;MS&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng2</span><span class="s3">, </span><span class="s1">expected2</span><span class="s3">)</span>

        <span class="s1">rng3 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014&quot;</span><span class="s3">, </span><span class="s5">&quot;2020&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YE&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected3 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2019-12-31&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YE&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng3</span><span class="s3">, </span><span class="s1">expected3</span><span class="s3">)</span>

        <span class="s1">rng4 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014&quot;</span><span class="s3">, </span><span class="s5">&quot;2020&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YS&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected4 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2020-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YS&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng4</span><span class="s3">, </span><span class="s1">expected4</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_freq_divides_end_in_nanos</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH 10885</span>
        <span class="s1">result_1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2005-01-12 10:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2005-01-12 16:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;345min&quot;</span><span class="s3">)</span>
        <span class="s1">result_2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2005-01-13 10:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2005-01-13 16:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;345min&quot;</span><span class="s3">)</span>
        <span class="s1">expected_1 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2005-01-12 10:00:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2005-01-12 15:45:00&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;datetime64[ns]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;345min&quot;</span><span class="s3">,</span>
            <span class="s1">tz</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">expected_2 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2005-01-13 10:00:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2005-01-13 15:45:00&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;datetime64[ns]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;345min&quot;</span><span class="s3">,</span>
            <span class="s1">tz</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result_1</span><span class="s3">, </span><span class="s1">expected_1</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result_2</span><span class="s3">, </span><span class="s1">expected_2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_cached_range_bug</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2010-09-01 05:00:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">50</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">hours</span><span class="s3">=</span><span class="s4">6</span><span class="s3">))</span>
        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">) == </span><span class="s4">50</span>
        <span class="s2">assert </span><span class="s1">rng</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2010</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_timezone_comparison_bug</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># smoke test</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20130220 10:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">result</span><span class="s3">) == </span><span class="s4">2</span>

    <span class="s2">def </span><span class="s1">test_timezone_comparison_assert</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;20130220 10:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Inferred time zone not equal to passed time zone&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">AssertionError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;Europe/Berlin&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_negative_non_tick_frequency_descending_dates</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz_aware_fixture</span><span class="s3">):</span>
        <span class="s6"># GH 23270</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">tz_aware_fixture</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2011-06-01&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;-1MS&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2011-06-01&quot;</span><span class="s3">, </span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2011-01-01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;1MS&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)[</span>
            <span class="s3">::-</span><span class="s4">1</span>
        <span class="s3">]</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_range_where_start_equal_end</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">inclusive_endpoints_fixture</span><span class="s3">):</span>
        <span class="s6"># GH 43394</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s5">&quot;2021-09-02&quot;</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s5">&quot;2021-09-02&quot;</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">, </span><span class="s1">inclusive</span><span class="s3">=</span><span class="s1">inclusive_endpoints_fixture</span>
        <span class="s3">)</span>

        <span class="s1">both_range </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">, </span><span class="s1">inclusive</span><span class="s3">=</span><span class="s5">&quot;both&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">inclusive_endpoints_fixture </span><span class="s3">== </span><span class="s5">&quot;neither&quot;</span><span class="s3">:</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[</span><span class="s4">1</span><span class="s3">:-</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s2">elif </span><span class="s1">inclusive_endpoints_fixture </span><span class="s2">in </span><span class="s3">(</span><span class="s5">&quot;left&quot;</span><span class="s3">, </span><span class="s5">&quot;right&quot;</span><span class="s3">, </span><span class="s5">&quot;both&quot;</span><span class="s3">):</span>
            <span class="s1">expected </span><span class="s3">= </span><span class="s1">both_range</span><span class="s3">[:]</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_freq_dateoffset_with_relateivedelta_nanos</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH 46877</span>
        <span class="s1">freq </span><span class="s3">= </span><span class="s1">DateOffset</span><span class="s3">(</span><span class="s1">hours</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">days</span><span class="s3">=</span><span class="s4">57</span><span class="s3">, </span><span class="s1">nanoseconds</span><span class="s3">=</span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;1970-01-01 00:00:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">, </span><span class="s1">name</span><span class="s3">=</span><span class="s5">&quot;a&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s5">&quot;1968-08-02T05:59:59.999999973&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1968-09-28T15:59:59.999999976&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1968-11-25T01:59:59.999999979&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1969-01-21T11:59:59.999999982&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1969-03-19T21:59:59.999999985&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1969-05-16T07:59:59.999999988&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1969-07-12T17:59:59.999999991&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1969-09-08T03:59:59.999999994&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1969-11-04T13:59:59.999999997&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;1970-01-01T00:00:00.000000000&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">name</span><span class="s3">=</span><span class="s5">&quot;a&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;freq,freq_depr&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s5">&quot;h&quot;</span><span class="s3">, </span><span class="s5">&quot;H&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2min&quot;</span><span class="s3">, </span><span class="s5">&quot;2T&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;1s&quot;</span><span class="s3">, </span><span class="s5">&quot;1S&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2ms&quot;</span><span class="s3">, </span><span class="s5">&quot;2L&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;1us&quot;</span><span class="s3">, </span><span class="s5">&quot;1U&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2ns&quot;</span><span class="s3">, </span><span class="s5">&quot;2N&quot;</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_frequencies_H_T_S_L_U_N_deprecated</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">freq_depr</span><span class="s3">):</span>
        <span class="s6"># GH#52536</span>
        <span class="s1">freq_msg </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;[0-9]*&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">maxsplit</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)[</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s1">freq_depr_msg </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;[0-9]*&quot;</span><span class="s3">, </span><span class="s1">freq_depr</span><span class="s3">, </span><span class="s1">maxsplit</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)[</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s1">msg </span><span class="s3">= (</span>
            <span class="s5">f&quot;'</span><span class="s2">{</span><span class="s1">freq_depr_msg</span><span class="s2">}</span><span class="s5">' is deprecated and will be removed in a future version, &quot;</span>
        <span class="s3">)</span>
        <span class="s5">f&quot;please use '</span><span class="s2">{</span><span class="s1">freq_msg</span><span class="s2">}</span><span class="s5">' instead&quot;</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq_depr</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;freq,freq_depr&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s5">&quot;200YE&quot;</span><span class="s3">, </span><span class="s5">&quot;200A&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;YE&quot;</span><span class="s3">, </span><span class="s5">&quot;Y&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2YE-MAY&quot;</span><span class="s3">, </span><span class="s5">&quot;2A-MAY&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;YE-MAY&quot;</span><span class="s3">, </span><span class="s5">&quot;Y-MAY&quot;</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_frequencies_A_deprecated_Y_renamed</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">freq_depr</span><span class="s3">):</span>
        <span class="s6"># GH#9586, GH#54275</span>
        <span class="s1">freq_msg </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;[0-9]*&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">, </span><span class="s1">maxsplit</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)[</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s1">freq_depr_msg </span><span class="s3">= </span><span class="s1">re</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;[0-9]*&quot;</span><span class="s3">, </span><span class="s1">freq_depr</span><span class="s3">, </span><span class="s1">maxsplit</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)[</span><span class="s4">1</span><span class="s3">]</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">f&quot;'</span><span class="s2">{</span><span class="s1">freq_depr_msg</span><span class="s2">}</span><span class="s5">' is deprecated and will be removed &quot;</span>
        <span class="s5">f&quot;in a future version, please use '</span><span class="s2">{</span><span class="s1">freq_msg</span><span class="s2">}</span><span class="s5">' instead.&quot;</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq_depr</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_to_offset_with_lowercase_deprecated_freq</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s6"># https://github.com/pandas-dev/pandas/issues/56847</span>
        <span class="s1">msg </span><span class="s3">= (</span>
            <span class="s5">&quot;'m' is deprecated and will be removed in a future version, please use &quot;</span>
            <span class="s5">&quot;'ME' instead.&quot;</span>
        <span class="s3">)</span>
        <span class="s2">with </span><span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_produces_warning</span><span class="s3">(</span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2010-01-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;m&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s5">&quot;2010-01-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2010-02-28&quot;</span><span class="s3">], </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;ME&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_bday</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">sdate </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">1999</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">25</span><span class="s3">)</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">sdate</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;1B&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">20</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">) == </span><span class="s4">20</span>
        <span class="s2">assert </span><span class="s1">idx</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">sdate </span><span class="s3">+ </span><span class="s4">0 </span><span class="s3">* </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">BDay</span><span class="s3">()</span>
        <span class="s2">assert </span><span class="s1">idx</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s5">&quot;B&quot;</span>


<span class="s2">class </span><span class="s1">TestDateRangeTZ</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Tests for date_range with timezones&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">test_hongkong_tz_convert</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#1673 smoke test</span>
        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2012-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2012-01-10&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;Hongkong&quot;</span><span class="s3">)</span>

        <span class="s6"># it works!</span>
        <span class="s1">dr</span><span class="s3">.</span><span class="s1">hour</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;tzstr&quot;</span><span class="s3">, [</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">, </span><span class="s5">&quot;dateutil/US/Eastern&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_span_dst_transition</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tzstr</span><span class="s3">):</span>
        <span class="s6"># GH#1778</span>

        <span class="s6"># Standard -&gt; Daylight Savings Time</span>
        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;03/06/2012 00:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">200</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;W-FRI&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">)</span>

        <span class="s2">assert </span><span class="s3">(</span><span class="s1">dr</span><span class="s3">.</span><span class="s1">hour </span><span class="s3">== </span><span class="s4">0</span><span class="s3">).</span><span class="s1">all</span><span class="s3">()</span>

        <span class="s1">dr </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2012-11-02&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tzstr</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">dr</span><span class="s3">.</span><span class="s1">hour</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Index</span><span class="s3">([</span><span class="s4">0</span><span class="s3">] * </span><span class="s4">10</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;int32&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;tzstr&quot;</span><span class="s3">, [</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">, </span><span class="s5">&quot;dateutil/US/Eastern&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_timezone_str_argument</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tzstr</span><span class="s3">):</span>
        <span class="s1">tz </span><span class="s3">= </span><span class="s1">timezones</span><span class="s3">.</span><span class="s1">maybe_get_tz</span><span class="s3">(</span><span class="s1">tzstr</span><span class="s3">)</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tzstr</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_with_fixed_tz</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">off </span><span class="s3">= </span><span class="s1">FixedOffset</span><span class="s3">(</span><span class="s4">420</span><span class="s3">, </span><span class="s5">&quot;+07:00&quot;</span><span class="s3">)</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2012</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s1">off</span><span class="s3">)</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2012</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s1">off</span><span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">off </span><span class="s3">== </span><span class="s1">rng</span><span class="s3">.</span><span class="s1">tz</span>

        <span class="s1">rng2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s1">len</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">), </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">off</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">rng2</span><span class="s3">)</span>

        <span class="s1">rng3 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;3/11/2012 05:00:00+07:00&quot;</span><span class="s3">, </span><span class="s5">&quot;6/11/2012 05:00:00+07:00&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s3">(</span><span class="s1">rng</span><span class="s3">.</span><span class="s1">values </span><span class="s3">== </span><span class="s1">rng3</span><span class="s3">.</span><span class="s1">values</span><span class="s3">).</span><span class="s1">all</span><span class="s3">()</span>

    <span class="s2">def </span><span class="s1">test_date_range_with_fixedoffset_noname</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">off </span><span class="s3">= </span><span class="s1">fixed_off_no_name</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2012</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s1">off</span><span class="s3">)</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2012</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s4">0</span><span class="s3">, </span><span class="s1">tzinfo</span><span class="s3">=</span><span class="s1">off</span><span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">off </span><span class="s3">== </span><span class="s1">rng</span><span class="s3">.</span><span class="s1">tz</span>

        <span class="s1">idx </span><span class="s3">= </span><span class="s1">pd</span><span class="s3">.</span><span class="s1">Index</span><span class="s3">([</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">])</span>
        <span class="s2">assert </span><span class="s1">off </span><span class="s3">== </span><span class="s1">idx</span><span class="s3">.</span><span class="s1">tz</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;tzstr&quot;</span><span class="s3">, [</span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">, </span><span class="s5">&quot;dateutil/US/Eastern&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_with_tz</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tzstr</span><span class="s3">):</span>
        <span class="s1">stamp </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;3/11/2012 05:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tzstr</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">stamp</span><span class="s3">.</span><span class="s1">hour </span><span class="s3">== </span><span class="s4">5</span>

        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;3/11/2012 04:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tzstr</span><span class="s3">)</span>

        <span class="s2">assert </span><span class="s1">stamp </span><span class="s3">== </span><span class="s1">rng</span><span class="s3">[</span><span class="s4">1</span><span class="s3">]</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;tz&quot;</span><span class="s3">, [</span><span class="s5">&quot;Europe/London&quot;</span><span class="s3">, </span><span class="s5">&quot;dateutil/Europe/London&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_date_range_ambiguous_endpoint</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">):</span>
        <span class="s6"># construction with an ambiguous end-point</span>
        <span class="s6"># GH#11626</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">pytz</span><span class="s3">.</span><span class="s1">AmbiguousTimeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s5">&quot;Cannot infer dst time&quot;</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span>
                <span class="s5">&quot;2013-10-26 23:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-10-27 01:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;Europe/London&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span>
            <span class="s3">)</span>

        <span class="s1">times </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s5">&quot;2013-10-26 23:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-10-27 01:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">, </span><span class="s1">ambiguous</span><span class="s3">=</span><span class="s5">&quot;infer&quot;</span>
        <span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">times</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2013-10-26 23:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">times</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] == </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2013-10-27 01:00:00+0000&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;tz, option, expected&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">[</span><span class="s5">&quot;US/Pacific&quot;</span><span class="s3">, </span><span class="s5">&quot;shift_forward&quot;</span><span class="s3">, </span><span class="s5">&quot;2019-03-10 03:00&quot;</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">&quot;dateutil/US/Pacific&quot;</span><span class="s3">, </span><span class="s5">&quot;shift_forward&quot;</span><span class="s3">, </span><span class="s5">&quot;2019-03-10 03:00&quot;</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">&quot;US/Pacific&quot;</span><span class="s3">, </span><span class="s5">&quot;shift_backward&quot;</span><span class="s3">, </span><span class="s5">&quot;2019-03-10 01:00&quot;</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">&quot;dateutil/US/Pacific&quot;</span><span class="s3">, </span><span class="s5">&quot;shift_backward&quot;</span><span class="s3">, </span><span class="s5">&quot;2019-03-10 01:00&quot;</span><span class="s3">],</span>
            <span class="s3">[</span><span class="s5">&quot;US/Pacific&quot;</span><span class="s3">, </span><span class="s1">timedelta</span><span class="s3">(</span><span class="s1">hours</span><span class="s3">=</span><span class="s4">1</span><span class="s3">), </span><span class="s5">&quot;2019-03-10 03:00&quot;</span><span class="s3">],</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_date_range_nonexistent_endpoint</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">, </span><span class="s1">option</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
        <span class="s6"># construction with an nonexistent end-point</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">pytz</span><span class="s3">.</span><span class="s1">NonExistentTimeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s5">&quot;2019-03-10 02:00:00&quot;</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span>
                <span class="s5">&quot;2019-03-10 00:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2019-03-10 02:00&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s5">&quot;US/Pacific&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span>
            <span class="s3">)</span>

        <span class="s1">times </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s5">&quot;2019-03-10 00:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2019-03-10 02:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">, </span><span class="s1">nonexistent</span><span class="s3">=</span><span class="s1">option</span>
        <span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">times</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] == </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestGenRangeGeneration</span><span class="s3">:</span>
    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;freqstr,offset&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s5">&quot;B&quot;</span><span class="s3">, </span><span class="s1">BDay</span><span class="s3">()),</span>
            <span class="s3">(</span><span class="s5">&quot;C&quot;</span><span class="s3">, </span><span class="s1">CDay</span><span class="s3">()),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_generate</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">freqstr</span><span class="s3">, </span><span class="s1">offset</span><span class="s3">):</span>
        <span class="s1">rng1 </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">generate_range</span><span class="s3">(</span><span class="s1">START</span><span class="s3">, </span><span class="s1">END</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">offset</span><span class="s3">=</span><span class="s1">offset</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">))</span>
        <span class="s1">rng2 </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">generate_range</span><span class="s3">(</span><span class="s1">START</span><span class="s3">, </span><span class="s1">END</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">offset</span><span class="s3">=</span><span class="s1">freqstr</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">))</span>
        <span class="s2">assert </span><span class="s1">rng1 </span><span class="s3">== </span><span class="s1">rng2</span>

    <span class="s2">def </span><span class="s1">test_1</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span>
            <span class="s1">generate_range</span><span class="s3">(</span>
                <span class="s1">start</span><span class="s3">=</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2009</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">25</span><span class="s3">),</span>
                <span class="s1">end</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
                <span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">,</span>
                <span class="s1">offset</span><span class="s3">=</span><span class="s1">BDay</span><span class="s3">(),</span>
                <span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= [</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2009</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">25</span><span class="s3">), </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2009</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">26</span><span class="s3">)]</span>
        <span class="s2">assert </span><span class="s1">rng </span><span class="s3">== </span><span class="s1">expected</span>

    <span class="s2">def </span><span class="s1">test_2</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span>
            <span class="s1">generate_range</span><span class="s3">(</span>
                <span class="s1">start</span><span class="s3">=</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
                <span class="s1">end</span><span class="s3">=</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">),</span>
                <span class="s1">periods</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
                <span class="s1">offset</span><span class="s3">=</span><span class="s1">BDay</span><span class="s3">(),</span>
                <span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= [</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">), </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">2</span><span class="s3">), </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">3</span><span class="s3">)]</span>
        <span class="s2">assert </span><span class="s1">rng </span><span class="s3">== </span><span class="s1">expected</span>

    <span class="s2">def </span><span class="s1">test_3</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span>
            <span class="s1">generate_range</span><span class="s3">(</span>
                <span class="s1">start</span><span class="s3">=</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">5</span><span class="s3">),</span>
                <span class="s1">end</span><span class="s3">=</span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">6</span><span class="s3">),</span>
                <span class="s1">periods</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
                <span class="s1">offset</span><span class="s3">=</span><span class="s1">BDay</span><span class="s3">(),</span>
                <span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= []</span>
        <span class="s2">assert </span><span class="s1">rng </span><span class="s3">== </span><span class="s1">expected</span>

    <span class="s2">def </span><span class="s1">test_precision_finer_than_offset</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#9907</span>
        <span class="s1">result1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2015-04-15 00:00:03&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2016-04-22 00:00:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;QE&quot;</span>
        <span class="s3">)</span>
        <span class="s1">result2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2015-04-15 00:00:03&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2015-06-22 00:00:04&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;W&quot;</span>
        <span class="s3">)</span>
        <span class="s1">expected1_list </span><span class="s3">= [</span>
            <span class="s5">&quot;2015-06-30 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-09-30 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-12-31 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2016-03-31 00:00:03&quot;</span><span class="s3">,</span>
        <span class="s3">]</span>
        <span class="s1">expected2_list </span><span class="s3">= [</span>
            <span class="s5">&quot;2015-04-19 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-04-26 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-05-03 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-05-10 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-05-17 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-05-24 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-05-31 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-06-07 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-06-14 00:00:03&quot;</span><span class="s3">,</span>
            <span class="s5">&quot;2015-06-21 00:00:03&quot;</span><span class="s3">,</span>
        <span class="s3">]</span>
        <span class="s1">expected1 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s1">expected1_list</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;datetime64[ns]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;QE-DEC&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s2">None</span>
        <span class="s3">)</span>
        <span class="s1">expected2 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s1">expected2_list</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;datetime64[ns]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;W-SUN&quot;</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s2">None</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result1</span><span class="s3">, </span><span class="s1">expected1</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result2</span><span class="s3">, </span><span class="s1">expected2</span><span class="s3">)</span>

    <span class="s1">dt1</span><span class="s3">, </span><span class="s1">dt2 </span><span class="s3">= </span><span class="s5">&quot;2017-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2017-01-01&quot;</span>
    <span class="s1">tz1</span><span class="s3">, </span><span class="s1">tz2 </span><span class="s3">= </span><span class="s5">&quot;US/Eastern&quot;</span><span class="s3">, </span><span class="s5">&quot;Europe/London&quot;</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;start,end&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt1</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz1</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt2</span><span class="s3">)),</span>
            <span class="s3">(</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt1</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz2</span><span class="s3">)),</span>
            <span class="s3">(</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt1</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz1</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz2</span><span class="s3">)),</span>
            <span class="s3">(</span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt1</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz2</span><span class="s3">), </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">dt2</span><span class="s3">, </span><span class="s1">tz</span><span class="s3">=</span><span class="s1">tz1</span><span class="s3">)),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_mismatching_tz_raises_err</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">):</span>
        <span class="s6"># issue 18488</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Start and end cannot both be tz-aware with different timezones&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">BDay</span><span class="s3">())</span>


<span class="s2">class </span><span class="s1">TestBusinessDateRange</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_constructor</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">START</span><span class="s3">, </span><span class="s1">END</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">BDay</span><span class="s3">())</span>
        <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">START</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">20</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">BDay</span><span class="s3">())</span>
        <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">START</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">20</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">BDay</span><span class="s3">())</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;periods must be a number, got B&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2011-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;2012-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;B&quot;</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;2011-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;2012-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;B&quot;</span><span class="s3">)</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;freq must be specified for bdate_range; use date_range instead&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">START</span><span class="s3">, </span><span class="s1">END</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_misc</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2009</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">13</span><span class="s3">)</span>
        <span class="s1">dr </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">20</span><span class="s3">)</span>
        <span class="s1">firstDate </span><span class="s3">= </span><span class="s1">end </span><span class="s3">- </span><span class="s4">19 </span><span class="s3">* </span><span class="s1">BDay</span><span class="s3">()</span>

        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">) == </span><span class="s4">20</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">firstDate</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] == </span><span class="s1">end</span>

    <span class="s2">def </span><span class="s1">test_date_parse_failure</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">badly_formed_date </span><span class="s3">= </span><span class="s5">&quot;2007/100/1&quot;</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Unknown datetime string format, unable to parse: 2007/100/1&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">Timestamp</span><span class="s3">(</span><span class="s1">badly_formed_date</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">badly_formed_date</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">badly_formed_date</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">badly_formed_date</span><span class="s3">, </span><span class="s1">badly_formed_date</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_daterange_bug_456</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH #456</span>
        <span class="s1">rng1 </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;12/5/2011&quot;</span><span class="s3">, </span><span class="s5">&quot;12/5/2011&quot;</span><span class="s3">)</span>
        <span class="s1">rng2 </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;12/2/2011&quot;</span><span class="s3">, </span><span class="s5">&quot;12/5/2011&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rng2</span><span class="s3">.</span><span class="s1">_data</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">BDay</span><span class="s3">()</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng1</span><span class="s3">.</span><span class="s1">union</span><span class="s3">(</span><span class="s1">rng2</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">DatetimeIndex</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span><span class="s5">&quot;inclusive&quot;</span><span class="s3">, [</span><span class="s5">&quot;left&quot;</span><span class="s3">, </span><span class="s5">&quot;right&quot;</span><span class="s3">, </span><span class="s5">&quot;neither&quot;</span><span class="s3">, </span><span class="s5">&quot;both&quot;</span><span class="s3">])</span>
    <span class="s2">def </span><span class="s1">test_bdays_and_open_boundaries</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">inclusive</span><span class="s3">):</span>
        <span class="s6"># GH 6673</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s5">&quot;2018-07-21&quot;  </span><span class="s6"># Saturday</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s5">&quot;2018-07-29&quot;  </span><span class="s6"># Sunday</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;B&quot;</span><span class="s3">, </span><span class="s1">inclusive</span><span class="s3">=</span><span class="s1">inclusive</span><span class="s3">)</span>

        <span class="s1">bday_start </span><span class="s3">= </span><span class="s5">&quot;2018-07-23&quot;  </span><span class="s6"># Monday</span>
        <span class="s1">bday_end </span><span class="s3">= </span><span class="s5">&quot;2018-07-27&quot;  </span><span class="s6"># Friday</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">bday_start</span><span class="s3">, </span><span class="s1">bday_end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s6"># Note: we do _not_ expect the freqs to match here</span>

    <span class="s2">def </span><span class="s1">test_bday_near_overflow</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#24252 avoid doing unnecessary addition that _would_ overflow</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">max</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s5">&quot;D&quot;</span><span class="s3">).</span><span class="s1">to_pydatetime</span><span class="s3">()</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;B&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">start</span><span class="s3">], </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;B&quot;</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s5">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_bday_overflow_error</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#24252 check that we get OutOfBoundsDatetime and not OverflowError</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Out of bounds nanosecond timestamp&quot;</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">.</span><span class="s1">max</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s5">&quot;D&quot;</span><span class="s3">).</span><span class="s1">to_pydatetime</span><span class="s3">()</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">OutOfBoundsDatetime</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;B&quot;</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestCustomDateRange</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_constructor</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">START</span><span class="s3">, </span><span class="s1">END</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">CDay</span><span class="s3">())</span>
        <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">START</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">20</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">CDay</span><span class="s3">())</span>
        <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">START</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">20</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">CDay</span><span class="s3">())</span>

        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;periods must be a number, got C&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2011-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;2012-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;C&quot;</span><span class="s3">)</span>

        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">TypeError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;2011-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;2012-1-1&quot;</span><span class="s3">, </span><span class="s5">&quot;C&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_misc</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2009</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">13</span><span class="s3">)</span>
        <span class="s1">dr </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">20</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span><span class="s3">)</span>
        <span class="s1">firstDate </span><span class="s3">= </span><span class="s1">end </span><span class="s3">- </span><span class="s4">19 </span><span class="s3">* </span><span class="s1">CDay</span><span class="s3">()</span>

        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">dr</span><span class="s3">) == </span><span class="s4">20</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[</span><span class="s4">0</span><span class="s3">] == </span><span class="s1">firstDate</span>
        <span class="s2">assert </span><span class="s1">dr</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">] == </span><span class="s1">end</span>

    <span class="s2">def </span><span class="s1">test_daterange_bug_456</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH #456</span>
        <span class="s1">rng1 </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;12/5/2011&quot;</span><span class="s3">, </span><span class="s5">&quot;12/5/2011&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span><span class="s3">)</span>
        <span class="s1">rng2 </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;12/2/2011&quot;</span><span class="s3">, </span><span class="s5">&quot;12/5/2011&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rng2</span><span class="s3">.</span><span class="s1">_data</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">CDay</span><span class="s3">()</span>

        <span class="s1">result </span><span class="s3">= </span><span class="s1">rng1</span><span class="s3">.</span><span class="s1">union</span><span class="s3">(</span><span class="s1">rng2</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">DatetimeIndex</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_cdaterange</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-05-02&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-05-03&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">freq</span>

    <span class="s2">def </span><span class="s1">test_cdaterange_weekmask</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span>
            <span class="s5">&quot;2013-05-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span><span class="s3">, </span><span class="s1">weekmask</span><span class="s3">=</span><span class="s5">&quot;Sun Mon Tue Wed Thu&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-05-02&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-05-05&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">freq</span>

        <span class="s6"># raise with non-custom freq</span>
        <span class="s1">msg </span><span class="s3">= (</span>
            <span class="s5">&quot;a custom frequency string is required when holidays or &quot;</span>
            <span class="s5">&quot;weekmask are passed, got frequency B&quot;</span>
        <span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">weekmask</span><span class="s3">=</span><span class="s5">&quot;Sun Mon Tue Wed Thu&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_cdaterange_holidays</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span>
            <span class="s5">&quot;2013-05-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span><span class="s3">, </span><span class="s1">holidays</span><span class="s3">=[</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">], </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-05-02&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-05-03&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-05-06&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">freq</span>

        <span class="s6"># raise with non-custom freq</span>
        <span class="s1">msg </span><span class="s3">= (</span>
            <span class="s5">&quot;a custom frequency string is required when holidays or &quot;</span>
            <span class="s5">&quot;weekmask are passed, got frequency B&quot;</span>
        <span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">holidays</span><span class="s3">=[</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">])</span>

    <span class="s2">def </span><span class="s1">test_cdaterange_weekmask_and_holidays</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">bdate_range</span><span class="s3">(</span>
            <span class="s5">&quot;2013-05-01&quot;</span><span class="s3">,</span>
            <span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span><span class="s3">,</span>
            <span class="s1">weekmask</span><span class="s3">=</span><span class="s5">&quot;Sun Mon Tue Wed Thu&quot;</span><span class="s3">,</span>
            <span class="s1">holidays</span><span class="s3">=[</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">],</span>
            <span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-05-02&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-05-05&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-05-06&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">result</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">expected</span><span class="s3">.</span><span class="s1">freq</span>

    <span class="s2">def </span><span class="s1">test_cdaterange_holidays_weekmask_requires_freqstr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># raise with non-custom freq</span>
        <span class="s1">msg </span><span class="s3">= (</span>
            <span class="s5">&quot;a custom frequency string is required when holidays or &quot;</span>
            <span class="s5">&quot;weekmask are passed, got frequency B&quot;</span>
        <span class="s3">)</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span>
                <span class="s5">&quot;2013-05-01&quot;</span><span class="s3">,</span>
                <span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">,</span>
                <span class="s1">weekmask</span><span class="s3">=</span><span class="s5">&quot;Sun Mon Tue Wed Thu&quot;</span><span class="s3">,</span>
                <span class="s1">holidays</span><span class="s3">=[</span><span class="s5">&quot;2013-05-01&quot;</span><span class="s3">],</span>
            <span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;freq&quot;</span><span class="s3">, [</span><span class="s1">freq </span><span class="s2">for </span><span class="s1">freq </span><span class="s2">in </span><span class="s1">prefix_mapping </span><span class="s2">if </span><span class="s1">freq</span><span class="s3">.</span><span class="s1">startswith</span><span class="s3">(</span><span class="s5">&quot;C&quot;</span><span class="s3">)]</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_all_custom_freq</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">):</span>
        <span class="s6"># should not raise</span>
        <span class="s1">bdate_range</span><span class="s3">(</span>
            <span class="s1">START</span><span class="s3">, </span><span class="s1">END</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">, </span><span class="s1">weekmask</span><span class="s3">=</span><span class="s5">&quot;Mon Wed Fri&quot;</span><span class="s3">, </span><span class="s1">holidays</span><span class="s3">=[</span><span class="s5">&quot;2009-03-14&quot;</span><span class="s3">]</span>
        <span class="s3">)</span>

        <span class="s1">bad_freq </span><span class="s3">= </span><span class="s1">freq </span><span class="s3">+ </span><span class="s5">&quot;FOO&quot;</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">f&quot;invalid custom frequency string: </span><span class="s2">{</span><span class="s1">bad_freq</span><span class="s2">}</span><span class="s5">&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">bdate_range</span><span class="s3">(</span><span class="s1">START</span><span class="s3">, </span><span class="s1">END</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">bad_freq</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;start_end&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s5">&quot;2018-01-01T00:00:01.000Z&quot;</span><span class="s3">, </span><span class="s5">&quot;2018-01-03T00:00:01.000Z&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2018-01-01T00:00:00.010Z&quot;</span><span class="s3">, </span><span class="s5">&quot;2018-01-03T00:00:00.010Z&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s5">&quot;2001-01-01T00:00:00.010Z&quot;</span><span class="s3">, </span><span class="s5">&quot;2001-01-03T00:00:00.010Z&quot;</span><span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_range_with_millisecond_resolution</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">start_end</span><span class="s3">):</span>
        <span class="s6"># https://github.com/pandas-dev/pandas/issues/24110</span>
        <span class="s1">start</span><span class="s3">, </span><span class="s1">end </span><span class="s3">= </span><span class="s1">start_end</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">inclusive</span><span class="s3">=</span><span class="s5">&quot;left&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s1">start</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">&quot;M8[ns, UTC]&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;start,period,expected&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s5">&quot;2022-07-23 00:00:00+02:00&quot;</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, [</span><span class="s5">&quot;2022-07-25 00:00:00+02:00&quot;</span><span class="s3">]),</span>
            <span class="s3">(</span><span class="s5">&quot;2022-07-22 00:00:00+02:00&quot;</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, [</span><span class="s5">&quot;2022-07-22 00:00:00+02:00&quot;</span><span class="s3">]),</span>
            <span class="s3">(</span>
                <span class="s5">&quot;2022-07-22 00:00:00+02:00&quot;</span><span class="s3">,</span>
                <span class="s4">2</span><span class="s3">,</span>
                <span class="s3">[</span><span class="s5">&quot;2022-07-22 00:00:00+02:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2022-07-25 00:00:00+02:00&quot;</span><span class="s3">],</span>
            <span class="s3">),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_range_with_timezone_and_custombusinessday</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">period</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">):</span>
        <span class="s6"># GH49441</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">start</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s1">period</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;C&quot;</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">expected</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s5">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestDateRangeNonNano</span><span class="s3">:</span>
    <span class="s2">def </span><span class="s1">test_date_range_reso_validation</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;'unit' must be one of 's', 'ms', 'us', 'ns'&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2016-03-04&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;h&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_freq_higher_than_reso</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># freq being higher-resolution than reso is a problem</span>
        <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Use a lower freq or a higher unit instead&quot;</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s1">msg</span><span class="s3">):</span>
            <span class="s6">#    # TODO give a more useful or informative message?</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2016-01-02&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;ms&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_freq_matches_reso</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s6"># GH#49106 matching reso is OK</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2016-01-01 00:00:01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;ms&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;ms&quot;</span><span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">1_451_606_400_000</span><span class="s3">, </span><span class="s4">1_451_606_401_001</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">.</span><span class="s1">view</span><span class="s3">(</span><span class="s5">&quot;M8[ms]&quot;</span><span class="s3">), </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;ms&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2016-01-01 00:00:01&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;us&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;us&quot;</span><span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span><span class="s4">1_451_606_400_000_000</span><span class="s3">, </span><span class="s4">1_451_606_401_000_001</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">int64</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">.</span><span class="s1">view</span><span class="s3">(</span><span class="s5">&quot;M8[us]&quot;</span><span class="s3">), </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;us&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2016-01-01 00:00:00.001&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span>
            <span class="s4">1_451_606_400_000_000_000</span><span class="s3">, </span><span class="s4">1_451_606_400_001_000_001</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">int64</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">.</span><span class="s1">view</span><span class="s3">(</span><span class="s5">&quot;M8[ns]&quot;</span><span class="s3">), </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;ns&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_freq_lower_than_endpoints</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2022-10-19 11:50:44.719781&quot;</span><span class="s3">)</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">Timestamp</span><span class="s3">(</span><span class="s5">&quot;2022-10-19 11:50:47.066458&quot;</span><span class="s3">)</span>

        <span class="s6"># start and end cannot be cast to &quot;s&quot; unit without lossy rounding,</span>
        <span class="s6">#  so we do not allow this in date_range</span>
        <span class="s2">with </span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">raises</span><span class="s3">(</span><span class="s1">ValueError</span><span class="s3">, </span><span class="s1">match</span><span class="s3">=</span><span class="s5">&quot;Cannot losslessly convert units&quot;</span><span class="s3">):</span>
            <span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;s&quot;</span><span class="s3">)</span>

        <span class="s6"># but we can losslessly cast to &quot;us&quot;</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;us&quot;</span><span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s1">start</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s5">&quot;us&quot;</span><span class="s3">).</span><span class="s1">_value</span><span class="s3">, </span><span class="s1">end</span><span class="s3">.</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s5">&quot;us&quot;</span><span class="s3">).</span><span class="s1">_value</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">np</span><span class="s3">.</span><span class="s1">int64</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">.</span><span class="s1">view</span><span class="s3">(</span><span class="s5">&quot;M8[us]&quot;</span><span class="s3">))</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_non_nano</span><span class="s3">(</span><span class="s1">self</span><span class="s3">):</span>
        <span class="s1">start </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s5">&quot;1066-10-14&quot;</span><span class="s3">)  </span><span class="s6"># Battle of Hastings</span>
        <span class="s1">end </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">datetime64</span><span class="s3">(</span><span class="s5">&quot;2305-07-13&quot;</span><span class="s3">)  </span><span class="s6"># Jean-Luc Picard's birthday</span>

        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;D&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s5">&quot;s&quot;</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s5">&quot;D&quot;</span>
        <span class="s2">assert </span><span class="s1">dti</span><span class="s3">.</span><span class="s1">dtype </span><span class="s3">== </span><span class="s5">&quot;M8[s]&quot;</span>

        <span class="s1">exp </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">arange</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s5">&quot;M8[s]&quot;</span><span class="s3">).</span><span class="s1">view</span><span class="s3">(</span><span class="s5">&quot;i8&quot;</span><span class="s3">),</span>
            <span class="s3">(</span><span class="s1">end </span><span class="s3">+ </span><span class="s4">1</span><span class="s3">).</span><span class="s1">astype</span><span class="s3">(</span><span class="s5">&quot;M8[s]&quot;</span><span class="s3">).</span><span class="s1">view</span><span class="s3">(</span><span class="s5">&quot;i8&quot;</span><span class="s3">),</span>
            <span class="s4">24 </span><span class="s3">* </span><span class="s4">3600</span><span class="s3">,</span>
        <span class="s3">).</span><span class="s1">view</span><span class="s3">(</span><span class="s5">&quot;M8[s]&quot;</span><span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_numpy_array_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">.</span><span class="s1">to_numpy</span><span class="s3">(), </span><span class="s1">exp</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">TestDateRangeNonTickFreq</span><span class="s3">:</span>
    <span class="s6"># Tests revolving around less-common (non-Tick) `freq` keywords.</span>

    <span class="s2">def </span><span class="s1">test_date_range_custom_business_month_begin</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">hcal </span><span class="s3">= </span><span class="s1">USFederalHolidayCalendar</span><span class="s3">()</span>
        <span class="s1">freq </span><span class="s3">= </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">CBMonthBegin</span><span class="s3">(</span><span class="s1">calendar</span><span class="s3">=</span><span class="s1">hcal</span><span class="s3">)</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;20120101&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">all</span><span class="s3">(</span><span class="s1">freq</span><span class="s3">.</span><span class="s1">is_on_offset</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">dti</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s5">&quot;2012-01-03&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-02-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-03-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-04-02&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-05-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-06-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-07-02&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-08-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-09-04&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-10-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-11-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-12-03&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_custom_business_month_end</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">hcal </span><span class="s3">= </span><span class="s1">USFederalHolidayCalendar</span><span class="s3">()</span>
        <span class="s1">freq </span><span class="s3">= </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">CBMonthEnd</span><span class="s3">(</span><span class="s1">calendar</span><span class="s3">=</span><span class="s1">hcal</span><span class="s3">)</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;20120101&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;20130101&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">all</span><span class="s3">(</span><span class="s1">freq</span><span class="s3">.</span><span class="s1">is_on_offset</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">dti</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s5">&quot;2012-01-31&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-02-29&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-03-30&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-04-30&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-05-31&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-06-29&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-07-31&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-08-31&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-09-28&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-10-31&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-11-30&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2012-12-31&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_with_custom_holidays</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH#30593</span>
        <span class="s1">freq </span><span class="s3">= </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">CustomBusinessHour</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;15:00&quot;</span><span class="s3">, </span><span class="s1">holidays</span><span class="s3">=[</span><span class="s5">&quot;2020-11-26&quot;</span><span class="s3">])</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2020-11-25 15:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">4</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s5">&quot;2020-11-25 15:00:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2020-11-25 16:00:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2020-11-27 15:00:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2020-11-27 16:00:00&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_businesshour</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">idx </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s5">&quot;2014-07-04 09:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 10:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 11:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 12:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 13:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 14:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 15:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 16:00&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014-07-04 09:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-07-04 16:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">rng</span><span class="s3">)</span>

        <span class="s1">idx </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2014-07-04 16:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-07-07 09:00&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span>
        <span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014-07-04 16:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-07-07 09:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">rng</span><span class="s3">)</span>

        <span class="s1">idx </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s5">&quot;2014-07-04 09:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 10:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 11:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 12:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 13:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 14:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 15:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 16:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 09:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 10:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 11:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 12:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 13:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 14:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 15:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 16:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 09:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 10:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 11:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 12:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 13:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 14:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 15:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 16:00&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2014-07-04 09:00&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-07-08 16:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx</span><span class="s3">, </span><span class="s1">rng</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_business_hour2</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">idx1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2014-07-04 15:00&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2014-07-08 10:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span>
        <span class="s3">)</span>
        <span class="s1">idx2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2014-07-04 15:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">12</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">idx3 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2014-07-08 10:00&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">12</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s5">&quot;2014-07-04 15:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-04 16:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 09:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 10:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 11:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 12:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 13:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 14:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 15:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-07 16:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 09:00&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2014-07-08 10:00&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx1</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx2</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx3</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">idx4 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2014-07-04 15:45&quot;</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2014-07-08 10:45&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span>
        <span class="s3">)</span>
        <span class="s1">idx5 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2014-07-04 15:45&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">12</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">idx6 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">end</span><span class="s3">=</span><span class="s5">&quot;2014-07-08 10:45&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">12</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>

        <span class="s1">expected2 </span><span class="s3">= </span><span class="s1">expected </span><span class="s3">+ </span><span class="s1">Timedelta</span><span class="s3">(</span><span class="s1">minutes</span><span class="s3">=</span><span class="s4">45</span><span class="s3">).</span><span class="s1">as_unit</span><span class="s3">(</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected2</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">= </span><span class="s5">&quot;bh&quot;</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx4</span><span class="s3">, </span><span class="s1">expected2</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx5</span><span class="s3">, </span><span class="s1">expected2</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx6</span><span class="s3">, </span><span class="s1">expected2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_business_hour_short</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH#49835</span>
        <span class="s1">idx4 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2014-07-01 10:00&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected4 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s5">&quot;2014-07-01 10:00&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;bh&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">idx4</span><span class="s3">, </span><span class="s1">expected4</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_year_start</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># see GH#9313</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2013&quot;</span><span class="s3">, </span><span class="s5">&quot;7/1/2017&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YS&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2015-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2016-01-01&quot;</span><span class="s3">, </span><span class="s5">&quot;2017-01-01&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YS&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_year_end</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># see GH#9313</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2013&quot;</span><span class="s3">, </span><span class="s5">&quot;7/1/2017&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YE&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2015-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2016-12-31&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;YE&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_negative_freq_year_end</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH#11018</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2011-12-31&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;-2YE&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2011-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2009-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2007-12-31&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;-2YE&quot;</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rng</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s5">&quot;-2YE&quot;</span>

    <span class="s2">def </span><span class="s1">test_date_range_business_year_end_year</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># see GH#9313</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2013&quot;</span><span class="s3">, </span><span class="s5">&quot;7/1/2017&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;BYE&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2015-12-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2016-12-30&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;BYE&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_bms</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH#1645</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;1/1/2000&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">10</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;BMS&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>

        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span>
                <span class="s5">&quot;2000-01-03&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-02-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-03-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-04-03&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-05-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-06-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-07-03&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-08-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-09-01&quot;</span><span class="s3">,</span>
                <span class="s5">&quot;2000-10-02&quot;</span><span class="s3">,</span>
            <span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;BMS&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_semi_month_begin</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">dates </span><span class="s3">= [</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2007</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">1</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
        <span class="s3">]</span>
        <span class="s6"># ensure generating a range with DatetimeIndex gives same result</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">dates</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">end</span><span class="s3">=</span><span class="s1">dates</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;SMS&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">dates</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;SMS&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_semi_month_end</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">dates </span><span class="s3">= [</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2007</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">31</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">31</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">2</span><span class="s3">, </span><span class="s4">29</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">3</span><span class="s3">, </span><span class="s4">31</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">4</span><span class="s3">, </span><span class="s4">30</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">31</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">6</span><span class="s3">, </span><span class="s4">30</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">7</span><span class="s3">, </span><span class="s4">31</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">8</span><span class="s3">, </span><span class="s4">31</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">9</span><span class="s3">, </span><span class="s4">30</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s4">31</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">11</span><span class="s3">, </span><span class="s4">30</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">15</span><span class="s3">),</span>
            <span class="s1">datetime</span><span class="s3">(</span><span class="s4">2008</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">31</span><span class="s3">),</span>
        <span class="s3">]</span>
        <span class="s6"># ensure generating a range with DatetimeIndex gives same result</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">dates</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s1">end</span><span class="s3">=</span><span class="s1">dates</span><span class="s3">[-</span><span class="s4">1</span><span class="s3">], </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;SME&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span><span class="s1">dates</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;SME&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_week_of_month</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH#20517</span>
        <span class="s6"># Note the start here is not on_offset for this freq</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;20110101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;WOM-1MON&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">([</span><span class="s5">&quot;2011-01-03&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;WOM-1MON&quot;</span><span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

        <span class="s1">result2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;20110101&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;WOM-1MON&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected2 </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2011-01-03&quot;</span><span class="s3">, </span><span class="s5">&quot;2011-02-07&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;WOM-1MON&quot;</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result2</span><span class="s3">, </span><span class="s1">expected2</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_week_of_month2</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH#5115, GH#5348</span>
        <span class="s1">result </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2013-1-1&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">4</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;WOM-1SAT&quot;</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-01-05&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-02-02&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-03-02&quot;</span><span class="s3">, </span><span class="s5">&quot;2013-04-06&quot;</span><span class="s3">],</span>
            <span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;WOM-1SAT&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">test_date_range_negative_freq_month_end</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s6"># GH#11018</span>
        <span class="s1">rng </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s5">&quot;2011-01-31&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;-2ME&quot;</span><span class="s3">, </span><span class="s1">periods</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">)</span>
        <span class="s1">exp </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2011-01-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2010-11-30&quot;</span><span class="s3">, </span><span class="s5">&quot;2010-09-30&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s5">&quot;-2ME&quot;</span>
        <span class="s3">)</span>
        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">rng</span><span class="s3">, </span><span class="s1">exp</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">rng</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s5">&quot;-2ME&quot;</span>

    <span class="s2">def </span><span class="s1">test_date_range_fy5253</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">unit</span><span class="s3">):</span>
        <span class="s1">freq </span><span class="s3">= </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">FY5253</span><span class="s3">(</span><span class="s1">startingMonth</span><span class="s3">=</span><span class="s4">1</span><span class="s3">, </span><span class="s1">weekday</span><span class="s3">=</span><span class="s4">3</span><span class="s3">, </span><span class="s1">variation</span><span class="s3">=</span><span class="s5">&quot;nearest&quot;</span><span class="s3">)</span>
        <span class="s1">dti </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">=</span><span class="s5">&quot;2013-01-01&quot;</span><span class="s3">,</span>
            <span class="s1">periods</span><span class="s3">=</span><span class="s4">2</span><span class="s3">,</span>
            <span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span><span class="s3">,</span>
            <span class="s1">unit</span><span class="s3">=</span><span class="s1">unit</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">expected </span><span class="s3">= </span><span class="s1">DatetimeIndex</span><span class="s3">(</span>
            <span class="s3">[</span><span class="s5">&quot;2013-01-31&quot;</span><span class="s3">, </span><span class="s5">&quot;2014-01-30&quot;</span><span class="s3">], </span><span class="s1">dtype</span><span class="s3">=</span><span class="s5">f&quot;M8[</span><span class="s2">{</span><span class="s1">unit</span><span class="s2">}</span><span class="s5">]&quot;</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freq</span>
        <span class="s3">)</span>

        <span class="s1">tm</span><span class="s3">.</span><span class="s1">assert_index_equal</span><span class="s3">(</span><span class="s1">dti</span><span class="s3">, </span><span class="s1">expected</span><span class="s3">)</span>

    <span class="s3">@</span><span class="s1">pytest</span><span class="s3">.</span><span class="s1">mark</span><span class="s3">.</span><span class="s1">parametrize</span><span class="s3">(</span>
        <span class="s5">&quot;freqstr,offset&quot;</span><span class="s3">,</span>
        <span class="s3">[</span>
            <span class="s3">(</span><span class="s5">&quot;QS&quot;</span><span class="s3">, </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">QuarterBegin</span><span class="s3">(</span><span class="s1">startingMonth</span><span class="s3">=</span><span class="s4">1</span><span class="s3">)),</span>
            <span class="s3">(</span><span class="s5">&quot;BQE&quot;</span><span class="s3">, </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">BQuarterEnd</span><span class="s3">(</span><span class="s1">startingMonth</span><span class="s3">=</span><span class="s4">12</span><span class="s3">)),</span>
            <span class="s3">(</span><span class="s5">&quot;W-SUN&quot;</span><span class="s3">, </span><span class="s1">offsets</span><span class="s3">.</span><span class="s1">Week</span><span class="s3">(</span><span class="s1">weekday</span><span class="s3">=</span><span class="s4">6</span><span class="s3">)),</span>
        <span class="s3">],</span>
    <span class="s3">)</span>
    <span class="s2">def </span><span class="s1">test_date_range_freqstr_matches_offset</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">freqstr</span><span class="s3">, </span><span class="s1">offset</span><span class="s3">):</span>
        <span class="s1">sdate </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">1999</span><span class="s3">, </span><span class="s4">12</span><span class="s3">, </span><span class="s4">25</span><span class="s3">)</span>
        <span class="s1">edate </span><span class="s3">= </span><span class="s1">datetime</span><span class="s3">(</span><span class="s4">2000</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>

        <span class="s1">idx1 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">sdate</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">edate</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">freqstr</span><span class="s3">)</span>
        <span class="s1">idx2 </span><span class="s3">= </span><span class="s1">date_range</span><span class="s3">(</span><span class="s1">start</span><span class="s3">=</span><span class="s1">sdate</span><span class="s3">, </span><span class="s1">end</span><span class="s3">=</span><span class="s1">edate</span><span class="s3">, </span><span class="s1">freq</span><span class="s3">=</span><span class="s1">offset</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">len</span><span class="s3">(</span><span class="s1">idx1</span><span class="s3">) == </span><span class="s1">len</span><span class="s3">(</span><span class="s1">idx2</span><span class="s3">)</span>
        <span class="s2">assert </span><span class="s1">idx1</span><span class="s3">.</span><span class="s1">freq </span><span class="s3">== </span><span class="s1">idx2</span><span class="s3">.</span><span class="s1">freq</span>
</pre>
</body>
</html>