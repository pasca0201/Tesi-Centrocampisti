<html>
<head>
<title>test_to_numeric.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_to_numeric.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">decimal</span>

<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">from </span><span class="s1">numpy </span><span class="s0">import </span><span class="s1">iinfo</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">util</span><span class="s2">.</span><span class="s1">_test_decorators </span><span class="s0">as </span><span class="s1">td</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">ArrowDtype</span><span class="s2">,</span>
    <span class="s1">DataFrame</span><span class="s2">,</span>
    <span class="s1">Index</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">option_context</span><span class="s2">,</span>
    <span class="s1">to_numeric</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">params</span><span class="s2">=[</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;ignore&quot;</span><span class="s2">, </span><span class="s3">&quot;raise&quot;</span><span class="s2">, </span><span class="s3">&quot;coerce&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">errors</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">params</span><span class="s2">=[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">signed</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">params</span><span class="s2">=[</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x</span><span class="s2">, </span><span class="s1">str</span><span class="s2">], </span><span class="s1">ids</span><span class="s2">=[</span><span class="s3">&quot;identity&quot;</span><span class="s2">, </span><span class="s3">&quot;str&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">params</span><span class="s2">=[</span><span class="s4">47393996303418497800</span><span class="s2">, </span><span class="s4">100000000000000000000</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">large_val</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span><span class="s1">params</span><span class="s2">=[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">multiple_elts</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">(</span>
    <span class="s1">params</span><span class="s2">=[</span>
        <span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">Index</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;idx&quot;</span><span class="s2">), </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;ser&quot;</span><span class="s2">), </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">Index</span><span class="s2">(</span><span class="s1">x</span><span class="s2">).</span><span class="s1">values</span><span class="s2">), </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">),</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">transform_assert_equal</span><span class="s2">(</span><span class="s1">request</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">request</span><span class="s2">.</span><span class="s1">param</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;input_kwargs,result_kwargs&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">({}, {</span><span class="s3">&quot;dtype&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">}),</span>
        <span class="s2">({</span><span class="s3">&quot;errors&quot;</span><span class="s2">: </span><span class="s3">&quot;coerce&quot;</span><span class="s2">, </span><span class="s3">&quot;downcast&quot;</span><span class="s2">: </span><span class="s3">&quot;integer&quot;</span><span class="s2">}, {</span><span class="s3">&quot;dtype&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">}),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_empty</span><span class="s2">(</span><span class="s1">input_kwargs</span><span class="s2">, </span><span class="s1">result_kwargs</span><span class="s2">):</span>
    <span class="s5"># see gh-16302</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, **</span><span class="s1">input_kwargs</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([], **</span><span class="s1">result_kwargs</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;infer_string&quot;</span><span class="s2">, [</span><span class="s0">False</span><span class="s2">, </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">td</span><span class="s2">.</span><span class="s1">skip_if_no</span><span class="s2">(</span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">))]</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;last_val&quot;</span><span class="s2">, [</span><span class="s3">&quot;7&quot;</span><span class="s2">, </span><span class="s4">7</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_series</span><span class="s2">(</span><span class="s1">last_val</span><span class="s2">, </span><span class="s1">infer_string</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">option_context</span><span class="s2">(</span><span class="s3">&quot;future.infer_string&quot;</span><span class="s2">, </span><span class="s1">infer_string</span><span class="s2">):</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;-3.14&quot;</span><span class="s2">, </span><span class="s1">last_val</span><span class="s2">])</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s4">7</span><span class="s2">])</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">, </span><span class="s4">5.0</span><span class="s2">],</span>
        <span class="s5"># Bool is regarded as numeric.</span>
        <span class="s2">[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">],</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_series_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">):</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">list</span><span class="s2">(</span><span class="s3">&quot;ABCD&quot;</span><span class="s2">), </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EFG&quot;</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">ser</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data,msg&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s3">&quot;apple&quot;</span><span class="s2">], </span><span class="s3">'Unable to parse string &quot;apple&quot; at position 2'</span><span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s2">[</span><span class="s3">&quot;orange&quot;</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s3">&quot;apple&quot;</span><span class="s2">],</span>
            <span class="s3">'Unable to parse string &quot;orange&quot; at position 0'</span><span class="s2">,</span>
        <span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_error</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;raise&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;errors,exp_data&quot;</span><span class="s2">, [(</span><span class="s3">&quot;ignore&quot;</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s3">&quot;apple&quot;</span><span class="s2">]), (</span><span class="s3">&quot;coerce&quot;</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])]</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_ignore_error</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">, </span><span class="s1">exp_data</span><span class="s2">):</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s3">&quot;apple&quot;</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">exp_data</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;errors,exp&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;raise&quot;</span><span class="s2">, </span><span class="s3">'Unable to parse string &quot;apple&quot; at position 2'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;ignore&quot;</span><span class="s2">, [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s3">&quot;apple&quot;</span><span class="s2">]),</span>
        <span class="s5"># Coerces to float.</span>
        <span class="s2">(</span><span class="s3">&quot;coerce&quot;</span><span class="s2">, [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">0.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_bool_handling</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">):</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s3">&quot;apple&quot;</span><span class="s2">])</span>

    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">exp</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">exp</span><span class="s2">):</span>
            <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">exp</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_list</span><span class="s2">():</span>
    <span class="s1">ser </span><span class="s2">= [</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;-3.14&quot;</span><span class="s2">, </span><span class="s3">&quot;7&quot;</span><span class="s2">]</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s4">7</span><span class="s2">])</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data,arr_kwargs&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">], {</span><span class="s3">&quot;dtype&quot;</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">}),</span>
        <span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">, </span><span class="s4">5.0</span><span class="s2">], {}),</span>
        <span class="s5"># Boolean is regarded as numeric.</span>
        <span class="s2">([</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">], {}),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_list_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">arr_kwargs</span><span class="s2">):</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, **</span><span class="s1">arr_kwargs</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;kwargs&quot;</span><span class="s2">, [{</span><span class="s3">&quot;dtype&quot;</span><span class="s2">: </span><span class="s3">&quot;O&quot;</span><span class="s2">}, {}])</span>
<span class="s0">def </span><span class="s1">test_numeric</span><span class="s2">(</span><span class="s1">kwargs</span><span class="s2">):</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s4">7</span><span class="s2">]</span>

    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;columns&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s5"># One column.</span>
        <span class="s3">&quot;a&quot;</span><span class="s2">,</span>
        <span class="s5"># Multiple columns.</span>
        <span class="s2">[</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">],</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_numeric_df_columns</span><span class="s2">(</span><span class="s1">columns</span><span class="s2">):</span>
    <span class="s5"># see gh-14827</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
        <span class="s2">{</span>
            <span class="s3">&quot;a&quot;</span><span class="s2">: [</span><span class="s4">1.2</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">.</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s4">3.14</span><span class="s2">), </span><span class="s1">decimal</span><span class="s2">.</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s3">&quot;infinity&quot;</span><span class="s2">), </span><span class="s3">&quot;0.1&quot;</span><span class="s2">],</span>
            <span class="s3">&quot;b&quot;</span><span class="s2">: [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">],</span>
        <span class="s2">}</span>
    <span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s3">&quot;a&quot;</span><span class="s2">: [</span><span class="s4">1.2</span><span class="s2">, </span><span class="s4">3.14</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">], </span><span class="s3">&quot;b&quot;</span><span class="s2">: [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">, </span><span class="s4">3.0</span><span class="s2">, </span><span class="s4">4.0</span><span class="s2">]})</span>

    <span class="s1">df_copy </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s1">df_copy</span><span class="s2">[</span><span class="s1">columns</span><span class="s2">] = </span><span class="s1">df_copy</span><span class="s2">[</span><span class="s1">columns</span><span class="s2">].</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">to_numeric</span><span class="s2">)</span>

    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df_copy</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data,exp_data&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span>
            <span class="s2">[[</span><span class="s1">decimal</span><span class="s2">.</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s4">3.14</span><span class="s2">), </span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">.</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s4">1.6</span><span class="s2">), </span><span class="s4">0.1</span><span class="s2">],</span>
            <span class="s2">[[</span><span class="s4">3.14</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], </span><span class="s4">1.6</span><span class="s2">, </span><span class="s4">0.1</span><span class="s2">],</span>
        <span class="s2">),</span>
        <span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">decimal</span><span class="s2">.</span><span class="s1">Decimal</span><span class="s2">(</span><span class="s4">3.14</span><span class="s2">), </span><span class="s4">1.0</span><span class="s2">]), </span><span class="s4">0.1</span><span class="s2">], [[</span><span class="s4">3.14</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], </span><span class="s4">0.1</span><span class="s2">]),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_numeric_embedded_arr_likes</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">exp_data</span><span class="s2">):</span>
    <span class="s5"># Test to_numeric with embedded lists and arrays</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">data</span><span class="s2">})</span>
    <span class="s1">df</span><span class="s2">[</span><span class="s3">&quot;a&quot;</span><span class="s2">] = </span><span class="s1">df</span><span class="s2">[</span><span class="s3">&quot;a&quot;</span><span class="s2">].</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">to_numeric</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">exp_data</span><span class="s2">})</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_all_nan</span><span class="s2">():</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;c&quot;</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;coerce&quot;</span><span class="s2">)</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_type_check</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">):</span>
    <span class="s5"># see gh-11776</span>
    <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s3">&quot;a&quot;</span><span class="s2">: [</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">3.14</span><span class="s2">, </span><span class="s4">7</span><span class="s2">], </span><span class="s3">&quot;b&quot;</span><span class="s2">: [</span><span class="s3">&quot;4&quot;</span><span class="s2">, </span><span class="s3">&quot;5&quot;</span><span class="s2">, </span><span class="s3">&quot;6&quot;</span><span class="s2">]})</span>
    <span class="s1">kwargs </span><span class="s2">= {</span><span class="s3">&quot;errors&quot;</span><span class="s2">: </span><span class="s1">errors</span><span class="s2">} </span><span class="s0">if </span><span class="s1">errors </span><span class="s0">is not None else </span><span class="s2">{}</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;1-d array&quot;</span><span class="s2">):</span>
        <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">df</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;val&quot;</span><span class="s2">, [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">20001</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_scalar</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">signed</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">):</span>
    <span class="s1">val </span><span class="s2">= -</span><span class="s1">val </span><span class="s0">if </span><span class="s1">signed </span><span class="s0">else </span><span class="s1">val</span>
    <span class="s0">assert </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)) == </span><span class="s1">float</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_really_large_scalar</span><span class="s2">(</span><span class="s1">large_val</span><span class="s2">, </span><span class="s1">signed</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">):</span>
    <span class="s5"># see gh-24910</span>
    <span class="s1">kwargs </span><span class="s2">= {</span><span class="s3">&quot;errors&quot;</span><span class="s2">: </span><span class="s1">errors</span><span class="s2">} </span><span class="s0">if </span><span class="s1">errors </span><span class="s0">is not None else </span><span class="s2">{}</span>
    <span class="s1">val </span><span class="s2">= -</span><span class="s1">large_val </span><span class="s0">if </span><span class="s1">signed </span><span class="s0">else </span><span class="s1">large_val</span>

    <span class="s1">val </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>
    <span class="s1">val_is_string </span><span class="s2">= </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">str</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">val_is_string </span><span class="s0">and </span><span class="s1">errors </span><span class="s0">in </span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;raise&quot;</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Integer out of range. at position 0&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">val</span><span class="s2">) </span><span class="s0">if </span><span class="s2">(</span><span class="s1">errors </span><span class="s2">== </span><span class="s3">&quot;coerce&quot; </span><span class="s0">and </span><span class="s1">val_is_string</span><span class="s2">) </span><span class="s0">else </span><span class="s1">val</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">), </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_really_large_in_arr</span><span class="s2">(</span><span class="s1">large_val</span><span class="s2">, </span><span class="s1">signed</span><span class="s2">, </span><span class="s1">transform</span><span class="s2">, </span><span class="s1">multiple_elts</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">):</span>
    <span class="s5"># see gh-24910</span>
    <span class="s1">kwargs </span><span class="s2">= {</span><span class="s3">&quot;errors&quot;</span><span class="s2">: </span><span class="s1">errors</span><span class="s2">} </span><span class="s0">if </span><span class="s1">errors </span><span class="s0">is not None else </span><span class="s2">{}</span>
    <span class="s1">val </span><span class="s2">= -</span><span class="s1">large_val </span><span class="s0">if </span><span class="s1">signed </span><span class="s0">else </span><span class="s1">large_val</span>
    <span class="s1">val </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>

    <span class="s1">extra_elt </span><span class="s2">= </span><span class="s3">&quot;string&quot;</span>
    <span class="s1">arr </span><span class="s2">= [</span><span class="s1">val</span><span class="s2">] + </span><span class="s1">multiple_elts </span><span class="s2">* [</span><span class="s1">extra_elt</span><span class="s2">]</span>

    <span class="s1">val_is_string </span><span class="s2">= </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">str</span><span class="s2">)</span>
    <span class="s1">coercing </span><span class="s2">= </span><span class="s1">errors </span><span class="s2">== </span><span class="s3">&quot;coerce&quot;</span>

    <span class="s0">if </span><span class="s1">errors </span><span class="s0">in </span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;raise&quot;</span><span class="s2">) </span><span class="s0">and </span><span class="s2">(</span><span class="s1">val_is_string </span><span class="s0">or </span><span class="s1">multiple_elts</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">val_is_string</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Integer out of range. at position 0&quot;</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">'Unable to parse string &quot;string&quot; at position 1'</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s1">exp_val </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">val</span><span class="s2">) </span><span class="s0">if </span><span class="s2">(</span><span class="s1">coercing </span><span class="s0">and </span><span class="s1">val_is_string</span><span class="s2">) </span><span class="s0">else </span><span class="s1">val</span>
        <span class="s1">expected </span><span class="s2">= [</span><span class="s1">exp_val</span><span class="s2">]</span>

        <span class="s0">if </span><span class="s1">multiple_elts</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">coercing</span><span class="s2">:</span>
                <span class="s1">expected</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">)</span>
                <span class="s1">exp_dtype </span><span class="s2">= </span><span class="s1">float</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">expected</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">extra_elt</span><span class="s2">)</span>
                <span class="s1">exp_dtype </span><span class="s2">= </span><span class="s1">object</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">exp_dtype </span><span class="s2">= </span><span class="s1">float </span><span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">exp_val</span><span class="s2">, (</span><span class="s1">int</span><span class="s2">, </span><span class="s1">float</span><span class="s2">)) </span><span class="s0">else </span><span class="s1">object</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">exp_dtype</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_really_large_in_arr_consistent</span><span class="s2">(</span><span class="s1">large_val</span><span class="s2">, </span><span class="s1">signed</span><span class="s2">, </span><span class="s1">multiple_elts</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">):</span>
    <span class="s5"># see gh-24910</span>
    <span class="s5">#</span>
    <span class="s5"># Even if we discover that we have to hold float, does not mean</span>
    <span class="s5"># we should be lenient on subsequent elements that fail to be integer.</span>
    <span class="s1">kwargs </span><span class="s2">= {</span><span class="s3">&quot;errors&quot;</span><span class="s2">: </span><span class="s1">errors</span><span class="s2">} </span><span class="s0">if </span><span class="s1">errors </span><span class="s0">is not None else </span><span class="s2">{}</span>
    <span class="s1">arr </span><span class="s2">= [</span><span class="s1">str</span><span class="s2">(-</span><span class="s1">large_val </span><span class="s0">if </span><span class="s1">signed </span><span class="s0">else </span><span class="s1">large_val</span><span class="s2">)]</span>

    <span class="s0">if </span><span class="s1">multiple_elts</span><span class="s2">:</span>
        <span class="s1">arr</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">large_val</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">errors </span><span class="s0">in </span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;raise&quot;</span><span class="s2">):</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">multiple_elts</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">f&quot;Integer out of range. at position </span><span class="s0">{</span><span class="s1">index</span><span class="s0">}</span><span class="s3">&quot;</span>

        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">errors </span><span class="s2">== </span><span class="s3">&quot;coerce&quot;</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= [</span><span class="s1">float</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">arr</span><span class="s2">]</span>
            <span class="s1">exp_dtype </span><span class="s2">= </span><span class="s1">float</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">arr</span>
            <span class="s1">exp_dtype </span><span class="s2">= </span><span class="s1">object</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">exp_dtype</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;errors,checker&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;raise&quot;</span><span class="s2">, </span><span class="s3">'Unable to parse string &quot;fail&quot; at position 0'</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;ignore&quot;</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">x </span><span class="s2">== </span><span class="s3">&quot;fail&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;coerce&quot;</span><span class="s2">, </span><span class="s0">lambda </span><span class="s1">x</span><span class="s2">: </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_scalar_fail</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">, </span><span class="s1">checker</span><span class="s2">):</span>
    <span class="s1">scalar </span><span class="s2">= </span><span class="s3">&quot;fail&quot;</span>

    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">checker</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">checker</span><span class="s2">):</span>
            <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">checker</span><span class="s2">(</span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">scalar</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;data&quot;</span><span class="s2">, [[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], [</span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]])</span>
<span class="s0">def </span><span class="s1">test_numeric_dtypes</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">transform_assert_equal</span><span class="s2">):</span>
    <span class="s1">transform</span><span class="s2">, </span><span class="s1">assert_equal </span><span class="s2">= </span><span class="s1">transform_assert_equal</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data,exp&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s3">&quot;3&quot;</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;int64&quot;</span><span class="s2">)),</span>
        <span class="s2">([</span><span class="s3">&quot;1.5&quot;</span><span class="s2">, </span><span class="s3">&quot;2.7&quot;</span><span class="s2">, </span><span class="s3">&quot;3.4&quot;</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.5</span><span class="s2">, </span><span class="s4">2.7</span><span class="s2">, </span><span class="s4">3.4</span><span class="s2">])),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_str</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s1">transform_assert_equal</span><span class="s2">):</span>
    <span class="s1">transform</span><span class="s2">, </span><span class="s1">assert_equal </span><span class="s2">= </span><span class="s1">transform_assert_equal</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">data</span><span class="s2">))</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">exp</span><span class="s2">)</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_datetime_like</span><span class="s2">(</span><span class="s1">tz_naive_fixture</span><span class="s2">, </span><span class="s1">transform_assert_equal</span><span class="s2">):</span>
    <span class="s1">transform</span><span class="s2">, </span><span class="s1">assert_equal </span><span class="s2">= </span><span class="s1">transform_assert_equal</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;20130101&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz_naive_fixture</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">))</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">asi8</span><span class="s2">)</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_timedelta</span><span class="s2">(</span><span class="s1">transform_assert_equal</span><span class="s2">):</span>
    <span class="s1">transform</span><span class="s2">, </span><span class="s1">assert_equal </span><span class="s2">= </span><span class="s1">transform_assert_equal</span>
    <span class="s1">idx </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">timedelta_range</span><span class="s2">(</span><span class="s3">&quot;1 days&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">transform</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">))</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">asi8</span><span class="s2">)</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_period</span><span class="s2">(</span><span class="s1">request</span><span class="s2">, </span><span class="s1">transform_assert_equal</span><span class="s2">):</span>
    <span class="s1">transform</span><span class="s2">, </span><span class="s1">assert_equal </span><span class="s2">= </span><span class="s1">transform_assert_equal</span>

    <span class="s1">idx </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2011-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s4">3</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;&quot;</span><span class="s2">)</span>
    <span class="s1">inp </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)</span>

    <span class="s0">if not </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">inp</span><span class="s2">, </span><span class="s1">Index</span><span class="s2">):</span>
        <span class="s1">request</span><span class="s2">.</span><span class="s1">applymarker</span><span class="s2">(</span>
            <span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Missing PeriodDtype support in to_numeric&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">inp</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">transform</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">.</span><span class="s1">asi8</span><span class="s2">)</span>
    <span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;errors,expected&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;raise&quot;</span><span class="s2">, </span><span class="s3">&quot;Invalid object type at position 0&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;ignore&quot;</span><span class="s2">, </span><span class="s1">Series</span><span class="s2">([[</span><span class="s4">10.0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s4">1.0</span><span class="s2">, </span><span class="s3">&quot;apple&quot;</span><span class="s2">])),</span>
        <span class="s2">(</span><span class="s3">&quot;coerce&quot;</span><span class="s2">, </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_non_hashable</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s5"># see gh-13324</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([[</span><span class="s4">10.0</span><span class="s2">, </span><span class="s4">2</span><span class="s2">], </span><span class="s4">1.0</span><span class="s2">, </span><span class="s3">&quot;apple&quot;</span><span class="s2">])</span>

    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">expected</span><span class="s2">):</span>
            <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_downcast_invalid_cast</span><span class="s2">():</span>
    <span class="s5"># see gh-13352</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">invalid_downcast </span><span class="s2">= </span><span class="s3">&quot;unsigned-integer&quot;</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;invalid downcasting method provided&quot;</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">invalid_downcast</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_errors_invalid_value</span><span class="s2">():</span>
    <span class="s5"># see gh-26466</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">invalid_error_value </span><span class="s2">= </span><span class="s3">&quot;invalid&quot;</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;invalid error value specified&quot;</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">invalid_error_value</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">[</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">&quot;1970-01-02&quot;</span><span class="s2">, </span><span class="s3">&quot;1970-01-03&quot;</span><span class="s2">, </span><span class="s3">&quot;1970-01-04&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;datetime64[D]&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;kwargs,exp_dtype&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s5"># Basic function tests.</span>
        <span class="s2">({}, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">),</span>
        <span class="s2">({</span><span class="s3">&quot;downcast&quot;</span><span class="s2">: </span><span class="s0">None</span><span class="s2">}, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">),</span>
        <span class="s5"># Support below np.float32 is rare and far between.</span>
        <span class="s2">({</span><span class="s3">&quot;downcast&quot;</span><span class="s2">: </span><span class="s3">&quot;float&quot;</span><span class="s2">}, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float32</span><span class="s2">).</span><span class="s1">char</span><span class="s2">),</span>
        <span class="s5"># Basic dtype support.</span>
        <span class="s2">({</span><span class="s3">&quot;downcast&quot;</span><span class="s2">: </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">}, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">typecodes</span><span class="s2">[</span><span class="s3">&quot;UnsignedInteger&quot;</span><span class="s2">][</span><span class="s4">0</span><span class="s2">])),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_downcast_basic</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">, </span><span class="s1">exp_dtype</span><span class="s2">):</span>
    <span class="s5"># see gh-13352</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">exp_dtype</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;signed_downcast&quot;</span><span class="s2">, [</span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">[</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],</span>
        <span class="s2">[</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">],</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s3">&quot;1970-01-02&quot;</span><span class="s2">, </span><span class="s3">&quot;1970-01-03&quot;</span><span class="s2">, </span><span class="s3">&quot;1970-01-04&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;datetime64[D]&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_signed_downcast</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">signed_downcast</span><span class="s2">):</span>
    <span class="s5"># see gh-13352</span>
    <span class="s1">smallest_int_dtype </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">dtype</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">typecodes</span><span class="s2">[</span><span class="s3">&quot;Integer&quot;</span><span class="s2">][</span><span class="s4">0</span><span class="s2">])</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">smallest_int_dtype</span><span class="s2">)</span>

    <span class="s1">res </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">signed_downcast</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_ignore_downcast_invalid_data</span><span class="s2">():</span>
    <span class="s5"># If we can't successfully cast the given</span>
    <span class="s5"># data to a numeric dtype, do not bother</span>
    <span class="s5"># with the downcast parameter.</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s3">&quot;foo&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>

    <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;errors='ignore' is deprecated&quot;</span>
    <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">res </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;ignore&quot;</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s3">&quot;unsigned&quot;</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_ignore_downcast_neg_to_unsigned</span><span class="s2">():</span>
    <span class="s5"># Cannot cast to an unsigned integer</span>
    <span class="s5"># because we have a negative number.</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s3">&quot;-1&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">]</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>

    <span class="s1">res </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s3">&quot;unsigned&quot;</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s5"># Warning in 32 bit platforms</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:invalid value encountered in cast:RuntimeWarning&quot;</span><span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;downcast&quot;</span><span class="s2">, [</span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data,expected&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">([</span><span class="s3">&quot;1.1&quot;</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1.1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)),</span>
        <span class="s2">(</span>
            <span class="s2">[</span><span class="s4">10000.0</span><span class="s2">, </span><span class="s4">20000</span><span class="s2">, </span><span class="s4">3000</span><span class="s2">, </span><span class="s4">40000.36</span><span class="s2">, </span><span class="s4">50000</span><span class="s2">, </span><span class="s4">50000.00</span><span class="s2">],</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
                <span class="s2">[</span><span class="s4">10000.0</span><span class="s2">, </span><span class="s4">20000</span><span class="s2">, </span><span class="s4">3000</span><span class="s2">, </span><span class="s4">40000.36</span><span class="s2">, </span><span class="s4">50000</span><span class="s2">, </span><span class="s4">50000.00</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
            <span class="s2">),</span>
        <span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_ignore_downcast_cannot_convert_float</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">):</span>
    <span class="s5"># Cannot cast to an integer (signed or unsigned)</span>
    <span class="s5"># because we have a float number.</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">downcast</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;downcast,expected_dtype&quot;</span><span class="s2">,</span>
    <span class="s2">[(</span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">), (</span><span class="s3">&quot;signed&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">), (</span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint16</span><span class="s2">)],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_downcast_not8bit</span><span class="s2">(</span><span class="s1">downcast</span><span class="s2">, </span><span class="s1">expected_dtype</span><span class="s2">):</span>
    <span class="s5"># the smallest integer dtype need not be np.(u)int8</span>
    <span class="s1">data </span><span class="s2">= [</span><span class="s3">&quot;256&quot;</span><span class="s2">, </span><span class="s4">257</span><span class="s2">, </span><span class="s4">258</span><span class="s2">]</span>

    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">256</span><span class="s2">, </span><span class="s4">257</span><span class="s2">, </span><span class="s4">258</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">expected_dtype</span><span class="s2">)</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">downcast</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;dtype,downcast,min_max&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;int8&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int16&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int32&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;uint8&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;uint16&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint16</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint16</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;uint32&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;uint64&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int16&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">).</span><span class="s1">max </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int32&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">).</span><span class="s1">max </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">).</span><span class="s1">max </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int16&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int8</span><span class="s2">).</span><span class="s1">min </span><span class="s2">- </span><span class="s4">1</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int32&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int16</span><span class="s2">).</span><span class="s1">min </span><span class="s2">- </span><span class="s4">1</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;int64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int32</span><span class="s2">).</span><span class="s1">min </span><span class="s2">- </span><span class="s4">1</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">).</span><span class="s1">max</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;uint16&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint8</span><span class="s2">).</span><span class="s1">max </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;uint32&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint16</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint16</span><span class="s2">).</span><span class="s1">max </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">]),</span>
        <span class="s2">(</span><span class="s3">&quot;uint64&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, [</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">min</span><span class="s2">, </span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint32</span><span class="s2">).</span><span class="s1">max </span><span class="s2">+ </span><span class="s4">1</span><span class="s2">]),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_downcast_limits</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">, </span><span class="s1">min_max</span><span class="s2">):</span>
    <span class="s5"># see gh-14404: test the limits of each downcast.</span>
    <span class="s1">series </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">min_max</span><span class="s2">), </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">downcast</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">series</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">dtype</span>


<span class="s0">def </span><span class="s1">test_downcast_float64_to_float32</span><span class="s2">():</span>
    <span class="s5"># GH-43693: Check float64 preservation when &gt;= 16,777,217</span>
    <span class="s1">series </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">16777217.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">finfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">).</span><span class="s1">max</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">series</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s3">&quot;float&quot;</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">series</span><span class="s2">.</span><span class="s1">dtype </span><span class="s2">== </span><span class="s1">result</span><span class="s2">.</span><span class="s1">dtype</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;ser,expected&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span>
            <span class="s1">Series</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">9223372036854775808</span><span class="s2">]),</span>
            <span class="s1">Series</span><span class="s2">([</span><span class="s4">0</span><span class="s2">, </span><span class="s4">9223372036854775808</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">),</span>
        <span class="s2">)</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_downcast_uint64</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s5"># see gh-14422:</span>
    <span class="s5"># BUG: to_numeric doesn't work uint64 numbers</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s3">&quot;unsigned&quot;</span><span class="s2">)</span>

    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data,exp_data&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span>
            <span class="s2">[</span><span class="s4">200</span><span class="s2">, </span><span class="s4">300</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">, </span><span class="s3">&quot;NaN&quot;</span><span class="s2">, </span><span class="s4">30000000000000000000</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">200</span><span class="s2">, </span><span class="s4">300</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s4">30000000000000000000</span><span class="s2">],</span>
        <span class="s2">),</span>
        <span class="s2">(</span>
            <span class="s2">[</span><span class="s3">&quot;12345678901234567890&quot;</span><span class="s2">, </span><span class="s3">&quot;1234567890&quot;</span><span class="s2">, </span><span class="s3">&quot;ITEM&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">12345678901234567890</span><span class="s2">, </span><span class="s4">1234567890</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">],</span>
        <span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_coerce_uint64_conflict</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">exp_data</span><span class="s2">):</span>
    <span class="s5"># see gh-17007 and gh-17125</span>
    <span class="s5">#</span>
    <span class="s5"># Still returns float despite the uint64-nan conflict,</span>
    <span class="s5"># which would normally force the casting to object.</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">), </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;coerce&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">exp_data</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">float</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;errors,exp&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;ignore&quot;</span><span class="s2">, </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;12345678901234567890&quot;</span><span class="s2">, </span><span class="s3">&quot;1234567890&quot;</span><span class="s2">, </span><span class="s3">&quot;ITEM&quot;</span><span class="s2">])),</span>
        <span class="s2">(</span><span class="s3">&quot;raise&quot;</span><span class="s2">, </span><span class="s3">&quot;Unable to parse string&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span><span class="s3">&quot;ignore:errors='ignore' is deprecated:FutureWarning&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_non_coerce_uint64_conflict</span><span class="s2">(</span><span class="s1">errors</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">):</span>
    <span class="s5"># see gh-17007 and gh-17125</span>
    <span class="s5">#</span>
    <span class="s5"># For completeness.</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;12345678901234567890&quot;</span><span class="s2">, </span><span class="s3">&quot;1234567890&quot;</span><span class="s2">, </span><span class="s3">&quot;ITEM&quot;</span><span class="s2">])</span>

    <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">exp</span><span class="s2">, </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">exp</span><span class="s2">):</span>
            <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s1">errors</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">ser</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;dc1&quot;</span><span class="s2">, [</span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;dc2&quot;</span><span class="s2">, [</span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_downcast_empty</span><span class="s2">(</span><span class="s1">dc1</span><span class="s2">, </span><span class="s1">dc2</span><span class="s2">):</span>
    <span class="s5"># GH32493</span>

    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_numpy_array_equal</span><span class="s2">(</span>
        <span class="s1">to_numeric</span><span class="s2">([], </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">dc1</span><span class="s2">),</span>
        <span class="s1">to_numeric</span><span class="s2">([], </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">dc2</span><span class="s2">),</span>
        <span class="s1">check_dtype</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_failure_to_convert_uint64_string_to_NaN</span><span class="s2">():</span>
    <span class="s5"># GH 32394</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s3">&quot;uint64&quot;</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;coerce&quot;</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">result</span><span class="s2">)</span>

    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">32</span><span class="s2">, </span><span class="s4">64</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;32&quot;</span><span class="s2">, </span><span class="s3">&quot;64&quot;</span><span class="s2">, </span><span class="s3">&quot;uint64&quot;</span><span class="s2">]), </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;coerce&quot;</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">ser</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;strrep&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s3">&quot;243.164&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;245.968&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;249.585&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;259.745&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;265.742&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;272.567&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;279.196&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;280.366&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;275.034&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;271.351&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;272.889&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;270.627&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;280.828&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;290.383&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;308.153&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;319.945&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;336.0&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;344.09&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;351.385&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;356.178&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;359.82&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;361.03&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;367.701&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;380.812&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;387.98&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;391.749&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;391.171&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;385.97&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;385.345&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;386.121&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;390.996&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;399.734&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;413.073&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;421.532&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;430.221&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;437.092&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;439.746&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;446.01&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;451.191&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;460.463&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;469.779&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;472.025&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;479.49&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;474.864&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;467.54&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;471.978&quot;</span><span class="s2">,</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_precision_float_conversion</span><span class="s2">(</span><span class="s1">strrep</span><span class="s2">):</span>
    <span class="s5"># GH 31364</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">strrep</span><span class="s2">)</span>

    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">float</span><span class="s2">(</span><span class="s1">strrep</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;values, expected&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">], </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int64&quot;</span><span class="s2">)),</span>
        <span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s3">&quot;3&quot;</span><span class="s2">], </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int64&quot;</span><span class="s2">)),</span>
        <span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int64&quot;</span><span class="s2">)),</span>
        <span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s4">3.5</span><span class="s2">], </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3.5</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Float64&quot;</span><span class="s2">)),</span>
        <span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s4">3.5</span><span class="s2">], </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s4">3.5</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Float64&quot;</span><span class="s2">)),</span>
        <span class="s2">([</span><span class="s3">&quot;1&quot;</span><span class="s2">, </span><span class="s3">&quot;2&quot;</span><span class="s2">, </span><span class="s3">&quot;3.5&quot;</span><span class="s2">], </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3.5</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Float64&quot;</span><span class="s2">)),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_to_numeric_from_nullable_string</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">nullable_string_dtype</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s5"># https://github.com/pandas-dev/pandas/issues/37262</span>
    <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">nullable_string_dtype</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_to_numeric_from_nullable_string_coerce</span><span class="s2">(</span><span class="s1">nullable_string_dtype</span><span class="s2">):</span>
    <span class="s5"># GH#52146</span>
    <span class="s1">values </span><span class="s2">= [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;1&quot;</span><span class="s2">]</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">nullable_string_dtype</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;coerce&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int64&quot;</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_to_numeric_from_nullable_string_ignore</span><span class="s2">(</span><span class="s1">nullable_string_dtype</span><span class="s2">):</span>
    <span class="s5"># GH#52146</span>
    <span class="s1">values </span><span class="s2">= [</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;1&quot;</span><span class="s2">]</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">nullable_string_dtype</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;errors='ignore' is deprecated&quot;</span>
    <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;ignore&quot;</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;data, input_dtype, downcast, expected_dtype&quot;</span><span class="s2">,</span>
    <span class="s2">(</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s3">&quot;Float64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">], </span><span class="s3">&quot;Float64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;Float64&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">450</span><span class="s2">, </span><span class="s4">300</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;Int16&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;Float64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">).</span><span class="s1">max </span><span class="s2">- </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">, </span><span class="s3">&quot;Int64&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], </span><span class="s3">&quot;Float32&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">], </span><span class="s3">&quot;Float64&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">, </span><span class="s3">&quot;Float64&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">450</span><span class="s2">, -</span><span class="s4">300</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">, </span><span class="s3">&quot;Int16&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">iinfo</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">uint64</span><span class="s2">).</span><span class="s1">max </span><span class="s2">- </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;UInt64&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">, </span><span class="s3">&quot;UInt64&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, </span><span class="s3">&quot;UInt8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], </span><span class="s3">&quot;Float32&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, </span><span class="s3">&quot;UInt8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1.0</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">], </span><span class="s3">&quot;Float64&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, </span><span class="s3">&quot;Float64&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, </span><span class="s3">&quot;UInt8&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">450</span><span class="s2">, -</span><span class="s4">300</span><span class="s2">], </span><span class="s3">&quot;Int64&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, </span><span class="s3">&quot;Int64&quot;</span><span class="s2">),</span>
        <span class="s2">([-</span><span class="s4">1</span><span class="s2">, -</span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;Int32&quot;</span><span class="s2">, </span><span class="s3">&quot;unsigned&quot;</span><span class="s2">, </span><span class="s3">&quot;Int32&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;Float64&quot;</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">, </span><span class="s3">&quot;Float32&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">], </span><span class="s3">&quot;Float64&quot;</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">, </span><span class="s3">&quot;Float32&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">], </span><span class="s3">&quot;Float32&quot;</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">, </span><span class="s3">&quot;Float32&quot;</span><span class="s2">),</span>
        <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.1</span><span class="s2">], </span><span class="s3">&quot;Float32&quot;</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">, </span><span class="s3">&quot;Float32&quot;</span><span class="s2">),</span>
    <span class="s2">),</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_downcast_nullable_numeric</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">input_dtype</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">, </span><span class="s1">expected_dtype</span><span class="s2">):</span>
    <span class="s1">arr </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">input_dtype</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">downcast</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">expected_dtype</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_extension_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_downcast_nullable_mask_is_copied</span><span class="s2">():</span>
    <span class="s5"># GH38974</span>

    <span class="s1">arr </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int64&quot;</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s3">&quot;integer&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;Int8&quot;</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_extension_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s1">arr</span><span class="s2">[</span><span class="s4">1</span><span class="s2">] = </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA  </span><span class="s5"># should not modify result</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_extension_array_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_to_numeric_scientific_notation</span><span class="s2">():</span>
    <span class="s5"># GH 15898</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s3">&quot;1.7e+308&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span><span class="s2">(</span><span class="s4">1.7e308</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;val&quot;</span><span class="s2">, [</span><span class="s4">9876543210.0</span><span class="s2">, </span><span class="s4">2.0</span><span class="s2">**</span><span class="s4">128</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_to_numeric_large_float_not_downcast_to_float_32</span><span class="s2">(</span><span class="s1">val</span><span class="s2">):</span>
    <span class="s5"># GH 19729</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">val</span><span class="s2">])</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s3">&quot;float&quot;</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;val, dtype&quot;</span><span class="s2">, [(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;Int64&quot;</span><span class="s2">), (</span><span class="s4">1.5</span><span class="s2">, </span><span class="s3">&quot;Float64&quot;</span><span class="s2">), (</span><span class="s0">True</span><span class="s2">, </span><span class="s3">&quot;boolean&quot;</span><span class="s2">)]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_to_numeric_dtype_backend</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">):</span>
    <span class="s5"># GH#50505</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">val</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s3">&quot;numpy_nullable&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">val</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;val, dtype&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;Int64&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1.5</span><span class="s2">, </span><span class="s3">&quot;Float64&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s3">&quot;boolean&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;int64[pyarrow]&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1.5</span><span class="s2">, </span><span class="s3">&quot;float64[pyarrow]&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s0">True</span><span class="s2">, </span><span class="s3">&quot;bool[pyarrow]&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_to_numeric_dtype_backend_na</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">):</span>
    <span class="s5"># GH#50505</span>
    <span class="s0">if </span><span class="s3">&quot;pyarrow&quot; </span><span class="s0">in </span><span class="s1">dtype</span><span class="s2">:</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">)</span>
        <span class="s1">dtype_backend </span><span class="s2">= </span><span class="s3">&quot;pyarrow&quot;</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">dtype_backend </span><span class="s2">= </span><span class="s3">&quot;numpy_nullable&quot;</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">val</span><span class="s2">, </span><span class="s0">None</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s1">dtype_backend</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">val</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;val, dtype, downcast&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1.5</span><span class="s2">, </span><span class="s3">&quot;Float32&quot;</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;Int8&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;int8[pyarrow]&quot;</span><span class="s2">, </span><span class="s3">&quot;integer&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1.5</span><span class="s2">, </span><span class="s3">&quot;float[pyarrow]&quot;</span><span class="s2">, </span><span class="s3">&quot;float&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s3">&quot;int8[pyarrow]&quot;</span><span class="s2">, </span><span class="s3">&quot;signed&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_to_numeric_dtype_backend_downcasting</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">):</span>
    <span class="s5"># GH#50505</span>
    <span class="s0">if </span><span class="s3">&quot;pyarrow&quot; </span><span class="s0">in </span><span class="s1">dtype</span><span class="s2">:</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">)</span>
        <span class="s1">dtype_backend </span><span class="s2">= </span><span class="s3">&quot;pyarrow&quot;</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">dtype_backend </span><span class="s2">= </span><span class="s3">&quot;numpy_nullable&quot;</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">val</span><span class="s2">, </span><span class="s0">None</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">object</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s1">dtype_backend</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s1">downcast</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">val</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;smaller, dtype_backend&quot;</span><span class="s2">,</span>
    <span class="s2">[[</span><span class="s3">&quot;UInt8&quot;</span><span class="s2">, </span><span class="s3">&quot;numpy_nullable&quot;</span><span class="s2">], [</span><span class="s3">&quot;uint8[pyarrow]&quot;</span><span class="s2">, </span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">]],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_to_numeric_dtype_backend_downcasting_uint</span><span class="s2">(</span><span class="s1">smaller</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">):</span>
    <span class="s5"># GH#50505</span>
    <span class="s0">if </span><span class="s1">dtype_backend </span><span class="s2">== </span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">:</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">)</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;UInt64&quot;</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s1">dtype_backend</span><span class="s2">, </span><span class="s1">downcast</span><span class="s2">=</span><span class="s3">&quot;unsigned&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">smaller</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;dtype&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s3">&quot;Int64&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;UInt64&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;Float64&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;boolean&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;int64[pyarrow]&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;uint64[pyarrow]&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;float64[pyarrow]&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;bool[pyarrow]&quot;</span><span class="s2">,</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_to_numeric_dtype_backend_already_nullable</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">):</span>
    <span class="s5"># GH#50505</span>
    <span class="s0">if </span><span class="s3">&quot;pyarrow&quot; </span><span class="s0">in </span><span class="s1">dtype</span><span class="s2">:</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">)</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s3">&quot;numpy_nullable&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NA</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_to_numeric_dtype_backend_error</span><span class="s2">(</span><span class="s1">dtype_backend</span><span class="s2">):</span>
    <span class="s5"># GH#50505</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s3">&quot;a&quot;</span><span class="s2">, </span><span class="s3">&quot;b&quot;</span><span class="s2">, </span><span class="s3">&quot;&quot;</span><span class="s2">])</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s3">&quot;Unable to parse string&quot;</span><span class="s2">):</span>
        <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s1">dtype_backend</span><span class="s2">)</span>

    <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;errors='ignore' is deprecated&quot;</span>
    <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s1">dtype_backend</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;ignore&quot;</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s1">dtype_backend</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;coerce&quot;</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">dtype_backend </span><span class="s2">== </span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">:</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s3">&quot;double[pyarrow]&quot;</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">dtype </span><span class="s2">= </span><span class="s3">&quot;Float64&quot;</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_invalid_dtype_backend</span><span class="s2">():</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">])</span>
    <span class="s1">msg </span><span class="s2">= (</span>
        <span class="s3">&quot;dtype_backend numpy is invalid, only 'numpy_nullable' and &quot;</span>
        <span class="s3">&quot;'pyarrow' are allowed.&quot;</span>
    <span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s3">&quot;numpy&quot;</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_coerce_pyarrow_backend</span><span class="s2">():</span>
    <span class="s5"># GH 52588</span>
    <span class="s1">pa </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">)</span>
    <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s3">&quot;12x&quot;</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">ArrowDtype</span><span class="s2">(</span><span class="s1">pa</span><span class="s2">.</span><span class="s1">string</span><span class="s2">()))</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">to_numeric</span><span class="s2">(</span><span class="s1">ser</span><span class="s2">, </span><span class="s1">errors</span><span class="s2">=</span><span class="s3">&quot;coerce&quot;</span><span class="s2">, </span><span class="s1">dtype_backend</span><span class="s2">=</span><span class="s3">&quot;pyarrow&quot;</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s0">None</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">ArrowDtype</span><span class="s2">(</span><span class="s1">pa</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">()))</span>
    <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
</pre>
</body>
</html>