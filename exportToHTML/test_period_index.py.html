<html>
<head>
<title>test_period_index.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #7a7e85;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_period_index.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">datetime</span>
<span class="s0">import </span><span class="s1">warnings</span>

<span class="s0">import </span><span class="s1">dateutil</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">import </span><span class="s1">pytz</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs</span><span class="s2">.</span><span class="s1">ccalendar </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DAYS</span><span class="s2">,</span>
    <span class="s1">MONTHS</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_libs</span><span class="s2">.</span><span class="s1">tslibs</span><span class="s2">.</span><span class="s1">period </span><span class="s0">import </span><span class="s1">IncompatibleFrequency</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">errors </span><span class="s0">import </span><span class="s1">InvalidIndexError</span>

<span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>
<span class="s0">from </span><span class="s1">pandas </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">DataFrame</span><span class="s2">,</span>
    <span class="s1">Series</span><span class="s2">,</span>
    <span class="s1">Timestamp</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">import </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">_testing </span><span class="s0">as </span><span class="s1">tm</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">indexes</span><span class="s2">.</span><span class="s1">datetimes </span><span class="s0">import </span><span class="s1">date_range</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">indexes</span><span class="s2">.</span><span class="s1">period </span><span class="s0">import </span><span class="s2">(</span>
    <span class="s1">Period</span><span class="s2">,</span>
    <span class="s1">PeriodIndex</span><span class="s2">,</span>
    <span class="s1">period_range</span><span class="s2">,</span>
<span class="s2">)</span>
<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">core</span><span class="s2">.</span><span class="s1">resample </span><span class="s0">import </span><span class="s1">_get_period_range_edges</span>

<span class="s0">from </span><span class="s1">pandas</span><span class="s2">.</span><span class="s1">tseries </span><span class="s0">import </span><span class="s1">offsets</span>

<span class="s1">pytestmark </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span>
    <span class="s3">&quot;ignore:Resampling with a PeriodIndex is deprecated:FutureWarning&quot;</span>
<span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span><span class="s2">()</span>
<span class="s0">def </span><span class="s1">_index_factory</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s1">period_range</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">_series_name</span><span class="s2">():</span>
    <span class="s0">return </span><span class="s3">&quot;pi&quot;</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">fixture</span>
<span class="s0">def </span><span class="s1">simple_period_range_series</span><span class="s2">():</span>
    <span class="s4">&quot;&quot;&quot; 
    Series with period range index and random data for test purposes. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">_simple_period_range_series</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">warnings</span><span class="s2">.</span><span class="s1">catch_warnings</span><span class="s2">():</span>
            <span class="s5"># suppress Period[B] deprecation warning</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;|&quot;</span><span class="s2">.</span><span class="s1">join</span><span class="s2">([</span><span class="s3">&quot;Period with BDay freq&quot;</span><span class="s2">, </span><span class="s3">r&quot;PeriodDtype\[B\] is deprecated&quot;</span><span class="s2">])</span>
            <span class="s1">warnings</span><span class="s2">.</span><span class="s1">filterwarnings</span><span class="s2">(</span>
                <span class="s3">&quot;ignore&quot;</span><span class="s2">,</span>
                <span class="s1">msg</span><span class="s2">,</span>
                <span class="s1">category</span><span class="s2">=</span><span class="s1">FutureWarning</span><span class="s2">,</span>
            <span class="s2">)</span>
            <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

    <span class="s0">return </span><span class="s1">_simple_period_range_series</span>


<span class="s0">class </span><span class="s1">TestPeriodIndex</span><span class="s2">:</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, [</span><span class="s3">&quot;2D&quot;</span><span class="s2">, </span><span class="s3">&quot;1h&quot;</span><span class="s2">, </span><span class="s3">&quot;2h&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;kind&quot;</span><span class="s2">, [</span><span class="s3">&quot;period&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;timestamp&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_asfreq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">series_and_frame</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">):</span>
        <span class="s5"># GH 12884, 15944</span>
        <span class="s5"># make sure .asfreq() returns PeriodIndex (except kind='timestamp')</span>

        <span class="s1">obj </span><span class="s2">= </span><span class="s1">series_and_frame</span>
        <span class="s0">if </span><span class="s1">kind </span><span class="s2">== </span><span class="s3">&quot;timestamp&quot;</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">).</span><span class="s1">asfreq</span><span class="s2">()</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">start </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">)</span>
            <span class="s1">end </span><span class="s2">= (</span><span class="s1">obj</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">] + </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">freq</span><span class="s2">).</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">)</span>
            <span class="s1">new_index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">inclusive</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">new_index</span><span class="s2">).</span><span class="s1">to_period</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in (Series|DataFrame).resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s1">kind</span><span class="s2">).</span><span class="s1">asfreq</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_asfreq_fill_value</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">series</span><span class="s2">):</span>
        <span class="s5"># test for fill value during resampling, issue 3715</span>

        <span class="s1">s </span><span class="s2">= </span><span class="s1">series</span>
        <span class="s1">new_index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">s</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]).</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">),</span>
            <span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;1h&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">new_index</span><span class="s2">, </span><span class="s1">fill_value</span><span class="s2">=</span><span class="s6">4.0</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;1h&quot;</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s3">&quot;timestamp&quot;</span><span class="s2">).</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s1">fill_value</span><span class="s2">=</span><span class="s6">4.0</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">frame </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_frame</span><span class="s2">(</span><span class="s3">&quot;value&quot;</span><span class="s2">)</span>
        <span class="s1">new_index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span>
            <span class="s1">frame</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s1">frame</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">]).</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">),</span>
            <span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;1h&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">frame</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">new_index</span><span class="s2">, </span><span class="s1">fill_value</span><span class="s2">=</span><span class="s6">3.0</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in DataFrame.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">frame</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;1h&quot;</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s3">&quot;timestamp&quot;</span><span class="s2">).</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s1">fill_value</span><span class="s2">=</span><span class="s6">3.0</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, [</span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;12h&quot;</span><span class="s2">, </span><span class="s3">&quot;2D&quot;</span><span class="s2">, </span><span class="s3">&quot;W&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;kind&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;period&quot;</span><span class="s2">, </span><span class="s3">&quot;timestamp&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;kwargs&quot;</span><span class="s2">, [{</span><span class="s3">&quot;on&quot;</span><span class="s2">: </span><span class="s3">&quot;date&quot;</span><span class="s2">}, {</span><span class="s3">&quot;level&quot;</span><span class="s2">: </span><span class="s3">&quot;d&quot;</span><span class="s2">}])</span>
    <span class="s0">def </span><span class="s1">test_selection</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s5"># This is a bug, these should be implemented</span>
        <span class="s5"># GH 14008</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">int64</span><span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">{</span><span class="s3">&quot;date&quot;</span><span class="s2">: </span><span class="s1">index</span><span class="s2">, </span><span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">rng</span><span class="s2">},</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">MultiIndex</span><span class="s2">.</span><span class="s1">from_arrays</span><span class="s2">([</span><span class="s1">rng</span><span class="s2">, </span><span class="s1">index</span><span class="s2">], </span><span class="s1">names</span><span class="s2">=[</span><span class="s3">&quot;v&quot;</span><span class="s2">, </span><span class="s3">&quot;d&quot;</span><span class="s2">]),</span>
        <span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= (</span>
            <span class="s3">&quot;Resampling from level= or on= selection with a PeriodIndex is &quot;</span>
            <span class="s3">r&quot;not currently supported, use \.set_index\(\.\.\.\) to &quot;</span>
            <span class="s3">&quot;explicitly set index&quot;</span>
        <span class="s2">)</span>
        <span class="s1">depr_msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in DataFrame.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">NotImplementedError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">depr_msg</span><span class="s2">):</span>
                <span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s1">kind</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;month&quot;</span><span class="s2">, </span><span class="s1">MONTHS</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;meth&quot;</span><span class="s2">, [</span><span class="s3">&quot;ffill&quot;</span><span class="s2">, </span><span class="s3">&quot;bfill&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;conv&quot;</span><span class="s2">, [</span><span class="s3">&quot;start&quot;</span><span class="s2">, </span><span class="s3">&quot;end&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s2">(</span><span class="s3">&quot;offset&quot;</span><span class="s2">, </span><span class="s3">&quot;period&quot;</span><span class="s2">), [(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">), (</span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s3">&quot;M&quot;</span><span class="s2">), (</span><span class="s3">&quot;QE&quot;</span><span class="s2">, </span><span class="s3">&quot;Q&quot;</span><span class="s2">)]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_annual_upsample_cases</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">period</span><span class="s2">, </span><span class="s1">conv</span><span class="s2">, </span><span class="s1">meth</span><span class="s2">, </span><span class="s1">month</span><span class="s2">, </span><span class="s1">simple_period_range_series</span>
    <span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;12/31/1991&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">f&quot;Y-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)</span>
        <span class="s1">warn </span><span class="s2">= </span><span class="s1">FutureWarning </span><span class="s0">if </span><span class="s1">period </span><span class="s2">== </span><span class="s3">&quot;B&quot; </span><span class="s0">else None</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;PeriodDtype\[B\] is deprecated&quot;</span>
        <span class="s0">if </span><span class="s1">warn </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
            <span class="s1">warn </span><span class="s2">= </span><span class="s1">FutureWarning</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">warn</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">period</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">=</span><span class="s1">conv</span><span class="s2">), </span><span class="s1">meth</span><span class="s2">)()</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">period</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s1">conv</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s1">offset</span><span class="s2">, </span><span class="s1">meth</span><span class="s2">).</span><span class="s1">to_period</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_basic_downsample</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;6/30/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">groupby</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">year</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;6/30/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s5"># this is ok</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">(), </span><span class="s1">result</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">(), </span><span class="s1">result</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;rule,expected_error_msg&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">, </span><span class="s3">&quot;&lt;YearEnd: month=12&gt;&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;Q-MAR&quot;</span><span class="s2">, </span><span class="s3">&quot;&lt;QuarterEnd: startingMonth=3&gt;&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;&lt;MonthEnd&gt;&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;w-thu&quot;</span><span class="s2">, </span><span class="s3">&quot;&lt;Week: weekday=3&gt;&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_not_subperiod</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">, </span><span class="s1">rule</span><span class="s2">, </span><span class="s1">expected_error_msg</span><span class="s2">):</span>
        <span class="s5"># These are incompatible period rules for resampling</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;6/30/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;w-wed&quot;</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= (</span>
            <span class="s3">&quot;Frequency &lt;Week: weekday=2&gt; cannot be resampled to &quot;</span>
            <span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">expected_error_msg</span><span class="s0">}</span><span class="s3">, as they are not sub or super periods&quot;</span>
        <span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">rule</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, [</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;2D&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_basic_upsample</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;6/30/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'convention' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">resampled </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">=</span><span class="s3">&quot;end&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;end&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">, </span><span class="s3">&quot;ffill&quot;</span><span class="s2">).</span><span class="s1">to_period</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">resampled</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_upsample_with_limit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">5</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Y&quot;</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">)), </span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'convention' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">=</span><span class="s3">&quot;end&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">(</span><span class="s1">limit</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;M&quot;</span><span class="s2">).</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s3">&quot;ffill&quot;</span><span class="s2">, </span><span class="s1">limit</span><span class="s2">=</span><span class="s6">2</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_annual_upsample</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;12/31/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">({</span><span class="s3">&quot;a&quot;</span><span class="s2">: </span><span class="s1">ts</span><span class="s2">})</span>
        <span class="s1">rdf </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
        <span class="s1">exp </span><span class="s2">= </span><span class="s1">df</span><span class="s2">[</span><span class="s3">&quot;a&quot;</span><span class="s2">].</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">rdf</span><span class="s2">[</span><span class="s3">&quot;a&quot;</span><span class="s2">], </span><span class="s1">exp</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_annual_upsample2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s3">&quot;2003&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">4</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;M&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
        <span class="s1">ex_index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2000-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2003-12&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">).</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">ex_index</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s3">&quot;ffill&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;month&quot;</span><span class="s2">, </span><span class="s1">MONTHS</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;convention&quot;</span><span class="s2">, [</span><span class="s3">&quot;start&quot;</span><span class="s2">, </span><span class="s3">&quot;end&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s2">(</span><span class="s3">&quot;offset&quot;</span><span class="s2">, </span><span class="s3">&quot;period&quot;</span><span class="s2">), [(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">), (</span><span class="s3">&quot;B&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">), (</span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s3">&quot;M&quot;</span><span class="s2">)]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_quarterly_upsample</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">month</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">period</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">, </span><span class="s1">simple_period_range_series</span>
    <span class="s2">):</span>
        <span class="s1">freq </span><span class="s2">= </span><span class="s3">f&quot;Q-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s3">&quot;</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;12/31/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">warn </span><span class="s2">= </span><span class="s1">FutureWarning </span><span class="s0">if </span><span class="s1">period </span><span class="s2">== </span><span class="s3">&quot;B&quot; </span><span class="s0">else None</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;PeriodDtype\[B\] is deprecated&quot;</span>
        <span class="s0">if </span><span class="s1">warn </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
            <span class="s1">warn </span><span class="s2">= </span><span class="s1">FutureWarning</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">warn</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">period</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">=</span><span class="s1">convention</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">period</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s1">convention</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s1">offset</span><span class="s2">, </span><span class="s3">&quot;ffill&quot;</span><span class="s2">).</span><span class="s1">to_period</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;target&quot;</span><span class="s2">, [</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;convention&quot;</span><span class="s2">, [</span><span class="s3">&quot;start&quot;</span><span class="s2">, </span><span class="s3">&quot;end&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_monthly_upsample</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">target</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;12/31/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">)</span>

        <span class="s1">warn </span><span class="s2">= </span><span class="s0">None if </span><span class="s1">target </span><span class="s2">== </span><span class="s3">&quot;D&quot; </span><span class="s0">else </span><span class="s1">FutureWarning</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;PeriodDtype\[B\] is deprecated&quot;</span>
        <span class="s0">if </span><span class="s1">warn </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
            <span class="s1">warn </span><span class="s2">= </span><span class="s1">FutureWarning</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">warn</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">=</span><span class="s1">convention</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s1">convention</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s3">&quot;ffill&quot;</span><span class="s2">).</span><span class="s1">to_period</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_basic</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH3609</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">range</span><span class="s2">(</span><span class="s6">100</span><span class="s2">),</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;20130101&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;s&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">100</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;idx&quot;</span><span class="s2">),</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;float&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">s</span><span class="s2">[</span><span class="s6">10</span><span class="s2">:</span><span class="s6">30</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">PeriodIndex</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">Period</span><span class="s2">(</span><span class="s3">&quot;2013-01-01 00:00&quot;</span><span class="s2">, </span><span class="s3">&quot;min&quot;</span><span class="s2">), </span><span class="s1">Period</span><span class="s2">(</span><span class="s3">&quot;2013-01-01 00:01&quot;</span><span class="s2">, </span><span class="s3">&quot;min&quot;</span><span class="s2">)],</span>
            <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;idx&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">34.5</span><span class="s2">, </span><span class="s6">79.5</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_period</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;min&quot;</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s3">&quot;period&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result2 </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;min&quot;</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s3">&quot;period&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result2</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;freq,expected_vals&quot;</span><span class="s2">, [(</span><span class="s3">&quot;M&quot;</span><span class="s2">, [</span><span class="s6">31</span><span class="s2">, </span><span class="s6">29</span><span class="s2">, </span><span class="s6">31</span><span class="s2">, </span><span class="s6">9</span><span class="s2">]), (</span><span class="s3">&quot;2M&quot;</span><span class="s2">, [</span><span class="s6">31 </span><span class="s2">+ </span><span class="s6">29</span><span class="s2">, </span><span class="s6">31 </span><span class="s2">+ </span><span class="s6">9</span><span class="s2">])]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_resample_count</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">expected_vals</span><span class="s2">):</span>
        <span class="s5"># GH12774</span>
        <span class="s1">series </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">100</span><span class="s2">))</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">series</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">).</span><span class="s1">count</span><span class="s2">()</span>
        <span class="s1">expected_index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span>
            <span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s1">len</span><span class="s2">(</span><span class="s1">expected_vals</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">expected_vals</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">expected_index</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_same_freq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">resample_method</span><span class="s2">):</span>
        <span class="s5"># GH12770</span>
        <span class="s1">series </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s6">3</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">3</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">))</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">series</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">series</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;M&quot;</span><span class="s2">), </span><span class="s1">resample_method</span><span class="s2">)()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_incompat_freq</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">msg </span><span class="s2">= (</span>
            <span class="s3">&quot;Frequency &lt;MonthEnd&gt; cannot be resampled to &lt;Week: weekday=6&gt;, &quot;</span>
            <span class="s3">&quot;as they are not sub or super periods&quot;</span>
        <span class="s2">)</span>
        <span class="s1">pi </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">3</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">)</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s6">3</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">pi</span><span class="s2">)</span>
        <span class="s1">rs </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;W&quot;</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">IncompatibleFrequency</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s5"># TODO: should this raise at the resample call instead of at the mean call?</span>
            <span class="s1">rs</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;tz&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s1">pytz</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">(</span><span class="s3">&quot;America/Los_Angeles&quot;</span><span class="s2">),</span>
            <span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">(</span><span class="s3">&quot;America/Los_Angeles&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_with_local_timezone</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">):</span>
        <span class="s5"># see gh-5430</span>
        <span class="s1">local_timezone </span><span class="s2">= </span><span class="s1">tz</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s6">2013</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s6">11</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s6">1</span><span class="s2">, </span><span class="s1">hour</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">minute</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">pytz</span><span class="s2">.</span><span class="s1">utc</span><span class="s2">)</span>
        <span class="s5"># 1 day later</span>
        <span class="s1">end </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s6">2013</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s6">11</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s6">2</span><span class="s2">, </span><span class="s1">hour</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">minute</span><span class="s2">=</span><span class="s6">0</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">pytz</span><span class="s2">.</span><span class="s1">utc</span><span class="s2">)</span>

        <span class="s1">index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;idx&quot;</span><span class="s2">)</span>

        <span class="s1">series </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">series </span><span class="s2">= </span><span class="s1">series</span><span class="s2">.</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s1">local_timezone</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">series</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s3">&quot;period&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>

        <span class="s5"># Create the expected series</span>
        <span class="s5"># Index is moved back a day with the timezone conversion from UTC to</span>
        <span class="s5"># Pacific</span>
        <span class="s1">expected_index </span><span class="s2">= (</span>
            <span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;idx&quot;</span><span class="s2">) - </span><span class="s1">offsets</span><span class="s2">.</span><span class="s1">Day</span><span class="s2">()</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s6">1.0</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">expected_index</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;tz&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s1">pytz</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">(</span><span class="s3">&quot;America/Los_Angeles&quot;</span><span class="s2">),</span>
            <span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">(</span><span class="s3">&quot;America/Los_Angeles&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_resample_with_tz</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s5"># GH 13238</span>
        <span class="s1">dti </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;2017-01-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">48</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">=</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s6">2</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">dti</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">exp_dti </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s3">&quot;2017-01-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2017-01-02&quot;</span><span class="s2">], </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span>
        <span class="s2">).</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s6">2.0</span><span class="s2">,</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">exp_dti</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>
        <span class="s5"># Especially assert that the timezone is LMT for pytz</span>
        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">tz </span><span class="s2">== </span><span class="s1">tz</span>

    <span class="s0">def </span><span class="s1">test_resample_nonexistent_time_bin_edge</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH 19375</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;2017-03-12&quot;</span><span class="s2">, </span><span class="s3">&quot;2017-03-12 1:45:00&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;15min&quot;</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s3">&quot;US/Pacific&quot;</span><span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;900s&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;900s&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_nonexistent_time_bin_edge2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH 23742</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2017-10-10&quot;</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s3">&quot;2017-10-20&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;1h&quot;</span><span class="s2">)</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">index</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s3">&quot;UTC&quot;</span><span class="s2">).</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s3">&quot;America/Sao_Paulo&quot;</span><span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=</span><span class="s1">list</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">groupby</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">Grouper</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;1D&quot;</span><span class="s2">)).</span><span class="s1">count</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span>
            <span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2017-10-09&quot;</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">=</span><span class="s3">&quot;2017-10-20&quot;</span><span class="s2">,</span>
            <span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">,</span>
            <span class="s1">tz</span><span class="s2">=</span><span class="s3">&quot;America/Sao_Paulo&quot;</span><span class="s2">,</span>
            <span class="s1">nonexistent</span><span class="s2">=</span><span class="s3">&quot;shift_forward&quot;</span><span class="s2">,</span>
            <span class="s1">inclusive</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_ambiguous_time_bin_edge</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH 10117</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span>
            <span class="s3">&quot;2014-10-25 22:00:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2014-10-26 00:30:00&quot;</span><span class="s2">,</span>
            <span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;30min&quot;</span><span class="s2">,</span>
            <span class="s1">tz</span><span class="s2">=</span><span class="s3">&quot;Europe/London&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;30min&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_fill_method_and_how_upsample</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH2073</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">9</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;int64&quot;</span><span class="s2">),</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;2010-01-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">9</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;QE&quot;</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">last </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;ME&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
        <span class="s1">both </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;ME&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;ME&quot;</span><span class="s2">).</span><span class="s1">last</span><span class="s2">().</span><span class="s1">astype</span><span class="s2">(</span><span class="s3">&quot;int64&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">last</span><span class="s2">, </span><span class="s1">both</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;day&quot;</span><span class="s2">, </span><span class="s1">DAYS</span><span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;target&quot;</span><span class="s2">, [</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;B&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;convention&quot;</span><span class="s2">, [</span><span class="s3">&quot;start&quot;</span><span class="s2">, </span><span class="s3">&quot;end&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_weekly_upsample</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">day</span><span class="s2">, </span><span class="s1">target</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">):</span>
        <span class="s1">freq </span><span class="s2">= </span><span class="s3">f&quot;W-</span><span class="s0">{</span><span class="s1">day</span><span class="s0">}</span><span class="s3">&quot;</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;12/31/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">)</span>

        <span class="s1">warn </span><span class="s2">= </span><span class="s0">None if </span><span class="s1">target </span><span class="s2">== </span><span class="s3">&quot;D&quot; </span><span class="s0">else </span><span class="s1">FutureWarning</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">r&quot;PeriodDtype\[B\] is deprecated&quot;</span>
        <span class="s0">if </span><span class="s1">warn </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
            <span class="s1">warn </span><span class="s2">= </span><span class="s1">FutureWarning</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">warn</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">=</span><span class="s1">convention</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s1">convention</span><span class="s2">)</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s3">&quot;ffill&quot;</span><span class="s2">).</span><span class="s1">to_period</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_to_timestamps</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/1990&quot;</span><span class="s2">, </span><span class="s3">&quot;12/31/1995&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">)</span>

        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s3">&quot;timestamp&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">).</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;YE-DEC&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;month&quot;</span><span class="s2">, </span><span class="s1">MONTHS</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_resample_to_quarterly</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">, </span><span class="s1">month</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1990&quot;</span><span class="s2">, </span><span class="s3">&quot;1992&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">f&quot;Y-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">)</span>
        <span class="s1">quar_ts </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">f&quot;Q-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>

        <span class="s1">stamps </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;start&quot;</span><span class="s2">)</span>
        <span class="s1">qdates </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span>
            <span class="s1">ts</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s6">0</span><span class="s2">].</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;start&quot;</span><span class="s2">),</span>
            <span class="s1">ts</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[-</span><span class="s6">1</span><span class="s2">].</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;end&quot;</span><span class="s2">),</span>
            <span class="s1">freq</span><span class="s2">=</span><span class="s3">f&quot;Q-</span><span class="s0">{</span><span class="s1">month</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s2">,</span>
        <span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">stamps</span><span class="s2">.</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">qdates</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;s&quot;</span><span class="s2">), </span><span class="s1">method</span><span class="s2">=</span><span class="s3">&quot;ffill&quot;</span><span class="s2">)</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">qdates</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">quar_ts</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;how&quot;</span><span class="s2">, [</span><span class="s3">&quot;start&quot;</span><span class="s2">, </span><span class="s3">&quot;end&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_resample_to_quarterly_start_end</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">, </span><span class="s1">how</span><span class="s2">):</span>
        <span class="s5"># conforms, but different month</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1990&quot;</span><span class="s2">, </span><span class="s3">&quot;1992&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Y-JUN&quot;</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'convention' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Q-MAR&quot;</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">=</span><span class="s1">how</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;Q-MAR&quot;</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s1">how</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s3">&quot;ffill&quot;</span><span class="s2">)</span>

        <span class="s5"># FIXME: don't leave commented-out</span>
        <span class="s5"># .to_timestamp('D')</span>
        <span class="s5"># expected = expected.resample('Q-MAR').ffill()</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_fill_missing</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">PeriodIndex</span><span class="s2">([</span><span class="s6">2000</span><span class="s2">, </span><span class="s6">2005</span><span class="s2">, </span><span class="s6">2007</span><span class="s2">, </span><span class="s6">2009</span><span class="s2">], </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Y&quot;</span><span class="s2">)</span>

        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s6">4</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s1">stamps </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">()</span>
        <span class="s1">filled </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">stamps</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;YE&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">().</span><span class="s1">to_period</span><span class="s2">(</span><span class="s3">&quot;Y&quot;</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">filled</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_cant_fill_missing_dups</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">PeriodIndex</span><span class="s2">([</span><span class="s6">2000</span><span class="s2">, </span><span class="s6">2005</span><span class="s2">, </span><span class="s6">2005</span><span class="s2">, </span><span class="s6">2007</span><span class="s2">, </span><span class="s6">2007</span><span class="s2">], </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Y&quot;</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s6">5</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Reindexing only valid with uniquely valued Index objects&quot;</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">InvalidIndexError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;freq&quot;</span><span class="s2">, [</span><span class="s3">&quot;5min&quot;</span><span class="s2">])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;kind&quot;</span><span class="s2">, [</span><span class="s3">&quot;period&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;timestamp&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_resample_5minute</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s3">&quot;1/5/2000&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;min&quot;</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s0">if </span><span class="s1">kind </span><span class="s2">!= </span><span class="s3">&quot;timestamp&quot;</span><span class="s2">:</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">to_period</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s1">kind</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_upsample_daily_business_daily</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">simple_period_range_series</span><span class="s2">):</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s3">&quot;2/1/2000&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;B&quot;</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">).</span><span class="s1">asfreq</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">).</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;1/3/2000&quot;</span><span class="s2">, </span><span class="s3">&quot;2/1/2000&quot;</span><span class="s2">))</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">ts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s3">&quot;2/1/2000&quot;</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'convention' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s1">convention</span><span class="s2">=</span><span class="s3">&quot;s&quot;</span><span class="s2">).</span><span class="s1">asfreq</span><span class="s2">()</span>
        <span class="s1">exp_rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s3">&quot;2/1/2000 23:00&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;h&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;s&quot;</span><span class="s2">).</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">exp_rng</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_irregular_sparse</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">dr </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;1/1/2012&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;5min&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">1000</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s6">100</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">dr</span><span class="s2">)</span>
        <span class="s5"># subset the data.</span>
        <span class="s1">subset </span><span class="s2">= </span><span class="s1">s</span><span class="s2">[:</span><span class="s3">&quot;2012-01-04 06:55&quot;</span><span class="s2">]</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">subset</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;10min&quot;</span><span class="s2">).</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">len</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;10min&quot;</span><span class="s2">).</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">len</span><span class="s2">).</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">result</span><span class="s2">.</span><span class="s1">index</span><span class="s2">]</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_weekly_all_na</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;1/1/2000&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">10</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;W-WED&quot;</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;W-THU&quot;</span><span class="s2">).</span><span class="s1">asfreq</span><span class="s2">()</span>

        <span class="s0">assert </span><span class="s1">result</span><span class="s2">.</span><span class="s1">isna</span><span class="s2">().</span><span class="s1">all</span><span class="s2">()</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;W-THU&quot;</span><span class="s2">).</span><span class="s1">asfreq</span><span class="s2">().</span><span class="s1">ffill</span><span class="s2">()[:-</span><span class="s6">1</span><span class="s2">]</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;W-THU&quot;</span><span class="s2">).</span><span class="s1">ffill</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_tz_localized</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">):</span>
        <span class="s1">dr </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2012-4-13&quot;</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s3">&quot;2012-5-1&quot;</span><span class="s2">, </span><span class="s1">unit</span><span class="s2">=</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">dr</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">dr</span><span class="s2">)</span>

        <span class="s1">ts_utc </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s3">&quot;UTC&quot;</span><span class="s2">)</span>
        <span class="s1">ts_local </span><span class="s2">= </span><span class="s1">ts_utc</span><span class="s2">.</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s3">&quot;America/Los_Angeles&quot;</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts_local</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;W&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>

        <span class="s1">ts_local_naive </span><span class="s2">= </span><span class="s1">ts_local</span><span class="s2">.</span><span class="s1">copy</span><span class="s2">()</span>
        <span class="s1">ts_local_naive</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">ts_local_naive</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>

        <span class="s1">exp </span><span class="s2">= </span><span class="s1">ts_local_naive</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;W&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">().</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s3">&quot;America/Los_Angeles&quot;</span><span class="s2">)</span>
        <span class="s1">exp</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">(</span><span class="s1">exp</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;W&quot;</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">)</span>

        <span class="s5"># it works</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts_local</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_resample_tz_localized2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># #2245</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span>
            <span class="s3">&quot;2001-09-20 15:59&quot;</span><span class="s2">, </span><span class="s3">&quot;2001-09-20 16:00&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;min&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s3">&quot;Australia/Sydney&quot;</span>
        <span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">idx</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">ex_index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;2001-09-21&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">1</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s3">&quot;Australia/Sydney&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">1.5</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">ex_index</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s5"># for good measure</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s3">&quot;period&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">ex_index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2001-09-20&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">1</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">1.5</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">ex_index</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_tz_localized3</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH 6397</span>
        <span class="s5"># comparing an offset that doesn't propagate tz's</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;1/1/2011&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">20000</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;h&quot;</span><span class="s2">)</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s3">&quot;EST&quot;</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s1">ts</span><span class="s2">[</span><span class="s3">&quot;first&quot;</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">))</span>
        <span class="s1">ts</span><span class="s2">[</span><span class="s3">&quot;second&quot;</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">cumsum</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">rng</span><span class="s2">)))</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">{</span>
                <span class="s3">&quot;first&quot;</span><span class="s2">: </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;YE&quot;</span><span class="s2">).</span><span class="s1">sum</span><span class="s2">()[</span><span class="s3">&quot;first&quot;</span><span class="s2">],</span>
                <span class="s3">&quot;second&quot;</span><span class="s2">: </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;YE&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()[</span><span class="s3">&quot;second&quot;</span><span class="s2">],</span>
            <span class="s2">},</span>
            <span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;first&quot;</span><span class="s2">, </span><span class="s3">&quot;second&quot;</span><span class="s2">],</span>
        <span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= (</span>
            <span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;YE&quot;</span><span class="s2">)</span>
            <span class="s2">.</span><span class="s1">agg</span><span class="s2">({</span><span class="s3">&quot;first&quot;</span><span class="s2">: </span><span class="s3">&quot;sum&quot;</span><span class="s2">, </span><span class="s3">&quot;second&quot;</span><span class="s2">: </span><span class="s3">&quot;mean&quot;</span><span class="s2">})</span>
            <span class="s2">.</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;first&quot;</span><span class="s2">, </span><span class="s3">&quot;second&quot;</span><span class="s2">])</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_closed_left_corner</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># #1465</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s6">21</span><span class="s2">),</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;1/1/2012 9:30&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;1min&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">21</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">s</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;10min&quot;</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">exp </span><span class="s2">= </span><span class="s1">s</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:].</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;10min&quot;</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;10min&quot;</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">exp </span><span class="s2">= </span><span class="s1">s</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:].</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;10min&quot;</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>

        <span class="s1">ex_index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;1/1/2012 9:30&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;10min&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">3</span><span class="s2">)</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_index_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">index</span><span class="s2">, </span><span class="s1">ex_index</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_quarterly_resampling</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2000Q1&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">10</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Q-DEC&quot;</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">10</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">exp </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;YE&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">().</span><span class="s1">to_period</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_weekly_bug_1726</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># 8/6/12 is a Monday</span>
        <span class="s1">ind </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;8/6/2012&quot;</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s3">&quot;8/26/2012&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">)</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">ind</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= [[</span><span class="s1">x</span><span class="s2">] * </span><span class="s6">5 </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">n</span><span class="s2">)]</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;open&quot;</span><span class="s2">, </span><span class="s3">&quot;high&quot;</span><span class="s2">, </span><span class="s3">&quot;low&quot;</span><span class="s2">, </span><span class="s3">&quot;close&quot;</span><span class="s2">, </span><span class="s3">&quot;vol&quot;</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">ind</span><span class="s2">)</span>

        <span class="s5"># it works!</span>
        <span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;W-MON&quot;</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">).</span><span class="s1">first</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">test_resample_with_dst_time_change</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH 15549</span>
        <span class="s1">index </span><span class="s2">= (</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">([</span><span class="s6">1457537600000000000</span><span class="s2">, </span><span class="s6">1458059600000000000</span><span class="s2">])</span>
            <span class="s2">.</span><span class="s1">tz_localize</span><span class="s2">(</span><span class="s3">&quot;UTC&quot;</span><span class="s2">)</span>
            <span class="s2">.</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s3">&quot;America/Chicago&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;12h&quot;</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">).</span><span class="s1">last</span><span class="s2">().</span><span class="s1">ffill</span><span class="s2">()</span>

        <span class="s1">expected_index_values </span><span class="s2">= [</span>
            <span class="s3">&quot;2016-03-09 12:00:00-06:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-10 00:00:00-06:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-10 12:00:00-06:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-11 00:00:00-06:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-11 12:00:00-06:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-12 00:00:00-06:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-12 12:00:00-06:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-13 00:00:00-06:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-13 13:00:00-05:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-14 01:00:00-05:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-14 13:00:00-05:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-15 01:00:00-05:00&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;2016-03-15 13:00:00-05:00&quot;</span><span class="s2">,</span>
        <span class="s2">]</span>
        <span class="s1">index </span><span class="s2">= (</span>
            <span class="s1">pd</span><span class="s2">.</span><span class="s1">to_datetime</span><span class="s2">(</span><span class="s1">expected_index_values</span><span class="s2">, </span><span class="s1">utc</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
            <span class="s2">.</span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s3">&quot;America/Chicago&quot;</span><span class="s2">)</span>
            <span class="s2">.</span><span class="s1">as_unit</span><span class="s2">(</span><span class="s1">index</span><span class="s2">.</span><span class="s1">unit</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;12h&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">2.0</span><span class="s2">],</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_bms_2752</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH2753</span>
        <span class="s1">timeseries </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">bdate_range</span><span class="s2">(</span><span class="s3">&quot;20000101&quot;</span><span class="s2">, </span><span class="s3">&quot;20000201&quot;</span><span class="s2">), </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">float64</span>
        <span class="s2">)</span>
        <span class="s1">res1 </span><span class="s2">= </span><span class="s1">timeseries</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;BMS&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">res2 </span><span class="s2">= </span><span class="s1">timeseries</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;BMS&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;B&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s0">assert </span><span class="s1">res1</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;20000103&quot;</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">res1</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s6">0</span><span class="s2">] == </span><span class="s1">res2</span><span class="s2">.</span><span class="s1">index</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Commented out for more than 3 years. Should this work?&quot;</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_monthly_convention_span</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2000-01&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">3</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;ME&quot;</span><span class="s2">)</span>
        <span class="s1">ts </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s6">3</span><span class="s2">), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s5"># hacky way to get same thing</span>
        <span class="s1">exp_index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2000-01-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2000-03-31&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">how</span><span class="s2">=</span><span class="s3">&quot;end&quot;</span><span class="s2">).</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">exp_index</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">fillna</span><span class="s2">(</span><span class="s1">method</span><span class="s2">=</span><span class="s3">&quot;bfill&quot;</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;D&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>

        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;from_freq, to_freq&quot;</span><span class="s2">, [(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;ME&quot;</span><span class="s2">), (</span><span class="s3">&quot;QE&quot;</span><span class="s2">, </span><span class="s3">&quot;YE&quot;</span><span class="s2">), (</span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s3">&quot;QE&quot;</span><span class="s2">), (</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;W&quot;</span><span class="s2">)]</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_default_right_closed_label</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">from_freq</span><span class="s2">, </span><span class="s1">to_freq</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;8/15/2012&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">100</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">from_freq</span><span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s1">len</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">), </span><span class="s6">2</span><span class="s2">)), </span><span class="s1">idx</span><span class="s2">)</span>

        <span class="s1">resampled </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">to_freq</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span>
            <span class="s1">resampled</span><span class="s2">, </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">to_freq</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;right&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;from_freq, to_freq&quot;</span><span class="s2">,</span>
        <span class="s2">[(</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;MS&quot;</span><span class="s2">), (</span><span class="s3">&quot;QE&quot;</span><span class="s2">, </span><span class="s3">&quot;YS&quot;</span><span class="s2">), (</span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s3">&quot;QS&quot;</span><span class="s2">), (</span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">), (</span><span class="s3">&quot;min&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">)],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_default_left_closed_label</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">from_freq</span><span class="s2">, </span><span class="s1">to_freq</span><span class="s2">):</span>
        <span class="s1">idx </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;8/15/2012&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">100</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">from_freq</span><span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s1">len</span><span class="s2">(</span><span class="s1">idx</span><span class="s2">), </span><span class="s6">2</span><span class="s2">)), </span><span class="s1">idx</span><span class="s2">)</span>

        <span class="s1">resampled </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">to_freq</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span>
            <span class="s1">resampled</span><span class="s2">, </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">to_freq</span><span class="s2">, </span><span class="s1">closed</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">, </span><span class="s1">label</span><span class="s2">=</span><span class="s3">&quot;left&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_all_values_single_bin</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH#2070</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2012-01-01&quot;</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s3">&quot;2012-12-31&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">)</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>

        <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">], </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">())</span>

    <span class="s0">def </span><span class="s1">test_evenly_divisible_with_no_extra_bins</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH#4076</span>
        <span class="s5"># when the frequency is evenly divisible, sometimes extra bins</span>

        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s6">2</span><span class="s2">).</span><span class="s1">standard_normal</span><span class="s2">((</span><span class="s6">9</span><span class="s2">, </span><span class="s6">3</span><span class="s2">)),</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;2000-1-1&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">9</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;5D&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">([</span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">0</span><span class="s2">:</span><span class="s6">5</span><span class="s2">].</span><span class="s1">mean</span><span class="s2">(), </span><span class="s1">df</span><span class="s2">.</span><span class="s1">iloc</span><span class="s2">[</span><span class="s6">5</span><span class="s2">:].</span><span class="s1">mean</span><span class="s2">()], </span><span class="s1">axis</span><span class="s2">=</span><span class="s6">1</span><span class="s2">).</span><span class="s1">T</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2000-1-1&quot;</span><span class="s2">), </span><span class="s1">Timestamp</span><span class="s2">(</span><span class="s3">&quot;2000-1-6&quot;</span><span class="s2">)], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;M8[ns]&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;5D&quot;</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_evenly_divisible_with_no_extra_bins2</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2001-5-4&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">28</span><span class="s2">)</span>
        <span class="s1">df </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">{</span>
                    <span class="s3">&quot;REST_KEY&quot;</span><span class="s2">: </span><span class="s6">1</span><span class="s2">,</span>
                    <span class="s3">&quot;DLY_TRN_QT&quot;</span><span class="s2">: </span><span class="s6">80</span><span class="s2">,</span>
                    <span class="s3">&quot;DLY_SLS_AMT&quot;</span><span class="s2">: </span><span class="s6">90</span><span class="s2">,</span>
                    <span class="s3">&quot;COOP_DLY_TRN_QT&quot;</span><span class="s2">: </span><span class="s6">30</span><span class="s2">,</span>
                    <span class="s3">&quot;COOP_DLY_SLS_AMT&quot;</span><span class="s2">: </span><span class="s6">20</span><span class="s2">,</span>
                <span class="s2">}</span>
            <span class="s2">]</span>
            <span class="s2">* </span><span class="s6">28</span>
            <span class="s2">+ [</span>
                <span class="s2">{</span>
                    <span class="s3">&quot;REST_KEY&quot;</span><span class="s2">: </span><span class="s6">2</span><span class="s2">,</span>
                    <span class="s3">&quot;DLY_TRN_QT&quot;</span><span class="s2">: </span><span class="s6">70</span><span class="s2">,</span>
                    <span class="s3">&quot;DLY_SLS_AMT&quot;</span><span class="s2">: </span><span class="s6">10</span><span class="s2">,</span>
                    <span class="s3">&quot;COOP_DLY_TRN_QT&quot;</span><span class="s2">: </span><span class="s6">50</span><span class="s2">,</span>
                    <span class="s3">&quot;COOP_DLY_SLS_AMT&quot;</span><span class="s2">: </span><span class="s6">20</span><span class="s2">,</span>
                <span class="s2">}</span>
            <span class="s2">]</span>
            <span class="s2">* </span><span class="s6">28</span><span class="s2">,</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">index</span><span class="s2">),</span>
        <span class="s2">).</span><span class="s1">sort_index</span><span class="s2">()</span>

        <span class="s1">index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s3">&quot;2001-5-4&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">4</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;7D&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">{</span>
                    <span class="s3">&quot;REST_KEY&quot;</span><span class="s2">: </span><span class="s6">14</span><span class="s2">,</span>
                    <span class="s3">&quot;DLY_TRN_QT&quot;</span><span class="s2">: </span><span class="s6">14</span><span class="s2">,</span>
                    <span class="s3">&quot;DLY_SLS_AMT&quot;</span><span class="s2">: </span><span class="s6">14</span><span class="s2">,</span>
                    <span class="s3">&quot;COOP_DLY_TRN_QT&quot;</span><span class="s2">: </span><span class="s6">14</span><span class="s2">,</span>
                    <span class="s3">&quot;COOP_DLY_SLS_AMT&quot;</span><span class="s2">: </span><span class="s6">14</span><span class="s2">,</span>
                <span class="s2">}</span>
            <span class="s2">]</span>
            <span class="s2">* </span><span class="s6">4</span><span class="s2">,</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;7D&quot;</span><span class="s2">).</span><span class="s1">count</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span>
            <span class="s2">[</span>
                <span class="s2">{</span>
                    <span class="s3">&quot;REST_KEY&quot;</span><span class="s2">: </span><span class="s6">21</span><span class="s2">,</span>
                    <span class="s3">&quot;DLY_TRN_QT&quot;</span><span class="s2">: </span><span class="s6">1050</span><span class="s2">,</span>
                    <span class="s3">&quot;DLY_SLS_AMT&quot;</span><span class="s2">: </span><span class="s6">700</span><span class="s2">,</span>
                    <span class="s3">&quot;COOP_DLY_TRN_QT&quot;</span><span class="s2">: </span><span class="s6">560</span><span class="s2">,</span>
                    <span class="s3">&quot;COOP_DLY_SLS_AMT&quot;</span><span class="s2">: </span><span class="s6">280</span><span class="s2">,</span>
                <span class="s2">}</span>
            <span class="s2">]</span>
            <span class="s2">* </span><span class="s6">4</span><span class="s2">,</span>
            <span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">df</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;7D&quot;</span><span class="s2">).</span><span class="s1">sum</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;freq, period_mult&quot;</span><span class="s2">, [(</span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s6">24</span><span class="s2">), (</span><span class="s3">&quot;12h&quot;</span><span class="s2">, </span><span class="s6">2</span><span class="s2">)])</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">&quot;kind&quot;</span><span class="s2">, [</span><span class="s0">None</span><span class="s2">, </span><span class="s3">&quot;period&quot;</span><span class="s2">])</span>
    <span class="s0">def </span><span class="s1">test_upsampling_ohlc</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">period_mult</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">):</span>
        <span class="s5"># GH 13083</span>
        <span class="s1">pi </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">10</span><span class="s2">)</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">range</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">pi</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">pi</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">).</span><span class="s1">ohlc</span><span class="s2">().</span><span class="s1">to_period</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>

        <span class="s5"># timestamp-based resampling doesn't include all sub-periods</span>
        <span class="s5"># of the last original period, so extend accordingly:</span>
        <span class="s1">new_index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2000&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s1">period_mult </span><span class="s2">* </span><span class="s1">len</span><span class="s2">(</span><span class="s1">pi</span><span class="s2">))</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">reindex</span><span class="s2">(</span><span class="s1">new_index</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;The 'kind' keyword in Series.resample is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">=</span><span class="s1">kind</span><span class="s2">).</span><span class="s1">ohlc</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;periods, values&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span>
                <span class="s2">[</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                    <span class="s3">&quot;1970-01-01 00:00:00&quot;</span><span class="s2">,</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                    <span class="s3">&quot;1970-01-01 00:00:02&quot;</span><span class="s2">,</span>
                    <span class="s3">&quot;1970-01-01 00:00:03&quot;</span><span class="s2">,</span>
                <span class="s2">],</span>
                <span class="s2">[</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, </span><span class="s6">11</span><span class="s2">],</span>
            <span class="s2">),</span>
            <span class="s2">(</span>
                <span class="s2">[</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                    <span class="s3">&quot;1970-01-01 00:00:00&quot;</span><span class="s2">,</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                    <span class="s3">&quot;1970-01-01 00:00:02&quot;</span><span class="s2">,</span>
                    <span class="s3">&quot;1970-01-01 00:00:03&quot;</span><span class="s2">,</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                    <span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">,</span>
                <span class="s2">],</span>
                <span class="s2">[</span><span class="s6">1</span><span class="s2">, </span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">5</span><span class="s2">, </span><span class="s6">6</span><span class="s2">, </span><span class="s6">8</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, </span><span class="s6">11</span><span class="s2">, </span><span class="s6">12</span><span class="s2">, </span><span class="s6">13</span><span class="s2">],</span>
            <span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;freq, expected_values&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">&quot;1s&quot;</span><span class="s2">, [</span><span class="s6">3</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s6">7</span><span class="s2">, </span><span class="s6">11</span><span class="s2">]),</span>
            <span class="s2">(</span><span class="s3">&quot;2s&quot;</span><span class="s2">, [</span><span class="s6">3</span><span class="s2">, (</span><span class="s6">7 </span><span class="s2">+ </span><span class="s6">11</span><span class="s2">) / </span><span class="s6">2</span><span class="s2">]),</span>
            <span class="s2">(</span><span class="s3">&quot;3s&quot;</span><span class="s2">, [(</span><span class="s6">3 </span><span class="s2">+ </span><span class="s6">7</span><span class="s2">) / </span><span class="s6">2</span><span class="s2">, </span><span class="s6">11</span><span class="s2">]),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_resample_with_nat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">, </span><span class="s1">values</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">expected_values</span><span class="s2">):</span>
        <span class="s5"># GH 13224</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">PeriodIndex</span><span class="s2">(</span><span class="s1">periods</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;s&quot;</span><span class="s2">)</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">index</span><span class="s2">)</span>

        <span class="s1">expected_index </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span>
            <span class="s3">&quot;1970-01-01 00:00:00&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s1">len</span><span class="s2">(</span><span class="s1">expected_values</span><span class="s2">), </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">expected_values</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">expected_index</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">rs </span><span class="s2">= </span><span class="s1">frame</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_with_only_nat</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH 13224</span>
        <span class="s1">pi </span><span class="s2">= </span><span class="s1">PeriodIndex</span><span class="s2">([</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">NaT</span><span class="s2">] * </span><span class="s6">3</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;s&quot;</span><span class="s2">)</span>
        <span class="s1">frame </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">([</span><span class="s6">2</span><span class="s2">, </span><span class="s6">3</span><span class="s2">, </span><span class="s6">5</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">pi</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;a&quot;</span><span class="s2">])</span>
        <span class="s1">expected_index </span><span class="s2">= </span><span class="s1">PeriodIndex</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=[], </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">pi</span><span class="s2">.</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">DataFrame</span><span class="s2">(</span><span class="s1">index</span><span class="s2">=</span><span class="s1">expected_index</span><span class="s2">, </span><span class="s1">columns</span><span class="s2">=[</span><span class="s3">&quot;a&quot;</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s3">&quot;float64&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">frame</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;1s&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_frame_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;start,end,start_freq,end_freq,offset&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 03:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 23:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 10:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 10:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 10:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 10:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 03:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;34h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;17h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;h&quot;</span><span class="s2">, </span><span class="s3">&quot;17h&quot;</span><span class="s2">, </span><span class="s3">&quot;3h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19910913 06:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2h&quot;</span><span class="s2">, </span><span class="s3">&quot;24h&quot;</span><span class="s2">, </span><span class="s3">&quot;10h&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19910905 01:39&quot;</span><span class="s2">, </span><span class="s3">&quot;Min&quot;</span><span class="s2">, </span><span class="s3">&quot;5Min&quot;</span><span class="s2">, </span><span class="s3">&quot;3Min&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19910905 03:18&quot;</span><span class="s2">, </span><span class="s3">&quot;2Min&quot;</span><span class="s2">, </span><span class="s3">&quot;5Min&quot;</span><span class="s2">, </span><span class="s3">&quot;3Min&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_resample_with_offset</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">start_freq</span><span class="s2">, </span><span class="s1">end_freq</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">):</span>
        <span class="s5"># GH 23882 &amp; 31809</span>
        <span class="s1">pi </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">start_freq</span><span class="s2">)</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">pi</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">pi</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">rs </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">end_freq</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">offset</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s1">end_freq</span><span class="s2">)</span>

        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">end_freq</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s1">offset</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_with_offset_month</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH 23882 &amp; 31809</span>
        <span class="s1">pi </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;19910905 12:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19910909 1:00&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;h&quot;</span><span class="s2">)</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">pi</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">pi</span><span class="s2">)</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">rs </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s3">&quot;3h&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">(</span><span class="s3">&quot;M&quot;</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">to_timestamp</span><span class="s2">().</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">=</span><span class="s3">&quot;3h&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s5"># TODO: is non-tick the relevant characteristic? (GH 33815)</span>
        <span class="s1">expected</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">index</span><span class="s2">.</span><span class="s1">_with_freq</span><span class="s2">(</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;first,last,freq,freq_to_offset,exp_first,exp_last&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19920406&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19920406&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910905 00:00&quot;</span><span class="s2">, </span><span class="s3">&quot;19920406 06:00&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;D&quot;</span><span class="s2">, </span><span class="s3">&quot;19910905&quot;</span><span class="s2">, </span><span class="s3">&quot;19920406&quot;</span><span class="s2">),</span>
            <span class="s2">(</span>
                <span class="s3">&quot;19910905 06:00&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;19920406 06:00&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;h&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;h&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;19910905 06:00&quot;</span><span class="s2">,</span>
                <span class="s3">&quot;19920406 06:00&quot;</span><span class="s2">,</span>
            <span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910906&quot;</span><span class="s2">, </span><span class="s3">&quot;19920406&quot;</span><span class="s2">, </span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s3">&quot;1991-09&quot;</span><span class="s2">, </span><span class="s3">&quot;1992-04&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;19910831&quot;</span><span class="s2">, </span><span class="s3">&quot;19920430&quot;</span><span class="s2">, </span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s3">&quot;1991-08&quot;</span><span class="s2">, </span><span class="s3">&quot;1992-04&quot;</span><span class="s2">),</span>
            <span class="s2">(</span><span class="s3">&quot;1991-08&quot;</span><span class="s2">, </span><span class="s3">&quot;1992-04&quot;</span><span class="s2">, </span><span class="s3">&quot;M&quot;</span><span class="s2">, </span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s3">&quot;1991-08&quot;</span><span class="s2">, </span><span class="s3">&quot;1992-04&quot;</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_get_period_range_edges</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">first</span><span class="s2">, </span><span class="s1">last</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">freq_to_offset</span><span class="s2">, </span><span class="s1">exp_first</span><span class="s2">, </span><span class="s1">exp_last</span>
    <span class="s2">):</span>
        <span class="s1">first </span><span class="s2">= </span><span class="s1">Period</span><span class="s2">(</span><span class="s1">first</span><span class="s2">)</span>
        <span class="s1">last </span><span class="s2">= </span><span class="s1">Period</span><span class="s2">(</span><span class="s1">last</span><span class="s2">)</span>

        <span class="s1">exp_first </span><span class="s2">= </span><span class="s1">Period</span><span class="s2">(</span><span class="s1">exp_first</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">exp_last </span><span class="s2">= </span><span class="s1">Period</span><span class="s2">(</span><span class="s1">exp_last</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq</span><span class="s2">)</span>

        <span class="s1">freq </span><span class="s2">= </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">tseries</span><span class="s2">.</span><span class="s1">frequencies</span><span class="s2">.</span><span class="s1">to_offset</span><span class="s2">(</span><span class="s1">freq_to_offset</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">_get_period_range_edges</span><span class="s2">(</span><span class="s1">first</span><span class="s2">, </span><span class="s1">last</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= (</span><span class="s1">exp_first</span><span class="s2">, </span><span class="s1">exp_last</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">result </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s0">def </span><span class="s1">test_sum_min_count</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH 19974</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s3">&quot;2018&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;ME&quot;</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s6">6</span><span class="s2">)</span>
        <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s6">6</span><span class="s2">)</span>
        <span class="s1">data</span><span class="s2">[</span><span class="s6">3</span><span class="s2">:</span><span class="s6">6</span><span class="s2">] = </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
        <span class="s1">s </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">index</span><span class="s2">).</span><span class="s1">to_period</span><span class="s2">()</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">rs </span><span class="s2">= </span><span class="s1">s</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Q&quot;</span><span class="s2">)</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">rs</span><span class="s2">.</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">min_count</span><span class="s2">=</span><span class="s6">1</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s6">3.0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">PeriodIndex</span><span class="s2">([</span><span class="s3">&quot;2018Q1&quot;</span><span class="s2">, </span><span class="s3">&quot;2018Q2&quot;</span><span class="s2">], </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;Q-DEC&quot;</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">test_resample_t_l_deprecated</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s5"># GH#52536</span>
        <span class="s1">msg_t </span><span class="s2">= </span><span class="s3">&quot;'T' is deprecated and will be removed in a future version.&quot;</span>
        <span class="s1">msg_l </span><span class="s2">= </span><span class="s3">&quot;'L' is deprecated and will be removed in a future version.&quot;</span>

        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg_l</span><span class="s2">):</span>
            <span class="s1">rng_l </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span>
                <span class="s3">&quot;2020-01-01 00:00:00 00:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2020-01-01 00:00:00 00:01&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;L&quot;</span>
            <span class="s2">)</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">rng_l</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng_l</span><span class="s2">)</span>

        <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span>
            <span class="s3">&quot;2020-01-01 00:00:00 00:00&quot;</span><span class="s2">, </span><span class="s3">&quot;2020-01-01 00:00:00 00:01&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;min&quot;</span>
        <span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">([</span><span class="s6">29999.5</span><span class="s2">, </span><span class="s6">60000.0</span><span class="s2">], </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg_t</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;T&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;freq, freq_depr, freq_res, freq_depr_res, data&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s2">(</span><span class="s3">&quot;2Q&quot;</span><span class="s2">, </span><span class="s3">&quot;2q&quot;</span><span class="s2">, </span><span class="s3">&quot;2Y&quot;</span><span class="s2">, </span><span class="s3">&quot;2y&quot;</span><span class="s2">, [</span><span class="s6">0.5</span><span class="s2">]),</span>
            <span class="s2">(</span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s3">&quot;2m&quot;</span><span class="s2">, </span><span class="s3">&quot;2Q&quot;</span><span class="s2">, </span><span class="s3">&quot;2q&quot;</span><span class="s2">, [</span><span class="s6">1.0</span><span class="s2">, </span><span class="s6">3.0</span><span class="s2">]),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_resample_lowercase_frequency_deprecated</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">freq_depr</span><span class="s2">, </span><span class="s1">freq_res</span><span class="s2">, </span><span class="s1">freq_depr_res</span><span class="s2">, </span><span class="s1">data</span>
    <span class="s2">):</span>
        <span class="s1">depr_msg </span><span class="s2">= </span><span class="s3">f&quot;'</span><span class="s0">{</span><span class="s1">freq_depr</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]</span><span class="s0">}</span><span class="s3">' is deprecated and will be removed in a &quot;</span>
        <span class="s3">f&quot;future version. Please use '</span><span class="s0">{</span><span class="s1">freq</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]</span><span class="s0">}</span><span class="s3">' instead.&quot;</span>
        <span class="s1">depr_msg_res </span><span class="s2">= </span><span class="s3">f&quot;'</span><span class="s0">{</span><span class="s1">freq_depr_res</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]</span><span class="s0">}</span><span class="s3">' is deprecated and will be removed in a &quot;</span>
        <span class="s3">f&quot;future version. Please use '</span><span class="s0">{</span><span class="s1">freq_res</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]</span><span class="s0">}</span><span class="s3">' instead.&quot;</span>

        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">depr_msg</span><span class="s2">):</span>
            <span class="s1">rng_l </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2020-01-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2020-08-01&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq_depr</span><span class="s2">)</span>
        <span class="s1">ser </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">rng_l</span><span class="s2">)), </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng_l</span><span class="s2">)</span>

        <span class="s1">rng </span><span class="s2">= </span><span class="s1">period_range</span><span class="s2">(</span><span class="s3">&quot;2020-01-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2020-08-01&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">freq_res</span><span class="s2">)</span>
        <span class="s1">expected </span><span class="s2">= </span><span class="s1">Series</span><span class="s2">(</span><span class="s1">data</span><span class="s2">=</span><span class="s1">data</span><span class="s2">, </span><span class="s1">index</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">depr_msg_res</span><span class="s2">):</span>
            <span class="s1">result </span><span class="s2">= </span><span class="s1">ser</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq_depr_res</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
        <span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_series_equal</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
        <span class="s3">&quot;offset&quot;</span><span class="s2">,</span>
        <span class="s2">[</span>
            <span class="s1">offsets</span><span class="s2">.</span><span class="s1">MonthBegin</span><span class="s2">(),</span>
            <span class="s1">offsets</span><span class="s2">.</span><span class="s1">BYearBegin</span><span class="s2">(</span><span class="s6">2</span><span class="s2">),</span>
            <span class="s1">offsets</span><span class="s2">.</span><span class="s1">BusinessHour</span><span class="s2">(</span><span class="s6">2</span><span class="s2">),</span>
        <span class="s2">],</span>
    <span class="s2">)</span>
    <span class="s0">def </span><span class="s1">test_asfreq_invalid_period_offset</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">series_and_frame</span><span class="s2">):</span>
        <span class="s5"># GH#55785</span>
        <span class="s1">msg </span><span class="s2">= </span><span class="s3">f&quot;Invalid offset: '</span><span class="s0">{</span><span class="s1">offset</span><span class="s2">.</span><span class="s1">base</span><span class="s0">}</span><span class="s3">' for converting time series &quot;</span>

        <span class="s1">df </span><span class="s2">= </span><span class="s1">series_and_frame</span>
        <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
            <span class="s1">df</span><span class="s2">.</span><span class="s1">asfreq</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">=</span><span class="s1">offset</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;freq,freq_depr&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s2">(</span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s3">&quot;2ME&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;2Q&quot;</span><span class="s2">, </span><span class="s3">&quot;2QE&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;2Q-FEB&quot;</span><span class="s2">, </span><span class="s3">&quot;2QE-FEB&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;2Y&quot;</span><span class="s2">, </span><span class="s3">&quot;2YE&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;2Y-MAR&quot;</span><span class="s2">, </span><span class="s3">&quot;2YE-MAR&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;2M&quot;</span><span class="s2">, </span><span class="s3">&quot;2me&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;2Q&quot;</span><span class="s2">, </span><span class="s3">&quot;2qe&quot;</span><span class="s2">),</span>
        <span class="s2">(</span><span class="s3">&quot;2Y-MAR&quot;</span><span class="s2">, </span><span class="s3">&quot;2ye-mar&quot;</span><span class="s2">),</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_resample_frequency_ME_QE_YE_error_message</span><span class="s2">(</span><span class="s1">series_and_frame</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">freq_depr</span><span class="s2">):</span>
    <span class="s5"># GH#9586</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">f&quot;for Period, please use '</span><span class="s0">{</span><span class="s1">freq</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]</span><span class="s0">}</span><span class="s3">' instead of '</span><span class="s0">{</span><span class="s1">freq_depr</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]</span><span class="s0">}</span><span class="s3">'&quot;</span>

    <span class="s1">obj </span><span class="s2">= </span><span class="s1">series_and_frame</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">obj</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq_depr</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_corner_cases_period</span><span class="s2">(</span><span class="s1">simple_period_range_series</span><span class="s2">):</span>
    <span class="s5"># miscellaneous test coverage</span>
    <span class="s1">len0pts </span><span class="s2">= </span><span class="s1">simple_period_range_series</span><span class="s2">(</span><span class="s3">&quot;2007-01&quot;</span><span class="s2">, </span><span class="s3">&quot;2010-05&quot;</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s3">&quot;M&quot;</span><span class="s2">)[:</span><span class="s6">0</span><span class="s2">]</span>
    <span class="s5"># it works</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">&quot;Resampling with a PeriodIndex is deprecated&quot;</span>
    <span class="s0">with </span><span class="s1">tm</span><span class="s2">.</span><span class="s1">assert_produces_warning</span><span class="s2">(</span><span class="s1">FutureWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">result </span><span class="s2">= </span><span class="s1">len0pts</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s3">&quot;Y-DEC&quot;</span><span class="s2">).</span><span class="s1">mean</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">result</span><span class="s2">) == </span><span class="s6">0</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span>
    <span class="s3">&quot;freq_depr&quot;</span><span class="s2">,</span>
    <span class="s2">[</span>
        <span class="s3">&quot;2BME&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;2CBME&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;2SME&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;2BQE-FEB&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;2BYE-MAR&quot;</span><span class="s2">,</span>
    <span class="s2">],</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_resample_frequency_invalid_freq</span><span class="s2">(</span><span class="s1">series_and_frame</span><span class="s2">, </span><span class="s1">freq_depr</span><span class="s2">):</span>
    <span class="s5"># GH#9586</span>
    <span class="s1">msg </span><span class="s2">= </span><span class="s3">f&quot;Invalid frequency: </span><span class="s0">{</span><span class="s1">freq_depr</span><span class="s2">[</span><span class="s6">1</span><span class="s2">:]</span><span class="s0">}</span><span class="s3">&quot;</span>

    <span class="s1">obj </span><span class="s2">= </span><span class="s1">series_and_frame</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">):</span>
        <span class="s1">obj</span><span class="s2">.</span><span class="s1">resample</span><span class="s2">(</span><span class="s1">freq_depr</span><span class="s2">)</span>
</pre>
</body>
</html>