<html>
<head>
<title>test_dates.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #2aacb8;}
.s5 { color: #6aab73;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_dates.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">datetime</span>

<span class="s0">import </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span>
<span class="s0">import </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">rrule</span>
<span class="s0">import </span><span class="s1">functools</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">pytest</span>

<span class="s0">from </span><span class="s1">matplotlib </span><span class="s0">import </span><span class="s1">rc_context</span><span class="s2">, </span><span class="s1">style</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">dates </span><span class="s0">as </span><span class="s1">mdates</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">from </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">decorators </span><span class="s0">import </span><span class="s1">image_comparison</span>
<span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">ticker </span><span class="s0">as </span><span class="s1">mticker</span>


<span class="s0">def </span><span class="s1">test_date_numpyx</span><span class="s2">():</span>
    <span class="s3"># test that numpy dates work properly...</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">time </span><span class="s2">= [</span><span class="s1">base </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s1">x</span><span class="s2">) </span><span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)]</span>
    <span class="s1">timenp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'datetime64[ns]'</span><span class="s2">)</span>
    <span class="s1">data </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">0.</span><span class="s2">, </span><span class="s4">2.</span><span class="s2">, </span><span class="s4">1.</span><span class="s2">])</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s2">))</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">h</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">hnp</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">timenp</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_xdata</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">=</span><span class="s0">False</span><span class="s2">), </span><span class="s1">hnp</span><span class="s2">.</span><span class="s1">get_xdata</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">(</span><span class="s1">figsize</span><span class="s2">=(</span><span class="s4">10</span><span class="s2">, </span><span class="s4">2</span><span class="s2">))</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">h</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">time</span><span class="s2">)</span>
    <span class="s1">hnp</span><span class="s2">, = </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">timenp</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">h</span><span class="s2">.</span><span class="s1">get_ydata</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">=</span><span class="s0">False</span><span class="s2">), </span><span class="s1">hnp</span><span class="s2">.</span><span class="s1">get_ydata</span><span class="s2">(</span><span class="s1">orig</span><span class="s2">=</span><span class="s0">False</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'t0'</span><span class="s2">, [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),</span>

                                <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),</span>
                                 <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)],</span>

                                <span class="s2">[[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),</span>
                                  <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)],</span>
                                 <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">),</span>
                                  <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)]]])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'dtype'</span><span class="s2">, [</span><span class="s5">'datetime64[s]'</span><span class="s2">,</span>
                                   <span class="s5">'datetime64[us]'</span><span class="s2">,</span>
                                   <span class="s5">'datetime64[ms]'</span><span class="s2">,</span>
                                   <span class="s5">'datetime64[ns]'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date_date2num_numpy</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">):</span>
    <span class="s1">time </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">)</span>
    <span class="s1">tnp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">nptime </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">tnp</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">time</span><span class="s2">, </span><span class="s1">nptime</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'dtype'</span><span class="s2">, [</span><span class="s5">'datetime64[s]'</span><span class="s2">,</span>
                                   <span class="s5">'datetime64[us]'</span><span class="s2">,</span>
                                   <span class="s5">'datetime64[ms]'</span><span class="s2">,</span>
                                   <span class="s5">'datetime64[ns]'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date2num_NaT</span><span class="s2">(</span><span class="s1">dtype</span><span class="s2">):</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">tmpl </span><span class="s2">= [</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">]</span>
    <span class="s1">tnp </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">t0</span><span class="s2">, </span><span class="s5">'NaT'</span><span class="s2">], </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
    <span class="s1">nptime </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">tnp</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">tmpl</span><span class="s2">, </span><span class="s1">nptime</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'units'</span><span class="s2">, [</span><span class="s5">'s'</span><span class="s2">, </span><span class="s5">'ms'</span><span class="s2">, </span><span class="s5">'us'</span><span class="s2">, </span><span class="s5">'ns'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date2num_NaT_scalar</span><span class="s2">(</span><span class="s1">units</span><span class="s2">):</span>
    <span class="s1">tmpl </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'NaT'</span><span class="s2">, </span><span class="s1">units</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">tmpl</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_date2num_masked</span><span class="s2">():</span>
    <span class="s3"># Without tzinfo</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2022</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">15</span><span class="s2">)</span>
    <span class="s1">dates </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">base </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">i</span><span class="s2">))</span>
                         <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">7</span><span class="s2">)], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">npdates </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">getmask</span><span class="s2">(</span><span class="s1">npdates</span><span class="s2">),</span>
                                  <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">,</span>
                                   <span class="s0">True</span><span class="s2">))</span>

    <span class="s3"># With tzinfo</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2022</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">15</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span><span class="s2">)</span>
    <span class="s1">dates </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">base </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=(</span><span class="s4">2 </span><span class="s2">* </span><span class="s1">i</span><span class="s2">))</span>
                         <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">7</span><span class="s2">)], </span><span class="s1">mask</span><span class="s2">=[</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">])</span>
    <span class="s1">npdates </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_array_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">getmask</span><span class="s2">(</span><span class="s1">npdates</span><span class="s2">),</span>
                                  <span class="s2">(</span><span class="s0">False</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">, </span><span class="s0">False</span><span class="s2">,</span>
                                   <span class="s0">True</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_date_empty</span><span class="s2">():</span>
    <span class="s3"># make sure we do the right thing when told to plot dates even</span>
    <span class="s3"># if no date data has been presented, cf</span>
    <span class="s3"># http://sourceforge.net/tracker/?func=detail&amp;aid=2850075&amp;group_id=80706&amp;atid=560720</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis_date</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(),</span>
                               <span class="s2">[</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'1970-01-01'</span><span class="s2">)),</span>
                                <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'1970-01-02'</span><span class="s2">))])</span>

    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">set_epoch</span><span class="s2">(</span><span class="s5">'0000-12-31'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis_date</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(),</span>
                               <span class="s2">[</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'1970-01-01'</span><span class="s2">)),</span>
                                <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'1970-01-02'</span><span class="s2">))])</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_date_not_empty</span><span class="s2">():</span>
    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">fig</span><span class="s2">.</span><span class="s1">add_subplot</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s4">50</span><span class="s2">, </span><span class="s4">70</span><span class="s2">], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">axis_date</span><span class="s2">()</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(), [</span><span class="s4">50</span><span class="s2">, </span><span class="s4">70</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">test_axhline</span><span class="s2">():</span>
    <span class="s3"># make sure that axhline doesn't set the xlimits...</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s4">1.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2016-01-01'</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2016-01-02'</span><span class="s2">)], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(),</span>
                               <span class="s2">[</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2016-01-01'</span><span class="s2">)),</span>
                                <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2016-01-02'</span><span class="s2">))])</span>

    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">set_epoch</span><span class="s2">(</span><span class="s5">'0000-12-31'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s4">1.5</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2016-01-01'</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2016-01-02'</span><span class="s2">)], [</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">])</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">(),</span>
                               <span class="s2">[</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2016-01-01'</span><span class="s2">)),</span>
                                <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2016-01-02'</span><span class="s2">))])</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'date_axhspan.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date_axhspan</span><span class="s2">():</span>
    <span class="s3"># test axhspan with date inputs</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2009</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2009</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">21</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhspan</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">tf</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">&quot;blue&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.25</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">t0 </span><span class="s2">- </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">5</span><span class="s2">),</span>
                <span class="s1">tf </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">5</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s4">0.25</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'date_axvspan.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date_axvspan</span><span class="s2">():</span>
    <span class="s3"># test axvspan with date inputs</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2010</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">21</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvspan</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">tf</span><span class="s2">, </span><span class="s1">facecolor</span><span class="s2">=</span><span class="s5">&quot;blue&quot;</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">=</span><span class="s4">0.25</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">t0 </span><span class="s2">- </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">720</span><span class="s2">),</span>
                <span class="s1">tf </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">720</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">autofmt_xdate</span><span class="s2">()</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'date_axhline.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date_axhline</span><span class="s2">():</span>
    <span class="s3"># test axhline with date inputs</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2009</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2009</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">31</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">&quot;blue&quot;</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">t0 </span><span class="s2">- </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">5</span><span class="s2">),</span>
                <span class="s1">tf </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">5</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s4">0.25</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'date_axvline.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date_axvline</span><span class="s2">():</span>
    <span class="s3"># test axvline with date inputs</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">21</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axvline</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">&quot;red&quot;</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">t0 </span><span class="s2">- </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">5</span><span class="s2">),</span>
                <span class="s1">tf </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">5</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">autofmt_xdate</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_too_many_date_ticks</span><span class="s2">(</span><span class="s1">caplog</span><span class="s2">):</span>
    <span class="s3"># Attempt to test SF 2715172, see</span>
    <span class="s3"># https://sourceforge.net/tracker/?func=detail&amp;aid=2715172&amp;group_id=80706&amp;atid=560720</span>
    <span class="s3"># setting equal datetimes triggers and expander call in</span>
    <span class="s3"># transforms.nonsingular which results in too many ticks in the</span>
    <span class="s3"># DayLocator.  This should emit a log at WARNING level.</span>
    <span class="s1">caplog</span><span class="s2">.</span><span class="s1">set_level</span><span class="s2">(</span><span class="s5">&quot;WARNING&quot;</span><span class="s2">)</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">) </span><span class="s0">as </span><span class="s1">rec</span><span class="s2">:</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">((</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">tf</span><span class="s2">), </span><span class="s1">auto</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">rec</span><span class="s2">) == </span><span class="s4">1</span>
        <span class="s0">assert </span><span class="s2">(</span><span class="s5">'Attempting to set identical low and high xlims'</span>
                <span class="s0">in </span><span class="s1">str</span><span class="s2">(</span><span class="s1">rec</span><span class="s2">[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">message</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([], [])</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">DayLocator</span><span class="s2">())</span>
    <span class="s1">v </span><span class="s2">= </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">get_major_locator</span><span class="s2">()()</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">v</span><span class="s2">) &gt; </span><span class="s4">1000</span>
    <span class="s3"># The warning is emitted multiple times because the major locator is also</span>
    <span class="s3"># called both when placing the minor ticks (for overstriking detection) and</span>
    <span class="s3"># during tick label positioning.</span>
    <span class="s0">assert </span><span class="s1">caplog</span><span class="s2">.</span><span class="s1">records </span><span class="s0">and </span><span class="s1">all</span><span class="s2">(</span>
        <span class="s1">record</span><span class="s2">.</span><span class="s1">name </span><span class="s2">== </span><span class="s5">&quot;matplotlib.ticker&quot; </span><span class="s0">and </span><span class="s1">record</span><span class="s2">.</span><span class="s1">levelname </span><span class="s2">== </span><span class="s5">&quot;WARNING&quot;</span>
        <span class="s0">for </span><span class="s1">record </span><span class="s0">in </span><span class="s1">caplog</span><span class="s2">.</span><span class="s1">records</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">caplog</span><span class="s2">.</span><span class="s1">records</span><span class="s2">) &gt; </span><span class="s4">0</span>


<span class="s0">def </span><span class="s1">_new_epoch_decorator</span><span class="s2">(</span><span class="s1">thefunc</span><span class="s2">):</span>
    <span class="s2">@</span><span class="s1">functools</span><span class="s2">.</span><span class="s1">wraps</span><span class="s2">(</span><span class="s1">thefunc</span><span class="s2">)</span>
    <span class="s0">def </span><span class="s1">wrapper</span><span class="s2">():</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">set_epoch</span><span class="s2">(</span><span class="s5">'2000-01-01'</span><span class="s2">)</span>
        <span class="s1">thefunc</span><span class="s2">()</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
    <span class="s0">return </span><span class="s1">wrapper</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'RRuleLocator_bounds.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_RRuleLocator</span><span class="s2">():</span>
    <span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units</span><span class="s2">.</span><span class="s1">register</span><span class="s2">()</span>
    <span class="s3"># This will cause the RRuleLocator to go out of bounds when it tries</span>
    <span class="s3"># to add padding to the limits, so we make sure it caps at the correct</span>
    <span class="s3"># boundary values.</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">6000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_autoscale_on</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">tf</span><span class="s2">], [</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">'o'</span><span class="s2">)</span>

    <span class="s1">rrule </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">rrulewrapper</span><span class="s2">(</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">rrule</span><span class="s2">.</span><span class="s1">YEARLY</span><span class="s2">, </span><span class="s1">interval</span><span class="s2">=</span><span class="s4">500</span><span class="s2">)</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">RRuleLocator</span><span class="s2">(</span><span class="s1">rrule</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">))</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale_view</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">autofmt_xdate</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_RRuleLocator_dayrange</span><span class="s2">():</span>
    <span class="s1">loc </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">DayLocator</span><span class="s2">()</span>
    <span class="s1">x1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span><span class="s2">)</span>
    <span class="s1">y1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">16</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span><span class="s2">)</span>
    <span class="s1">loc</span><span class="s2">.</span><span class="s1">tick_values</span><span class="s2">(</span><span class="s1">x1</span><span class="s2">, </span><span class="s1">y1</span><span class="s2">)</span>
    <span class="s3"># On success, no overflow error shall be thrown</span>


<span class="s0">def </span><span class="s1">test_RRuleLocator_close_minmax</span><span class="s2">():</span>
    <span class="s3"># if d1 and d2 are very close together, rrule cannot create</span>
    <span class="s3"># reasonable tick intervals; ensure that this is handled properly</span>
    <span class="s1">rrule </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">rrulewrapper</span><span class="s2">(</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">rrule</span><span class="s2">.</span><span class="s1">SECONDLY</span><span class="s2">, </span><span class="s1">interval</span><span class="s2">=</span><span class="s4">5</span><span class="s2">)</span>
    <span class="s1">loc </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">RRuleLocator</span><span class="s2">(</span><span class="s1">rrule</span><span class="s2">)</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s4">2020</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s4">2020</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">microsecond</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">expected </span><span class="s2">= [</span><span class="s5">'2020-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                <span class="s5">'2020-01-01 00:00:00.000001+00:00'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">map</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">.</span><span class="s1">tick_values</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">)))) == </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'DateFormatter_fractionalSeconds.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_DateFormatter</span><span class="s2">():</span>
    <span class="s0">import </span><span class="s1">matplotlib</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">jpl_units </span><span class="s0">as </span><span class="s1">units</span>
    <span class="s1">units</span><span class="s2">.</span><span class="s1">register</span><span class="s2">()</span>

    <span class="s3"># Lets make sure that DateFormatter will allow us to have tick marks</span>
    <span class="s3"># at intervals of fractional seconds.</span>

    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2001</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2001</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>

    <span class="s1">fig </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">figure</span><span class="s2">()</span>
    <span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplot</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_autoscale_on</span><span class="s2">(</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">tf</span><span class="s2">], [</span><span class="s4">0.0</span><span class="s2">, </span><span class="s4">1.0</span><span class="s2">], </span><span class="s1">marker</span><span class="s2">=</span><span class="s5">'o'</span><span class="s2">)</span>

    <span class="s3"># rrule = mpldates.rrulewrapper( dateutil.rrule.YEARLY, interval=500 )</span>
    <span class="s3"># locator = mpldates.RRuleLocator( rrule )</span>
    <span class="s3"># ax.xaxis.set_major_locator( locator )</span>
    <span class="s3"># ax.xaxis.set_major_formatter( mpldates.AutoDateFormatter(locator) )</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">autoscale_view</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">autofmt_xdate</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_locator_set_formatter</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    Test if setting the locator only will update the AutoDateFormatter to use 
    the new locator. 
    &quot;&quot;&quot;</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">&quot;date.autoformatter.minute&quot;</span><span class="s2">] = </span><span class="s5">&quot;%d %H:%M&quot;</span>
    <span class="s1">t </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2018</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">0</span><span class="s2">),</span>
         <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2018</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">59</span><span class="s2">),</span>
         <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2018</span><span class="s2">, </span><span class="s4">9</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)]</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">MinuteLocator</span><span class="s2">((</span><span class="s4">0</span><span class="s2">, </span><span class="s4">30</span><span class="s2">)))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">ticklabels </span><span class="s2">= [</span><span class="s1">tl</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">tl </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()]</span>
    <span class="s1">expected </span><span class="s2">= [</span><span class="s5">'30 08:00'</span><span class="s2">, </span><span class="s5">'30 08:30'</span><span class="s2">, </span><span class="s5">'30 09:00'</span><span class="s2">,</span>
                <span class="s5">'30 09:30'</span><span class="s2">, </span><span class="s5">'30 10:00'</span><span class="s2">, </span><span class="s5">'30 10:30'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">ticklabels </span><span class="s2">== </span><span class="s1">expected</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">mticker</span><span class="s2">.</span><span class="s1">NullLocator</span><span class="s2">())</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_minor_locator</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">MinuteLocator</span><span class="s2">((</span><span class="s4">5</span><span class="s2">, </span><span class="s4">55</span><span class="s2">)))</span>
    <span class="s1">decoy_loc </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">MinuteLocator</span><span class="s2">((</span><span class="s4">12</span><span class="s2">, </span><span class="s4">27</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_minor_formatter</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateFormatter</span><span class="s2">(</span><span class="s1">decoy_loc</span><span class="s2">))</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_minor_locator</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">MinuteLocator</span><span class="s2">((</span><span class="s4">15</span><span class="s2">, </span><span class="s4">45</span><span class="s2">)))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s1">ticklabels </span><span class="s2">= [</span><span class="s1">tl</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">tl </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">(</span><span class="s1">which</span><span class="s2">=</span><span class="s5">&quot;minor&quot;</span><span class="s2">)]</span>
    <span class="s1">expected </span><span class="s2">= [</span><span class="s5">'30 08:15'</span><span class="s2">, </span><span class="s5">'30 08:45'</span><span class="s2">, </span><span class="s5">'30 09:15'</span><span class="s2">, </span><span class="s5">'30 09:45'</span><span class="s2">, </span><span class="s5">'30 10:15'</span><span class="s2">]</span>
    <span class="s0">assert </span><span class="s1">ticklabels </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_date_formatter_callable</span><span class="s2">():</span>

    <span class="s0">class </span><span class="s1">_Locator</span><span class="s2">:</span>
        <span class="s0">def </span><span class="s1">_get_unit</span><span class="s2">(</span><span class="s1">self</span><span class="s2">): </span><span class="s0">return </span><span class="s2">-</span><span class="s4">11</span>

    <span class="s0">def </span><span class="s1">callable_formatting_function</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">_</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">[</span><span class="s1">dt</span><span class="s2">.</span><span class="s1">strftime</span><span class="s2">(</span><span class="s5">'%d-%m//%Y'</span><span class="s2">) </span><span class="s0">for </span><span class="s1">dt </span><span class="s0">in </span><span class="s1">dates</span><span class="s2">]</span>

    <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateFormatter</span><span class="s2">(</span><span class="s1">_Locator</span><span class="s2">())</span>
    <span class="s1">formatter</span><span class="s2">.</span><span class="s1">scaled</span><span class="s2">[-</span><span class="s4">10</span><span class="s2">] = </span><span class="s1">callable_formatting_function</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2014</span><span class="s2">, </span><span class="s4">12</span><span class="s2">, </span><span class="s4">25</span><span class="s2">)]) == [</span><span class="s5">'25-12//2014'</span><span class="s2">]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'delta, expected'</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">),</span>
     <span class="s2">[</span><span class="s5">r'$\mathdefault{%d}$' </span><span class="s2">% </span><span class="s1">year </span><span class="s0">for </span><span class="s1">year </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1990</span><span class="s2">, </span><span class="s4">2171</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)]),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">30</span><span class="s2">),</span>
     <span class="s2">[</span><span class="s5">r'$\mathdefault{1990{-}01{-}%02d}$' </span><span class="s2">% </span><span class="s1">day </span><span class="s0">for </span><span class="s1">day </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">32</span><span class="s2">, </span><span class="s4">3</span><span class="s2">)]),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">20</span><span class="s2">),</span>
     <span class="s2">[</span><span class="s5">r'$\mathdefault{01{-}01\;%02d}$' </span><span class="s2">% </span><span class="s1">hour </span><span class="s0">for </span><span class="s1">hour </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">21</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)]),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">10</span><span class="s2">),</span>
     <span class="s2">[</span><span class="s5">r'$\mathdefault{01\;00{:}%02d}$' </span><span class="s2">% </span><span class="s1">minu </span><span class="s0">for </span><span class="s1">minu </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">11</span><span class="s2">)]),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date_formatter_usetex</span><span class="s2">(</span><span class="s1">delta</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s1">style</span><span class="s2">.</span><span class="s1">use</span><span class="s2">(</span><span class="s5">&quot;default&quot;</span><span class="s2">)</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1990</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">delta</span>

    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_view_interval</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">), </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">d2</span><span class="s2">))</span>

    <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">, </span><span class="s1">usetex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s2">[</span><span class="s1">formatter</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">) </span><span class="s0">for </span><span class="s1">loc </span><span class="s0">in </span><span class="s1">locator</span><span class="s2">()] == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_drange</span><span class="s2">():</span>
    <span class="s6">&quot;&quot;&quot; 
    This test should check if drange works as expected, and if all the 
    rounding errors are fixed 
    &quot;&quot;&quot;</span>
    <span class="s1">start </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2011</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span><span class="s2">)</span>
    <span class="s1">end </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2011</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span><span class="s2">)</span>
    <span class="s1">delta </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s3"># We expect 24 values in drange(start, end, delta), because drange returns</span>
    <span class="s3"># dates from an half open interval [start, end)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">drange</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)) == </span><span class="s4">24</span>

    <span class="s3"># Same if interval ends slightly earlier</span>
    <span class="s1">end </span><span class="s2">= </span><span class="s1">end </span><span class="s2">- </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">microseconds</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">drange</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)) == </span><span class="s4">24</span>

    <span class="s3"># if end is a little bit later, we expect the range to contain one element</span>
    <span class="s3"># more</span>
    <span class="s1">end </span><span class="s2">= </span><span class="s1">end </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">microseconds</span><span class="s2">=</span><span class="s4">2</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">drange</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)) == </span><span class="s4">25</span>

    <span class="s3"># reset end</span>
    <span class="s1">end </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2011</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span><span class="s2">)</span>

    <span class="s3"># and tst drange with &quot;complicated&quot; floats:</span>
    <span class="s3"># 4 hours = 1/6 day, this is an &quot;dangerous&quot; float</span>
    <span class="s1">delta </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">4</span><span class="s2">)</span>
    <span class="s1">daterange </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">drange</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">len</span><span class="s2">(</span><span class="s1">daterange</span><span class="s2">) == </span><span class="s4">6</span>
    <span class="s0">assert </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s1">daterange</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">]) == (</span><span class="s1">end </span><span class="s2">- </span><span class="s1">delta</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">_new_epoch_decorator</span>
<span class="s0">def </span><span class="s1">test_auto_date_locator</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">):</span>
        <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
        <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
        <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_view_interval</span><span class="s2">(*</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">([</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">]))</span>
        <span class="s0">return </span><span class="s1">locator</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1990</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">results </span><span class="s2">= ([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1990-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2010-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2030-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2050-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2070-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2090-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2110-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2130-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2150-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2170-01-01 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1990-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-02-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-03-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-04-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-05-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-06-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-07-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-08-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-09-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-10-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-11-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-12-01 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">141</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1990-01-05 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-26 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-02-16 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-03-09 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-03-30 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-04-20 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-05-11 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1990-01-03 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-10 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-17 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-24 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-31 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-02-07 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1990-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 04:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 08:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 12:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 16:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 20:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-02 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-02 04:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-02 08:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-02 12:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-02 16:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">20</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1990-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 00:05:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:10:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 00:15:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:20:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1990-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 00:00:05+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:10+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 00:00:15+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:20+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 00:00:25+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:30+00:00'</span><span class="s2">, </span><span class="s5">'1990-01-01 00:00:35+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:40+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">microseconds</span><span class="s2">=</span><span class="s4">1500</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1989-12-31 23:59:59.999500+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:00.000500+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:00.001000+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:00.001500+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1990-01-01 00:00:00.002000+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">)</span>

    <span class="s0">for </span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results</span><span class="s2">:</span>
        <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>
        <span class="s1">locator </span><span class="s2">= </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">map</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">()))) == </span><span class="s1">expected</span>

    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">maxticks </span><span class="s2">== {</span><span class="s4">0</span><span class="s2">: </span><span class="s4">11</span><span class="s2">, </span><span class="s4">1</span><span class="s2">: </span><span class="s4">12</span><span class="s2">, </span><span class="s4">3</span><span class="s2">: </span><span class="s4">11</span><span class="s2">, </span><span class="s4">4</span><span class="s2">: </span><span class="s4">12</span><span class="s2">, </span><span class="s4">5</span><span class="s2">: </span><span class="s4">11</span><span class="s2">, </span><span class="s4">6</span><span class="s2">: </span><span class="s4">11</span><span class="s2">, </span><span class="s4">7</span><span class="s2">: </span><span class="s4">8</span><span class="s2">}</span>

    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">maxticks</span><span class="s2">={</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">rrule</span><span class="s2">.</span><span class="s1">MONTHLY</span><span class="s2">: </span><span class="s4">5</span><span class="s2">})</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">maxticks </span><span class="s2">== {</span><span class="s4">0</span><span class="s2">: </span><span class="s4">11</span><span class="s2">, </span><span class="s4">1</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">: </span><span class="s4">11</span><span class="s2">, </span><span class="s4">4</span><span class="s2">: </span><span class="s4">12</span><span class="s2">, </span><span class="s4">5</span><span class="s2">: </span><span class="s4">11</span><span class="s2">, </span><span class="s4">6</span><span class="s2">: </span><span class="s4">11</span><span class="s2">, </span><span class="s4">7</span><span class="s2">: </span><span class="s4">8</span><span class="s2">}</span>

    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">maxticks</span><span class="s2">=</span><span class="s4">5</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">maxticks </span><span class="s2">== {</span><span class="s4">0</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s4">1</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s4">3</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s4">4</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s4">5</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s4">6</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s4">7</span><span class="s2">: </span><span class="s4">5</span><span class="s2">}</span>


<span class="s2">@</span><span class="s1">_new_epoch_decorator</span>
<span class="s0">def </span><span class="s1">test_auto_date_locator_intmult</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">):</span>
        <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
        <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_view_interval</span><span class="s2">(*</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">([</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">]))</span>
        <span class="s0">return </span><span class="s1">locator</span>

    <span class="s1">results </span><span class="s2">= ([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1980-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2000-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2020-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2040-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2060-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2080-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2100-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2120-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2140-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2160-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2180-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2200-01-01 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-02-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-03-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-04-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-05-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-06-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-07-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-08-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-09-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-10-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-11-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-12-01 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">141</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-15 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-02-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-02-15 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-03-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-03-15 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-04-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-04-15 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-05-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-05-15 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-05 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-09 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-13 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-17 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-21 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-25 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-29 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-02-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-02-05 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-02-09 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 04:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 08:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 12:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 16:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 20:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-02 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-02 04:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-02 08:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-02 12:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-02 16:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">20</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:05:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:10:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:15:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:20:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:00:05+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:10+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:00:15+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:20+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:00:25+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:30+00:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:00:35+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:40+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">microseconds</span><span class="s2">=</span><span class="s4">1500</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1996-12-31 23:59:59.999500+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:00.000500+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:00.001000+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:00.001500+00:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:00.002000+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">)</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results</span><span class="s2">:</span>
        <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>
        <span class="s1">locator </span><span class="s2">= </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">map</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">()))) == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_subsecond</span><span class="s2">():</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
    <span class="s1">year_1996 </span><span class="s2">= </span><span class="s4">9861.0</span>
    <span class="s1">strings </span><span class="s2">= </span><span class="s1">formatter</span><span class="s2">.</span><span class="s1">format_ticks</span><span class="s2">([</span>
        <span class="s1">year_1996</span><span class="s2">,</span>
        <span class="s1">year_1996 </span><span class="s2">+ </span><span class="s4">500 </span><span class="s2">/ </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">MUSECONDS_PER_DAY</span><span class="s2">,</span>
        <span class="s1">year_1996 </span><span class="s2">+ </span><span class="s4">900 </span><span class="s2">/ </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">MUSECONDS_PER_DAY</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">strings </span><span class="s2">== [</span><span class="s5">'00:00'</span><span class="s2">, </span><span class="s5">'00.0005'</span><span class="s2">, </span><span class="s5">'00.0009'</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">test_concise_formatter</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

        <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">sts </span><span class="s2">= [</span><span class="s1">st</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">st </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()]</span>
        <span class="s0">return </span><span class="s1">sts</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">results </span><span class="s2">= ([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s1">str</span><span class="s2">(</span><span class="s1">t</span><span class="s2">) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1980</span><span class="s2">, </span><span class="s4">2201</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997'</span><span class="s2">, </span><span class="s5">'Feb'</span><span class="s2">, </span><span class="s5">'Mar'</span><span class="s2">, </span><span class="s5">'Apr'</span><span class="s2">, </span><span class="s5">'May'</span><span class="s2">, </span><span class="s5">'Jun'</span><span class="s2">, </span><span class="s5">'Jul'</span><span class="s2">, </span><span class="s5">'Aug'</span><span class="s2">,</span>
                 <span class="s5">'Sep'</span><span class="s2">, </span><span class="s5">'Oct'</span><span class="s2">, </span><span class="s5">'Nov'</span><span class="s2">, </span><span class="s5">'Dec'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">141</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'Jan'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'Feb'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'Mar'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'Apr'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">,</span>
                 <span class="s5">'May'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'Jan'</span><span class="s2">, </span><span class="s5">'05'</span><span class="s2">, </span><span class="s5">'09'</span><span class="s2">, </span><span class="s5">'13'</span><span class="s2">, </span><span class="s5">'17'</span><span class="s2">, </span><span class="s5">'21'</span><span class="s2">, </span><span class="s5">'25'</span><span class="s2">, </span><span class="s5">'29'</span><span class="s2">, </span><span class="s5">'Feb'</span><span class="s2">,</span>
                 <span class="s5">'05'</span><span class="s2">, </span><span class="s5">'09'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'Jan-01'</span><span class="s2">, </span><span class="s5">'04:00'</span><span class="s2">, </span><span class="s5">'08:00'</span><span class="s2">, </span><span class="s5">'12:00'</span><span class="s2">, </span><span class="s5">'16:00'</span><span class="s2">, </span><span class="s5">'20:00'</span><span class="s2">,</span>
                 <span class="s5">'Jan-02'</span><span class="s2">, </span><span class="s5">'04:00'</span><span class="s2">, </span><span class="s5">'08:00'</span><span class="s2">, </span><span class="s5">'12:00'</span><span class="s2">, </span><span class="s5">'16:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">20</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'00:00'</span><span class="s2">, </span><span class="s5">'00:05'</span><span class="s2">, </span><span class="s5">'00:10'</span><span class="s2">, </span><span class="s5">'00:15'</span><span class="s2">, </span><span class="s5">'00:20'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'00:00'</span><span class="s2">, </span><span class="s5">'05'</span><span class="s2">, </span><span class="s5">'10'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'20'</span><span class="s2">, </span><span class="s5">'25'</span><span class="s2">, </span><span class="s5">'30'</span><span class="s2">, </span><span class="s5">'35'</span><span class="s2">, </span><span class="s5">'40'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">2</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'59.5'</span><span class="s2">, </span><span class="s5">'00:00'</span><span class="s2">, </span><span class="s5">'00.5'</span><span class="s2">, </span><span class="s5">'01.0'</span><span class="s2">, </span><span class="s5">'01.5'</span><span class="s2">, </span><span class="s5">'02.0'</span><span class="s2">, </span><span class="s5">'02.5'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results</span><span class="s2">:</span>
        <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>
        <span class="s1">strings </span><span class="s2">= </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">strings </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'t_delta, expected'</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">0.01</span><span class="s2">), </span><span class="s5">'1997-Jan-01 00:00'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">1</span><span class="s2">), </span><span class="s5">'1997-Jan-01 00:01'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">1</span><span class="s2">), </span><span class="s5">'1997-Jan-01'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">1</span><span class="s2">), </span><span class="s5">'1997-Jan-02'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">1</span><span class="s2">), </span><span class="s5">'1997-Jan'</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">26</span><span class="s2">), </span><span class="s5">''</span><span class="s2">),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">520</span><span class="s2">), </span><span class="s5">''</span><span class="s2">)</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_concise_formatter_show_offset</span><span class="s2">(</span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">()</span>
    <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">.</span><span class="s1">get_offset</span><span class="s2">() == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_concise_converter_stays</span><span class="s2">():</span>
    <span class="s3"># This test demonstrates problems introduced by gh-23417 (reverted in gh-25278)</span>
    <span class="s3"># In particular, downstream libraries like Pandas had their designated converters</span>
    <span class="s3"># overridden by actions like setting xlim (or plotting additional points using</span>
    <span class="s3"># stdlib/numpy dates and string date representation, which otherwise work fine with</span>
    <span class="s3"># their date converters)</span>
    <span class="s3"># While this is a bit of a toy example that would be unusual to see it demonstrates</span>
    <span class="s3"># the same ideas (namely having a valid converter already applied that is desired)</span>
    <span class="s3"># without introducing additional subclasses.</span>
    <span class="s3"># See also discussion at gh-25219 for how Pandas was affected</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2000</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2020</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)]</span>
    <span class="s1">y </span><span class="s2">= [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">]</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">)</span>
    <span class="s3"># Bypass Switchable date converter</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">converter </span><span class="s2">= </span><span class="s1">conv </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateConverter</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">units </span><span class="s0">is None</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(*</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">converter </span><span class="s2">== </span><span class="s1">conv</span>


<span class="s0">def </span><span class="s1">test_offset_changes</span><span class="s2">():</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">520</span><span class="s2">)</span>

    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">()</span>
    <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">xaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">)</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">([</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">], [</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">])</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">.</span><span class="s1">get_offset</span><span class="s2">() == </span><span class="s5">''</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">3</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">.</span><span class="s1">get_offset</span><span class="s2">() == </span><span class="s5">'1997-Jan'</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">7</span><span class="s2">),</span>
                <span class="s1">d1 </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">30</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">.</span><span class="s1">get_offset</span><span class="s2">() == </span><span class="s5">'1997'</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_xlim</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">520</span><span class="s2">))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">draw_without_rendering</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">.</span><span class="s1">get_offset</span><span class="s2">() == </span><span class="s5">''</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'t_delta, expected'</span><span class="s2">, [</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">),</span>
     <span class="s2">[</span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{%d}$' </span><span class="s2">% (</span><span class="s1">t</span><span class="s2">, ) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1980</span><span class="s2">, </span><span class="s4">2201</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)]),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
     <span class="s2">[</span><span class="s5">'Jan'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{05}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{09}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{13}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{17}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{21}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{25}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{29}$'</span><span class="s2">, </span><span class="s5">'Feb'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{05}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{09}$'</span><span class="s2">]),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
     <span class="s2">[</span><span class="s5">'Jan$</span><span class="s0">\\</span><span class="s5">mathdefault{{-}01}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{04{:}00}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{08{:}00}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{12{:}00}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{16{:}00}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{20{:}00}$'</span><span class="s2">,</span>
      <span class="s5">'Jan$</span><span class="s0">\\</span><span class="s5">mathdefault{{-}02}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{04{:}00}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{08{:}00}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{12{:}00}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{16{:}00}$'</span><span class="s2">]),</span>
    <span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">2</span><span class="s2">),</span>
     <span class="s2">[</span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{59.5}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{00{:}00}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{00.5}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{01.0}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{01.5}$'</span><span class="s2">, </span><span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{02.0}$'</span><span class="s2">,</span>
      <span class="s5">'$</span><span class="s0">\\</span><span class="s5">mathdefault{02.5}$'</span><span class="s2">]),</span>
<span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_concise_formatter_usetex</span><span class="s2">(</span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">):</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>

    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_view_interval</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">), </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">d2</span><span class="s2">))</span>

    <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">, </span><span class="s1">usetex</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">.</span><span class="s1">format_ticks</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">()) == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_formats</span><span class="s2">():</span>
    <span class="s1">formats </span><span class="s2">= [</span><span class="s5">'%Y'</span><span class="s2">, </span><span class="s5">'%m/%Y'</span><span class="s2">, </span><span class="s5">'day: %d'</span><span class="s2">,</span>
               <span class="s5">'%H hr %M min'</span><span class="s2">, </span><span class="s5">'%H hr %M min'</span><span class="s2">, </span><span class="s5">'%S.%f sec'</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

        <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">, </span><span class="s1">formats</span><span class="s2">=</span><span class="s1">formats</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">sts </span><span class="s2">= [</span><span class="s1">st</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">st </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()]</span>
        <span class="s0">return </span><span class="s1">sts</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">results </span><span class="s2">= (</span>
        <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">), [</span><span class="s1">str</span><span class="s2">(</span><span class="s1">t</span><span class="s2">) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1980</span><span class="s2">,</span>
         <span class="s4">2201</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)]],</span>
        <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52</span><span class="s2">), [</span>
            <span class="s5">'1997'</span><span class="s2">, </span><span class="s5">'02/1997'</span><span class="s2">, </span><span class="s5">'03/1997'</span><span class="s2">, </span><span class="s5">'04/1997'</span><span class="s2">, </span><span class="s5">'05/1997'</span><span class="s2">, </span><span class="s5">'06/1997'</span><span class="s2">,</span>
            <span class="s5">'07/1997'</span><span class="s2">, </span><span class="s5">'08/1997'</span><span class="s2">, </span><span class="s5">'09/1997'</span><span class="s2">, </span><span class="s5">'10/1997'</span><span class="s2">, </span><span class="s5">'11/1997'</span><span class="s2">, </span><span class="s5">'12/1997'</span><span class="s2">,</span>
            <span class="s2">]],</span>
        <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">141</span><span class="s2">), [</span>
            <span class="s5">'01/1997'</span><span class="s2">, </span><span class="s5">'day: 15'</span><span class="s2">, </span><span class="s5">'02/1997'</span><span class="s2">, </span><span class="s5">'day: 15'</span><span class="s2">, </span><span class="s5">'03/1997'</span><span class="s2">, </span><span class="s5">'day: 15'</span><span class="s2">,</span>
            <span class="s5">'04/1997'</span><span class="s2">, </span><span class="s5">'day: 15'</span><span class="s2">, </span><span class="s5">'05/1997'</span><span class="s2">, </span><span class="s5">'day: 15'</span><span class="s2">,</span>
            <span class="s2">]],</span>
        <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">40</span><span class="s2">), [</span>
            <span class="s5">'01/1997'</span><span class="s2">, </span><span class="s5">'day: 05'</span><span class="s2">, </span><span class="s5">'day: 09'</span><span class="s2">, </span><span class="s5">'day: 13'</span><span class="s2">, </span><span class="s5">'day: 17'</span><span class="s2">, </span><span class="s5">'day: 21'</span><span class="s2">,</span>
            <span class="s5">'day: 25'</span><span class="s2">, </span><span class="s5">'day: 29'</span><span class="s2">, </span><span class="s5">'02/1997'</span><span class="s2">, </span><span class="s5">'day: 05'</span><span class="s2">, </span><span class="s5">'day: 09'</span><span class="s2">,</span>
            <span class="s2">]],</span>
        <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">40</span><span class="s2">), [</span>
            <span class="s5">'day: 01'</span><span class="s2">, </span><span class="s5">'04 hr 00 min'</span><span class="s2">, </span><span class="s5">'08 hr 00 min'</span><span class="s2">, </span><span class="s5">'12 hr 00 min'</span><span class="s2">,</span>
            <span class="s5">'16 hr 00 min'</span><span class="s2">, </span><span class="s5">'20 hr 00 min'</span><span class="s2">, </span><span class="s5">'day: 02'</span><span class="s2">, </span><span class="s5">'04 hr 00 min'</span><span class="s2">,</span>
            <span class="s5">'08 hr 00 min'</span><span class="s2">, </span><span class="s5">'12 hr 00 min'</span><span class="s2">, </span><span class="s5">'16 hr 00 min'</span><span class="s2">,</span>
            <span class="s2">]],</span>
        <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">20</span><span class="s2">), [</span><span class="s5">'00 hr 00 min'</span><span class="s2">, </span><span class="s5">'00 hr 05 min'</span><span class="s2">,</span>
         <span class="s5">'00 hr 10 min'</span><span class="s2">, </span><span class="s5">'00 hr 15 min'</span><span class="s2">, </span><span class="s5">'00 hr 20 min'</span><span class="s2">]],</span>
        <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">40</span><span class="s2">), [</span>
            <span class="s5">'00 hr 00 min'</span><span class="s2">, </span><span class="s5">'05.000000 sec'</span><span class="s2">, </span><span class="s5">'10.000000 sec'</span><span class="s2">,</span>
            <span class="s5">'15.000000 sec'</span><span class="s2">, </span><span class="s5">'20.000000 sec'</span><span class="s2">, </span><span class="s5">'25.000000 sec'</span><span class="s2">,</span>
            <span class="s5">'30.000000 sec'</span><span class="s2">, </span><span class="s5">'35.000000 sec'</span><span class="s2">, </span><span class="s5">'40.000000 sec'</span><span class="s2">,</span>
            <span class="s2">]],</span>
        <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">2</span><span class="s2">), [</span>
            <span class="s5">'59.500000 sec'</span><span class="s2">, </span><span class="s5">'00 hr 00 min'</span><span class="s2">, </span><span class="s5">'00.500000 sec'</span><span class="s2">, </span><span class="s5">'01.000000 sec'</span><span class="s2">,</span>
            <span class="s5">'01.500000 sec'</span><span class="s2">, </span><span class="s5">'02.000000 sec'</span><span class="s2">, </span><span class="s5">'02.500000 sec'</span><span class="s2">,</span>
            <span class="s2">]],</span>
        <span class="s2">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results</span><span class="s2">:</span>
        <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>
        <span class="s1">strings </span><span class="s2">= </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">strings </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_zformats</span><span class="s2">():</span>
    <span class="s1">zero_formats </span><span class="s2">= [</span><span class="s5">''</span><span class="s2">, </span><span class="s5">&quot;'%y&quot;</span><span class="s2">, </span><span class="s5">'%B'</span><span class="s2">, </span><span class="s5">'%m-%d'</span><span class="s2">, </span><span class="s5">'%S'</span><span class="s2">, </span><span class="s5">'%S.%f'</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

        <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span>
            <span class="s1">locator</span><span class="s2">, </span><span class="s1">zero_formats</span><span class="s2">=</span><span class="s1">zero_formats</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">sts </span><span class="s2">= [</span><span class="s1">st</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">st </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()]</span>
        <span class="s0">return </span><span class="s1">sts</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">results </span><span class="s2">= ([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s1">str</span><span class="s2">(</span><span class="s1">t</span><span class="s2">) </span><span class="s0">for </span><span class="s1">t </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1980</span><span class="s2">, </span><span class="s4">2201</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">&quot;'97&quot;</span><span class="s2">, </span><span class="s5">'Feb'</span><span class="s2">, </span><span class="s5">'Mar'</span><span class="s2">, </span><span class="s5">'Apr'</span><span class="s2">, </span><span class="s5">'May'</span><span class="s2">, </span><span class="s5">'Jun'</span><span class="s2">,</span>
                    <span class="s5">'Jul'</span><span class="s2">, </span><span class="s5">'Aug'</span><span class="s2">, </span><span class="s5">'Sep'</span><span class="s2">, </span><span class="s5">'Oct'</span><span class="s2">, </span><span class="s5">'Nov'</span><span class="s2">, </span><span class="s5">'Dec'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">141</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'January'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'February'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'March'</span><span class="s2">,</span>
                    <span class="s5">'15'</span><span class="s2">, </span><span class="s5">'April'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'May'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'January'</span><span class="s2">, </span><span class="s5">'05'</span><span class="s2">, </span><span class="s5">'09'</span><span class="s2">, </span><span class="s5">'13'</span><span class="s2">, </span><span class="s5">'17'</span><span class="s2">, </span><span class="s5">'21'</span><span class="s2">,</span>
                    <span class="s5">'25'</span><span class="s2">, </span><span class="s5">'29'</span><span class="s2">, </span><span class="s5">'February'</span><span class="s2">, </span><span class="s5">'05'</span><span class="s2">, </span><span class="s5">'09'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'01-01'</span><span class="s2">, </span><span class="s5">'04:00'</span><span class="s2">, </span><span class="s5">'08:00'</span><span class="s2">, </span><span class="s5">'12:00'</span><span class="s2">, </span><span class="s5">'16:00'</span><span class="s2">, </span><span class="s5">'20:00'</span><span class="s2">,</span>
                    <span class="s5">'01-02'</span><span class="s2">, </span><span class="s5">'04:00'</span><span class="s2">, </span><span class="s5">'08:00'</span><span class="s2">, </span><span class="s5">'12:00'</span><span class="s2">, </span><span class="s5">'16:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">20</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'00'</span><span class="s2">, </span><span class="s5">'00:05'</span><span class="s2">, </span><span class="s5">'00:10'</span><span class="s2">, </span><span class="s5">'00:15'</span><span class="s2">, </span><span class="s5">'00:20'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'00'</span><span class="s2">, </span><span class="s5">'05'</span><span class="s2">, </span><span class="s5">'10'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'20'</span><span class="s2">, </span><span class="s5">'25'</span><span class="s2">, </span><span class="s5">'30'</span><span class="s2">, </span><span class="s5">'35'</span><span class="s2">, </span><span class="s5">'40'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">2</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'59.5'</span><span class="s2">, </span><span class="s5">'00.0'</span><span class="s2">, </span><span class="s5">'00.5'</span><span class="s2">, </span><span class="s5">'01.0'</span><span class="s2">, </span><span class="s5">'01.5'</span><span class="s2">, </span><span class="s5">'02.0'</span><span class="s2">, </span><span class="s5">'02.5'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results</span><span class="s2">:</span>
        <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>
        <span class="s1">strings </span><span class="s2">= </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">strings </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_tz</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">):</span>
        <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

        <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">)</span>
        <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_locator</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">set_major_formatter</span><span class="s2">(</span><span class="s1">formatter</span><span class="s2">)</span>
        <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">)</span>
        <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
        <span class="s1">sts </span><span class="s2">= [</span><span class="s1">st</span><span class="s2">.</span><span class="s1">get_text</span><span class="s2">() </span><span class="s0">for </span><span class="s1">st </span><span class="s0">in </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_yticklabels</span><span class="s2">()]</span>
        <span class="s0">return </span><span class="s1">sts</span><span class="s2">, </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">yaxis</span><span class="s2">.</span><span class="s1">get_offset_text</span><span class="s2">().</span><span class="s1">get_text</span><span class="s2">()</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">.</span><span class="s1">utc</span><span class="s2">)</span>
    <span class="s1">results </span><span class="s2">= ([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'03:00'</span><span class="s2">, </span><span class="s5">'07:00'</span><span class="s2">, </span><span class="s5">'11:00'</span><span class="s2">, </span><span class="s5">'15:00'</span><span class="s2">, </span><span class="s5">'19:00'</span><span class="s2">, </span><span class="s5">'23:00'</span><span class="s2">,</span>
                 <span class="s5">'03:00'</span><span class="s2">, </span><span class="s5">'07:00'</span><span class="s2">, </span><span class="s5">'11:00'</span><span class="s2">, </span><span class="s5">'15:00'</span><span class="s2">, </span><span class="s5">'19:00'</span><span class="s2">],</span>
                <span class="s5">&quot;1997-Jan-02&quot;</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">20</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'03:00'</span><span class="s2">, </span><span class="s5">'03:05'</span><span class="s2">, </span><span class="s5">'03:10'</span><span class="s2">, </span><span class="s5">'03:15'</span><span class="s2">, </span><span class="s5">'03:20'</span><span class="s2">],</span>
                <span class="s5">&quot;1997-Jan-01&quot;</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'03:00'</span><span class="s2">, </span><span class="s5">'05'</span><span class="s2">, </span><span class="s5">'10'</span><span class="s2">, </span><span class="s5">'15'</span><span class="s2">, </span><span class="s5">'20'</span><span class="s2">, </span><span class="s5">'25'</span><span class="s2">, </span><span class="s5">'30'</span><span class="s2">, </span><span class="s5">'35'</span><span class="s2">, </span><span class="s5">'40'</span><span class="s2">],</span>
                <span class="s5">&quot;1997-Jan-01 03:00&quot;</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">2</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'59.5'</span><span class="s2">, </span><span class="s5">'03:00'</span><span class="s2">, </span><span class="s5">'00.5'</span><span class="s2">, </span><span class="s5">'01.0'</span><span class="s2">, </span><span class="s5">'01.5'</span><span class="s2">, </span><span class="s5">'02.0'</span><span class="s2">, </span><span class="s5">'02.5'</span><span class="s2">],</span>
                <span class="s5">&quot;1997-Jan-01 03:00&quot;</span>
                <span class="s2">],</span>
               <span class="s2">)</span>

    <span class="s1">new_tz </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">3</span><span class="s2">))</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected_strings</span><span class="s2">, </span><span class="s1">expected_offset </span><span class="s0">in </span><span class="s1">results</span><span class="s2">:</span>
        <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>
        <span class="s1">strings</span><span class="s2">, </span><span class="s1">offset </span><span class="s2">= </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">, </span><span class="s1">new_tz</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">strings </span><span class="s2">== </span><span class="s1">expected_strings</span>
        <span class="s0">assert </span><span class="s1">offset </span><span class="s2">== </span><span class="s1">expected_offset</span>


<span class="s0">def </span><span class="s1">test_auto_date_locator_intmult_tz</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">):</span>
        <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
        <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
        <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_view_interval</span><span class="s2">(*</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">([</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">]))</span>
        <span class="s0">return </span><span class="s1">locator</span>

    <span class="s1">results </span><span class="s2">= ([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52</span><span class="s2">*</span><span class="s4">200</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1980-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'2000-01-01 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'2020-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'2040-01-01 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'2060-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'2080-01-01 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'2100-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'2120-01-01 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'2140-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'2160-01-01 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'2180-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'2200-01-01 00:00:00-08:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-02-01 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-03-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-04-01 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-05-01 00:00:00-07:00'</span><span class="s2">, </span><span class="s5">'1997-06-01 00:00:00-07:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-07-01 00:00:00-07:00'</span><span class="s2">, </span><span class="s5">'1997-08-01 00:00:00-07:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-09-01 00:00:00-07:00'</span><span class="s2">, </span><span class="s5">'1997-10-01 00:00:00-07:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-11-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-12-01 00:00:00-08:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">141</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-15 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-02-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-02-15 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-03-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-03-15 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-04-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-04-15 00:00:00-07:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-05-01 00:00:00-07:00'</span><span class="s2">, </span><span class="s5">'1997-05-15 00:00:00-07:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-05 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-09 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-13 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-17 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-21 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-25 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-29 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-02-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-02-05 00:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-02-09 00:00:00-08:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">hours</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 04:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 08:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 12:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 16:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 20:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-02 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-02 04:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-02 08:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-02 12:00:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-02 16:00:00-08:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">20</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:05:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:10:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:15:00-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:20:00-08:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">40</span><span class="s2">),</span>
                <span class="s2">[</span><span class="s5">'1997-01-01 00:00:00-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:00:05-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:10-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:00:15-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:20-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:00:25-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:30-08:00'</span><span class="s2">, </span><span class="s5">'1997-01-01 00:00:35-08:00'</span><span class="s2">,</span>
                 <span class="s5">'1997-01-01 00:00:40-08:00'</span><span class="s2">]</span>
                <span class="s2">]</span>
               <span class="s2">)</span>

    <span class="s1">tz </span><span class="s2">= </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">(</span><span class="s5">'Canada/Pacific'</span><span class="s2">)</span>
    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1997</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
    <span class="s0">for </span><span class="s1">t_delta</span><span class="s2">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">rc_context</span><span class="s2">({</span><span class="s5">'_internal.classic_mode'</span><span class="s2">: </span><span class="s0">False</span><span class="s2">}):</span>
            <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">t_delta</span>
            <span class="s1">locator </span><span class="s2">= </span><span class="s1">_create_auto_date_locator</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">)</span>
            <span class="s1">st </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">map</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">(), </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)))</span>
            <span class="s0">assert </span><span class="s1">st </span><span class="s2">== </span><span class="s1">expected</span>


<span class="s2">@</span><span class="s1">image_comparison</span><span class="s2">([</span><span class="s5">'date_inverted_limit.png'</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_date_inverted_limit</span><span class="s2">():</span>
    <span class="s3"># test ax hline with date inputs</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2009</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">20</span><span class="s2">)</span>
    <span class="s1">tf </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2009</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">31</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">axhline</span><span class="s2">(</span><span class="s1">t0</span><span class="s2">, </span><span class="s1">color</span><span class="s2">=</span><span class="s5">&quot;blue&quot;</span><span class="s2">, </span><span class="s1">lw</span><span class="s2">=</span><span class="s4">3</span><span class="s2">)</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">set_ylim</span><span class="s2">(</span><span class="s1">t0 </span><span class="s2">- </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">5</span><span class="s2">),</span>
                <span class="s1">tf </span><span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">5</span><span class="s2">))</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">invert_yaxis</span><span class="s2">()</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">subplots_adjust</span><span class="s2">(</span><span class="s1">left</span><span class="s2">=</span><span class="s4">0.25</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">_test_date2num_dst</span><span class="s2">(</span><span class="s1">date_range</span><span class="s2">, </span><span class="s1">tz_convert</span><span class="s2">):</span>
    <span class="s3"># Timezones</span>

    <span class="s1">BRUSSELS </span><span class="s2">= </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">(</span><span class="s5">'Europe/Brussels'</span><span class="s2">)</span>
    <span class="s1">UTC </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span>

    <span class="s3"># Create a list of timezone-aware datetime objects in UTC</span>
    <span class="s3"># Interval is 0b0.0000011 days, to prevent float rounding issues</span>
    <span class="s1">dtstart </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2014</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">30</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">UTC</span><span class="s2">)</span>
    <span class="s1">interval </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">minutes</span><span class="s2">=</span><span class="s4">33</span><span class="s2">, </span><span class="s1">seconds</span><span class="s2">=</span><span class="s4">45</span><span class="s2">)</span>
    <span class="s1">interval_days </span><span class="s2">= </span><span class="s1">interval</span><span class="s2">.</span><span class="s1">seconds </span><span class="s2">/ </span><span class="s4">86400</span>
    <span class="s1">N </span><span class="s2">= </span><span class="s4">8</span>

    <span class="s1">dt_utc </span><span class="s2">= </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">=</span><span class="s1">dtstart</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">=</span><span class="s1">interval</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">=</span><span class="s1">N</span><span class="s2">)</span>
    <span class="s1">dt_bxl </span><span class="s2">= </span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s1">dt_utc</span><span class="s2">, </span><span class="s1">BRUSSELS</span><span class="s2">)</span>
    <span class="s1">t0 </span><span class="s2">= </span><span class="s4">735322.0 </span><span class="s2">+ </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'0000-12-31'</span><span class="s2">))</span>
    <span class="s1">expected_ordinalf </span><span class="s2">= [</span><span class="s1">t0 </span><span class="s2">+ (</span><span class="s1">i </span><span class="s2">* </span><span class="s1">interval_days</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">N</span><span class="s2">)]</span>
    <span class="s1">actual_ordinalf </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">dt_bxl</span><span class="s2">))</span>

    <span class="s0">assert </span><span class="s1">actual_ordinalf </span><span class="s2">== </span><span class="s1">expected_ordinalf</span>


<span class="s0">def </span><span class="s1">test_date2num_dst</span><span class="s2">():</span>
    <span class="s3"># Test for github issue #3896, but in date2num around DST transitions</span>
    <span class="s3"># with a timezone-aware pandas date_range object.</span>

    <span class="s0">class </span><span class="s1">dt_tzaware</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">):</span>
        <span class="s6">&quot;&quot;&quot; 
        This bug specifically occurs because of the normalization behavior of 
        pandas Timestamp objects, so in order to replicate it, we need a 
        datetime-like object that applies timezone normalization after 
        subtraction. 
        &quot;&quot;&quot;</span>

        <span class="s0">def </span><span class="s1">__sub__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s1">super</span><span class="s2">().</span><span class="s1">__sub__</span><span class="s2">(</span><span class="s1">other</span><span class="s2">)</span>
            <span class="s1">tzinfo </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s5">'tzinfo'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

            <span class="s0">if </span><span class="s1">tzinfo </span><span class="s0">is not None</span><span class="s2">:</span>
                <span class="s1">localizer </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">, </span><span class="s5">'normalize'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">localizer </span><span class="s0">is not None</span><span class="s2">:</span>
                    <span class="s1">r </span><span class="s2">= </span><span class="s1">tzinfo</span><span class="s2">.</span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">r</span><span class="s2">)</span>

            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">r</span><span class="s2">, </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">):</span>
                <span class="s1">r </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mk_tzaware</span><span class="s2">(</span><span class="s1">r</span><span class="s2">)</span>

            <span class="s0">return </span><span class="s1">r</span>

        <span class="s0">def </span><span class="s1">__add__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mk_tzaware</span><span class="s2">(</span><span class="s1">super</span><span class="s2">().</span><span class="s1">__add__</span><span class="s2">(</span><span class="s1">other</span><span class="s2">))</span>

        <span class="s0">def </span><span class="s1">astimezone</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">):</span>
            <span class="s1">dt </span><span class="s2">= </span><span class="s1">super</span><span class="s2">().</span><span class="s1">astimezone</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mk_tzaware</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>

        <span class="s2">@</span><span class="s1">classmethod</span>
        <span class="s0">def </span><span class="s1">mk_tzaware</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">datetime_obj</span><span class="s2">):</span>
            <span class="s1">kwargs </span><span class="s2">= {}</span>
            <span class="s1">attrs </span><span class="s2">= (</span><span class="s5">'year'</span><span class="s2">,</span>
                     <span class="s5">'month'</span><span class="s2">,</span>
                     <span class="s5">'day'</span><span class="s2">,</span>
                     <span class="s5">'hour'</span><span class="s2">,</span>
                     <span class="s5">'minute'</span><span class="s2">,</span>
                     <span class="s5">'second'</span><span class="s2">,</span>
                     <span class="s5">'microsecond'</span><span class="s2">,</span>
                     <span class="s5">'tzinfo'</span><span class="s2">)</span>

            <span class="s0">for </span><span class="s1">attr </span><span class="s0">in </span><span class="s1">attrs</span><span class="s2">:</span>
                <span class="s1">val </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">datetime_obj</span><span class="s2">, </span><span class="s1">attr</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">val </span><span class="s0">is not None</span><span class="s2">:</span>
                    <span class="s1">kwargs</span><span class="s2">[</span><span class="s1">attr</span><span class="s2">] = </span><span class="s1">val</span>

            <span class="s0">return </span><span class="s1">cls</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s3"># Define a date_range function similar to pandas.date_range</span>
    <span class="s0">def </span><span class="s1">date_range</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">freq</span><span class="s2">, </span><span class="s1">periods</span><span class="s2">):</span>
        <span class="s1">dtstart </span><span class="s2">= </span><span class="s1">dt_tzaware</span><span class="s2">.</span><span class="s1">mk_tzaware</span><span class="s2">(</span><span class="s1">start</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s2">[</span><span class="s1">dtstart </span><span class="s2">+ (</span><span class="s1">i </span><span class="s2">* </span><span class="s1">freq</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">periods</span><span class="s2">)]</span>

    <span class="s3"># Define a tz_convert function that converts a list to a new timezone.</span>
    <span class="s0">def </span><span class="s1">tz_convert</span><span class="s2">(</span><span class="s1">dt_list</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">[</span><span class="s1">d</span><span class="s2">.</span><span class="s1">astimezone</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">) </span><span class="s0">for </span><span class="s1">d </span><span class="s0">in </span><span class="s1">dt_list</span><span class="s2">]</span>

    <span class="s1">_test_date2num_dst</span><span class="s2">(</span><span class="s1">date_range</span><span class="s2">, </span><span class="s1">tz_convert</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_date2num_dst_pandas</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">):</span>
    <span class="s3"># Test for github issue #3896, but in date2num around DST transitions</span>
    <span class="s3"># with a timezone-aware pandas date_range object.</span>

    <span class="s0">def </span><span class="s1">tz_convert</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">pd</span><span class="s2">.</span><span class="s1">DatetimeIndex</span><span class="s2">.</span><span class="s1">tz_convert</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">).</span><span class="s1">astype</span><span class="s2">(</span><span class="s1">object</span><span class="s2">)</span>

    <span class="s1">_test_date2num_dst</span><span class="s2">(</span><span class="s1">pd</span><span class="s2">.</span><span class="s1">date_range</span><span class="s2">, </span><span class="s1">tz_convert</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">_test_rrulewrapper</span><span class="s2">(</span><span class="s1">attach_tz</span><span class="s2">, </span><span class="s1">get_tz</span><span class="s2">):</span>
    <span class="s1">SYD </span><span class="s2">= </span><span class="s1">get_tz</span><span class="s2">(</span><span class="s5">'Australia/Sydney'</span><span class="s2">)</span>

    <span class="s1">dtstart </span><span class="s2">= </span><span class="s1">attach_tz</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">SYD</span><span class="s2">)</span>
    <span class="s1">dtend </span><span class="s2">= </span><span class="s1">attach_tz</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s2">), </span><span class="s1">SYD</span><span class="s2">)</span>

    <span class="s1">rule </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">rrulewrapper</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">=</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">rrule</span><span class="s2">.</span><span class="s1">DAILY</span><span class="s2">, </span><span class="s1">dtstart</span><span class="s2">=</span><span class="s1">dtstart</span><span class="s2">)</span>

    <span class="s1">act </span><span class="s2">= </span><span class="s1">rule</span><span class="s2">.</span><span class="s1">between</span><span class="s2">(</span><span class="s1">dtstart</span><span class="s2">, </span><span class="s1">dtend</span><span class="s2">)</span>
    <span class="s1">exp </span><span class="s2">= [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">13</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">tzutc</span><span class="s2">()),</span>
           <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">14</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">tzutc</span><span class="s2">())]</span>

    <span class="s0">assert </span><span class="s1">act </span><span class="s2">== </span><span class="s1">exp</span>


<span class="s0">def </span><span class="s1">test_rrulewrapper</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">attach_tz</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">, </span><span class="s1">zi</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">zi</span><span class="s2">)</span>

    <span class="s1">_test_rrulewrapper</span><span class="s2">(</span><span class="s1">attach_tz</span><span class="s2">, </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">)</span>

    <span class="s1">SYD </span><span class="s2">= </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">(</span><span class="s5">'Australia/Sydney'</span><span class="s2">)</span>
    <span class="s1">dtstart </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">dtend </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>
    <span class="s1">rule </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">rrulewrapper</span><span class="s2">(</span><span class="s1">freq</span><span class="s2">=</span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">rrule</span><span class="s2">.</span><span class="s1">DAILY</span><span class="s2">, </span><span class="s1">dtstart</span><span class="s2">=</span><span class="s1">dtstart</span><span class="s2">,</span>
                               <span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">SYD</span><span class="s2">, </span><span class="s1">until</span><span class="s2">=</span><span class="s1">dtend</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">rule</span><span class="s2">.</span><span class="s1">after</span><span class="s2">(</span><span class="s1">dtstart</span><span class="s2">) == </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                                                    <span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">SYD</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">rule</span><span class="s2">.</span><span class="s1">before</span><span class="s2">(</span><span class="s1">dtend</span><span class="s2">) == </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                                                   <span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">SYD</span><span class="s2">)</span>

    <span class="s3"># Test parts of __getattr__</span>
    <span class="s0">assert </span><span class="s1">rule</span><span class="s2">.</span><span class="s1">_base_tzinfo </span><span class="s2">== </span><span class="s1">SYD</span>
    <span class="s0">assert </span><span class="s1">rule</span><span class="s2">.</span><span class="s1">_interval </span><span class="s2">== </span><span class="s4">1</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">pytz</span>
<span class="s0">def </span><span class="s1">test_rrulewrapper_pytz</span><span class="s2">():</span>
    <span class="s3"># Test to make sure pytz zones are supported in rrules</span>
    <span class="s1">pytz </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s5">&quot;pytz&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">attach_tz</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">, </span><span class="s1">zi</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">zi</span><span class="s2">.</span><span class="s1">localize</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>

    <span class="s1">_test_rrulewrapper</span><span class="s2">(</span><span class="s1">attach_tz</span><span class="s2">, </span><span class="s1">pytz</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">pytz</span>
<span class="s0">def </span><span class="s1">test_yearlocator_pytz</span><span class="s2">():</span>
    <span class="s1">pytz </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">importorskip</span><span class="s2">(</span><span class="s5">&quot;pytz&quot;</span><span class="s2">)</span>

    <span class="s1">tz </span><span class="s2">= </span><span class="s1">pytz</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">(</span><span class="s5">'America/New_York'</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">localize</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2010</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">))</span>
         <span class="s2">+ </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) </span><span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">2000</span><span class="s2">)]</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_view_interval</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">0</span><span class="s2">])-</span><span class="s4">1.0</span><span class="s2">,</span>
                                   <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">])+</span><span class="s4">1.0</span><span class="s2">)</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">733408.208333</span><span class="s2">, </span><span class="s4">733773.208333</span><span class="s2">, </span><span class="s4">734138.208333</span><span class="s2">,</span>
                  <span class="s4">734503.208333</span><span class="s2">, </span><span class="s4">734869.208333</span><span class="s2">, </span><span class="s4">735234.208333</span><span class="s2">, </span><span class="s4">735599.208333</span><span class="s2">])</span>
    <span class="s3"># convert to new epoch from old...</span>
    <span class="s1">t </span><span class="s2">= </span><span class="s1">t </span><span class="s2">+ </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'0000-12-31'</span><span class="s2">))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">t</span><span class="s2">, </span><span class="s1">locator</span><span class="s2">())</span>
    <span class="s1">expected </span><span class="s2">= [</span><span class="s5">'2009-01-01 00:00:00-05:00'</span><span class="s2">,</span>
                <span class="s5">'2010-01-01 00:00:00-05:00'</span><span class="s2">, </span><span class="s5">'2011-01-01 00:00:00-05:00'</span><span class="s2">,</span>
                <span class="s5">'2012-01-01 00:00:00-05:00'</span><span class="s2">, </span><span class="s5">'2013-01-01 00:00:00-05:00'</span><span class="s2">,</span>
                <span class="s5">'2014-01-01 00:00:00-05:00'</span><span class="s2">, </span><span class="s5">'2015-01-01 00:00:00-05:00'</span><span class="s2">]</span>
    <span class="s1">st </span><span class="s2">= </span><span class="s1">list</span><span class="s2">(</span><span class="s1">map</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">(), </span><span class="s1">tz</span><span class="s2">=</span><span class="s1">tz</span><span class="s2">)))</span>
    <span class="s0">assert </span><span class="s1">st </span><span class="s2">== </span><span class="s1">expected</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">.</span><span class="s1">tick_values</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s4">14610.20833333</span><span class="s2">, </span><span class="s4">14610.33333333</span><span class="s2">, </span><span class="s4">14610.45833333</span><span class="s2">, </span><span class="s4">14610.58333333</span><span class="s2">,</span>
         <span class="s4">14610.70833333</span><span class="s2">, </span><span class="s4">14610.83333333</span><span class="s2">, </span><span class="s4">14610.95833333</span><span class="s2">, </span><span class="s4">14611.08333333</span><span class="s2">,</span>
         <span class="s4">14611.20833333</span><span class="s2">]))</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">allclose</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">.</span><span class="s1">get_locator</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">1</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]).</span><span class="s1">tick_values</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[</span><span class="s4">0</span><span class="s2">], </span><span class="s1">x</span><span class="s2">[</span><span class="s4">1</span><span class="s2">]),</span>
                       <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s4">14610.20833333</span><span class="s2">, </span><span class="s4">14610.33333333</span><span class="s2">, </span><span class="s4">14610.45833333</span><span class="s2">, </span><span class="s4">14610.58333333</span><span class="s2">,</span>
         <span class="s4">14610.70833333</span><span class="s2">, </span><span class="s4">14610.83333333</span><span class="s2">, </span><span class="s4">14610.95833333</span><span class="s2">, </span><span class="s4">14611.08333333</span><span class="s2">,</span>
         <span class="s4">14611.20833333</span><span class="s2">]))</span>


<span class="s0">def </span><span class="s1">test_YearLocator</span><span class="s2">():</span>
    <span class="s0">def </span><span class="s1">_create_year_locator</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">, </span><span class="s1">date2</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">YearLocator</span><span class="s2">(**</span><span class="s1">kwargs</span><span class="s2">)</span>
        <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
        <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_view_interval</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">date1</span><span class="s2">),</span>
                                       <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">date2</span><span class="s2">))</span>
        <span class="s0">return </span><span class="s1">locator</span>

    <span class="s1">d1 </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1990</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s1">results </span><span class="s2">= ([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">),</span>
                <span class="s2">{</span><span class="s5">'base'</span><span class="s2">: </span><span class="s4">20</span><span class="s2">, </span><span class="s5">'month'</span><span class="s2">: </span><span class="s4">1</span><span class="s2">, </span><span class="s5">'day'</span><span class="s2">: </span><span class="s4">1</span><span class="s2">},</span>
                <span class="s2">[</span><span class="s5">'1980-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2000-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2020-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2040-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2060-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2080-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2100-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2120-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2140-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2160-01-01 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2180-01-01 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2200-01-01 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">200</span><span class="s2">),</span>
                <span class="s2">{</span><span class="s5">'base'</span><span class="s2">: </span><span class="s4">20</span><span class="s2">, </span><span class="s5">'month'</span><span class="s2">: </span><span class="s4">5</span><span class="s2">, </span><span class="s5">'day'</span><span class="s2">: </span><span class="s4">16</span><span class="s2">},</span>
                <span class="s2">[</span><span class="s5">'1980-05-16 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2000-05-16 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2020-05-16 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2040-05-16 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2060-05-16 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2080-05-16 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2100-05-16 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2120-05-16 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2140-05-16 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2160-05-16 00:00:00+00:00'</span><span class="s2">,</span>
                 <span class="s5">'2180-05-16 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2200-05-16 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">[</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">weeks</span><span class="s2">=</span><span class="s4">52 </span><span class="s2">* </span><span class="s4">5</span><span class="s2">),</span>
                <span class="s2">{</span><span class="s5">'base'</span><span class="s2">: </span><span class="s4">20</span><span class="s2">, </span><span class="s5">'month'</span><span class="s2">: </span><span class="s4">9</span><span class="s2">, </span><span class="s5">'day'</span><span class="s2">: </span><span class="s4">25</span><span class="s2">},</span>
                <span class="s2">[</span><span class="s5">'1980-09-25 00:00:00+00:00'</span><span class="s2">, </span><span class="s5">'2000-09-25 00:00:00+00:00'</span><span class="s2">]</span>
                <span class="s2">],</span>
               <span class="s2">)</span>

    <span class="s0">for </span><span class="s1">delta</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">, </span><span class="s1">expected </span><span class="s0">in </span><span class="s1">results</span><span class="s2">:</span>
        <span class="s1">d2 </span><span class="s2">= </span><span class="s1">d1 </span><span class="s2">+ </span><span class="s1">delta</span>
        <span class="s1">locator </span><span class="s2">= </span><span class="s1">_create_year_locator</span><span class="s2">(</span><span class="s1">d1</span><span class="s2">, </span><span class="s1">d2</span><span class="s2">, **</span><span class="s1">arguments</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">list</span><span class="s2">(</span><span class="s1">map</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">()))) == </span><span class="s1">expected</span>


<span class="s0">def </span><span class="s1">test_DayLocator</span><span class="s2">():</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">DayLocator</span><span class="s2">(</span><span class="s1">interval</span><span class="s2">=-</span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">DayLocator</span><span class="s2">(</span><span class="s1">interval</span><span class="s2">=-</span><span class="s4">1.5</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">DayLocator</span><span class="s2">(</span><span class="s1">interval</span><span class="s2">=</span><span class="s4">0</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">DayLocator</span><span class="s2">(</span><span class="s1">interval</span><span class="s2">=</span><span class="s4">1.3</span><span class="s2">)</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">DayLocator</span><span class="s2">(</span><span class="s1">interval</span><span class="s2">=</span><span class="s4">1.0</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_tz_utc</span><span class="s2">():</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1970</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">tzname</span><span class="s2">() == </span><span class="s5">'UTC'</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">&quot;x, tdelta&quot;</span><span class="s2">,</span>
                         <span class="s2">[(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)),</span>
                          <span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1.5</span><span class="s2">], [</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">1</span><span class="s2">),</span>
                                      <span class="s1">datetime</span><span class="s2">.</span><span class="s1">timedelta</span><span class="s2">(</span><span class="s1">days</span><span class="s2">=</span><span class="s4">1.5</span><span class="s2">)])])</span>
<span class="s0">def </span><span class="s1">test_num2timedelta</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">tdelta</span><span class="s2">):</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2timedelta</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">dt </span><span class="s2">== </span><span class="s1">tdelta</span>


<span class="s0">def </span><span class="s1">test_datetime64_in_list</span><span class="s2">():</span>
    <span class="s1">dt </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2000-01-01'</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2001-01-01'</span><span class="s2">)]</span>
    <span class="s1">dn </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">)</span>
    <span class="s3"># convert fixed values from old to new epoch</span>
    <span class="s1">t </span><span class="s2">= (</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">730120.</span><span class="s2">,  </span><span class="s4">730486.</span><span class="s2">]) +</span>
         <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'0000-12-31'</span><span class="s2">)))</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">dn</span><span class="s2">, </span><span class="s1">t</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_change_epoch</span><span class="s2">():</span>
    <span class="s1">date </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'2000-01-01'</span><span class="s2">)</span>

    <span class="s3"># use private method to clear the epoch and allow it to be set...</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">get_epoch</span><span class="s2">()  </span><span class="s3"># Set default.</span>

    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">RuntimeError</span><span class="s2">):</span>
        <span class="s3"># this should fail here because there is a sentinel on the epoch</span>
        <span class="s3"># if the epoch has been used then it cannot be set.</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">set_epoch</span><span class="s2">(</span><span class="s5">'0000-01-01'</span><span class="s2">)</span>

    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">set_epoch</span><span class="s2">(</span><span class="s5">'1970-01-01'</span><span class="s2">)</span>
    <span class="s1">dt </span><span class="s2">= (</span><span class="s1">date </span><span class="s2">- </span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'1970-01-01'</span><span class="s2">)).</span><span class="s1">astype</span><span class="s2">(</span><span class="s5">'datetime64[D]'</span><span class="s2">)</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">dt</span><span class="s2">.</span><span class="s1">astype</span><span class="s2">(</span><span class="s5">'int'</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">date</span><span class="s2">), </span><span class="s1">float</span><span class="s2">(</span><span class="s1">dt</span><span class="s2">))</span>

    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">set_epoch</span><span class="s2">(</span><span class="s5">'0000-12-31'</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">date</span><span class="s2">), </span><span class="s4">730120.0</span><span class="s2">)</span>

    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">set_epoch</span><span class="s2">(</span><span class="s5">'1970-01-01T01:00:00'</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">date</span><span class="s2">), </span><span class="s1">dt </span><span class="s2">- </span><span class="s4">1.</span><span class="s2">/</span><span class="s4">24.</span><span class="s2">)</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">_reset_epoch_test_example</span><span class="s2">()</span>
    <span class="s1">mdates</span><span class="s2">.</span><span class="s1">set_epoch</span><span class="s2">(</span><span class="s5">'1970-01-01T00:00:00'</span><span class="s2">)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">datetime64</span><span class="s2">(</span><span class="s5">'1970-01-01T12:00:00'</span><span class="s2">)),</span>
        <span class="s4">0.5</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_warn_notintervals</span><span class="s2">():</span>
    <span class="s1">dates </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">'2001-01-10'</span><span class="s2">, </span><span class="s5">'2001-03-04'</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'datetime64[D]'</span><span class="s2">)</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">(</span><span class="s1">interval_multiples</span><span class="s2">=</span><span class="s0">False</span><span class="s2">)</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">intervald</span><span class="s2">[</span><span class="s4">3</span><span class="s2">] = [</span><span class="s4">2</span><span class="s2">]</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_view_interval</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">[</span><span class="s4">0</span><span class="s2">]),</span>
                                   <span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">[-</span><span class="s4">1</span><span class="s2">]))</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">warns</span><span class="s2">(</span><span class="s1">UserWarning</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;AutoDateLocator was unable&quot;</span><span class="s2">):</span>
        <span class="s1">locs </span><span class="s2">= </span><span class="s1">locator</span><span class="s2">()</span>


<span class="s0">def </span><span class="s1">test_change_converter</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'date.converter'</span><span class="s2">] = </span><span class="s5">'concise'</span>
    <span class="s1">dates </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">'2020-01-01'</span><span class="s2">, </span><span class="s5">'2020-05-01'</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'datetime64[D]'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">)))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'Jan'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'15'</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'date.converter'</span><span class="s2">] = </span><span class="s5">'auto'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">)))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'Jan 01 2020'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'Jan 15 2020'</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">):</span>
        <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'date.converter'</span><span class="s2">] = </span><span class="s5">'boo'</span>


<span class="s0">def </span><span class="s1">test_change_interval_multiples</span><span class="s2">():</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'date.interval_multiples'</span><span class="s2">] = </span><span class="s0">False</span>
    <span class="s1">dates </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s5">'2020-01-10'</span><span class="s2">, </span><span class="s5">'2020-05-01'</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s5">'datetime64[D]'</span><span class="s2">)</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">)))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'Jan 10 2020'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'Jan 24 2020'</span>

    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'date.interval_multiples'</span><span class="s2">] = </span><span class="s5">'True'</span>
    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>

    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">arange</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">dates</span><span class="s2">)))</span>
    <span class="s1">fig</span><span class="s2">.</span><span class="s1">canvas</span><span class="s2">.</span><span class="s1">draw</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s4">0</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'Jan 15 2020'</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xticklabels</span><span class="s2">()[</span><span class="s4">1</span><span class="s2">].</span><span class="s1">get_text</span><span class="s2">() == </span><span class="s5">'Feb 01 2020'</span>


<span class="s0">def </span><span class="s1">test_DateLocator</span><span class="s2">():</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">DateLocator</span><span class="s2">()</span>
    <span class="s3"># Test nonsingular</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">nonsingular</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">) == (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">nonsingular</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">) == (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">nonsingular</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">) == (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">nonsingular</span><span class="s2">(</span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">) == (-</span><span class="s4">2</span><span class="s2">, </span><span class="s4">2</span><span class="s2">)</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
    <span class="s3"># default values</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">datalim_to_dt</span><span class="s2">() == (</span>
        <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1970</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">.</span><span class="s1">utc</span><span class="s2">),</span>
        <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">1970</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">.</span><span class="s1">utc</span><span class="s2">))</span>

    <span class="s3"># Check default is UTC</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">tz </span><span class="s2">== </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span>
    <span class="s1">tz_str </span><span class="s2">= </span><span class="s5">'Iceland'</span>
    <span class="s1">iceland_tz </span><span class="s2">= </span><span class="s1">dateutil</span><span class="s2">.</span><span class="s1">tz</span><span class="s2">.</span><span class="s1">gettz</span><span class="s2">(</span><span class="s1">tz_str</span><span class="s2">)</span>
    <span class="s3"># Check not Iceland</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">tz </span><span class="s2">!= </span><span class="s1">iceland_tz</span>
    <span class="s3"># Set it to Iceland</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">set_tzinfo</span><span class="s2">(</span><span class="s5">'Iceland'</span><span class="s2">)</span>
    <span class="s3"># Check now it is Iceland</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">tz </span><span class="s2">== </span><span class="s1">iceland_tz</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">create_dummy_axis</span><span class="s2">()</span>
    <span class="s1">locator</span><span class="s2">.</span><span class="s1">axis</span><span class="s2">.</span><span class="s1">set_data_interval</span><span class="s2">(*</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">([</span><span class="s5">&quot;2022-01-10&quot;</span><span class="s2">,</span>
                                                     <span class="s5">&quot;2022-01-08&quot;</span><span class="s2">]))</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">datalim_to_dt</span><span class="s2">() == (</span>
        <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2022</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">8</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">iceland_tz</span><span class="s2">),</span>
        <span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2022</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">iceland_tz</span><span class="s2">))</span>

    <span class="s3"># Set rcParam</span>
    <span class="s1">plt</span><span class="s2">.</span><span class="s1">rcParams</span><span class="s2">[</span><span class="s5">'timezone'</span><span class="s2">] = </span><span class="s1">tz_str</span>

    <span class="s3"># Create a new one in a similar way</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">DateLocator</span><span class="s2">()</span>
    <span class="s3"># Check now it is Iceland</span>
    <span class="s0">assert </span><span class="s1">locator</span><span class="s2">.</span><span class="s1">tz </span><span class="s2">== </span><span class="s1">iceland_tz</span>

    <span class="s3"># Test invalid tz values</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;Aiceland is not a valid timezone&quot;</span><span class="s2">):</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">DateLocator</span><span class="s2">(</span><span class="s1">tz</span><span class="s2">=</span><span class="s5">&quot;Aiceland&quot;</span><span class="s2">)</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">TypeError</span><span class="s2">,</span>
                       <span class="s1">match</span><span class="s2">=</span><span class="s5">&quot;tz must be string or tzinfo subclass.&quot;</span><span class="s2">):</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">DateLocator</span><span class="s2">(</span><span class="s1">tz</span><span class="s2">=</span><span class="s4">1</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_datestr2num</span><span class="s2">():</span>
    <span class="s0">assert </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">datestr2num</span><span class="s2">(</span><span class="s5">'2022-01-10'</span><span class="s2">) == </span><span class="s4">19002.0</span>
    <span class="s1">dt </span><span class="s2">= </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">date</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s4">2022</span><span class="s2">, </span><span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">10</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">datestr2num</span><span class="s2">(</span><span class="s5">'2022-01'</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s1">dt</span><span class="s2">) == </span><span class="s4">19002.0</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">datestr2num</span><span class="s2">(</span>
        <span class="s2">[</span><span class="s5">'2022-01'</span><span class="s2">, </span><span class="s5">'2022-02'</span><span class="s2">], </span><span class="s1">default</span><span class="s2">=</span><span class="s1">dt</span>
        <span class="s2">) == </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">19002.</span><span class="s2">, </span><span class="s4">19033.</span><span class="s2">]))</span>
    <span class="s0">assert </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">datestr2num</span><span class="s2">([]).</span><span class="s1">size </span><span class="s2">== </span><span class="s4">0</span>
    <span class="s0">assert </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">datestr2num</span><span class="s2">([], </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">date</span><span class="s2">(</span><span class="s1">year</span><span class="s2">=</span><span class="s4">2022</span><span class="s2">,</span>
                                                <span class="s1">month</span><span class="s2">=</span><span class="s4">1</span><span class="s2">, </span><span class="s1">day</span><span class="s2">=</span><span class="s4">10</span><span class="s2">)).</span><span class="s1">size </span><span class="s2">== </span><span class="s4">0</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'kwarg'</span><span class="s2">,</span>
                         <span class="s2">(</span><span class="s5">'formats'</span><span class="s2">, </span><span class="s5">'zero_formats'</span><span class="s2">, </span><span class="s5">'offset_formats'</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_concise_formatter_exceptions</span><span class="s2">(</span><span class="s1">kwarg</span><span class="s2">):</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">()</span>
    <span class="s1">kwargs </span><span class="s2">= {</span><span class="s1">kwarg</span><span class="s2">: [</span><span class="s5">''</span><span class="s2">, </span><span class="s5">'%Y'</span><span class="s2">]}</span>
    <span class="s1">match </span><span class="s2">= </span><span class="s5">f&quot;</span><span class="s0">{</span><span class="s1">kwarg</span><span class="s0">} </span><span class="s5">argument must be a list&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">match</span><span class="s2">):</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_concise_formatter_call</span><span class="s2">():</span>
    <span class="s1">locator </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">AutoDateLocator</span><span class="s2">()</span>
    <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">ConciseDateFormatter</span><span class="s2">(</span><span class="s1">locator</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">(</span><span class="s4">19002.0</span><span class="s2">) == </span><span class="s5">'2022'</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">.</span><span class="s1">format_data_short</span><span class="s2">(</span><span class="s4">19002.0</span><span class="s2">) == </span><span class="s5">'2022-01-10 00:00:00'</span>


<span class="s0">def </span><span class="s1">test_datetime_masked</span><span class="s2">():</span>
    <span class="s3"># make sure that all-masked data falls back to the viewlim</span>
    <span class="s3"># set in convert.axisinfo....</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2017</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">n</span><span class="s2">) </span><span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s4">6</span><span class="s2">)])</span>
    <span class="s1">y </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s4">1</span><span class="s2">, </span><span class="s4">2</span><span class="s2">, </span><span class="s4">3</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">5</span><span class="s2">])</span>
    <span class="s1">m </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ma</span><span class="s2">.</span><span class="s1">masked_greater</span><span class="s2">(</span><span class="s1">y</span><span class="s2">, </span><span class="s4">0</span><span class="s2">)</span>

    <span class="s1">fig</span><span class="s2">, </span><span class="s1">ax </span><span class="s2">= </span><span class="s1">plt</span><span class="s2">.</span><span class="s1">subplots</span><span class="s2">()</span>
    <span class="s1">ax</span><span class="s2">.</span><span class="s1">plot</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">m</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">ax</span><span class="s2">.</span><span class="s1">get_xlim</span><span class="s2">() == (</span><span class="s4">0</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s5">'val'</span><span class="s2">, (-</span><span class="s4">1000000</span><span class="s2">, </span><span class="s4">10000000</span><span class="s2">))</span>
<span class="s0">def </span><span class="s1">test_num2date_error</span><span class="s2">(</span><span class="s1">val</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s5">f&quot;Date ordinal </span><span class="s0">{</span><span class="s1">val</span><span class="s0">} </span><span class="s5">converts&quot;</span><span class="s2">):</span>
        <span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s1">val</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_num2date_roundoff</span><span class="s2">():</span>
    <span class="s0">assert </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s4">100000.0000578702</span><span class="s2">) == </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span>
        <span class="s4">2243</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">4</span><span class="s2">, </span><span class="s4">999980</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">.</span><span class="s1">utc</span><span class="s2">)</span>
    <span class="s3"># Slightly larger, steps of 20 microseconds</span>
    <span class="s0">assert </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">num2date</span><span class="s2">(</span><span class="s4">100000.0000578703</span><span class="s2">) == </span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span>
        <span class="s4">2243</span><span class="s2">, </span><span class="s4">10</span><span class="s2">, </span><span class="s4">17</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">5</span><span class="s2">, </span><span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">timezone</span><span class="s2">.</span><span class="s1">utc</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_DateFormatter_settz</span><span class="s2">():</span>
    <span class="s1">time </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">date2num</span><span class="s2">(</span><span class="s1">datetime</span><span class="s2">.</span><span class="s1">datetime</span><span class="s2">(</span><span class="s4">2011</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">0</span><span class="s2">, </span><span class="s4">0</span><span class="s2">,</span>
                                             <span class="s1">tzinfo</span><span class="s2">=</span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">UTC</span><span class="s2">))</span>
    <span class="s1">formatter </span><span class="s2">= </span><span class="s1">mdates</span><span class="s2">.</span><span class="s1">DateFormatter</span><span class="s2">(</span><span class="s5">'%Y-%b-%d %H:%M'</span><span class="s2">)</span>
    <span class="s3"># Default UTC</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">(</span><span class="s1">time</span><span class="s2">) == </span><span class="s5">'2011-Jan-01 00:00'</span>

    <span class="s3"># Set tzinfo</span>
    <span class="s1">formatter</span><span class="s2">.</span><span class="s1">set_tzinfo</span><span class="s2">(</span><span class="s5">'Pacific/Kiritimati'</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">formatter</span><span class="s2">(</span><span class="s1">time</span><span class="s2">) == </span><span class="s5">'2011-Jan-01 14:00'</span>
</pre>
</body>
</html>