<html>
<head>
<title>test_continuous_basic.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_continuous_basic.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">numpy</span><span class="s2">.</span><span class="s1">testing </span><span class="s0">as </span><span class="s1">npt</span>
<span class="s0">import </span><span class="s1">pytest</span>
<span class="s0">from </span><span class="s1">pytest </span><span class="s0">import </span><span class="s1">raises </span><span class="s0">as </span><span class="s1">assert_raises</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">integrate </span><span class="s0">import </span><span class="s1">IntegrationWarning</span>
<span class="s0">import </span><span class="s1">itertools</span>

<span class="s0">from </span><span class="s1">scipy </span><span class="s0">import </span><span class="s1">stats</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">common_tests </span><span class="s0">import </span><span class="s2">(</span><span class="s1">check_normalization</span><span class="s2">, </span><span class="s1">check_moment</span><span class="s2">,</span>
                           <span class="s1">check_mean_expect</span><span class="s2">,</span>
                           <span class="s1">check_var_expect</span><span class="s2">, </span><span class="s1">check_skew_expect</span><span class="s2">,</span>
                           <span class="s1">check_kurt_expect</span><span class="s2">, </span><span class="s1">check_entropy</span><span class="s2">,</span>
                           <span class="s1">check_private_entropy</span><span class="s2">, </span><span class="s1">check_entropy_vect_scale</span><span class="s2">,</span>
                           <span class="s1">check_edge_support</span><span class="s2">, </span><span class="s1">check_named_args</span><span class="s2">,</span>
                           <span class="s1">check_random_state_property</span><span class="s2">,</span>
                           <span class="s1">check_meth_dtype</span><span class="s2">, </span><span class="s1">check_ppf_dtype</span><span class="s2">,</span>
                           <span class="s1">check_cmplx_deriv</span><span class="s2">,</span>
                           <span class="s1">check_pickling</span><span class="s2">, </span><span class="s1">check_rvs_broadcast</span><span class="s2">,</span>
                           <span class="s1">check_freezing</span><span class="s2">, </span><span class="s1">check_munp_expect</span><span class="s2">,)</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">_distr_params </span><span class="s0">import </span><span class="s1">distcont</span>
<span class="s0">from </span><span class="s1">scipy</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">_distn_infrastructure </span><span class="s0">import </span><span class="s1">rv_continuous_frozen</span>

<span class="s3">&quot;&quot;&quot; 
Test all continuous distributions. 
 
Parameters were chosen for those distributions that pass the 
Kolmogorov-Smirnov test.  This provides safe parameters for each 
distributions so that we can perform further testing of class methods. 
 
These tests currently check only/mostly for serious errors and exceptions, 
not for numerically exact results. 
&quot;&quot;&quot;</span>

<span class="s4"># Note that you need to add new distributions you want tested</span>
<span class="s4"># to _distr_params</span>

<span class="s1">DECIMAL </span><span class="s2">= </span><span class="s5">5  </span><span class="s4"># specify the precision of the tests  # increased from 0 to 5</span>
<span class="s1">_IS_32BIT </span><span class="s2">= (</span><span class="s1">sys</span><span class="s2">.</span><span class="s1">maxsize </span><span class="s2">&lt; </span><span class="s5">2</span><span class="s2">**</span><span class="s5">32</span><span class="s2">)</span>

<span class="s4"># Sets of tests to skip.</span>
<span class="s4"># Entries sorted by speed (very slow to slow).</span>
<span class="s4"># xslow took &gt; 1s; slow took &gt; 0.5s</span>

<span class="s1">xslow_test_cont_basic </span><span class="s2">= {</span><span class="s3">'studentized_range'</span><span class="s2">, </span><span class="s3">'kstwo'</span><span class="s2">, </span><span class="s3">'ksone'</span><span class="s2">, </span><span class="s3">'vonmises'</span><span class="s2">, </span><span class="s3">'kappa4'</span><span class="s2">,</span>
                         <span class="s3">'recipinvgauss'</span><span class="s2">, </span><span class="s3">'vonmises_line'</span><span class="s2">, </span><span class="s3">'gausshyper'</span><span class="s2">,</span>
                         <span class="s3">'rel_breitwigner'</span><span class="s2">, </span><span class="s3">'norminvgauss'</span><span class="s2">}</span>
<span class="s1">slow_test_cont_basic </span><span class="s2">= {</span><span class="s3">'crystalball'</span><span class="s2">, </span><span class="s3">'powerlognorm'</span><span class="s2">, </span><span class="s3">'pearson3'</span><span class="s2">}</span>

<span class="s4"># test_moments is already marked slow</span>
<span class="s1">xslow_test_moments </span><span class="s2">= {</span><span class="s3">'studentized_range'</span><span class="s2">, </span><span class="s3">'ksone'</span><span class="s2">, </span><span class="s3">'vonmises'</span><span class="s2">, </span><span class="s3">'vonmises_line'</span><span class="s2">,</span>
                      <span class="s3">'recipinvgauss'</span><span class="s2">, </span><span class="s3">'kstwo'</span><span class="s2">, </span><span class="s3">'kappa4'</span><span class="s2">}</span>

<span class="s1">slow_fit_mle </span><span class="s2">= {</span><span class="s3">'exponweib'</span><span class="s2">, </span><span class="s3">'genexpon'</span><span class="s2">, </span><span class="s3">'genhyperbolic'</span><span class="s2">, </span><span class="s3">'johnsonsb'</span><span class="s2">,</span>
                <span class="s3">'kappa4'</span><span class="s2">, </span><span class="s3">'powerlognorm'</span><span class="s2">, </span><span class="s3">'tukeylambda'</span><span class="s2">}</span>
<span class="s1">xslow_fit_mle </span><span class="s2">= {</span><span class="s3">'gausshyper'</span><span class="s2">, </span><span class="s3">'ncf'</span><span class="s2">, </span><span class="s3">'ncx2'</span><span class="s2">, </span><span class="s3">'recipinvgauss'</span><span class="s2">, </span><span class="s3">'vonmises_line'</span><span class="s2">}</span>
<span class="s1">xfail_fit_mle </span><span class="s2">= {</span><span class="s3">'ksone'</span><span class="s2">, </span><span class="s3">'kstwo'</span><span class="s2">, </span><span class="s3">'trapezoid'</span><span class="s2">, </span><span class="s3">'truncpareto'</span><span class="s2">, </span><span class="s3">'irwinhall'</span><span class="s2">}</span>
<span class="s1">skip_fit_mle </span><span class="s2">= {</span><span class="s3">'levy_stable'</span><span class="s2">, </span><span class="s3">'studentized_range'</span><span class="s2">}  </span><span class="s4"># far too slow (&gt;10min)</span>
<span class="s1">slow_fit_mm </span><span class="s2">= {</span><span class="s3">'chi2'</span><span class="s2">, </span><span class="s3">'expon'</span><span class="s2">, </span><span class="s3">'lognorm'</span><span class="s2">, </span><span class="s3">'loguniform'</span><span class="s2">, </span><span class="s3">'powerlaw'</span><span class="s2">, </span><span class="s3">'reciprocal'</span><span class="s2">}</span>
<span class="s1">xslow_fit_mm </span><span class="s2">= {</span><span class="s3">'argus'</span><span class="s2">, </span><span class="s3">'beta'</span><span class="s2">, </span><span class="s3">'exponpow'</span><span class="s2">, </span><span class="s3">'gausshyper'</span><span class="s2">, </span><span class="s3">'gengamma'</span><span class="s2">,</span>
                <span class="s3">'genhalflogistic'</span><span class="s2">, </span><span class="s3">'geninvgauss'</span><span class="s2">, </span><span class="s3">'gompertz'</span><span class="s2">, </span><span class="s3">'halfgennorm'</span><span class="s2">,</span>
                <span class="s3">'johnsonsb'</span><span class="s2">, </span><span class="s3">'kstwobign'</span><span class="s2">, </span><span class="s3">'ncx2'</span><span class="s2">, </span><span class="s3">'norminvgauss'</span><span class="s2">, </span><span class="s3">'truncnorm'</span><span class="s2">,</span>
                <span class="s3">'truncweibull_min'</span><span class="s2">, </span><span class="s3">'wrapcauchy'</span><span class="s2">}</span>
<span class="s1">xfail_fit_mm </span><span class="s2">= {</span><span class="s3">'alpha'</span><span class="s2">, </span><span class="s3">'betaprime'</span><span class="s2">, </span><span class="s3">'bradford'</span><span class="s2">, </span><span class="s3">'burr'</span><span class="s2">, </span><span class="s3">'burr12'</span><span class="s2">, </span><span class="s3">'cauchy'</span><span class="s2">,</span>
                <span class="s3">'crystalball'</span><span class="s2">, </span><span class="s3">'exponweib'</span><span class="s2">, </span><span class="s3">'f'</span><span class="s2">, </span><span class="s3">'fisk'</span><span class="s2">, </span><span class="s3">'foldcauchy'</span><span class="s2">, </span><span class="s3">'genextreme'</span><span class="s2">,</span>
                <span class="s3">'genpareto'</span><span class="s2">, </span><span class="s3">'halfcauchy'</span><span class="s2">, </span><span class="s3">'invgamma'</span><span class="s2">, </span><span class="s3">'irwinhall'</span><span class="s2">, </span><span class="s3">'jf_skew_t'</span><span class="s2">,</span>
                <span class="s3">'johnsonsu'</span><span class="s2">, </span><span class="s3">'kappa3'</span><span class="s2">, </span><span class="s3">'kappa4'</span><span class="s2">, </span><span class="s3">'levy'</span><span class="s2">, </span><span class="s3">'levy_l'</span><span class="s2">, </span><span class="s3">'loglaplace'</span><span class="s2">,</span>
                <span class="s3">'lomax'</span><span class="s2">, </span><span class="s3">'mielke'</span><span class="s2">, </span><span class="s3">'ncf'</span><span class="s2">, </span><span class="s3">'nct'</span><span class="s2">, </span><span class="s3">'pareto'</span><span class="s2">, </span><span class="s3">'powerlognorm'</span><span class="s2">, </span><span class="s3">'powernorm'</span><span class="s2">,</span>
                <span class="s3">'rel_breitwigner'</span><span class="s2">,  </span><span class="s3">'skewcauchy'</span><span class="s2">, </span><span class="s3">'t'</span><span class="s2">, </span><span class="s3">'trapezoid'</span><span class="s2">, </span><span class="s3">'truncexpon'</span><span class="s2">,</span>
                <span class="s3">'truncpareto'</span><span class="s2">, </span><span class="s3">'tukeylambda'</span><span class="s2">, </span><span class="s3">'vonmises'</span><span class="s2">, </span><span class="s3">'vonmises_line'</span><span class="s2">}</span>
<span class="s1">skip_fit_mm </span><span class="s2">= {</span><span class="s3">'genexpon'</span><span class="s2">, </span><span class="s3">'genhyperbolic'</span><span class="s2">, </span><span class="s3">'ksone'</span><span class="s2">, </span><span class="s3">'kstwo'</span><span class="s2">, </span><span class="s3">'levy_stable'</span><span class="s2">,</span>
               <span class="s3">'recipinvgauss'</span><span class="s2">, </span><span class="s3">'studentized_range'</span><span class="s2">}  </span><span class="s4"># far too slow (&gt;10min)</span>

<span class="s4"># These distributions fail the complex derivative test below.</span>
<span class="s4"># Here 'fail' mean produce wrong results and/or raise exceptions, depending</span>
<span class="s4"># on the implementation details of corresponding special functions.</span>
<span class="s4"># cf https://github.com/scipy/scipy/pull/4979 for a discussion.</span>
<span class="s1">fails_cmplx </span><span class="s2">= {</span><span class="s3">'argus'</span><span class="s2">, </span><span class="s3">'beta'</span><span class="s2">, </span><span class="s3">'betaprime'</span><span class="s2">, </span><span class="s3">'chi'</span><span class="s2">, </span><span class="s3">'chi2'</span><span class="s2">, </span><span class="s3">'cosine'</span><span class="s2">,</span>
               <span class="s3">'dgamma'</span><span class="s2">, </span><span class="s3">'dweibull'</span><span class="s2">, </span><span class="s3">'erlang'</span><span class="s2">, </span><span class="s3">'f'</span><span class="s2">, </span><span class="s3">'foldcauchy'</span><span class="s2">, </span><span class="s3">'gamma'</span><span class="s2">,</span>
               <span class="s3">'gausshyper'</span><span class="s2">, </span><span class="s3">'gengamma'</span><span class="s2">, </span><span class="s3">'genhyperbolic'</span><span class="s2">,</span>
               <span class="s3">'geninvgauss'</span><span class="s2">, </span><span class="s3">'gennorm'</span><span class="s2">, </span><span class="s3">'genpareto'</span><span class="s2">,</span>
               <span class="s3">'halfcauchy'</span><span class="s2">, </span><span class="s3">'halfgennorm'</span><span class="s2">, </span><span class="s3">'invgamma'</span><span class="s2">, </span><span class="s3">'irwinhall'</span><span class="s2">, </span><span class="s3">'jf_skew_t'</span><span class="s2">,</span>
               <span class="s3">'ksone'</span><span class="s2">, </span><span class="s3">'kstwo'</span><span class="s2">, </span><span class="s3">'kstwobign'</span><span class="s2">, </span><span class="s3">'levy_l'</span><span class="s2">, </span><span class="s3">'loggamma'</span><span class="s2">,</span>
               <span class="s3">'logistic'</span><span class="s2">, </span><span class="s3">'loguniform'</span><span class="s2">, </span><span class="s3">'maxwell'</span><span class="s2">, </span><span class="s3">'nakagami'</span><span class="s2">,</span>
               <span class="s3">'ncf'</span><span class="s2">, </span><span class="s3">'nct'</span><span class="s2">, </span><span class="s3">'ncx2'</span><span class="s2">, </span><span class="s3">'norminvgauss'</span><span class="s2">, </span><span class="s3">'pearson3'</span><span class="s2">,</span>
               <span class="s3">'powerlaw'</span><span class="s2">, </span><span class="s3">'rdist'</span><span class="s2">, </span><span class="s3">'reciprocal'</span><span class="s2">, </span><span class="s3">'rice'</span><span class="s2">,</span>
               <span class="s3">'skewnorm'</span><span class="s2">, </span><span class="s3">'t'</span><span class="s2">, </span><span class="s3">'truncweibull_min'</span><span class="s2">,</span>
               <span class="s3">'tukeylambda'</span><span class="s2">, </span><span class="s3">'vonmises'</span><span class="s2">, </span><span class="s3">'vonmises_line'</span><span class="s2">,</span>
               <span class="s3">'rv_histogram_instance'</span><span class="s2">, </span><span class="s3">'truncnorm'</span><span class="s2">, </span><span class="s3">'studentized_range'</span><span class="s2">,</span>
               <span class="s3">'johnsonsb'</span><span class="s2">, </span><span class="s3">'halflogistic'</span><span class="s2">, </span><span class="s3">'rel_breitwigner'</span><span class="s2">}</span>

<span class="s4"># Slow test_method_with_lists</span>
<span class="s1">slow_with_lists </span><span class="s2">= {</span><span class="s3">'studentized_range'</span><span class="s2">}</span>


<span class="s4"># rv_histogram instances, with uniform and non-uniform bins;</span>
<span class="s4"># stored as (dist, arg) tuples for cases_test_cont_basic</span>
<span class="s4"># and cases_test_moments.</span>
<span class="s1">histogram_test_instances </span><span class="s2">= []</span>
<span class="s1">case1 </span><span class="s2">= {</span><span class="s3">'a'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">,</span>
               <span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">6</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">7</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">8</span><span class="s2">, </span><span class="s5">9</span><span class="s2">], </span><span class="s3">'bins'</span><span class="s2">: </span><span class="s5">8</span><span class="s2">}  </span><span class="s4"># equal width bins</span>
<span class="s1">case2 </span><span class="s2">= {</span><span class="s3">'a'</span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], </span><span class="s3">'bins'</span><span class="s2">: [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">10</span><span class="s2">]}  </span><span class="s4"># unequal width bins</span>
<span class="s0">for </span><span class="s1">case</span><span class="s2">, </span><span class="s1">density </span><span class="s0">in </span><span class="s1">itertools</span><span class="s2">.</span><span class="s1">product</span><span class="s2">([</span><span class="s1">case1</span><span class="s2">, </span><span class="s1">case2</span><span class="s2">], [</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]):</span>
    <span class="s1">_hist </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">histogram</span><span class="s2">(**</span><span class="s1">case</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s1">density</span><span class="s2">)</span>
    <span class="s1">_rv_hist </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">rv_histogram</span><span class="s2">(</span><span class="s1">_hist</span><span class="s2">, </span><span class="s1">density</span><span class="s2">=</span><span class="s1">density</span><span class="s2">)</span>
    <span class="s1">histogram_test_instances</span><span class="s2">.</span><span class="s1">append</span><span class="s2">((</span><span class="s1">_rv_hist</span><span class="s2">, </span><span class="s1">tuple</span><span class="s2">()))</span>


<span class="s0">def </span><span class="s1">cases_test_cont_basic</span><span class="s2">():</span>
    <span class="s0">for </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">distcont</span><span class="s2">[:] + </span><span class="s1">histogram_test_instances</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">distname </span><span class="s2">== </span><span class="s3">'levy_stable'</span><span class="s2">:  </span><span class="s4"># fails; tested separately</span>
            <span class="s0">continue</span>
        <span class="s0">if </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">slow_test_cont_basic</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">xslow_test_cont_basic</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'distname,arg'</span><span class="s2">, </span><span class="s1">cases_test_cont_basic</span><span class="s2">())</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'sn'</span><span class="s2">, [</span><span class="s5">500</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_cont_basic</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">sn</span><span class="s2">):</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">distfn </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeError</span><span class="s2">:</span>
        <span class="s1">distfn </span><span class="s2">= </span><span class="s1">distname</span>
        <span class="s1">distname </span><span class="s2">= </span><span class="s3">'rv_histogram_instance'</span>

    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s5">765456</span><span class="s2">)</span>
    <span class="s1">rvs </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s1">sn</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
    <span class="s1">m</span><span class="s2">, </span><span class="s1">v </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(*</span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">distname </span><span class="s0">not in </span><span class="s2">{</span><span class="s3">'laplace_asymmetric'</span><span class="s2">}:</span>
        <span class="s1">check_sample_meanvar_</span><span class="s2">(</span><span class="s1">m</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">)</span>
    <span class="s1">check_cdf_ppf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_sf_isf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_cdf_sf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_ppf_isf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_pdf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_pdf_logpdf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_pdf_logpdf_at_endpoints</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_cdf_logcdf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_sf_logsf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">check_ppf_broadcast</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>

    <span class="s1">alpha </span><span class="s2">= </span><span class="s5">0.01</span>
    <span class="s0">if </span><span class="s1">distname </span><span class="s2">== </span><span class="s3">'rv_histogram_instance'</span><span class="s2">:</span>
        <span class="s1">check_distribution_rvs</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">)</span>
    <span class="s0">elif </span><span class="s1">distname </span><span class="s2">!= </span><span class="s3">'geninvgauss'</span><span class="s2">:</span>
        <span class="s4"># skip kstest for geninvgauss since cdf is too slow; see test for</span>
        <span class="s4"># rv generation in TestGenInvGauss in test_distributions.py</span>
        <span class="s1">check_distribution_rvs</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">)</span>

    <span class="s1">locscale_defaults </span><span class="s2">= (</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">meths </span><span class="s2">= [</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">, </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">logpdf</span><span class="s2">, </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">, </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">logcdf</span><span class="s2">,</span>
             <span class="s1">distfn</span><span class="s2">.</span><span class="s1">logsf</span><span class="s2">]</span>
    <span class="s4"># make sure arguments are within support</span>
    <span class="s1">spec_x </span><span class="s2">= {</span><span class="s3">'weibull_max'</span><span class="s2">: -</span><span class="s5">0.5</span><span class="s2">, </span><span class="s3">'levy_l'</span><span class="s2">: -</span><span class="s5">0.5</span><span class="s2">,</span>
              <span class="s3">'pareto'</span><span class="s2">: </span><span class="s5">1.5</span><span class="s2">, </span><span class="s3">'truncpareto'</span><span class="s2">: </span><span class="s5">3.2</span><span class="s2">, </span><span class="s3">'tukeylambda'</span><span class="s2">: </span><span class="s5">0.3</span><span class="s2">,</span>
              <span class="s3">'rv_histogram_instance'</span><span class="s2">: </span><span class="s5">5.0</span><span class="s2">}</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">spec_x</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">distname </span><span class="s2">== </span><span class="s3">'invweibull'</span><span class="s2">:</span>
        <span class="s1">arg </span><span class="s2">= (</span><span class="s5">1</span><span class="s2">,)</span>
    <span class="s0">elif </span><span class="s1">distname </span><span class="s2">== </span><span class="s3">'ksone'</span><span class="s2">:</span>
        <span class="s1">arg </span><span class="s2">= (</span><span class="s5">3</span><span class="s2">,)</span>

    <span class="s1">check_named_args</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">locscale_defaults</span><span class="s2">, </span><span class="s1">meths</span><span class="s2">)</span>
    <span class="s1">check_random_state_property</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">distname </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'rel_breitwigner'</span><span class="s2">] </span><span class="s0">and </span><span class="s1">_IS_32BIT</span><span class="s2">:</span>
        <span class="s4"># gh18414</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">&quot;fails on Linux 32-bit&quot;</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">check_pickling</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s1">check_freezing</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s4"># Entropy</span>
    <span class="s0">if </span><span class="s1">distname </span><span class="s0">not in </span><span class="s2">[</span><span class="s3">'kstwobign'</span><span class="s2">, </span><span class="s3">'kstwo'</span><span class="s2">, </span><span class="s3">'ncf'</span><span class="s2">]:</span>
        <span class="s1">check_entropy</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">numargs </span><span class="s2">== </span><span class="s5">0</span><span class="s2">:</span>
        <span class="s1">check_vecentropy</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">_entropy </span><span class="s2">!= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">rv_continuous</span><span class="s2">.</span><span class="s1">_entropy</span>
            <span class="s0">and </span><span class="s1">distname </span><span class="s2">!= </span><span class="s3">'vonmises'</span><span class="s2">):</span>
        <span class="s1">check_private_entropy</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">rv_continuous</span><span class="s2">)</span>

    <span class="s0">with </span><span class="s1">npt</span><span class="s2">.</span><span class="s1">suppress_warnings</span><span class="s2">() </span><span class="s0">as </span><span class="s1">sup</span><span class="s2">:</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">IntegrationWarning</span><span class="s2">, </span><span class="s3">&quot;The occurrence of roundoff error&quot;</span><span class="s2">)</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">IntegrationWarning</span><span class="s2">, </span><span class="s3">&quot;Extremely bad integrand&quot;</span><span class="s2">)</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">RuntimeWarning</span><span class="s2">, </span><span class="s3">&quot;invalid value&quot;</span><span class="s2">)</span>
        <span class="s1">check_entropy_vect_scale</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s1">check_retrieving_support</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s1">check_edge_support</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s1">check_meth_dtype</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">meths</span><span class="s2">)</span>
    <span class="s1">check_ppf_dtype</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">distname </span><span class="s0">not in </span><span class="s1">fails_cmplx</span><span class="s2">:</span>
        <span class="s1">check_cmplx_deriv</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">distname </span><span class="s2">!= </span><span class="s3">'truncnorm'</span><span class="s2">:</span>
        <span class="s1">check_ppf_private</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">cases_test_cont_basic_fit</span><span class="s2">():</span>
    <span class="s1">slow </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span>
    <span class="s1">xslow </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span>
    <span class="s1">fail </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Test fails and may be slow.&quot;</span><span class="s2">)</span>
    <span class="s1">skip </span><span class="s2">= </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;Test too slow to run to completion (&gt;10m).&quot;</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">distcont</span><span class="s2">[:] + </span><span class="s1">histogram_test_instances</span><span class="s2">:</span>
        <span class="s0">for </span><span class="s1">method </span><span class="s0">in </span><span class="s2">[</span><span class="s3">&quot;MLE&quot;</span><span class="s2">, </span><span class="s3">&quot;MM&quot;</span><span class="s2">]:</span>
            <span class="s0">for </span><span class="s1">fix_args </span><span class="s0">in </span><span class="s2">[</span><span class="s0">True</span><span class="s2">, </span><span class="s0">False</span><span class="s2">]:</span>
                <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s3">'MLE' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">slow_fit_mle</span><span class="s2">:</span>
                    <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">slow</span><span class="s2">)</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s3">'MLE' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">xslow_fit_mle</span><span class="s2">:</span>
                    <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">xslow</span><span class="s2">)</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s3">'MLE' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">xfail_fit_mle</span><span class="s2">:</span>
                    <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">fail</span><span class="s2">)</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s3">'MLE' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">skip_fit_mle</span><span class="s2">:</span>
                    <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">skip</span><span class="s2">)</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s3">'MM' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">slow_fit_mm</span><span class="s2">:</span>
                    <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">slow</span><span class="s2">)</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s3">'MM' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">xslow_fit_mm</span><span class="s2">:</span>
                    <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">xslow</span><span class="s2">)</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s3">'MM' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">xfail_fit_mm</span><span class="s2">:</span>
                    <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">fail</span><span class="s2">)</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s1">method </span><span class="s2">== </span><span class="s3">'MM' </span><span class="s0">and </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">skip_fit_mm</span><span class="s2">:</span>
                    <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">skip</span><span class="s2">)</span>
                    <span class="s0">continue</span>

                <span class="s0">yield </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span>


<span class="s0">def </span><span class="s1">test_cont_basic_fit_cases</span><span class="s2">():</span>
    <span class="s4"># Distribution names should not be in multiple MLE or MM sets</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">xslow_fit_mle</span><span class="s2">.</span><span class="s1">union</span><span class="s2">(</span><span class="s1">xfail_fit_mle</span><span class="s2">).</span><span class="s1">union</span><span class="s2">(</span><span class="s1">skip_fit_mle</span><span class="s2">)) ==</span>
            <span class="s1">len</span><span class="s2">(</span><span class="s1">xslow_fit_mle</span><span class="s2">) + </span><span class="s1">len</span><span class="s2">(</span><span class="s1">xfail_fit_mle</span><span class="s2">) + </span><span class="s1">len</span><span class="s2">(</span><span class="s1">skip_fit_mle</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">xslow_fit_mm</span><span class="s2">.</span><span class="s1">union</span><span class="s2">(</span><span class="s1">xfail_fit_mm</span><span class="s2">).</span><span class="s1">union</span><span class="s2">(</span><span class="s1">skip_fit_mm</span><span class="s2">)) ==</span>
            <span class="s1">len</span><span class="s2">(</span><span class="s1">xslow_fit_mm</span><span class="s2">) + </span><span class="s1">len</span><span class="s2">(</span><span class="s1">xfail_fit_mm</span><span class="s2">) + </span><span class="s1">len</span><span class="s2">(</span><span class="s1">skip_fit_mm</span><span class="s2">))</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'distname, arg, method, fix_args'</span><span class="s2">,</span>
                         <span class="s1">cases_test_cont_basic_fit</span><span class="s2">())</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'n_fit_samples'</span><span class="s2">, [</span><span class="s5">200</span><span class="s2">])</span>
<span class="s0">def </span><span class="s1">test_cont_basic_fit</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">n_fit_samples</span><span class="s2">, </span><span class="s1">method</span><span class="s2">, </span><span class="s1">fix_args</span><span class="s2">):</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">distfn </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeError</span><span class="s2">:</span>
        <span class="s1">distfn </span><span class="s2">= </span><span class="s1">distname</span>

    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s5">765456</span><span class="s2">)</span>
    <span class="s1">rvs </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=</span><span class="s1">n_fit_samples</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">fix_args</span><span class="s2">:</span>
        <span class="s1">check_fit_args_fix</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">check_fit_args</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)</span>

<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'distname,arg'</span><span class="s2">, </span><span class="s1">cases_test_cont_basic</span><span class="s2">())</span>
<span class="s0">def </span><span class="s1">test_rvs_scalar</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">):</span>
    <span class="s4"># rvs should return a scalar when given scalar arguments (gh-12428)</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">distfn </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeError</span><span class="s2">:</span>
        <span class="s1">distfn </span><span class="s2">= </span><span class="s1">distname</span>
        <span class="s1">distname </span><span class="s2">= </span><span class="s3">'rv_histogram_instance'</span>

    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isscalar</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">arg</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isscalar</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=()))</span>
    <span class="s0">assert </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isscalar</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(*</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">size</span><span class="s2">=</span><span class="s0">None</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">test_levy_stable_random_state_property</span><span class="s2">():</span>
    <span class="s4"># levy_stable only implements rvs(), so it is skipped in the</span>
    <span class="s4"># main loop in test_cont_basic(). Here we apply just the test</span>
    <span class="s4"># check_random_state_property to levy_stable.</span>
    <span class="s1">check_random_state_property</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">levy_stable</span><span class="s2">, (</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">cases_test_moments</span><span class="s2">():</span>
    <span class="s1">fail_normalization </span><span class="s2">= </span><span class="s1">set</span><span class="s2">()</span>
    <span class="s1">fail_higher </span><span class="s2">= {</span><span class="s3">'ncf'</span><span class="s2">}</span>
    <span class="s1">fail_moment </span><span class="s2">= {</span><span class="s3">'johnsonsu'</span><span class="s2">}  </span><span class="s4"># generic `munp` is inaccurate for johnsonsu</span>

    <span class="s0">for </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">distcont</span><span class="s2">[:] + </span><span class="s1">histogram_test_instances</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">distname </span><span class="s2">== </span><span class="s3">'levy_stable'</span><span class="s2">:</span>
            <span class="s0">continue</span>

        <span class="s0">if </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">xslow_test_moments</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">,</span>
                               <span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span><span class="s2">(</span><span class="s1">reason</span><span class="s2">=</span><span class="s3">&quot;too slow&quot;</span><span class="s2">))</span>
            <span class="s0">continue</span>

        <span class="s1">cond1 </span><span class="s2">= </span><span class="s1">distname </span><span class="s0">not in </span><span class="s1">fail_normalization</span>
        <span class="s1">cond2 </span><span class="s2">= </span><span class="s1">distname </span><span class="s0">not in </span><span class="s1">fail_higher</span>
        <span class="s1">cond3 </span><span class="s2">= </span><span class="s1">distname </span><span class="s0">not in </span><span class="s1">fail_moment</span>

        <span class="s1">marks </span><span class="s2">= </span><span class="s1">list</span><span class="s2">()</span>
        <span class="s4"># Currently unused, `marks` can be used to add a timeout to a test of</span>
        <span class="s4"># a specific distribution.  For example, this shows how a timeout could</span>
        <span class="s4"># be added for the 'skewnorm' distribution:</span>
        <span class="s4">#</span>
        <span class="s4">#     marks = list()</span>
        <span class="s4">#     if distname == 'skewnorm':</span>
        <span class="s4">#         marks.append(pytest.mark.timeout(300))</span>

        <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">cond1</span><span class="s2">, </span><span class="s1">cond2</span><span class="s2">, </span><span class="s1">cond3</span><span class="s2">,</span>
                           <span class="s0">False</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">marks</span><span class="s2">)</span>

        <span class="s0">if not </span><span class="s1">cond1 </span><span class="s0">or not </span><span class="s1">cond2 </span><span class="s0">or not </span><span class="s1">cond3</span><span class="s2">:</span>
            <span class="s4"># Run the distributions that have issues twice, once skipping the</span>
            <span class="s4"># not_ok parts, once with the not_ok parts but marked as knownfail</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">, </span><span class="s0">True</span><span class="s2">,</span>
                               <span class="s1">marks</span><span class="s2">=[</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xfail</span><span class="s2">] + </span><span class="s1">marks</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'distname,arg,normalization_ok,higher_ok,moment_ok,'</span>
                         <span class="s3">'is_xfailing'</span><span class="s2">,</span>
                         <span class="s1">cases_test_moments</span><span class="s2">())</span>
<span class="s0">def </span><span class="s1">test_moments</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">normalization_ok</span><span class="s2">, </span><span class="s1">higher_ok</span><span class="s2">, </span><span class="s1">moment_ok</span><span class="s2">,</span>
                 <span class="s1">is_xfailing</span><span class="s2">):</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s1">distfn </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s0">except </span><span class="s1">TypeError</span><span class="s2">:</span>
        <span class="s1">distfn </span><span class="s2">= </span><span class="s1">distname</span>
        <span class="s1">distname </span><span class="s2">= </span><span class="s3">'rv_histogram_instance'</span>

    <span class="s0">with </span><span class="s1">npt</span><span class="s2">.</span><span class="s1">suppress_warnings</span><span class="s2">() </span><span class="s0">as </span><span class="s1">sup</span><span class="s2">:</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">IntegrationWarning</span><span class="s2">,</span>
                   <span class="s3">&quot;The integral is probably divergent, or slowly convergent.&quot;</span><span class="s2">)</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">IntegrationWarning</span><span class="s2">,</span>
                   <span class="s3">&quot;The maximum number of subdivisions.&quot;</span><span class="s2">)</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">IntegrationWarning</span><span class="s2">,</span>
                   <span class="s3">&quot;The algorithm does not converge.&quot;</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">is_xfailing</span><span class="s2">:</span>
            <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">IntegrationWarning</span><span class="s2">)</span>

        <span class="s1">m</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s1">k </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(*</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">moments</span><span class="s2">=</span><span class="s3">'mvsk'</span><span class="s2">)</span>

        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">all</span><span class="s2">=</span><span class="s3">&quot;ignore&quot;</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">normalization_ok</span><span class="s2">:</span>
                <span class="s1">check_normalization</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>

            <span class="s0">if </span><span class="s1">higher_ok</span><span class="s2">:</span>
                <span class="s1">check_mean_expect</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
                <span class="s1">check_skew_expect</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">s</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
                <span class="s1">check_var_expect</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
                <span class="s1">check_kurt_expect</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
                <span class="s1">check_munp_expect</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>

        <span class="s1">check_loc_scale</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">moment_ok</span><span class="s2">:</span>
            <span class="s1">check_moment</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'dist,shape_args'</span><span class="s2">, </span><span class="s1">distcont</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_rvs_broadcast</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">shape_args</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">dist </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'gausshyper'</span><span class="s2">, </span><span class="s3">'studentized_range'</span><span class="s2">]:</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">&quot;too slow&quot;</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">dist </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'rel_breitwigner'</span><span class="s2">] </span><span class="s0">and </span><span class="s1">_IS_32BIT</span><span class="s2">:</span>
        <span class="s4"># gh18414</span>
        <span class="s1">pytest</span><span class="s2">.</span><span class="s1">skip</span><span class="s2">(</span><span class="s3">&quot;fails on Linux 32-bit&quot;</span><span class="s2">)</span>

    <span class="s4"># If shape_only is True, it means the _rvs method of the</span>
    <span class="s4"># distribution uses more than one random number to generate a random</span>
    <span class="s4"># variate.  That means the result of using rvs with broadcasting or</span>
    <span class="s4"># with a nontrivial size will not necessarily be the same as using the</span>
    <span class="s4"># numpy.vectorize'd version of rvs(), so we can only compare the shapes</span>
    <span class="s4"># of the results, not the values.</span>
    <span class="s4"># Whether or not a distribution is in the following list is an</span>
    <span class="s4"># implementation detail of the distribution, not a requirement.  If</span>
    <span class="s4"># the implementation the rvs() method of a distribution changes, this</span>
    <span class="s4"># test might also have to be changed.</span>
    <span class="s1">shape_only </span><span class="s2">= </span><span class="s1">dist </span><span class="s0">in </span><span class="s2">[</span><span class="s3">'argus'</span><span class="s2">, </span><span class="s3">'betaprime'</span><span class="s2">, </span><span class="s3">'dgamma'</span><span class="s2">, </span><span class="s3">'dweibull'</span><span class="s2">,</span>
                          <span class="s3">'exponnorm'</span><span class="s2">, </span><span class="s3">'genhyperbolic'</span><span class="s2">, </span><span class="s3">'geninvgauss'</span><span class="s2">,</span>
                          <span class="s3">'levy_stable'</span><span class="s2">, </span><span class="s3">'nct'</span><span class="s2">, </span><span class="s3">'norminvgauss'</span><span class="s2">, </span><span class="s3">'rice'</span><span class="s2">,</span>
                          <span class="s3">'skewnorm'</span><span class="s2">, </span><span class="s3">'semicircular'</span><span class="s2">, </span><span class="s3">'gennorm'</span><span class="s2">, </span><span class="s3">'loggamma'</span><span class="s2">]</span>

    <span class="s1">distfunc </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">dist</span><span class="s2">)</span>
    <span class="s1">loc </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)</span>
    <span class="s1">scale </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">((</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">nargs </span><span class="s2">= </span><span class="s1">distfunc</span><span class="s2">.</span><span class="s1">numargs</span>
    <span class="s1">allargs </span><span class="s2">= []</span>
    <span class="s1">bshape </span><span class="s2">= [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s4"># Generate shape parameter arguments...</span>
    <span class="s0">for </span><span class="s1">k </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">nargs</span><span class="s2">):</span>
        <span class="s1">shp </span><span class="s2">= (</span><span class="s1">k </span><span class="s2">+ </span><span class="s5">4</span><span class="s2">,) + (</span><span class="s5">1</span><span class="s2">,)*(</span><span class="s1">k </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">)</span>
        <span class="s1">allargs</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">shape_args</span><span class="s2">[</span><span class="s1">k</span><span class="s2">]*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s1">shp</span><span class="s2">))</span>
        <span class="s1">bshape</span><span class="s2">.</span><span class="s1">insert</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">k </span><span class="s2">+ </span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">allargs</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">([</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">])</span>
    <span class="s4"># bshape holds the expected shape when loc, scale, and the shape</span>
    <span class="s4"># parameters are all broadcast together.</span>

    <span class="s1">check_rvs_broadcast</span><span class="s2">(</span><span class="s1">distfunc</span><span class="s2">, </span><span class="s1">dist</span><span class="s2">, </span><span class="s1">allargs</span><span class="s2">, </span><span class="s1">bshape</span><span class="s2">, </span><span class="s1">shape_only</span><span class="s2">, </span><span class="s3">'d'</span><span class="s2">)</span>


<span class="s4"># Expected values of the SF, CDF, PDF were computed using</span>
<span class="s4"># mpmath with mpmath.mp.dps = 50 and output at 20:</span>
<span class="s4">#</span>
<span class="s4"># def ks(x, n):</span>
<span class="s4">#     x = mpmath.mpf(x)</span>
<span class="s4">#     logp = -mpmath.power(6.0*n*x+1.0, 2)/18.0/n</span>
<span class="s4">#     sf, cdf = mpmath.exp(logp), -mpmath.expm1(logp)</span>
<span class="s4">#     pdf = (6.0*n*x+1.0) * 2 * sf/3</span>
<span class="s4">#     print(mpmath.nstr(sf, 20), mpmath.nstr(cdf, 20), mpmath.nstr(pdf, 20))</span>
<span class="s4">#</span>
<span class="s4"># Tests use 1/n &lt; x &lt; 1-1/n and n &gt; 1e6 to use the asymptotic computation.</span>
<span class="s4"># Larger x has a smaller sf.</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'x,n,sf,cdf,pdf,rtol'</span><span class="s2">,</span>
                         <span class="s2">[(</span><span class="s5">2.0e-5</span><span class="s2">, </span><span class="s5">1000000000</span><span class="s2">,</span>
                           <span class="s5">0.44932297307934442379</span><span class="s2">, </span><span class="s5">0.55067702692065557621</span><span class="s2">,</span>
                           <span class="s5">35946.137394996276407</span><span class="s2">, </span><span class="s5">5e-15</span><span class="s2">),</span>
                          <span class="s2">(</span><span class="s5">2.0e-9</span><span class="s2">, </span><span class="s5">1000000000</span><span class="s2">,</span>
                           <span class="s5">0.99999999061111115519</span><span class="s2">, </span><span class="s5">9.3888888448132728224e-9</span><span class="s2">,</span>
                           <span class="s5">8.6666665852962971765</span><span class="s2">, </span><span class="s5">5e-14</span><span class="s2">),</span>
                          <span class="s2">(</span><span class="s5">5.0e-4</span><span class="s2">, </span><span class="s5">1000000000</span><span class="s2">,</span>
                           <span class="s5">7.1222019433090374624e-218</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">,</span>
                           <span class="s5">1.4244408634752704094e-211</span><span class="s2">, </span><span class="s5">5e-14</span><span class="s2">)])</span>
<span class="s0">def </span><span class="s1">test_gh17775_regression</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">sf</span><span class="s2">, </span><span class="s1">cdf</span><span class="s2">, </span><span class="s1">pdf</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">):</span>
    <span class="s4"># Regression test for gh-17775. In scipy 1.9.3 and earlier,</span>
    <span class="s4"># these test would fail.</span>
    <span class="s4">#</span>
    <span class="s4"># KS one asymptotic sf ~ e^(-(6nx+1)^2 / 18n)</span>
    <span class="s4"># Given a large 32-bit integer n, 6n will overflow in the c implementation.</span>
    <span class="s4"># Example of broken behaviour:</span>
    <span class="s4"># ksone.sf(2.0e-5, 1000000000) == 0.9374359693473666</span>
    <span class="s1">ks </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">ksone</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">ks</span><span class="s2">.</span><span class="s1">sf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">), </span><span class="s1">ks</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">), </span><span class="s1">ks</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)])</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">sf</span><span class="s2">, </span><span class="s1">cdf</span><span class="s2">, </span><span class="s1">pdf</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s1">rtol</span><span class="s2">)</span>
    <span class="s4"># The sf+cdf must sum to 1.0.</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] + </span><span class="s1">vals</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s5">1.0</span><span class="s2">)</span>
    <span class="s4"># Check inverting the (potentially very small) sf (uses a lower tolerance)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">([</span><span class="s1">ks</span><span class="s2">.</span><span class="s1">isf</span><span class="s2">(</span><span class="s1">sf</span><span class="s2">, </span><span class="s1">n</span><span class="s2">)], [</span><span class="s1">x</span><span class="s2">], </span><span class="s1">rtol</span><span class="s2">=</span><span class="s5">1e-8</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_rvs_gh2069_regression</span><span class="s2">():</span>
    <span class="s4"># Regression tests for gh-2069.  In scipy 0.17 and earlier,</span>
    <span class="s4"># these tests would fail.</span>
    <span class="s4">#</span>
    <span class="s4"># A typical example of the broken behavior:</span>
    <span class="s4"># &gt;&gt;&gt; norm.rvs(loc=np.zeros(5), scale=np.ones(5))</span>
    <span class="s4"># array([-2.49613705, -2.49613705, -2.49613705, -2.49613705, -2.49613705])</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">RandomState</span><span class="s2">(</span><span class="s5">123</span><span class="s2">)</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">scale</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">d </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">), </span><span class="s3">&quot;All the values are equal, but they shouldn't be!&quot;</span><span class="s2">)</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">d </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">), </span><span class="s3">&quot;All the values are equal, but they shouldn't be!&quot;</span><span class="s2">)</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">zeros</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">5</span><span class="s2">), </span><span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">d </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">), </span><span class="s3">&quot;All the values are equal, but they shouldn't be!&quot;</span><span class="s2">)</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">]]), </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">5</span><span class="s2">),</span>
                          <span class="s1">random_state</span><span class="s2">=</span><span class="s1">rng</span><span class="s2">)</span>
    <span class="s1">d </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">diff</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">.</span><span class="s1">ravel</span><span class="s2">())</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">d </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">), </span><span class="s3">&quot;All the values are equal, but they shouldn't be!&quot;</span><span class="s2">)</span>

    <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">, [[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">]],</span>
                  <span class="s2">[[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]], </span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">gamma</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">, [</span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">], </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, (</span><span class="s5">2</span><span class="s2">, </span><span class="s5">2</span><span class="s2">))</span>
    <span class="s1">assert_raises</span><span class="s2">(</span><span class="s1">ValueError</span><span class="s2">, </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">gamma</span><span class="s2">.</span><span class="s1">rvs</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">],</span>
                  <span class="s2">[[</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">]], (</span><span class="s5">4</span><span class="s2">,))</span>


<span class="s0">def </span><span class="s1">test_nomodify_gh9900_regression</span><span class="s2">():</span>
    <span class="s4"># Regression test for gh-9990</span>
    <span class="s4"># Prior to gh-9990, calls to stats.truncnorm._cdf() use what ever was</span>
    <span class="s4"># set inside the stats.truncnorm instance during stats.truncnorm.cdf().</span>
    <span class="s4"># This could cause issues with multi-threaded code.</span>
    <span class="s4"># Since then, the calls to cdf() are not permitted to modify the global</span>
    <span class="s4"># stats.truncnorm instance.</span>
    <span class="s1">tn </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">truncnorm</span>
    <span class="s4"># Use the right-half truncated normal</span>
    <span class="s4"># Check that the cdf and _cdf return the same result.</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">),</span>
                            <span class="s5">0.6826894921370859</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">_cdf</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">]),</span>
                            <span class="s5">0.6826894921370859</span><span class="s2">)</span>

    <span class="s4"># Now use the left-half truncated normal</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">0</span><span class="s2">),</span>
                            <span class="s5">0.31731050786291415</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">_cdf</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">], [-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">]),</span>
                            <span class="s5">0.31731050786291415</span><span class="s2">)</span>

    <span class="s4"># Check that the right-half truncated normal _cdf hasn't changed</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">_cdf</span><span class="s2">([</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">], [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">]),</span>
                            <span class="s5">0.6826894921370859</span><span class="s2">)  </span><span class="s4"># Not 1.6826894921370859</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">),</span>
                            <span class="s5">0.6826894921370859</span><span class="s2">)</span>

    <span class="s4"># Check that the left-half truncated normal _cdf hasn't changed</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">_cdf</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">], [-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">], [</span><span class="s5">0</span><span class="s2">]),</span>
                            <span class="s5">0.31731050786291415</span><span class="s2">)  </span><span class="s4"># Not -0.6826894921370859</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">0</span><span class="s2">),</span>
                            <span class="s5">1</span><span class="s2">)  </span><span class="s4"># Not 1.6826894921370859</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">tn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">0</span><span class="s2">),</span>
                            <span class="s5">0.31731050786291415</span><span class="s2">)  </span><span class="s4"># Not -0.6826894921370859</span>


<span class="s0">def </span><span class="s1">test_broadcast_gh9990_regression</span><span class="s2">():</span>
    <span class="s4"># Regression test for gh-9990</span>
    <span class="s4"># The x-value 7 only lies within the support of 4 of the supplied</span>
    <span class="s4"># distributions.  Prior to 9990, one array passed to</span>
    <span class="s4"># stats.reciprocal._cdf would have 4 elements, but an array</span>
    <span class="s4"># previously stored by stats.reciprocal_argcheck() would have 6, leading</span>
    <span class="s4"># to a broadcast error.</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">6</span><span class="s2">])</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">8</span><span class="s2">, </span><span class="s5">16</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">32</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">48</span><span class="s2">])</span>
    <span class="s1">ans </span><span class="s2">= [</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">reciprocal</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_b</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">,</span><span class="s1">b</span><span class="s2">)]</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">reciprocal</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s5">7</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">), </span><span class="s1">ans</span><span class="s2">)</span>

    <span class="s1">ans </span><span class="s2">= [</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">reciprocal</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_b</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">,</span><span class="s1">b</span><span class="s2">)]</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">reciprocal</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">), </span><span class="s1">ans</span><span class="s2">)</span>

    <span class="s1">ans </span><span class="s2">= [</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">reciprocal</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_b</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">,</span><span class="s1">b</span><span class="s2">)]</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">reciprocal</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">), </span><span class="s1">ans</span><span class="s2">)</span>

    <span class="s1">ans </span><span class="s2">= [</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">reciprocal</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">_b</span><span class="s2">, </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_b</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">_b </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">a</span><span class="s2">,</span><span class="s1">b</span><span class="s2">)]</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">reciprocal</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">b</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">), </span><span class="s1">ans</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_broadcast_gh7933_regression</span><span class="s2">():</span>
    <span class="s4"># Check broadcast works</span>
    <span class="s1">stats</span><span class="s2">.</span><span class="s1">truncnorm</span><span class="s2">.</span><span class="s1">logpdf</span><span class="s2">(</span>
        <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">3.0</span><span class="s2">, </span><span class="s5">2.0</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">]),</span>
        <span class="s1">a</span><span class="s2">=(</span><span class="s5">1.5 </span><span class="s2">- </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">6.0</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">])) / </span><span class="s5">3.0</span><span class="s2">,</span>
        <span class="s1">b</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">,</span>
        <span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">6.0</span><span class="s2">, </span><span class="s5">5.0</span><span class="s2">, </span><span class="s5">4.0</span><span class="s2">]),</span>
        <span class="s1">scale</span><span class="s2">=</span><span class="s5">3.0</span>
    <span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_gh2002_regression</span><span class="s2">():</span>
    <span class="s4"># Add a check that broadcast works in situations where only some</span>
    <span class="s4"># x-values are compatible with some of the shape arguments.</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">r_</span><span class="s2">[-</span><span class="s5">2</span><span class="s2">:</span><span class="s5">2</span><span class="s2">:</span><span class="s5">101j</span><span class="s2">]</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">r_</span><span class="s2">[-</span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">50</span><span class="s2">), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ones</span><span class="s2">(</span><span class="s5">51</span><span class="s2">)]</span>
    <span class="s1">expected </span><span class="s2">= [</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">truncnorm</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">_x</span><span class="s2">, </span><span class="s1">_a</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_x</span><span class="s2">, </span><span class="s1">_a </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)]</span>
    <span class="s1">ans </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">truncnorm</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_array_almost_equal</span><span class="s2">(</span><span class="s1">ans</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_gh1320_regression</span><span class="s2">():</span>
    <span class="s4"># Check that the first example from gh-1320 now works.</span>
    <span class="s1">c </span><span class="s2">= </span><span class="s5">2.62</span>
    <span class="s1">stats</span><span class="s2">.</span><span class="s1">genextreme</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s1">c</span><span class="s2">], [</span><span class="s1">c </span><span class="s2">+ </span><span class="s5">0.5</span><span class="s2">]]))</span>
    <span class="s4"># The other examples in gh-1320 appear to have stopped working</span>
    <span class="s4"># some time ago.</span>
    <span class="s4"># ans = stats.genextreme.moment(2, np.array([c, c + 0.5]))</span>
    <span class="s4"># expected = np.array([25.50105963, 115.11191437])</span>
    <span class="s4"># stats.genextreme.moment(5, np.array([[c], [c + 0.5]]))</span>
    <span class="s4"># stats.genextreme.moment(5, np.array([c, c + 0.5]))</span>


<span class="s0">def </span><span class="s1">test_method_of_moments</span><span class="s2">():</span>
    <span class="s4"># example from https://en.wikipedia.org/wiki/Method_of_moments_(statistics)</span>
    <span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">(</span><span class="s5">1234</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">]</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s5">1</span><span class="s2">/</span><span class="s5">5 </span><span class="s2">- </span><span class="s5">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)/</span><span class="s5">5</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s5">1</span><span class="s2">/</span><span class="s5">5 </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">*</span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">3</span><span class="s2">)/</span><span class="s5">5</span>
    <span class="s4"># force use of method of moments (uniform.fit is overridden)</span>
    <span class="s1">loc</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s1">super</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">), </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">).</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s3">&quot;MM&quot;</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">+</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">4</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_sample_meanvar_</span><span class="s2">(</span><span class="s1">popmean</span><span class="s2">, </span><span class="s1">popvar</span><span class="s2">, </span><span class="s1">sample</span><span class="s2">):</span>
    <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">popmean</span><span class="s2">):</span>
        <span class="s1">check_sample_mean</span><span class="s2">(</span><span class="s1">sample</span><span class="s2">, </span><span class="s1">popmean</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">popvar</span><span class="s2">):</span>
        <span class="s1">check_sample_var</span><span class="s2">(</span><span class="s1">sample</span><span class="s2">, </span><span class="s1">popvar</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_sample_mean</span><span class="s2">(</span><span class="s1">sample</span><span class="s2">, </span><span class="s1">popmean</span><span class="s2">):</span>
    <span class="s4"># Checks for unlikely difference between sample mean and population mean</span>
    <span class="s1">prob </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">ttest_1samp</span><span class="s2">(</span><span class="s1">sample</span><span class="s2">, </span><span class="s1">popmean</span><span class="s2">).</span><span class="s1">pvalue</span>
    <span class="s0">assert </span><span class="s1">prob </span><span class="s2">&gt; </span><span class="s5">0.01</span>


<span class="s0">def </span><span class="s1">check_sample_var</span><span class="s2">(</span><span class="s1">sample</span><span class="s2">, </span><span class="s1">popvar</span><span class="s2">):</span>
    <span class="s4"># check that population mean lies within the CI bootstrapped from the</span>
    <span class="s4"># sample. This used to be a chi-squared test for variance, but there were</span>
    <span class="s4"># too many false positives</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">bootstrap</span><span class="s2">(</span>
        <span class="s2">(</span><span class="s1">sample</span><span class="s2">,),</span>
        <span class="s0">lambda </span><span class="s1">x</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">: </span><span class="s1">x</span><span class="s2">.</span><span class="s1">var</span><span class="s2">(</span><span class="s1">ddof</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">axis</span><span class="s2">=</span><span class="s1">axis</span><span class="s2">),</span>
        <span class="s1">confidence_level</span><span class="s2">=</span><span class="s5">0.995</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">conf </span><span class="s2">= </span><span class="s1">res</span><span class="s2">.</span><span class="s1">confidence_interval</span>
    <span class="s1">low</span><span class="s2">, </span><span class="s1">high </span><span class="s2">= </span><span class="s1">conf</span><span class="s2">.</span><span class="s1">low</span><span class="s2">, </span><span class="s1">conf</span><span class="s2">.</span><span class="s1">high</span>
    <span class="s0">assert </span><span class="s1">low </span><span class="s2">&lt;= </span><span class="s1">popvar </span><span class="s2">&lt;= </span><span class="s1">high</span>


<span class="s0">def </span><span class="s1">check_cdf_ppf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s1">values </span><span class="s2">= [</span><span class="s5">0.001</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.999</span><span class="s2">]</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s1">values</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">), *</span><span class="s1">arg</span><span class="s2">),</span>
                            <span class="s1">values</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">DECIMAL</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg </span><span class="s2">+</span>
                            <span class="s3">' - cdf-ppf roundtrip'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_sf_isf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">sf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">isf</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">], *</span><span class="s1">arg</span><span class="s2">), *</span><span class="s1">arg</span><span class="s2">),</span>
                            <span class="s2">[</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">], </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">DECIMAL</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg </span><span class="s2">+</span>
                            <span class="s3">' - sf-isf roundtrip'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_cdf_sf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">], *</span><span class="s1">arg</span><span class="s2">),</span>
                            <span class="s5">1.0 </span><span class="s2">- </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">sf</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">], *</span><span class="s1">arg</span><span class="s2">),</span>
                            <span class="s1">decimal</span><span class="s2">=</span><span class="s1">DECIMAL</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg </span><span class="s2">+</span>
                            <span class="s3">' - cdf-sf relationship'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_ppf_isf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s1">p </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">isf</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">), </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s5">1</span><span class="s2">-</span><span class="s1">p</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">),</span>
                            <span class="s1">decimal</span><span class="s2">=</span><span class="s1">DECIMAL</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg </span><span class="s2">+</span>
                            <span class="s3">' - ppf-isf relationship'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_pdf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s4"># compares pdf at median with numerical derivative of cdf</span>
    <span class="s1">median </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s1">eps </span><span class="s2">= </span><span class="s5">1e-6</span>
    <span class="s1">pdfv </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">median</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">pdfv </span><span class="s2">&lt; </span><span class="s5">1e-4</span><span class="s2">) </span><span class="s0">or </span><span class="s2">(</span><span class="s1">pdfv </span><span class="s2">&gt; </span><span class="s5">1e4</span><span class="s2">):</span>
        <span class="s4"># avoid checking a case where pdf is close to zero or</span>
        <span class="s4"># huge (singularity)</span>
        <span class="s1">median </span><span class="s2">= </span><span class="s1">median </span><span class="s2">+ </span><span class="s5">0.1</span>
        <span class="s1">pdfv </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">median</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s1">cdfdiff </span><span class="s2">= (</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">median </span><span class="s2">+ </span><span class="s1">eps</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">) -</span>
               <span class="s1">distfn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">median </span><span class="s2">- </span><span class="s1">eps</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">))/</span><span class="s1">eps</span><span class="s2">/</span><span class="s5">2.0</span>
    <span class="s4"># replace with better diff and better test (more points),</span>
    <span class="s4"># actually, this works pretty well</span>
    <span class="s1">msg </span><span class="s2">+= </span><span class="s3">' - cdf-pdf relationship'</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">pdfv</span><span class="s2">, </span><span class="s1">cdfdiff</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s1">DECIMAL</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_pdf_logpdf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s4"># compares pdf at several points with the log of the pdf</span>
    <span class="s1">points </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">0.8</span><span class="s2">])</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s1">points</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">vals</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)]</span>
    <span class="s1">pdf </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">logpdf </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">logpdf</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">pdf </span><span class="s2">= </span><span class="s1">pdf</span><span class="s2">[(</span><span class="s1">pdf </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">) &amp; </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">pdf</span><span class="s2">)]</span>
    <span class="s1">logpdf </span><span class="s2">= </span><span class="s1">logpdf</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">logpdf</span><span class="s2">)]</span>
    <span class="s1">msg </span><span class="s2">+= </span><span class="s3">&quot; - logpdf-log(pdf) relationship&quot;</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s1">pdf</span><span class="s2">), </span><span class="s1">logpdf</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">7</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_pdf_logpdf_at_endpoints</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s4"># compares pdf with the log of the pdf at the (finite) end points</span>
    <span class="s1">points </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s1">points</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">vals</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)]</span>
    <span class="s1">pdf </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">logpdf </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">logpdf</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">pdf </span><span class="s2">= </span><span class="s1">pdf</span><span class="s2">[(</span><span class="s1">pdf </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">) &amp; </span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">pdf</span><span class="s2">)]</span>
    <span class="s1">logpdf </span><span class="s2">= </span><span class="s1">logpdf</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">logpdf</span><span class="s2">)]</span>
    <span class="s1">msg </span><span class="s2">+= </span><span class="s3">&quot; - logpdf-log(pdf) relationship&quot;</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s1">pdf</span><span class="s2">), </span><span class="s1">logpdf</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">7</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_sf_logsf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s4"># compares sf at several points with the log of the sf</span>
    <span class="s1">points </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.0</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">0.8</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">])</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s1">points</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">vals</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)]</span>
    <span class="s1">sf </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">sf</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">logsf </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">logsf</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">sf </span><span class="s2">= </span><span class="s1">sf</span><span class="s2">[</span><span class="s1">sf </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">logsf </span><span class="s2">= </span><span class="s1">logsf</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">logsf</span><span class="s2">)]</span>
    <span class="s1">msg </span><span class="s2">+= </span><span class="s3">&quot; - logsf-log(sf) relationship&quot;</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s1">sf</span><span class="s2">), </span><span class="s1">logsf</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">7</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_cdf_logcdf</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s4"># compares cdf at several points with the log of the cdf</span>
    <span class="s1">points </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">, </span><span class="s5">0.3</span><span class="s2">, </span><span class="s5">0.4</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.6</span><span class="s2">, </span><span class="s5">0.7</span><span class="s2">, </span><span class="s5">0.8</span><span class="s2">, </span><span class="s5">1.0</span><span class="s2">])</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s1">points</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">vals </span><span class="s2">= </span><span class="s1">vals</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">)]</span>
    <span class="s1">cdf </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">cdf</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">logcdf </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">logcdf</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">cdf </span><span class="s2">= </span><span class="s1">cdf</span><span class="s2">[</span><span class="s1">cdf </span><span class="s2">!= </span><span class="s5">0</span><span class="s2">]</span>
    <span class="s1">logcdf </span><span class="s2">= </span><span class="s1">logcdf</span><span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isfinite</span><span class="s2">(</span><span class="s1">logcdf</span><span class="s2">)]</span>
    <span class="s1">msg </span><span class="s2">+= </span><span class="s3">&quot; - logcdf-log(cdf) relationship&quot;</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s1">cdf</span><span class="s2">), </span><span class="s1">logcdf</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">7</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_ppf_broadcast</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s4"># compares ppf for multiple argsets.</span>
    <span class="s1">num_repeats </span><span class="s2">= </span><span class="s5">5</span>
    <span class="s1">args </span><span class="s2">= [] * </span><span class="s1">num_repeats</span>
    <span class="s0">if </span><span class="s1">arg</span><span class="s2">:</span>
        <span class="s1">args </span><span class="s2">= [</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">_</span><span class="s2">] * </span><span class="s1">num_repeats</span><span class="s2">) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">arg</span><span class="s2">]</span>

    <span class="s1">median </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, *</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s1">medians </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">ppf</span><span class="s2">(</span><span class="s5">0.5</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">msg </span><span class="s2">+= </span><span class="s3">&quot; - ppf multiple&quot;</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">medians</span><span class="s2">, [</span><span class="s1">median</span><span class="s2">] * </span><span class="s1">num_repeats</span><span class="s2">, </span><span class="s1">decimal</span><span class="s2">=</span><span class="s5">7</span><span class="s2">, </span><span class="s1">err_msg</span><span class="s2">=</span><span class="s1">msg</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_distribution_rvs</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">alpha</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">):</span>
    <span class="s4"># dist is either a cdf function or name of a distribution in scipy.stats.</span>
    <span class="s4"># args are the args for scipy.stats.dist(*args)</span>
    <span class="s4"># alpha is a significance level, ~0.01</span>
    <span class="s4"># rvs is array_like of random variables</span>
    <span class="s4"># test from scipy.stats.tests</span>
    <span class="s4"># this version reuses existing random variables</span>
    <span class="s1">D</span><span class="s2">, </span><span class="s1">pval </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kstest</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">dist</span><span class="s2">, </span><span class="s1">args</span><span class="s2">=</span><span class="s1">args</span><span class="s2">, </span><span class="s1">N</span><span class="s2">=</span><span class="s5">1000</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">pval </span><span class="s2">&lt; </span><span class="s1">alpha</span><span class="s2">):</span>
        <span class="s4"># The rvs passed in failed the K-S test, which _could_ happen</span>
        <span class="s4"># but is unlikely if alpha is small enough.</span>
        <span class="s4"># Repeat the test with a new sample of rvs.</span>
        <span class="s4"># Generate 1000 rvs, perform a K-S test that the new sample of rvs</span>
        <span class="s4"># are distributed according to the distribution.</span>
        <span class="s1">D</span><span class="s2">, </span><span class="s1">pval </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kstest</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">dist</span><span class="s2">, </span><span class="s1">args</span><span class="s2">=</span><span class="s1">args</span><span class="s2">, </span><span class="s1">N</span><span class="s2">=</span><span class="s5">1000</span><span class="s2">)</span>
        <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">pval </span><span class="s2">&gt; </span><span class="s1">alpha</span><span class="s2">, </span><span class="s3">&quot;D = &quot; </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">(</span><span class="s1">D</span><span class="s2">) + </span><span class="s3">&quot;; pval = &quot; </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">(</span><span class="s1">pval</span><span class="s2">) +</span>
                    <span class="s3">&quot;; alpha = &quot; </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">(</span><span class="s1">alpha</span><span class="s2">) + </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">args = &quot; </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">(</span><span class="s1">args</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">check_vecentropy</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">args</span><span class="s2">):</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">vecentropy</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">), </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">_entropy</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">check_loc_scale</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">m</span><span class="s2">, </span><span class="s1">v</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s4"># Make `loc` and `scale` arrays to catch bugs like gh-13580 where</span>
    <span class="s4"># `loc` and `scale` arrays improperly broadcast with shapes.</span>
    <span class="s1">loc</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">10.0</span><span class="s2">, </span><span class="s5">20.0</span><span class="s2">]), </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">10.0</span><span class="s2">, </span><span class="s5">20.0</span><span class="s2">])</span>
    <span class="s1">mt</span><span class="s2">, </span><span class="s1">vt </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(*</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">m</span><span class="s2">*</span><span class="s1">scale </span><span class="s2">+ </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">mt</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">v</span><span class="s2">*</span><span class="s1">scale</span><span class="s2">*</span><span class="s1">scale</span><span class="s2">, </span><span class="s1">vt</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_ppf_private</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">):</span>
    <span class="s4"># fails by design for truncnorm self.nb not defined</span>
    <span class="s1">ppfs </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">_ppf</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0.9</span><span class="s2">]), *</span><span class="s1">arg</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s0">not </span><span class="s1">np</span><span class="s2">.</span><span class="s1">any</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">isnan</span><span class="s2">(</span><span class="s1">ppfs</span><span class="s2">)), </span><span class="s1">msg </span><span class="s2">+ </span><span class="s3">'ppf private is nan'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">check_retrieving_support</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">args</span><span class="s2">):</span>
    <span class="s1">loc</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span>
    <span class="s1">supp </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">support</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s1">supp_loc_scale </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">support</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_almost_equal</span><span class="s2">(</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">supp</span><span class="s2">)*</span><span class="s1">scale </span><span class="s2">+ </span><span class="s1">loc</span><span class="s2">,</span>
                            <span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">supp_loc_scale</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">check_fit_args</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">method</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">all</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">), </span><span class="s1">npt</span><span class="s2">.</span><span class="s1">suppress_warnings</span><span class="s2">() </span><span class="s0">as </span><span class="s1">sup</span><span class="s2">:</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">category</span><span class="s2">=</span><span class="s1">RuntimeWarning</span><span class="s2">,</span>
                   <span class="s1">message</span><span class="s2">=</span><span class="s3">&quot;The shape parameter of the erlang&quot;</span><span class="s2">)</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">category</span><span class="s2">=</span><span class="s1">RuntimeWarning</span><span class="s2">,</span>
                   <span class="s1">message</span><span class="s2">=</span><span class="s3">&quot;floating point number truncated&quot;</span><span class="s2">)</span>
        <span class="s1">vals </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>
        <span class="s1">vals2 </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">optimizer</span><span class="s2">=</span><span class="s3">'powell'</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>
    <span class="s4"># Only check the length of the return; accuracy tested in test_fit.py</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">+</span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">vals2</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">+</span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>


<span class="s0">def </span><span class="s1">check_fit_args_fix</span><span class="s2">(</span><span class="s1">distfn</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">method</span><span class="s2">):</span>
    <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">all</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">), </span><span class="s1">npt</span><span class="s2">.</span><span class="s1">suppress_warnings</span><span class="s2">() </span><span class="s0">as </span><span class="s1">sup</span><span class="s2">:</span>
        <span class="s1">sup</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">category</span><span class="s2">=</span><span class="s1">RuntimeWarning</span><span class="s2">,</span>
                   <span class="s1">message</span><span class="s2">=</span><span class="s3">&quot;The shape parameter of the erlang&quot;</span><span class="s2">)</span>

        <span class="s1">vals </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">floc</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>
        <span class="s1">vals2 </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">fscale</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>
        <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">+</span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>
        <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">vals</span><span class="s2">[-</span><span class="s5">2</span><span class="s2">] == </span><span class="s5">0</span><span class="s2">)</span>
        <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">vals2</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] == </span><span class="s5">1</span><span class="s2">)</span>
        <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">vals2</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">+</span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) &gt; </span><span class="s5">0</span><span class="s2">:</span>
            <span class="s1">vals3 </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">f0</span><span class="s2">=</span><span class="s1">arg</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>
            <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">vals3</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">+</span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>
            <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">vals3</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s1">arg</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) &gt; </span><span class="s5">1</span><span class="s2">:</span>
            <span class="s1">vals4 </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">f1</span><span class="s2">=</span><span class="s1">arg</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>
            <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">vals4</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">+</span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>
            <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">vals4</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] == </span><span class="s1">arg</span><span class="s2">[</span><span class="s5">1</span><span class="s2">])</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) &gt; </span><span class="s5">2</span><span class="s2">:</span>
            <span class="s1">vals5 </span><span class="s2">= </span><span class="s1">distfn</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">(</span><span class="s1">rvs</span><span class="s2">, </span><span class="s1">f2</span><span class="s2">=</span><span class="s1">arg</span><span class="s2">[</span><span class="s5">2</span><span class="s2">], </span><span class="s1">method</span><span class="s2">=</span><span class="s1">method</span><span class="s2">)</span>
            <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">len</span><span class="s2">(</span><span class="s1">vals5</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">+</span><span class="s1">len</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">))</span>
            <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_</span><span class="s2">(</span><span class="s1">vals5</span><span class="s2">[</span><span class="s5">2</span><span class="s2">] == </span><span class="s1">arg</span><span class="s2">[</span><span class="s5">2</span><span class="s2">])</span>


<span class="s0">def </span><span class="s1">cases_test_methods_with_lists</span><span class="s2">():</span>
    <span class="s0">for </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg </span><span class="s0">in </span><span class="s1">distcont</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">distname </span><span class="s0">in </span><span class="s1">slow_with_lists</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">param</span><span class="s2">(</span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span><span class="s2">, </span><span class="s1">marks</span><span class="s2">=</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">arg</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'method'</span><span class="s2">, [</span><span class="s3">'pdf'</span><span class="s2">, </span><span class="s3">'logpdf'</span><span class="s2">, </span><span class="s3">'cdf'</span><span class="s2">, </span><span class="s3">'logcdf'</span><span class="s2">,</span>
                                    <span class="s3">'sf'</span><span class="s2">, </span><span class="s3">'logsf'</span><span class="s2">, </span><span class="s3">'ppf'</span><span class="s2">, </span><span class="s3">'isf'</span><span class="s2">])</span>
<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'distname, args'</span><span class="s2">, </span><span class="s1">cases_test_methods_with_lists</span><span class="s2">())</span>
<span class="s0">def </span><span class="s1">test_methods_with_lists</span><span class="s2">(</span><span class="s1">method</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">, </span><span class="s1">args</span><span class="s2">):</span>
    <span class="s4"># Test that the continuous distributions can accept Python lists</span>
    <span class="s4"># as arguments.</span>
    <span class="s1">dist </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">, </span><span class="s1">distname</span><span class="s2">)</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">dist</span><span class="s2">, </span><span class="s1">method</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">distname </span><span class="s2">== </span><span class="s3">'invweibull' </span><span class="s0">and </span><span class="s1">method</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s3">'log'</span><span class="s2">):</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">2</span><span class="s2">]</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">x </span><span class="s2">= [</span><span class="s5">0.1</span><span class="s2">, </span><span class="s5">0.2</span><span class="s2">]</span>

    <span class="s1">shape2 </span><span class="s2">= [[</span><span class="s1">a</span><span class="s2">]*</span><span class="s5">2 </span><span class="s0">for </span><span class="s1">a </span><span class="s0">in </span><span class="s1">args</span><span class="s2">]</span>
    <span class="s1">loc </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0.1</span><span class="s2">]</span>
    <span class="s1">scale </span><span class="s2">= [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1.01</span><span class="s2">]</span>
    <span class="s1">result </span><span class="s2">= </span><span class="s1">f</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, *</span><span class="s1">shape2</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">result</span><span class="s2">,</span>
                        <span class="s2">[</span><span class="s1">f</span><span class="s2">(*</span><span class="s1">v</span><span class="s2">) </span><span class="s0">for </span><span class="s1">v </span><span class="s0">in </span><span class="s1">zip</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, *</span><span class="s1">shape2</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">)],</span>
                        <span class="s1">rtol</span><span class="s2">=</span><span class="s5">1e-14</span><span class="s2">, </span><span class="s1">atol</span><span class="s2">=</span><span class="s5">5e-14</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_burr_fisk_moment_gh13234_regression</span><span class="s2">():</span>
    <span class="s1">vals0 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">burr</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">5</span><span class="s2">, </span><span class="s5">4</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">vals0</span><span class="s2">, </span><span class="s1">float</span><span class="s2">)</span>

    <span class="s1">vals1 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">fisk</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s5">8</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">vals1</span><span class="s2">, </span><span class="s1">float</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_moments_with_array_gh12192_regression</span><span class="s2">():</span>
    <span class="s4"># array loc and scalar scale</span>
    <span class="s1">vals0 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]), </span><span class="s1">scale</span><span class="s2">=</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">expected0 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals0</span><span class="s2">, </span><span class="s1">expected0</span><span class="s2">)</span>

    <span class="s4"># array loc and invalid scalar scale</span>
    <span class="s1">vals1 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]), </span><span class="s1">scale</span><span class="s2">=-</span><span class="s5">1</span><span class="s2">)</span>
    <span class="s1">expected1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals1</span><span class="s2">, </span><span class="s1">expected1</span><span class="s2">)</span>

    <span class="s4"># array loc and array scale with invalid entries</span>
    <span class="s1">vals2 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]),</span>
                              <span class="s1">scale</span><span class="s2">=[-</span><span class="s5">3</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>
    <span class="s1">expected2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals2</span><span class="s2">, </span><span class="s1">expected2</span><span class="s2">)</span>

    <span class="s4"># (loc == 0) &amp; (scale &lt; 0)</span>
    <span class="s1">vals3 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=-</span><span class="s5">4</span><span class="s2">)</span>
    <span class="s1">expected3 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals3</span><span class="s2">, </span><span class="s1">expected3</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">vals3</span><span class="s2">, </span><span class="s1">expected3</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">)</span>

    <span class="s4"># array loc with 0 entries and scale with invalid entries</span>
    <span class="s1">vals4 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">], </span><span class="s1">scale</span><span class="s2">=[</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">4</span><span class="s2">, -</span><span class="s5">5</span><span class="s2">])</span>
    <span class="s1">expected4 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">10.</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals4</span><span class="s2">, </span><span class="s1">expected4</span><span class="s2">)</span>

    <span class="s4"># all(loc == 0) &amp; (array scale with invalid entries)</span>
    <span class="s1">vals5 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s1">scale</span><span class="s2">=[</span><span class="s5">5.</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, </span><span class="s5">100.</span><span class="s2">])</span>
    <span class="s1">expected5 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">25.</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">10000.</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals5</span><span class="s2">, </span><span class="s1">expected5</span><span class="s2">)</span>

    <span class="s4"># all( (loc == 0) &amp; (scale &lt; 0) )</span>
    <span class="s1">vals6 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=[</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s2">], </span><span class="s1">scale</span><span class="s2">=[-</span><span class="s5">5.</span><span class="s2">, -</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">100.</span><span class="s2">])</span>
    <span class="s1">expected6 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals6</span><span class="s2">, </span><span class="s1">expected6</span><span class="s2">)</span>

    <span class="s4"># scalar args, loc, and scale</span>
    <span class="s1">vals7 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">chi</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">df</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">expected7 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals7</span><span class="s2">, </span><span class="s1">expected7</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">vals7</span><span class="s2">, </span><span class="s1">expected7</span><span class="s2">.</span><span class="s1">__class__</span><span class="s2">)</span>

    <span class="s4"># array args, scalar loc, and scalar scale</span>
    <span class="s1">vals8 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">chi</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">df</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">0</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">expected8 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals8</span><span class="s2">, </span><span class="s1">expected8</span><span class="s2">)</span>

    <span class="s4"># array args, array loc, and array scale</span>
    <span class="s1">vals9 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">chi</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">df</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=[</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">],</span>
                             <span class="s1">scale</span><span class="s2">=[</span><span class="s5">1.</span><span class="s2">, -</span><span class="s5">3.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">])</span>
    <span class="s1">expected9 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">3.59576912</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">vals9</span><span class="s2">, </span><span class="s1">expected9</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s5">1e-8</span><span class="s2">)</span>

    <span class="s4"># (n &gt; 4), all(loc != 0), and all(scale != 0)</span>
    <span class="s1">vals10 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s5">5</span><span class="s2">, [</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">], [</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">])</span>
    <span class="s1">expected10 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">26.</span><span class="s2">, </span><span class="s5">832.</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">vals10</span><span class="s2">, </span><span class="s1">expected10</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s5">1e-13</span><span class="s2">)</span>

    <span class="s4"># test broadcasting and more</span>
    <span class="s1">a </span><span class="s2">= [-</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">]</span>
    <span class="s1">b </span><span class="s2">= [-</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">]</span>
    <span class="s1">loc </span><span class="s2">= [-</span><span class="s5">1.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">2</span><span class="s2">)]</span>
    <span class="s1">scale </span><span class="s2">= [-</span><span class="s5">2.1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">2.2</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">pi</span><span class="s2">]</span>

    <span class="s1">a </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">a</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">b</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">loc </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">loc</span><span class="s2">).</span><span class="s1">reshape</span><span class="s2">((-</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">))</span>
    <span class="s1">scale </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">)</span>

    <span class="s1">vals11 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">beta</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">a</span><span class="s2">=</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">=</span><span class="s1">b</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">)</span>

    <span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">broadcast_arrays</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">)</span>

    <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">np</span><span class="s2">.</span><span class="s1">ndenumerate</span><span class="s2">(</span><span class="s1">a</span><span class="s2">):</span>
        <span class="s0">with </span><span class="s1">np</span><span class="s2">.</span><span class="s1">errstate</span><span class="s2">(</span><span class="s1">invalid</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">, </span><span class="s1">divide</span><span class="s2">=</span><span class="s3">'ignore'</span><span class="s2">):</span>
            <span class="s1">i </span><span class="s2">= </span><span class="s1">i</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]  </span><span class="s4"># just get the index</span>
            <span class="s4"># check against same function with scalar input</span>
            <span class="s1">expected </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">beta</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">2</span><span class="s2">, </span><span class="s1">a</span><span class="s2">=</span><span class="s1">a</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">b</span><span class="s2">=</span><span class="s1">b</span><span class="s2">[</span><span class="s1">i</span><span class="s2">],</span>
                                         <span class="s1">loc</span><span class="s2">=</span><span class="s1">loc</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">scale</span><span class="s2">=</span><span class="s1">scale</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
            <span class="s1">np</span><span class="s2">.</span><span class="s1">testing</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals11</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">expected</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_broadcasting_in_moments_gh12192_regression</span><span class="s2">():</span>
    <span class="s1">vals0 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">]), </span><span class="s1">scale</span><span class="s2">=[[</span><span class="s5">1</span><span class="s2">]])</span>
    <span class="s1">expected0 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">]])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals0</span><span class="s2">, </span><span class="s1">expected0</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">vals0</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== </span><span class="s1">expected0</span><span class="s2">.</span><span class="s1">shape</span>

    <span class="s1">vals1 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">=</span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1</span><span class="s2">], [</span><span class="s5">2</span><span class="s2">], [</span><span class="s5">3</span><span class="s2">]]),</span>
                              <span class="s1">scale</span><span class="s2">=[</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">expected1 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">], [</span><span class="s5">2.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">], [</span><span class="s5">3.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">]])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">vals1</span><span class="s2">, </span><span class="s1">expected1</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">vals1</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== </span><span class="s1">expected1</span><span class="s2">.</span><span class="s1">shape</span>

    <span class="s1">vals2 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">chi</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">df</span><span class="s2">=[</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">], </span><span class="s1">loc</span><span class="s2">=</span><span class="s5">0.</span><span class="s2">, </span><span class="s1">scale</span><span class="s2">=</span><span class="s5">1.</span><span class="s2">)</span>
    <span class="s1">expected2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">0.79788456</span><span class="s2">, </span><span class="s5">1.25331414</span><span class="s2">, </span><span class="s5">1.59576912</span><span class="s2">])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">vals2</span><span class="s2">, </span><span class="s1">expected2</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s5">1e-8</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">vals2</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== </span><span class="s1">expected2</span><span class="s2">.</span><span class="s1">shape</span>

    <span class="s1">vals3 </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">chi</span><span class="s2">.</span><span class="s1">moment</span><span class="s2">(</span><span class="s1">order</span><span class="s2">=</span><span class="s5">1</span><span class="s2">, </span><span class="s1">df</span><span class="s2">=[[</span><span class="s5">1.</span><span class="s2">], [</span><span class="s5">2.</span><span class="s2">], [</span><span class="s5">3.</span><span class="s2">]], </span><span class="s1">loc</span><span class="s2">=[</span><span class="s5">0.</span><span class="s2">, </span><span class="s5">1.</span><span class="s2">, </span><span class="s5">2.</span><span class="s2">],</span>
                             <span class="s1">scale</span><span class="s2">=[-</span><span class="s5">1.</span><span class="s2">, </span><span class="s5">0.</span><span class="s2">, </span><span class="s5">3.</span><span class="s2">])</span>
    <span class="s1">expected3 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">4.39365368</span><span class="s2">],</span>
                          <span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">5.75994241</span><span class="s2">],</span>
                          <span class="s2">[</span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">nan</span><span class="s2">, </span><span class="s5">6.78730736</span><span class="s2">]])</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">vals3</span><span class="s2">, </span><span class="s1">expected3</span><span class="s2">, </span><span class="s1">rtol</span><span class="s2">=</span><span class="s5">1e-8</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">vals3</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== </span><span class="s1">expected3</span><span class="s2">.</span><span class="s1">shape</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">slow</span>
<span class="s0">def </span><span class="s1">test_kappa3_array_gh13582</span><span class="s2">():</span>
    <span class="s4"># https://github.com/scipy/scipy/pull/15140#issuecomment-994958241</span>
    <span class="s1">shapes </span><span class="s2">= [</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">, </span><span class="s5">4.5</span><span class="s2">]</span>
    <span class="s1">moments </span><span class="s2">= </span><span class="s3">'mvsk'</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kappa3</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">, </span><span class="s1">moments</span><span class="s2">=</span><span class="s1">moment</span><span class="s2">)</span>
                   <span class="s0">for </span><span class="s1">shape </span><span class="s0">in </span><span class="s1">shapes</span><span class="s2">] </span><span class="s0">for </span><span class="s1">moment </span><span class="s0">in </span><span class="s1">moments</span><span class="s2">])</span>
    <span class="s1">res2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kappa3</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(</span><span class="s1">shapes</span><span class="s2">, </span><span class="s1">moments</span><span class="s2">=</span><span class="s1">moments</span><span class="s2">))</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">res2</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">xslow</span>
<span class="s0">def </span><span class="s1">test_kappa4_array_gh13582</span><span class="s2">():</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">2.5</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">, </span><span class="s5">4.5</span><span class="s2">, -</span><span class="s5">3</span><span class="s2">])</span>
    <span class="s1">k </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">3.5</span><span class="s2">])</span>
    <span class="s1">moments </span><span class="s2">= </span><span class="s3">'mvsk'</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kappa4</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">k</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">moments</span><span class="s2">=</span><span class="s1">moment</span><span class="s2">)</span>
                   <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">5</span><span class="s2">)] </span><span class="s0">for </span><span class="s1">moment </span><span class="s0">in </span><span class="s1">moments</span><span class="s2">])</span>
    <span class="s1">res2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kappa4</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">moments</span><span class="s2">=</span><span class="s1">moments</span><span class="s2">))</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">res2</span><span class="s2">)</span>

    <span class="s4"># https://github.com/scipy/scipy/pull/15250#discussion_r775112913</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">/</span><span class="s5">4</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">/</span><span class="s5">4</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>
    <span class="s1">k </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">, </span><span class="s5">1</span><span class="s2">/</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">/</span><span class="s5">3</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">, </span><span class="s5">0</span><span class="s2">])</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([[</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kappa4</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(</span><span class="s1">h</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">k</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">moments</span><span class="s2">=</span><span class="s1">moment</span><span class="s2">)</span>
                   <span class="s0">for </span><span class="s1">i </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s5">6</span><span class="s2">)] </span><span class="s0">for </span><span class="s1">moment </span><span class="s0">in </span><span class="s1">moments</span><span class="s2">])</span>
    <span class="s1">res2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kappa4</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">moments</span><span class="s2">=</span><span class="s1">moments</span><span class="s2">))</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_allclose</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">res2</span><span class="s2">)</span>

    <span class="s4"># https://github.com/scipy/scipy/pull/15250#discussion_r775115021</span>
    <span class="s1">h </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])</span>
    <span class="s1">k </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">([-</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">0.5</span><span class="s2">, </span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">])[:, </span><span class="s0">None</span><span class="s2">]</span>
    <span class="s1">res2 </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">array</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">kappa4</span><span class="s2">.</span><span class="s1">stats</span><span class="s2">(</span><span class="s1">h</span><span class="s2">, </span><span class="s1">k</span><span class="s2">, </span><span class="s1">moments</span><span class="s2">=</span><span class="s1">moments</span><span class="s2">))</span>
    <span class="s0">assert </span><span class="s1">res2</span><span class="s2">.</span><span class="s1">shape </span><span class="s2">== (</span><span class="s5">4</span><span class="s2">, </span><span class="s5">4</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_frozen_attributes</span><span class="s2">():</span>
    <span class="s4"># gh-14827 reported that all frozen distributions had both pmf and pdf</span>
    <span class="s4"># attributes; continuous should have pdf and discrete should have pmf.</span>
    <span class="s1">message </span><span class="s2">= </span><span class="s3">&quot;'rv_continuous_frozen' object has no attribute&quot;</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">AttributeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
        <span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">().</span><span class="s1">pmf</span>
    <span class="s0">with </span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">raises</span><span class="s2">(</span><span class="s1">AttributeError</span><span class="s2">, </span><span class="s1">match</span><span class="s2">=</span><span class="s1">message</span><span class="s2">):</span>
        <span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">().</span><span class="s1">logpmf</span>
    <span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">pmf </span><span class="s2">= </span><span class="s3">&quot;herring&quot;</span>
    <span class="s1">frozen_norm </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">()</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">frozen_norm</span><span class="s2">, </span><span class="s1">rv_continuous_frozen</span><span class="s2">)</span>
    <span class="s1">delattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">, </span><span class="s3">'pmf'</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_skewnorm_pdf_gh16038</span><span class="s2">():</span>
    <span class="s1">rng </span><span class="s2">= </span><span class="s1">np</span><span class="s2">.</span><span class="s1">random</span><span class="s2">.</span><span class="s1">default_rng</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= -</span><span class="s1">np</span><span class="s2">.</span><span class="s1">inf</span><span class="s2">, </span><span class="s5">0</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">skewnorm</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">a</span><span class="s2">), </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">))</span>
    <span class="s1">x</span><span class="s2">, </span><span class="s1">a </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)), </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">))</span>
    <span class="s1">mask </span><span class="s2">= </span><span class="s1">rng</span><span class="s2">.</span><span class="s1">random</span><span class="s2">(</span><span class="s1">size</span><span class="s2">=(</span><span class="s5">3</span><span class="s2">, </span><span class="s5">3</span><span class="s2">)) &lt; </span><span class="s5">0.5</span>
    <span class="s1">a</span><span class="s2">[</span><span class="s1">mask</span><span class="s2">] = </span><span class="s5">0</span>
    <span class="s1">x_norm </span><span class="s2">= </span><span class="s1">x</span><span class="s2">[</span><span class="s1">mask</span><span class="s2">]</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">skewnorm</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">a</span><span class="s2">)</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s1">mask</span><span class="s2">], </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">x_norm</span><span class="s2">))</span>
    <span class="s1">npt</span><span class="s2">.</span><span class="s1">assert_equal</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[~</span><span class="s1">mask</span><span class="s2">], </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">skewnorm</span><span class="s2">.</span><span class="s1">pdf</span><span class="s2">(</span><span class="s1">x</span><span class="s2">[~</span><span class="s1">mask</span><span class="s2">], </span><span class="s1">a</span><span class="s2">[~</span><span class="s1">mask</span><span class="s2">]))</span>


<span class="s4"># for scalar input, these functions should return scalar output</span>
<span class="s1">scalar_out </span><span class="s2">= [[</span><span class="s3">'rvs'</span><span class="s2">, []], [</span><span class="s3">'pdf'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">]], [</span><span class="s3">'logpdf'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">]], [</span><span class="s3">'cdf'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">]],</span>
              <span class="s2">[</span><span class="s3">'logcdf'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">]], [</span><span class="s3">'sf'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">]], [</span><span class="s3">'logsf'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">]], [</span><span class="s3">'ppf'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">]],</span>
              <span class="s2">[</span><span class="s3">'isf'</span><span class="s2">, [</span><span class="s5">0</span><span class="s2">]], [</span><span class="s3">'moment'</span><span class="s2">, [</span><span class="s5">1</span><span class="s2">]], [</span><span class="s3">'entropy'</span><span class="s2">, []], [</span><span class="s3">'expect'</span><span class="s2">, []],</span>
              <span class="s2">[</span><span class="s3">'median'</span><span class="s2">, []], [</span><span class="s3">'mean'</span><span class="s2">, []], [</span><span class="s3">'std'</span><span class="s2">, []], [</span><span class="s3">'var'</span><span class="s2">, []]]</span>
<span class="s1">scalars_out </span><span class="s2">= [[</span><span class="s3">'interval'</span><span class="s2">, [</span><span class="s5">0.95</span><span class="s2">]], [</span><span class="s3">'support'</span><span class="s2">, []], [</span><span class="s3">'stats'</span><span class="s2">, [</span><span class="s3">'mv'</span><span class="s2">]]]</span>


<span class="s2">@</span><span class="s1">pytest</span><span class="s2">.</span><span class="s1">mark</span><span class="s2">.</span><span class="s1">parametrize</span><span class="s2">(</span><span class="s3">'case'</span><span class="s2">, </span><span class="s1">scalar_out </span><span class="s2">+ </span><span class="s1">scalars_out</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">test_scalar_for_scalar</span><span class="s2">(</span><span class="s1">case</span><span class="s2">):</span>
    <span class="s4"># Some rv_continuous functions returned 0d array instead of NumPy scalar</span>
    <span class="s4"># Guard against regression</span>
    <span class="s1">method_name</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">case</span>
    <span class="s1">method </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">(), </span><span class="s1">method_name</span><span class="s2">)</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">method</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">case </span><span class="s0">in </span><span class="s1">scalar_out</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">number</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">number</span><span class="s2">)</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">number</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">test_scalar_for_scalar2</span><span class="s2">():</span>
    <span class="s4"># test methods that are not attributes of frozen distributions</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">fit</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">number</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">number</span><span class="s2">)</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">fit_loc_scale</span><span class="s2">([</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">number</span><span class="s2">)</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">res</span><span class="s2">[</span><span class="s5">1</span><span class="s2">], </span><span class="s1">np</span><span class="s2">.</span><span class="s1">number</span><span class="s2">)</span>
    <span class="s1">res </span><span class="s2">= </span><span class="s1">stats</span><span class="s2">.</span><span class="s1">norm</span><span class="s2">.</span><span class="s1">nnlf</span><span class="s2">((</span><span class="s5">0</span><span class="s2">, </span><span class="s5">1</span><span class="s2">), [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">2</span><span class="s2">, </span><span class="s5">3</span><span class="s2">])</span>
    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">res</span><span class="s2">, </span><span class="s1">np</span><span class="s2">.</span><span class="s1">number</span><span class="s2">)</span>
</pre>
</body>
</html>